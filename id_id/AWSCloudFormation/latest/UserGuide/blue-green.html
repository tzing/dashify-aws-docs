<!DOCTYPE html>
    <html xmlns="http://www.w3.org/1999/xhtml" lang="id-ID"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Lakukan penerapan biru/hijau ECS melalui penggunaan CodeDeploy AWS CloudFormation - AWS CloudFormation</title><meta name="viewport" content="width=device-width,initial-scale=1" /><meta name="assets_root" content="/assets" /><meta name="target_state" content="blue-green" /><meta name="default_state" content="blue-green" /><link rel="icon" type="image/ico" href="/assets/images/favicon.ico" /><link rel="shortcut icon" type="image/ico" href="/assets/images/favicon.ico" /><link rel="canonical" href="https://docs.aws.amazon.com/id_id/AWSCloudFormation/latest/UserGuide/blue-green.html" /><meta name="description" content="Gunakan AWS CloudFormation templat untuk mengelola deployment ECS biru/hijau melalui AWS CodeDeploy." /><meta name="deployment_region" content="IAD" /><meta name="product" content="AWS CloudFormation" /><meta name="guide" content="Panduan Pengguna" /><meta name="abstract" content="Membuat dan mengelola penyebaran AWS infrastruktur dapat diprediksi dan berulang kali menggunakan Panduan Pengguna AWS CloudFormation ini." /><meta name="guide-locale" content="id_id" /><meta name="tocs" content="toc-contents.json" /><link rel="canonical" href="https://docs.aws.amazon.com/id_id/AWSCloudFormation/latest/UserGuide/blue-green.html" /><link rel="alternative" href="https://docs.aws.amazon.com/id_id/AWSCloudFormation/latest/UserGuide/blue-green.html" hreflang="id-id" /><link rel="alternative" href="https://docs.aws.amazon.com/id_id/AWSCloudFormation/latest/UserGuide/blue-green.html" hreflang="id" /><link rel="alternative" href="https://docs.aws.amazon.com/de_de/AWSCloudFormation/latest/UserGuide/blue-green.html" hreflang="de-de" /><link rel="alternative" href="https://docs.aws.amazon.com/de_de/AWSCloudFormation/latest/UserGuide/blue-green.html" hreflang="de" /><link rel="alternative" href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/blue-green.html" hreflang="en-us" /><link rel="alternative" href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/blue-green.html" hreflang="en" /><link rel="alternative" href="https://docs.aws.amazon.com/es_es/AWSCloudFormation/latest/UserGuide/blue-green.html" hreflang="es-es" /><link rel="alternative" href="https://docs.aws.amazon.com/es_es/AWSCloudFormation/latest/UserGuide/blue-green.html" hreflang="es" /><link rel="alternative" href="https://docs.aws.amazon.com/fr_fr/AWSCloudFormation/latest/UserGuide/blue-green.html" hreflang="fr-fr" /><link rel="alternative" href="https://docs.aws.amazon.com/fr_fr/AWSCloudFormation/latest/UserGuide/blue-green.html" hreflang="fr" /><link rel="alternative" href="https://docs.aws.amazon.com/it_it/AWSCloudFormation/latest/UserGuide/blue-green.html" hreflang="it-it" /><link rel="alternative" href="https://docs.aws.amazon.com/it_it/AWSCloudFormation/latest/UserGuide/blue-green.html" hreflang="it" /><link rel="alternative" href="https://docs.aws.amazon.com/ja_jp/AWSCloudFormation/latest/UserGuide/blue-green.html" hreflang="ja-jp" /><link rel="alternative" href="https://docs.aws.amazon.com/ja_jp/AWSCloudFormation/latest/UserGuide/blue-green.html" hreflang="ja" /><link rel="alternative" href="https://docs.aws.amazon.com/ko_kr/AWSCloudFormation/latest/UserGuide/blue-green.html" hreflang="ko-kr" /><link rel="alternative" href="https://docs.aws.amazon.com/ko_kr/AWSCloudFormation/latest/UserGuide/blue-green.html" hreflang="ko" /><link rel="alternative" href="https://docs.aws.amazon.com/pt_br/AWSCloudFormation/latest/UserGuide/blue-green.html" hreflang="pt-br" /><link rel="alternative" href="https://docs.aws.amazon.com/pt_br/AWSCloudFormation/latest/UserGuide/blue-green.html" hreflang="pt" /><link rel="alternative" href="https://docs.aws.amazon.com/zh_cn/AWSCloudFormation/latest/UserGuide/blue-green.html" hreflang="zh-cn" /><link rel="alternative" href="https://docs.aws.amazon.com/zh_tw/AWSCloudFormation/latest/UserGuide/blue-green.html" hreflang="zh-tw" /><link rel="alternative" href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/blue-green.html" hreflang="x-default" /><meta name="feedback-item" content="CloudFormation" /><meta name="this_doc_product" content="AWS CloudFormation" /><meta name="this_doc_guide" content="Panduan Pengguna" /><script defer="" src="/assets/r/vendor4.js?version=2021.12.02"></script><script defer="" src="/assets/r/vendor3.js?version=2021.12.02"></script><script defer="" src="/assets/r/vendor1.js?version=2021.12.02"></script><script defer="" src="/assets/r/awsdocs-common.js?version=2021.12.02"></script><script defer="" src="/assets/r/awsdocs-doc-page.js?version=2021.12.02"></script><link href="/assets/r/vendor4.css?version=2021.12.02" rel="stylesheet" /><link href="/assets/r/awsdocs-common.css?version=2021.12.02" rel="stylesheet" /><link href="/assets/r/awsdocs-doc-page.css?version=2021.12.02" rel="stylesheet" /><script async="" id="awsc-panorama-bundle" type="text/javascript" src="https://prod.pa.cdn.uis.awsstatic.com/panorama-nav-init.js" data-config="{'appEntity':'aws-documentation','region':'us-east-1','service':'cloudformation'}"></script><meta id="panorama-serviceSubSection" value="Panduan Pengguna" /><meta id="panorama-serviceConsolePage" value="Lakukan penerapan biru/hijau ECS melalui penggunaan CodeDeploy AWS CloudFormation" /></head><body class="awsdocs awsui"><div class="awsdocs-container"><awsdocs-header></awsdocs-header><awsui-app-layout id="app-layout" class="awsui-util-no-gutters" ng-controller="ContentController as $ctrl" header-selector="awsdocs-header" navigation-hide="false" navigation-width="$ctrl.navWidth" navigation-open="$ctrl.navOpen" navigation-change="$ctrl.onNavChange($event)" tools-hide="$ctrl.hideTools" tools-width="$ctrl.toolsWidth" tools-open="$ctrl.toolsOpen" tools-change="$ctrl.onToolsChange($event)"><div id="guide-toc" dom-region="navigation"><awsdocs-toc></awsdocs-toc></div><div id="main-column" dom-region="content" tabindex="-1"><awsdocs-view class="awsdocs-view"><div id="awsdocs-content"><head><title>Lakukan penerapan biru/hijau ECS melalui penggunaan CodeDeploy AWS CloudFormation - AWS CloudFormation</title><meta name="rss" content="aws-cloudformation-release-notes.rss" /><meta name="forums" content="http://forums.aws.amazon.com/forum.jspa?forumID=92" /><meta name="feedback" content="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=CloudFormation&amp;topic_url=https://docs.aws.amazon.com/id_id/AWSCloudFormation/latest/UserGuide/blue-green.html" /><meta name="feedback-yes" content="feedbackyes.html?topic_url=https://docs.aws.amazon.com/id_id/AWSCloudFormation/latest/UserGuide/blue-green.html" /><meta name="feedback-no" content="feedbackno.html?topic_url=https://docs.aws.amazon.com/id_id/AWSCloudFormation/latest/UserGuide/blue-green.html" /><meta name="keywords" content="CloudFormation,AWSCloudFormation,penyediaan sumber daya,konfigurasi sumber daya,manajemen infrastruktur,CloudFormer,CloudFormation tumpukan,CloudFormation stackset,CloudFormation Template,ubah set" /><script type="application/ld+json">
{
    "@context" : "https://schema.org",
    "@type" : "BreadcrumbList",
    "itemListElement" : [
      {
        "@type" : "ListItem",
        "position" : 1,
        "name" : "AWS",
        "item" : "https://aws.amazon.com"
      },
      {
        "@type" : "ListItem",
        "position" : 2,
        "name" : "AWS CloudFormation",
        "item" : "https://docs.aws.amazon.com/cloudformation/index.html"
      },
      {
        "@type" : "ListItem",
        "position" : 3,
        "name" : "Panduan Pengguna",
        "item" : "https://docs.aws.amazon.com/id_id/AWSCloudFormation/latest/UserGuide"
      },
      {
        "@type" : "ListItem",
        "position" : 4,
        "name" : "Bekerja dengan templat AWS CloudFormation",
        "item" : "https://docs.aws.amazon.com/id_id/AWSCloudFormation/latest/UserGuide/template-guide.html"
      },
      {
        "@type" : "ListItem",
        "position" : 5,
        "name" : "Lakukan penerapan biru/hijau ECS melalui penggunaan CodeDeploy AWS CloudFormation",
        "item" : "https://docs.aws.amazon.com/id_id/AWSCloudFormation/latest/UserGuide/template-guide.html"
      }
    ]
}
</script></head><body><div id="main"><div style="display: none"></div><div id="breadcrumbs" class="breadcrumb"><a href="https://aws.amazon.com">AWS</a><a href="/index.html">Dokumentasi</a><a href="/cloudformation/index.html">AWS CloudFormation</a><a href="Welcome.html">Panduan Pengguna</a></div><div id="page-toc-src"><a href="#blue-green-required">Memodelkan deployment biru/hijau menggunakan  CloudFormation  sumber daya</a><a href="#blue-green-resources">Pembaruan sumber daya yang memicu deployment hijau</a><a href="#blue-green-considerations">Pertimbangan saat mengelola penerapan biru/hijau ECS menggunakan  CloudFormation</a><a href="#blue-green-setup">Mempersiapkan templat Anda untuk melakukan deployment ECS biru/hijau</a><a href="#blue-green-changesets">Meninjau perubahan set untuk deployment biru/hijau Anda</a><a href="#blue-green-events">Melihat peristiwa tumpukan untuk deployment biru/hijau Anda</a><a href="#blue-green-template-reference">Referensi templat</a><a href="#blue-green-iam">Izin IAM diperlukan untuk deployment biru/hijau</a><a href="#blue-green-template-example">Contoh templat</a></div><div id="page-filters" style="display:none"><filter label="All" id="All"></filter><filter label="JSON" id="JSON"></filter><filter label="YAML" id="YAML"></filter></div><div id="main-content" class="awsui-util-container"><div id="main-col-body"><awsdocs-language-banner data-service="$ctrl.pageService"></awsdocs-language-banner><awsui-alert class="awsdocs-page-banner awsui-util-mb-l"><p>Terjemahan disediakan oleh mesin penerjemah. Jika konten terjemahan yang diberikan bertentangan dengan versi bahasa Inggris aslinya, utamakan versi bahasa Inggris.</p></awsui-alert><h1 class="topictitle" id="blue-green">Lakukan penerapan biru/hijau ECS melalui penggunaan  CodeDeploy  AWS CloudFormation</h1><div class="awsdocs-page-header-container"><awsdocs-page-header></awsdocs-page-header><awsdocs-filter-selector id="awsdocs-filter-selector"></awsdocs-filter-selector></div><p>Anda dapat menggunakan  CloudFormation  untuk melakukan penyebaran biru/hijau ECS melalui. AWS CodeDeploy Penerapan biru/hijau adalah strategi penyebaran aman yang disediakan oleh  CodeDeploy  untuk meminimalkan gangguan yang disebabkan oleh perubahan versi aplikasi. Hal ini dicapai dengan menciptakan lingkungan aplikasi baru Anda, disebut sebagai <em>hijau</em>, bersamaan dengan aplikasi Anda saat ini yang melayani lalu lintas langsung, yang disebut sebagai <em>biru</em>. Hal ini memungkinkan untuk jangka waktu pemantauan dan pengujian lingkungan hijau sebelum lalu lintas langsung Anda dialihkan dari biru ke hijau dan kemudian mematikan sumber daya biru.</p><p>Saat menggunakan  CloudFormation  untuk melakukan penerapan biru/hijau ECS, Anda mulai dengan membuat template tumpukan yang mendefinisikan sumber daya untuk lingkungan aplikasi biru dan hijau Anda, termasuk menentukan pengaturan perutean lalu lintas dan stabilisasi yang akan digunakan. Selanjutnya, Anda membuat tumpukan dari template yang; ini menghasilkan aplikasi biru Anda (saat ini).  CloudFormation hanya menciptakan sumber daya biru selama pembuatan stack. Sumber daya untuk deployment hijau tidak dibuat hingga diperlukan.</p><p>Kemudian, jika dalam pembaruan stack future Anda memperbarui definisi tugas atau sumber daya set tugas di aplikasi biru Anda,  CloudFormation  lakukan hal berikut:</p><div class="itemizedlist">
         
         
         
    <ul class="itemizedlist"><li class="listitem"><p>Menghasilkan semua sumber daya lingkungan aplikasi hijau yang diperlukan</p></li><li class="listitem"><p>Menggeser lalu lintas berdasarkan parameter perutean lalu lintas yang ditentukan</p></li><li class="listitem"><p>Menghapus sumber daya biru</p></li></ul></div><p>Jika kesalahan terjadi pada titik mana pun sebelum deployment hijau berhasil dan diselesaikan,  CloudFormation  menggulung tumpukan kembali ke statusnya sebelum seluruh deployment hijau dimulai.</p><p> CloudFormation Untuk mengaktifkan penerapan biru/hijau pada tumpukan, sertakan informasi berikut dalam template tumpukannya:</p><div class="itemizedlist">
         
         
    <ul class="itemizedlist"><li class="listitem"><p>Bagian <code class="code">Transform</code> dalam templat Anda yang menjalankan <code class="code">AWS::CodeDeployBlueGreen</code> mengubah dan <code class="code">Hook</code> bagian yang menjalankan <code class="code">AWS::CodeDeploy::BlueGreen</code> kait.</p></li><li class="listitem"><p>Setidaknya salah satu sumber daya ECS yang akan memicu deployment biru/hijau jika diganti selama pembaruan tumpukan. Saat ini, sumber daya tersebut adalah <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-resource-ecs-taskdefinition.html"><code class="code">AWS::ECS::TaskDefinition</code></a> dan <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-resource-ecs-taskset.html"><code class="code">AWS::ECS::TaskSet</code></a>.</p></li></ul></div><p>Kemudian, jika Anda memulai pembaruan tumpukan yang memperbarui properti apa pun dari sumber daya di atas yang memerlukan  CloudFormation  penggantian sumber daya,  CloudFormation  lakukan penerapan biru/hijau seperti dijelaskan di atas. Untuk informasi selengkapnya tentang perilaku pembaruan sumber daya, lihat <a href="./using-cfn-updating-stacks-update-behaviors.html">Memperbarui perilaku sumber daya tumpukan</a>.</p><p>Dalam beberapa kasus, Anda ingin mengatur templat tumpukan Anda untuk mengaktifkan deployment biru/hijau <em>sebelum</em> Anda membuat tumpukan. Namun, Anda juga dapat menambahkan kemampuan untuk  CloudFormation  melakukan penerapan biru/hijau ke tumpukan yang ada. Untuk melakukannya, tambahkan informasi yang diperlukan untuk templat tumpukan yang ada.</p><p>Selain itu, kami sarankan Anda  CloudFormation  membuat set perubahan untuk penerapan hijau, sebelum memulai pembaruan tumpukan. Hal ini memungkinkan Anda untuk meninjau perubahan aktual yang akan dibuat untuk tumpukan. Untuk informasi selengkapnya, lihat <a href="./using-cfn-updating-stacks-changesets.html">Memperbarui tumpukan menggunakan set perubahan</a>.</p>
        <h2 id="blue-green-required">Memodelkan deployment biru/hijau menggunakan  CloudFormation  sumber daya</h2>
        <p>Untuk melakukan penyebaran biru/hijau ECS menggunakan  CodeDeploy  through CloudFormation, template Anda harus menyertakan sumber daya yang memodelkan penerapan Anda, seperti layanan Amazon ECS dan penyeimbang beban. Untuk rincian lebih lanjut tentang apa yang diwakili sumber daya ini, lihat <a href="https://docs.aws.amazon.com/codedeploy/latest/userguide/deployment-steps-ecs.html#deployment-steps-prerequisites-ecs">Sebelum Anda memulai deployment Amazon ECS</a> dalam <em>AWS CodeDeploy Panduan Pengguna</em>.</p>
        <div class="table-container"><div class="table-contents"><table id="w1348aac17c33c25b5"><thead>
                    <tr>
                        <th>Persyaratan</th>
                        <th>Sumber daya</th>
                        <th>Diperlukan/Opsional</th>
                        <th>Pemicu deployment biru/hijau jika diganti</th>
                    </tr>
                </thead>
                    <tr>
                        <td tabindex="-1">Kluster Amazon ECS</td>
                        <td tabindex="-1"><a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-resource-ecs-cluster.html"><code class="code">AWS::ECS::Cluster</code></a></td>
                        <td tabindex="-1">Opsional. Klaster default dapat digunakan.</td>
                        <td tabindex="-1">Tidak</td>
                    </tr>
                    <tr>
                        <td tabindex="-1">Layanan Amazon ECS</td>
                        <td tabindex="-1"><a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-resource-ecs-service.html"><code class="code">AWS::ECS::Service</code></a></td>
                        <td tabindex="-1">Wajib.</td>
                        <td tabindex="-1">Tidak</td>
                    </tr>
                    <tr>
                        <td tabindex="-1">Penyeimbang Beban Jaringan atau Aplikasi</td>
                        <td tabindex="-1"><a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-properties-ecs-service-loadbalancer.html"><code class="code">AWS::ECS::Service
       LoadBalancer</code></a></td>
                        <td tabindex="-1">Wajib.</td>
                        <td tabindex="-1">Tidak</td>
                    </tr>
                    <tr>
                        <td tabindex="-1">Listener produksi</td>
                        <td tabindex="-1"><a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-resource-elasticloadbalancingv2-listener.html"><code class="code">AWS::ElasticLoadBalancingV2::Listener</code></a></td>
                        <td tabindex="-1">Wajib.</td>
                        <td tabindex="-1">Tidak</td>
                    </tr>
                    <tr>
                        <td tabindex="-1">Uji listener </td>
                        <td tabindex="-1"><a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-resource-elasticloadbalancingv2-listener.html"><code class="code">AWS::ElasticLoadBalancingV2::Listener</code></a></td>
                        <td tabindex="-1">Opsional.</td>
                        <td tabindex="-1">Tidak</td>
                    </tr>
                    <tr>
                        <td tabindex="-1">Dua grup target</td>
                        <td tabindex="-1"><a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-resource-elasticloadbalancingv2-targetgroup.html"><code class="code">AWS::ElasticLoadBalancingV2::TargetGroup</code></a></td>
                        <td tabindex="-1">Wajib.</td>
                        <td tabindex="-1">Tidak</td>
                    </tr>
                    <tr>
                        <td tabindex="-1">Definisi tugas Amazon ECS </td>
                        <td tabindex="-1"><a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-resource-ecs-taskdefinition.html"><code class="code">AWS::ECS::TaskDefinition</code></a></td>
                        <td tabindex="-1">Wajib.</td>
                        <td tabindex="-1">Ya</td>
                    </tr>
                    <tr>
                        <td tabindex="-1">Wadah untuk aplikasi Amazon ECS Anda</td>
                        <td tabindex="-1"><a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-properties-ecs-taskdefinition-containerdefinitions.html#cfn-ecs-taskdefinition-containerdefinition-name.html"><code class="code">AWS::ECS::TaskDefinition ContainerDefinition Name</code></a></td>
                        <td tabindex="-1">Wajib.</td>
                        <td tabindex="-1">Tidak</td>
                    </tr>
                    <tr>
                        <td tabindex="-1">Port untuk set tugas pengganti Anda</td>
                        <td tabindex="-1"><a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-properties-ecs-taskdefinition-portmapping.html#cfn-ecs-taskdefinition-portmapping-containerport"><code class="code">AWS::ECS::TaskDefinition PortMapping ContainerPort</code></a></td>
                        <td tabindex="-1">Wajib.</td>
                        <td tabindex="-1">Tidak</td>
                    </tr>
                </table></div></div>
     
        <h2 id="blue-green-resources">Pembaruan sumber daya yang memicu deployment hijau</h2>
        <p>Jika Anda melakukan pembaruan tumpukan yang memperbarui properti yang memerlukan <a href="./using-cfn-updating-stacks-update-behaviors.html">penggantian</a> untuk sumber daya ECS berikut,  CloudFormation memulai deployment hijau:</p>
        <div class="itemizedlist">
             
             
        <ul class="itemizedlist"><li class="listitem"><p><a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-resource-ecs-taskdefinition.html"><code class="code">AWS::ECS::TaskDefinition</code></a></p></li><li class="listitem"><p><a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-resource-ecs-taskset.html"><code class="code">AWS::ECS::TaskSet</code></a> </p></li></ul></div>
        
        <p>Memperbarui properti di sumber daya ini yang tidak memerlukan penggantian sumber daya tidak memicu deployment hijau.</p>
        <p>Anda tidak dapat menyertakan pembaruan ke sumber daya di atas dengan pembaruan ke sumber daya lain dalam pembaruan tumpukan yang sama. Jika Anda harus memperbarui sumber daya dalam daftar di atas selain sumber daya lain di tumpukan yang sama, lakukan salah satu hal berikut ini:</p>
        <div class="itemizedlist">
             
             
        <ul class="itemizedlist"><li class="listitem"><p>Lakukan dua operasi pembaruan tumpukan terpisah: satu yang hanya mencakup pembaruan ke sumber daya di atas, dan pembaruan tumpukan terpisah yang mencakup perubahan pada sumber daya lainnya.</p></li><li class="listitem"><p>Hapus <code class="code">Transform</code> dan <code class="code">Hook</code> bagian dari templat Anda dan kemudian lakukan pembaruan tumpukan. Dalam hal ini,  CloudFormation  tidak akan melakukan penerapan hijau.</p></li></ul></div>
     
        <h2 id="blue-green-considerations">Pertimbangan saat mengelola penerapan biru/hijau ECS menggunakan  CloudFormation</h2>
        <p>Anda harus mempertimbangkan hal berikut ketika mendefinisikan deployment biru/hijau menggunakan  CloudFormation:</p>
        <div class="itemizedlist">
             
             
             
             
             
             
             
             
             
        <ul class="itemizedlist"><li class="listitem"><p>Hanya pembaruan ke sumber daya tertentu yang akan memulai penerapan hijau, seperti yang dibahas di. <a href="#blue-green-resources">Pembaruan sumber daya yang memicu deployment hijau</a></p></li><li class="listitem"><p>Anda tidak dapat menyertakan pembaruan ke sumber daya yang memulai penerapan hijau dan pembaruan ke sumber daya lain dalam pembaruan tumpukan yang sama, seperti yang dibahas di. <a href="#blue-green-resources">Pembaruan sumber daya yang memicu deployment hijau</a></p></li><li class="listitem"><p>Anda hanya dapat menentukan layanan ECS tunggal sebagai target deployment.</p></li><li class="listitem"><p>Parameter yang nilainya dikaburkan oleh tidak  CloudFormation  dapat diperbarui oleh  CodeDeploy  layanan selama penerapan hijau, dan akan menyebabkan kesalahan dan kegagalan pembaruan tumpukan. Ini termasuk:</p>
            <div class="itemizedlist">
                 
                 
            <ul class="itemizedlist"><li class="listitem"><p>Parameter didefinisikan dengan <code class="code">NoEcho</code> atribut.</p></li><li class="listitem"><p>Parameter yang menggunakan referensi dinamis untuk mengambil nilai-nilainya dari layanan eksternal. Untuk informasi selengkapnya, lihat <a href="./dynamic-references.html">Menggunakan referensi dinamis untuk menentukan nilai templat</a>.</p></li></ul></div>
            </li><li class="listitem"><p>Untuk membatalkan penerapan hijau yang masih berlangsung, batalkan pembaruan tumpukan di CloudFormation, bukan  CodeDeploy  atau ECS. Untuk informasi selengkapnya, lihat <a href="./using-cfn--stack-update-cancel.html">Membatalkan pembaruan tumpukan</a>. (Setelah pembaruan selesai, Anda tidak dapat membatalkannya. Namun, Anda dapat memperbarui tumpukan lagi dengan pengaturan sebelumnya.)</p></li><li class="listitem"><p>Mendeklarasikan <a href="./outputs-section-structure.html">Output</a> atau menggunakan <a href="./intrinsic-function-reference-importvalue.html">Fn::ImportValue</a> untuk mengimpor nilai dari tumpukan lain saat ini tidak didukung untuk templat yang mendefinisikan penerapan ECS biru/hijau.</p></li><li class="listitem"><p><a href="./resource-import.html">Membawa sumber daya yang ada ke dalam  CloudFormation  manajemen</a>saat ini tidak didukung untuk templat yang mendefinisikan penerapan ECS biru/hijau.</p></li><li class="listitem"><p>Anda tidak dapat menggunakan <code class="code">AWS::CodeDeploy::BlueGreen</code> kait dalam templat yang mencakup sumber daya tumpukan bersarang.</p></li><li class="listitem"><p>Anda tidak dapat menggunakan <code class="code">AWS::CodeDeploy::BlueGreen</code> kait dalam <a href="./using-cfn-nested-stacks.html">tumpukan bersarang</a>.</p></li></ul></div>
        <p><em>Untuk informasi tentang cara menggunakan  CloudFormation  untuk melakukan penerapan biru/hijau ECS Anda melalui  CodeDeploy  penerapan Amazon ECS standar yang hanya menggunakan,  CodeDeploy lihat Perbedaan <a href="https://docs.aws.amazon.com/codedeploy/latest/userguide/deployments-create-prerequisites.html">antara penerapan Amazon ECS Biru/Hijau melalui dan penerapan Amazon ECS standar di Panduan Pengguna.  CloudFormation</a> AWS CodeDeploy</em></p>
     
        <h2 id="blue-green-setup">Mempersiapkan templat Anda untuk melakukan deployment ECS biru/hijau</h2>
        <p>Untuk mengaktifkan deployment biru/hijau di tumpukan Anda, sertakan bagian berikut dalam template tumpukan Anda sebelum melakukan pembaruan tumpukan.</p>
        <div class="itemizedlist">
             
             
             
        <ul class="itemizedlist"><li class="listitem"><p>Tambahkan referensi ke <code class="code">AWS::CodeDeployBlueGreen</code> ubah ke templat anda:</p>
            <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Salinan"><awsui-icon name="copy"></awsui-icon></div></div><code class="json ">    "Transform": [
        "AWS::CodeDeployBlueGreen"
    ],</code></pre>
</li><li class="listitem"><p>Tambahkan <code class="code">Hook</code> bagian yang menjalankan <code class="code">AWS::CodeDeploy::BlueGreen</code> dan menentukan properti untuk deployment Anda. Gunakan referensi templat di bawah ini sebagai panduan.</p></li><li class="listitem"><p>Di bagian <code class="code">Resources</code>, tentukan sumber daya biru dan hijau untuk deployment Anda.</p></li></ul></div>
        <p>Anda dapat menambahkan bagian ini ketika pertama kali membuat templat (yaitu, sebelum membuat tumpukan itu sendiri), atau Anda dapat menambahkannya ke templat yang ada sebelum melakukan pembaruan tumpukan. Jika Anda menentukan penerapan biru/hijau untuk tumpukan baru,  CloudFormation  hanya membuat sumber daya biru selama pembuatan tumpukan — sumber daya untuk penerapan hijau tidak dibuat sampai diperlukan selama pembaruan tumpukan.</p>

     
        <h2 id="blue-green-changesets">Meninjau perubahan set untuk deployment biru/hijau Anda</h2>
        <p>Kami sangat menyarankan Anda utnuk membuat perubahan yang ditetapkan sebelum melakukan pembaruan tumpukan yang akan memulai deployment hijau. Hal ini mengizinkan untuk melihat perubahan aktual yang akan dibuat ke tumpukan Anda sebelum melakukan pembaruan tumpukan. Sadarilah bahwa perubahan sumber daya mungkin tidak tercantum dalam urutan yang akan dilakukan selama pembaruan tumpukan. Untuk informasi selengkapnya, lihat <a href="./using-cfn-updating-stacks-changesets.html">Memperbarui tumpukan menggunakan set perubahan</a>.</p>
     
        <h2 id="blue-green-events">Melihat peristiwa tumpukan untuk deployment biru/hijau Anda</h2>
        <p>Anda dapat melihat peristiwa tumpukan yang dihasilkan pada setiap langkah deployment ECS pada tab <b>Peristiwa</b> dari halamn <b>Tumpukan</b>, dan menggunakan AWS CLI. Untuk informasi selengkapnya, lihat <a href="./using-cfn-updating-stacks-monitor-stack.html">Memantau kemajuan pembaruan tumpukan</a>.</p>
     
        <h2 id="blue-green-template-reference">Referensi templat</h2>
        <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Salinan"><awsui-icon name="copy"></awsui-icon></div></div><code class="json ">"Hooks": <span>{</span>
  "Logical ID": <span>{</span>
    "Properties": <span>{</span>
      "TrafficRoutingConfig": <span>{</span>
        "Type": "Traffic routing type",
        "TimeBasedCanary": <span>{</span>
          "StepPercentage": Integer,
          "BakeTimeMins": Integer
        },
        "TimeBasedLinear": <span>{</span>
          "StepPercentage": Integer,
          "BakeTimeMins": Integer
        }
      },
      "AdditionalOptions": <span>{</span>"TerminationWaitTimeInMinutes": Integer},
      "LifecycleEventHooks": <span>{</span>
        "BeforeInstall": "FunctionName",
        "AfterInstall": "FunctionName",
        "AfterAllowTestTraffic": "FunctionName",
        "BeforeAllowTraffic": "FunctionName",
        "AfterAllowTraffic": "FunctionName"
      },
      "ServiceRole": "CodeDeployServiceRoleName",
      "Applications": [
        <span>{</span>
          "Target": <span>{</span>
            "Type": "AWS::ECS::Service",
            "LogicalID": "Resource Logical ID"
          },
          "ECSAttributes": <span>{</span>
            "TaskDefinitions": [
              "AWS::ECS::TaskDefinition Resource Logical ID (Blue)",
              "AWS::ECS::TaskDefinition Resource Logical ID (Green)"
            ],
            "TaskSets": [
              "AWS::ECS::TaskSet Resource Logical ID (Blue)",
              "AWS::ECS::TaskSet Resource Logical ID (Green)"
            ],
            "TrafficRouting": <span>{</span>
              "ProdTrafficRoute": <span>{</span>
                "Type": "AWS::ElasticLoadBalancingV2::Listener",
                "LogicalID": "Resource Logical ID (Production)"
              },
              "TestTrafficRoute": <span>{</span>
                "Type": "AWS::ElasticLoadBalancingV2::Listener",
                "LogicalID": "Resource Logical ID (Test)"
              },
              "TargetGroups": [
                "AWS::ElasticLoadBalancingV2::TargetGroup Resource Logical ID (Blue)",
                "AWS::ElasticLoadBalancingV2::TargetGroup Resource Logical ID (Green)"
              ]
            }
          }
        }
      ]
    },
    "Type": "AWS::CodeDeploy::BlueGreen"
  }
}</code></pre>
         
            <h3 id="blue-green-template-reference-props">Properti</h3>
            <div class="variablelist">
                 
                 
            <dl>
                    <dt><span class="term"><code class="code">Logical ID</code></span></dt>
                    <dd>
                        <p>ID logis harus berupa alfanumerik (A-Za-z0-9) dan unik dalam templat.</p>
                        <p><em>Wajib: </em>Ya</p>
                        <div class="variablelist">
                             
                        <dl>
                                <dt><span class="term"><code class="code">Properties</code></span></dt>
                                <dd>
                                    <p>Properti kait.</p>
                                    <p><em>Wajib: </em>Ya</p>
                                    <div class="variablelist">
                                         
                                         
                                         
                                         
                                         
                                    <dl>
                                            <dt><span class="term"><code class="code">TrafficRoutingConfig</code></span></dt>
                                            <dd>
                                                <p>Pengaturan konfigurasi perutean lalu lintas.</p>
                                                <p><em>Wajib: </em>Tidak</p>
                                                <p>Konfigurasi default adalah pergeseran lalu lintas Canary berbasis waktu, dengan persentase langkah 15% dan waktu menanam lima menit.</p>
                                                <div class="variablelist">
                                                    
                                                     
                                                <dl>
                                                        <dt><span class="term"><code class="code">Type</code></span></dt>
                                                        <dd>
                                                            <p>Jenis pergeseran lalu lintas yang digunakan oleh konfigurasi deployment.</p>
                                                            <p>Nilai yang valid:  AllAtOnce  |  TimeBasedCanary  |  TimeBasedLinear</p>
                                                            <p><em>Wajib: </em>Ya</p>
                                                            <div class="variablelist">
                                                                 
                                                                 
                                                            <dl>
                                                                    <dt><span class="term"><code class="code">TimeBasedCanary</code></span></dt>
                                                                    <dd>
                                                                        <p>Menentukan konfigurasi yang menggeser lalu lintas dari satu versi deployment ke versi lain dalam dua tambahan.</p>
                                                                        <p><em>Wajib</em>: Bersyarat: Jika Anda menentukan <code class="code">TimeBasedCanary</code> sebagai jenis perutean lalu lintas, Anda harus menyertakan parameter. <code class="code">TimeBasedCanary</code></p>
                                                                        <div class="variablelist">
                                                                             
                                                                        <dl>
                                                                                <dt><span class="term"><code class="code">StepPercentage</code></span></dt>
                                                                                <dd>
                                                                                    <p>Persentase lalu lintas bergeser dalam tambahan pertama <code class="code">TimeBasedCanary</code> deployment. Persentase langkah harus 14% atau lebih besar.</p>
                                                                                    <p><em>Wajib: </em>Tidak</p>
                                                                                </dd>
                                                                            </dl></div>
                                                                        <div class="variablelist">
                                                                             
                                                                        <dl>
                                                                                <dt><span class="term"><code class="code">BakeTimeMins</code></span></dt>
                                                                                <dd>
                                                                                    <p>Jumlah menit antara pergeseran lalu lintas pertama dan kedua dari <code class="code">TimeBasedCanary</code> deployment.</p>
                                                                                    <p><em>Wajib: </em>Tidak</p>
                                                                                </dd>
                                                                            </dl></div>
                                                                    </dd>
                                                                 
                                                                    <dt><span class="term"><code class="code">TimeBasedLinear</code></span></dt>
                                                                    <dd>
                                                                        <p>Menentukan konfigurasi yang menggeser lalu lintas dari satu versi deployment ke versi lain dalam dua tambahan, dengan jumlah menit yang sama antara setiap tambahan.</p>
                                                                        <p><em>Wajib</em>: Bersyarat: Jika Anda menentukan <code class="code">TimeBasedLinear</code> sebagai jenis perutean lalu lintas, Anda harus menyertakan parameter. <code class="code">TimeBasedLinear</code></p>
                                                                        <div class="variablelist">
                                                                             
                                                                        <dl>
                                                                                <dt><span class="term"><code class="code">StepPercentage</code></span></dt>
                                                                                <dd>
                                                                                    <p>Persentase lalu lintas yang bergeser pada awal setiap tambahan <code class="code">TimeBasedLinear</code> deployment. Persentase langkah harus 14% atau lebih besar.</p>
                                                                                    <p><em>Wajib: </em>Tidak</p>
                                                                                </dd>
                                                                            </dl></div>
                                                                        <div class="variablelist">
                                                                             
                                                                        <dl>
                                                                                <dt><span class="term"><code class="code">BakeTimeMins</code></span></dt>
                                                                                <dd>
                                                                                    <p>Jumlah menit antara setiap pergeseran lalu lintas tambahan <code class="code">TimeBasedLinear</code> deployment.</p>
                                                                                    <p><em>Wajib: </em>Tidak</p>
                                                                                </dd>
                                                                            </dl></div>
                                                                    </dd>
                                                                </dl></div>
                                                        </dd>
                                                    </dl></div>
                                            </dd>
                                         
                                            <dt><span class="term"><code class="code">AdditionalOptions</code></span></dt>
                                            <dd>
                                                <p>Pilihan tambahan untuk deployment biru/hijau.</p>
                                                <p><em>Wajib: </em>Tidak</p>
                                                <div class="variablelist">
                                                     
                                                <dl>
                                                        <dt><span class="term"><code class="code">TerminationWaitTimeInMinutes</code></span></dt>
                                                        <dd>
                                                            <p>Menentukan waktu tunggu, dalam hitungan menit, sebelum mengakhiri sumber daya biru.</p>
                                                            <p><em>Wajib: </em>Tidak</p>
                                                        </dd>
                                                    </dl></div>
                                            </dd>
                                         
                                            <dt><span class="term"><code class="code">LifecycleEventHooks</code></span></dt>
                                            <dd>
                                                <p>Gunakan kait peristiwa siklus hidup untuk menentukan fungsi Lambda yang  CodeDeploy  dapat memanggil untuk memvalidasi penerapan. Anda dapat menggunakan fungsi yang sama atau yang berbeda untuk peristiwa deployment siklus hidup. Setelah menyelesaikan tes validasi, fungsi  AfterAllowTraffic  Lambda memanggil  CodeDeploy  kembali dan memberikan hasil dari atau. <code class="code">Succeeded</code> <code class="code">Failed</code></p>
                                                <p>Untuk informasi selengkapnya, lihat <a href="https://docs.aws.amazon.com/codedeploy/latest/userguide/reference-appspec-file-structure-hooks.html">bagian AppSpec  'kait'</a> di <em>Panduan AWS CodeDeploy Pengguna</em>.</p>
                                                <p><em>Wajib: </em>Tidak</p>
                                                <div class="variablelist">
                                                     
                                                     
                                                     
                                                     
                                                     
                                                <dl>
                                                        <dt><span class="term"><code class="code">BeforeInstall</code></span></dt>
                                                        <dd>
                                                            <p>Fungsi yang digunakan untuk menjalankan tugas sebelum set tugas pengganti dibuat.</p>
                                                            <p><em>Wajib: </em>Tidak</p>
                                                        </dd>
                                                     
                                                        <dt><span class="term"><code class="code">AfterInstall</code></span></dt>
                                                        <dd>
                                                            <p>Fungsi yang digunakan untuk menjalankan tugas setelah set tugas pengganti dibuat dan salah satu grup target terkait dengan itu.</p>
                                                            <p><em>Wajib: </em>Tidak</p>
                                                        </dd>
                                                     
                                                        <dt><span class="term"><code class="code">AfterAllowTestTraffic</code></span></dt>
                                                        <dd>
                                                            <p>Fungsi yang diigunakan untuk menjalankan tugas setelah listener tes melayani lalu lintas ke set tugas pengganti.</p>
                                                            <p><em>Wajib: </em>Tidak</p>
                                                        </dd>
                                                     
                                                        <dt><span class="term"><code class="code">BeforeAllowTraffic</code></span></dt>
                                                        <dd>
                                                            <p>Fungsi yang digunakan untuk menjalankan tugas setelah grup target kedua dikaitkan dengan set tugas pengganti, tapi sebelum lalu lintas bergeser ke set tugas pengganti.</p>
                                                            <p><em>Wajib: </em>Tidak</p>
                                                        </dd>
                                                     
                                                        <dt><span class="term"><code class="code">AfterAllowTraffic</code></span></dt>
                                                        <dd>
                                                            <p>Fungsi yang digunakan untuk menjalankan tugas setelah grup target kedua melayani lalu lintas ke set tugas pengganti.</p>
                                                            <p><em>Wajib: </em>Tidak</p>
                                                        </dd>
                                                    </dl></div>
                                            </dd>
                                         
                                            <dt><span class="term"><code class="code">ServiceRole</code></span></dt>
                                            <dd>
                                                <p>Peran eksekusi untuk digunakan  CloudFormation  untuk melakukan penyebaran biru-hijau. Untuk daftar izin yang diperlukan, lihat<a href="#blue-green-iam">Izin IAM diperlukan untuk deployment biru/hijau</a>.</p>
                                                <p><em>Wajib: </em>Ya</p>
                                            </dd>
                                         
                                            <dt><span class="term"><code class="code">Applications</code></span></dt>
                                            <dd>
                                                <p>Menentukan properti aplikasi Amazon ECS.</p>
                                                <p><em>Wajib: </em>Ya</p>
                                                <div class="variablelist">
                                                     
                                                     
                                                <dl>
                                                        <dt><span class="term"><code class="code">Target</code></span></dt>
                                                        <dd>
                                                            <p></p>
                                                            <p><em>Wajib: </em>Ya</p>
                                                            <div class="variablelist">
                                                                 
                                                                 
                                                            <dl>
                                                                    <dt><span class="term"><code class="code">Type</code></span></dt>
                                                                    <dd>
                                                                        <p>Jenis sumber daya.</p>
                                                                        <p><em>Wajib: </em>Ya</p>
                                                                    </dd>
                                                                 
                                                                    <dt><span class="term"><code class="code">LogicalID</code></span></dt>
                                                                    <dd>
                                                                        <p>ID logis sumber daya.</p>
                                                                        <p><em>Wajib: </em>Ya</p>
                                                                    </dd>
                                                                </dl></div>
                                                        </dd>
                                                     
                                                        <dt><span class="term"><code class="code">ECSAttributes</code></span></dt>
                                                        <dd>
                                                            <p>Sumber daya yang mewakili berbagai persyaratan deployment aplikasi Amazon ECS Anda.</p>
                                                            <p><em>Wajib: </em>Ya</p>
                                                            <div class="variablelist">
                                                                 
                                                                 
                                                                 
                                                            <dl>
                                                                    <dt><span class="term"><code class="code">TaskDefinitions</code></span></dt>
                                                                    <dd>
                                                                        <p>ID logis  <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-resource-ecs-taskdefinition.html"><code class="code">AWS::ECS::TaskDefinition</code></a> sumber daya untuk menjalankan kontainer Docker yang berisi aplikasi Amazon ECS Anda.</p>
                                                                        <p><em>Wajib: </em>Ya</p>
                                                                    </dd>
                                                                 
                                                                    <dt><span class="term"><code class="code">TaskSets</code></span></dt>
                                                                    <dd>
                                                                        <p>ID logis <code class="code">AWS::ECS::TaskSet</code> sumber daya yang digunakan sebagai set tugas aplikasi.</p>
                                                                        <p><em>Wajib: </em>Ya</p>
                                                                    </dd>
                                                                 
                                                                    <dt><span class="term"><code class="code">TrafficRouting</code></span></dt>
                                                                    <dd>
                                                                        <p>Menentukan sumber daya yang digunakan untuk perutean lalu lintas.</p>
                                                                        <p><em>Wajib: </em>Ya</p>
                                                                        <div class="variablelist">
                                                                             
                                                                             
                                                                             
                                                                        <dl>
                                                                                <dt><span class="term"><code class="code">ProdTrafficRoute</code></span></dt>
                                                                                <dd>
                                                                                    <p>Listener yang akan digunakan oleh penyeimbangan beban Anda untuk mengarahkan lalu lintas ke grup target Anda.</p>
                                                                                    <p><em>Wajib: </em>Ya</p>
                                                                                    <div class="variablelist">
                                                                                         
                                                                                         
                                                                                    <dl>
                                                                                            <dt><span class="term"><code class="code">Type</code></span></dt>
                                                                                            <dd>
                                                                                                <p>Jenis sumber daya. <code class="code">AWS::ElasticLoadBalancingV2::Listener</code></p>
                                                                                                <p><em>Wajib: </em>Ya</p>
                                                                                            </dd>
                                                                                         
                                                                                            <dt><span class="term"><code class="code">LogicalID</code></span></dt>
                                                                                            <dd>
                                                                                                <p>ID logis sumber daya.</p>
                                                                                                <p><em>Wajib: </em>Ya</p>
                                                                                            </dd>
                                                                                        </dl></div>
                                                                                </dd>
                                                                             
                                                                                <dt><span class="term"><code class="code">TestTrafficRoute</code></span></dt>
                                                                                <dd>
                                                                                    <p>Listener yang akan digunakan oleh penyeimbangan beban Anda untuk mengarahkan lalu lintas ke grup target Anda.</p>
                                                                                    <p><em>Wajib: </em>Ya</p>
                                                                                    <div class="variablelist">
                                                                                         
                                                                                         
                                                                                    <dl>
                                                                                            <dt><span class="term"><code class="code">Type</code></span></dt>
                                                                                            <dd>
                                                                                                <p>Jenis sumber daya. <code class="code">AWS::ElasticLoadBalancingV2::Listener</code></p>
                                                                                                <p><em>Wajib: </em>Ya</p>
                                                                                            </dd>
                                                                                         
                                                                                            <dt><span class="term"><code class="code">LogicalID</code></span></dt>
                                                                                            <dd>
                                                                                                <p>ID logis sumber daya.</p>
                                                                                                <p><em>Wajib: </em>Tidak</p>
                                                                                            </dd>
                                                                                        </dl></div>
                                                                                </dd>
                                                                             
                                                                                <dt><span class="term"><code class="code">TargetGroups</code></span></dt>
                                                                                <dd>
                                                                                    <p>ID logis sumber daya yang digunakan sebagai grup target untuk merutekan lalu lintas ke target terdaftar.</p>
                                                                                    <p><em>Wajib: </em>Ya</p>
                                                                                </dd>
                                                                            </dl></div>
                                                                    </dd>
                                                                </dl></div>
                                                        </dd>
                                                    </dl></div>
                                            </dd>
                                        </dl></div>
                                </dd>
                            </dl></div>
                    </dd>
                    
                 
                    <dt><span class="term"><code class="code">Type</code></span></dt>
                    <dd>
                        <p>Jenis kait. <code class="code">AWS::ElasticLoadBalancingV2::Listener</code></p>
                        <p><em>Wajib: </em>Ya</p>
                    </dd>
                </dl></div>
         
     
        <h2 id="blue-green-iam">Izin IAM diperlukan untuk deployment biru/hijau</h2>
        <p>Agar berhasil  CloudFormation  melakukan penerapan biru-hijau, Anda harus memiliki izin berikut:  CodeDeploy </p>
        <div class="itemizedlist">
             
             
        <ul class="itemizedlist"><li class="listitem"><p><code class="code">codedeploy:Get*</code></p></li><li class="listitem"><p><code class="code">codedeploy:CreateCloudFormationDeployment</code></p></li></ul></div>
        <p>Untuk informasi selengkapnya, lihat <a href="https://docs.aws.amazon.com/IAM/latest/UserGuide/list_awscodedeploy.html">Tindakan, sumber daya, dan kunci kondisi untuk  CodeDeploy</a> dalam <em>AWS Panduan Pengguna Identity and Access Management</em>.</p>
     
        <h2 id="blue-green-template-example">Contoh templat</h2>
        <p>Contoh berikut mengatur penyebaran biru/hijau ECS CodeDeploy, dengan kemajuan perutean lalu lintas 15 persen per langkah, dengan periode stabilisasi 5 menit di antara setiap langkah. Membuat tumpukan dengan templat akan menyediakan konfigurasi awal deployment.</p>
        <p>Jika Anda kemudian membuat perubahan apa pun pada properti di <code class="code">"BlueTaskSet"</code> sumber daya yang mengharuskan sumber daya diganti, maka  CloudFormation  akan memulai penerapan hijau sebagai bagian dari pembaruan tumpukan.</p>
        <div id="JSON" name="JSON" class="section langfilter">
            <h3 id="blue-green-template-example.json">JSON</h3>
<pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Salinan"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
    "Parameters": <span>{</span>
        "Vpc": <span>{</span>
            "Type": "AWS::EC2::VPC::Id"
        },
        "Subnet1": <span>{</span>
            "Type": "AWS::EC2::Subnet::Id"
        },
        "Subnet2": <span>{</span>
            "Type": "AWS::EC2::Subnet::Id"
        }
    },
    "Transform": [
        "AWS::CodeDeployBlueGreen"
    ],
    "Hooks": <span>{</span>
        "CodeDeployBlueGreenHook": <span>{</span>
            "Properties": <span>{</span>
                "TrafficRoutingConfig": <span>{</span>
                    "Type": "TimeBasedCanary",
                    "TimeBasedCanary": <span>{</span>
                        "StepPercentage": 15,
                        "BakeTimeMins": 5
                    }
                },
                "Applications": [
                    <span>{</span>
                        "Target": <span>{</span>
                            "Type": "AWS::ECS::Service",
                            "LogicalID": "ECSDemoService"
                        },
                        "ECSAttributes": <span>{</span>
                            "TaskDefinitions": [
                                "BlueTaskDefinition",
                                "GreenTaskDefinition"
                            ],
                            "TaskSets": [
                                "BlueTaskSet",
                                "GreenTaskSet"
                            ],
                            "TrafficRouting": <span>{</span>
                                "ProdTrafficRoute": <span>{</span>
                                    "Type": "AWS::ElasticLoadBalancingV2::Listener",
                                    "LogicalID": "ALBListenerProdTraffic"
                                },
                                "TargetGroups": [
                                    "ALBTargetGroupBlue",
                                    "ALBTargetGroupGreen"
                                ]
                            }
                        }
                    }
                ]
            },
            "Type": "AWS::CodeDeploy::BlueGreen"
        }
    },
    "Resources": <span>{</span>
        "ExampleSecurityGroup": <span>{</span>
            "Type": "AWS::EC2::SecurityGroup",
            "Properties": <span>{</span>
                "GroupDescription": "Security group for ec2 access",
                "VpcId": <span>{</span>
                    "Ref": "Vpc"
                },
                "SecurityGroupIngress": [
                    <span>{</span>
                        "IpProtocol": "tcp",
                        "FromPort": 80,
                        "ToPort": 80,
                        "CidrIp": "0.0.0.0/0"
                    },
                    <span>{</span>
                        "IpProtocol": "tcp",
                        "FromPort": 8080,
                        "ToPort": 8080,
                        "CidrIp": "0.0.0.0/0"
                    },
                    <span>{</span>
                        "IpProtocol": "tcp",
                        "FromPort": 22,
                        "ToPort": 22,
                        "CidrIp": "0.0.0.0/0"
                    }
                ]
            }
        },
        "ALBTargetGroupBlue": <span>{</span>
            "Type": "AWS::ElasticLoadBalancingV2::TargetGroup",
            "Properties": <span>{</span>
                "HealthCheckIntervalSeconds": 5,
                "HealthCheckPath": "/",
                "HealthCheckPort": "80",
                "HealthCheckProtocol": "HTTP",
                "HealthCheckTimeoutSeconds": 2,
                "HealthyThresholdCount": 2,
                "Matcher": <span>{</span>
                    "HttpCode": "200"
                },
                "Port": 80,
                "Protocol": "HTTP",
                "Tags": [
                    <span>{</span>
                        "Key": "Group",
                        "Value": "Example"
                    }
                ],
                "TargetType": "ip",
                "UnhealthyThresholdCount": 4,
                "VpcId": <span>{</span>
                    "Ref": "Vpc"
                }
            }
        },
        "ALBTargetGroupGreen": <span>{</span>
            "Type": "AWS::ElasticLoadBalancingV2::TargetGroup",
            "Properties": <span>{</span>
                "HealthCheckIntervalSeconds": 5,
                "HealthCheckPath": "/",
                "HealthCheckPort": "80",
                "HealthCheckProtocol": "HTTP",
                "HealthCheckTimeoutSeconds": 2,
                "HealthyThresholdCount": 2,
                "Matcher": <span>{</span>
                    "HttpCode": "200"
                },
                "Port": 80,
                "Protocol": "HTTP",
                "Tags": [
                    <span>{</span>
                        "Key": "Group",
                        "Value": "Example"
                    }
                ],
                "TargetType": "ip",
                "UnhealthyThresholdCount": 4,
                "VpcId": <span>{</span>
                    "Ref": "Vpc"
                }
            }
        },
        "ExampleALB": <span>{</span>
            "Type": "AWS::ElasticLoadBalancingV2::LoadBalancer",
            "Properties": <span>{</span>
                "Scheme": "internet-facing",
                "SecurityGroups": [
                    <span>{</span>
                        "Ref": "ExampleSecurityGroup"
                    }
                ],
                "Subnets": [
                    <span>{</span>
                        "Ref": "Subnet1"
                    },
                    <span>{</span>
                        "Ref": "Subnet2"
                    }
                ],
                "Tags": [
                    <span>{</span>
                        "Key": "Group",
                        "Value": "Example"
                    }
                ],
                "Type": "application",
                "IpAddressType": "ipv4"
            }
        },
        "ALBListenerProdTraffic": <span>{</span>
            "Type": "AWS::ElasticLoadBalancingV2::Listener",
            "Properties": <span>{</span>
                "DefaultActions": [
                    <span>{</span>
                        "Type": "forward",
                        "ForwardConfig": <span>{</span>
                            "TargetGroups": [
                                <span>{</span>
                                    "TargetGroupArn": <span>{</span>
                                        "Ref": "ALBTargetGroupBlue"
                                    },
                                    "Weight": 1
                                }
                            ]
                        }
                    }
                ],
                "LoadBalancerArn": <span>{</span>
                    "Ref": "ExampleALB"
                },
                "Port": 80,
                "Protocol": "HTTP"
            }
        },
        "ALBListenerProdRule": <span>{</span>
            "Type": "AWS::ElasticLoadBalancingV2::ListenerRule",
            "Properties": <span>{</span>
                "Actions": [
                    <span>{</span>
                        "Type": "forward",
                        "ForwardConfig": <span>{</span>
                            "TargetGroups": [
                                <span>{</span>
                                    "TargetGroupArn": <span>{</span>
                                        "Ref": "ALBTargetGroupBlue"
                                    },
                                    "Weight": 1
                                }
                            ]
                        }
                    }
                ],
                "Conditions": [
                    <span>{</span>
                        "Field": "http-header",
                        "HttpHeaderConfig": <span>{</span>
                            "HttpHeaderName": "User-Agent",
                            "Values": [
                                "Mozilla"
                            ]
                        }
                    }
                ],
                "ListenerArn": <span>{</span>
                    "Ref": "ALBListenerProdTraffic"
                },
                "Priority": 1
            }
        },
        "ECSTaskExecutionRole": <span>{</span>
            "Type": "AWS::IAM::Role",
            "Properties": <span>{</span>
                "AssumeRolePolicyDocument": <span>{</span>
                    "Version": "2012-10-17",
                    "Statement": [
                        <span>{</span>
                            "Sid": "",
                            "Effect": "Allow",
                            "Principal": <span>{</span>
                                "Service": "ecs-tasks.amazonaws.com"
                            },
                            "Action": "sts:AssumeRole"
                        }
                    ]
                },
                "ManagedPolicyArns": [
                    "arn:aws:iam::aws:policy/service-role/AmazonECSTaskExecutionRolePolicy"
                ]
            }
        },
        "BlueTaskDefinition": <span>{</span>
            "Type": "AWS::ECS::TaskDefinition",
            "Properties": <span>{</span>
                "ExecutionRoleArn": <span>{</span>
                    "Fn::GetAtt": [
                        "ECSTaskExecutionRole",
                        "Arn"
                    ]
                },
                "ContainerDefinitions": [
                    <span>{</span>
                        "Name": "DemoApp",
                        "Image": "nginxdemos/hello:latest",
                        "Essential": true,
                        "PortMappings": [
                            <span>{</span>
                                "HostPort": 80,
                                "Protocol": "tcp",
                                "ContainerPort": 80
                            }
                        ]
                    }
                ],
                "RequiresCompatibilities": [
                    "FARGATE"
                ],
                "NetworkMode": "awsvpc",
                "Cpu": "256",
                "Memory": "512",
                "Family": "ecs-demo"
            }
        },
        "ECSDemoCluster": <span>{</span>
            "Type": "AWS::ECS::Cluster",
            "Properties": <span>{</span>}
        },
        "ECSDemoService": <span>{</span>
            "Type": "AWS::ECS::Service",
            "Properties": <span>{</span>
                "Cluster": <span>{</span>
                    "Ref": "ECSDemoCluster"
                },
                "DesiredCount": 1,
                "DeploymentController": <span>{</span>
                    "Type": "EXTERNAL"
                }
            }
        },
        "BlueTaskSet": <span>{</span>
            "Type": "AWS::ECS::TaskSet",
            "Properties": <span>{</span>
                "Cluster": <span>{</span>
                    "Ref": "ECSDemoCluster"
                },
                "LaunchType": "FARGATE",
                "NetworkConfiguration": <span>{</span>
                    "AwsVpcConfiguration": <span>{</span>
                        "AssignPublicIp": "ENABLED",
                        "SecurityGroups": [
                            <span>{</span>
                                "Ref": "ExampleSecurityGroup"
                            }
                        ],
                        "Subnets": [
                            <span>{</span>
                                "Ref": "Subnet1"
                            },
                            <span>{</span>
                                "Ref": "Subnet2"
                            }
                        ]
                    }
                },
                "PlatformVersion": "1.4.0",
                "Scale": <span>{</span>
                    "Unit": "PERCENT",
                    "Value": 100
                },
                "Service": <span>{</span>
                    "Ref": "ECSDemoService"
                },
                "TaskDefinition": <span>{</span>
                    "Ref": "BlueTaskDefinition"
                },
                "LoadBalancers": [
                    <span>{</span>
                        "ContainerName": "DemoApp",
                        "ContainerPort": 80,
                        "TargetGroupArn": <span>{</span>
                            "Ref": "ALBTargetGroupBlue"
                        }
                    }
                ]
            }
        },
        "PrimaryTaskSet": <span>{</span>
            "Type": "AWS::ECS::PrimaryTaskSet",
            "Properties": <span>{</span>
                "Cluster": <span>{</span>
                    "Ref": "ECSDemoCluster"
                },
                "Service": <span>{</span>
                    "Ref": "ECSDemoService"
                },
                "TaskSetId": <span>{</span>
                    "Fn::GetAtt": [
                        "BlueTaskSet",
                        "Id"
                    ]
                }
            }
        }
    }
}</code></pre>

        </div>
        <div id="YAML" name="YAML" class="section langfilter">
            <h3 id="blue-green-template-example.yaml">YAML</h3>
            <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Salinan"><awsui-icon name="copy"></awsui-icon></div></div><code class="yaml ">Parameters:
  Vpc:
    Type: 'AWS::EC2::VPC::Id'
  Subnet1:
    Type: 'AWS::EC2::Subnet::Id'
  Subnet2:
    Type: 'AWS::EC2::Subnet::Id'
Transform:
  - 'AWS::CodeDeployBlueGreen'
Hooks:
  CodeDeployBlueGreenHook:
    Properties:
      TrafficRoutingConfig:
        Type: TimeBasedCanary
        TimeBasedCanary:
          StepPercentage: 15
          BakeTimeMins: 5
      Applications:
        - Target:
            Type: 'AWS::ECS::Service'
            LogicalID: ECSDemoService
          ECSAttributes:
            TaskDefinitions:
              - BlueTaskDefinition
              - GreenTaskDefinition
            TaskSets:
              - BlueTaskSet
              - GreenTaskSet
            TrafficRouting:
              ProdTrafficRoute:
                Type: 'AWS::ElasticLoadBalancingV2::Listener'
                LogicalID: ALBListenerProdTraffic
              TargetGroups:
                - ALBTargetGroupBlue
                - ALBTargetGroupGreen
    Type: 'AWS::CodeDeploy::BlueGreen'
Resources:
  ExampleSecurityGroup:
    Type: 'AWS::EC2::SecurityGroup'
    Properties:
      GroupDescription: Security group for ec2 access
      VpcId: !Ref Vpc
      SecurityGroupIngress:
        - IpProtocol: tcp
          FromPort: 80
          ToPort: 80
          CidrIp: 0.0.0.0/0
        - IpProtocol: tcp
          FromPort: 8080
          ToPort: 8080
          CidrIp: 0.0.0.0/0
        - IpProtocol: tcp
          FromPort: 22
          ToPort: 22
          CidrIp: 0.0.0.0/0
  ALBTargetGroupBlue:
    Type: 'AWS::ElasticLoadBalancingV2::TargetGroup'
    Properties:
      HealthCheckIntervalSeconds: 5
      HealthCheckPath: /
      HealthCheckPort: '80'
      HealthCheckProtocol: HTTP
      HealthCheckTimeoutSeconds: 2
      HealthyThresholdCount: 2
      Matcher:
        HttpCode: '200'
      Port: 80
      Protocol: HTTP
      Tags:
        - Key: Group
          Value: Example
      TargetType: ip
      UnhealthyThresholdCount: 4
      VpcId: !Ref Vpc
  ALBTargetGroupGreen:
    Type: 'AWS::ElasticLoadBalancingV2::TargetGroup'
    Properties:
      HealthCheckIntervalSeconds: 5
      HealthCheckPath: /
      HealthCheckPort: '80'
      HealthCheckProtocol: HTTP
      HealthCheckTimeoutSeconds: 2
      HealthyThresholdCount: 2
      Matcher:
        HttpCode: '200'
      Port: 80
      Protocol: HTTP
      Tags:
        - Key: Group
          Value: Example
      TargetType: ip
      UnhealthyThresholdCount: 4
      VpcId: !Ref Vpc
  ExampleALB:
    Type: 'AWS::ElasticLoadBalancingV2::LoadBalancer'
    Properties:
      Scheme: internet-facing
      SecurityGroups:
        - !Ref ExampleSecurityGroup
      Subnets:
        - !Ref Subnet1
        - !Ref Subnet2
      Tags:
        - Key: Group
          Value: Example
      Type: application
      IpAddressType: ipv4
  ALBListenerProdTraffic:
    Type: 'AWS::ElasticLoadBalancingV2::Listener'
    Properties:
      DefaultActions:
        - Type: forward
          ForwardConfig:
            TargetGroups:
              - TargetGroupArn: !Ref ALBTargetGroupBlue
                Weight: 1
      LoadBalancerArn: !Ref ExampleALB
      Port: 80
      Protocol: HTTP
  ALBListenerProdRule:
    Type: 'AWS::ElasticLoadBalancingV2::ListenerRule'
    Properties:
      Actions:
        - Type: forward
          ForwardConfig:
            TargetGroups:
              - TargetGroupArn: !Ref ALBTargetGroupBlue
                Weight: 1
      Conditions:
        - Field: http-header
          HttpHeaderConfig:
            HttpHeaderName: User-Agent
            Values:
              - Mozilla
      ListenerArn: !Ref ALBListenerProdTraffic
      Priority: 1
  ECSTaskExecutionRole:
    Type: 'AWS::IAM::Role'
    Properties:
      AssumeRolePolicyDocument:
        Version: 2012-10-17
        Statement:
          - Sid: ''
            Effect: Allow
            Principal:
              Service: ecs-tasks.amazonaws.com
            Action: 'sts:AssumeRole'
      ManagedPolicyArns:
        - 'arn:aws:iam::aws:policy/service-role/AmazonECSTaskExecutionRolePolicy'
  BlueTaskDefinition:
    Type: 'AWS::ECS::TaskDefinition'
    Properties:
      ExecutionRoleArn: !GetAtt 
        - ECSTaskExecutionRole
        - Arn
      ContainerDefinitions:
        - Name: DemoApp
          Image: 'nginxdemos/hello:latest'
          Essential: true
          PortMappings:
            - HostPort: 80
              Protocol: tcp
              ContainerPort: 80
      RequiresCompatibilities:
        - FARGATE
      NetworkMode: awsvpc
      Cpu: '256'
      Memory: '512'
      Family: ecs-demo
  ECSDemoCluster:
    Type: 'AWS::ECS::Cluster'
    Properties: <span>{</span>}
  ECSDemoService:
    Type: 'AWS::ECS::Service'
    Properties:
      Cluster: !Ref ECSDemoCluster
      DesiredCount: 1
      DeploymentController:
        Type: EXTERNAL
  BlueTaskSet:
    Type: 'AWS::ECS::TaskSet'
    Properties:
      Cluster: !Ref ECSDemoCluster
      LaunchType: FARGATE
      NetworkConfiguration:
        AwsVpcConfiguration:
          AssignPublicIp: ENABLED
          SecurityGroups:
            - !Ref ExampleSecurityGroup
          Subnets:
            - !Ref Subnet1
            - !Ref Subnet2
      PlatformVersion: 1.4.0
      Scale:
        Unit: PERCENT
        Value: 100
      Service: !Ref ECSDemoService
      TaskDefinition: !Ref BlueTaskDefinition
      LoadBalancers:
        - ContainerName: DemoApp
          ContainerPort: 80
          TargetGroupArn: !Ref ALBTargetGroupBlue
  PrimaryTaskSet:
    Type: 'AWS::ECS::PrimaryTaskSet'
    Properties:
      Cluster: !Ref ECSDemoCluster
      Service: !Ref ECSDemoService
      TaskSetId: !GetAtt 
        - BlueTaskSet
        - Id</code></pre>
        </div>
    <awsdocs-copyright class="copyright-print"></awsdocs-copyright><awsdocs-thumb-feedback right-edge="{{$ctrl.thumbFeedbackRightEdge}}"></awsdocs-thumb-feedback></div><noscript><div><div><div><div id="js_error_message"><p><img src="https://d1ge0kk1l5kms0.cloudfront.net/images/G/01/webservices/console/warning.png" alt="Awas" /> <strong>Javascript dinonaktifkan atau tidak tersedia di browser Anda.</strong></p><p>Untuk menggunakan Dokumentasi AWS, Javascript harus diaktifkan. Lihat halaman Bantuan browser Anda untuk petunjuk.</p></div></div></div></div></noscript><div id="main-col-footer" class="awsui-util-font-size-0"><div id="doc-conventions"><a target="_top" href="/general/latest/gr/docconventions.html">Konvensi Dokumen</a></div><div class="prev-next"><div id="previous" class="prev-link" accesskey="p" href="./modules.html">Menggunakan modul</div><div id="next" class="next-link" accesskey="n" href="./cfn-regexes.html">Menggunakan ekspresi reguler</div></div></div><awsdocs-page-utilities></awsdocs-page-utilities></div><div id="quick-feedback-yes" style="display: none;"><div class="title">Apakah halaman ini membantu Anda? - Ya</div><div class="content"><p>Terima kasih telah memberitahukan bahwa hasil pekerjaan kami sudah baik.</p><p>Jika Anda memiliki waktu luang, beri tahu kami aspek apa saja yang sudah bagus, agar kami dapat menerapkannya secara lebih luas.</p><p><awsui-button id="fblink" rel="noopener noreferrer" target="_blank" text="Umpan Balik" click="linkClick($event)" href="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=CloudFormation&amp;topic_url=https://docs.aws.amazon.com/id_id/AWSCloudFormation/latest/UserGuide/blue-green.html"></awsui-button></p></div></div><div id="quick-feedback-no" style="display: none;"><div class="title">Apakah halaman ini membantu Anda? - Tidak</div><div class="content"><p>Terima kasih telah memberi tahu kami bahwa halaman ini perlu ditingkatkan. Maaf karena telah mengecewakan Anda.</p><p>Jika Anda memiliki waktu luang, beri tahu kami bagaimana dokumentasi ini dapat ditingkatkan.</p><p><awsui-button id="fblink" rel="noopener noreferrer" target="_blank" text="Umpan Balik" click="linkClick($event)" href="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=CloudFormation&amp;topic_url=https://docs.aws.amazon.com/id_id/AWSCloudFormation/latest/UserGuide/blue-green.html"></awsui-button></p></div></div></div></body></div></awsdocs-view><div class="page-loading-indicator" id="page-loading-indicator"><awsui-spinner size="large"></awsui-spinner></div></div><div id="tools-panel" dom-region="tools"><awsdocs-tools-panel id="awsdocs-tools-panel"></awsdocs-tools-panel></div></awsui-app-layout><awsdocs-cookie-banner class="doc-cookie-banner"></awsdocs-cookie-banner></div></body></html>