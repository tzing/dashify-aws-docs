<!DOCTYPE html>
    <html xmlns="http://www.w3.org/1999/xhtml" lang="fr-FR"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Exemples de commandes COPY - Amazon Redshift</title><meta name="viewport" content="width=device-width,initial-scale=1" /><meta name="assets_root" content="/assets" /><meta name="target_state" content="r_COPY_command_examples" /><meta name="default_state" content="r_COPY_command_examples" /><link rel="icon" type="image/ico" href="/assets/images/favicon.ico" /><link rel="shortcut icon" type="image/ico" href="/assets/images/favicon.ico" /><link rel="canonical" href="https://docs.aws.amazon.com/fr_fr/redshift/latest/dg/r_COPY_command_examples.html" /><meta name="description" content="Fournit des exemples d’utilisation de la commande COPY pour charger les données issues de différentes sources." /><meta name="deployment_region" content="IAD" /><meta name="product" content="Amazon Redshift" /><meta name="guide" content="Guide du développeur de base de données" /><meta name="abstract" content="Créez et gérez un entrepôt de données avec Amazon Redshift, service d’entrepôt de données au niveau de l’entreprise, pouvant atteindre plusieurs Po et entièrement géré." /><meta name="guide-locale" content="fr_fr" /><meta name="tocs" content="toc-contents.json" /><link rel="canonical" href="https://docs.aws.amazon.com/fr_fr/redshift/latest/dg/r_COPY_command_examples.html" /><link rel="alternative" href="https://docs.aws.amazon.com/id_id/redshift/latest/dg/r_COPY_command_examples.html" hreflang="id-id" /><link rel="alternative" href="https://docs.aws.amazon.com/id_id/redshift/latest/dg/r_COPY_command_examples.html" hreflang="id" /><link rel="alternative" href="https://docs.aws.amazon.com/de_de/redshift/latest/dg/r_COPY_command_examples.html" hreflang="de-de" /><link rel="alternative" href="https://docs.aws.amazon.com/de_de/redshift/latest/dg/r_COPY_command_examples.html" hreflang="de" /><link rel="alternative" href="https://docs.aws.amazon.com/redshift/latest/dg/r_COPY_command_examples.html" hreflang="en-us" /><link rel="alternative" href="https://docs.aws.amazon.com/redshift/latest/dg/r_COPY_command_examples.html" hreflang="en" /><link rel="alternative" href="https://docs.aws.amazon.com/es_es/redshift/latest/dg/r_COPY_command_examples.html" hreflang="es-es" /><link rel="alternative" href="https://docs.aws.amazon.com/es_es/redshift/latest/dg/r_COPY_command_examples.html" hreflang="es" /><link rel="alternative" href="https://docs.aws.amazon.com/fr_fr/redshift/latest/dg/r_COPY_command_examples.html" hreflang="fr-fr" /><link rel="alternative" href="https://docs.aws.amazon.com/fr_fr/redshift/latest/dg/r_COPY_command_examples.html" hreflang="fr" /><link rel="alternative" href="https://docs.aws.amazon.com/it_it/redshift/latest/dg/r_COPY_command_examples.html" hreflang="it-it" /><link rel="alternative" href="https://docs.aws.amazon.com/it_it/redshift/latest/dg/r_COPY_command_examples.html" hreflang="it" /><link rel="alternative" href="https://docs.aws.amazon.com/ja_jp/redshift/latest/dg/r_COPY_command_examples.html" hreflang="ja-jp" /><link rel="alternative" href="https://docs.aws.amazon.com/ja_jp/redshift/latest/dg/r_COPY_command_examples.html" hreflang="ja" /><link rel="alternative" href="https://docs.aws.amazon.com/ko_kr/redshift/latest/dg/r_COPY_command_examples.html" hreflang="ko-kr" /><link rel="alternative" href="https://docs.aws.amazon.com/ko_kr/redshift/latest/dg/r_COPY_command_examples.html" hreflang="ko" /><link rel="alternative" href="https://docs.aws.amazon.com/pt_br/redshift/latest/dg/r_COPY_command_examples.html" hreflang="pt-br" /><link rel="alternative" href="https://docs.aws.amazon.com/pt_br/redshift/latest/dg/r_COPY_command_examples.html" hreflang="pt" /><link rel="alternative" href="https://docs.aws.amazon.com/zh_cn/redshift/latest/dg/r_COPY_command_examples.html" hreflang="zh-cn" /><link rel="alternative" href="https://docs.aws.amazon.com/zh_tw/redshift/latest/dg/r_COPY_command_examples.html" hreflang="zh-tw" /><link rel="alternative" href="https://docs.aws.amazon.com/redshift/latest/dg/r_COPY_command_examples.html" hreflang="x-default" /><meta name="feedback-item" content="Redshift" /><meta name="this_doc_product" content="Amazon Redshift" /><meta name="this_doc_guide" content="Guide du développeur de base de données" /><script defer="" src="/assets/r/vendor4.js?version=2021.12.02"></script><script defer="" src="/assets/r/vendor3.js?version=2021.12.02"></script><script defer="" src="/assets/r/vendor1.js?version=2021.12.02"></script><script defer="" src="/assets/r/awsdocs-common.js?version=2021.12.02"></script><script defer="" src="/assets/r/awsdocs-doc-page.js?version=2021.12.02"></script><link href="/assets/r/vendor4.css?version=2021.12.02" rel="stylesheet" /><link href="/assets/r/awsdocs-common.css?version=2021.12.02" rel="stylesheet" /><link href="/assets/r/awsdocs-doc-page.css?version=2021.12.02" rel="stylesheet" /><script async="" id="awsc-panorama-bundle" type="text/javascript" src="https://prod.pa.cdn.uis.awsstatic.com/panorama-nav-init.js" data-config="{'appEntity':'aws-documentation','region':'us-east-1','service':'redshift'}"></script><meta id="panorama-serviceSubSection" value="Guide du développeur de base de données" /><meta id="panorama-serviceConsolePage" value="Exemples de commandes COPY" /></head><body class="awsdocs awsui"><div class="awsdocs-container"><awsdocs-header></awsdocs-header><awsui-app-layout id="app-layout" class="awsui-util-no-gutters" ng-controller="ContentController as $ctrl" header-selector="awsdocs-header" navigation-hide="false" navigation-width="$ctrl.navWidth" navigation-open="$ctrl.navOpen" navigation-change="$ctrl.onNavChange($event)" tools-hide="$ctrl.hideTools" tools-width="$ctrl.toolsWidth" tools-open="$ctrl.toolsOpen" tools-change="$ctrl.onToolsChange($event)"><div id="guide-toc" dom-region="navigation"><awsdocs-toc></awsdocs-toc></div><div id="main-column" dom-region="content" tabindex="-1"><awsdocs-view class="awsdocs-view"><div id="awsdocs-content"><head><title>Exemples de commandes COPY - Amazon Redshift</title><meta name="pdf" content="redshift-dg.pdf#r_COPY_command_examples" /><meta name="rss" content="Dochistory.rss" /><meta name="forums" content="http://forums.aws.amazon.com/forum.jspa?forumID=155" /><meta name="feedback" content="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=Redshift&amp;topic_url=https://docs.aws.amazon.com/fr_fr/redshift/latest/dg/r_COPY_command_examples.html" /><meta name="feedback-yes" content="feedbackyes.html?topic_url=https://docs.aws.amazon.com/fr_fr/redshift/latest/dg/r_COPY_command_examples.html" /><meta name="feedback-no" content="feedbackno.html?topic_url=https://docs.aws.amazon.com/fr_fr/redshift/latest/dg/r_COPY_command_examples.html" /><meta name="keywords" content="Amazon Redshift,AWS Redshift,Redshift,Redshift Spectrum,cluster,entrepôt de données,développeur,exemples de données,database,développeur de base de données,HLL" /><script type="application/ld+json">
{
    "@context" : "https://schema.org",
    "@type" : "BreadcrumbList",
    "itemListElement" : [
      {
        "@type" : "ListItem",
        "position" : 1,
        "name" : "AWS",
        "item" : "https://aws.amazon.com"
      },
      {
        "@type" : "ListItem",
        "position" : 2,
        "name" : "Amazon Redshift",
        "item" : "https://docs.aws.amazon.com/redshift/index.html"
      },
      {
        "@type" : "ListItem",
        "position" : 3,
        "name" : "Guide du développeur de base de données",
        "item" : "https://docs.aws.amazon.com/fr_fr/redshift/latest/dg"
      },
      {
        "@type" : "ListItem",
        "position" : 4,
        "name" : "Référence SQL",
        "item" : "https://docs.aws.amazon.com/fr_fr/redshift/latest/dg/cm_chap_SQLCommandRef.html"
      },
      {
        "@type" : "ListItem",
        "position" : 5,
        "name" : "Commandes SQL",
        "item" : "https://docs.aws.amazon.com/fr_fr/redshift/latest/dg/c_SQL_commands.html"
      },
      {
        "@type" : "ListItem",
        "position" : 6,
        "name" : "COPY",
        "item" : "https://docs.aws.amazon.com/fr_fr/redshift/latest/dg/r_COPY.html"
      },
      {
        "@type" : "ListItem",
        "position" : 7,
        "name" : "Exemples de commandes COPY",
        "item" : "https://docs.aws.amazon.com/fr_fr/redshift/latest/dg/r_COPY.html"
      }
    ]
}
</script></head><body><div id="main"><div style="display: none"><a href="redshift-dg.pdf#r_COPY_command_examples" target="_blank" rel="noopener noreferrer" title="Ouvrir le PDF"></a></div><div id="breadcrumbs" class="breadcrumb"><a href="https://aws.amazon.com">AWS</a><a href="/index.html">Documentation</a><a href="/redshift/index.html">Amazon Redshift</a><a href="welcome.html">Guide du développeur de base de données</a></div><div id="page-toc-src"><a href="#r_COPY_command_examples-load-favoritemovies-from-an-amazon-dynamodb-table">Charger FAVORITEMOVIES depuis une table DynamoDB</a><a href="#r_COPY_command_examples-load-listing-from-an-amazon-s3-bucket">Charger la table LISTING depuis un compartiment Amazon S3</a><a href="#copy-command-examples-emr">Charger la table LISTING depuis un cluster Amazon EMR</a><a href="#copy-command-examples-manifest">Utilisation d’un manifeste pour spécifier les fichiers de données</a><a href="#r_COPY_command_examples-load-listing-from-a-pipe-delimited-file-default-delimiter">Charger la table LISTING à partir d’un fichier séparés par une barre verticale (délimiteur par défaut)</a><a href="#r_COPY_command_examples-load-listing-from-parquet">Charger LISTING en utilisant des données en colonnes en format Parquet</a><a href="#r_COPY_command_examples-load-listing-from-orc">Chargement du LISTING à l’aide de données en colonnes au format ORC</a><a href="#r_COPY_command_examples-load-event-with-options">Charger la table EVENT avec des options</a><a href="#r_COPY_command_examples-load-venue-from-a-fixed-width-data-file">Charger la table VENUE à partir d’un fichier de données de largeur fixe</a><a href="#load-from-csv">Charger la table CATEGORY à partir d’un fichier CSV</a><a href="#r_COPY_command_examples-load-venue-with-explicit-values-for-an-identity-column">Charger la table VENUE avec des valeurs EXPLICIT pour une colonne IDENTITY</a><a href="#r_COPY_command_examples-load-time-from-a-pipe-delimited-gzip-file">Charger la table TIME à partir d’un fichier GZIP séparé par une barre verticale</a><a href="#r_COPY_command_examples-load-a-time-datestamp">Charger un horodatage ou une datation</a><a href="#r_COPY_command_examples-load-data-from-a-file-with-default-values">Charger les données d’un fichier avec des valeurs par défaut</a><a href="#r_COPY_command_examples-copy-data-with-the-escape-option">Exécuter la commande COPY des données avec l’option ESCAPE</a><a href="#r_COPY_command_examples-copy-from-json">Copier à partir d’exemples JSON</a><a href="#r_COPY_command_examples-copy-from-avro">Copier depuis des exemples Avro</a><a href="#r_COPY_preparing_data">Préparation de fichiers pour la commande COPY avec l’option ESCAPE</a><a href="#copy-example-spatial-copy-shapefile">Chargement d’un shapefile</a><a href="#r_COPY_command_examples-load-noload-option">Commande COPY avec l’option NOLOAD</a></div><div id="main-content" class="awsui-util-container"><div id="main-col-body"><awsdocs-language-banner data-service="$ctrl.pageService"></awsdocs-language-banner><awsui-alert class="awsdocs-page-banner awsui-util-mb-l"><p>Les traductions sont fournies par des outils de traduction automatique. En cas de conflit entre le contenu d'une traduction et celui de la version originale en anglais, la version anglaise prévaudra.</p></awsui-alert><h1 class="topictitle" id="r_COPY_command_examples">Exemples de commandes COPY</h1><div class="awsdocs-page-header-container"><awsdocs-page-header></awsdocs-page-header><awsdocs-filter-selector id="awsdocs-filter-selector"></awsdocs-filter-selector></div><div class="awsdocs-note"><div class="awsdocs-note-title"><awsui-icon name="status-info" variant="link"></awsui-icon><h6>Note</h6></div><div class="awsdocs-note-text"><p>Ces exemples contiennent des sauts de ligne pour faciliter la lecture. N’incluez pas de sauts de ligne, ni d’espaces dans votre chaîne <em>credentials-args</em>.</p></div></div><div class="highlights" id="inline-topiclist"><h6>Rubriques</h6><ul><li><a href="#r_COPY_command_examples-load-favoritemovies-from-an-amazon-dynamodb-table">Charger FAVORITEMOVIES depuis une table DynamoDB</a></li><li><a href="#r_COPY_command_examples-load-listing-from-an-amazon-s3-bucket">Charger la table LISTING depuis un compartiment Amazon S3</a></li><li><a href="#copy-command-examples-emr">Charger la table LISTING depuis un cluster Amazon EMR</a></li><li><a href="#copy-command-examples-manifest">Utilisation d’un manifeste pour spécifier les fichiers de données</a></li><li><a href="#r_COPY_command_examples-load-listing-from-a-pipe-delimited-file-default-delimiter">Charger la table LISTING à partir d’un fichier séparés par une barre verticale (délimiteur par défaut)</a></li><li><a href="#r_COPY_command_examples-load-listing-from-parquet">Charger LISTING en utilisant des données en colonnes en format Parquet</a></li><li><a href="#r_COPY_command_examples-load-listing-from-orc">Chargement du LISTING à l’aide de données en colonnes au format ORC</a></li><li><a href="#r_COPY_command_examples-load-event-with-options">Charger la table EVENT avec des options</a></li><li><a href="#r_COPY_command_examples-load-venue-from-a-fixed-width-data-file">Charger la table VENUE à partir d’un fichier de données de largeur fixe</a></li><li><a href="#load-from-csv">Charger la table CATEGORY à partir d’un fichier CSV</a></li><li><a href="#r_COPY_command_examples-load-venue-with-explicit-values-for-an-identity-column">Charger la table VENUE avec des valeurs EXPLICIT pour une colonne IDENTITY</a></li><li><a href="#r_COPY_command_examples-load-time-from-a-pipe-delimited-gzip-file">Charger la table TIME à partir d’un fichier GZIP séparé par une barre verticale</a></li><li><a href="#r_COPY_command_examples-load-a-time-datestamp">Charger un horodatage ou une datation</a></li><li><a href="#r_COPY_command_examples-load-data-from-a-file-with-default-values">Charger les données d’un fichier avec des valeurs par défaut</a></li><li><a href="#r_COPY_command_examples-copy-data-with-the-escape-option">Exécuter la commande COPY des données avec l’option ESCAPE</a></li><li><a href="#r_COPY_command_examples-copy-from-json">Copier à partir d’exemples JSON</a></li><li><a href="#r_COPY_command_examples-copy-from-avro">Copier depuis des exemples Avro</a></li><li><a href="#r_COPY_preparing_data">Préparation de fichiers pour la commande COPY avec l’option ESCAPE</a></li><li><a href="#copy-example-spatial-copy-shapefile">Chargement d’un shapefile dans Amazon Redshift</a></li><li><a href="#r_COPY_command_examples-load-noload-option">Commande COPY avec l’option NOLOAD</a></li></ul></div>
         <h2 id="r_COPY_command_examples-load-favoritemovies-from-an-amazon-dynamodb-table">Charger FAVORITEMOVIES depuis une table DynamoDB</h2>


         <p>Les kits SDK AWS contiennent un exemple simple de création d’une table DynamoDB appelée <em>Movies</em>. (Pour cet exemple, consultez <a href="https://docs.aws.amazon.com/amazondynamodb/latest/developerguide/GettingStarted.html">Mise en route avec DynamoDB</a>.) L’exemple suivant charge la table Amazon Redshift MOVIES avec les données provenant de la table DynamoDB. La table Amazon Redshift doit déjà exister dans la base de données.</p>
         <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Texte"><awsui-icon name="copy"></awsui-icon></div></div><code class="">copy favoritemovies from 'dynamodb://Movies'
iam_role 'arn:aws:iam::0123456789012:role/MyRedshiftRole' 
readratio 50;</code></pre>
       
         <h2 id="r_COPY_command_examples-load-listing-from-an-amazon-s3-bucket">Charger la table LISTING depuis un compartiment Amazon S3</h2>


         <p>L’exemple suivant charge la table LISTING depuis un compartiment Amazon S3. La commande COPY charge tous les fichiers dans le dossier <code class="code">/data/listing/</code>.</p>
         <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Texte"><awsui-icon name="copy"></awsui-icon></div></div><code class="">copy listing
from 's3://mybucket/data/listing/' 
iam_role 'arn:aws:iam::0123456789012:role/MyRedshiftRole';</code></pre>
       
         <h2 id="copy-command-examples-emr">Charger la table LISTING depuis un cluster Amazon EMR</h2>

         <p>L’exemple suivant charge la table SALES avec les données délimités par des tabulations des fichiers compressés lzop dans un cluster Amazon EMR. La commande COPY charge tous les fichiers du dossier <code class="code">myoutput/</code> qui commencent par <code class="code">part-</code>.</p>
         <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Texte"><awsui-icon name="copy"></awsui-icon></div></div><code class="">copy sales
from 'emr://j-SAMPLE2B500FC/myoutput/part-*' 
iam_role 'arn:aws:iam::0123456789012:role/MyRedshiftRole'
delimiter '\t' lzop;</code></pre>
         <p>L’exemple suivant charge la table SALES avec des données au format JSON dans un cluster Amazon EMR. La commande COPY charge tous les fichiers du dossier <code class="code">myoutput/json/</code>.</p>
         <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Texte"><awsui-icon name="copy"></awsui-icon></div></div><code class="">copy sales
from 'emr://j-SAMPLE2B500FC/myoutput/json/' 
iam_role 'arn:aws:iam::0123456789012:role/MyRedshiftRole'
JSON 's3://mybucket/jsonpaths.txt';</code></pre>
       
         <h2 id="copy-command-examples-manifest">Utilisation d’un manifeste pour spécifier les fichiers de données</h2>

         <p>Vous pouvez utiliser un manifeste pour vous assurer que votre commande COPY charge tous les fichiers requis et uniquement les fichiers requis, à partir d’Amazon S3. Vous pouvez également utiliser un manifeste lorsque vous avez besoin de charger plusieurs fichiers de différents compartiments ou des fichiers qui ne partagent pas le même préfixe. </p>
         <p>Par exemple, supposons que vous devez charger les trois fichiers suivants : <code class="code">custdata1.txt</code>, <code class="code">custdata2.txt</code> et <code class="code">custdata3.txt</code>. Vous pouvez utiliser la commande suivante pour charger tous les fichiers qui commencent par <code class="code">mybucket</code> dans <code class="code">custdata</code> en spécifiant un préfixe : </p>
         <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Texte"><awsui-icon name="copy"></awsui-icon></div></div><code class="">copy category
from 's3://mybucket/custdata' 
iam_role 'arn:aws:iam::0123456789012:role/MyRedshiftRole';</code></pre>
         <p>S’il n’existe que deux des fichiers en raison d’une erreur, la commande COPY charge uniquement ces deux fichiers et se termine correctement, ce qui entraîne une charge de données incomplète. Si le compartiment contient également un fichier indésirable qui utilise le même préfixe, par exemple, un fichier nommé <code class="code">custdata.backup</code>, la commande COPY charge ce fichier également, ce qui entraîne le chargement de données indésirables.</p>
         <p>Pour vous assurer que tous les fichiers nécessaires sont chargés et pour empêcher que des fichiers indésirables soient chargés, vous pouvez utiliser un fichier manifeste. Le manifeste est un fichier texte au format JSON qui répertorie les fichiers à traiter par la commande COPY. Par exemple, le manifeste suivant charge les trois fichiers dans l’exemple précédent.</p>
         <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Texte"><awsui-icon name="copy"></awsui-icon></div></div><code class=""><span>{</span>  
   "entries":[  
      <span>{</span>  
         "url":"s3://mybucket/custdata.1",
         "mandatory":true
      },
      <span>{</span>  
         "url":"s3://mybucket/custdata.2",
         "mandatory":true
      },
      <span>{</span>  
         "url":"s3://mybucket/custdata.3",
         "mandatory":true
      }
   ]
}</code></pre>
         <p>L’indicateur <code class="code">mandatory</code> facultatif indique si la commande COPY doit s’arrêter si le fichier n’existe pas. La valeur par défaut est <code class="code">false</code>. Quels que soient les paramètres obligatoires, la commande COPY s’arrête si aucun fichier n’est trouvé. Dans cet exemple, la commande COPY renvoie une erreur si l’un des fichiers est introuvable. Les fichiers indésirables qui peuvent avoir été collectés si vous avez spécifié uniquement un préfixe de clé, comme <code class="code">custdata.backup</code>, sont ignorés, car ils ne sont pas sur le manifeste. </p>
         <p>Lors du chargement des fichiers de données au format ORC or Parquet, le champ <code class="code">meta</code> est obligatoire, comme illustré dans l’exemple suivant.</p>
         <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Texte"><awsui-icon name="copy"></awsui-icon></div></div><code class=""><span>{</span>  
   "entries":[  
      <span>{</span>  
         "url":"s3://mybucket-alpha/orc/2013-10-04-custdata",
         "mandatory":true,
         "meta":<span>{</span>  
            "content_length":99
         }
      },
      <span>{</span>  
         "url":"s3://mybucket-beta/orc/2013-10-05-custdata",
         "mandatory":true,
         "meta":<span>{</span>  
            "content_length":99
         }
      }
   ]
}</code></pre>
         <p>L’exemple suivant utilise un manifeste nommé <code class="code">cust.manifest</code>. </p>
         <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Texte"><awsui-icon name="copy"></awsui-icon></div></div><code class="">copy customer
from 's3://mybucket/cust.manifest' 
iam_role 'arn:aws:iam::0123456789012:role/MyRedshiftRole'
format as orc
manifest;</code></pre>
         <p>Vous pouvez utiliser un manifeste pour charger les fichiers de différents compartiments ou les fichiers qui ne partagent pas le même préfixe. L’exemple suivant illustre le format JSON permettant de charger des données avec des fichiers dont les noms commencent par un horodatage.</p>
         <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Texte"><awsui-icon name="copy"></awsui-icon></div></div><code class=""><span>{</span>
  "entries": [
    <span>{</span>"url":"s3://mybucket/2013-10-04-custdata.txt","mandatory":true},
    <span>{</span>"url":"s3://mybucket/2013-10-05-custdata.txt","mandatory":true},
    <span>{</span>"url":"s3://mybucket/2013-10-06-custdata.txt","mandatory":true},
    <span>{</span>"url":"s3://mybucket/2013-10-07-custdata.txt","mandatory":true}
  ]
}</code></pre>
         <p>Le manifeste peut afficher les fichiers qui sont dans des compartiments différents, pour autant que les compartiments sont dans la même région AWS que le cluster. </p>
         <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Texte"><awsui-icon name="copy"></awsui-icon></div></div><code class=""><span>{</span>
  "entries": [
    <span>{</span>"url":"s3://mybucket-alpha/custdata1.txt","mandatory":false},
    <span>{</span>"url":"s3://mybucket-beta/custdata1.txt","mandatory":false},
    <span>{</span>"url":"s3://mybucket-beta/custdata2.txt","mandatory":false}
  ]
}</code></pre>
       
         <h2 id="r_COPY_command_examples-load-listing-from-a-pipe-delimited-file-default-delimiter">Charger la table LISTING à partir d’un fichier séparés par une barre verticale (délimiteur par défaut)</h2>


         <p>L’exemple suivant est un cas très simple dans lequel aucune option n’est spécifiée et le fichier d’entrée contient le délimiteur par défaut, une barre verticale (’|’). </p>
         <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Texte"><awsui-icon name="copy"></awsui-icon></div></div><code class="">copy listing 
from 's3://mybucket/data/listings_pipe.txt' 
iam_role 'arn:aws:iam::0123456789012:role/MyRedshiftRole';</code></pre>
       
         <h2 id="r_COPY_command_examples-load-listing-from-parquet">Charger LISTING en utilisant des données en colonnes en format Parquet</h2>
         <p>L’exemple suivant charge des données depuis un dossier sur Amazon S3 nommé parquet. </p>
         <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Texte"><awsui-icon name="copy"></awsui-icon></div></div><code class="">copy listing 
from 's3://mybucket/data/listings/parquet/' 
iam_role 'arn:aws:iam::0123456789012:role/MyRedshiftRole'
format as parquet;</code></pre>
       
         <h2 id="r_COPY_command_examples-load-listing-from-orc">Chargement du LISTING à l’aide de données en colonnes au format ORC</h2>
         <p>L’exemple suivant charge des données depuis un dossier sur Amazon S3 nommé <code class="code">orc</code>. </p>
         <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Texte"><awsui-icon name="copy"></awsui-icon></div></div><code class="">copy listing 
from 's3://mybucket/data/listings/orc/' 
iam_role 'arn:aws:iam::0123456789012:role/MyRedshiftRole'
format as orc;</code></pre>
       
         <h2 id="r_COPY_command_examples-load-event-with-options">Charger la table EVENT avec des options</h2>


         <p>L’exemple suivant charge des données séparées par une barre verticale dans la table EVENT et applique les règles suivantes : </p>
         <div class="itemizedlist">
             
             
             
             
         <ul class="itemizedlist"><li class="listitem">
               <p>Si des paires de guillemets anglais sont utilisées pour entourer des chaînes de caractères, elles sont supprimées.</p>
            </li><li class="listitem">
               <p>Les chaînes vides et les chaînes qui contiennent des espaces vides sont chargées en tant que valeurs NULL.</p>
            </li><li class="listitem">
               <p>La charge échoue si plus de 5 erreurs sont renvoyées.</p>
            </li><li class="listitem">
               <p>Les valeurs d’horodatage doivent être conformes au format spécifié ; par exemple, un horodatage valide est <code class="code">2008-09-26 05:43:12</code>.</p>
            </li></ul></div>
         <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Texte"><awsui-icon name="copy"></awsui-icon></div></div><code class="">copy event
from 's3://mybucket/data/allevents_pipe.txt' 
iam_role 'arn:aws:iam::0123456789012:role/MyRedshiftRole' 
removequotes
emptyasnull
blanksasnull
maxerror 5
delimiter '|'
timeformat 'YYYY-MM-DD HH:MI:SS';</code></pre>
       
         <h2 id="r_COPY_command_examples-load-venue-from-a-fixed-width-data-file">Charger la table VENUE à partir d’un fichier de données de largeur fixe</h2>


         <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Texte"><awsui-icon name="copy"></awsui-icon></div></div><code class="">copy venue
from 's3://mybucket/data/venue_fw.txt' 
iam_role 'arn:aws:iam::0123456789012:role/MyRedshiftRole'
fixedwidth 'venueid:3,venuename:25,venuecity:12,venuestate:2,venueseats:6';</code></pre>
         <p>L’exemple précédent suppose un fichier de données au format identique à celui des exemples de données affichés. Dans le prochain exemple, les espaces se comportent comme des espaces réservés afin que toutes les colonnes soient de la même largeur, tel qu’indiqué dans la spécification : </p>
         <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Texte"><awsui-icon name="copy"></awsui-icon></div></div><code class="">1  Toyota Park              Bridgeview  IL0
2  Columbus Crew Stadium    Columbus    OH0
3  RFK Stadium              Washington  DC0
4  CommunityAmerica BallparkKansas City KS0
5  Gillette Stadium         Foxborough  MA68756</code></pre>
       
         <h2 id="load-from-csv">Charger la table CATEGORY à partir d’un fichier CSV</h2>

         <p>Supposons que vous voulez charger la table CATEGORY avec les valeurs indiquées dans le tableau suivant.</p>
         <div class="table-container"><div class="table-contents"><table id="w319aac47b9c67c31c25b5"><thead>
                  <tr>
                     <th>catid</th>
                     <th>catgroup</th>
                     <th>catName</th>
                     <th>catdesc </th>
                  </tr>
               </thead>
                  <tr>
                     <td tabindex="-1">12</td>
                     <td tabindex="-1">Shows </td>
                     <td tabindex="-1">Musicals</td>
                     <td tabindex="-1">Musical theatre</td>
                  </tr>
                  <tr>
                     <td tabindex="-1">13</td>
                     <td tabindex="-1">Shows</td>
                     <td tabindex="-1">Plays</td>
                     <td tabindex="-1">All "non-musical" theatre</td>
                  </tr>
                  <tr>
                     <td tabindex="-1">14</td>
                     <td tabindex="-1">Shows</td>
                     <td tabindex="-1">Opera</td>
                     <td tabindex="-1">All opera, light, and "rock" opera</td>
                  </tr>
                  <tr>
                     <td tabindex="-1">15</td>
                     <td tabindex="-1">Concerts</td>
                     <td tabindex="-1">Classical </td>
                     <td tabindex="-1">All symphony, concerto, and choir concerts</td>
                  </tr>

               </table></div></div>
         <p>L’exemple suivant montre le contenu d’un fichier texte avec les champs de valeurs séparés par des virgules.</p>
         <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Texte"><awsui-icon name="copy"></awsui-icon></div></div><code class="">12,Shows,Musicals,Musical theatre
13,Shows,Plays,All "non-musical" theatre  
14,Shows,Opera,All opera, light, and "rock" opera
15,Concerts,Classical,All symphony, concerto, and choir concerts</code></pre>
         <p>Si vous chargez le fichier à l’aide du paramètre DELIMITER pour spécifier des entrées séparées par des virgules, la commande COPY échoue parce que certains champs d’entrée contiennent des virgules. Vous pouvez éviter ce problème en utilisant le paramètre CSV et en entourant les champs qui contiennent des virgules de guillemets. Si le guillemet s’affiche au sein d’une chaîne entre guillemets, vous devez doubler le guillemet. Le guillemet par défaut est double. Vous devez donc ajouter à tous les guillemets doubles des guillemets doubles supplémentaires. Votre nouveau fichier d’entrée ressemble à quelque chose comme ça. </p>
         <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Texte"><awsui-icon name="copy"></awsui-icon></div></div><code class="">12,Shows,Musicals,Musical theatre
13,Shows,Plays,"All ""non-musical"" theatre"
14,Shows,Opera,"All opera, light, and ""rock"" opera"
15,Concerts,Classical,"All symphony, concerto, and choir concerts"</code></pre>
         <p>En supposant que le nom du fichier est <code class="code">category_csv.txt</code>, vous pouvez charger le fichier en utilisant la commande COPY suivante :</p>
         <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Texte"><awsui-icon name="copy"></awsui-icon></div></div><code class="">copy category
from 's3://mybucket/data/category_csv.txt' 
iam_role 'arn:aws:iam::0123456789012:role/MyRedshiftRole' 
csv;</code></pre>
         <p>Sinon, pour éviter d’avoir à doubler les guillemets doubles de votre entrée, vous pouvez spécifier un guillemet différent à l’aide du paramètre QUOTE AS. Par exemple, la version suivante de <code class="code">category_csv.txt</code> utilise ’<code class="code">%</code>’ comme caractère de citation :</p>
         <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Texte"><awsui-icon name="copy"></awsui-icon></div></div><code class="">12,Shows,Musicals,Musical theatre
13,Shows,Plays,%All "non-musical" theatre%
14,Shows,Opera,%All opera, light, and "rock" opera%
15,Concerts,Classical,%All symphony, concerto, and choir concerts%</code></pre>
         <p>La commande COPY suivante utilise QUOTE AS pour charger <code class="code">category_csv.txt</code> :</p>
         <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Texte"><awsui-icon name="copy"></awsui-icon></div></div><code class="">copy category
from 's3://mybucket/data/category_csv.txt' 
iam_role 'arn:aws:iam::0123456789012:role/MyRedshiftRole' 
csv quote as '%';</code></pre>
       
         <h2 id="r_COPY_command_examples-load-venue-with-explicit-values-for-an-identity-column">Charger la table VENUE avec des valeurs EXPLICIT pour une colonne IDENTITY</h2>


         <p>L’exemple suivant suppose que lorsque la table VENUE a été créée, au moins une colonne (telle que la colonne <code class="code">venueid</code>) a été désignée comme colonne IDENTITY. Cette commande se substitue au comportement IDENTITY par défaut pour la génération automatique de valeurs pour une colonne IDENTITY et charge à la place des valeurs explicites depuis le fichier venue.txt. Amazon Redshift ne vérifie pas si des valeurs IDENTITY dupliquées sont chargées dans la table lors de l’utilisation de l’option EXLICIT_IDS. </p>
         <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Texte"><awsui-icon name="copy"></awsui-icon></div></div><code class="">copy venue
from 's3://mybucket/data/venue.txt' 
iam_role 'arn:aws:iam::0123456789012:role/MyRedshiftRole'
explicit_ids;</code></pre>
       
         <h2 id="r_COPY_command_examples-load-time-from-a-pipe-delimited-gzip-file">Charger la table TIME à partir d’un fichier GZIP séparé par une barre verticale</h2>


         <p>L’exemple suivant charge la table TIME à partir d’un fichier GZIP séparé par une barre verticale :</p>
         <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Texte"><awsui-icon name="copy"></awsui-icon></div></div><code class="">copy time
from 's3://mybucket/data/timerows.gz' 
iam_role 'arn:aws:iam::0123456789012:role/MyRedshiftRole'
gzip
delimiter '|';</code></pre>
       
         <h2 id="r_COPY_command_examples-load-a-time-datestamp">Charger un horodatage ou une datation</h2>


         <p>L’exemple suivant charge les données avec un horodatage formaté.</p>
         <div class="awsdocs-note"><div class="awsdocs-note-title"><awsui-icon name="status-info" variant="link"></awsui-icon><h6>Note</h6></div><div class="awsdocs-note-text"><p>Le TIMEFORMAT de <code class="code">HH:MI:SS</code> peut également prendre en charge des fractions de secondes au-delà de <code class="code">SS</code> jusqu’aux microsecondes. Le fichier <code class="code">time.txt</code> utilisé dans cet exemple contient une seule ligne, <code class="code">2009-01-12
               14:15:57.119568</code>.</p></div></div>
         <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Texte"><awsui-icon name="copy"></awsui-icon></div></div><code class="">copy timestamp1 
from 's3://mybucket/data/time.txt' 
iam_role 'arn:aws:iam::0123456789012:role/MyRedshiftRole'
timeformat 'YYYY-MM-DD HH:MI:SS';</code></pre>
         <p>Le résultat de cette copie est le suivant : </p>
         <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Texte"><awsui-icon name="copy"></awsui-icon></div></div><code class="">select * from timestamp1;
c1
----------------------------
2009-01-12 14:15:57.119568
(1 row)</code></pre>
       
         <h2 id="r_COPY_command_examples-load-data-from-a-file-with-default-values">Charger les données d’un fichier avec des valeurs par défaut</h2>


         <p>L’exemple suivant utilise une variation de la table VENUE dans la base de données TICKIT. Prenons une table VENUE_NEW définie avec l’instruction suivante : </p>
         <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Texte"><awsui-icon name="copy"></awsui-icon></div></div><code class="">create table venue_new(
venueid smallint not null,
venuename varchar(100) not null,
venuecity varchar(30),
venuestate char(2),
venueseats integer not null default '1000');</code></pre>
         <p>Imaginons un fichier de données venue_noseats.txt qui ne contient aucune valeur pour la colonne VENUESEATS, comme illustré dans l’exemple suivant : </p>
         <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Texte"><awsui-icon name="copy"></awsui-icon></div></div><code class="">1|Toyota Park|Bridgeview|IL|
2|Columbus Crew Stadium|Columbus|OH|
3|RFK Stadium|Washington|DC|
4|CommunityAmerica Ballpark|Kansas City|KS|
5|Gillette Stadium|Foxborough|MA|
6|New York Giants Stadium|East Rutherford|NJ|
7|BMO Field|Toronto|ON|
8|The Home Depot Center|Carson|CA|
9|Dick's Sporting Goods Park|Commerce City|CO|
10|Pizza Hut Park|Frisco|TX|</code></pre>
         <p>L’instruction COPY suivante charge correctement la table depuis le fichier et applique la valeur DEFAULT (’1000’) à la colonne omise : </p>
         <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Texte"><awsui-icon name="copy"></awsui-icon></div></div><code class="">copy venue_new(venueid, venuename, venuecity, venuestate) 
from 's3://mybucket/data/venue_noseats.txt' 
iam_role 'arn:aws:iam::0123456789012:role/MyRedshiftRole'
delimiter '|';</code></pre>
         <p>Maintenant, affichez la table chargée : </p>
         <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Texte"><awsui-icon name="copy"></awsui-icon></div></div><code class="">select * from venue_new order by venueid;
venueid |         venuename          |    venuecity    | venuestate | venueseats
---------+----------------------------+-----------------+------------+------------
1 | Toyota Park                | Bridgeview      | IL         |       1000
2 | Columbus Crew Stadium      | Columbus        | OH         |       1000
3 | RFK Stadium                | Washington      | DC         |       1000
4 | CommunityAmerica Ballpark  | Kansas City     | KS         |       1000
5 | Gillette Stadium           | Foxborough      | MA         |       1000
6 | New York Giants Stadium    | East Rutherford | NJ         |       1000
7 | BMO Field                  | Toronto         | ON         |       1000
8 | The Home Depot Center      | Carson          | CA         |       1000
9 | Dick's Sporting Goods Park | Commerce City   | CO         |       1000
10 | Pizza Hut Park             | Frisco          | TX         |       1000
(10 rows)</code></pre>
         <p>Pour l’exemple suivant, en plus de supposer qu’aucune donnée VENUESEATS n’est incluse dans le fichier, supposons également qu’aucune donnée VENUENAME n’est incluse : </p>
         <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Texte"><awsui-icon name="copy"></awsui-icon></div></div><code class="">1||Bridgeview|IL|
2||Columbus|OH|
3||Washington|DC|
4||Kansas City|KS|
5||Foxborough|MA|
6||East Rutherford|NJ|
7||Toronto|ON|
8||Carson|CA|
9||Commerce City|CO|
10||Frisco|TX|</code></pre>
         <p> A l’aide de la même définition de table, l’instructions COPY suivante échoue, car aucune valeur DEFAULT n’a été spécifié pour VENUENAME et VENUENAME est une colonne NOT NULL : </p>
         <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Texte"><awsui-icon name="copy"></awsui-icon></div></div><code class="">copy venue(venueid, venuecity, venuestate) 
from 's3://mybucket/data/venue_pipe.txt' 
iam_role 'arn:aws:iam::0123456789012:role/MyRedshiftRole'
delimiter '|';</code></pre>
         <p>Maintenant, prenons une variation de la table VENUE qui utilise une colonne IDENTITY : </p>
         <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Texte"><awsui-icon name="copy"></awsui-icon></div></div><code class="">create table venue_identity(
venueid int identity(1,1),
venuename varchar(100) not null,
venuecity varchar(30),
venuestate char(2),
venueseats integer not null default '1000');</code></pre>
         <p>Comme dans l’exemple précédent, supposons que la colonne VENUESEATS n’a aucune valeur correspondante dans le fichier source. L’instruction COPY suivante charge la table avec succès, y compris les valeurs de données IDENTITY prédéfinies au lieu de générer ces valeurs : </p>
         <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Texte"><awsui-icon name="copy"></awsui-icon></div></div><code class="">copy venue(venueid, venuename, venuecity, venuestate) 
from 's3://mybucket/data/venue_pipe.txt' 
iam_role 'arn:aws:iam::0123456789012:role/MyRedshiftRole'
delimiter '|' explicit_ids;</code></pre>
         <p>Cette instruction échoue, car elle n’inclut pas la colonne IDENTITY (VENUEID est manquante dans la liste de colonnes) mais inclut un paramètre EXPLICIT_IDS : </p>
         <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Texte"><awsui-icon name="copy"></awsui-icon></div></div><code class="">copy venue(venuename, venuecity, venuestate) 
from 's3://mybucket/data/venue_pipe.txt' 
iam_role 'arn:aws:iam::0123456789012:role/MyRedshiftRole'
delimiter '|' explicit_ids;</code></pre>
         <p>Cette instruction échoue, car elle n’inclut pas un paramètre EXPLICIT_IDS : </p>
         <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Texte"><awsui-icon name="copy"></awsui-icon></div></div><code class="">copy venue(venueid, venuename, venuecity, venuestate)
from 's3://mybucket/data/venue_pipe.txt' 
iam_role 'arn:aws:iam::0123456789012:role/MyRedshiftRole'
delimiter '|';</code></pre>
       
         <h2 id="r_COPY_command_examples-copy-data-with-the-escape-option">Exécuter la commande COPY des données avec l’option ESCAPE</h2>


         <p>L’exemple suivant présente le chargement des caractères qui correspondent au délimiteur (dans ce cas, la barre verticale). Dans le fichier d’entrée, assurez-vous qu’une barre oblique inverse (\) est ajoutée à toutes les barres verticales (|) que vous voulez charger. Puis chargez le fichier avec le paramètre ESCAPE. </p>
         <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Texte"><awsui-icon name="copy"></awsui-icon></div></div><code class="">$ more redshiftinfo.txt
1|public\|event\|dwuser
2|public\|sales\|dwuser

create table redshiftinfo(infoid int,tableinfo varchar(50));

copy redshiftinfo from 's3://mybucket/data/redshiftinfo.txt' 
iam_role 'arn:aws:iam::0123456789012:role/MyRedshiftRole' 
delimiter '|' escape;

select * from redshiftinfo order by 1;
infoid |       tableinfo
-------+--------------------
1      | public|event|dwuser
2      | public|sales|dwuser
(2 rows)</code></pre>
         <p>Sans le paramètre ESCAPE, cette commande COPY échoue avec une erreur <code class="code">Extra column(s)
               found</code>.</p>
         <div class="awsdocs-note awsdocs-important"><div class="awsdocs-note-title"><awsui-icon name="status-warning" variant="error"></awsui-icon><h6>Important</h6></div><div class="awsdocs-note-text"><p>Si vous chargez vos données à l’aide d’une commande COPY avec le paramètre ESCAPE, vous devez également spécifier le paramètre ESCAPE avec votre commande UNLOAD pour générer le fichier de sortie réciproque. De même, si vous exécuter la commande UNLOAD à l’aide du paramètre ESCAPE, vous devez utiliser la commande ESCAPE lorsque vous exécutez la commande COPY sur les mêmes données.</p></div></div>
       
         <h2 id="r_COPY_command_examples-copy-from-json">Copier à partir d’exemples JSON</h2>

         <p>Dans les exemples suivants, vous chargez la table CATEGORY avec les données suivantes. </p>
         <div class="table-container"><div class="table-contents"><table id="w319aac47b9c67c31c37b5"><thead>
                  <tr>
                     <th>CATID</th>
                     <th>CATGROUP</th>
                     <th>CATNAME</th>
                     <th>CATDESC</th>
                  </tr>
               </thead>
                  <tr>
                     <td tabindex="-1">1</td>
                     <td tabindex="-1">Sport</td>
                     <td tabindex="-1">MLB</td>
                     <td tabindex="-1"> Major League Baseball</td>
                  </tr>
                  <tr>
                     <td tabindex="-1">2</td>
                     <td tabindex="-1">Sport</td>
                     <td tabindex="-1">NHL</td>
                     <td tabindex="-1">National Hockey League</td>
                  </tr>
                  <tr>
                     <td tabindex="-1">3</td>
                     <td tabindex="-1">Sport</td>
                     <td tabindex="-1">NFL</td>
                     <td tabindex="-1">National Football League</td>
                  </tr>
                  <tr>
                     <td tabindex="-1">4</td>
                     <td tabindex="-1">Sport</td>
                     <td tabindex="-1">NBA</td>
                     <td tabindex="-1">National Basketball Association</td>
                  </tr>
                  <tr>
                     <td tabindex="-1">5</td>
                     <td tabindex="-1">Concerts</td>
                     <td tabindex="-1">Classical</td>
                     <td tabindex="-1">All symphony, concerto, and choir concerts</td>
                  </tr>
               </table></div></div>
         <div class="highlights" id="inline-topiclist"><h6>Rubriques</h6><ul><li><a href="#copy-from-json-examples-using-auto">Charger des données JSON à l’aide de l’option ’auto’</a></li><li><a href="#copy-from-json-examples-using-auto-ignorecase">Charger des données JSON à l’aide de l’option ’auto ignorecase’</a></li><li><a href="#copy-from-json-examples-using-jsonpaths">Charger à partir des données JSON à l’aide d’un fichier JSONPaths</a></li><li><a href="#copy-from-json-examples-using-jsonpaths-arrays">Charger à partir des tableaux JSON à l’aide d’un fichier JSONPaths</a></li></ul></div>

          
            <h3 id="copy-from-json-examples-using-auto">Charger des données JSON à l’aide de l’option ’auto’</h3>

            <p>Pour charger des données JSON à l’aide de l’option <code class="code">'auto'</code>, les données JSON doivent consister en un ensemble d’objets. Les noms de clés doivent correspondre aux noms de colonnes, mais dans ce cas, l’ordre n’a pas d’importance. Ce qui suit montre le contenu d’un fichier nommé <code class="code">category_object_auto.json</code>.</p>
            <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Texte"><awsui-icon name="copy"></awsui-icon></div></div><code class=""><span>{</span>
    "catdesc": "Major League Baseball",
    "catid": 1,
    "catgroup": "Sports",
    "catname": "MLB"
}
<span>{</span>
    "catgroup": "Sports",
    "catid": 2,
    "catname": "NHL",
    "catdesc": "National Hockey League"
}<span>{</span>
    "catid": 3,
    "catname": "NFL",
    "catgroup": "Sports",
    "catdesc": "National Football League"
}
<span>{</span>
    "bogus": "Bogus Sports LLC",
    "catid": 4,
    "catgroup": "Sports",
    "catname": "NBA",
    "catdesc": "National Basketball Association"
}
<span>{</span>
    "catid": 5,
    "catgroup": "Shows",
    "catname": "Musicals",
    "catdesc": "All symphony, concerto, and choir concerts"
}</code></pre>
            <p>Pour charger depuis le fichier de données JSON dans l’exemple précédent, exécutez la commande COPY suivante.</p>
            <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Texte"><awsui-icon name="copy"></awsui-icon></div></div><code class="">copy category
from 's3://mybucket/category_object_auto.json'
iam_role 'arn:aws:iam::0123456789012:role/MyRedshiftRole' 
json 'auto';</code></pre>
          
         
          
            <h3 id="copy-from-json-examples-using-auto-ignorecase">Charger des données JSON à l’aide de l’option ’auto ignorecase’</h3>
            
            <p>Pour charger des données JSON à l’aide de l’option <code class="code">'auto ignorecase'</code>, les données JSON doivent consister en un ensemble d’objets. Le cas des noms de clés n’a pas besoin de correspondre aux noms de colonnes et l’ordre n’a pas d’importance. Ce qui suit montre le contenu d’un fichier nommé <code class="code">category_object_auto-ignorecase.json</code>.</p>
            <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Texte"><awsui-icon name="copy"></awsui-icon></div></div><code class=""><span>{</span>
    "CatDesc": "Major League Baseball",
    "CatID": 1,
    "CatGroup": "Sports",
    "CatName": "MLB"
}
<span>{</span>
    "CatGroup": "Sports",
    "CatID": 2,
    "CatName": "NHL",
    "CatDesc": "National Hockey League"
}<span>{</span>
    "CatID": 3,
    "CatName": "NFL",
    "CatGroup": "Sports",
    "CatDesc": "National Football League"
}
<span>{</span>
    "bogus": "Bogus Sports LLC",
    "CatID": 4,
    "CatGroup": "Sports",
    "CatName": "NBA",
    "CatDesc": "National Basketball Association"
}
<span>{</span>
    "CatID": 5,
    "CatGroup": "Shows",
    "CatName": "Musicals",
    "CatDesc": "All symphony, concerto, and choir concerts"
}</code></pre>
            <p>Pour charger depuis le fichier de données JSON dans l’exemple précédent, exécutez la commande COPY suivante.</p>
            <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Texte"><awsui-icon name="copy"></awsui-icon></div></div><code class="">copy category
from 's3://mybucket/category_object_auto ignorecase.json'
iam_role 'arn:aws:iam::0123456789012:role/MyRedshiftRole' 
json 'auto ignorecase';</code></pre>
          
          
            <h3 id="copy-from-json-examples-using-jsonpaths">Charger à partir des données JSON à l’aide d’un fichier JSONPaths</h3>
            
            <p>Si les objets de données JSON ne correspondent pas directement aux noms de colonnes, vous pouvez utiliser un fichier JSONPaths pour mapper les éléments JSON aux colonnes. L’ordre n’a pas d’importance dans les données source JSON, mais l’ordre des expressions du fichier JSONPaths doit correspondre à l’ordre des colonnes. Supposons que vous ayez le fichier de données suivant, nommé <code class="code">category_object_paths.json</code>.</p>
            <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Texte"><awsui-icon name="copy"></awsui-icon></div></div><code class=""><span>{</span>
    "one": 1,
    "two": "Sports",
    "three": "MLB",
    "four": "Major League Baseball"
}
<span>{</span>
    "three": "NHL",
    "four": "National Hockey League",
    "one": 2,
    "two": "Sports"
}
<span>{</span>
    "two": "Sports",
    "three": "NFL",
    "one": 3,
    "four": "National Football League"
}
<span>{</span>
    "one": 4,
    "two": "Sports",
    "three": "NBA",
    "four": "National Basketball Association"
}
<span>{</span>
    "one": 6,
    "two": "Shows",
    "three": "Musicals",
    "four": "All symphony, concerto, and choir concerts"
}</code></pre>
            <p>Le fichier JSONPaths suivant, nommé <code class="code">category_jsonpath.json</code>, mappe les données source aux colonnes de la table.</p>
            <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Texte"><awsui-icon name="copy"></awsui-icon></div></div><code class=""><span>{</span>
    "jsonpaths": [
        "$['one']",
        "$['two']",
        "$['three']",
        "$['four']"
    ]
}</code></pre>
            <p>Pour charger depuis le fichier de données JSON dans l’exemple précédent, exécutez la commande COPY suivante.</p>
            <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Texte"><awsui-icon name="copy"></awsui-icon></div></div><code class="">copy category
from 's3://mybucket/category_object_paths.json'
iam_role 'arn:aws:iam::0123456789012:role/MyRedshiftRole' 
json 's3://mybucket/category_jsonpath.json';</code></pre>
          
         
         
          
            <h3 id="copy-from-json-examples-using-jsonpaths-arrays">Charger à partir des tableaux JSON à l’aide d’un fichier JSONPaths</h3>

            <p>Pour charger à partir des données JSON qui se composent d’un ensemble de tableaux, vous devez utiliser un fichier JSONPaths pour mapper des éléments du tableau aux colonnes. Supposons que vous ayez le fichier de données suivant, nommé <code class="code">category_array_data.json</code>.</p>
            <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Texte"><awsui-icon name="copy"></awsui-icon></div></div><code class="">[1,"Sports","MLB","Major League Baseball"]
[2,"Sports","NHL","National Hockey League"]
[3,"Sports","NFL","National Football League"]
[4,"Sports","NBA","National Basketball Association"]
[5,"Concerts","Classical","All symphony, concerto, and choir concerts"]</code></pre>
            <p>Le fichier JSONPaths suivant, nommé <code class="code">category_array_jsonpath.json</code>, mappe les données source aux colonnes de la table.</p>
            <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Texte"><awsui-icon name="copy"></awsui-icon></div></div><code class=""><span>{</span>
    "jsonpaths": [
        "$[0]",
        "$[1]",
        "$[2]",
        "$[3]"
    ]
}</code></pre>
            <p>Pour charger depuis le fichier de données JSON dans l’exemple précédent, exécutez la commande COPY suivante.</p>
            <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Texte"><awsui-icon name="copy"></awsui-icon></div></div><code class="">copy category
from 's3://mybucket/category_array_data.json'
iam_role 'arn:aws:iam::0123456789012:role/MyRedshiftRole' 
json 's3://mybucket/category_array_jsonpath.json';</code></pre>
          
             
         <h2 id="r_COPY_command_examples-copy-from-avro">Copier depuis des exemples Avro</h2>

         <p>Dans les exemples suivants, vous chargez la table CATEGORY avec les données suivantes. </p>
         <div class="table-container"><div class="table-contents"><table id="w319aac47b9c67c31c39b5"><thead>
                  <tr>
                     <th>CATID</th>
                     <th>CATGROUP</th>
                     <th>CATNAME</th>
                     <th>CATDESC</th>
                  </tr>
               </thead>
                  <tr>
                     <td tabindex="-1">1</td>
                     <td tabindex="-1">Sport</td>
                     <td tabindex="-1">MLB</td>
                     <td tabindex="-1"> Major League Baseball</td>
                  </tr>
                  <tr>
                     <td tabindex="-1">2</td>
                     <td tabindex="-1">Sport</td>
                     <td tabindex="-1">NHL</td>
                     <td tabindex="-1">National Hockey League</td>
                  </tr>
                  <tr>
                     <td tabindex="-1">3</td>
                     <td tabindex="-1">Sport</td>
                     <td tabindex="-1">NFL</td>
                     <td tabindex="-1">National Football League</td>
                  </tr>
                  <tr>
                     <td tabindex="-1">4</td>
                     <td tabindex="-1">Sport</td>
                     <td tabindex="-1">NBA</td>
                     <td tabindex="-1">National Basketball Association</td>
                  </tr>
                  <tr>
                     <td tabindex="-1">5</td>
                     <td tabindex="-1">Concerts</td>
                     <td tabindex="-1">Classical</td>
                     <td tabindex="-1">All symphony, concerto, and choir concerts</td>
                  </tr>
               </table></div></div>
         <div class="highlights" id="inline-topiclist"><h6>Rubriques</h6><ul><li><a href="#copy-from-avro-examples-using-auto">Charger à partir des données Avro à l’aide de l’option ’auto’</a></li><li><a href="#copy-from-avro-examples-using-auto-ignorecase">Charger à partir des données Avro à l’aide de l’option ’auto ignorecase’</a></li><li><a href="#copy-from-avro-examples-using-avropaths">Charger des données Avro à l’aide d’un fichier JSONPaths</a></li></ul></div>
          
            <h3 id="copy-from-avro-examples-using-auto">Charger à partir des données Avro à l’aide de l’option ’auto’</h3>

            <p>Pour charger à partir des données Avro à l’aide de l’argument <code class="code">'auto'</code>, les noms de champs du schéma Avro doivent correspondre aux noms de colonnes. Lorsque vous utilisez l’argument <code class="code">'auto'</code>, l’ordre n’est pas important. Ce qui suit montre le schéma d’un fichier nommé <code class="code">category_auto.avro</code>.</p>
            <pre class="screen"><span>{</span>
    "name": "category",
    "type": "record",
    "fields": [
        <span>{</span>"name": "catid", "type": "int"},
        <span>{</span>"name": "catdesc", "type": "string"},
        <span>{</span>"name": "catname", "type": "string"},
        <span>{</span>"name": "catgroup", "type": "string"},
}</pre>
            <p>Les données contenues dans un fichier Avro sont au format binaire, elles ne sont donc pas explicites. L’exemple suivant illustre une représentation JSON des données dans le fichier <code class="code">category_auto.avro</code>. </p>
            <pre class="screen"><span>{</span>
   "catid": 1,
   "catdesc": "Major League Baseball",
   "catname": "MLB",
   "catgroup": "Sports"
}
<span>{</span>
   "catid": 2,
   "catdesc": "National Hockey League",
   "catname": "NHL",
   "catgroup": "Sports"
}
<span>{</span>
   "catid": 3,
   "catdesc": "National Basketball Association",
   "catname": "NBA",
   "catgroup": "Sports"
}
<span>{</span>
   "catid": 4,
   "catdesc": "All symphony, concerto, and choir concerts",
   "catname": "Classical",
   "catgroup": "Concerts"
}</pre>
            <p>Pour charger depuis le fichier de données Avro dans l’exemple précédent, exécutez la commande COPY suivante.</p>
            <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Texte"><awsui-icon name="copy"></awsui-icon></div></div><code class="">copy category
from 's3://mybucket/category_auto.avro'
iam_role 'arn:aws:iam::0123456789012:role/MyRedshiftRole'
format as avro 'auto';</code></pre>
          
         
          
            <h3 id="copy-from-avro-examples-using-auto-ignorecase">Charger à partir des données Avro à l’aide de l’option ’auto ignorecase’</h3>
            
            <p>Pour charger à partir des données Avro à l’aide de l’argument <code class="code">'auto ignorecase'</code>, la casse des noms de champs du schéma Avro ne doit pas forcément correspondre à celle des noms de colonnes. Lorsque vous utilisez l’argument <code class="code">'auto ignorecase'</code>, l’ordre n’est pas important. Ce qui suit montre le schéma d’un fichier nommé <code class="code">category_auto-ignorecase.avro</code>.</p>
            <pre class="screen"><span>{</span>
    "name": "category",
    "type": "record",
    "fields": [
        <span>{</span>"name": "CatID", "type": "int"},
        <span>{</span>"name": "CatDesc", "type": "string"},
        <span>{</span>"name": "CatName", "type": "string"},
        <span>{</span>"name": "CatGroup", "type": "string"},
}</pre>
            <p>Les données contenues dans un fichier Avro sont au format binaire, elles ne sont donc pas explicites. L’exemple suivant illustre une représentation JSON des données dans le fichier <code class="code">category_auto-ignorecase.avro</code>. </p>
            <pre class="screen"><span>{</span>
   "CatID": 1,
   "CatDesc": "Major League Baseball",
   "CatName": "MLB",
   "CatGroup": "Sports"
}
<span>{</span>
   "CatID": 2,
   "CatDesc": "National Hockey League",
   "CatName": "NHL",
   "CatGroup": "Sports"
}
<span>{</span>
   "CatID": 3,
   "CatDesc": "National Basketball Association",
   "CatName": "NBA",
   "CatGroup": "Sports"
}
<span>{</span>
   "CatID": 4,
   "CatDesc": "All symphony, concerto, and choir concerts",
   "CatName": "Classical",
   "CatGroup": "Concerts"
}</pre>
            <p>Pour charger depuis le fichier de données Avro dans l’exemple précédent, exécutez la commande COPY suivante.</p>
            <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Texte"><awsui-icon name="copy"></awsui-icon></div></div><code class="">copy category
from 's3://mybucket/category_auto-ignorecase.avro'
iam_role 'arn:aws:iam::0123456789012:role/MyRedshiftRole'
format as avro 'auto ignorecase';</code></pre>
          
         
          
            <h3 id="copy-from-avro-examples-using-avropaths">Charger des données Avro à l’aide d’un fichier JSONPaths</h3>

            <p>Si les noms de champs du schéma Avro ne correspondent pas directement aux noms de colonnes, vous pouvez utiliser un fichier JSONPaths pour mapper les éléments de schéma aux colonnes. L’ordre des expressions du fichier JSONPaths doit correspondre à l’ordre des colonnes. </p>
            <p>Supposons que vous ayez un fichier de données nommé <code class="code">category_paths.avro</code> qui contient les mêmes données que dans l’exemple précédent, mais avec le schéma suivant.</p>
            <pre class="screen"><span>{</span>
    "name": "category",
    "type": "record",
    "fields": [
        <span>{</span>"name": "id", "type": "int"},
        <span>{</span>"name": "desc", "type": "string"},
        <span>{</span>"name": "name", "type": "string"},
        <span>{</span>"name": "group", "type": "string"},
        <span>{</span>"name": "region", "type": "string"} 
     ]
}</pre>
            <p>Le fichier JSONPaths suivant, nommé <code class="code">category_path.avropath</code>, mappe les données source aux colonnes de la table.</p>
            <pre class="screen"><span>{</span>
    "jsonpaths": [
        "$['id']",
        "$['group']",
        "$['name']",
        "$['desc']"
    ]
}</pre>
            <p>Pour charger depuis le fichier de données Avro dans l’exemple précédent, exécutez la commande COPY suivante.</p>
            <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Texte"><awsui-icon name="copy"></awsui-icon></div></div><code class="">copy category
from 's3://mybucket/category_object_paths.avro'
iam_role 'arn:aws:iam::0123456789012:role/MyRedshiftRole' 
format avro 's3://mybucket/category_path.avropath ';</code></pre>
          

       
         <h2 id="r_COPY_preparing_data">Préparation de fichiers pour la commande COPY avec l’option ESCAPE</h2>


         <p>L’exemple suivant décrit comment préparer les données pour insérer des caractères de saut de ligne avant d’importer les données dans une table Amazon Redshift à l’aide de la commande COPY avec le paramètre ESCAPE. Si vous ne préparez pas les données afin de délimiter les caractères de saut ligne, Amazon Redshift renvoie des erreurs de charge lorsque vous exécutez la commande COPY, car le caractère de saut de ligne est généralement utilisé comme séparateur d’enregistrements. </p>
         <p>Par exemple, prenons un fichier ou une colonne dans une table externe que vous voulez copier dans une table Amazon Redshift. Si le fichier ou la colonne contient des données de contenu au format XML ou similaires, vous devez vous assurer que tous les caractères de saut de ligne (\n) qui font partie du contenu sont insérés avec la barre oblique inverse (\). </p>
         <p>Si un fichier ou une table contient des caractères de saut de ligne imbriqués, cela offre un modèle relativement facile à mettre en correspondance. Chaque caractère de saut de ligne imbriqué suit presque toujours un caractère <code class="code">&gt;</code> avec, potentiellement, des caractères d’espace (<code class="code">' '</code> ou une tabulation) entre les deux, comme vous pouvez le voir dans l’exemple suivant d’un fichier texte intitulé <code>nlTest1.txt</code>. </p>
         <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Texte"><awsui-icon name="copy"></awsui-icon></div></div><code class="">$ cat nlTest1.txt
&lt;xml start&gt;
&lt;newline characters provide&gt;
&lt;line breaks at the end of each&gt;
&lt;line in content&gt;
&lt;/xml&gt;|1000
&lt;xml&gt;
&lt;/xml&gt;|2000</code></pre>
         <p>Avec l’exemple suivant, vous pouvez exécuter un utilitaire de traitement de texte permettant de prétraiter le fichier source et d’insérer des caractères d’échappement si nécessaire. (Le caractère <code class="code">|</code> est destiné à être utilisé comme délimiteur pour séparer les données de la colonne lorsqu’elles sont copiées dans une table Amazon Redshift.) </p>
         <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Texte"><awsui-icon name="copy"></awsui-icon></div></div><code class="">$ sed -e ':a;N;$!ba;s/&gt;[[:space:]]*\n/&gt;\\\n/g' nlTest1.txt &gt; nlTest2.txt</code></pre>
         <p>De même, vous pouvez utiliser Perl pour effectuer une opération similaire : </p>
         <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Texte"><awsui-icon name="copy"></awsui-icon></div></div><code class="">cat nlTest1.txt | perl -p -e 's/&gt;\s*\n/&gt;\\\n/g' &gt; nlTest2.txt</code></pre>
         <p>Pour faciliter le chargement des données à partir du fichier <code>nlTest2.txt</code> dans Amazon Redshift, nous avons créé une table à deux colonnes dans Amazon Redshift. La première colonne c1, est une colonne de caractères dont le contenu est au format XML issu du fichier <code>nlTest2.txt</code>. La deuxième colonne c2 contient des valeurs de nombres entiers chargés à partir du même fichier. </p>
         <p>Après avoir exécuté la commande <code class="code">sed</code>, vous pouvez charger correctement des données à partir du fichier <code>nlTest2.txt</code> dans une table Amazon Redshift à l’aide du paramètre ESCAPE. </p>
         <div class="awsdocs-note"><div class="awsdocs-note-title"><awsui-icon name="status-info" variant="link"></awsui-icon><h6>Note</h6></div><div class="awsdocs-note-text"><p>Lorsque vous incluez le paramètre ESCAPE avec la commande COPY, il insère un certain nombre de caractères spéciaux, parmi lesquels la barre oblique (ainsi que le saut de ligne). </p></div></div>
         <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Texte"><awsui-icon name="copy"></awsui-icon></div></div><code class="">copy t2 from 's3://mybucket/data/nlTest2.txt' 
iam_role 'arn:aws:iam::0123456789012:role/MyRedshiftRole'  
escape
delimiter as '|';

select * from t2 order by 2;

c1           |  c2
-------------+------
&lt;xml start&gt;
&lt;newline characters provide&gt;
&lt;line breaks at the end of each&gt;
&lt;line in content&gt;
&lt;/xml&gt;
| 1000
&lt;xml&gt;
&lt;/xml&gt;       | 2000
(2 rows)</code></pre>
         <p>Vous pouvez préparer les fichiers de données exportés à partir de bases de données externes d’une manière similaire. Par exemple, avec une base de données Oracle, vous pouvez utiliser la fonction REPLACE sur chaque colonne concernée dans une table que vous voulez copier dans Amazon Redshift. </p>
         <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Texte"><awsui-icon name="copy"></awsui-icon></div></div><code class="">SELECT c1, REPLACE(c2, \n',\\n' ) as c2 from my_table_with_xml</code></pre>
         <p>En outre, de nombreux outils d’exportation et d’extraction, de transformation, de chargement (ETL) de la base de données qui traitent régulièrement de grandes quantités de données offrent des options permettant de spécifier des caractères d’échappement et délimiteurs. </p>
       
         
         
         <h2 id="copy-example-spatial-copy-shapefile">Chargement d’un shapefile dans Amazon Redshift</h2>
         
         <p>Les exemples suivants montrent comment charger un shapefile Esri à l’aide de la commande COPY. Pour plus d’informations sur le chargement des fichiers de forme, consultez <a href="./spatial-copy-shapefile.html">Chargement d’un shapefile dans Amazon Redshift</a>. </p>        

         
         
          
            <h3 id="copy-example-spatial-copy-shapefile-loading-copy">Chargement d’un shapefile</h3>
            
            
            <p>Les étapes suivantes montrent comment ingérer des  OpenStreetMap  données depuis Amazon S3 à l'aide de la commande COPY. Cet exemple suppose que l’archive de shapefile Norway depuis <a href="https://download.geofabrik.de/europe.html" rel="noopener noreferrer" target="_blank"><span>le site de téléchargement de Geofabrik</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a> a été téléchargée dans un compartiment privé Amazon S3 dans votre région AWS. Les fichiers <code>.shp</code>, <code>.shx</code> et <code>.dbf</code> doivent partager le même préfixe et le même nom de fichier Amazon S3.</p>
            
             
               <h4 id="spatial-copy-shapefile-loading-copy-fits">Intégration des données sans simplification</h4>
               <p>Les commandes suivantes créent des tables et intègrent des données qui peuvent s’adapter à la taille géométrique maximale sans aucune simplification. Ouvrez <code>gis_osm_natural_free_1.shp</code> dans votre logiciel SIG préféré et inspectez les colonnes de cette couche. Par défaut, les colonnes IDENTITY ou GEOMETRY sont les premières. Lorsque la première colonne est une colonne GEOMETRY, vous pouvez créer la table comme indiqué ci-dessous.</p>
               <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Texte"><awsui-icon name="copy"></awsui-icon></div></div><code class="sql ">CREATE TABLE norway_natural (
   wkb_geometry GEOMETRY,
   osm_id BIGINT,
   code INT,
   fclass VARCHAR,
   name VARCHAR);            
</code></pre>
               
               <p>Sinon, lorsque la première colonne est une colonne IDENTITY, vous pouvez créer la table comme indiqué ci-dessous.</p>
               
               <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Texte"><awsui-icon name="copy"></awsui-icon></div></div><code class="sql ">CREATE TABLE norway_natural_with_id (
   fid INT IDENTITY(1,1),
   wkb_geometry GEOMETRY,
   osm_id BIGINT,
   code INT,
   fclass VARCHAR,
   name VARCHAR);            
</code></pre>
               
               <p>Maintenant, vous pouvez intégrer les données en utilisant la commande COPY.</p>
               <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Texte"><awsui-icon name="copy"></awsui-icon></div></div><code class="sql ">COPY norway_natural FROM 's3://<code class="replaceable">bucket_name</code>/shapefiles/norway/gis_osm_natural_free_1.shp'
FORMAT SHAPEFILE
CREDENTIALS 'aws_iam_role=arn:aws:iam::123456789012:role/MyRoleName';
INFO: Load into table 'norway_natural' completed, 83891 record(s) loaded successfully
</code></pre>
               
               <p>Vous pouvez également intégrer les données comme indiqué ci-dessous. </p>
               
               <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Texte"><awsui-icon name="copy"></awsui-icon></div></div><code class="sql ">COPY norway_natural_with_id FROM 's3://<code class="replaceable">bucket_name</code>/shapefiles/norway/gis_osm_natural_free_1.shp'
FORMAT SHAPEFILE
CREDENTIALS 'aws_iam_role=arn:aws:iam::123456789012:role/MyRoleName';
INFO: Load into table 'norway_natural_with_id' completed, 83891 record(s) loaded successfully.
</code></pre>         
             
            
             
               <h4 id="spatial-copy-shapefile-loading-copy-no-fit">Intégration des données avec simplification</h4>
               <p>Les commandes suivantes créent une table et tentent d’intégrer des données qui ne rentrent pas dans la taille géométrique maximale sans aucune simplification. Inspectez le shapefile <code>gis_osm_water_a_free_1.shp</code> et créez la table appropriée comme indiqué ci-dessous.</p>             
               <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Texte"><awsui-icon name="copy"></awsui-icon></div></div><code class="sql ">CREATE TABLE norway_water (
   wkb_geometry GEOMETRY,
   osm_id BIGINT,
   code INT,
   fclass VARCHAR,
   name VARCHAR);
</code></pre>
               
               <p>Lorsque la commande COPY s’exécute, une erreur est renvoyée.</p>
               
               <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Texte"><awsui-icon name="copy"></awsui-icon></div></div><code class="sql ">COPY norway_water FROM 's3://<code class="replaceable">bucket_name</code>/shapefiles/norway/gis_osm_water_a_free_1.shp'
FORMAT SHAPEFILE
CREDENTIALS 'aws_iam_role=arn:aws:iam::123456789012:role/MyRoleName';
ERROR:  Load into table 'norway_water' failed.  Check 'stl_load_errors' system table for details.              
</code></pre>
               
               <p>L’interrogation de <code class="code">STL_LOAD_ERRORS</code> indique que la géométrie est trop volumineuse. </p>
               
               <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Texte"><awsui-icon name="copy"></awsui-icon></div></div><code class="nohighlight">SELECT line_number, btrim(colname), btrim(err_reason) FROM stl_load_errors WHERE query = pg_last_copy_id();
 line_number |    btrim     |                                 btrim
-------------+--------------+-----------------------------------------------------------------------
     1184705 | wkb_geometry | Geometry size: 1513736 is larger than maximum supported size: 1048447              
</code></pre>
               
               <p>Pour résoudre ce problème, le paramètre <code class="code">SIMPLIFY AUTO</code> est ajouté à la commande COPY afin de simplifier les géométries.</p>
               
               <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Texte"><awsui-icon name="copy"></awsui-icon></div></div><code class="sql ">COPY norway_water FROM 's3://<code class="replaceable">bucket_name</code>/shapefiles/norway/gis_osm_water_a_free_1.shp'
FORMAT SHAPEFILE
SIMPLIFY AUTO
CREDENTIALS 'aws_iam_role=arn:aws:iam::123456789012:role/MyRoleName';

INFO:  Load into table 'norway_water' completed, 1989196 record(s) loaded successfully.              
</code></pre>
               
               <p>Pour afficher les lignes et les géométries simplifiées, interrogez <code class="code">SVL_SPATIAL_SIMPLIFY</code>.</p>
               
               <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Texte"><awsui-icon name="copy"></awsui-icon></div></div><code class="nohighlight">SELECT * FROM svl_spatial_simplify WHERE query = pg_last_copy_id();
 query | line_number | maximum_tolerance | initial_size | simplified | final_size |   final_tolerance
-------+-------------+-------------------+--------------+------------+------------+----------------------
    20 |     1184704 |                -1 |      1513736 | t          |    1008808 |   1.276386653895e-05
    20 |     1664115 |                -1 |      1233456 | t          |    1023584 | 6.11707814796635e-06               
</code></pre>
               
               <p>Lorsque la commande SIMPLIY AUTO <em>max_tolerance</em> est utilisée avec une tolérance inférieure à celle calculée automatiquement, une erreur d’ingestion est généralement renvoyée. Dans ce cas, utilisez la commande MAXERROR pour ignorer les erreurs.</p>
               
               <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Texte"><awsui-icon name="copy"></awsui-icon></div></div><code class="sql ">COPY norway_water FROM 's3://<code class="replaceable">bucket_name</code>/shapefiles/norway/gis_osm_water_a_free_1.shp'
FORMAT SHAPEFILE
SIMPLIFY AUTO 1.1E-05
MAXERROR 2
CREDENTIALS 'aws_iam_role=arn:aws:iam::123456789012:role/MyRoleName';

INFO:  Load into table 'norway_water' completed, 1989195 record(s) loaded successfully.
INFO:  Load into table 'norway_water' completed, 1 record(s) could not be loaded.  Check 'stl_load_errors' system table for details.               
</code></pre>
               
               <p>Interrogez à nouveau <code class="code">SVL_SPATIAL_SIMPLIFY</code> pour identifier l’enregistrement que la commande COPY n’a pas réussi à charger.</p>
               <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Texte"><awsui-icon name="copy"></awsui-icon></div></div><code class="nohighlight">SELECT * FROM svl_spatial_simplify WHERE query = pg_last_copy_id();
 query | line_number | maximum_tolerance | initial_size | simplified | final_size | final_tolerance
-------+-------------+-------------------+--------------+------------+------------+-----------------
    29 |     1184704 |           1.1e-05 |      1513736 | f          |          0 |               0
    29 |     1664115 |           1.1e-05 |      1233456 | t          |     794432 |         1.1e-05             
</code></pre>
               
               <p>Dans cet exemple, le premier enregistrement n’a pas réussi à s’ajuster, c’est pourquoi la colonne <code class="code">simplified</code> affiche false. Le deuxième enregistrement a été chargé dans la tolérance donnée. Toutefois, la taille finale est supérieure à l’utilisation de la tolérance calculée automatiquement sans spécifier la tolérance maximale. </p>             
                       
             
                       
          
         
          
            <h3 id="copy-example-spatial-copy-shapefile-compressed">Chargement à partir d’un shapefile compressé</h3>
            <p>La commande COPY Amazon Redshift prend en charge l’ingestion de données à partir d’un shapefile compressé. Tous les composants de shapefiles doivent avoir le même préfixe Amazon S3 et le même suffixe de compression. Par exemple, supposons que vous souhaitiez charger les données de l’exemple précédent. Dans ce cas, les fichiers  <code>gis_osm_water_a_free_1.shp.gz</code>, <code>gis_osm_water_a_free_1.dbf.gz</code> et <code>gis_osm_water_a_free_1.shx.gz</code> doivent partager le même répertoire Amazon S3. La commande COPY nécessite l’option GZIP, et la clause FROM doit spécifier le fichier compressé correct, comme indiqué ci-dessous.</p>
            
            <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Texte"><awsui-icon name="copy"></awsui-icon></div></div><code class="sql ">COPY norway_natural FROM 's3://<code class="replaceable">bucket_name</code>/shapefiles/norway/compressed/gis_osm_natural_free_1.shp.gz'
FORMAT SHAPEFILE
GZIP
CREDENTIALS 'aws_iam_role=arn:aws:iam::123456789012:role/MyRoleName';
INFO:  Load into table 'norway_natural' completed, 83891 record(s) loaded successfully.          
</code></pre>
          
         
          
            <h3 id="copy-example-spatial-copy-shapefile-column-order">Chargement des données dans une table avec un ordre de colonnes différent</h3>
            <p>Si vous avez une table qui n’a pas <code class="code">GEOMETRY</code> comme première colonne, vous pouvez utiliser le mappage de colonnes pour mapper des colonnes à la table cible. Par exemple, créez une table en spécifiant <code class="code">osm_id</code> comme première colonne.</p>
            
            <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Texte"><awsui-icon name="copy"></awsui-icon></div></div><code class="sql ">CREATE TABLE norway_natural_order (
   osm_id BIGINT,
   wkb_geometry GEOMETRY,
   code INT,
   fclass VARCHAR,
   name VARCHAR);         
</code></pre>
            <p>Intégrez ensuite un shapefile à l’aide du mappage de colonnes.</p>
            <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Texte"><awsui-icon name="copy"></awsui-icon></div></div><code class="sql ">COPY norway_natural_order(wkb_geometry, osm_id, code, fclass, name) 
FROM 's3://<code class="replaceable">bucket_name</code>/shapefiles/norway/gis_osm_natural_free_1.shp'
FORMAT SHAPEFILE
CREDENTIALS 'aws_iam_role=arn:aws:iam::123456789012:role/MyRoleName';
INFO:  Load into table 'norway_natural_order' completed, 83891 record(s) loaded successfully.         
</code></pre>
            
          
         
          
            
            <h3 id="copy-example-spatial-copy-shapefile-geography">Chargement de données dans une table avec une colonne de géographies</h3>
            <p>Si vous disposez d’une table avec une colonne <code class="code">GEOGRAPHY</code>, vous devez d’abord l’intégrer à une colonne <code class="code">GEOMETRY</code>, puis convertir les objets en objets <code class="code">GEOGRAPHY</code>. Par exemple, après avoir copié votre shapefile dans une colonne <code class="code">GEOMETRY</code>, modifiez le tableau pour ajouter une colonne du type de données <code class="code">GEOGRAPHY</code>.</p>           
            <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Texte"><awsui-icon name="copy"></awsui-icon></div></div><code class="sql ">ALTER TABLE norway_natural ADD COLUMN wkb_geography GEOGRAPHY;</code></pre>
            
            <p>Convertissez ensuite les géométries en géographies.</p>
            <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Texte"><awsui-icon name="copy"></awsui-icon></div></div><code class="sql ">UPDATE norway_natural SET wkb_geography = wkb_geometry::geography;</code></pre>
            
            <p>Vous pouvez éventuellement supprimer la colonne <code class="code">GEOMETRY</code>.</p>
            <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Texte"><awsui-icon name="copy"></awsui-icon></div></div><code class="sql ">ALTER TABLE norway_natural DROP COLUMN wkb_geometry;</code></pre>
            
          
         
       
         
         <h2 id="r_COPY_command_examples-load-noload-option">Commande COPY avec l’option NOLOAD</h2>
              
         <p>Pour valider des fichiers de données avant de charger réellement les données, utilisez l’option NOLOAD avec la commande COPY. Amazon Redshift analyse le fichier d’entrée et affiche les erreurs éventuelles. L’exemple suivant utilise l’option NOLOAD et aucune ligne n’est réellement chargée dans la table.</p>
         <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Texte"><awsui-icon name="copy"></awsui-icon></div></div><code class="sql "><code class="userinput">COPY public.zipcode1
FROM 's3://mybucket/mydata/zipcode.csv' 
DELIMITER ';' 
IGNOREHEADER 1 REGION 'us-east-1'
NOLOAD
CREDENTIALS 'aws_iam_role=arn:aws:iam::123456789012:role/myRedshiftRole'</code>;
<code class="computeroutput" copy="false">
Warnings:
Load into table 'zipcode1' completed, 0 record(s) loaded successfully.  
</code>       
         
         </code></pre>
      <awsdocs-copyright class="copyright-print"></awsdocs-copyright><awsdocs-thumb-feedback right-edge="{{$ctrl.thumbFeedbackRightEdge}}"></awsdocs-thumb-feedback></div><noscript><div><div><div><div id="js_error_message"><p><img src="https://d1ge0kk1l5kms0.cloudfront.net/images/G/01/webservices/console/warning.png" alt="Avertissement" /> <strong>JavaScript est désactivé ou n'est pas disponible dans votre navigateur.</strong></p><p>Pour que vous puissiez utiliser la documentation AWS, Javascript doit être activé. Vous trouverez des instructions sur les pages d'aide de votre navigateur.</p></div></div></div></div></noscript><div id="main-col-footer" class="awsui-util-font-size-0"><div id="doc-conventions"><a target="_top" href="/general/latest/gr/docconventions.html">Conventions de rédaction</a></div><div class="prev-next"><div id="previous" class="prev-link" accesskey="p" href="./automatic-recognition.html">Utilisation de la reconnaissance automatique avec DATEFORMAT et TIMEFORMAT</div><div id="next" class="next-link" accesskey="n" href="./r_CREATE_DATABASE.html">CREATE DATABASE</div></div></div><awsdocs-page-utilities></awsdocs-page-utilities></div><div id="quick-feedback-yes" style="display: none;"><div class="title">Cette page vous a-t-elle été utile ? - Oui</div><div class="content"><p>Merci de nous avoir fait part de votre satisfaction.</p><p>Si vous avez quelques minutes à nous consacrer, merci de nous indiquer ce qui vous a plu afin que nous puissions nous améliorer davantage.</p><p><awsui-button id="fblink" rel="noopener noreferrer" target="_blank" text="Commentaire" click="linkClick($event)" href="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=Redshift&amp;topic_url=https://docs.aws.amazon.com/fr_fr/redshift/latest/dg/r_COPY_command_examples.html"></awsui-button></p></div></div><div id="quick-feedback-no" style="display: none;"><div class="title">Cette page vous a-t-elle été utile ? - Non</div><div class="content"><p>Merci de nous avoir avertis que cette page avait besoin d'être retravaillée. Nous sommes désolés de ne pas avoir répondu à vos attentes.</p><p>Si vous avez quelques minutes à nous consacrer, merci de nous indiquer comment nous pourrions améliorer cette documentation.</p><p><awsui-button id="fblink" rel="noopener noreferrer" target="_blank" text="Commentaire" click="linkClick($event)" href="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=Redshift&amp;topic_url=https://docs.aws.amazon.com/fr_fr/redshift/latest/dg/r_COPY_command_examples.html"></awsui-button></p></div></div></div></body></div></awsdocs-view><div class="page-loading-indicator" id="page-loading-indicator"><awsui-spinner size="large"></awsui-spinner></div></div><div id="tools-panel" dom-region="tools"><awsdocs-tools-panel id="awsdocs-tools-panel"></awsdocs-tools-panel></div></awsui-app-layout><awsdocs-cookie-banner class="doc-cookie-banner"></awsdocs-cookie-banner></div></body></html>