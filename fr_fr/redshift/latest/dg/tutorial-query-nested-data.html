<!DOCTYPE html>
    <html xmlns="http://www.w3.org/1999/xhtml" lang="fr-FR"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Didacticiel : Faire une requête de données imbriquées avec Amazon Redshift Spectrum - Amazon Redshift</title><meta name="viewport" content="width=device-width,initial-scale=1" /><meta name="assets_root" content="/assets" /><meta name="target_state" content="tutorial-query-nested-data" /><meta name="default_state" content="tutorial-query-nested-data" /><link rel="icon" type="image/ico" href="/assets/images/favicon.ico" /><link rel="shortcut icon" type="image/ico" href="/assets/images/favicon.ico" /><link rel="canonical" href="https://docs.aws.amazon.com/fr_fr/redshift/latest/dg/tutorial-query-nested-data.html" /><meta name="description" content="Interrogez les données imbriquées avec Amazon Redshift Spectrum." /><meta name="deployment_region" content="IAD" /><meta name="product" content="Amazon Redshift" /><meta name="guide" content="Guide du développeur de base de données" /><meta name="abstract" content="Créez et gérez un entrepôt de données avec Amazon Redshift, service d’entrepôt de données au niveau de l’entreprise, pouvant atteindre plusieurs Po et entièrement géré." /><meta name="guide-locale" content="fr_fr" /><meta name="tocs" content="toc-contents.json" /><link rel="canonical" href="https://docs.aws.amazon.com/fr_fr/redshift/latest/dg/tutorial-query-nested-data.html" /><link rel="alternative" href="https://docs.aws.amazon.com/id_id/redshift/latest/dg/tutorial-query-nested-data.html" hreflang="id-id" /><link rel="alternative" href="https://docs.aws.amazon.com/id_id/redshift/latest/dg/tutorial-query-nested-data.html" hreflang="id" /><link rel="alternative" href="https://docs.aws.amazon.com/de_de/redshift/latest/dg/tutorial-query-nested-data.html" hreflang="de-de" /><link rel="alternative" href="https://docs.aws.amazon.com/de_de/redshift/latest/dg/tutorial-query-nested-data.html" hreflang="de" /><link rel="alternative" href="https://docs.aws.amazon.com/redshift/latest/dg/tutorial-query-nested-data.html" hreflang="en-us" /><link rel="alternative" href="https://docs.aws.amazon.com/redshift/latest/dg/tutorial-query-nested-data.html" hreflang="en" /><link rel="alternative" href="https://docs.aws.amazon.com/es_es/redshift/latest/dg/tutorial-query-nested-data.html" hreflang="es-es" /><link rel="alternative" href="https://docs.aws.amazon.com/es_es/redshift/latest/dg/tutorial-query-nested-data.html" hreflang="es" /><link rel="alternative" href="https://docs.aws.amazon.com/fr_fr/redshift/latest/dg/tutorial-query-nested-data.html" hreflang="fr-fr" /><link rel="alternative" href="https://docs.aws.amazon.com/fr_fr/redshift/latest/dg/tutorial-query-nested-data.html" hreflang="fr" /><link rel="alternative" href="https://docs.aws.amazon.com/it_it/redshift/latest/dg/tutorial-query-nested-data.html" hreflang="it-it" /><link rel="alternative" href="https://docs.aws.amazon.com/it_it/redshift/latest/dg/tutorial-query-nested-data.html" hreflang="it" /><link rel="alternative" href="https://docs.aws.amazon.com/ja_jp/redshift/latest/dg/tutorial-query-nested-data.html" hreflang="ja-jp" /><link rel="alternative" href="https://docs.aws.amazon.com/ja_jp/redshift/latest/dg/tutorial-query-nested-data.html" hreflang="ja" /><link rel="alternative" href="https://docs.aws.amazon.com/ko_kr/redshift/latest/dg/tutorial-query-nested-data.html" hreflang="ko-kr" /><link rel="alternative" href="https://docs.aws.amazon.com/ko_kr/redshift/latest/dg/tutorial-query-nested-data.html" hreflang="ko" /><link rel="alternative" href="https://docs.aws.amazon.com/pt_br/redshift/latest/dg/tutorial-query-nested-data.html" hreflang="pt-br" /><link rel="alternative" href="https://docs.aws.amazon.com/pt_br/redshift/latest/dg/tutorial-query-nested-data.html" hreflang="pt" /><link rel="alternative" href="https://docs.aws.amazon.com/zh_cn/redshift/latest/dg/tutorial-query-nested-data.html" hreflang="zh-cn" /><link rel="alternative" href="https://docs.aws.amazon.com/zh_tw/redshift/latest/dg/tutorial-query-nested-data.html" hreflang="zh-tw" /><link rel="alternative" href="https://docs.aws.amazon.com/redshift/latest/dg/tutorial-query-nested-data.html" hreflang="x-default" /><meta name="feedback-item" content="Redshift" /><meta name="this_doc_product" content="Amazon Redshift" /><meta name="this_doc_guide" content="Guide du développeur de base de données" /><script defer="" src="/assets/r/vendor4.js?version=2021.12.02"></script><script defer="" src="/assets/r/vendor3.js?version=2021.12.02"></script><script defer="" src="/assets/r/vendor1.js?version=2021.12.02"></script><script defer="" src="/assets/r/awsdocs-common.js?version=2021.12.02"></script><script defer="" src="/assets/r/awsdocs-doc-page.js?version=2021.12.02"></script><link href="/assets/r/vendor4.css?version=2021.12.02" rel="stylesheet" /><link href="/assets/r/awsdocs-common.css?version=2021.12.02" rel="stylesheet" /><link href="/assets/r/awsdocs-doc-page.css?version=2021.12.02" rel="stylesheet" /><script async="" id="awsc-panorama-bundle" type="text/javascript" src="https://prod.pa.cdn.uis.awsstatic.com/panorama-nav-init.js" data-config="{'appEntity':'aws-documentation','region':'us-east-1','service':'redshift'}"></script><meta id="panorama-serviceSubSection" value="Guide du développeur de base de données" /><meta id="panorama-serviceConsolePage" value="Didacticiel : Faire une requête de données imbriquées avec Amazon Redshift Spectrum" /></head><body class="awsdocs awsui"><div class="awsdocs-container"><awsdocs-header></awsdocs-header><awsui-app-layout id="app-layout" class="awsui-util-no-gutters" ng-controller="ContentController as $ctrl" header-selector="awsdocs-header" navigation-hide="false" navigation-width="$ctrl.navWidth" navigation-open="$ctrl.navOpen" navigation-change="$ctrl.onNavChange($event)" tools-hide="$ctrl.hideTools" tools-width="$ctrl.toolsWidth" tools-open="$ctrl.toolsOpen" tools-change="$ctrl.onToolsChange($event)"><div id="guide-toc" dom-region="navigation"><awsdocs-toc></awsdocs-toc></div><div id="main-column" dom-region="content" tabindex="-1"><awsdocs-view class="awsdocs-view"><div id="awsdocs-content"><head><title>Didacticiel : Faire une requête de données imbriquées avec Amazon Redshift Spectrum - Amazon Redshift</title><meta name="pdf" content="redshift-dg.pdf#tutorial-query-nested-data" /><meta name="rss" content="Dochistory.rss" /><meta name="forums" content="http://forums.aws.amazon.com/forum.jspa?forumID=155" /><meta name="feedback" content="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=Redshift&amp;topic_url=https://docs.aws.amazon.com/fr_fr/redshift/latest/dg/tutorial-query-nested-data.html" /><meta name="feedback-yes" content="feedbackyes.html?topic_url=https://docs.aws.amazon.com/fr_fr/redshift/latest/dg/tutorial-query-nested-data.html" /><meta name="feedback-no" content="feedbackno.html?topic_url=https://docs.aws.amazon.com/fr_fr/redshift/latest/dg/tutorial-query-nested-data.html" /><meta name="keywords" content="Amazon Redshift,AWS Redshift,Redshift,Redshift Spectrum,cluster,entrepôt de données,développeur,exemples de données,database,développeur de base de données,HLL" /><script type="application/ld+json">
{
    "@context" : "https://schema.org",
    "@type" : "BreadcrumbList",
    "itemListElement" : [
      {
        "@type" : "ListItem",
        "position" : 1,
        "name" : "AWS",
        "item" : "https://aws.amazon.com"
      },
      {
        "@type" : "ListItem",
        "position" : 2,
        "name" : "Amazon Redshift",
        "item" : "https://docs.aws.amazon.com/redshift/index.html"
      },
      {
        "@type" : "ListItem",
        "position" : 3,
        "name" : "Guide du développeur de base de données",
        "item" : "https://docs.aws.amazon.com/fr_fr/redshift/latest/dg"
      },
      {
        "@type" : "ListItem",
        "position" : 4,
        "name" : "Interroger des données externes avec Amazon Redshift Spectrum",
        "item" : "https://docs.aws.amazon.com/fr_fr/redshift/latest/dg/c-using-spectrum.html"
      },
      {
        "@type" : "ListItem",
        "position" : 5,
        "name" : "Didacticiel : Faire une requête de données imbriquées avec Amazon Redshift Spectrum",
        "item" : "https://docs.aws.amazon.com/fr_fr/redshift/latest/dg/c-using-spectrum.html"
      }
    ]
}
</script></head><body><div id="main"><div style="display: none"><a href="redshift-dg.pdf#tutorial-query-nested-data" target="_blank" rel="noopener noreferrer" title="Ouvrir le PDF"></a></div><div id="breadcrumbs" class="breadcrumb"><a href="https://aws.amazon.com">AWS</a><a href="/index.html">Documentation</a><a href="/redshift/index.html">Amazon Redshift</a><a href="welcome.html">Guide du développeur de base de données</a></div><div id="page-toc-src"><a href="#tutorial-nested-data-overview">Présentation</a><a href="#tutorial-nested-data-create-table">Étape 1 : Création d’un tableau externe contenant des données imbriquées</a><a href="#tutorial-query-nested-data-sqlextensions">Étape 2 : Faire une requête de vos données imbriquées dans Amazon S3 avec des extensions SQL</a></div><div id="main-content" class="awsui-util-container"><div id="main-col-body"><awsdocs-language-banner data-service="$ctrl.pageService"></awsdocs-language-banner><awsui-alert class="awsdocs-page-banner awsui-util-mb-l"><p>Les traductions sont fournies par des outils de traduction automatique. En cas de conflit entre le contenu d'une traduction et celui de la version originale en anglais, la version anglaise prévaudra.</p></awsui-alert><h1 class="topictitle" id="tutorial-query-nested-data">Didacticiel : Faire une requête de données imbriquées avec  Amazon Redshift Spectrum</h1><div class="awsdocs-page-header-container"><awsdocs-page-header></awsdocs-page-header><awsdocs-filter-selector id="awsdocs-filter-selector"></awsdocs-filter-selector></div>
        <h2 id="tutorial-nested-data-overview">Présentation</h2>
                
        <p>Amazon Redshift Spectrum prend en charge la requête de données imbriquées dans Parquet, ORC, JSON et les formats de fichier Ion. Redshift Spectrum accède aux données à l’aide de tableaux externes. Vous pouvez créer des tableaux externes qui utilisent les types de données complexes <code class="code">struct</code>, <code class="code">array</code>, et <code class="code">map</code>.</p>
        <p>Par exemple, supposons que votre fichier de données contienne les données suivantes dans Amazon S3 dans un fichier nommé <code class="code">customers</code>. Bien qu’il n’y ait aucun élément racine, chaque objet JSON de cet exemple de données représente une ligne d’une table. </p>
<pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Texte"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>"id": 1,
 "name": <span>{</span>"given": "John", "family": "Smith"},
 "phones": ["123-457789"],
 "orders": [<span>{</span>"shipdate": "2018-03-01T11:59:59.000Z", "price": 100.50},
            <span>{</span>"shipdate": "2018-03-01T09:10:00.000Z", "price": 99.12}]
}
<span>{</span>"id": 2,
 "name": <span>{</span>"given": "Jenny", "family": "Doe"},
 "phones": ["858-8675309", "415-9876543"],
 "orders": []
}
<span>{</span>"id": 3,
 "name": <span>{</span>"given": "Andy", "family": "Jones"},
 "phones": [],
 "orders": [<span>{</span>"shipdate": "2018-03-02T08:02:15.000Z", "price": 13.50}]
}  </code></pre>        
   
        
        <p>Vous pouvez utiliser Amazon Redshift Spectrum pour soumettre une requête sur les données imbriquées dans des fichiers. Le didacticiel suivant vous montre comment effectuer cette opération avec les données Apache Parquet.</p> 
        <p>Consultez les sujets suivants pour les prérequis de didacticiel, les étapes et les cas d’utilisation de données imbriquées :</p>
        <div class="itemizedlist">
             
             
             
             
             
             
        <ul class="itemizedlist"><li class="listitem">
                <p><a href="#tutorial-nested-data-prereq">Prérequis</a></p>
            </li><li class="listitem">
                <p><a href="#tutorial-nested-data-create-table">Étape 1 : Création d’un tableau externe contenant des données imbriquées</a></p>
            </li><li class="listitem">
                <p><a href="#tutorial-query-nested-data-sqlextensions">Étape 2 : Faire une requête de vos données imbriquées dans Amazon S3 avec des extensions SQL</a></p>
            </li><li class="listitem">
                <p><a href="./nested-data-use-cases.html">Cas d’utilisation de données imbriquées </a></p>
            </li><li class="listitem">
                <p><a href="./nested-data-restrictions.html">Limitations des données imbriquées (version préliminaire)</a></p>
            </li><li class="listitem">
                <p><a href="./serializing-complex-JSON.html">Sérialisation de JSON imbriqué complexe</a></p>
            </li></ul></div>
        
        


         
            <h3 id="tutorial-nested-data-prereq">Prérequis</h3>
            
            <p>Si vous n’utilisez pas encore Redshift Spectrum, suivez les étapes détaillées dans <a href="./c-getting-started-using-spectrum.html">Mise en route avec Amazon Redshift Spectrum</a> avant de poursuivre.</p>
            
            <p>Pour créer un schéma externe, remplacez l’ARN de rôle IAM dans la commande suivante par l’ARN de rôle que vous avez créé dans <a href="./c-getting-started-using-spectrum-create-role.html">Créer un rôle IAM</a>. Ensuite, exécutez la commande dans votre client SQL.</p>
            <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Texte"><awsui-icon name="copy"></awsui-icon></div></div><code class="">create external schema spectrum 
from data catalog 
database 'myspectrum_db' 
iam_role 'arn:aws:iam::123456789012:role/myspectrum_role'
create external database if not exists;</code></pre>
         

     
        <h2 id="tutorial-nested-data-create-table">Étape 1 : Création d’un tableau externe contenant des données imbriquées</h2>
        <p>Vous pouvez afficher les <a href="https://s3.amazonaws.com/redshift-downloads/tickit/spectrum/customers/customer_file1" rel="noopener noreferrer" target="_blank"><span>données source</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a> en les téléchargeant depuis Amazon S3. </p>

        <p>Exécutez la commande suivante pour créer un tableau externe pour ce didacticiel. </p>
        <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Texte"><awsui-icon name="copy"></awsui-icon></div></div><code class="">CREATE EXTERNAL TABLE spectrum.customers (
  id     int,
  name   struct&lt;given:varchar(20), family:varchar(20)&gt;,
  phones array&lt;varchar(20)&gt;,
  orders array&lt;struct&lt;shipdate:timestamp, price:double precision&gt;&gt;
)
STORED AS PARQUET
LOCATION 's3://redshift-downloads/tickit/spectrum/customers/';     </code></pre>
        
        <p>Dans l’exemple précédent, le tableau externe <code class="code">spectrum.customers</code> utilise les types de données <code class="code">struct</code> et <code class="code">array</code> pour définir les colonnes dotées de données imbriquées. Amazon Redshift Spectrum prend en charge la requête de données imbriquées dans Parquet, ORC, JSON et les formats de fichier Ion. Le paramètre <code class="code">STORED AS</code> est <code class="code">PARQUET</code> pour les fichiers Apache Parquet. Le paramètre <code class="code">LOCATION</code> doit se référer au dossier Amazon S3 contenant les données ou fichiers imbriqués. Pour plus d'informations, consultez <a href="./r_CREATE_EXTERNAL_TABLE.html">CREATE EXTERNAL TABLE</a>.</p>
        
        
        <p>Vous pouvez imbriquer les types <code class="code">array</code> et <code class="code">struct</code> à n’importe quel niveau. Vous pouvez par exemple définir une colonne nommée <code class="code">toparray</code>, comme l’illustre l’exemple suivant.</p>
        <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Texte"><awsui-icon name="copy"></awsui-icon></div></div><code class="">toparray array&lt;struct&lt;nestedarray:
         array&lt;struct&lt;morenestedarray: 
         array&lt;string&gt;&gt;&gt;&gt;&gt;</code></pre>
        <p>Vous pouvez également imbriquer les types <code class="code">struct</code> comme l’illustre la colonne <code class="code">x</code> dans l’exemple suivant.</p>
        <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Texte"><awsui-icon name="copy"></awsui-icon></div></div><code class="">x struct&lt;a: string,
         b: struct&lt;c: integer,
                   d: struct&lt;e: string&gt;
                  &gt;
        &gt;</code></pre>
   
     
                <h2 id="tutorial-query-nested-data-sqlextensions">Étape 2 : Faire une requête de vos données imbriquées dans Amazon S3 avec des extensions SQL</h2>
                <p>Redshift Spectrum prend en charge les requêtes de types complexes <code class="code">array</code>, <code class="code">map</code> et <code class="code">struct</code> via des extensions à la syntaxe SQL Amazon Redshift. </p>
                 
                    <h3 id="nested-data-sqlextension1">Extension 1 : Accès aux colonnes de structs</h3>
                    <p>Vous pouvez extraire des données à partir des colonnes <code class="code">struct</code> à l’aide d’une notation par points qui connecte les noms de champs en chemins. Par exemple, la requête suivante retourne les noms et prénoms de clients. Le prénom est obtenu via le long chemin <code class="code">c.name.given</code>. Le nom de famille est obtenu via le long chemin <code class="code">c.name.family</code>. </p>    
                    <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Texte"><awsui-icon name="copy"></awsui-icon></div></div><code class="">SELECT c.id, c.name.given, c.name.family
FROM   spectrum.customers c;</code></pre>
                    <p>La requête précédente renvoie les données suivantes.</p>
                    <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Texte"><awsui-icon name="copy"></awsui-icon></div></div><code class="">id | given | family
---|-------|-------
1  | John  | Smith
2  | Jenny | Doe
3  | Andy  | Jones
(3 rows)</code></pre>
                    <p>Un <code class="code">struct</code> peut être une colonne d’un autre <code class="code">struct</code>, qui peut être une colonne d’un autre <code class="code">struct</code> et ce à tout niveau. Les chemins qui accèdent aux colonnes dans des <code class="code">struct</code> aussi profondément imbriqués peuvent être très longs. Par exemple, regardez la définition pour la colonne <code class="code">x</code> dans l’illustration suivante.</p>     
<pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Texte"><awsui-icon name="copy"></awsui-icon></div></div><code class="">x struct&lt;a: string,
         b: struct&lt;c: integer, 
                      d: struct&lt;e: string&gt;
                  &gt;
        &gt;</code></pre>        
        <p>Vous pouvez accéder aux données dans <code class="code">e</code> en tant que <code class="code">x.b.d.e</code>.</p>
    
                    
                    
                   
                 
                    <h3 id="nested-data-sqlextension2">Extension 2 : Surplomber les pans d’une clause FROM</h3>
                    <p>Vous pouvez extraire des données de colonnes <code class="code">array</code> (et, par extension, des colonnes <code class="code">map</code>) en précisant les colonnes <code class="code">array</code> dans une clause <code class="code">FROM</code> à la place des noms de tableaux. L’extension s’applique à la clause <code class="code">FROM</code> de la requête principale, ainsi qu’aux clauses <code class="code">FROM</code> des sous-requêtes.</p>
                        
                <p>Vous pouvez référencer les éléments <code class="code">array</code> d’après leur position, comme <code class="code">c.orders[0]</code> (version préliminaire).</p>
                    <p>En combinant le surplombage de <code class="code">arrays</code> avec des raccords, vous pouvez réaliser différentes sortes de désimbrication, comme les cas d’utilisation suivants l’expliquent. </p>
                     
                        <h4 id="unnest-inner-joins">Désimbrication à l’aide de raccords internes</h4>
                        <p>La requête suivante sélectionne les ID de clients et les dates d’expédition de commandes pour les clients disposant de commandes. L’extension SQL dans la clause FROM <code class="code">c.orders
                        o</code> dépend de l’alias <code class="code">c</code>.</p>
                    <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Texte"><awsui-icon name="copy"></awsui-icon></div></div><code class="">SELECT c.id, o.shipdate
FROM   spectrum.customers c, c.orders o </code></pre> 
                        <p>Pour chaque <code class="code">c</code> de client disposant de commandes, la clause <code class="code">FROM</code> renvoie une ligne pour chaque commande <code class="code">o</code> du client <code class="code">c</code>. Cette ligne combine la ligne du client <code class="code">c</code> et la ligne de commande <code class="code">o</code>. Ensuite, la clause <code class="code">SELECT</code> garde uniquement le <code class="code">c.id</code> et le <code class="code">o.shipdate</code>. Le résultat est le suivant.</p>
                         <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Texte"><awsui-icon name="copy"></awsui-icon></div></div><code class="">id|      shipdate
--|----------------------
1 |2018-03-01  11:59:59
1 |2018-03-01  09:10:00
3 |2018-03-02  08:02:15
(3 rows) </code></pre>   
                        <p>L’alias <code class="code">c</code> fournit un accès aux champs du client et l’alias <code class="code">o</code> fournit un accès aux champs de commande. </p>
                        <p>La sémantique est similaire au SQL standard. Vous pouvez envisager la clause <code class="code">FROM</code> comme exécutant la boucle imbriquée suivante qui est suivie par la sélection de champs pour la sortie par <code class="code">SELECT</code>. </p>
                        <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Texte"><awsui-icon name="copy"></awsui-icon></div></div><code class="">for each customer c in spectrum.customers
  for each order o in c.orders
     output c.id and o.shipdate </code></pre>
                        <p>Ainsi, si un client ne dispose pas de commande, le client n’apparaît pas dans le résultat.</p>
                        <p>Vous pouvez également envisager ceci comme une clause <code class="code">FROM</code> qui exécute un <code class="code">JOIN</code> avec le tableau <code class="code">customers</code> et le pan <code class="code">orders</code>. Dans les faits, vous pouvez également rédiger la requête comme l’illustre l’exemple suivant.</p>
                        <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Texte"><awsui-icon name="copy"></awsui-icon></div></div><code class="">SELECT c.id, o.shipdate
FROM   spectrum.customers c INNER JOIN c.orders o ON true </code></pre>
                        <div class="awsdocs-note"><div class="awsdocs-note-title"><awsui-icon name="status-info" variant="link"></awsui-icon><h6>Note</h6></div><div class="awsdocs-note-text"><p>Si un schéma nommé <code class="code">c</code> existe avec un tableau nommé <code class="code">orders</code>, alors <code class="code">c.orders</code> se réfère au tableau <code class="code">orders</code>, et non à la colonne de pan <code class="code">customers</code>.</p></div></div>
                 
                 
                    <h4 id="unnest-left-joins">Désimbrication à l’aide de raccords gauches</h4>
                    <p>La requête suivante sort tous les noms des clients et leurs commandes. Si un client n’a pas encore placé de commande, son nom sera tout de même renvoyé. Cependant, dans ce cas, les colonnes de commande sont NULLES, comme l’illustre l’exemple suivant pour Jenny Doe.</p>
                    <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Texte"><awsui-icon name="copy"></awsui-icon></div></div><code class="">SELECT c.id, c.name.given, c.name.family, o.shipdate, o.price
FROM   spectrum.customers c LEFT JOIN c.orders o ON true</code></pre>
                    
                    <p>La requête précédente renvoie les données suivantes.</p>
                    <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Texte"><awsui-icon name="copy"></awsui-icon></div></div><code class="">id  |  given  | family  |    shipdate          | price
----|---------|---------|----------------------|--------
 1  |  John   | Smith   | 2018-03-01  11:59:59 | 100.5
 1  |  John   | Smith   | 2018-03-01  09:10:00 |  99.12
 2  |  Jenny  | Doe     |                      |
 3  |  Andy   | Jones   | 2018-03-02  08:02:15 |  13.5
 (4 rows)</code></pre>
                 
                
                 
                    <h3 id="nested-data-sqlextension3">Extension 3 : Obtenir directement à un pan de scalaires en utilisant un alias </h3>
                    <p>Lorsqu’un alias <code class="code">p</code> dans une clause <code class="code">FROM</code> surplombe tout un tableau de scalaires, la requête se réfère aux valeurs de <code class="code">p</code> en tant que <code class="code">p</code>. Par exemple, la requête suivante produit des paires de noms de clients et de numéros de téléphone.</p>
                    <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Texte"><awsui-icon name="copy"></awsui-icon></div></div><code class="">SELECT c.name.given, c.name.family, p AS phone
FROM   spectrum.customers c LEFT JOIN c.phones p ON true  </code></pre>
                    <p>La requête précédente renvoie les données suivantes.</p>
                    <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Texte"><awsui-icon name="copy"></awsui-icon></div></div><code class="">given  |  family  |  phone
-------|----------|-----------
John   | Smith    | 123-4577891
Jenny  | Doe      | 858-8675309
Jenny  | Doe      | 415-9876543
Andy   | Jones    | 
(4 rows) </code></pre>
                     
                 
                    <h3 id="nested-data-sqlextension4">Extension 4 : Accès aux éléments de cartes </h3>
                    <p>Redshift Spectrum traite le type de donnée <code class="code">map</code> comme un type de <code class="code">array</code> contenant des types <code class="code">struct</code> avec une colonne <code class="code">key</code> et une colonne <code class="code">value</code>. La <code class="code">key</code> doit être <code class="code">scalar</code>; la valeur peut être de n’importe quel type de donnée. </p>
                    <p>Par exemple, le code suivant crée un tableau externe avec une <code class="code">map</code> pour stocker les numéros de téléphone.</p>
                    <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Texte"><awsui-icon name="copy"></awsui-icon></div></div><code class="">CREATE EXTERNAL TABLE spectrum.customers2 (
  id     int,
  name   struct&lt;given:varchar(20), family:varchar(20)&gt;,
  phones map&lt;varchar(20), varchar(20)&gt;,
  orders array&lt;struct&lt;shipdate:timestamp, price:double precision&gt;&gt;
)
STORED AS PARQUET
LOCATION 's3://redshift-downloads/tickit/spectrum/customers/';</code></pre>
                    <p>Parce qu’un type de <code class="code">map</code> se comporte comme un type de <code class="code">array</code> avec des colonnes <code class="code">key</code> et <code class="code">value</code>, vous pouvez penser aux schémas précédents comme s’ils étaient les suivants.</p>
                    <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Texte"><awsui-icon name="copy"></awsui-icon></div></div><code class="">CREATE EXTERNAL TABLE spectrum.customers3 (
  id     int,
  name   struct&lt;given:varchar(20), family:varchar(20)&gt;,
  phones array&lt;struct&lt;key:varchar(20), value:varchar(20)&gt;&gt;,
  orders array&lt;struct&lt;shipdate:timestamp, price:double precision&gt;&gt;
)
STORED AS PARQUET
LOCATION 's3://redshift-downloads/tickit/spectrum/customers/';   </code></pre>
                    
                    <p>La requête suivante renvoie les noms de clients avec un numéro de téléphone mobile et renvoie le numéro pour chaque nom. La requête de carte est traitée comme l’équivalent d’une requête de <code class="code">array</code> imbriquée de types <code class="code">struct</code>. La requête suivante ne renvoie des données que si vous avez créé le tableau externe précédemment évoqué. </p>   
                     <pre class="programlisting"><div class="code-btn-container"></div><code class="">SELECT c.name.given, c.name.family, p.value 
FROM   spectrum.customers c, c.phones p 
WHERE  p.key = 'mobile';  </code></pre>   
                  <div class="awsdocs-note"><div class="awsdocs-note-title"><awsui-icon name="status-info" variant="link"></awsui-icon><h6>Note</h6></div><div class="awsdocs-note-text"><p>La <code class="code">key</code> pour une <code class="code">map</code> est une <code class="code">string</code> pour les types de fichiers Ion et JSON.</p></div></div>      
                    
                    
                     
                <awsdocs-copyright class="copyright-print"></awsdocs-copyright><awsdocs-thumb-feedback right-edge="{{$ctrl.thumbFeedbackRightEdge}}"></awsdocs-thumb-feedback></div><noscript><div><div><div><div id="js_error_message"><p><img src="https://d1ge0kk1l5kms0.cloudfront.net/images/G/01/webservices/console/warning.png" alt="Avertissement" /> <strong>JavaScript est désactivé ou n'est pas disponible dans votre navigateur.</strong></p><p>Pour que vous puissiez utiliser la documentation AWS, Javascript doit être activé. Vous trouverez des instructions sur les pages d'aide de votre navigateur.</p></div></div></div></div></noscript><div id="main-col-footer" class="awsui-util-font-size-0"><div id="doc-conventions"><a target="_top" href="/general/latest/gr/docconventions.html">Conventions de rédaction</a></div><div class="prev-next"><div id="previous" class="prev-link" accesskey="p" href="./c-spectrum-troubleshooting.html">Résolution des problèmes de requêtes</div><div id="next" class="next-link" accesskey="n" href="./nested-data-use-cases.html">Cas d’utilisation de données imbriquées </div></div></div><awsdocs-page-utilities></awsdocs-page-utilities></div><div id="quick-feedback-yes" style="display: none;"><div class="title">Cette page vous a-t-elle été utile ? - Oui</div><div class="content"><p>Merci de nous avoir fait part de votre satisfaction.</p><p>Si vous avez quelques minutes à nous consacrer, merci de nous indiquer ce qui vous a plu afin que nous puissions nous améliorer davantage.</p><p><awsui-button id="fblink" rel="noopener noreferrer" target="_blank" text="Commentaire" click="linkClick($event)" href="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=Redshift&amp;topic_url=https://docs.aws.amazon.com/fr_fr/redshift/latest/dg/tutorial-query-nested-data.html"></awsui-button></p></div></div><div id="quick-feedback-no" style="display: none;"><div class="title">Cette page vous a-t-elle été utile ? - Non</div><div class="content"><p>Merci de nous avoir avertis que cette page avait besoin d'être retravaillée. Nous sommes désolés de ne pas avoir répondu à vos attentes.</p><p>Si vous avez quelques minutes à nous consacrer, merci de nous indiquer comment nous pourrions améliorer cette documentation.</p><p><awsui-button id="fblink" rel="noopener noreferrer" target="_blank" text="Commentaire" click="linkClick($event)" href="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=Redshift&amp;topic_url=https://docs.aws.amazon.com/fr_fr/redshift/latest/dg/tutorial-query-nested-data.html"></awsui-button></p></div></div></div></body></div></awsdocs-view><div class="page-loading-indicator" id="page-loading-indicator"><awsui-spinner size="large"></awsui-spinner></div></div><div id="tools-panel" dom-region="tools"><awsdocs-tools-panel id="awsdocs-tools-panel"></awsdocs-tools-panel></div></awsui-app-layout><awsdocs-cookie-banner class="doc-cookie-banner"></awsdocs-cookie-banner></div></body></html>