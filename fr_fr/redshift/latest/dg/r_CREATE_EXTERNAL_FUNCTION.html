<!DOCTYPE html>
    <html xmlns="http://www.w3.org/1999/xhtml" lang="fr-FR"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>CREATE EXTERNAL FUNCTION - Amazon Redshift</title><meta name="viewport" content="width=device-width,initial-scale=1" /><meta name="assets_root" content="/assets" /><meta name="target_state" content="r_CREATE_EXTERNAL_FUNCTION" /><meta name="default_state" content="r_CREATE_EXTERNAL_FUNCTION" /><link rel="icon" type="image/ico" href="/assets/images/favicon.ico" /><link rel="shortcut icon" type="image/ico" href="/assets/images/favicon.ico" /><link rel="canonical" href="https://docs.aws.amazon.com/fr_fr/redshift/latest/dg/r_CREATE_EXTERNAL_FUNCTION.html" /><meta name="description" content="Crée une fonction scalaire définie par l’utilisateur (UDF) basée sur AWS Lambda pour Amazon Redshift." /><meta name="deployment_region" content="IAD" /><meta name="product" content="Amazon Redshift" /><meta name="guide" content="Guide du développeur de base de données" /><meta name="abstract" content="Créez et gérez un entrepôt de données avec Amazon Redshift, service d’entrepôt de données au niveau de l’entreprise, pouvant atteindre plusieurs Po et entièrement géré." /><meta name="guide-locale" content="fr_fr" /><meta name="tocs" content="toc-contents.json" /><link rel="canonical" href="https://docs.aws.amazon.com/fr_fr/redshift/latest/dg/r_CREATE_EXTERNAL_FUNCTION.html" /><link rel="alternative" href="https://docs.aws.amazon.com/id_id/redshift/latest/dg/r_CREATE_EXTERNAL_FUNCTION.html" hreflang="id-id" /><link rel="alternative" href="https://docs.aws.amazon.com/id_id/redshift/latest/dg/r_CREATE_EXTERNAL_FUNCTION.html" hreflang="id" /><link rel="alternative" href="https://docs.aws.amazon.com/de_de/redshift/latest/dg/r_CREATE_EXTERNAL_FUNCTION.html" hreflang="de-de" /><link rel="alternative" href="https://docs.aws.amazon.com/de_de/redshift/latest/dg/r_CREATE_EXTERNAL_FUNCTION.html" hreflang="de" /><link rel="alternative" href="https://docs.aws.amazon.com/redshift/latest/dg/r_CREATE_EXTERNAL_FUNCTION.html" hreflang="en-us" /><link rel="alternative" href="https://docs.aws.amazon.com/redshift/latest/dg/r_CREATE_EXTERNAL_FUNCTION.html" hreflang="en" /><link rel="alternative" href="https://docs.aws.amazon.com/es_es/redshift/latest/dg/r_CREATE_EXTERNAL_FUNCTION.html" hreflang="es-es" /><link rel="alternative" href="https://docs.aws.amazon.com/es_es/redshift/latest/dg/r_CREATE_EXTERNAL_FUNCTION.html" hreflang="es" /><link rel="alternative" href="https://docs.aws.amazon.com/fr_fr/redshift/latest/dg/r_CREATE_EXTERNAL_FUNCTION.html" hreflang="fr-fr" /><link rel="alternative" href="https://docs.aws.amazon.com/fr_fr/redshift/latest/dg/r_CREATE_EXTERNAL_FUNCTION.html" hreflang="fr" /><link rel="alternative" href="https://docs.aws.amazon.com/it_it/redshift/latest/dg/r_CREATE_EXTERNAL_FUNCTION.html" hreflang="it-it" /><link rel="alternative" href="https://docs.aws.amazon.com/it_it/redshift/latest/dg/r_CREATE_EXTERNAL_FUNCTION.html" hreflang="it" /><link rel="alternative" href="https://docs.aws.amazon.com/ja_jp/redshift/latest/dg/r_CREATE_EXTERNAL_FUNCTION.html" hreflang="ja-jp" /><link rel="alternative" href="https://docs.aws.amazon.com/ja_jp/redshift/latest/dg/r_CREATE_EXTERNAL_FUNCTION.html" hreflang="ja" /><link rel="alternative" href="https://docs.aws.amazon.com/ko_kr/redshift/latest/dg/r_CREATE_EXTERNAL_FUNCTION.html" hreflang="ko-kr" /><link rel="alternative" href="https://docs.aws.amazon.com/ko_kr/redshift/latest/dg/r_CREATE_EXTERNAL_FUNCTION.html" hreflang="ko" /><link rel="alternative" href="https://docs.aws.amazon.com/pt_br/redshift/latest/dg/r_CREATE_EXTERNAL_FUNCTION.html" hreflang="pt-br" /><link rel="alternative" href="https://docs.aws.amazon.com/pt_br/redshift/latest/dg/r_CREATE_EXTERNAL_FUNCTION.html" hreflang="pt" /><link rel="alternative" href="https://docs.aws.amazon.com/zh_cn/redshift/latest/dg/r_CREATE_EXTERNAL_FUNCTION.html" hreflang="zh-cn" /><link rel="alternative" href="https://docs.aws.amazon.com/zh_tw/redshift/latest/dg/r_CREATE_EXTERNAL_FUNCTION.html" hreflang="zh-tw" /><link rel="alternative" href="https://docs.aws.amazon.com/redshift/latest/dg/r_CREATE_EXTERNAL_FUNCTION.html" hreflang="x-default" /><meta name="feedback-item" content="Redshift" /><meta name="this_doc_product" content="Amazon Redshift" /><meta name="this_doc_guide" content="Guide du développeur de base de données" /><script defer="" src="/assets/r/vendor4.js?version=2021.12.02"></script><script defer="" src="/assets/r/vendor3.js?version=2021.12.02"></script><script defer="" src="/assets/r/vendor1.js?version=2021.12.02"></script><script defer="" src="/assets/r/awsdocs-common.js?version=2021.12.02"></script><script defer="" src="/assets/r/awsdocs-doc-page.js?version=2021.12.02"></script><link href="/assets/r/vendor4.css?version=2021.12.02" rel="stylesheet" /><link href="/assets/r/awsdocs-common.css?version=2021.12.02" rel="stylesheet" /><link href="/assets/r/awsdocs-doc-page.css?version=2021.12.02" rel="stylesheet" /><script async="" id="awsc-panorama-bundle" type="text/javascript" src="https://prod.pa.cdn.uis.awsstatic.com/panorama-nav-init.js" data-config="{'appEntity':'aws-documentation','region':'us-east-1','service':'redshift'}"></script><meta id="panorama-serviceSubSection" value="Guide du développeur de base de données" /><meta id="panorama-serviceConsolePage" value="CREATE EXTERNAL FUNCTION" /></head><body class="awsdocs awsui"><div class="awsdocs-container"><awsdocs-header></awsdocs-header><awsui-app-layout id="app-layout" class="awsui-util-no-gutters" ng-controller="ContentController as $ctrl" header-selector="awsdocs-header" navigation-hide="false" navigation-width="$ctrl.navWidth" navigation-open="$ctrl.navOpen" navigation-change="$ctrl.onNavChange($event)" tools-hide="$ctrl.hideTools" tools-width="$ctrl.toolsWidth" tools-open="$ctrl.toolsOpen" tools-change="$ctrl.onToolsChange($event)"><div id="guide-toc" dom-region="navigation"><awsdocs-toc></awsdocs-toc></div><div id="main-column" dom-region="content" tabindex="-1"><awsdocs-view class="awsdocs-view"><div id="awsdocs-content"><head><title>CREATE EXTERNAL FUNCTION - Amazon Redshift</title><meta name="pdf" content="redshift-dg.pdf#r_CREATE_EXTERNAL_FUNCTION" /><meta name="rss" content="Dochistory.rss" /><meta name="forums" content="http://forums.aws.amazon.com/forum.jspa?forumID=155" /><meta name="feedback" content="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=Redshift&amp;topic_url=https://docs.aws.amazon.com/fr_fr/redshift/latest/dg/r_CREATE_EXTERNAL_FUNCTION.html" /><meta name="feedback-yes" content="feedbackyes.html?topic_url=https://docs.aws.amazon.com/fr_fr/redshift/latest/dg/r_CREATE_EXTERNAL_FUNCTION.html" /><meta name="feedback-no" content="feedbackno.html?topic_url=https://docs.aws.amazon.com/fr_fr/redshift/latest/dg/r_CREATE_EXTERNAL_FUNCTION.html" /><meta name="keywords" content="Amazon Redshift,AWS Redshift,Redshift,Redshift Spectrum,cluster,entrepôt de données,développeur,exemples de données,database,développeur de base de données,HLL" /><script type="application/ld+json">
{
    "@context" : "https://schema.org",
    "@type" : "BreadcrumbList",
    "itemListElement" : [
      {
        "@type" : "ListItem",
        "position" : 1,
        "name" : "AWS",
        "item" : "https://aws.amazon.com"
      },
      {
        "@type" : "ListItem",
        "position" : 2,
        "name" : "Amazon Redshift",
        "item" : "https://docs.aws.amazon.com/redshift/index.html"
      },
      {
        "@type" : "ListItem",
        "position" : 3,
        "name" : "Guide du développeur de base de données",
        "item" : "https://docs.aws.amazon.com/fr_fr/redshift/latest/dg"
      },
      {
        "@type" : "ListItem",
        "position" : 4,
        "name" : "Référence SQL",
        "item" : "https://docs.aws.amazon.com/fr_fr/redshift/latest/dg/cm_chap_SQLCommandRef.html"
      },
      {
        "@type" : "ListItem",
        "position" : 5,
        "name" : "Commandes SQL",
        "item" : "https://docs.aws.amazon.com/fr_fr/redshift/latest/dg/c_SQL_commands.html"
      },
      {
        "@type" : "ListItem",
        "position" : 6,
        "name" : "CREATE EXTERNAL FUNCTION",
        "item" : "https://docs.aws.amazon.com/fr_fr/redshift/latest/dg/c_SQL_commands.html"
      }
    ]
}
</script></head><body><div id="main"><div style="display: none"><a href="redshift-dg.pdf#r_CREATE_EXTERNAL_FUNCTION" target="_blank" rel="noopener noreferrer" title="Ouvrir le PDF"></a></div><div id="breadcrumbs" class="breadcrumb"><a href="https://aws.amazon.com">AWS</a><a href="/index.html">Documentation</a><a href="/redshift/index.html">Amazon Redshift</a><a href="welcome.html">Guide du développeur de base de données</a></div><div id="page-toc-src"><a href="#r_CREATE_EXTERNAL_FUNCTION-privileges">Privilèges requis</a><a href="#r_CREATE_EXTERNAL_FUNCTION-synopsis">Syntaxe</a><a href="#r_CREATE_EXTERNAL_FUNCTION-parameters">Paramètres</a><a href="#r_CREATE_FUNCTION-usage-notes">Notes d’utilisation</a><a href="#r_CREATE_FUNCTION-examples">Exemples</a></div><div id="main-content" class="awsui-util-container"><div id="main-col-body"><awsdocs-language-banner data-service="$ctrl.pageService"></awsdocs-language-banner><awsui-alert class="awsdocs-page-banner awsui-util-mb-l"><p>Les traductions sont fournies par des outils de traduction automatique. En cas de conflit entre le contenu d'une traduction et celui de la version originale en anglais, la version anglaise prévaudra.</p></awsui-alert><h1 class="topictitle" id="r_CREATE_EXTERNAL_FUNCTION">CREATE EXTERNAL FUNCTION</h1><div class="awsdocs-page-header-container"><awsdocs-page-header></awsdocs-page-header><awsdocs-filter-selector id="awsdocs-filter-selector"></awsdocs-filter-selector></div><p>Crée une fonction scalaire définie par l’utilisateur (UDF) basée sur AWS Lambda pour Amazon Redshift. Pour plus d’informations sur les fonctions Lambda définies par l’utilisateur, consultez <a href="./udf-creating-a-lambda-sql-udf.html">Création d'une fonction scalaire Lambda définie par l'utilisateur</a>.</p>
         <h2 id="r_CREATE_EXTERNAL_FUNCTION-privileges">Privilèges requis</h2>
         <p>Les privilèges suivants sont requis pour CREATE EXTERNAL FUNCTION :</p>
         <div class="itemizedlist">
             
             
         <ul class="itemizedlist"><li class="listitem"><p>Superuser</p></li><li class="listitem"><p>Utilisateurs possédant le privilège CREATE [ OR REPLACE ] EXTERNAL FUNCTION</p></li></ul></div>
       
         <h2 id="r_CREATE_EXTERNAL_FUNCTION-synopsis">Syntaxe</h2>

         <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Texte"><awsui-icon name="copy"></awsui-icon></div></div><code class="nohighlight">CREATE [ OR REPLACE ] EXTERNAL FUNCTION <em>external_fn_name</em> ( [<em>data_type</em>] [, ...] )
RETURNS <em>data_type</em>
<span>{</span> VOLATILE | STABLE }
LAMBDA <em>'lambda_fn_name'</em>
IAM_ROLE <span>{</span> default | ‘arn:aws:iam::<code class="replaceable">&lt;Compte AWS-id&gt;</code>:role/<code class="replaceable">&lt;role-name&gt;</code>’
RETRY_TIMEOUT <em>milliseconds</em>
MAX_BATCH_ROWS count
MAX_BATCH_SIZE size [ KB | MB ];</code></pre>

         
         
         <p>Voici la syntaxe pour le machine learning sur Amazon Redshift. Pour obtenir des informations sur les paramètres spécifiques au modèle, consultez <a href="./r_GRANT.html#r_GRANT-parameters">Paramètres</a>.</p>
         <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Texte"><awsui-icon name="copy"></awsui-icon></div></div><code class="nohighlight">CREATE [ OR REPLACE ] EXTERNAL FUNCTION <em>external_fn_name</em> ( [<em>data_type</em>] [, ...] )
RETURNS <em>data_type</em>
<span>{</span> VOLATILE | STABLE }
SAGEMAKER<em>'endpoint_name'</em>
IAM_ROLE <span>{</span> default | ‘arn:aws:iam::<code class="replaceable">&lt;Compte AWS-id&gt;</code>:role/<code class="replaceable">&lt;role-name&gt;</code>’ };</code></pre>


       
         <h2 id="r_CREATE_EXTERNAL_FUNCTION-parameters">Paramètres</h2>


         <div class="variablelist">
             
             
             
             
            
             
          

             
            
         

             

             
             
          
         <dl>
               <dt><span class="term">OR REPLACE</span></dt>
               <dd>
                  <p>Clause qui spécifie que si une fonction ayant le même nom et les mêmes types de données pour les arguments en entrée, ou <em>signature</em>, existe déjà, la fonction existante est remplacée. Vous pouvez uniquement remplacer une fonction par une nouvelle fonction qui définit un ensemble identique de types de données. Vous devez être un super-utilisateur pour remplacer une fonction.</p>
                  <p>Si vous définissez une fonction avec le même nom qu’une fonction existante, mais avec une signature différente, vous créez une nouvelle fonction. En d’autres termes, le nom de la fonction est surchargé. Pour plus d'informations, consultez <a href="./udf-naming-udfs.html#udf-naming-overloading-function-names">Surcharge des noms de fonctions</a>.</p>
               </dd>
             
               <dt><span class="term"><em>external_fn_name</em></span></dt>
               <dd>
                  <p>Nom de la fonction externe. Si vous spécifiez un nom de schéma (tel que myschema.myfunction), la fonction est créée à l’aide du schéma spécifié. Sinon, la fonction est créée dans le schéma en cours. Pour plus d’informations sur les noms valides, consultez <a href="./r_names.html">Noms et identificateurs</a>. </p>
                  <p>Nous vous recommandons de nommer toutes les fonctions UDF en utilisant le préfixe <code class="code">f_</code>. Amazon Redshift réserve le préfixe <code class="code">f_</code> pour les noms de fonctions UDF. En utilisant le préfixe <code class="code">f_</code>, vous vous assurez que le nom de votre fonction UDF n’entrera pas en conflit avec le nom d’une fonction SQL intégrée pour Amazon Redshift, que ce soit maintenant ou à l’avenir. Pour plus d'informations, consultez <a href="./udf-naming-udfs.html">Attribution d'un nom aux fonctions UDF</a>.</p>
               </dd>
             
               <dt><span class="term"><em>data_type</em></span></dt>
               <dd>
                  <p>Type de données des arguments en entrée. Pour plus d'informations, consultez <a href="./c_Supported_data_types.html">Types de données</a>.</p>
               </dd>
             
               <dt><span class="term">RETURNS <em>type_données</em></span></dt>
               <dd>
                  <p>Type de données de la valeur renvoyée par la fonction. Le type de données RETURNS peut être n’importe quel type de données Amazon Redshift standard. Pour plus d'informations, consultez <a href="./udf-data-types.html">Types de données de fonctions Python définies par l'utilisateur</a>.</p>
               </dd>
             
               <dt><span class="term">VOLATILE | STABLE</span></dt>
               <dd>
                  <p>Informe l’optimiseur de requête à propos de l’instabilité de la fonction. </p>
                  <p>Pour obtenir la meilleure optimisation possible, qualifiez votre fonction avec la catégorie d’instabilité la plus stricte qui s’y applique. En matière de rigueur, en commençant par la moins stricte, les catégories d’instabilité sont les suivantes :</p>
                  <div class="itemizedlist">
                       
                      
                  <ul class="itemizedlist"><li class="listitem">
                        <p>VOLATILE</p>
                     </li><li class="listitem">
                        <p>STABLE</p>
                     </li></ul></div>
                  <p>VOLATILE</p>
                  <p>Soit les mêmes arguments, la fonction peut renvoyer des résultats différents sur des appels successifs, y compris pour les lignes d’une même instruction. L’optimiseur de requête ne peut pas émettre d’hypothèses concernant le comportement d’une fonction volatile. Une requête qui utilise une fonction volatile doit réévaluer la fonction pour chaque entrée.</p>
                  <p>STABLE</p>
                  <p>À partir des mêmes arguments, la fonction renvoie invariablement les mêmes résultats lors des appels successifs traités au sein d’une même instruction. La fonction peut renvoyer des résultats différents lorsqu’elle est appelée dans différents instructions. Cette catégorie vise ici à permettre à l’optimiseur de réduire le nombre de fois que la fonction est appelée au sein d’une même instruction.</p>
                  <p>Notez que si la rigueur choisie n’est pas valide pour la fonction, l’optimiseur risque d’ignorer certains appels basés sur cette rigueur. Cela peut produire un jeu de résultats incorrect.</p>
                  <p>La clause IMMUTABLE n’est actuellement pas prise en charge pour les fonctions UDF Lambda.</p>
                  

               </dd>
             
               <dt><span class="term">LAMBDA <em>’lambda_fn_name’</em> </span></dt>
               <dd>
                  <p> Nom de la fonction qu’Amazon Redshift appelle.</p>
                  <p>Pour connaître les étapes de création d’une fonction AWS Lambda, consultez <a href="https://docs.aws.amazon.com/lambda/latest/dg/getting-started-create-function.html">Créer une fonction Lambda avec la console</a> dans le <em>Guide du développeur AWS Lambda</em>.</p>
                 <p>Pour obtenir des informations sur les autorisations requises pour la fonction Lambda, consultez <a href="https://docs.aws.amazon.com/lambda/latest/dg/lambda-permissions.html">Autorisations AWS Lambda</a> dans le <em>Guide du développeur AWS Lambda</em>.</p>

               </dd>
             
               <dt><span class="term">IAM_ROLE <span>{</span> default | ‘arn:aws:iam::<code class="replaceable">&lt;Compte AWS-id&gt;</code>:role/<code class="replaceable">&lt;role-name&gt;</code>’ </span></dt>
               <dd>
                  <p>Utilisez le mot clé par défaut pour qu’Amazon Redshift utilise le rôle IAM défini par défaut et associé au cluster lorsque la commande CREATE EXTERNAL FUNCTION s’exécute.</p>
                  <p>Utilisez l’Amazon Resource Name (ARN) d’un rôle IAM que votre cluster utilise pour l’authentification et l’autorisation. La commande CREATE EXTERNAL FUNCTION est autorisée à invoquer les fonctions Lambda via ce rôle IAM. Si votre cluster dispose d’un rôle IAM existant avec les autorisations pour invoquer les fonctions Lambda attachées, vous pouvez remplacer l’ARN de votre rôle. Pour plus d'informations, consultez <a href="./udf-creating-a-lambda-sql-udf.html#udf-lambda-authorization">Configuration du paramètre d'autorisation pour les fonctions UDF Lambda</a>.</p>
                  <p>L’exemple suivant montre la syntaxe du paramètre IAM_ROLE.</p>
                  <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Texte"><awsui-icon name="copy"></awsui-icon></div></div><code class="nohighlight">IAM_ROLE 'arn:aws:iam::<em>aws-account-id</em>:role/<em>role-name</em>'</code></pre>
               </dd>
             
               <dt><span class="term">RETRY_TIMEOUT <em>millisecondes</em> </span></dt>
               <dd>
                  <p>Durée totale en millisecondes utilisée par Amazon Redshift pour les retards dans les interruptions de nouvelles tentatives. </p>
                  <p>Au lieu de lancer de nouvelles tentatives immédiatement pour toute requête ayant échoué, Amazon Redshift effectue des interruptions et attend un certain temps entre les nouvelles tentatives. Amazon Redshift lance ensuite la nouvelle demande pour exécuter à nouveau la requête ayant échoué jusqu’à ce que la somme de tous les retards soit égale ou supérieure à la valeur RETRY_TIMEOUT que vous avez spécifiée. La valeur par défaut est de 20 000 millisecondes.</p>
                  <p>Lorsqu’une fonction Lambda est appelée, Amazon Redshift lance une nouvelle tentative pour les requêtes qui reçoivent des erreurs telles que <code class="code">TooManyRequestsException</code>, <code class="code">EC2ThrottledException</code> et <code class="code">ServiceException</code>. </p>
                  <p>Vous pouvez définir le paramètre RETRY_TIMEOUT sur 0 millisecondes pour empêcher toute nouvelle tentative pour une UDF Lambda.</p>
               </dd>
             
               <dt><span class="term"><em>Nombre de</em> MAX_BATCH_ROWS</span></dt>
               <dd>
                  <p> Nombre maximum de lignes qu’Amazon Redshift envoie dans une seule demande par lot pour une seule invocation Lambda. </p>
                  <p> La valeur minimale pour ce paramètre est 1. La valeur maximale est INT_MAX ou 2 147 483 647. </p>
                  <p> Ce paramètre est facultatif. La valeur maximale est INT_MAX ou 2 147 483 647. </p>
               </dd>
             
            <dt><span class="term"><em>Taille</em> MAX_BATCH_SIZE [ KB | MB ] </span></dt>
            <dd>
               <p> Taille maximum de la charge utile de données qu’Amazon Redshift envoie dans une seule demande par lot pour une seule invocation Lambda. </p>
               <p> La valeur minimale pour ce paramètre est 1 Ko. La valeur maximale est 5 Mo. </p>
               <p> La valeur par défaut de ce paramètre est 5 Mo. </p>
               <p> Ko et Mo sont facultatifs. Si vous ne définissez pas l’unité de mesure, Amazon Redshift utilise Ko par défaut. </p>
            </dd>
         </dl></div>
       
         <h2 id="r_CREATE_FUNCTION-usage-notes">Notes d’utilisation</h2>
         <p>Lorsque vous créez des fonctions UDF Lambda, tenez compte des points suivants : </p>
         <div class="itemizedlist">
             
             
         <ul class="itemizedlist"><li class="listitem"><p>L’ordre des appels de fonctions Lambda au niveau des arguments d’entrée n’est ni fixe ni garanti. Il peut varier selon les instances de requêtes en cours d’exécution, en fonction de la configuration du cluster.</p></li><li class="listitem"><p>Il n’est pas garanti que les fonctions soient appliquées une seule fois à chaque argument d’entrée. L’interaction entre Amazon Redshift et AWS Lambda peut entraîner des appels répétitifs avec les mêmes entrées.</p></li></ul></div>
       
         <h2 id="r_CREATE_FUNCTION-examples">Exemples</h2>
         <p>Voici des exemples d’utilisation des fonctions scalaires définies par l’utilisateur (UDF) Lambda.</p>
          
            <h3 id="r_CREATE_FUNCTION-lambda-example-node">Exemple de fonction scalaire UDF Lambda utilisant une fonction Node.js Lambda</h3>
            <p>L’exemple suivant crée une fonction externe appelée <code class="code">exfunc_sum</code> qui prend deux entiers comme arguments d’entrée. Cette fonction renvoie la somme sous la forme d’une sortie de nombre entier. Le nom de la fonction Lambda à appeler est <code class="code">lambda_sum</code>. Le langage utilisé pour cette fonction Lambda est Node.js 12.x. Veillez à spécifier le rôle IAM. L’exemple utilise <code class="code">'arn:aws:iam::123456789012:user/johndoe'</code> en tant que rôle IAM.</p>
            
            <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Texte"><awsui-icon name="copy"></awsui-icon></div></div><code class="">CREATE EXTERNAL FUNCTION exfunc_sum(INT,INT)
RETURNS INT
VOLATILE
LAMBDA 'lambda_sum'
IAM_ROLE 'arn:aws:iam::123456789012:role/Redshift-Exfunc-Test';</code></pre>
            <p>La fonction Lambda prend la charge utile de la requête et effectue une itération sur chaque ligne. Toutes les valeurs d’une seule ligne sont ajoutées pour calculer la somme de cette ligne, qui est enregistrée dans la table de réponses. Le nombre de lignes dans la table de résultats est similaire au nombre de lignes reçues dans la charge utile de la requête. </p>
            <p>La charge utile de la réponse JSON doit avoir les données de résultat dans le champ « results » pour être reconnue par la fonction externe. Le champ arguments de la requête envoyée à la fonction Lambda contient la charge utile de données. Il peut y avoir plusieurs lignes dans la charge utile de données en cas de requête par lots. La fonction Lambda suivante effectue une itération sur toutes les lignes de la charge utile de données de la requête. Elle effectue également une itération individuelle sur toutes les valeurs d’une seule ligne.</p>
            <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Texte"><awsui-icon name="copy"></awsui-icon></div></div><code class="">exports.handler = async (event) =&gt; <span>{</span>
    // The 'arguments' field in the request sent to the Lambda function contains the data payload.
    var t1 = event['arguments'];

    // 'len(t1)' represents the number of rows in the request payload.
    // The number of results in the response payload should be the same as the number of rows received.
    const resp = new Array(t1.length);

    // Iterating over all the rows in the request payload.
    for (const [i, x] of t1.entries())
    <span>{</span>
        var sum = 0;
        // Iterating over all the values in a single row.
        for (const y of x) <span>{</span>
            sum = sum + y;
        }
        resp[i] = sum;
    }
    // The 'results' field should contain the results of the lambda call.
    const response = <span>{</span>
        results: resp
    };
    return JSON.stringify(response);
};</code></pre>
            <p>L’exemple suivant appelle la fonction externe avec des valeurs littérales.</p>
            
            <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Texte"><awsui-icon name="copy"></awsui-icon></div></div><code class="">select exfunc_sum(1,2);
exfunc_sum
------------
 3
(1 row)</code></pre>
            <p>L’exemple suivant crée une table appelée t_sum avec deux colonnes, c1 et c2, du type de données entier et insère deux lignes de données. Ensuite, la fonction externe est appelée en transmettant les noms de colonne de cette table. Les deux lignes de la table sont envoyées dans une requête par lots dans la charge utile de la requête sous la forme d’une seule invocation Lambda.</p>
            
<pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Texte"><awsui-icon name="copy"></awsui-icon></div></div><code class="">CREATE TABLE t_sum(c1 int, c2 int);
INSERT INTO t_sum VALUES (4,5), (6,7);
SELECT exfunc_sum(c1,c2) FROM t_sum;
 exfunc_sum
---------------
 9
 13
(2 rows)</code></pre>
          

         
          
            <h3 id="r_CREATE_FUNCTION-lambda-example-retry">Exemple de fonction scalaire UDF Lambda utilisant l’attribut RETRY_TIMEOUT</h3>
            <p>Dans la section suivante, vous trouverez un exemple d’utilisation de l’attribut RETRY_TIMEOUT dans les fonctions UDF Lambda. </p>
            <p>Les fonctions AWS Lambda ont des limites de simultanéité que vous pouvez définir pour chaque fonction. Pour plus d’informations sur les limites de simultanéité, consultez <a href="https://docs.aws.amazon.com/lambda/latest/dg/configuration-concurrency.html">Gestion de la simultanéité pour une fonction Lambda</a> dans le <em>Guide du développeur AWS Lambda</em> et le billet <a href="https://aws.amazon.com/blogs/compute/managing-aws-lambda-function-concurrency" rel="noopener noreferrer" target="_blank"><span>Gestion de la simultanéité des fonctions AWS Lambda</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a> sur le blog de calcul AWS. </p>
            <p>Lorsque le nombre de requêtes traitées par une fonction UDF Lambda dépasse les limites de simultanéité, les nouvelles requêtes renvoient l’erreur <code class="code">TooManyRequestsException</code>. La fonction UDF Lambda lance une nouvelle tentative pour cette erreur jusqu’à ce que la somme de tous les retards entre les requêtes envoyées à la fonction Lambda soit égale ou supérieure à la valeur RETRY_TIMEOUT que vous avez définie. La valeur RETRY_TIMEOUT par défaut est de 20 000 millisecondes.</p>
              <p>L’exemple suivant utilise une fonction Lambda nommée <code class="code">exfunc_sleep_3</code>. Cette fonction prend la charge utile de la requête, effectue une itération sur chaque ligne et convertit l’entrée en majuscules. Ensuite, elle passe en veille pendant 3 secondes puis renvoie le résultat. Le langage utilisé pour cette fonction Lambda est Python 3.8. </p>
            <p>Le nombre de lignes dans la table de résultats est similaire au nombre de lignes reçues dans la charge utile de la requête. La charge utile de la réponse JSON doit avoir les données de résultat dans le champ <code class="code">results</code> pour être reconnue par la fonction externe. Le champ <code class="code">arguments</code> dans la requête envoyée à la fonction Lambda contient la charge utile de données. Dans le cas d’une requête par lots, plusieurs lignes peuvent apparaître dans la charge utile de données.</p>
              <p>La limite de simultanéité pour cette fonction est spécifiquement définie sur 1 dans la simultanéité réservée pour démontrer l’utilisation de l’attribut RETRY_TIMEOUT. Lorsque l’attribut est défini sur 1, la fonction Lambda ne peut servir qu’une seule requête à la fois.</p>
            <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Texte"><awsui-icon name="copy"></awsui-icon></div></div><code class="">import json
import time
def lambda_handler(event, context):
    t1 = event['arguments']
    # 'len(t1)' represents the number of rows in the request payload.
    # The number of results in the response payload should be the same as the number of rows received.
    resp = [None]*len(t1)

    # Iterating over all rows in the request payload.
    for i, x in enumerate(t1):
        # Iterating over all the values in a single row.
        for j, y in enumerate(x):
            resp[i] = y.upper()

    time.sleep(3)
    ret = dict()
    ret['results'] = resp
    ret_json = json.dumps(ret)
    return ret_json</code></pre>
            <p>Voici deux exemples supplémentaires illustrant l’attribut RETRY_TIMEOUT. Ils invoquent chacun une seule fonction UDF Lambda. Lorsque la fonction UDF Lambda est appelée, chaque exemple exécute la même requête SQL pour appeler la fonction UDF Lambda à partir de deux séances de base de données simultanées. Lorsque la première requête qui appelle la fonction UDF Lambda est servie par la fonction UDF, la deuxième requête renvoie l’erreur <code class="code">TooManyRequestsException</code>. Cela se produit parce que vous avez spécifiquement défini la simultanéité réservée dans la fonction UDF sur 1. Pour obtenir des informations sur la définition de la simultanéité réservée pour les fonctions Lambda, consultez <a href="https://docs.aws.amazon.com/lambda/latest/dg/configuration-concurrency.html#configuration-concurrency-reservedconfiguration-concurrency-reserved">Configuration de la simultanéité réservée</a>.</p>


            

            <p>Le premier exemple ci-dessous définit l’attribut RETRY_TIMEOUT de la fonction UDF Lambda sur 0 milliseconde. Si la requête Lambda reçoit des exceptions de la fonction Lambda, Amazon Redshift n’effectue pas de nouvelle tentative. Ce résultat se produit car l’attribut RETRY_TIMEOUT est défini sur 0.</p>
            
            <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Texte"><awsui-icon name="copy"></awsui-icon></div></div><code class="">CREATE OR REPLACE EXTERNAL FUNCTION exfunc_upper(varchar)
RETURNS varchar
VOLATILE
LAMBDA 'exfunc_sleep_3'
IAM_ROLE 'arn:aws:iam::123456789012:role/Redshift-Exfunc-Test'
RETRY_TIMEOUT 0;</code></pre>
            <p>Lorsque la valeur RETRY_TIMEOUT est définie sur 0, vous pouvez exécuter les deux requêtes suivantes à partir de séances de base de données distinctes pour afficher des résultats différents.</p>
            <p>La première requête SQL qui utilise la fonction UDF Lambda s’exécute avec succès.</p>
            
            <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Texte"><awsui-icon name="copy"></awsui-icon></div></div><code class="">select exfunc_upper('Varchar');
 exfunc_upper
 --------------
 VARCHAR
(1 row)</code></pre>
            <p>La deuxième requête, qui est exécutée à partir d’une séance de base de données distincte en même temps, renvoie l’erreur <code class="code">TooManyRequestsException</code>.</p>
                  
            <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Texte"><awsui-icon name="copy"></awsui-icon></div></div><code class="">select exfunc_upper('Varchar');
ERROR:  Rate Exceeded.; Exception: TooManyRequestsException; ShouldRetry: 1
DETAIL:
-----------------------------------------------
error:  Rate Exceeded.; Exception: TooManyRequestsException; ShouldRetry: 1
code:      32103
context:query:     0
location:  exfunc_client.cpp:102
process:   padbmaster [pid=26384]
-----------------------------------------------</code></pre>

                  <p>Le deuxième exemple ci-dessous définit l’attribut RETRY_TIMEOUT de la fonction UDF Lambda sur 3 000 millisecondes. Même si la deuxième requête est exécutée simultanément, la fonction UDF Lambda recommence jusqu’à ce que le total des délais atteigne 3 000 millisecondes. Ainsi, les deux requêtes s’exécutent avec succès.</p>
                  
                  <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Texte"><awsui-icon name="copy"></awsui-icon></div></div><code class="">CREATE OR REPLACE EXTERNAL FUNCTION exfunc_upper(varchar)
RETURNS varchar
VOLATILE
LAMBDA 'exfunc_sleep_3'
IAM_ROLE 'arn:aws:iam::123456789012:role/Redshift-Exfunc-Test'
RETRY_TIMEOUT 3000;</code></pre>
                  <p>Lorsque RETRY_TIMEOUT est défini sur 3 000 millisecondes, vous pouvez exécuter les deux requêtes suivantes à partir de séances de base de données distinctes pour afficher les mêmes résultats.</p>
                  <p>La première requête SQL qui exécute la fonction UDF Lambda s’exécute avec succès.</p>
                  
                  <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Texte"><awsui-icon name="copy"></awsui-icon></div></div><code class="">select exfunc_upper('Varchar');
 exfunc_upper
 --------------
 VARCHAR
(1 row)</code></pre>
                  <p>La deuxième requête s’exécute simultanément, et la fonction UDF Lambda lance de nouvelles tentatives jusqu’à ce que le total des délais atteigne 3 000 millisecondes.</p>
                  
                  <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Texte"><awsui-icon name="copy"></awsui-icon></div></div><code class="">select exfunc_upper('Varchar');
 exfunc_upper
--------------
 VARCHAR
(1 row)</code></pre>

          

          
            <h3 id="r_CREATE_FUNCTION-lambda-example-python">Exemple de fonction scalaire UDF Lambda utilisant une fonction Python Lambda</h3>
            <p>L’exemple suivant crée une fonction externe appelée <code class="code">exfunc_multiplication</code> qui multiplie les nombres et renvoie un nombre entier. Cet exemple intègre les champs success et <code class="code">error_msg</code> dans la réponse Lambda. Le champ success est défini sur false lorsqu’il y a un dépassement d’entier dans le résultat de la multiplication et que la valeur du message <code class="code">error_msg</code> est définie sur <code class="code">Integer multiplication overflow</code>. La fonction <code class="code">exfunc_multiplication</code> prend trois nombres entiers comme arguments d’entrée et renvoie la somme sous la forme d’une sortie de nombre entier. </p>
            <p>Le nom de la fonction Lambda qui est appelée est <code class="code">lambda_multiplication</code>. Le langage utilisé pour cette fonction Lambda est Python 3.8. Veillez à spécifier le rôle IAM.</p>
            
            <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Texte"><awsui-icon name="copy"></awsui-icon></div></div><code class="">CREATE EXTERNAL FUNCTION exfunc_multiplication(int, int, int)
RETURNS INT
VOLATILE
LAMBDA 'lambda_multiplication'
IAM_ROLE 'arn:aws:iam::123456789012:role/Redshift-Exfunc-Test'; </code></pre>
            <p>La fonction Lambda prend la charge utile de la requête et effectue une itération sur chaque ligne. Toutes les valeurs d’une seule ligne sont multipliées pour calculer le résultat de cette ligne, qui est enregistré dans la liste de réponses. Cet exemple utilise une valeur success booléenne définie sur true par défaut. Si le résultat de multiplication d’une ligne a un dépassement d’entier, la valeur success est définie sur false. Ensuite, la boucle d’itération s’arrête. </p>
            <p>Lorsque la charge utile de la réponse est créée, si la valeur success est false, la fonction Lambda suivante ajoute le champ <code class="code">error_msg</code> dans la charge utile. Elle définit également le message d’erreur sur <code class="code">Integer multiplication overflow</code>. Si la valeur success est true, les données de résultat sont ajoutées dans le champ results. Le nombre de lignes dans la table de résultats, le cas échéant, est similaire au nombre de lignes reçues dans la charge utile de la requête. </p>
            <p>Le champ arguments de la requête envoyée à la fonction Lambda contient la charge utile de données. Il peut y avoir plusieurs lignes dans la charge utile de données en cas de demande par lots. La fonction Lambda suivante effectue une itération sur toutes les lignes de la charge utile de données de la requête et effectue une itération individuelle sur toutes les valeurs au sein d’une seule ligne. </p>
            <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Texte"><awsui-icon name="copy"></awsui-icon></div></div><code class="">import json
def lambda_handler(event, context):
    t1 = event['arguments']
    # 'len(t1)' represents the number of rows in the request payload.
    # The number of results in the response payload should be the same as the number of rows received.
    resp = [None]*len(t1)

    # By default success is set to 'True'.
    success = True
    # Iterating over all rows in the request payload.
    for i, x in enumerate(t1):
        mul = 1
        # Iterating over all the values in a single row.
        for j, y in enumerate(x):
            mul = mul*y

        # Check integer overflow.
        if (mul &gt;= 9223372036854775807 or mul &lt;= -9223372036854775808):
            success = False
            break
        else:
            resp[i] = mul
    ret = dict()
    ret['success'] = success
    if not success:
        ret['error_msg'] = "Integer multiplication overflow"
    else:
        ret['results'] = resp
    ret_json = json.dumps(ret)

    return ret_json</code></pre>

            <p>L’exemple suivant appelle la fonction externe avec des valeurs littérales.</p>
            
            <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Texte"><awsui-icon name="copy"></awsui-icon></div></div><code class="">SELECT exfunc_multiplication(8, 9, 2);
  exfunc_multiplication
---------------------------
          144
(1 row)</code></pre>

            <p>L’exemple suivant crée une table nommée t_multi avec trois colonnes, c1, c2 et c3, du type de données entier. La fonction externe est appelée en transmettant les noms de colonnes de cette table. Les données sont insérées de manière à provoquer un dépassement d’entier afin de montrer comment l’erreur est propagée.</p>
            
            <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Texte"><awsui-icon name="copy"></awsui-icon></div></div><code class="">CREATE TABLE t_multi (c1 int, c2 int, c3 int);
INSERT INTO t_multi VALUES (2147483647, 2147483647, 4);
SELECT exfunc_multiplication(c1, c2, c3) FROM t_multi;
DETAIL:
  -----------------------------------------------
  error:  Integer multiplication overflow
  code:      32004context:
  context:
  query:     38
  location:  exfunc_data.cpp:276
  process:   query2_16_38 [pid=30494]
  -----------------------------------------------</code></pre>
          




         
      <awsdocs-copyright class="copyright-print"></awsdocs-copyright><awsdocs-thumb-feedback right-edge="{{$ctrl.thumbFeedbackRightEdge}}"></awsdocs-thumb-feedback></div><noscript><div><div><div><div id="js_error_message"><p><img src="https://d1ge0kk1l5kms0.cloudfront.net/images/G/01/webservices/console/warning.png" alt="Avertissement" /> <strong>JavaScript est désactivé ou n'est pas disponible dans votre navigateur.</strong></p><p>Pour que vous puissiez utiliser la documentation AWS, Javascript doit être activé. Vous trouverez des instructions sur les pages d'aide de votre navigateur.</p></div></div></div></div></noscript><div id="main-col-footer" class="awsui-util-font-size-0"><div id="doc-conventions"><a target="_top" href="/general/latest/gr/docconventions.html">Conventions de rédaction</a></div><div class="prev-next"><div id="previous" class="prev-link" accesskey="p" href="./r_CREATE_DATASHARE.html">CREATE DATASHARE</div><div id="next" class="next-link" accesskey="n" href="./r_CREATE_EXTERNAL_SCHEMA.html">CREATE EXTERNAL SCHEMA</div></div></div><awsdocs-page-utilities></awsdocs-page-utilities></div><div id="quick-feedback-yes" style="display: none;"><div class="title">Cette page vous a-t-elle été utile ? - Oui</div><div class="content"><p>Merci de nous avoir fait part de votre satisfaction.</p><p>Si vous avez quelques minutes à nous consacrer, merci de nous indiquer ce qui vous a plu afin que nous puissions nous améliorer davantage.</p><p><awsui-button id="fblink" rel="noopener noreferrer" target="_blank" text="Commentaire" click="linkClick($event)" href="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=Redshift&amp;topic_url=https://docs.aws.amazon.com/fr_fr/redshift/latest/dg/r_CREATE_EXTERNAL_FUNCTION.html"></awsui-button></p></div></div><div id="quick-feedback-no" style="display: none;"><div class="title">Cette page vous a-t-elle été utile ? - Non</div><div class="content"><p>Merci de nous avoir avertis que cette page avait besoin d'être retravaillée. Nous sommes désolés de ne pas avoir répondu à vos attentes.</p><p>Si vous avez quelques minutes à nous consacrer, merci de nous indiquer comment nous pourrions améliorer cette documentation.</p><p><awsui-button id="fblink" rel="noopener noreferrer" target="_blank" text="Commentaire" click="linkClick($event)" href="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=Redshift&amp;topic_url=https://docs.aws.amazon.com/fr_fr/redshift/latest/dg/r_CREATE_EXTERNAL_FUNCTION.html"></awsui-button></p></div></div></div></body></div></awsdocs-view><div class="page-loading-indicator" id="page-loading-indicator"><awsui-spinner size="large"></awsui-spinner></div></div><div id="tools-panel" dom-region="tools"><awsdocs-tools-panel id="awsdocs-tools-panel"></awsdocs-tools-panel></div></awsui-app-layout><awsdocs-cookie-banner class="doc-cookie-banner"></awsdocs-cookie-banner></div></body></html>