<!DOCTYPE html>
    <html xmlns="http://www.w3.org/1999/xhtml" lang="fr-FR"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Règles de surveillance de requête WLM - Amazon Redshift</title><meta name="viewport" content="width=device-width,initial-scale=1" /><meta name="assets_root" content="/assets" /><meta name="target_state" content="cm-c-wlm-query-monitoring-rules" /><meta name="default_state" content="cm-c-wlm-query-monitoring-rules" /><link rel="icon" type="image/ico" href="/assets/images/favicon.ico" /><link rel="shortcut icon" type="image/ico" href="/assets/images/favicon.ico" /><link rel="canonical" href="https://docs.aws.amazon.com/fr_fr/redshift/latest/dg/cm-c-wlm-query-monitoring-rules.html" /><meta name="description" content="Dans la gestion des charges de travail (WLM) d’Amazon Redshift, les règles de surveillance des requêtes définissent des limites de performance basées sur des mesures pour les files d’attente WLM et spécifient les mesures à prendre lorsqu’une requête dépasse ces limites. Par exemple, pour une file d’attente dédiée aux requêtes de courte durée, vous pouvez créer une règle qui annule les requêtes qui s’exécutent pendant plus de 60 secondes. Si vous souhaitez effectuer un suivi des requêtes mal conçues, vous pouvez configurer une autre règle qui consigne les requêtes contenant des boucles imbriquées." /><meta name="deployment_region" content="IAD" /><meta name="product" content="Amazon Redshift" /><meta name="guide" content="Guide du développeur de base de données" /><meta name="abstract" content="Créez et gérez un entrepôt des données avec Amazon Redshift, service d’entrepôt des données au niveau de l’entreprise, pouvant atteindre plusieurs Po et entièrement géré." /><meta name="guide-locale" content="fr_fr" /><meta name="tocs" content="toc-contents.json" /><link rel="canonical" href="https://docs.aws.amazon.com/fr_fr/redshift/latest/dg/cm-c-wlm-query-monitoring-rules.html" /><link rel="alternative" href="https://docs.aws.amazon.com/id_id/redshift/latest/dg/cm-c-wlm-query-monitoring-rules.html" hreflang="id-id" /><link rel="alternative" href="https://docs.aws.amazon.com/id_id/redshift/latest/dg/cm-c-wlm-query-monitoring-rules.html" hreflang="id" /><link rel="alternative" href="https://docs.aws.amazon.com/de_de/redshift/latest/dg/cm-c-wlm-query-monitoring-rules.html" hreflang="de-de" /><link rel="alternative" href="https://docs.aws.amazon.com/de_de/redshift/latest/dg/cm-c-wlm-query-monitoring-rules.html" hreflang="de" /><link rel="alternative" href="https://docs.aws.amazon.com/redshift/latest/dg/cm-c-wlm-query-monitoring-rules.html" hreflang="en-us" /><link rel="alternative" href="https://docs.aws.amazon.com/redshift/latest/dg/cm-c-wlm-query-monitoring-rules.html" hreflang="en" /><link rel="alternative" href="https://docs.aws.amazon.com/es_es/redshift/latest/dg/cm-c-wlm-query-monitoring-rules.html" hreflang="es-es" /><link rel="alternative" href="https://docs.aws.amazon.com/es_es/redshift/latest/dg/cm-c-wlm-query-monitoring-rules.html" hreflang="es" /><link rel="alternative" href="https://docs.aws.amazon.com/fr_fr/redshift/latest/dg/cm-c-wlm-query-monitoring-rules.html" hreflang="fr-fr" /><link rel="alternative" href="https://docs.aws.amazon.com/fr_fr/redshift/latest/dg/cm-c-wlm-query-monitoring-rules.html" hreflang="fr" /><link rel="alternative" href="https://docs.aws.amazon.com/it_it/redshift/latest/dg/cm-c-wlm-query-monitoring-rules.html" hreflang="it-it" /><link rel="alternative" href="https://docs.aws.amazon.com/it_it/redshift/latest/dg/cm-c-wlm-query-monitoring-rules.html" hreflang="it" /><link rel="alternative" href="https://docs.aws.amazon.com/ja_jp/redshift/latest/dg/cm-c-wlm-query-monitoring-rules.html" hreflang="ja-jp" /><link rel="alternative" href="https://docs.aws.amazon.com/ja_jp/redshift/latest/dg/cm-c-wlm-query-monitoring-rules.html" hreflang="ja" /><link rel="alternative" href="https://docs.aws.amazon.com/ko_kr/redshift/latest/dg/cm-c-wlm-query-monitoring-rules.html" hreflang="ko-kr" /><link rel="alternative" href="https://docs.aws.amazon.com/ko_kr/redshift/latest/dg/cm-c-wlm-query-monitoring-rules.html" hreflang="ko" /><link rel="alternative" href="https://docs.aws.amazon.com/pt_br/redshift/latest/dg/cm-c-wlm-query-monitoring-rules.html" hreflang="pt-br" /><link rel="alternative" href="https://docs.aws.amazon.com/pt_br/redshift/latest/dg/cm-c-wlm-query-monitoring-rules.html" hreflang="pt" /><link rel="alternative" href="https://docs.aws.amazon.com/zh_cn/redshift/latest/dg/cm-c-wlm-query-monitoring-rules.html" hreflang="zh-cn" /><link rel="alternative" href="https://docs.aws.amazon.com/zh_tw/redshift/latest/dg/cm-c-wlm-query-monitoring-rules.html" hreflang="zh-tw" /><link rel="alternative" href="https://docs.aws.amazon.com/redshift/latest/dg/cm-c-wlm-query-monitoring-rules.html" hreflang="x-default" /><meta name="feedback-item" content="Redshift" /><meta name="this_doc_product" content="Amazon Redshift" /><meta name="this_doc_guide" content="Guide du développeur de base de données" /><script defer="" src="/assets/r/vendor4.js?version=2021.12.02"></script><script defer="" src="/assets/r/vendor3.js?version=2021.12.02"></script><script defer="" src="/assets/r/vendor1.js?version=2021.12.02"></script><script defer="" src="/assets/r/awsdocs-common.js?version=2021.12.02"></script><script defer="" src="/assets/r/awsdocs-doc-page.js?version=2021.12.02"></script><link href="/assets/r/vendor4.css?version=2021.12.02" rel="stylesheet" /><link href="/assets/r/awsdocs-common.css?version=2021.12.02" rel="stylesheet" /><link href="/assets/r/awsdocs-doc-page.css?version=2021.12.02" rel="stylesheet" /><script async="" id="awsc-panorama-bundle" type="text/javascript" src="https://prod.pa.cdn.uis.awsstatic.com/panorama-nav-init.js" data-config="{'appEntity':'aws-documentation','region':'us-east-1','service':'redshift'}"></script><meta id="panorama-serviceSubSection" value="Guide du développeur de base de données" /><meta id="panorama-serviceConsolePage" value="Règles de surveillance de requête WLM" /></head><body class="awsdocs awsui"><div class="awsdocs-container"><awsdocs-header></awsdocs-header><awsui-app-layout id="app-layout" class="awsui-util-no-gutters" ng-controller="ContentController as $ctrl" header-selector="awsdocs-header" navigation-hide="false" navigation-width="$ctrl.navWidth" navigation-open="$ctrl.navOpen" navigation-change="$ctrl.onNavChange($event)" tools-hide="$ctrl.hideTools" tools-width="$ctrl.toolsWidth" tools-open="$ctrl.toolsOpen" tools-change="$ctrl.onToolsChange($event)"><div id="guide-toc" dom-region="navigation"><awsdocs-toc></awsdocs-toc></div><div id="main-column" dom-region="content" tabindex="-1"><awsdocs-view class="awsdocs-view"><div id="awsdocs-content"><head><title>Règles de surveillance de requête WLM - Amazon Redshift</title><meta name="pdf" content="redshift-dg.pdf#cm-c-wlm-query-monitoring-rules" /><meta name="rss" content="Dochistory.rss" /><meta name="forums" content="http://forums.aws.amazon.com/forum.jspa?forumID=155" /><meta name="feedback" content="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=Redshift&amp;topic_url=https://docs.aws.amazon.com/fr_fr/redshift/latest/dg/cm-c-wlm-query-monitoring-rules.html" /><meta name="feedback-yes" content="feedbackyes.html?topic_url=https://docs.aws.amazon.com/fr_fr/redshift/latest/dg/cm-c-wlm-query-monitoring-rules.html" /><meta name="feedback-no" content="feedbackno.html?topic_url=https://docs.aws.amazon.com/fr_fr/redshift/latest/dg/cm-c-wlm-query-monitoring-rules.html" /><meta name="keywords" content="Amazon Redshift,AWS Redshift,Redshift,Redshift Spectrum,cluster,entrepôt des données,développeur,exemples de données,database,développeur de base de données,HLL" /><script type="application/ld+json">
{
    "@context" : "https://schema.org",
    "@type" : "BreadcrumbList",
    "itemListElement" : [
      {
        "@type" : "ListItem",
        "position" : 1,
        "name" : "AWS",
        "item" : "https://aws.amazon.com"
      },
      {
        "@type" : "ListItem",
        "position" : 2,
        "name" : "Amazon Redshift",
        "item" : "https://docs.aws.amazon.com/redshift/index.html"
      },
      {
        "@type" : "ListItem",
        "position" : 3,
        "name" : "Guide du développeur de base de données",
        "item" : "https://docs.aws.amazon.com/fr_fr/redshift/latest/dg"
      },
      {
        "@type" : "ListItem",
        "position" : 4,
        "name" : "Implémentation de la gestion de la charge de travail",
        "item" : "https://docs.aws.amazon.com/fr_fr/redshift/latest/dg/cm-c-implementing-workload-management.html"
      },
      {
        "@type" : "ListItem",
        "position" : 5,
        "name" : "Règles de surveillance de requête WLM",
        "item" : "https://docs.aws.amazon.com/fr_fr/redshift/latest/dg/cm-c-implementing-workload-management.html"
      }
    ]
}
</script></head><body><div id="main"><div style="display: none"><a href="redshift-dg.pdf#cm-c-wlm-query-monitoring-rules" target="_blank" rel="noopener noreferrer" title="Ouvrir le PDF"></a></div><div id="breadcrumbs" class="breadcrumb"><a href="https://aws.amazon.com">AWS</a><a href="/index.html">Documentation</a><a href="/redshift/index.html">Amazon Redshift</a><a href="welcome.html">Guide du développeur de base de données</a></div><div id="page-toc-src"><a href="#cm-c-wlm-defining-query-monitoring-rules">Définition d’une règle de surveillance de requête</a><a href="#cm-c-wlm-query-monitoring-metrics">Métriques de surveillance des requêtes pour cluster Amazon Redshift provisionné</a><a href="#cm-c-wlm-query-monitoring-metrics-serverless">Métriques de surveillance des requêtes pour Amazon Redshift sans serveur</a><a href="#cm-c-wlm-query-monitoring-templates">Modèles de règles de surveillance de requête</a><a href="#cm-c-wlm-qmr-tables-and-views">Tables et vues système pour les règles de surveillance de requête</a></div><div id="main-content" class="awsui-util-container"><div id="main-col-body"><awsdocs-language-banner data-service="$ctrl.pageService"></awsdocs-language-banner><awsui-alert class="awsdocs-page-banner awsui-util-mb-l"><p>Les traductions sont fournies par des outils de traduction automatique. En cas de conflit entre le contenu d'une traduction et celui de la version originale en anglais, la version anglaise prévaudra.</p></awsui-alert><h1 class="topictitle" id="cm-c-wlm-query-monitoring-rules">Règles de surveillance de requête WLM</h1><div class="awsdocs-page-header-container"><awsdocs-page-header></awsdocs-page-header><awsdocs-filter-selector id="awsdocs-filter-selector"></awsdocs-filter-selector></div><p>Dans la gestion des charges de travail (WLM) d’Amazon Redshift, les règles de surveillance des requêtes définissent des limites de performance basées sur des mesures pour les files d’attente WLM et spécifient les mesures à prendre lorsqu’une requête dépasse ces limites. Par exemple, pour une file d’attente dédiée aux requêtes de courte durée, vous pouvez créer une règle qui annule les requêtes qui s’exécutent pendant plus de 60 secondes. Si vous souhaitez effectuer un suivi des requêtes mal conçues, vous pouvez configurer une autre règle qui consigne les requêtes contenant des boucles imbriquées. </p><p>Vous définissez les règles de surveillance de requête dans le cadre de la configuration de la gestion de la charge de travail (WLM). Vous pouvez définir jusqu’à 25 règles par file d’attente, et jusqu’à 25 règles au total pour toutes les files d’attente. Chaque règle est composée au maximum de trois conditions (prédicats) et d’une action. Un <em>prédicat</em> est composé d’une métrique, d’une condition de comparaison (=, &lt; ou &gt; ) et d’une valeur. Si les conditions de l’ensemble des prédicats d’une règle sont respectées, l’action associée à cette règle est déclenchée. Les règles peuvent être associées aux actions log, hop et abort, comme discuté ci-après. </p><p>Les règles dans une file d’attente donnée s’appliquent uniquement aux requêtes en cours d’exécution dans cette file d’attente. Une règle est indépendante des autres règles. </p><p>WLM évalue les métriques toutes les 10 secondes. Si plusieurs règles sont déclenchées durant la même période, WLM déclenche l’action la plus grave : abort, puis hop, puis log. Si l’action est hop ou abort, elle est consignée et la requête est expulsée de la file d’attente. Si l’action est log, la requête continue à s’exécuter dans la file d’attente. WLM déclenche une seule action log par requête et par règle. Si la file d’attente contient d’autres règles, celles-ci restent en vigueur. Si l’action est hop et que la requête est acheminée vers une autre file d’attente, les règles relatives à la nouvelle file d’attente s’appliquent. Pour plus d’informations sur la surveillance des requêtes et le suivi des actions entreprises sur des requêtes spécifiques, consultez la collection d’exemples sur <a href="./wlm-short-query-acceleration.html">Utilisation de l’accélération des requêtes courtes</a>.</p><p>Lorsque l’ensemble des prédicats d’une règle sont respectés, WLM écrit une ligne dans la table système <a href="./r_STL_WLM_RULE_ACTION.html">STL_WLM_RULE_ACTION</a>. En outre, Amazon Redshift enregistre les métriques des requêtes en cours d’exécution dans <a href="./r_STV_QUERY_METRICS.html">STV_QUERY_METRICS</a>. Les métriques des requêtes terminées sont stockées dans <a href="./r_STL_QUERY_METRICS.html">STL_QUERY_METRICS</a>. </p>
         <h2 id="cm-c-wlm-defining-query-monitoring-rules">Définition d’une règle de surveillance de requête</h2>


         <p>Vous créez des règles de surveillance de requête dans le cadre de la configuration WLM, que vous définissez lors de la définition du groupe de paramètres de votre cluster.</p>



         <p>Vous pouvez créer des règles à l'aide du  AWS Management Console  JSON ou par programmation. </p>
         <div class="awsdocs-note"><div class="awsdocs-note-title"><awsui-icon name="status-info" variant="link"></awsui-icon><h6>Note</h6></div><div class="awsdocs-note-text"><p>Si vous créez des règles par programmation, il est recommandé d’utiliser la console afin de générer les données JSON à inclure dans la définition du groupe de paramètres. Pour plus d’informations, consultez <a href="https://docs.aws.amazon.com/redshift/latest/mgmt/managing-parameter-groups-console.html#parameter-group-modify-qmr-console">Création ou modification d’une règle de surveillance de requête à l’aide de la console</a> et <a href="https://docs.aws.amazon.com/redshift/latest/mgmt/working-with-parameter-groups.html#configure-parameters-using-the-cli">Configuration des valeurs des paramètres à l’aide de l’ AWS CLI</a> dans le <em>Guide de la gestion du cluster Amazon Redshift</em>. </p></div></div>

         <p>Pour définir une règle de surveillance de requête, spécifiez les éléments suivants :</p>
         <div class="itemizedlist">
             
             
             
         <ul class="itemizedlist"><li class="listitem">
               <p>Un nom de règle – Les noms des règles doivent être uniques au sein de la configuration WLM. Les noms de règles peut comporter jusqu’à 32 caractères alphanumériques ou traits de soulignement et ne doivent pas contenir d’espaces ni de guillemets. Vous pouvez disposer de jusqu’à 25 règles par file d’attente et la limite totale pour toutes les files d’attente est de 25 règles.</p>
            </li><li class="listitem">
               <p>Un ou plusieurs prédicats – Chaque règle peut comporter jusqu’à trois prédicats. Si l’ensemble des prédicats d’une règle sont respectés, l’action associée est déclenchée. Un prédicat se définit par un nom de métrique, un opérateur (=, &lt; ou &gt;) et une valeur. Par exemple : <code class="code">query_cpu_time &gt; 100000</code>. Pour obtenir une liste des métriques, ainsi que des exemples de valeurs pour différentes métriques, voir <a href="#cm-c-wlm-query-monitoring-metrics">Métriques de surveillance des requêtes pour cluster Amazon Redshift provisionné</a> plus loin dans cette section. </p>
            </li><li class="listitem">
               <p>Une action – Si plusieurs règles sont déclenchées, WLM choisit celle dont l’action est la plus grave. Les actions possibles sont les suivantes, par ordre croissant de gravité :</p>
               <div class="itemizedlist">
                   
                   
                   
                   
               <ul class="itemizedlist"><li class="listitem">
                     <p>Log – Cette action enregistre des informations sur la requête dans la table système STL_WLM_RULE_ACTION. Utilisez cette action si vous souhaitez uniquement écrire un enregistrement de journal. WLM crée au maximum un journal par requête et par règle. Suite à une action log, les autres règles restent en vigueur et WLM continue à surveiller la requête. </p>
                  </li><li class="listitem">
                     <p>Hop (uniquement disponible avec la gestion manuelle de la charge de travail) – Consigne l’action et fait sauter la requête vers la file d’attente correspondante suivante. S’il n’existe aucune autre file d’attente correspondante, la requête est annulée. QMR replace uniquement les instructions <a href="https://docs.aws.amazon.com/redshift/latest/dg/r_CREATE_TABLE_AS.html">CREATE TABLE AS</a> (CTAS) et les requêtes en lecture seule, telles que les instructions SELECT. Pour de plus amples informations, veuillez consulter <a href="./wlm-queue-hopping.html">Saut de file d’attente des requêtes WLM</a>. </p>
                  </li><li class="listitem">
                     <p>Abort – Journalise l’action et annule la requête. QMR n’arrête pas les instructions COPY et les opérations de maintenance, comme ANALYZE et VACUUM. </p>
                  </li><li class="listitem">
                     <p>Change priority (Modifier la priorité) (uniquement disponible avec la gestion automatique de la charge de travail) – Pour modifier la priorité d’une requête. </p>
                  </li></ul></div>
            </li></ul></div>

         
         <p>Pour limiter la durée d’exécution des requêtes, nous vous recommandons de créer une règle de surveillance de requête au lieu d’utiliser le délai WLM. Par exemple, vous pouvez définir <code class="code">max_execution_time</code> sur 50 000 millisecondes, comme illustré dans cet extrait JSON.</p>
         <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Texte"><awsui-icon name="copy"></awsui-icon></div></div><code class="json ">"max_execution_time": 50000</code></pre>
         <p>Mais, nous vous recommandons de définir une règle de surveillance de requête équivalente qui définit <code class="code">query_execution_time</code> sur 50 secondes, comme illustré dans cet extrait JSON.</p>
         <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Texte"><awsui-icon name="copy"></awsui-icon></div></div><code class="json ">"rules": 
[
    <span>{</span>
        "rule_name": "rule_query_execution",
        "predicate": [
            <span>{</span>
                "metric_name": "query_execution_time",
                "operator": "&gt;",
                "value": 50
            }
        ],
        "action": "abort"
    }            
]</code></pre>
         
         <p>Pour les étapes de création ou de modification d’une règle de surveillance des requêtes, consultez <a href="https://docs.aws.amazon.com/redshift/latest/mgmt/managing-parameter-groups-console.html#parameter-group-modify-qmr-console">Création ou modification d’une règle de surveillance des requêtes à l’aide de la console</a> et <a href="https://docs.aws.amazon.com/redshift/latest/mgmt/workload-mgmt-config.html#wlm-json-config-properties">Propriétés du paramètre wlm_json_configuration</a> dans le <em>Guide de la gestion du cluster Amazon Redshift</em>.</p>
         

         <p>Vous trouverez plus d’informations sur les règles de surveillance de requête dans les rubriques suivantes : </p>
         <div class="itemizedlist">
             

             

             
             
             
         <ul class="itemizedlist"><li class="listitem">
               <p>
                  <a href="#cm-c-wlm-query-monitoring-metrics">Métriques de surveillance des requêtes pour cluster Amazon Redshift provisionné</a>
               </p>
            </li><li class="listitem">
               <p>
                  <a href="#cm-c-wlm-query-monitoring-templates">Modèles de règles de surveillance de requête</a>
               </p>
            </li><li class="listitem">
               <p> <a href="https://docs.aws.amazon.com/redshift/latest/mgmt/managing-parameter-groups-console.html#parameter-group-modify-qmr-console">Création d’une règle à l’aide de la console</a> </p>
            </li><li class="listitem">
               <p> <a href="https://docs.aws.amazon.com/redshift/latest/mgmt/workload-mgmt-config.html">Configuration de la gestion de la charge de travail</a> </p>
            </li><li class="listitem">
               <p>
                  <a href="#cm-c-wlm-qmr-tables-and-views">Tables et vues système pour les règles de surveillance de requête</a>
               </p>
            </li></ul></div>
       
         <h2 id="cm-c-wlm-query-monitoring-metrics">Métriques de surveillance des requêtes pour cluster Amazon Redshift provisionné</h2>


         <p>Le tableau suivant décrit les métriques utilisées dans les règles de surveillance de requête. (Ces métriques diffèrent des métriques stockées dans les tables système <a href="./r_STV_QUERY_METRICS.html">STV_QUERY_METRICS</a> et <a href="./r_STL_QUERY_METRICS.html">STL_QUERY_METRICS</a>.) </p>
         <p>Pour une métrique donnée, le seuil de performance fait l’objet d’un suivi au niveau de la requête ou du segment. Pour plus d’informations sur les segments et les étapes, consultez<a href="./c-query-planning.html">Workflow d’exécution et de planification de requête</a>.</p>
         <div class="awsdocs-note"><div class="awsdocs-note-title"><awsui-icon name="status-info" variant="link"></awsui-icon><h6>Note</h6></div><div class="awsdocs-note-text"><p>Le paramètre <a href="./cm-c-defining-query-queues.html#wlm-timeout">Délai WLM</a> diffère des règles de surveillance de requête.</p></div></div>

         <div class="table-container"><div class="table-contents"><table id="w320aac43c57c15b9"><thead>
                  <tr>
                     <th>Métrique</th>
                     <th>Name (Nom)</th>
                     <th>Description</th>

                  </tr>
               </thead>
                  <tr>
                     <td tabindex="-1">Temps UC de la requête</td>
                     <td tabindex="-1">
                        <code class="code">query_cpu_time</code>
                     </td>
                     <td tabindex="-1">Temps UC utilisé par la requête (en secondes). <code class="code">CPU
                           time</code> diffère de <code class="code">Query execution time</code>. <p>Les valeurs valides sont comprises entre 0 et 999 999. </p></td>
                  </tr>
                  <tr>
                     <td tabindex="-1">Blocs lus</td>
                     <td tabindex="-1">
                        <code class="code">query_blocks_read</code>
                     </td>
                     <td tabindex="-1">Nombre de blocs de données d’1 Mo lus par la requête.<p>Les valeurs valides sont comprises entre 0 et 1 048 575. </p></td>
                  </tr>
                  <tr>
                     <td tabindex="-1">Nombre de lignes d’analyse</td>
                     <td tabindex="-1">
                        <code class="code">scan_row_count</code>
                     </td>
                     <td tabindex="-1">
                        <p>Nombre de lignes dans une étape d’analyse. Le nombre de lignes correspond au nombre total de lignes émises avant le filtrage des lignes marquées pour la suppression (lignes fantôme) et avant l’application des filtres de requête définis par l’utilisateur.</p>
                        <p>Les valeurs valides sont comprises entre 0 et 999 999 999 999 999. </p>
                     </td>
                  </tr>
                  <tr>
                     <td tabindex="-1">Durée d’exécution de la requête</td>
                     <td tabindex="-1">
                        <code class="code">query_execution_time</code>
                     </td>
                     <td tabindex="-1">Délai écoulé pour l’exécution d’une requête (en secondes). Le délai d’exécution n’inclut pas le temps d’attente dans une file d’attente.<p>Les valeurs valides sont comprises entre 0 et 86 399.</p></td>
                  </tr>
                  <tr>
                     <td tabindex="-1">Temps de file d’attente de la requête</td>
                     <td tabindex="-1">
                        <code class="code">query_queue_time</code>
                     </td>
                     <td tabindex="-1">Temps passé à attendre dans une file d’attente, en secondes. <p>Les valeurs valides sont comprises entre 0 et 86 399. </p></td>
                  </tr>
                  <tr>
                     <td tabindex="-1">Utilisation de l’UC</td>
                     <td tabindex="-1">
                        <code class="code">query_cpu_usage_percent</code>
                     </td>
                     <td tabindex="-1">Pourcentage de la capacité de l’UC utilisée par la requête.<p>Les valeurs valides sont comprises entre 0 et 6 399. </p></td>
                  </tr>
                  <tr>
                     <td tabindex="-1">Mémoire sur disque</td>
                     <td tabindex="-1">
                        <code class="code">query_temp_blocks_to_disk</code>
                     </td>
                     <td tabindex="-1">Espace disque temporairement utilisé pour écrire des résultats intermédiaires, en blocs d’1 Mo.<p>Les valeurs valides sont comprises entre 0 et 319 815 679. </p></td>  
                  </tr>
                  <tr>
                     <td tabindex="-1">Asymétrie d’UC</td>
                     <td tabindex="-1">
                        <code class="code">cpu_skew</code>
                     </td>
                     <td tabindex="-1">Ratio de l’utilisation maximale de l’UC pour une tranche afin d’obtenir l’utilisation moyenne de l’UC pour toutes les tranches. Cette métrique est définie au niveau du segment.<p>Les valeurs valides sont comprises entre 0 et 99.  </p></td>
                  </tr>
                  <tr>
                     <td tabindex="-1">Asymétrie d’I/O</td>
                     <td tabindex="-1">
                        <code class="code">io_skew</code>
                     </td>
                     <td tabindex="-1">Ratio du nombre maximal de blocs lus (I/O) pour une tranche quelconque afin d’obtenir le nombre moyen de blocs lus pour toutes les tranches. Cette métrique est définie au niveau du segment.<p>Les valeurs valides sont comprises entre 0 et 99.  </p></td>
                  </tr>

                  <tr>
                     <td tabindex="-1">Lignes jointes</td>
                     <td tabindex="-1">
                        <code class="code">join_row_count</code>
                     </td>
                     <td tabindex="-1">Nombre de lignes traitées dans une étape de jonction.<p>Les valeurs valides sont comprises entre 0 et 999 999 999 999 999. </p></td>
                  </tr>

                  <tr>
                     <td tabindex="-1">Nombre de lignes jointes de boucle imbriquée</td>
                     <td tabindex="-1">
                        <code class="code">nested_loop_join_row_count</code>
                     </td>
                     <td tabindex="-1">Nombre de lignes dans une jonction de boucles imbriquées.<p>Les valeurs valides sont comprises entre 0 et 999 999 999 999 999. </p></td>
                  </tr>
                  <tr>
                     <td tabindex="-1">Nombre de lignes renvoyées</td>
                     <td tabindex="-1">
                        <code class="code">return_row_count</code>
                     </td>
                     <td tabindex="-1">Nombre de lignes retournées par la requête.<p> Les valeurs valides sont comprises entre 0 et 999 999 999 999 999. </p></td>
                  </tr>
                  <tr>
                     <td tabindex="-1">Durée d’exécution de segment</td>
                     <td tabindex="-1">
                        <code class="code">segment_execution_time</code>
                     </td>
                     <td tabindex="-1">Délai écoulé pour l’exécution d’un seul segment (en secondes). Pour éviter ou réduire les risques d’erreurs d’échantillonnage, incluez <code class="code">segment_execution_time
                           &gt; 10</code> à vos règles.<p>Les valeurs valides sont comprises entre 0 et 86 388. </p></td>
                  </tr>

                  <tr>
                     <td tabindex="-1">Nombre de lignes d’analyse Spectrum</td>
                     <td tabindex="-1">
                        <code class="code">spectrum_scan_row_count</code>
                     </td>
                     <td tabindex="-1">Nombre de lignes de données dans Amazon S3 analysées par une requête Amazon Redshift Spectrum. <p>Les valeurs valides sont comprises entre 0 et 999 999 999 999 999. </p></td>
                  </tr>
                  <tr>
                     <td tabindex="-1">Taille d’analyse Spectrum</td>
                     <td tabindex="-1">
                        <code class="code">spectrum_scan_size_mb</code>
                     </td>
                     <td tabindex="-1">Taille des données dans Amazon S3, en Mo, analysées par une requête Amazon Redshift Spectrum.<p>Les valeurs valides sont comprises entre 0 et 999 999 999 999 999. </p></td>
                  </tr>
                  <tr>
                     <td tabindex="-1">Priorité de requête</td>
                     <td tabindex="-1">
                        <code class="code">query_priority</code>
                     </td>
                     <td tabindex="-1">Priorité de la requête. <p>Les valeurs valides sont <code class="code">HIGHEST</code>, <code class="code">HIGH</code>, <code class="code">NORMAL</code>, <code class="code">LOW</code> et <code class="code">LOWEST</code>. Si on compare <code class="code">query_priority</code> à l’aide des signes supérieur à (&gt;) et inférieur à (&lt;), <code class="code">HIGHEST</code> est supérieur à <code class="code">HIGH</code>, <code class="code">HIGH</code> est supérieur à <code class="code">NORMAL</code>, etc. </p></td>
                  </tr>
               </table></div></div>
         <div class="awsdocs-note"><div class="awsdocs-note-title"><awsui-icon name="status-info" variant="link"></awsui-icon><h6>Note</h6></div><div class="awsdocs-note-text"><div class="itemizedlist">
                
                
            <ul class="itemizedlist"><li class="listitem"><p>L’action de saut n’est pas prise en charge avec le prédicat <code class="code">query_queue_time</code>. Autrement dit, les règles définies pour le saut lorsqu’un prédicat <code class="code">query_queue_time</code> est atteint sont ignorées. </p></li><li class="listitem">
            <p>La courte durée d’exécution de segment peut entraîner des erreurs d’échantillonnage avec certaines métriques, notamment <code class="code">io_skew</code> et <code class="code">query_cpu_usage_percent</code>. Pour éviter ou réduire les risques d’erreurs d’échantillonnage, incluez une durée d’exécution de segment à vos règles. <code class="code">segment_execution_time &gt; 10</code> vous donne un bon point de départ.</p>
            </li></ul></div></div></div>
         <p>La vue <a href="./r_SVL_QUERY_METRICS.html">SVL_QUERY_METRICS</a> affiche les métriques des requêtes terminées. La vue <a href="./r_SVL_QUERY_METRICS_SUMMARY.html">SVL_QUERY_METRICS_SUMMARY</a> affiche les valeurs maximales des métriques des requêtes terminées. Utilisez les valeurs de ces vues afin de vous aider à déterminer les seuils permettant de définir les règles de surveillance des requêtes.</p>
       
         <h2 id="cm-c-wlm-query-monitoring-metrics-serverless">Métriques de surveillance des requêtes pour Amazon Redshift sans serveur</h2>
         <p>La table suivante décrit les métriques utilisées dans les règles de surveillance de requête pour Amazon Redshift sans serveur. </p>
            
         
         <div class="table-container"><div class="table-contents"><table id="w320aac43c57c17b5"><thead>
                  <tr>
                     <th>Métrique</th>
                     <th>Name (Nom)</th>
                     <th>Description</th>
                  </tr>
               </thead>
                  <tr>
                     <td tabindex="-1">Temps UC de la requête</td>
                     <td tabindex="-1"><code class="code">max_query_cpu_time</code></td>
                     <td tabindex="-1">Temps UC utilisé par la requête (en secondes). <code class="code">CPU time</code> diffère de <code class="code">Query execution time</code>. <p>Les valeurs valides sont comprises entre 0 et 999 999. </p></td>
                  </tr>
                  <tr>
                     <td tabindex="-1">Blocs lus</td>
                     <td tabindex="-1">
                        <code class="code">max_query_blocks_read</code>
                     </td>
                     <td tabindex="-1">Nombre de blocs de données d’1 Mo lus par la requête.<p>Les valeurs valides sont comprises entre 0 et 1 048 575. </p></td>
                  </tr>
                  <tr>
                     <td tabindex="-1">Nombre de lignes d’analyse</td>
                     <td tabindex="-1">
                        <code class="code">max_scan_row_count</code>
                     </td>
                     <td tabindex="-1">
                        <p>Nombre de lignes dans une étape d’analyse. Le nombre de lignes correspond au nombre total de lignes émises avant le filtrage des lignes marquées pour la suppression (lignes fantôme) et avant l’application des filtres de requête définis par l’utilisateur.</p>
                        <p>Les valeurs valides sont comprises entre 0 et 999 999 999 999 999. </p>
                     </td>
                  </tr>
                  <tr>
                     <td tabindex="-1">Durée d’exécution de la requête</td>
                     <td tabindex="-1">max_query_execution_time</td>
                     <td tabindex="-1">
                        <p>Délai écoulé pour l’exécution d’une requête (en secondes). Le délai d’exécution n’inclut pas le temps d’attente dans une file d’attente. Si une requête dépasse le délai d’exécution défini, Amazon Redshift sans serveur arrête la requête.</p>
                        <p>Les valeurs valides sont comprises entre 0 et 86 399. </p>
                     </td>
                  </tr>
                  <tr>
                     <td tabindex="-1">Temps de file d’attente de la requête</td>
                     <td tabindex="-1"><code class="code">max_query_queue_time</code></td>
                     <td tabindex="-1">Temps passé à attendre dans une file d’attente, en secondes. <p>Les valeurs valides sont comprises entre 0 et 86 399. </p></td>
                  </tr>
                  <tr>
                     <td tabindex="-1">Utilisation de l’UC</td>
                     <td tabindex="-1">
                        <code class="code">max_query_cpu_usage_percent</code>
                     </td>
                     <td tabindex="-1">Pourcentage de la capacité de l’UC utilisée par la requête.<p>Les valeurs valides sont comprises entre 0 et 6 399. </p></td>
                  </tr>
                  <tr>
                     <td tabindex="-1">Mémoire sur disque</td>
                     <td tabindex="-1">
                        <code class="code">max_query_temp_blocks_to_disk</code>
                     </td>
                     <td tabindex="-1">Espace disque temporairement utilisé pour écrire des résultats intermédiaires, en blocs d’1 Mo.<p>Les valeurs valides sont comprises entre 0 et 319 815 679. </p></td>  
                  </tr>
                  <tr>
                     <td tabindex="-1">Lignes jointes</td>
                     <td tabindex="-1">
                        <code class="code">max_join_row_count</code>
                     </td>
                     <td tabindex="-1">Nombre de lignes traitées dans une étape de jonction.<p>Les valeurs valides sont comprises entre 0 et 999 999 999 999 999. </p></td>
                  </tr>
                  <tr>
                     <td tabindex="-1">Nombre de lignes jointes de boucle imbriquée</td>
                     <td tabindex="-1">
                        <code class="code">max_nested_loop_join_row_count</code>
                     </td>
                     <td tabindex="-1">Nombre de lignes dans une jonction de boucles imbriquées.<p>Les valeurs valides sont comprises entre 0 et 999 999 999 999 999. </p></td>
                  </tr>
               </table></div></div>
         <div class="awsdocs-note"><div class="awsdocs-note-title"><awsui-icon name="status-info" variant="link"></awsui-icon><h6>Note</h6></div><div class="awsdocs-note-text"><div class="itemizedlist">
                
                
            <ul class="itemizedlist"><li class="listitem"><p>L’action de saut n’est pas prise en charge avec le prédicat <code class="code">max_query_queue_time</code>. Autrement dit, les règles définies pour le saut lorsqu’un prédicat <code class="code">max_query_queue_time</code> est atteint sont ignorées. </p></li><li class="listitem">
                  <p>La courte durée d’exécution de segment peut entraîner des erreurs d’échantillonnage avec certaines métriques, notamment <code class="code">max_io_skew</code> et <code class="code">max_query_cpu_usage_percent</code>.</p>
               </li></ul></div></div></div>
    
       
         <h2 id="cm-c-wlm-query-monitoring-templates">Modèles de règles de surveillance de requête</h2>



         <p>Lorsque vous ajoutez une règle à l’aide de la console Amazon Redshift, vous pouvez choisir de créer une règle à partir d’un modèle prédéfini. Amazon Redshift crée une règle avec un ensemble de prédicats auxquels sont attribuées les valeurs par défaut. L’action par défaut est log. Vous pouvez modifier les prédicats et l’action en fonction de votre cas d’utilisation. </p>
         <p>Le tableau suivant répertorie les modèles disponibles. </p>
         <div class="table-container"><div class="table-contents"><table id="w320aac43c57c19b7"><thead>
                  <tr>
                     <th>Nom du modèle</th>
                     <th>Prédicats</th>
                     <th>Description</th>

                  </tr>
               </thead>
                  <tr>
                     <td tabindex="-1">Jointure de boucle imbriquée</td>
                     <td tabindex="-1">
                        <code class="code">nested_loop_join_row_count &gt; 100</code>
                     </td>
                     <td tabindex="-1">Une jonction de boucles imbriquées peut correspondre à un prédicat de jonction incomplet, qui se traduit généralement par un très grand nombre de retours (un produit cartésien). Utilisez un nombre de lignes peu élevé afin de détecter très tôt une potentielle requête d’échappement.</td>
                  </tr>
                  <tr>
                     <td tabindex="-1">La requête renvoie un grand nombre de lignes</td>
                     <td tabindex="-1">
                        <code class="code">return_row_count &gt; 1000000</code>
                     </td>
                     <td tabindex="-1">Si une file d’attente est dédiée aux requêtes simples de courte durée, vous pouvez inclure une règle qui détecte les requêtes renvoyant un nombre élevé de lignes. Par défaut, le modèle utilise 1 million de lignes. Le nombre de lignes pouvant être désigné comme élevé dépend du système : ce sera un million de lignes sur certains systèmes, un milliard voire plus sur d’autres.</td>
                  </tr>
                  <tr>
                     <td tabindex="-1">Jointure avec un grand nombre de lignes</td>
                     <td tabindex="-1">
                        <code class="code">join_row_count &gt; 1000000000</code>
                     </td>
                     <td tabindex="-1">Une étape de jonction qui implique un nombre de lignes anormalement élevé peut signifier qu’il convient d’utiliser des filtres plus restrictifs. Par défaut, le modèle utilise 1 milliard de lignes. Pour une file d’attente ad hoc (ponctuelle) destinée à des requêtes rapides et simples, vous pouvez utiliser un nombre inférieur. </td>
                  </tr>
                  <tr>
                     <td tabindex="-1">Utilisation du disque élevée lors de l’écriture des résultats intermédiaires</td>
                     <td tabindex="-1">
                        <code class="code">query_temp_blocks_to_disk &gt; 100000</code>
                     </td>
                     <td tabindex="-1">Lorsque les requêtes en cours d’exécution utilisent davantage que la mémoire RAM système disponible, le moteur d’exécution des requêtes écrit les résultats intermédiaires sur le disque (mémoire déversée). En général, cette condition dérive d’une requête non autorisée, qui est habituellement la requête qui consomme le plus d’espace disque. Le seuil acceptable d’utilisation du disque varie selon le type et le nombre des nœuds de cluster. Par défaut, le modèle utilise 100 000 blocs ou 100 Go. Si le cluster est petit, vous pouvez utiliser un nombre inférieur. </td>
                  </tr>
                  <tr>
                     <td tabindex="-1">Requête de longue durée avec asymétrie I/O importante</td>
                     <td tabindex="-1"><code class="code">segment_execution_time &gt; 120</code> et <code class="code">io_skew &gt; 1.30</code> </td>
                     <td tabindex="-1">L’asymétrie d’I/O survient quand une tranche de nœud présente un débit d’I/O beaucoup plus élevé que les autres tranches. À la base, une asymétrie de 1,30 (1,3 X la moyenne) est considérée comme élevée. Une asymétrie d’I/O élevée ne constitue pas systématiquement un problème en soi. Si, toutefois, elle est combinée à une requête de longue durée, elle peut signifier la présence d’un problème au niveau du style de distribution ou de la clé de tri. </td>
                  </tr>
               </table></div></div>

       
         <h2 id="cm-c-wlm-qmr-tables-and-views">Tables et vues système pour les règles de surveillance de requête</h2>



         <p>Lorsque l’ensemble des prédicats d’une règle sont respectés, WLM écrit une ligne dans la table système <a href="./r_STL_WLM_RULE_ACTION.html">STL_WLM_RULE_ACTION</a>. Cette ligne contient les informations relatives à la requête qui a déclenché la règle et l’action qui en résulte. </p>
         <p>En outre, Amazon Redshift enregistre les métriques des requêtes dans les tables système et les vues suivantes.</p>
         <div class="itemizedlist">
             
             
             
             
         <ul class="itemizedlist"><li class="listitem">
               <p>Le tableau <a href="./r_STV_QUERY_METRICS.html">STV_QUERY_METRICS</a> affiche les métriques des requêtes en cours d’exécution.</p>
            </li><li class="listitem">
               <p>Le tableau <a href="./r_STL_QUERY_METRICS.html">STL_QUERY_METRICS</a> enregistre les métriques des requêtes terminées. </p>
            </li><li class="listitem">
               <p>La vue <a href="./r_SVL_QUERY_METRICS.html">SVL_QUERY_METRICS</a> affiche les métriques des requêtes terminées. </p>
            </li><li class="listitem">
               <p>La vue <a href="./r_SVL_QUERY_METRICS_SUMMARY.html">SVL_QUERY_METRICS_SUMMARY</a> affiche les valeurs maximales des métriques des requêtes terminées.</p>
            </li></ul></div>
      <awsdocs-copyright class="copyright-print"></awsdocs-copyright><awsdocs-thumb-feedback right-edge="{{$ctrl.thumbFeedbackRightEdge}}"></awsdocs-thumb-feedback></div><noscript><div><div><div><div id="js_error_message"><p><img src="https://d1ge0kk1l5kms0.cloudfront.net/images/G/01/webservices/console/warning.png" alt="Avertissement" /> <strong>JavaScript est désactivé ou n'est pas disponible dans votre navigateur.</strong></p><p>Pour que vous puissiez utiliser la documentation AWS, Javascript doit être activé. Vous trouverez des instructions sur les pages d'aide de votre navigateur.</p></div></div></div></div></noscript><div id="main-col-footer" class="awsui-util-font-size-0"><div id="doc-conventions"><a target="_top" href="/general/latest/gr/docconventions.html">Conventions de rédaction</a></div><div class="prev-next"><div id="previous" class="prev-link" accesskey="p" href="./cm-c-wlm-dynamic-example.html">Exemple WLM dynamique</div><div id="next" class="next-link" accesskey="n" href="./cm-c-wlm-system-tables-and-views.html">Tables et vues système WLM</div></div></div><awsdocs-page-utilities></awsdocs-page-utilities></div><div id="quick-feedback-yes" style="display: none;"><div class="title">Cette page vous a-t-elle été utile ? - Oui</div><div class="content"><p>Merci de nous avoir fait part de votre satisfaction.</p><p>Si vous avez quelques minutes à nous consacrer, merci de nous indiquer ce qui vous a plu afin que nous puissions nous améliorer davantage.</p><p><awsui-button id="fblink" rel="noopener noreferrer" target="_blank" text="Commentaire" click="linkClick($event)" href="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=Redshift&amp;topic_url=https://docs.aws.amazon.com/fr_fr/redshift/latest/dg/cm-c-wlm-query-monitoring-rules.html"></awsui-button></p></div></div><div id="quick-feedback-no" style="display: none;"><div class="title">Cette page vous a-t-elle été utile ? - Non</div><div class="content"><p>Merci de nous avoir avertis que cette page avait besoin d'être retravaillée. Nous sommes désolés de ne pas avoir répondu à vos attentes.</p><p>Si vous avez quelques minutes à nous consacrer, merci de nous indiquer comment nous pourrions améliorer cette documentation.</p><p><awsui-button id="fblink" rel="noopener noreferrer" target="_blank" text="Commentaire" click="linkClick($event)" href="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=Redshift&amp;topic_url=https://docs.aws.amazon.com/fr_fr/redshift/latest/dg/cm-c-wlm-query-monitoring-rules.html"></awsui-button></p></div></div></div></body></div></awsdocs-view><div class="page-loading-indicator" id="page-loading-indicator"><awsui-spinner size="large"></awsui-spinner></div></div><div id="tools-panel" dom-region="tools"><awsdocs-tools-panel id="awsdocs-tools-panel"></awsdocs-tools-panel></div></awsui-app-layout><awsdocs-cookie-banner class="doc-cookie-banner"></awsdocs-cookie-banner></div></body></html>