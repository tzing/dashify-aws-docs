<!DOCTYPE html>
    <html xmlns="http://www.w3.org/1999/xhtml" lang="fr-FR"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Étape 5 : Exécuter les commandes COPY - Amazon Redshift</title><meta name="viewport" content="width=device-width,initial-scale=1" /><meta name="assets_root" content="/assets" /><meta name="target_state" content="tutorial-loading-run-copy" /><meta name="default_state" content="tutorial-loading-run-copy" /><link rel="icon" type="image/ico" href="/assets/images/favicon.ico" /><link rel="shortcut icon" type="image/ico" href="/assets/images/favicon.ico" /><link rel="canonical" href="https://docs.aws.amazon.com/fr_fr/redshift/latest/dg/tutorial-loading-run-copy.html" /><meta name="description" content="Découvrez la syntaxe de base de la commande COPY, puis exécutez celle-ci dans votre client SQL avec différentes options pour apprendre à charger des tables dans différents formats." /><meta name="deployment_region" content="IAD" /><meta name="product" content="Amazon Redshift" /><meta name="guide" content="Guide du développeur de base de données" /><meta name="abstract" content="Créez et gérez un entrepôt des données avec Amazon Redshift, service d’entrepôt des données au niveau de l’entreprise, pouvant atteindre plusieurs Po et entièrement géré." /><meta name="guide-locale" content="fr_fr" /><meta name="tocs" content="toc-contents.json" /><link rel="canonical" href="https://docs.aws.amazon.com/fr_fr/redshift/latest/dg/tutorial-loading-run-copy.html" /><link rel="alternative" href="https://docs.aws.amazon.com/id_id/redshift/latest/dg/tutorial-loading-run-copy.html" hreflang="id-id" /><link rel="alternative" href="https://docs.aws.amazon.com/id_id/redshift/latest/dg/tutorial-loading-run-copy.html" hreflang="id" /><link rel="alternative" href="https://docs.aws.amazon.com/de_de/redshift/latest/dg/tutorial-loading-run-copy.html" hreflang="de-de" /><link rel="alternative" href="https://docs.aws.amazon.com/de_de/redshift/latest/dg/tutorial-loading-run-copy.html" hreflang="de" /><link rel="alternative" href="https://docs.aws.amazon.com/redshift/latest/dg/tutorial-loading-run-copy.html" hreflang="en-us" /><link rel="alternative" href="https://docs.aws.amazon.com/redshift/latest/dg/tutorial-loading-run-copy.html" hreflang="en" /><link rel="alternative" href="https://docs.aws.amazon.com/es_es/redshift/latest/dg/tutorial-loading-run-copy.html" hreflang="es-es" /><link rel="alternative" href="https://docs.aws.amazon.com/es_es/redshift/latest/dg/tutorial-loading-run-copy.html" hreflang="es" /><link rel="alternative" href="https://docs.aws.amazon.com/fr_fr/redshift/latest/dg/tutorial-loading-run-copy.html" hreflang="fr-fr" /><link rel="alternative" href="https://docs.aws.amazon.com/fr_fr/redshift/latest/dg/tutorial-loading-run-copy.html" hreflang="fr" /><link rel="alternative" href="https://docs.aws.amazon.com/it_it/redshift/latest/dg/tutorial-loading-run-copy.html" hreflang="it-it" /><link rel="alternative" href="https://docs.aws.amazon.com/it_it/redshift/latest/dg/tutorial-loading-run-copy.html" hreflang="it" /><link rel="alternative" href="https://docs.aws.amazon.com/ja_jp/redshift/latest/dg/tutorial-loading-run-copy.html" hreflang="ja-jp" /><link rel="alternative" href="https://docs.aws.amazon.com/ja_jp/redshift/latest/dg/tutorial-loading-run-copy.html" hreflang="ja" /><link rel="alternative" href="https://docs.aws.amazon.com/ko_kr/redshift/latest/dg/tutorial-loading-run-copy.html" hreflang="ko-kr" /><link rel="alternative" href="https://docs.aws.amazon.com/ko_kr/redshift/latest/dg/tutorial-loading-run-copy.html" hreflang="ko" /><link rel="alternative" href="https://docs.aws.amazon.com/pt_br/redshift/latest/dg/tutorial-loading-run-copy.html" hreflang="pt-br" /><link rel="alternative" href="https://docs.aws.amazon.com/pt_br/redshift/latest/dg/tutorial-loading-run-copy.html" hreflang="pt" /><link rel="alternative" href="https://docs.aws.amazon.com/zh_cn/redshift/latest/dg/tutorial-loading-run-copy.html" hreflang="zh-cn" /><link rel="alternative" href="https://docs.aws.amazon.com/zh_tw/redshift/latest/dg/tutorial-loading-run-copy.html" hreflang="zh-tw" /><link rel="alternative" href="https://docs.aws.amazon.com/redshift/latest/dg/tutorial-loading-run-copy.html" hreflang="x-default" /><meta name="feedback-item" content="Redshift" /><meta name="this_doc_product" content="Amazon Redshift" /><meta name="this_doc_guide" content="Guide du développeur de base de données" /><script defer="" src="/assets/r/vendor4.js?version=2021.12.02"></script><script defer="" src="/assets/r/vendor3.js?version=2021.12.02"></script><script defer="" src="/assets/r/vendor1.js?version=2021.12.02"></script><script defer="" src="/assets/r/awsdocs-common.js?version=2021.12.02"></script><script defer="" src="/assets/r/awsdocs-doc-page.js?version=2021.12.02"></script><link href="/assets/r/vendor4.css?version=2021.12.02" rel="stylesheet" /><link href="/assets/r/awsdocs-common.css?version=2021.12.02" rel="stylesheet" /><link href="/assets/r/awsdocs-doc-page.css?version=2021.12.02" rel="stylesheet" /><script async="" id="awsc-panorama-bundle" type="text/javascript" src="https://prod.pa.cdn.uis.awsstatic.com/panorama-nav-init.js" data-config="{'appEntity':'aws-documentation','region':'us-east-1','service':'redshift'}"></script><meta id="panorama-serviceSubSection" value="Guide du développeur de base de données" /><meta id="panorama-serviceConsolePage" value="Étape 5 : Exécuter les commandes COPY" /></head><body class="awsdocs awsui"><div class="awsdocs-container"><awsdocs-header></awsdocs-header><awsui-app-layout id="app-layout" class="awsui-util-no-gutters" ng-controller="ContentController as $ctrl" header-selector="awsdocs-header" navigation-hide="false" navigation-width="$ctrl.navWidth" navigation-open="$ctrl.navOpen" navigation-change="$ctrl.onNavChange($event)" tools-hide="$ctrl.hideTools" tools-width="$ctrl.toolsWidth" tools-open="$ctrl.toolsOpen" tools-change="$ctrl.onToolsChange($event)"><div id="guide-toc" dom-region="navigation"><awsdocs-toc></awsdocs-toc></div><div id="main-column" dom-region="content" tabindex="-1"><awsdocs-view class="awsdocs-view"><div id="awsdocs-content"><head><title>Étape 5 : Exécuter les commandes COPY - Amazon Redshift</title><meta name="pdf" content="redshift-dg.pdf#tutorial-loading-run-copy" /><meta name="rss" content="Dochistory.rss" /><meta name="forums" content="http://forums.aws.amazon.com/forum.jspa?forumID=155" /><meta name="feedback" content="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=Redshift&amp;topic_url=https://docs.aws.amazon.com/fr_fr/redshift/latest/dg/tutorial-loading-run-copy.html" /><meta name="feedback-yes" content="feedbackyes.html?topic_url=https://docs.aws.amazon.com/fr_fr/redshift/latest/dg/tutorial-loading-run-copy.html" /><meta name="feedback-no" content="feedbackno.html?topic_url=https://docs.aws.amazon.com/fr_fr/redshift/latest/dg/tutorial-loading-run-copy.html" /><meta name="keywords" content="Amazon Redshift,AWS Redshift,Redshift,Redshift Spectrum,cluster,entrepôt des données,développeur,exemples de données,database,développeur de base de données,HLL" /><script type="application/ld+json">
{
    "@context" : "https://schema.org",
    "@type" : "BreadcrumbList",
    "itemListElement" : [
      {
        "@type" : "ListItem",
        "position" : 1,
        "name" : "AWS",
        "item" : "https://aws.amazon.com"
      },
      {
        "@type" : "ListItem",
        "position" : 2,
        "name" : "Amazon Redshift",
        "item" : "https://docs.aws.amazon.com/redshift/index.html"
      },
      {
        "@type" : "ListItem",
        "position" : 3,
        "name" : "Guide du développeur de base de données",
        "item" : "https://docs.aws.amazon.com/fr_fr/redshift/latest/dg"
      },
      {
        "@type" : "ListItem",
        "position" : 4,
        "name" : "Chargement des données",
        "item" : "https://docs.aws.amazon.com/fr_fr/redshift/latest/dg/t_Loading_data.html"
      },
      {
        "@type" : "ListItem",
        "position" : 5,
        "name" : "Didacticiel : chargement des données à partir d’Amazon S3",
        "item" : "https://docs.aws.amazon.com/fr_fr/redshift/latest/dg/tutorial-loading-data.html"
      },
      {
        "@type" : "ListItem",
        "position" : 6,
        "name" : "Étape 5 : Exécuter les commandes COPY",
        "item" : "https://docs.aws.amazon.com/fr_fr/redshift/latest/dg/tutorial-loading-data.html"
      }
    ]
}
</script></head><body><div id="main"><div style="display: none"><a href="redshift-dg.pdf#tutorial-loading-run-copy" target="_blank" rel="noopener noreferrer" title="Ouvrir le PDF"></a></div><div id="breadcrumbs" class="breadcrumb"><a href="https://aws.amazon.com">AWS</a><a href="/index.html">Documentation</a><a href="/redshift/index.html">Amazon Redshift</a><a href="welcome.html">Guide du développeur de base de données</a></div><div id="page-toc-src"><a href="#tutorial-loading-data-copy-syntax">Syntaxe de la commande COPY</a><a href="#tutorial-loading-run-copy-load-tables">Chargement des tables SSB</a></div><div id="main-content" class="awsui-util-container"><div id="main-col-body"><awsdocs-language-banner data-service="$ctrl.pageService"></awsdocs-language-banner><awsui-alert class="awsdocs-page-banner awsui-util-mb-l"><p>Les traductions sont fournies par des outils de traduction automatique. En cas de conflit entre le contenu d'une traduction et celui de la version originale en anglais, la version anglaise prévaudra.</p></awsui-alert><h1 class="topictitle" id="tutorial-loading-run-copy">Étape 5 : Exécuter les commandes COPY</h1><div class="awsdocs-page-header-container"><awsdocs-page-header></awsdocs-page-header><awsdocs-filter-selector id="awsdocs-filter-selector"></awsdocs-filter-selector></div><p>Vous exécutez des commandes COPY pour charger chacune des tables dans le schéma SSB. Les exemples de commande COPY illustrent le chargement dans différents formats, à l’aide de plusieurs options de la commande COPY, ainsi que la résolution des erreurs de chargement.</p><div class="highlights" id="inline-topiclist"><h6>Rubriques</h6><ul><li><a href="#tutorial-loading-data-copy-syntax">Syntaxe de la commande COPY</a></li><li><a href="#tutorial-loading-run-copy-load-tables">Chargement des tables SSB</a></li></ul></div>
            <h2 id="tutorial-loading-data-copy-syntax">Syntaxe de la commande COPY</h2>


            <p>La syntaxe de base de la commande <a href="./r_COPY.html">COPY</a> est la suivante. </p>
            <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Texte"><awsui-icon name="copy"></awsui-icon></div></div><code class="">COPY table_name [ column_list ] FROM data_source CREDENTIALS access_credentials [options] </code></pre>
            <p>Pour exécuter une commande COPY, fournissez les valeurs suivantes. </p>
             
                <h6>Nom de la table </h6>
                <p>Table cible de la commande COPY. La table doit déjà exister dans la base de données. La table peut être temporaire ou permanente. La commande COPY ajoute les nouvelles données d’entrée à toutes les lignes existantes de la table. </p>
             
             
                <h6>Liste de colonnes</h6>
                <p>Par défaut, la commande COPY charge les champs depuis les données source dans les colonnes de la table dans l’ordre. Vous pouvez spécifier facultativement une <em>liste de colonnes,</em>, qui une liste séparée par des virgules des noms de colonnes, pour mapper les champs de données à des colonnes spécifiques. Vous n’utilisez pas de listes de colonnes de ce didacticiel. Pour plus d’informations, consultez <a href="./copy-parameters-column-mapping.html#copy-column-list">Column List</a> dans la référence de la commande COPY.</p>
             
            <p><span class="topcon">Source de données</span></p>
            <p>Vous pouvez utiliser la commande COPY pour charger les données à partir d’un compartiment Amazon S3, un cluster Amazon EMR, un hôte distant à l’aide d’une connexion SSH, ou d’une table Amazon DynamoDB. Dans le cadre de ce didacticiel, vous chargez des fichiers de données dans un compartiment Amazon S3. Lorsque vous chargez depuis Amazon S3, vous devez fournir le nom du compartiment et l’emplacement des fichiers de données. Pour cela, fournissez soit un chemin d’accès à l’objet pour les fichiers de données ou l’emplacement du fichier manifeste qui répertorie explicitement chaque fichier de données et son emplacement. </p>
            <div class="itemizedlist">
                 
                 
            <ul class="itemizedlist"><li class="listitem">
                    <p>Préfixe de clé </p>
                    <p>Un objet stocké dans Amazon S3 est identifié par la clé d’objet, qui inclut le nom du compartiment, les noms des dossiers, le cas échéant, et le nom de l’objet. Un <em>préfixe de clé </em>fait référence à un ensemble d’objets portant le même préfixe. Le chemin d’accès de l’objet est un préfixe de clé que la commande COPY utilise pour charger tous les objets partageant le même préfixe de clé. Par exemple, le préfixe de clé <code class="code">custdata.txt</code> peut faire référence à un seul fichier ou à un ensemble de fichiers, notamment <code class="code">custdata.txt.001</code>, <code class="code">custdata.txt.002</code> et ainsi de suite. </p>
                </li><li class="listitem">
                    <p>Fichier manifeste</p>
                    <p>Dans certains cas, vous aurez peut-être besoin de charger des fichiers avec des préfixes différentes, par exemple des fichiers provenant de plusieurs compartiments ou dossiers. Dans d’autres, vous devrez peut-être exclure des fichiers qui partagent un préfixe. Dans ces cas, vous pouvez utiliser un fichier manifeste. Un <em>fichier manifeste</em> répertorie explicitement chaque fichier de chargement et sa clé d’objet unique. Vous utilisez un fichier manifeste pour charger la table PART ultérieurement dans ce didacticiel. </p>
                </li></ul></div>
             
                <h6>Informations d’identification</h6>
                <p>Pour accéder aux  AWS  ressources contenant les données à charger, vous devez fournir les informations d'identification d' AWS accès à un utilisateur disposant de privilèges suffisants. Ces informations d’identification incluent un rôle IAM Amazon Resource Name (ARN). Pour charger des données depuis Amazon S3, les informations d'identification doivent inclure les  GetObject autorisations  ListBucket  et les autorisations. Des informations d’identification supplémentaires sont nécessaires si vos données sont chiffrées. Pour plus d’informations, consultez <a href="./copy-parameters-authorization.html">Paramètres d’autorisation</a> dans la référence de la commande COPY. Pour plus d’informations sur la gestion de l’accès, consultez <a href="https://docs.aws.amazon.com/AmazonS3/latest/dev/s3-access-control.html">Gestion des autorisations d’accès à vos ressources Amazon S3</a>. </p>
             
            <p><span class="topcon">Options</span></p>
            <p>Vous pouvez spécifier un certain nombre de paramètres avec la commande COPY afin de définir les formats de fichiers, gérer les formats de données, gérer les erreurs et contrôler d’autres fonctions. Dans ce didacticiel, vous utilisez les fonctions et les options de la commande COPY suivantes : </p>
            <div class="itemizedlist">
                 
                 
                 
                 
                 
                 
                 
                 
                 
                 
                 
                 
                 
            <ul class="itemizedlist"><li class="listitem">
                    <p>Préfixe de clé</p>
                    <p>Pour plus d’informations sur le chargement à partir de plusieurs fichiers en spécifiant un préfixe de clé, consultez <a href="#tutorial-loading-load-part">Charger la table PART à l’aide de NULL AS</a>.</p>
                </li><li class="listitem">
                    <p>Format CSV</p>
                    <p>Pour plus d’informations sur le chargement de données au format CSV, consultez <a href="#tutorial-loading-load-part">Charger la table PART à l’aide de NULL AS</a>.</p>
                </li><li class="listitem">
                    <p>NULL AS</p>
                    <p>Pour plus d’informations sur le chargement de PART à l’aide de l’option NULL AS, consultez <a href="#tutorial-loading-load-part">Charger la table PART à l’aide de NULL AS</a>.</p>
                </li><li class="listitem">
                    <p>Format délimité par un caractère</p>
                    <p>Pour plus d’informations sur l’utilisation de l’option DELIMITER, consultez <a href="#tutorial-loading-load-supplier">Charger la table SUPPLIER à l’aide de REGION</a>.</p>
                </li><li class="listitem">
                    <p>REGION</p>
                    <p>Pour plus d’informations sur l’utilisation de l’option REGION, consultez <a href="#tutorial-loading-load-supplier">Charger la table SUPPLIER à l’aide de REGION</a>.</p>
                </li><li class="listitem">
                    <p>Largeur de format fixe</p>
                    <p>Pour plus d’informations sur le chargement de la table CUSTOMER à partir de données de largeur fixe, consultez <a href="#tutorial-loading-load-customer">Charger la table CUSTOMER à l’aide de MANIFEST</a>.</p>
                </li><li class="listitem">
                    <p>MAXERROR</p>
                    <p>Pour plus d’informations sur l’utilisation de l’option MAXERROR, consultez <a href="#tutorial-loading-load-customer">Charger la table CUSTOMER à l’aide de MANIFEST</a>.</p>
                </li><li class="listitem">
                    <p>ACCEPTINVCHARS</p>
                    <p>Pour plus d’informations sur l’utilisation de l’option ACCEPTINVCHARS, consultez <a href="#tutorial-loading-load-customer">Charger la table CUSTOMER à l’aide de MANIFEST</a>.</p>
                </li><li class="listitem">
                    <p>MANIFEST</p>
                    <p>Pour plus d’informations sur l’utilisation de l’option MANIFEST, consultez <a href="#tutorial-loading-load-customer">Charger la table CUSTOMER à l’aide de MANIFEST</a>.</p>
                </li><li class="listitem">
                    <p>DATEFORMAT</p>
                    <p>Pour plus d’informations sur l’utilisation de l’option DATEFORMAT, consultez <a href="#tutorial-loading-load-dwdate">Charger la table DWDATE à l’aide de DATEFORMAT</a>.</p>
                </li><li class="listitem">
                    <p>GZIP, LZOP et BZIP2</p>
                    <p>Pour plus d’informations sur la compression de vos fichiers, consultez <a href="#tutorial-loading-load-lineorder">Charger la table LINEORDER à l’aide de plusieurs fichiers</a>.</p>
                </li><li class="listitem">
                    <p>COMPUPDATE</p>
                    <p>Pour plus d’informations sur l’utilisation de l’option COMPUPDATE, consultez <a href="#tutorial-loading-load-lineorder">Charger la table LINEORDER à l’aide de plusieurs fichiers</a>.</p>
                </li><li class="listitem">
                    <p>Plusieurs fichiers</p>
                    <p>Pour plus d’informations sur le chargement de plusieurs fichiers, consultez <a href="#tutorial-loading-load-lineorder">Charger la table LINEORDER à l’aide de plusieurs fichiers</a>.</p>
                </li></ul></div>
         
            <h2 id="tutorial-loading-run-copy-load-tables">Chargement des tables SSB</h2>

            <p>Vous utilisez les commandes COPY suivantes pour charger chacune des tables dans le schéma SSB. La commande de chaque table illustre les différentes options COPY et des techniques de résolution des problèmes.</p>
            <p>Pour charger les tables SSB, procédez comme suit :  </p>
            <div class="orderedlist">
                 
                 
                 
                 
                 
                 
            <ol><li>
                    <p><a href="#tutorial-loading-run-copy-replaceables">Remplacez le nom et les  AWS  informations d'identification du bucket</a></p>

                </li><li>
                    <p><a href="#tutorial-loading-load-part">Charger la table PART à l’aide de NULL AS</a></p>

                </li><li>
                    <p><a href="#tutorial-loading-load-supplier">Charger la table SUPPLIER à l’aide de REGION</a></p>

                </li><li>
                    <p><a href="#tutorial-loading-load-customer">Charger la table CUSTOMER à l’aide de MANIFEST</a></p>

                </li><li>
                    <p><a href="#tutorial-loading-load-dwdate">Charger la table DWDATE à l’aide de DATEFORMAT</a></p>

                </li><li>
                    <p><a href="#tutorial-loading-load-lineorder">Charger la table LINEORDER à l’aide de plusieurs fichiers</a></p>

                </li></ol></div>
             
                <h3 id="tutorial-loading-run-copy-replaceables">Remplacez le nom et les  AWS  informations d'identification du bucket</h3>

                <p>Les commandes COPY de ce didacticiel sont présentées au format suivant.</p>
                
                <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Texte"><awsui-icon name="copy"></awsui-icon></div></div><code class="nohighlight">copy table from 's3://<code class="replaceable">&lt;your-bucket-name&gt;</code>/load/<em>key_prefix</em>' 
credentials 'aws_iam_role=arn:aws:iam::<code class="replaceable">&lt;aws-account-id&gt;</code>:role/<code class="replaceable">&lt;role-name&gt;</code>'
options;</code></pre>
                
                <p>Pour chaque commande COPY, procédez de la façon suivante :</p>
                <div class="orderedlist">
                     
                     
                <ol><li>
                        <p>Remplacez <code class="replaceable">&lt; your-bucket-name &gt;</code> par le nom d'un compartiment situé dans la même région que votre cluster. </p>
                        <p>Cette étape suppose que le compartiment et le cluster se situent dans la même région. Vous pouvez aussi spécifier la région à l’aide de l’option <a href="./copy-parameters-data-source-s3.html#copy-region">REGION</a> de la commande COPY. </p>
                    </li><li>
                        <p>Remplacez <code class="replaceable">&lt; aws-account-id &gt;</code> et<code class="replaceable"></code> &lt;role-name&gt;par votre propre rôle  Compte AWS  et celui d'IAM. Le segment de la chaîne d’informations d’identification entre guillemets simples ne doit pas comporter d’espaces ou de sauts de ligne. Notez que le format de l’ARN peut être légèrement différent de celui de l’exemple. Il est préférable de copier l’ARN du rôle depuis la console IAM afin de garantir son exactitude lorsque vous exécutez les commandes COPY. </p>
                        
                    </li></ol></div>
             
             
                <h3 id="tutorial-loading-load-part">Charger la table PART à l’aide de NULL AS</h3>

                <p>Au cours de cette étape, vous utilisez les options CSV et NULL AS pour charger la table PART. </p>
                <p>La commande COPY peut charger des données depuis plusieurs fichiers en parallèle, ce qui est beaucoup plus rapide que le chargement depuis un seul fichier. Pour illustrer ce principe, les données de chaque table de ce didacticiel sont divisées réparties dans huit fichiers, même si les fichiers sont très petits. Au cours d’une étape ultérieure, vous comparez la différence de temps entre le chargement d’un fichier unique et le chargement de plusieurs fichiers. Pour plus d'informations, consultez <a href="./c_best-practices-use-multiple-files.html">Chargement de fichiers de données</a>. </p>
                 
                    <h6>Préfixe de clé</h6>
                    <p>Vous pouvez charger à partir de plusieurs fichiers en spécifiant un préfixe de clé à l’ensemble de fichiers ou en répertoriant explicitement les fichiers dans un fichier manifeste. Au cours de cette étape, vous utilisez un préfixe de clé. Au cours d’une étape ultérieure, vous utilisez un fichier manifeste. Le préfixe de clé <code class="code">'s3://mybucket/load/part-csv.tbl'</code> charge l’ensemble de fichiers suivant dans le dossier <code class="code">load</code>. </p>
                 
                <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Texte"><awsui-icon name="copy"></awsui-icon></div></div><code class="">part-csv.tbl-000
part-csv.tbl-001
part-csv.tbl-002
part-csv.tbl-003
part-csv.tbl-004
part-csv.tbl-005
part-csv.tbl-006
part-csv.tbl-007
</code></pre>
                 
                    <h6>Format CSV</h6>
                    <p>Le format CSV, qui signifie des valeurs séparées par une virgule, est un format couramment utilisé pour importer et exporter les données de feuille de calcul. Le format CSV est plus souple que le format séparé par une virgule, car il vous permet d’inclure des chaînes entre guillemets dans les champs. Le type de guillemets par défaut pour la commande COPY exécutée depuis le format CSV est celui des guillemets doubles ( " ), mais vous pouvez spécifier un autre type de guillemets à l’aide de l’option QUOTE AS. Lorsque vous utilisez les guillemets dans un champ, précédez le caractère de guillemets supplémentaires.</p>
                 
                <p>L’extrait suivant d’un fichier de données au format CSV pour la table PART illustre des chaînes entourées de guillemets (<code class="code">"LARGE ANODIZED
                    BRASS"</code>). Il montre également une chaîne entourée de doubles guillemets dans une chaîne entourée de guillemets (<code class="code">"MEDIUM ""BURNISHED"" TIN"</code>).</p>
                <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Texte"><awsui-icon name="copy"></awsui-icon></div></div><code class="">15,dark sky,MFGR#3,MFGR#47,MFGR#3438,indigo,"LARGE ANODIZED BRASS",45,LG CASE
22,floral beige,MFGR#4,MFGR#44,MFGR#4421,medium,"PROMO, POLISHED BRASS",19,LG DRUM
23,bisque slate,MFGR#4,MFGR#41,MFGR#4137,firebrick,"MEDIUM ""BURNISHED"" TIN",42,JUMBO JAR</code></pre>
                <p>Les données de la table PART contiennent des caractères qui entraînent l’échec de la commande COPY. Dans cet exercice, vous allez résoudre les erreurs et les corriger. </p>
                <p>Pour charger des données au format , ajoutez <code class="code">csv</code>csv à votre commande COPY. Exécutez la commande suivante afin de charger la table PART. </p>
                
                
                <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Texte"><awsui-icon name="copy"></awsui-icon></div></div><code class="nohighlight">copy part from 's3://<code class="replaceable">&lt;your-bucket-name&gt;</code>/load/part-csv.tbl' 
credentials 'aws_iam_role=arn:aws:iam::<code class="replaceable">&lt;aws-account-id&gt;</code>:role/<code class="replaceable">&lt;role-name&gt;</code>'
csv;</code></pre>
                
                <p>Vous pourriez recevoir un message d’erreur similaire au suivant.</p>
                <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Texte"><awsui-icon name="copy"></awsui-icon></div></div><code class="">An error occurred when executing the SQL command:
copy part from 's3://mybucket/load/part-csv.tbl' 
credentials' ...

ERROR: Load into table 'part' failed.  Check 'stl_load_errors' system table for details. [SQL State=XX000] 

Execution time: 1.46s

1 statement(s) failed.
1 statement(s) failed.</code></pre>
                <p>Pour obtenir plus d’informations sur l’erreur, interrogez la table STL_LOAD_ERRORS. La requête suivante utilise la fonction SUBSTRING pour réduire les colonnes afin de faciliter la lecture et utilise LIMIT 10 pour réduire le nombre de lignes renvoyées. Vous pouvez ajuster les valeurs dans <code class="code">substring(filename,22,25)</code> afin d’autoriser la longueur du nom de votre compartiment.</p>
                <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Texte"><awsui-icon name="copy"></awsui-icon></div></div><code class="">select query, substring(filename,22,25) as filename,line_number as line, 
substring(colname,0,12) as column, type, position as pos, substring(raw_line,0,30) as line_text,
substring(raw_field_value,0,15) as field_text, 
substring(err_reason,0,45) as reason
from stl_load_errors 
order by query desc
limit 10;</code></pre>
                <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Texte"><awsui-icon name="copy"></awsui-icon></div></div><code class=""> query  |    filename      | line |  column   |    type    | pos |      
--------+-------------------------+-----------+------------+------------+-----+----
 333765 | part-csv.tbl-000 |    1 |           |            |   0 |

 line_text        | field_text |                    reason
------------------+------------+----------------------------------------------
 15,NUL next,     |            | Missing newline: Unexpected character 0x2c f</code></pre>


                 
                    <h6>NULL AS</h6>
                    <p>Les fichiers de données <code class="code">part-csv.tbl</code> utilisent la marque de fin NUL (<code class="code">\x000</code> ou <code class="code">\x0</code>) pour indiquer des valeurs NULL.</p>
                 
                <div class="awsdocs-note"><div class="awsdocs-note-title"><awsui-icon name="status-info" variant="link"></awsui-icon><h6>Note</h6></div><div class="awsdocs-note-text"><p>Malgré une orthographe très similaire, NUL et NULL ne sont pas identiques. NUL est un caractère UTF-8 avec le point de code <code class="code">x000</code> qui est souvent utilisé pour indiquer la fin de l’enregistrement. NULL est une valeur SQL qui représente l’absence de données. </p></div></div>
                <p>Par défaut, COPY traite une marque de fin NUL comme une marque de fin d’enregistrement et met fin à l’enregistrement, ce qui entraîne souvent des résultats inattendus ou une erreur. Il n’existe pas de méthode standard unique pour indiquer NULL dans les données de texte. Par conséquent, l’option de commande NULL AS COPY vous permet de spécifier le caractère à remplacer par NULL lors du chargement de la table. Dans cet exemple, vous voulez exécuter la commande COPY pour traiter la marque de fin NUL en tant que valeur NULL.</p>
                <div class="awsdocs-note"><div class="awsdocs-note-title"><awsui-icon name="status-info" variant="link"></awsui-icon><h6>Note</h6></div><div class="awsdocs-note-text"><p>La colonne de la table qui reçoit la valeur NULL doit être configurée comme <em>acceptant la valeur null</em>. Autrement dit, elle ne doit pas inclure la contrainte NOT NULL dans la spécification CREATE TABLE.</p></div></div>
                <p>Pour charger la table PART en utilisant l’option AS NULL, exécutez la commande COPY suivante.</p>
                <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Texte"><awsui-icon name="copy"></awsui-icon></div></div><code class="nohighlight">copy part from 's3://<code class="replaceable">&lt;your-bucket-name&gt;</code>/load/part-csv.tbl' 
credentials 'aws_iam_role=arn:aws:iam::<code class="replaceable">&lt;aws-account-id&gt;</code>:role/<code class="replaceable">&lt;role-name&gt;</code>' 
csv
null as '\000';</code></pre>
                
                <p>Pour vérifier que la commande COPY a chargé des valeurs NULL, exécutez la commande suivante pour sélectionner uniquement les lignes qui contiennent la valeur NULL.</p>
                <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Texte"><awsui-icon name="copy"></awsui-icon></div></div><code class="">select p_partkey, p_name, p_mfgr, p_category from part where p_mfgr is null;</code></pre>
                <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Texte"><awsui-icon name="copy"></awsui-icon></div></div><code class=""> p_partkey |  p_name  | p_mfgr | p_category
-----------+----------+--------+------------
        15 | NUL next |        | MFGR#47
        81 | NUL next |        | MFGR#23
       133 | NUL next |        | MFGR#44 
(2 rows)</code></pre>
             

             
                <h3 id="tutorial-loading-load-supplier">Charger la table SUPPLIER à l’aide de REGION</h3>

                <p>Au cours de cette étape, vous utilisez les options DELIMITER et REGION pour charger la table SUPPLIER.</p>
                <div class="awsdocs-note"><div class="awsdocs-note-title"><awsui-icon name="status-info" variant="link"></awsui-icon><h6>Note</h6></div><div class="awsdocs-note-text"><p>Les fichiers permettant de charger la table SUPPLIER sont fournis dans un  AWS  exemple de bucket. Vous n’avez pas besoin de charger des fichiers pour cette étape.</p></div></div>
                 
                    <h6>Format délimité par un caractère</h6>
                    <p>Les champs situés dans un fichier délimité par un caractère sont séparés par un caractère spécifique, comme une barre verticale ( | ), une virgule ( , ) ou une tabulation ( \t ). Les fichiers délimités par un caractère peuvent utiliser n’importe quel caractère ASCII unique, notamment l’un des caractères ASCII non affichables, comme le délimiteur. Vous spécifiez le délimiteur à l’aide de l’option DELIMITER. Le délimiteur par défaut est une barre verticale ( | ). </p>
                 
                <p>L’extrait suivant des données de la table SUPPLIER utilise le format délimité par une barre verticale. </p>
                <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Texte"><awsui-icon name="copy"></awsui-icon></div></div><code class="">1|1|257368|465569|41365|19950218|2-HIGH|0|17|2608718|9783671|4|2504369|92072|2|19950331|TRUCK
1|2|257368|201928|8146|19950218|2-HIGH|0|36|6587676|9783671|9|5994785|109794|6|19950416|MAIL</code></pre>

                
                 
                    <h6>REGION</h6>
                    <p>Dans la mesure du possible, vous devez localiser vos données de chargement dans la même  AWS  région que votre cluster Amazon Redshift. Si vos données et votre cluster se trouvent dans la même région, cela vous permet de réduire la latence et d’éviter des coûts de transfert régional de données. Pour plus d'informations, consultez <a href="./c_loading-data-best-practices.html">Bonnes pratiques de chargement des données sur Amazon Redshift</a> </p>
                 
                <p>Si vous devez charger des données provenant d'une autre  AWS  région, utilisez l'option REGION pour spécifier la  AWS  région dans laquelle se trouvent les données de chargement. Si vous spécifiez une région, toutes les données de chargement, notamment les fichiers manifestes, doivent se situer dans la région désignée. Pour plus d'informations, consultez <a href="./copy-parameters-data-source-s3.html#copy-region">REGION</a>. </p>
                <p>Si votre cluster se trouve dans la région USA Est (Virginie du Nord), exécutez la commande suivante pour charger la table SUPPLIER à partir des données délimitées par une barre verticale situées dans un compartiment Amazon S3 situé dans la région USA Ouest (Oregon). Pour cet exemple, ne modifiez pas le nom du compartiment. </p>
                <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Texte"><awsui-icon name="copy"></awsui-icon></div></div><code class="nohighlight">copy supplier from 's3://awssampledbuswest2/ssbgz/supplier.tbl' 
credentials 'aws_iam_role=arn:aws:iam::<code class="replaceable">&lt;aws-account-id&gt;</code>:role/<code class="replaceable">&lt;role-name&gt;</code>' 
delimiter '|' 
gzip
region 'us-west-2';</code></pre>
                
                <p>Si votre cluster ne se trouve <em>pas</em> dans la région USA Est (Virginie du Nord), exécutez la commande suivante pour charger la table SUPPLIER à partir des données délimitées par une barre verticale situées dans un compartiment Amazon S3 situé dans la région USA Est (Virginie du Nord). Pour cet exemple, ne modifiez pas le nom du compartiment.</p>
                
                <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Texte"><awsui-icon name="copy"></awsui-icon></div></div><code class="nohighlight">copy supplier from 's3://awssampledb/ssbgz/supplier.tbl' 
credentials 'aws_iam_role=arn:aws:iam::<code class="replaceable">&lt;aws-account-id&gt;</code>:role/<code class="replaceable">&lt;role-name&gt;</code>' 
delimiter '|' 
gzip
region 'us-east-1';
</code></pre>
                
             

             
                <h3 id="tutorial-loading-load-customer">Charger la table CUSTOMER à l’aide de MANIFEST</h3>

                <p>Au cours de cette étape, vous utilisez les options FIXEDWIDTH, MAXERROR, ACCEPTINVCHARS et MANIFEST pour charger la table CUSTOMER.</p>
                <p>Les exemples de données de cet exercice contiennent des caractères qui entraînent des erreurs lorsque COPY tente de les charger. Vous utilisez l’option MAXERRORS et la table système STL_LOAD_ERRORS pour résoudre les erreurs de chargement, puis utiliser les options ACCEPTINVCHARS et MANIFEST pour éliminer les erreurs.</p>
                 
                    <h6>Format à largeur fixe</h6>
                    <p>Le format à largeur fixe définit chaque champ en tant que nombre de caractères fixe, plutôt que comme des champs séparés par un délimiteur. L’extrait suivant des données de la table CUSTOMER utilise le format à largeur fixe.</p>
                 
                <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Texte"><awsui-icon name="copy"></awsui-icon></div></div><code class="">1   Customer#000000001   IVhzIApeRb           MOROCCO  0MOROCCO  AFRICA      25-705 
2   Customer#000000002   XSTf4,NCwDVaWNe6tE   JORDAN   6JORDAN   MIDDLE EAST 23-453
3   Customer#000000003   MG9kdTD              ARGENTINA5ARGENTINAAMERICA     11-783</code></pre>

                <p>L’ordre des paires étiquette/largeur doit correspondre exactement à l’ordre des colonnes de la table. Pour plus d'informations, consultez <a href="./copy-parameters-data-format.html#copy-fixedwidth">FIXEDWIDTH</a>.</p>
                <p>La chaîne de spécification à largeur fixe pour les données de la table CUSTOMER est la suivante.</p>
                <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Texte"><awsui-icon name="copy"></awsui-icon></div></div><code class="">fixedwidth 'c_custkey:10, c_name:25, c_address:25, c_city:10, c_nation:15, 
c_region :12, c_phone:15,c_mktsegment:10'</code></pre>
                <p>Pour charger la table CUSTOMER à partir de données à largeur fixe, exécutez la commande suivante.</p>
                
                <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Texte"><awsui-icon name="copy"></awsui-icon></div></div><code class="nohighlight">copy customer
from 's3://<code class="replaceable">&lt;your-bucket-name&gt;</code>/load/customer-fw.tbl'
credentials 'aws_iam_role=arn:aws:iam::<code class="replaceable">&lt;aws-account-id&gt;</code>:role/<code class="replaceable">&lt;role-name&gt;</code>' 
fixedwidth 'c_custkey:10, c_name:25, c_address:25, c_city:10, c_nation:15, c_region :12, c_phone:15,c_mktsegment:10';</code></pre>
                
                <p>Vous devez recevoir un message d’erreur similaire au suivant.</p>
                <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Texte"><awsui-icon name="copy"></awsui-icon></div></div><code class="">An error occurred when executing the SQL command:
copy customer
from 's3://mybucket/load/customer-fw.tbl'
credentials'...

ERROR: Load into table 'customer' failed.  Check 'stl_load_errors' system table for details. [SQL State=XX000] 

Execution time: 2.95s

1 statement(s) failed.</code></pre>
                 
                    <h6>MAXERROR</h6>
                    <p>Par défaut, la première fois que COPY rencontre une erreur, la commande échoue et renvoie un message d’erreur. Pour gagner du temps pendant le test, vous pouvez utiliser l’option MAXERROR pour indiquer à COPY d’ignorer un nombre d’erreurs spécifié avant d’échouer. Du fait que nous anticipons des erreurs la première fois que nous testons le chargement des données de la table CUSTOMER, ajoutez <code class="code">maxerror 10</code> à la commande COPY. </p>
                 
                <p>Pour effectuer le test en utilisant les options FIXEDWIDTH et MAXERROR, exécutez la commande suivante.</p>
                
                <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Texte"><awsui-icon name="copy"></awsui-icon></div></div><code class="nohighlight">copy customer
from 's3://<code class="replaceable">&lt;your-bucket-name&gt;</code>/load/customer-fw.tbl'
credentials 'aws_iam_role=arn:aws:iam::<code class="replaceable">&lt;aws-account-id&gt;</code>:role/<code class="replaceable">&lt;role-name&gt;</code>' 
fixedwidth 'c_custkey:10, c_name:25, c_address:25, c_city:10, c_nation:15, c_region :12, c_phone:15,c_mktsegment:10'
maxerror 10;</code></pre>
                
                <p>Cette fois-ci, au lieu d’un message d’erreur, vous recevez un message d’avertissement semblable au suivant.</p>
                <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Texte"><awsui-icon name="copy"></awsui-icon></div></div><code class="">Warnings:
Load into table 'customer' completed, 112497 record(s) loaded successfully.
Load into table 'customer' completed, 7 record(s) could not be loaded.  Check 'stl_load_errors' system table for details.</code></pre>
                <p>L’avertissement indique que la commande COPY a rencontré sept erreurs. Pour vérifier les erreurs, interrogez la table STL_LOAD_ERRORS, comme illustré dans l’exemple suivant.</p>
                <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Texte"><awsui-icon name="copy"></awsui-icon></div></div><code class="">select query, substring(filename,22,25) as filename,line_number as line, 
substring(colname,0,12) as column, type, position as pos, substring(raw_line,0,30) as line_text,
substring(raw_field_value,0,15) as field_text, 
substring(err_reason,0,45) as error_reason
from stl_load_errors 
order by query desc, filename 
limit 7;</code></pre>
                <p>Les résultats de la requête STL_LOAD_ERRORS doivent être similaires à ce qui suit.</p>
                <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Texte"><awsui-icon name="copy"></awsui-icon></div></div><code class=""> query  |         filename          | line |  column   |    type    | pos |           line_text           | field_text |              error_reason
--------+---------------------------+------+-----------+------------+-----+-------------------------------+------------+----------------------------------------------
 334489 | customer-fw.tbl.log       |    2 | c_custkey | int4       |  -1 | customer-fw.tbl               | customer-f | Invalid digit, Value 'c', Pos 0, Type: Integ
 334489 | customer-fw.tbl.log       |    6 | c_custkey | int4       |  -1 | Complete                      | Complete   | Invalid digit, Value 'C', Pos 0, Type: Integ
 334489 | customer-fw.tbl.log       |    3 | c_custkey | int4       |  -1 | #Total rows                   | #Total row | Invalid digit, Value '#', Pos 0, Type: Integ
 334489 | customer-fw.tbl.log       |    5 | c_custkey | int4       |  -1 | #Status                       | #Status    | Invalid digit, Value '#', Pos 0, Type: Integ
 334489 | customer-fw.tbl.log       |    1 | c_custkey | int4       |  -1 | #Load file                    | #Load file | Invalid digit, Value '#', Pos 0, Type: Integ
 334489 | customer-fw.tbl000        |    1 | c_address | varchar    |  34 | 1         Customer#000000001  | .Mayag.ezR | String contains invalid or unsupported UTF8
 334489 | customer-fw.tbl000        |    1 | c_address | varchar    |  34 | 1         Customer#000000001  | .Mayag.ezR | String contains invalid or unsupported UTF8
(7 rows)</code></pre>
                <p>En examinant les résultats, vous pouvez voir qu’il y a deux messages dans la colonne <code class="code">error_reasons</code> :</p>
                <div class="itemizedlist">
                     
                     
                <ul class="itemizedlist"><li class="listitem">
                        <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Texte"><awsui-icon name="copy"></awsui-icon></div></div><code class="">Invalid digit, Value '#', Pos 0, Type: Integ </code></pre>
                        <p>Ces erreurs sont entraînées par le fichier <code class="code">customer-fw.tbl.log</code>. Le problème est qu’il existe un fichier journal, pas un fichier de données et qu’il ne doit pas être chargé. Vous pouvez utiliser un fichier manifeste pour éviter le chargement du fichier incorrect. </p>
                    </li><li class="listitem">
                        <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Texte"><awsui-icon name="copy"></awsui-icon></div></div><code class="">String contains invalid or unsupported UTF8 </code></pre>
                        <p>Le type de données VARCHAR prend en charge les caractères UTF-8 de 3 octets au maximum. Si les données de chargement contiennent des caractères non pris en charge ou non valides, vous pouvez utiliser l’option ACCEPTINVCHARS pour remplacer chaque caractère non valide par un caractère alternatif spécifié.</p>
                    </li></ul></div>
                <p>Un autre problème se pose avec la charge qui est plus difficile à détecter : les résultats inattendus produits par la charge. Afin d’étudier ce problème, exécutez la commande suivante pour interroger la table CUSTOMER.</p>
                <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Texte"><awsui-icon name="copy"></awsui-icon></div></div><code class="">select c_custkey, c_name, c_address        
from customer
order by c_custkey
limit 10;
</code></pre>
                <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Texte"><awsui-icon name="copy"></awsui-icon></div></div><code class=""> c_custkey |          c_name           |         c_address
-----------+---------------------------+---------------------------
         2 | Customer#000000002        | XSTf4,NCwDVaWNe6tE
         2 | Customer#000000002        | XSTf4,NCwDVaWNe6tE
         3 | Customer#000000003        | MG9kdTD
         3 | Customer#000000003        | MG9kdTD
         4 | Customer#000000004        | XxVSJsL
         4 | Customer#000000004        | XxVSJsL
         5 | Customer#000000005        | KvpyuHCplrB84WgAi
         5 | Customer#000000005        | KvpyuHCplrB84WgAi
         6 | Customer#000000006        | sKZz0CsnMD7mp4Xd0YrBvx
         6 | Customer#000000006        | sKZz0CsnMD7mp4Xd0YrBvx
(10 rows)</code></pre>
                <p>Les lignes doivent être uniques, mais il existe des doublons. </p>
                <p>Pour vérifier les résultats inattendus, vous pouvez également vérifier le nombre de lignes qui ont été chargées. Dans notre cas, 100 000 lignes ont été chargées, mais le message de chargement a signalé le chargement de 112 497 enregistrements. Des lignes supplémentaires ont été chargées, car la commande COPY a chargé un fichier superflu, <code class="code">customer-fw.tbl0000.bak</code>. </p>
                <p>Dans cet exercice, vous utilisez un fichier manifeste pour éviter de charger des fichiers incorrects. </p>
                 
                    <h6>ACCEPTINVCHARS</h6>
                    <p>Par défaut, lorsque la commande COPY rencontre un caractère qui n’est pas pris en charge par le type de données de la colonne, il ignore la ligne et renvoie une erreur. Pour plus d’informations sur les caractères UTF-8 non valides, consultez <a href="./multi-byte-character-load-errors.html">Erreurs de chargement de caractères multioctets</a>. </p>
                 
                <p>Vous pouvez utiliser l’option MAXERRORS pour ignorer les erreurs et continuer le chargement, puis interroger STL_LOAD_ERRORS pour rechercher les caractères non valides et corriger les fichiers de données. Cependant, MAXERRORS est plus utile pour résoudre les problèmes de chargement et ne doit pas être utilisé, en général, dans un environnement de production. </p>
                <p>L’option ACCEPTINVCHARS est généralement un choix plus adapté à la gestion des caractères non valides. ACCEPTINVCHARS indique que la commande COPY doit remplacer chaque caractère non valide par un caractère valide spécifié et poursuivre l’opération de chargement. Vous pouvez spécifier n’importe quel caractère ASCII valide, sauf NULL, comme caractère de remplacement. Le caractère de remplacement par défaut est un point d’interrogation ( ? ). La commande COPY remplace les caractères de plusieurs octets par une chaîne de remplacement de la même longueur. Par exemple, un caractère de 4 octets serait remplacé par <code class="code">'????'</code>. </p>
                <p>COPY renvoie le nombre de lignes qui contenaient les caractères UTF-8 non valides. Cette commande ajoute également une entrée à la table système STL_REPLACEMENTS pour chaque ligne affectée, jusqu’à un maximum de 100 lignes par tranche de nœud. Les caractères UTF-8 non valides supplémentaires sont également remplacés, mais ces événements de remplacement ne sont pas enregistrés. </p>
                <p>ACCEPTINVCHARS est valide uniquement pour les colonnes VARCHAR. </p>
                <p>Pour cette étape, vous ajoutez ACCEPTINVCHARS au caractère de remplacement <code class="code">'^'</code>. </p>
                 
                    <h6>MANIFEST</h6>
                    <p>Lorsque vous exécutez la commande COPY à partir d’Amazon S3 à l’aide d’un préfixe de clé, il y a un risque que vous chargiez des tables indésirables. Par exemple, le dossier <code class="code">'s3://mybucket/load/</code> contient huit fichiers de données partageant le préfixe de clé <code class="code">customer-fw.tbl</code> : <code class="code">customer-fw.tbl0000</code>, <code class="code">customer-fw.tbl0001</code> et ainsi de suite. Cependant, le même dossier contient également les fichiers superflus <code class="code">customer-fw.tbl.log</code> et <code class="code">customer-fw.tbl-0001.bak</code>. </p>
                 
                <p>Pour vous assurer que vous chargez tous les fichiers corrects et uniquement les fichiers corrects, utilisez un fichier manifeste. Le manifeste est un fichier texte au format JSON qui répertorie explicitement la clé d’objet unique de chaque fichier source à charger. Les objets de fichier peuvent se situer dans différents dossiers ou compartiments, mais ils doivent se trouver dans la même région. Pour plus d'informations, consultez <a href="./copy-parameters-data-source-s3.html#copy-manifest">MANIFEST</a>.</p>
                <p>L’exemple suivant illustre le texte <code class="code">customer-fw-manifest</code>. </p>
                <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Texte"><awsui-icon name="copy"></awsui-icon></div></div><code class="nohighlight"><span>{</span>
  "entries": [
    <span>{</span>"url":"s3://<code class="replaceable">&lt;your-bucket-name&gt;</code>/load/customer-fw.tbl-000"},
    <span>{</span>"url":"s3://<code class="replaceable">&lt;your-bucket-name&gt;</code>/load/customer-fw.tbl-001"},
    <span>{</span>"url":"s3://<code class="replaceable">&lt;your-bucket-name&gt;</code>/load/customer-fw.tbl-002"},
    <span>{</span>"url":"s3://<code class="replaceable">&lt;your-bucket-name&gt;</code>/load/customer-fw.tbl-003"},
    <span>{</span>"url":"s3://<code class="replaceable">&lt;your-bucket-name&gt;</code>/load/customer-fw.tbl-004"},    
    <span>{</span>"url":"s3://<code class="replaceable">&lt;your-bucket-name&gt;</code>/load/customer-fw.tbl-005"},
    <span>{</span>"url":"s3://<code class="replaceable">&lt;your-bucket-name&gt;</code>/load/customer-fw.tbl-006"}, 
    <span>{</span>"url":"s3://<code class="replaceable">&lt;your-bucket-name&gt;</code>/load/customer-fw.tbl-007"} 
    ]
}</code></pre>
                <div class="procedure"><h6>Pour charger les données de la table CUSTOMER en utilisant le fichier manifeste</h6><ol><li>
                        <p>Ouvrez le fichier <code class="code">customer-fw-manifest</code> dans un éditeur de texte.</p>
                    </li><li>
                        <p>Remplacez <code class="replaceable">&lt; your-bucket-name &gt;</code> par le nom de votre compartiment.</p>
                    </li><li>
                        <p>Enregistrez le fichier.</p>
                    </li><li>
                        <p>Chargez le fichier dans le dossier de chargement de votre compartiment.</p>
                    </li><li>
                        <p>Exécutez la commande COPY suivante.</p>
                        
                        <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Texte"><awsui-icon name="copy"></awsui-icon></div></div><code class="nohighlight">copy customer from 's3://<code class="replaceable">&lt;your-bucket-name&gt;</code>/load/customer-fw-manifest'
credentials 'aws_iam_role=arn:aws:iam::<code class="replaceable">&lt;aws-account-id&gt;</code>:role/<code class="replaceable">&lt;role-name&gt;</code>' 
fixedwidth 'c_custkey:10, c_name:25, c_address:25, c_city:10, c_nation:15, c_region :12, c_phone:15,c_mktsegment:10'
maxerror 10 
acceptinvchars as '^'
manifest;</code></pre>
                        
                    </li></ol></div>
             
             
                <h3 id="tutorial-loading-load-dwdate">Charger la table DWDATE à l’aide de DATEFORMAT</h3>

                <p>Au cours de cette étape, vous utilisez les options DELIMITER et DATEFORMAT pour charger la table DWDATE.</p>
                
                <p>Lors du chargement des colonnes DATE et TIMESTAMP, la commande COPY attend le format par défaut, qui est AAAA-MM-JJ pour les dates et AAAA-MM-JJ HH:MI:SS pour les horodatages. Si les données de chargement n’utilisent pas un format par défaut, vous pouvez utiliser DATEFORMAT et TIMEFORMAT pour spécifier le format. </p>
                <p>L’extrait suivant présente les formats de date du tableau DWDATE. Notez que les formats de date de la colonne deux sont incompatibles.</p>
                <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Texte"><awsui-icon name="copy"></awsui-icon></div></div><code class="">19920104	1992-01-04          Sunday		January	1992	199201	Jan1992	1	4	4	1...
19920112	January 12, 1992	Monday		January	1992	199201	Jan1992	2	12	12	1...
19920120	January 20, 1992	Tuesday	    January	1992	199201	Jan1992	3	20	20	1...</code></pre>
                 
                    <h6>DATEFORMAT</h6>
                    <p>Vous ne pouvez spécifier qu’un seul format de date. Si les données de chargement contiennent des formats incompatibles, éventuellement dans différentes colonnes, ou si le format n’est pas connu au moment du chargement, vous utilisez DATEFORMAT avec l’argument <code class="code">'auto'</code>. Lorsque <code class="code">'auto'</code> est spécifié, la commande COPY reconnaît tous les formats d’heure ou de date valides et les convertira au format par défaut. L’option <code class="code">'auto'</code> reconnaît plusieurs formats qui ne sont pas pris en charge lors de l’utilisation d’une chaîne DATEFORMAT et TIMEFORMAT. Pour plus d'informations, consultez <a href="./automatic-recognition.html">Utilisation de la reconnaissance automatique avec DATEFORMAT et TIMEFORMAT</a>. </p>
                 
                <p>Pour charger la table DWDATE, exécutez la commande COPY suivante.</p>
                <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Texte"><awsui-icon name="copy"></awsui-icon></div></div><code class="nohighlight">copy dwdate from 's3://<code class="replaceable">&lt;your-bucket-name&gt;</code>/load/dwdate-tab.tbl'
credentials 'aws_iam_role=arn:aws:iam::<code class="replaceable">&lt;aws-account-id&gt;</code>:role/<code class="replaceable">&lt;role-name&gt;</code>' 
delimiter '\t' 
dateformat 'auto';</code></pre>
                
             
             
                <h3 id="tutorial-loading-load-lineorder">Charger la table LINEORDER à l’aide de plusieurs fichiers</h3>

                <p>Cette étape utilise les options GZIP et COMPUPDATE pour charger la table LINEORDER.</p>
                <p>Dans cet exercice, vous chargez la table LINEORDER à partir d’un seul fichier de données, puis la charger à nouveau à partir de plusieurs fichiers. Cela vous permet de comparer les temps de chargement pour les deux méthodes. </p>
                <div class="awsdocs-note"><div class="awsdocs-note-title"><awsui-icon name="status-info" variant="link"></awsui-icon><h6>Note</h6></div><div class="awsdocs-note-text"><p>Les fichiers permettant de charger la table LINEORDER sont fournis dans un  AWS  exemple de bucket. Vous n’avez pas besoin de charger des fichiers pour cette étape.</p></div></div>
                 
                    <h6>GZIP, LZOP et BZIP2</h6>
                    <p>Vous pouvez compresser vos fichiers à l’aide des formats de compression gzip, lzop ou bzip2. Lors du chargement de fichiers compressés, la commande COPY décompresse les fichiers pendant le processus de chargement. La compression de vos fichiers enregistre l’espace de stockage et réduit les temps de chargement. </p>
                 
                 
                    <h6>COMPUPDATE</h6>
                    <p>Lorsque la commande COPY charge une table vide sans aucun codage de compression, elle analyse les données de chargement pour déterminer les encodages optimaux. Elle modifie ensuite la table afin d’utiliser ces encodages avant de commencer le chargement. Ce processus d’analyse prend du temps, mais il se produit, tout au plus, une fois par table. Pour gagner du temps, vous pouvez ignorer cette étape en désactivant COMPUPDATE. Pour permettre une évaluation précise de temps de la commande COPY, vous désactivez COMPUPDATE pour cette étape.</p>
                 
                 
                    <h6>Plusieurs fichiers</h6>
                    <p>La commande COPY peut charger les données de manière très efficace en chargeant plusieurs fichiers en parallèle plutôt qu’un seul fichier. Vous pouvez scinder vos données en fichiers de telle sorte que le nombre de fichiers soit un multiple du nombre de tranches de votre cluster. Le cas échéant, Amazon Redshift divise la charge de travail et répartit les données de façon uniforme entre les tranches. Le nombre de tranches par nœud dépend de la taille de nœud du cluster. Pour plus d’informations sur le nombre de tranches pour chaque taille de nœud, consultez <a href="https://docs.aws.amazon.com/redshift/latest/mgmt/working-with-clusters.html#rs-about-clusters-and-nodes">À propos des clusters et des nœuds</a> dans le <em>Guide de gestion Amazon Redshift</em>.</p>
                 
                <p>Par exemple, les nœuds de calcul dc2.large utilisés dans ce didacticiel se composent de deux tranches chacun, afin que le cluster à quatre nœuds se compose de huit tranches. Au cours des étapes précédentes, les données de chargement étaient contenues dans huit fichiers, même si les fichiers étaient très petits. Au cours de cette étape, vous comparez la différence de temps entre le chargement d’un fichier volumineux unique et le chargement de plusieurs fichiers. </p>
                <p>Les fichiers que vous utilisez dans le cadre de ce didacticiel contiennent environ 15 millions d’enregistrements et occupent environ 1,2 Go. Ces fichiers sont très petits à l’échelle d’Amazon Redshift, mais suffisants pour démontrer l’avantage que représente le chargement de plusieurs fichiers en termes de performances. Les fichiers sont suffisamment volumineux pour que le temps nécessaire pour les télécharger, puis charger dans Amazon S3 soit excessif pour ce didacticiel. Ainsi, vous chargez les fichiers directement à partir d'un  AWS  échantillon de bucket. </p>
                <p>La capture d’écran suivante présente les fichiers de données pour LINEORDER.</p>

                <div class="mediaobject">
                     
                        <img src="images/tutorial-load-lineorder-files.png" class="aws-docs-img-whiteBg aws-docs-img-padding" />
                     
                </div>
                <div class="procedure"><h6>Pour évaluer les performances de la commande COPY avec plusieurs fichiers</h6><ol><li>
                        <p>Exécutez la commande suivante pour exécuter COPY à partir d’un seul fichier. Ne modifiez pas le nom du compartiment.</p>
                        
                        <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Texte"><awsui-icon name="copy"></awsui-icon></div></div><code class="nohighlight">copy lineorder from 's3://awssampledb/load/lo/lineorder-single.tbl' 
credentials 'aws_iam_role=arn:aws:iam::<code class="replaceable">&lt;aws-account-id&gt;</code>:role/<code class="replaceable">&lt;role-name&gt;</code>' 
gzip
compupdate off
region 'us-east-1';</code></pre>
                        
                    </li><li>
                        <p>Vos résultats doivent être similaires à ce qui suit. Notez le délai d’exécution.</p>
                        <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Texte"><awsui-icon name="copy"></awsui-icon></div></div><code class="">Warnings:
Load into table 'lineorder' completed, 14996734 record(s) loaded successfully.

0 row(s) affected.
copy executed successfully

Execution time: 51.56s</code></pre>
                    </li><li>
                        <p>Exécutez la commande suivante pour exécuter COPY à partir de plusieurs fichiers. Ne modifiez pas le nom du compartiment.</p>
                        
                        <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Texte"><awsui-icon name="copy"></awsui-icon></div></div><code class="nohighlight">copy lineorder from 's3://awssampledb/load/lo/lineorder-multi.tbl' 
credentials 'aws_iam_role=arn:aws:iam::<code class="replaceable">&lt;aws-account-id&gt;</code>:role/<code class="replaceable">&lt;role-name&gt;</code>' 
gzip
compupdate off
region 'us-east-1';
</code></pre>
                        
                    </li><li>
                        <p>Vos résultats doivent être similaires à ce qui suit. Notez le délai d’exécution.</p>
                        <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Texte"><awsui-icon name="copy"></awsui-icon></div></div><code class="">Warnings:
Load into table 'lineorder' completed, 14996734 record(s) loaded successfully.

0 row(s) affected.
copy executed successfully

Execution time: 17.7s</code></pre>
                    </li><li>
                        <p>Comparez les temps d’exécution.</p>
                        <p>Dans notre exemple, le temps de chargement de 15 millions d’enregistrements est passé de 51,56 secondes à 17,7 secondes, soit une diminution de 65,7 %. </p>
                        <p>Ces résultats sont basés sur l’utilisation d’un cluster à quatre nœuds. Si votre cluster comporte plusieurs nœuds, les gains de temps sont multipliés. Pour des clusters Amazon Redshift classiques, avec des dizaines, voire des centaines de nœuds, la différence est encore plus spectaculaire. Si vous disposez d’un cluster à nœud unique, il y a peu de différence entre les temps d’exécution. </p>
                    </li></ol></div>
             
             
                <h3 id="tutorial-loading-next-step6">Étape suivante</h3>

                <p><a href="./tutorial-loading-data-vacuum.html">Étape 6 : Vider et analyser la base de données</a></p>
             
        <awsdocs-copyright class="copyright-print"></awsdocs-copyright><awsdocs-thumb-feedback right-edge="{{$ctrl.thumbFeedbackRightEdge}}"></awsdocs-thumb-feedback></div><noscript><div><div><div><div id="js_error_message"><p><img src="https://d1ge0kk1l5kms0.cloudfront.net/images/G/01/webservices/console/warning.png" alt="Avertissement" /> <strong>JavaScript est désactivé ou n'est pas disponible dans votre navigateur.</strong></p><p>Pour que vous puissiez utiliser la documentation AWS, Javascript doit être activé. Vous trouverez des instructions sur les pages d'aide de votre navigateur.</p></div></div></div></div></noscript><div id="main-col-footer" class="awsui-util-font-size-0"><div id="doc-conventions"><a target="_top" href="/general/latest/gr/docconventions.html">Conventions de rédaction</a></div><div class="prev-next"><div id="previous" class="prev-link" accesskey="p" href="./tutorial-loading-data-create-tables.html">Étape 4 : Créer des exemples de tables</div><div id="next" class="next-link" accesskey="n" href="./tutorial-loading-data-vacuum.html">Étape 6 : Vider et analyser la base de données</div></div></div><awsdocs-page-utilities></awsdocs-page-utilities></div><div id="quick-feedback-yes" style="display: none;"><div class="title">Cette page vous a-t-elle été utile ? - Oui</div><div class="content"><p>Merci de nous avoir fait part de votre satisfaction.</p><p>Si vous avez quelques minutes à nous consacrer, merci de nous indiquer ce qui vous a plu afin que nous puissions nous améliorer davantage.</p><p><awsui-button id="fblink" rel="noopener noreferrer" target="_blank" text="Commentaire" click="linkClick($event)" href="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=Redshift&amp;topic_url=https://docs.aws.amazon.com/fr_fr/redshift/latest/dg/tutorial-loading-run-copy.html"></awsui-button></p></div></div><div id="quick-feedback-no" style="display: none;"><div class="title">Cette page vous a-t-elle été utile ? - Non</div><div class="content"><p>Merci de nous avoir avertis que cette page avait besoin d'être retravaillée. Nous sommes désolés de ne pas avoir répondu à vos attentes.</p><p>Si vous avez quelques minutes à nous consacrer, merci de nous indiquer comment nous pourrions améliorer cette documentation.</p><p><awsui-button id="fblink" rel="noopener noreferrer" target="_blank" text="Commentaire" click="linkClick($event)" href="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=Redshift&amp;topic_url=https://docs.aws.amazon.com/fr_fr/redshift/latest/dg/tutorial-loading-run-copy.html"></awsui-button></p></div></div></div></body></div></awsdocs-view><div class="page-loading-indicator" id="page-loading-indicator"><awsui-spinner size="large"></awsui-spinner></div></div><div id="tools-panel" dom-region="tools"><awsdocs-tools-panel id="awsdocs-tools-panel"></awsdocs-tools-panel></div></awsui-app-layout><awsdocs-cookie-banner class="doc-cookie-banner"></awsdocs-cookie-banner></div></body></html>