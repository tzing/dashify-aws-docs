<!DOCTYPE html>
    <html xmlns="http://www.w3.org/1999/xhtml" lang="fr-FR"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Ressources personnalisées basées sur Amazon Simple Notification Service - AWS CloudFormation</title><meta name="viewport" content="width=device-width,initial-scale=1" /><meta name="assets_root" content="/assets" /><meta name="target_state" content="template-custom-resources-sns" /><meta name="default_state" content="template-custom-resources-sns" /><link rel="icon" type="image/ico" href="/assets/images/favicon.ico" /><link rel="shortcut icon" type="image/ico" href="/assets/images/favicon.ico" /><link rel="canonical" href="https://docs.aws.amazon.com/fr_fr/AWSCloudFormation/latest/UserGuide/template-custom-resources-sns.html" /><meta name="description" content="Découvrez les ressources personnalisées basées sur Amazon SNS dans AWS CloudFormation." /><meta name="deployment_region" content="IAD" /><meta name="product" content="AWS CloudFormation" /><meta name="guide" content="Guide de l'utilisateur" /><meta name="abstract" content="Créez et gérez des déploiements AWS d'infrastructure de manière prévisible et répétée à l'aide de ce AWS CloudFormation guide de l'utilisateur." /><meta name="guide-locale" content="fr_fr" /><meta name="tocs" content="toc-contents.json" /><link rel="canonical" href="https://docs.aws.amazon.com/fr_fr/AWSCloudFormation/latest/UserGuide/template-custom-resources-sns.html" /><link rel="alternative" href="https://docs.aws.amazon.com/id_id/AWSCloudFormation/latest/UserGuide/template-custom-resources-sns.html" hreflang="id-id" /><link rel="alternative" href="https://docs.aws.amazon.com/id_id/AWSCloudFormation/latest/UserGuide/template-custom-resources-sns.html" hreflang="id" /><link rel="alternative" href="https://docs.aws.amazon.com/de_de/AWSCloudFormation/latest/UserGuide/template-custom-resources-sns.html" hreflang="de-de" /><link rel="alternative" href="https://docs.aws.amazon.com/de_de/AWSCloudFormation/latest/UserGuide/template-custom-resources-sns.html" hreflang="de" /><link rel="alternative" href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/template-custom-resources-sns.html" hreflang="en-us" /><link rel="alternative" href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/template-custom-resources-sns.html" hreflang="en" /><link rel="alternative" href="https://docs.aws.amazon.com/es_es/AWSCloudFormation/latest/UserGuide/template-custom-resources-sns.html" hreflang="es-es" /><link rel="alternative" href="https://docs.aws.amazon.com/es_es/AWSCloudFormation/latest/UserGuide/template-custom-resources-sns.html" hreflang="es" /><link rel="alternative" href="https://docs.aws.amazon.com/fr_fr/AWSCloudFormation/latest/UserGuide/template-custom-resources-sns.html" hreflang="fr-fr" /><link rel="alternative" href="https://docs.aws.amazon.com/fr_fr/AWSCloudFormation/latest/UserGuide/template-custom-resources-sns.html" hreflang="fr" /><link rel="alternative" href="https://docs.aws.amazon.com/it_it/AWSCloudFormation/latest/UserGuide/template-custom-resources-sns.html" hreflang="it-it" /><link rel="alternative" href="https://docs.aws.amazon.com/it_it/AWSCloudFormation/latest/UserGuide/template-custom-resources-sns.html" hreflang="it" /><link rel="alternative" href="https://docs.aws.amazon.com/ja_jp/AWSCloudFormation/latest/UserGuide/template-custom-resources-sns.html" hreflang="ja-jp" /><link rel="alternative" href="https://docs.aws.amazon.com/ja_jp/AWSCloudFormation/latest/UserGuide/template-custom-resources-sns.html" hreflang="ja" /><link rel="alternative" href="https://docs.aws.amazon.com/ko_kr/AWSCloudFormation/latest/UserGuide/template-custom-resources-sns.html" hreflang="ko-kr" /><link rel="alternative" href="https://docs.aws.amazon.com/ko_kr/AWSCloudFormation/latest/UserGuide/template-custom-resources-sns.html" hreflang="ko" /><link rel="alternative" href="https://docs.aws.amazon.com/pt_br/AWSCloudFormation/latest/UserGuide/template-custom-resources-sns.html" hreflang="pt-br" /><link rel="alternative" href="https://docs.aws.amazon.com/pt_br/AWSCloudFormation/latest/UserGuide/template-custom-resources-sns.html" hreflang="pt" /><link rel="alternative" href="https://docs.aws.amazon.com/zh_cn/AWSCloudFormation/latest/UserGuide/template-custom-resources-sns.html" hreflang="zh-cn" /><link rel="alternative" href="https://docs.aws.amazon.com/zh_tw/AWSCloudFormation/latest/UserGuide/template-custom-resources-sns.html" hreflang="zh-tw" /><link rel="alternative" href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/template-custom-resources-sns.html" hreflang="x-default" /><meta name="feedback-item" content="CloudFormation" /><meta name="this_doc_product" content="AWS CloudFormation" /><meta name="this_doc_guide" content="Guide de l'utilisateur" /><script defer="" src="/assets/r/vendor4.js?version=2021.12.02"></script><script defer="" src="/assets/r/vendor3.js?version=2021.12.02"></script><script defer="" src="/assets/r/vendor1.js?version=2021.12.02"></script><script defer="" src="/assets/r/awsdocs-common.js?version=2021.12.02"></script><script defer="" src="/assets/r/awsdocs-doc-page.js?version=2021.12.02"></script><link href="/assets/r/vendor4.css?version=2021.12.02" rel="stylesheet" /><link href="/assets/r/awsdocs-common.css?version=2021.12.02" rel="stylesheet" /><link href="/assets/r/awsdocs-doc-page.css?version=2021.12.02" rel="stylesheet" /><script async="" id="awsc-panorama-bundle" type="text/javascript" src="https://prod.pa.cdn.uis.awsstatic.com/panorama-nav-init.js" data-config="{'appEntity':'aws-documentation','region':'us-east-1','service':'cloudformation'}"></script><meta id="panorama-serviceSubSection" value="Guide de l'utilisateur" /><meta id="panorama-serviceConsolePage" value="Ressources personnalisées basées sur Amazon Simple Notification Service" /></head><body class="awsdocs awsui"><div class="awsdocs-container"><awsdocs-header></awsdocs-header><awsui-app-layout id="app-layout" class="awsui-util-no-gutters" ng-controller="ContentController as $ctrl" header-selector="awsdocs-header" navigation-hide="false" navigation-width="$ctrl.navWidth" navigation-open="$ctrl.navOpen" navigation-change="$ctrl.onNavChange($event)" tools-hide="$ctrl.hideTools" tools-width="$ctrl.toolsWidth" tools-open="$ctrl.toolsOpen" tools-change="$ctrl.onToolsChange($event)"><div id="guide-toc" dom-region="navigation"><awsdocs-toc></awsdocs-toc></div><div id="main-column" dom-region="content" tabindex="-1"><awsdocs-view class="awsdocs-view"><div id="awsdocs-content"><head><title>Ressources personnalisées basées sur Amazon Simple Notification Service - AWS CloudFormation</title><meta name="rss" content="aws-cloudformation-release-notes.rss" /><meta name="forums" content="http://forums.aws.amazon.com/forum.jspa?forumID=92" /><meta name="feedback" content="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=CloudFormation&amp;topic_url=https://docs.aws.amazon.com/fr_fr/AWSCloudFormation/latest/UserGuide/template-custom-resources-sns.html" /><meta name="feedback-yes" content="feedbackyes.html?topic_url=https://docs.aws.amazon.com/fr_fr/AWSCloudFormation/latest/UserGuide/template-custom-resources-sns.html" /><meta name="feedback-no" content="feedbackno.html?topic_url=https://docs.aws.amazon.com/fr_fr/AWSCloudFormation/latest/UserGuide/template-custom-resources-sns.html" /><meta name="keywords" content="CloudFormation,AWSCloudFormation,provisionnement des ressources,configuration des ressources,gestion de l'infrastructure,CloudFormer,CloudFormation pile,CloudFormation stackset,CloudFormation modèle,jeu de modifications" /><script type="application/ld+json">
{
    "@context" : "https://schema.org",
    "@type" : "BreadcrumbList",
    "itemListElement" : [
      {
        "@type" : "ListItem",
        "position" : 1,
        "name" : "AWS",
        "item" : "https://aws.amazon.com"
      },
      {
        "@type" : "ListItem",
        "position" : 2,
        "name" : "AWS CloudFormation",
        "item" : "https://docs.aws.amazon.com/cloudformation/index.html"
      },
      {
        "@type" : "ListItem",
        "position" : 3,
        "name" : "Guide de l'utilisateur",
        "item" : "https://docs.aws.amazon.com/fr_fr/AWSCloudFormation/latest/UserGuide"
      },
      {
        "@type" : "ListItem",
        "position" : 4,
        "name" : "Utilisation des modèles AWS CloudFormation",
        "item" : "https://docs.aws.amazon.com/fr_fr/AWSCloudFormation/latest/UserGuide/template-guide.html"
      },
      {
        "@type" : "ListItem",
        "position" : 5,
        "name" : "Ressources personnalisées",
        "item" : "https://docs.aws.amazon.com/fr_fr/AWSCloudFormation/latest/UserGuide/template-custom-resources.html"
      },
      {
        "@type" : "ListItem",
        "position" : 6,
        "name" : "Ressources personnalisées basées sur Amazon Simple Notification Service",
        "item" : "https://docs.aws.amazon.com/fr_fr/AWSCloudFormation/latest/UserGuide/template-custom-resources.html"
      }
    ]
}
</script></head><body><div id="main"><div style="display: none"></div><div id="breadcrumbs" class="breadcrumb"><a href="https://aws.amazon.com">AWS</a><a href="/index.html">Documentation</a><a href="/cloudformation/index.html">AWS CloudFormation</a><a href="Welcome.html">Guide de l'utilisateur</a></div><div id="page-toc-src"><a href="#walkthrough-custom-resources-sns-adding-nonaws-resource">Procédure d'utilisation d'Amazon Simple Notification Service pour créer des ressources personnalisées</a></div><div id="main-content" class="awsui-util-container"><div id="main-col-body"><awsdocs-language-banner data-service="$ctrl.pageService"></awsdocs-language-banner><awsui-alert class="awsdocs-page-banner awsui-util-mb-l"><p>Les traductions sont fournies par des outils de traduction automatique. En cas de conflit entre le contenu d'une traduction et celui de la version originale en anglais, la version anglaise prévaudra.</p></awsui-alert><h1 class="topictitle" id="template-custom-resources-sns">Ressources personnalisées basées sur Amazon Simple Notification Service</h1><div class="awsdocs-page-header-container"><awsdocs-page-header></awsdocs-page-header><awsdocs-filter-selector id="awsdocs-filter-selector"></awsdocs-filter-selector></div><p>Lorsque vous associez une rubrique Amazon SNS à une ressource personnalisée, vous utilisez les notifications Amazon SNS pour déclencher la logique d'allocation personnalisée. Les ressources personnalisées et Amazon SNS vous permettent d'activer des scénarios, tels que l'ajout de nouvelles ressources à une pile et l'injection de données dynamiques dans une pile. Par exemple, lorsque vous créez une pile, AWS CloudFormation peut envoyer une demande <code class="code">create</code> à une rubrique qui est surveillée par une application exécutée sur une instance Amazon Elastic Compute Cloud. La notification Amazon SNS incite l'application à exécuter les tâches d'allocation supplémentaires, telles que la récupération d'un groupe d'adresses IP Elastic autorisées. Une fois que cela est fait, l'application envoie une réponse (et toutes les données de sortie) qui indique à AWS CloudFormation qu'il peut effectuer l'opération de la pile.</p><h2 id="walkthrough-custom-resources-sns-adding-nonaws-resource">Procédure d'utilisation d'Amazon Simple Notification Service pour créer des ressources personnalisées</h2>
      
      
      <p>Cette procédure détaillée décrit le processus des ressources personnalisées. Elle explique la séquence d'événements et de messages envoyés et reçus à la suite de la création, de la mise à jour et de la suppression d'une pile de ressources personnalisées.</p>
      <h3 id="crpg-walkthrough-stack-creation">Étape 1 : Création de la pile</h3>
         
         <div class="orderedlist">
             
             
             
             
         <ol style="list-style-type:arabic ! important;"><li>
               <p>Le template developer crée une pile AWS CloudFormation qui contient une ressource personnalisée. Dans l'exemple de modèle ci-dessous, nous utilisons le nom <code class="code">Custom::SeleniumTester</code> pour la ressource personnalisée <code class="code">MySeleniumTest</code>.</p>
               <p>Le type de ressource personnalisé est déclaré avec un <em>jeton de service</em>, des <em>propriétés facultatives spécifiques au fournisseur</em> et des attributs <a href="./intrinsic-function-reference-getatt.html">Fn::GetAtt</a> facultatifs définis par le custom resource provider. Ces propriétés et ces attributs peuvent être utilisés pour transmettre les informations du template developer au custom resource provider, et vice versa. Le nom des types de ressources personnalisées doit être alphanumérique et ne doit pas dépasser 60 caractères.</p>
               <p>L'exemple suivant illustre un modèle qui contient à la fois des propriétés personnalisées et des attributs de retour :</p>
               <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Texte"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
   "AWSTemplateFormatVersion" : "2010-09-09",
   "Resources" : <span>{</span>
      "MySeleniumTest" : <span>{</span>
         "Type": "Custom::SeleniumTester",
         "Version" : "1.0",
         "Properties" : <span>{</span>
            "ServiceToken": "arn:aws:sns:us-west-2:123456789012:CRTest",
            "seleniumTester" : "SeleniumTest()",
            "endpoints" : [ "http://mysite.com", "http://myecommercesite.com/", "http://search.mysite.com" ],
            "frequencyOfTestsPerHour" : [ "3", "2", "4" ]
         }
      }
   },
   "Outputs" : <span>{</span>
      "topItem" : <span>{</span>
         "Value" : <span>{</span> "Fn::GetAtt" : ["MySeleniumTest", "resultsPage"] }
      },
      "numRespondents" : <span>{</span>
         "Value" : <span>{</span> "Fn::GetAtt" : ["MySeleniumTest", "lastUpdate"] }
      }
   }
}</code></pre>
               <div class="awsdocs-note"><div class="awsdocs-note-title"><awsui-icon name="status-info" variant="link"></awsui-icon><h6>Note</h6></div><div class="awsdocs-note-text"><p>Les noms et les valeurs des données obtenues avec <code class="code"><code class="code">Fn::GetAtt</code></code> sont renvoyés par le custom resource provider lors de la réponse du fournisseur à AWS CloudFormation. Si le custom resource provider est un tiers, le template developer doit obtenir les noms de ces valeurs de retour auprès du custom resource provider.</p></div></div>
            </li><li>
               <p>AWS CloudFormation envoie une notification Amazon SNS au fournisseur de ressources avec un <code class="code">"RequestType" : "Create"</code> qui contient des informations sur la pile, les propriétés des ressources personnalisées de son modèle et une URL S3 pour la réponse.</p>
               <p>La rubrique SNS qui est utilisée pour envoyer la notification est intégrée dans la propriété <code class="code">ServiceToken</code> du modèle. Pour éviter les valeurs codées en dur, un template developer peut utiliser un paramètre de modèle de sorte que la valeur soit entrée lors du lancement de la pile.</p>
               <p>L'exemple suivant présente une requête de création de ressource personnalisée (<code class="code">Create</code>), qui inclut un nom de type de ressource personnalisée, <code class="code">Custom::SeleniumTester</code>, créé avec la valeur <code class="code">LogicalResourceId</code> <code class="code">MySeleniumTester</code> :</p>
               <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Texte"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
   "RequestType" : "Create",
   "ResponseURL" : "http://pre-signed-S3-url-for-response",
   "StackId" : "arn:aws:cloudformation:us-west-2:123456789012:stack/stack-name/guid",
   "RequestId" : "unique id for this create request",
   "ResourceType" : "Custom::SeleniumTester",
   "LogicalResourceId" : "MySeleniumTester",
   "ResourceProperties" : <span>{</span>
      "seleniumTester" : "SeleniumTest()",
      "endpoints" : [ "http://mysite.com", "http://myecommercesite.com/", "http://search.mysite.com" ],
      "frequencyOfTestsPerHour" : [ "3", "2", "4" ]
   }
}</code></pre>
            </li><li>
               <p>Le custom resource provider traite les données envoyées par le template developer et détermine si la demande <code class="code">Create</code> a réussi. Le fournisseur de ressources utilise ensuite l'URL S3 envoyée par AWS CloudFormation pour envoyer la réponse <code class="code">SUCCESS</code> ou <code class="code">FAILED</code>.</p>
               <p>En fonction du type de réponse, différents champs de réponse sont attendues par AWS CloudFormation. Reportez-vous à la section Réponses de la rubrique de référence pour savoir  RequestType ce qui est en cours de traitement.</p>
               <p>En réponse à une demande de création ou de mise à jour, le custom resource provider peut renvoyer des éléments de données dans le champ <a href="./crpg-ref-responses.html#crpg-ref-responses-data">Données</a> de la réponse. Il s'agit de paires nom-valeur, où les <em>noms</em> correspondent aux attributs <code class="code"><code class="code">Fn::GetAtt</code></code> utilisés avec la ressource personnalisée dans le modèle de la pile. Les <em>valeurs</em> sont les données qui sont renvoyées quand le template developer appelle <code class="code"><code class="code">Fn::GetAtt</code></code> au niveau de la ressource avec le nom d'attribut.</p>
               <p>Voici un exemple de réponse de ressource personnalisée :</p>
               <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Texte"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
   "Status" : "SUCCESS",
   "PhysicalResourceId" : "Tester1",
   "StackId" : "arn:aws:cloudformation:us-west-2:123456789012:stack/stack-name/guid",
   "RequestId" : "unique id for this create request",
   "LogicalResourceId" : "MySeleniumTester",
   "Data" : <span>{</span>
      "resultsPage" : "http://www.myexampledomain/test-results/guid",
      "lastUpdate" : "2012-11-14T03:30Z",
   }
}           </code></pre>
               <p>Les champs <code class="code">StackId</code>, <code class="code">RequestId</code> et <code class="code">LogicalResourceId</code> doivent être copiés mot pour mot à partir de la demande.</p>
            </li><li>
               <p> AWS CloudFormation déclare le statut de la pile <code class="code">CREATE_COMPLETE</code> ou <code class="code">CREATE_FAILED</code>. Si la pile a été créée avec succès, le template developer peut utiliser les valeurs de sortie de la ressource personnalisée créée en y accédant avec <a href="./intrinsic-function-reference-getatt.html">Fn::GetAtt</a>.</p>
               <p>Par exemple, le modèle de ressource personnalisée utilisé à titre d'illustration a eu recours à <code class="code"><code class="code">Fn::GetAtt</code></code> pour copier les sorties des ressources dans les sorties de la pile :</p>
               <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Texte"><awsui-icon name="copy"></awsui-icon></div></div><code class="json ">"Outputs" : <span>{</span>
   "topItem" : <span>{</span>
      "Value" : <span>{</span> "Fn::GetAtt" : ["MySeleniumTest", "resultsPage"] }
   },
   "numRespondents" : <span>{</span>
      "Value" : <span>{</span> "Fn::GetAtt" : ["MySeleniumTest", "lastUpdate"] }
   }
}           </code></pre>
            </li></ol></div>
         <p>Pour des informations détaillées sur les objets de demande et de réponse impliqués dans les demandes <code class="code">Create</code>, consultez <a href="./crpg-ref-requesttypes-create.html">Create</a> dans le document <a href="./crpg-ref.html">Référence sur les ressources personnalisées</a>.</p>
       
      <h3 id="crpg-walkthrough-stack-updates">Étape 2 : Mises à jour d'une pile</h3>
         
         <p>Pour mettre à jour une pile existante, vous devez présenter un modèle qui spécifie les mises à jour des propriétés de ressources de la pile, comme illustré dans l'exemple ci-dessous. AWS CloudFormation met à jour uniquement les ressources dont des modifications sont spécifiées dans le modèle. Pour plus d'informations sur la mise à jour des piles, consultez <a href="./using-cfn-updating-stacks.html">Mises à jour des piles AWS CloudFormation</a>.</p>
         <p>Vous pouvez mettre à jour les ressources personnalisées qui nécessitent un remplacement de la ressource physique sous-jacente. Lorsque vous mettez à jour une ressource personnalisée dans un modèle AWS CloudFormation, AWS CloudFormation envoie une demande de mise à jour à cette ressource personnalisée. Si une ressource personnalisée nécessite un remplacement, la nouvelle ressource personnalisée doit envoyer une réponse avec le nouvel ID physique. Quand AWS CloudFormation reçoit la réponse, il compare la valeur <code class="code">PhysicalResourceId</code> entre l'ancienne ressource personnalisée et la nouvelle. Si elles sont différentes, AWS CloudFormation reconnaît la mise à jour en tant que remplacement et envoie une demande de suppression à l'ancienne ressource, comme illustré dans <a href="#crpg-walkthrough-stack-deletion">Étape 3 : Suppression d'une pile</a>.</p>
         <div class="awsdocs-note"><div class="awsdocs-note-title"><awsui-icon name="status-info" variant="link"></awsui-icon><h6>Note</h6></div><div class="awsdocs-note-text"><p>Si vous n'avez pas apporté de modifications à la ressource personnalisée, AWS CloudFormation ne lui envoie pas de demandes lors d'une mise à jour de pile.</p></div></div>
         <div class="orderedlist">
             
             
             
             
         <ol style="list-style-type:arabic ! important;"><li>
               <p>Le template developer lance une mise à jour de la pile qui contient une ressource personnalisée. Pendant une mise à jour, le template developer peut spécifier de nouvelles propriétés dans le modèle de la pile.</p>
               <p>Voici un exemple de mise à jour (<code class="code">Update</code>) apportée au modèle de la pile à l'aide d'un type de ressource personnalisée :</p>
               <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Texte"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
   "AWSTemplateFormatVersion" : "2010-09-09",
   "Resources" : <span>{</span>
      "MySeleniumTest" : <span>{</span>
         "Type": "Custom::SeleniumTester",
         "Version" : "1.0",
         "Properties" : <span>{</span>
            "ServiceToken": "arn:aws:sns:us-west-2:123456789012:CRTest",
            "seleniumTester" : "SeleniumTest()",
            "endpoints" : [ "http://mysite.com", "http://myecommercesite.com/", "http://search.mysite.com",
               "http://mynewsite.com" ],
            "frequencyOfTestsPerHour" : [ "3", "2", "4", "3" ]
         }
      }
   },
   "Outputs" : <span>{</span>
      "topItem" : <span>{</span>
         "Value" : <span>{</span> "Fn::GetAtt" : ["MySeleniumTest", "resultsPage"] }
      },
      "numRespondents" : <span>{</span>
         "Value" : <span>{</span> "Fn::GetAtt" : ["MySeleniumTest", "lastUpdate"] }
      }
   }
}           </code></pre>
            </li><li>
               <p>AWS CloudFormationenvoie une Amazon SNS notification au fournisseur de ressources contenant des informations similaires à celles de l'<code class="code">Create</code>appel, sauf que le <code class="code">OldResourceProperties</code> champ contient les anciennes propriétés des ressources et  ResourceProperties  contient les propriétés des ressources mises à jour (le cas échéant). <code class="code">"RequestType" : "Update"</code></p>
               <p>Voici un exemple de requête <code class="code">Update</code> :</p>
               <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Texte"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
   "RequestType" : "Update",
   "ResponseURL" : "http://pre-signed-S3-url-for-response",
   "StackId" : "arn:aws:cloudformation:us-west-2:123456789012:stack/stack-name/guid",
   "RequestId" : "uniqueid for this update request",
   "LogicalResourceId" : "MySeleniumTester",
   "ResourceType" : "Custom::SeleniumTester",  
   "PhysicalResourceId" : "Tester1",
   "ResourceProperties" : <span>{</span>
      "seleniumTester" : "SeleniumTest()",
      "endpoints" : [ "http://mysite.com", "http://myecommercesite.com/", "http://search.mysite.com",
         "http://mynewsite.com" ],
      "frequencyOfTestsPerHour" : [ "3", "2", "4", "3" ]
   },
   "OldResourceProperties" : <span>{</span>
      "seleniumTester" : "SeleniumTest()",
      "endpoints" : [ "http://mysite.com", "http://myecommercesite.com/", "http://search.mysite.com" ],
      "frequencyOfTestsPerHour" : [ "3", "2", "4" ]
   }
}          </code></pre>
            </li><li>
               <p>Le custom resource provider traite les données envoyées par AWS CloudFormation. La ressource personnalisée effectue la mise à jour et envoie la réponse <code class="code">SUCCESS</code> ou <code class="code">FAILED</code> à l'URL S3. Ensuite, AWS CloudFormation compare ensuite la valeur <code class="code">PhysicalResourceIDs</code> de l'ancienne ressource personnalisée et de la nouvelle. Si elles sont différentes, AWS CloudFormation confirme que la mise à jour nécessite un remplacement et envoie une demande de suppression à l'ancienne ressource. L'exemple suivant présente la réponse du custom resource provider à une demande <code class="code">Update</code>.</p>
               <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Texte"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
   "Status" : "SUCCESS",
   "StackId" : "arn:aws:cloudformation:us-west-2:123456789012:stack/stack-name/guid",
   "RequestId" : "uniqueid for this update request",
   "LogicalResourceId" : "MySeleniumTester",
   "PhysicalResourceId" : "Tester2"
}           </code></pre>
               <p>Les champs <code class="code">StackId</code>, <code class="code">RequestId</code> et <code class="code">LogicalResourceId</code> doivent être copiés mot pour mot à partir de la demande.</p>
            </li><li>
               <p>AWS CloudFormation déclare le statut de la pile <code class="code">UPDATE_COMPLETE</code> ou <code class="code">UPDATE_FAILED</code>. En cas d'échec de la mise à jour, la pile est restaurée. Si la pile a bien été mise à jour, le template developer peut accéder aux nouvelles valeurs de sortie de la ressource personnalisée créée avec <code class="code"><code class="code">Fn::GetAtt</code></code>.</p>
            </li></ol></div>
         <p>Pour des informations détaillées sur les objets de demande et de réponse impliqués dans les demandes <code class="code">Update</code>, consultez <a href="./crpg-ref-requesttypes-update.html">Update</a> dans le document <a href="./crpg-ref.html">Référence sur les ressources personnalisées</a>.</p>
       
      <h3 id="crpg-walkthrough-stack-deletion">Étape 3 : Suppression d'une pile</h3>
         
         <div class="orderedlist">
             
             
             
             
         <ol style="list-style-type:arabic ! important;"><li>
               <p>Le template developer supprime une pile qui contient une ressource personnalisée. AWS CloudFormation récupère les propriétés spécifiées dans le modèle de la pile, ainsi que la rubrique SNS, et se prépare à envoyer une demande au custom resource provider.</p>
            </li><li>
               <p>AWS CloudFormation envoie une notification Amazon SNS au fournisseur de ressources avec un <code class="code">"RequestType" : "Delete"</code> qui contient des informations actuelles sur la pile, les propriétés des ressources personnalisées de son modèle et une URL S3 pour la réponse.</p>
               <p>Chaque fois que vous supprimez une pile ou que vous effectuez une mise à jour qui supprime ou remplace la ressource personnalisée, AWS CloudFormation compare la valeur <code class="code">PhysicalResourceId</code> entre l'ancienne ressource personnalisée et la nouvelle. Si elles sont différentes, AWS CloudFormation reconnaît la mise à jour en tant que remplacement et envoie une demande de suppression à l'ancienne ressource (<code class="code">OldPhysicalResource</code>), comme illustré dans l'exemple suivant de demande <code class="code">Delete</code>.</p>
               <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Texte"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
   "RequestType" : "Delete",
   "ResponseURL" : "http://pre-signed-S3-url-for-response",
   "StackId" : "arn:aws:cloudformation:us-west-2:123456789012:stack/stack-name/guid",
   "RequestId" : "unique id for this delete request",
   "ResourceType" : "Custom::SeleniumTester",
   "LogicalResourceId" : "MySeleniumTester",
   "PhysicalResourceId" : "Tester1",
   "ResourceProperties" : <span>{</span>
      "seleniumTester" : "SeleniumTest()",
      "endpoints" : [ "http://mysite.com", "http://myecommercesite.com/", "http://search.mysite.com",
         "http://mynewsite.com" ],
      "frequencyOfTestsPerHour" : [ "3", "2", "4", "3" ]
   }
}    
            </code></pre>
               <p><code class="code">DescribeStackResource</code>, <code class="code">DescribeStackResources</code>, et <code class="code">ListStackResources</code> affiche le nom défini par l'utilisateur, s'il a été spécifié.</p>
            </li><li>
               <p>Le custom resource provider traite les données envoyées par AWS CloudFormation et détermine si la demande <code class="code">Delete</code> a abouti. Le fournisseur de ressources utilise ensuite l'URL S3 envoyée par AWS CloudFormation pour envoyer la réponse <code class="code">SUCCESS</code> ou <code class="code">FAILED</code>. Pour supprimer une pile avec une ressource personnalisée, le custom resource provider doit répondre avec succès à une demande de suppression.</p>
               <p>Voici un exemple de réponse du custom resource provider à une demande <code class="code">Delete</code> :</p>
               <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Texte"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
   "Status" : "SUCCESS",
   "StackId" : "arn:aws:cloudformation:us-west-2:123456789012:stack/stack-name/guid",
   "RequestId" : "unique id for this delete request",
   "LogicalResourceId" : "MySeleniumTester",
   "PhysicalResourceId" : "Tester1"
}         </code></pre>
               <p>Les champs <code class="code">StackId</code>, <code class="code">RequestId</code> et <code class="code">LogicalResourceId</code> doivent être copiés mot pour mot à partir de la demande.</p>
            </li><li>
               <p>AWS CloudFormation déclare le statut de la pile <code class="code">DELETE_COMPLETE</code> ou <code class="code">DELETE_FAILED</code>.</p>
            </li></ol></div>
         <p>Pour des informations détaillées sur les objets de demande et de réponse impliqués dans les demandes <code class="code">Delete</code>, consultez <a href="./crpg-ref-requesttypes-delete.html">Delete</a> dans le document <a href="./crpg-ref.html">Référence sur les ressources personnalisées</a>.</p>
       
      <h3 id="w9aac23c26c14b5c12">Consultez aussi</h3>
         
         <div class="itemizedlist">
             
             
             
         <ul class="itemizedlist"><li class="listitem">
               <p><a href="./crpg-ref.html">Référence sur les ressources personnalisées AWS CloudFormation</a></p>
            </li><li class="listitem">
               <p><a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-resource-cloudformation-customresource.html"><code class="code">AWS::CloudFormation::CustomResource</code></a></p>
            </li><li class="listitem">
               <p><a href="./intrinsic-function-reference-getatt.html">Ventilateur : GetAtt</a></p>
            </li></ul></div>
       
   <awsdocs-copyright class="copyright-print"></awsdocs-copyright><awsdocs-thumb-feedback right-edge="{{$ctrl.thumbFeedbackRightEdge}}"></awsdocs-thumb-feedback></div><noscript><div><div><div><div id="js_error_message"><p><img src="https://d1ge0kk1l5kms0.cloudfront.net/images/G/01/webservices/console/warning.png" alt="Avertissement" /> <strong>JavaScript est désactivé ou n'est pas disponible dans votre navigateur.</strong></p><p>Pour que vous puissiez utiliser la documentation AWS, Javascript doit être activé. Vous trouverez des instructions sur les pages d'aide de votre navigateur.</p></div></div></div></div></noscript><div id="main-col-footer" class="awsui-util-font-size-0"><div id="doc-conventions"><a target="_top" href="/general/latest/gr/docconventions.html">Conventions de rédaction</a></div><div class="prev-next"><div id="previous" class="prev-link" accesskey="p" href="./template-custom-resources.html">Ressources personnalisées</div><div id="next" class="next-link" accesskey="n" href="./template-custom-resources-lambda.html">Ressources personnalisées basées sur AWS Lambda</div></div></div><awsdocs-page-utilities></awsdocs-page-utilities></div><div id="quick-feedback-yes" style="display: none;"><div class="title">Cette page vous a-t-elle été utile ? - Oui</div><div class="content"><p>Merci de nous avoir fait part de votre satisfaction.</p><p>Si vous avez quelques minutes à nous consacrer, merci de nous indiquer ce qui vous a plu afin que nous puissions nous améliorer davantage.</p><p><awsui-button id="fblink" rel="noopener noreferrer" target="_blank" text="Commentaire" click="linkClick($event)" href="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=CloudFormation&amp;topic_url=https://docs.aws.amazon.com/fr_fr/AWSCloudFormation/latest/UserGuide/template-custom-resources-sns.html"></awsui-button></p></div></div><div id="quick-feedback-no" style="display: none;"><div class="title">Cette page vous a-t-elle été utile ? - Non</div><div class="content"><p>Merci de nous avoir avertis que cette page avait besoin d'être retravaillée. Nous sommes désolés de ne pas avoir répondu à vos attentes.</p><p>Si vous avez quelques minutes à nous consacrer, merci de nous indiquer comment nous pourrions améliorer cette documentation.</p><p><awsui-button id="fblink" rel="noopener noreferrer" target="_blank" text="Commentaire" click="linkClick($event)" href="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=CloudFormation&amp;topic_url=https://docs.aws.amazon.com/fr_fr/AWSCloudFormation/latest/UserGuide/template-custom-resources-sns.html"></awsui-button></p></div></div></div></body></div></awsdocs-view><div class="page-loading-indicator" id="page-loading-indicator"><awsui-spinner size="large"></awsui-spinner></div></div><div id="tools-panel" dom-region="tools"><awsdocs-tools-panel id="awsdocs-tools-panel"></awsdocs-tools-panel></div></awsui-app-layout><awsdocs-cookie-banner class="doc-cookie-banner"></awsdocs-cookie-banner></div></body></html>