<!DOCTYPE html>
    <html xmlns="http://www.w3.org/1999/xhtml" lang="fr-FR"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Utilisation de AWS CloudFormation macros pour effectuer un traitement personnalisé sur les modèles - AWS CloudFormation</title><meta name="viewport" content="width=device-width,initial-scale=1" /><meta name="assets_root" content="/assets" /><meta name="target_state" content="template-macros" /><meta name="default_state" content="template-macros" /><link rel="icon" type="image/ico" href="/assets/images/favicon.ico" /><link rel="shortcut icon" type="image/ico" href="/assets/images/favicon.ico" /><link rel="canonical" href="https://docs.aws.amazon.com/fr_fr/AWSCloudFormation/latest/UserGuide/template-macros.html" /><meta name="description" content="Utilisez des macros pour effectuer un traitement personnalisé sur les modèles, qu'il s'agisse d'actions simples telles que find-and-replace des opérations ou de transformations étendues de modèles entiers." /><meta name="deployment_region" content="IAD" /><meta name="product" content="AWS CloudFormation" /><meta name="guide" content="Guide de l'utilisateur" /><meta name="abstract" content="Créez et gérez des déploiements AWS d'infrastructure de manière prévisible et répétée à l'aide de ce AWS CloudFormation guide de l'utilisateur." /><meta name="guide-locale" content="fr_fr" /><meta name="tocs" content="toc-contents.json" /><link rel="canonical" href="https://docs.aws.amazon.com/fr_fr/AWSCloudFormation/latest/UserGuide/template-macros.html" /><link rel="alternative" href="https://docs.aws.amazon.com/id_id/AWSCloudFormation/latest/UserGuide/template-macros.html" hreflang="id-id" /><link rel="alternative" href="https://docs.aws.amazon.com/id_id/AWSCloudFormation/latest/UserGuide/template-macros.html" hreflang="id" /><link rel="alternative" href="https://docs.aws.amazon.com/de_de/AWSCloudFormation/latest/UserGuide/template-macros.html" hreflang="de-de" /><link rel="alternative" href="https://docs.aws.amazon.com/de_de/AWSCloudFormation/latest/UserGuide/template-macros.html" hreflang="de" /><link rel="alternative" href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/template-macros.html" hreflang="en-us" /><link rel="alternative" href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/template-macros.html" hreflang="en" /><link rel="alternative" href="https://docs.aws.amazon.com/es_es/AWSCloudFormation/latest/UserGuide/template-macros.html" hreflang="es-es" /><link rel="alternative" href="https://docs.aws.amazon.com/es_es/AWSCloudFormation/latest/UserGuide/template-macros.html" hreflang="es" /><link rel="alternative" href="https://docs.aws.amazon.com/fr_fr/AWSCloudFormation/latest/UserGuide/template-macros.html" hreflang="fr-fr" /><link rel="alternative" href="https://docs.aws.amazon.com/fr_fr/AWSCloudFormation/latest/UserGuide/template-macros.html" hreflang="fr" /><link rel="alternative" href="https://docs.aws.amazon.com/it_it/AWSCloudFormation/latest/UserGuide/template-macros.html" hreflang="it-it" /><link rel="alternative" href="https://docs.aws.amazon.com/it_it/AWSCloudFormation/latest/UserGuide/template-macros.html" hreflang="it" /><link rel="alternative" href="https://docs.aws.amazon.com/ja_jp/AWSCloudFormation/latest/UserGuide/template-macros.html" hreflang="ja-jp" /><link rel="alternative" href="https://docs.aws.amazon.com/ja_jp/AWSCloudFormation/latest/UserGuide/template-macros.html" hreflang="ja" /><link rel="alternative" href="https://docs.aws.amazon.com/ko_kr/AWSCloudFormation/latest/UserGuide/template-macros.html" hreflang="ko-kr" /><link rel="alternative" href="https://docs.aws.amazon.com/ko_kr/AWSCloudFormation/latest/UserGuide/template-macros.html" hreflang="ko" /><link rel="alternative" href="https://docs.aws.amazon.com/pt_br/AWSCloudFormation/latest/UserGuide/template-macros.html" hreflang="pt-br" /><link rel="alternative" href="https://docs.aws.amazon.com/pt_br/AWSCloudFormation/latest/UserGuide/template-macros.html" hreflang="pt" /><link rel="alternative" href="https://docs.aws.amazon.com/zh_cn/AWSCloudFormation/latest/UserGuide/template-macros.html" hreflang="zh-cn" /><link rel="alternative" href="https://docs.aws.amazon.com/zh_tw/AWSCloudFormation/latest/UserGuide/template-macros.html" hreflang="zh-tw" /><link rel="alternative" href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/template-macros.html" hreflang="x-default" /><meta name="feedback-item" content="CloudFormation" /><meta name="this_doc_product" content="AWS CloudFormation" /><meta name="this_doc_guide" content="Guide de l'utilisateur" /><script defer="" src="/assets/r/vendor4.js?version=2021.12.02"></script><script defer="" src="/assets/r/vendor3.js?version=2021.12.02"></script><script defer="" src="/assets/r/vendor1.js?version=2021.12.02"></script><script defer="" src="/assets/r/awsdocs-common.js?version=2021.12.02"></script><script defer="" src="/assets/r/awsdocs-doc-page.js?version=2021.12.02"></script><link href="/assets/r/vendor4.css?version=2021.12.02" rel="stylesheet" /><link href="/assets/r/awsdocs-common.css?version=2021.12.02" rel="stylesheet" /><link href="/assets/r/awsdocs-doc-page.css?version=2021.12.02" rel="stylesheet" /><script async="" id="awsc-panorama-bundle" type="text/javascript" src="https://prod.pa.cdn.uis.awsstatic.com/panorama-nav-init.js" data-config="{'appEntity':'aws-documentation','region':'us-east-1','service':'cloudformation'}"></script><meta id="panorama-serviceSubSection" value="Guide de l'utilisateur" /><meta id="panorama-serviceConsolePage" value="Utilisation de AWS CloudFormation macros pour effectuer un traitement personnalisé sur les modèles" /></head><body class="awsdocs awsui"><div class="awsdocs-container"><awsdocs-header></awsdocs-header><awsui-app-layout id="app-layout" class="awsui-util-no-gutters" ng-controller="ContentController as $ctrl" header-selector="awsdocs-header" navigation-hide="false" navigation-width="$ctrl.navWidth" navigation-open="$ctrl.navOpen" navigation-change="$ctrl.onNavChange($event)" tools-hide="$ctrl.hideTools" tools-width="$ctrl.toolsWidth" tools-open="$ctrl.toolsOpen" tools-change="$ctrl.onToolsChange($event)"><div id="guide-toc" dom-region="navigation"><awsdocs-toc></awsdocs-toc></div><div id="main-column" dom-region="content" tabindex="-1"><awsdocs-view class="awsdocs-view"><div id="awsdocs-content"><head><title>Utilisation de AWS CloudFormation macros pour effectuer un traitement personnalisé sur les modèles - AWS CloudFormation</title><meta name="rss" content="aws-cloudformation-release-notes.rss" /><meta name="forums" content="http://forums.aws.amazon.com/forum.jspa?forumID=92" /><meta name="feedback" content="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=CloudFormation&amp;topic_url=https://docs.aws.amazon.com/fr_fr/AWSCloudFormation/latest/UserGuide/template-macros.html" /><meta name="feedback-yes" content="feedbackyes.html?topic_url=https://docs.aws.amazon.com/fr_fr/AWSCloudFormation/latest/UserGuide/template-macros.html" /><meta name="feedback-no" content="feedbackno.html?topic_url=https://docs.aws.amazon.com/fr_fr/AWSCloudFormation/latest/UserGuide/template-macros.html" /><meta name="keywords" content="CloudFormation,AWSCloudFormation,provisionnement des ressources,configuration des ressources,gestion de l'infrastructure,CloudFormer,CloudFormation pile,CloudFormation stackset,CloudFormation modèle,jeu de modifications" /><script type="application/ld+json">
{
    "@context" : "https://schema.org",
    "@type" : "BreadcrumbList",
    "itemListElement" : [
      {
        "@type" : "ListItem",
        "position" : 1,
        "name" : "AWS",
        "item" : "https://aws.amazon.com"
      },
      {
        "@type" : "ListItem",
        "position" : 2,
        "name" : "AWS CloudFormation",
        "item" : "https://docs.aws.amazon.com/cloudformation/index.html"
      },
      {
        "@type" : "ListItem",
        "position" : 3,
        "name" : "Guide de l'utilisateur",
        "item" : "https://docs.aws.amazon.com/fr_fr/AWSCloudFormation/latest/UserGuide"
      },
      {
        "@type" : "ListItem",
        "position" : 4,
        "name" : "Utilisation des modèles AWS CloudFormation",
        "item" : "https://docs.aws.amazon.com/fr_fr/AWSCloudFormation/latest/UserGuide/template-guide.html"
      },
      {
        "@type" : "ListItem",
        "position" : 5,
        "name" : "Utilisation de AWS CloudFormation macros pour effectuer un traitement personnalisé sur les modèles",
        "item" : "https://docs.aws.amazon.com/fr_fr/AWSCloudFormation/latest/UserGuide/template-guide.html"
      }
    ]
}
</script></head><body><div id="main"><div style="display: none"></div><div id="breadcrumbs" class="breadcrumb"><a href="https://aws.amazon.com">AWS</a><a href="/index.html">Documentation</a><a href="/cloudformation/index.html">AWS CloudFormation</a><a href="Welcome.html">Guide de l'utilisateur</a></div><div id="page-toc-src"><a href="#template-macros-overview">Comment fonctionnent AWS CloudFormation les macros</a><a href="#template-macros-author">Création d'une définition de AWS CloudFormation macro</a><a href="#template-macros-use">Utilisation de AWS CloudFormation macros dans vos modèles</a><a href="#template-macros-examples-list">Exemples de macros</a><a href="#template-macros-seealso">Consultez aussi</a></div><div id="main-content" class="awsui-util-container"><div id="main-col-body"><awsdocs-language-banner data-service="$ctrl.pageService"></awsdocs-language-banner><awsui-alert class="awsdocs-page-banner awsui-util-mb-l"><p>Les traductions sont fournies par des outils de traduction automatique. En cas de conflit entre le contenu d'une traduction et celui de la version originale en anglais, la version anglaise prévaudra.</p></awsui-alert><h1 class="topictitle" id="template-macros">Utilisation de AWS CloudFormation macros pour effectuer un traitement personnalisé sur les modèles</h1><div class="awsdocs-page-header-container"><awsdocs-page-header></awsdocs-page-header><awsdocs-filter-selector id="awsdocs-filter-selector"></awsdocs-filter-selector></div><p>Les macros vous permettent d'effectuer un traitement personnalisé sur les modèles, qu'il s'agisse d'actions simples telles que  find-and-replace  des opérations ou de transformations étendues de modèles entiers.</p><p>Pour avoir une idée de l'étendue des possibilités, considérez les <code class="code">AWS::Serverless</code> transformations <code class="code">AWS::Include</code> and, qui sont des macros hébergées par AWS CloudFormation :</p><div class="itemizedlist">
         
         
    <ul class="itemizedlist"><li class="listitem">
            <p><code class="code"><a href="./create-reusable-transform-function-snippets-and-add-to-your-template-with-aws-include-transform.html">Transformation AWS::Include</a></code> vous permet d'insérer des extraits de modèle réutilisables dans vos modèles.</p>
        </li><li class="listitem">
            <p><code class="code"><a href="./transform-aws-serverless.html">Transformation AWS::Serverless</a></code>prend un modèle entier écrit dans la syntaxeAWS SAM ( AWS Serverless Application Model), le transforme et le développe en un AWS CloudFormation modèle conforme. (Pour plus d'informations sur les applications sans serveur et sur AWS SAM, veuillez consulter la rubrique <a href="https://docs.aws.amazon.com/lambda/latest/dg/deploying-lambda-apps.html">Déploiement d'applications basées sur Lambda</a> dans le <em>Guide du développeurAWS Lambda </em>.)</p>
        </li></ul></div><h2 id="template-macros-overview">Comment fonctionnent AWS CloudFormation les macros</h2><p>Il existe deux étapes principales pour le traitement des modèles à l'aide de macros : la <em>création</em> de la macro elle-même, puis l'<em>utilisation</em> de la macro pour effectuer un traitement sur vos modèles.</p><p>Pour créer la définition d'une macro, vous devez créer les éléments suivants :</p><div class="itemizedlist">
         
         
    <ul class="itemizedlist"><li class="listitem">
            <p> AWS Lambda Fonction permettant d'effectuer le traitement du modèle. Cette fonction Lambda accepte un extrait ou un modèle complet, ainsi que tous les paramètres supplémentaires que vous définissez. Elle renvoie l'extrait de modèle traité ou l'ensemble du modèle comme réponse.</p>
        </li><li class="listitem">
            <p>Ressource de type<code class="code"><a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-resource-cloudformation-macro.html">AWS::CloudFormation::Macro</a></code>, qui permet aux utilisateurs d'appeler la fonction Lambda depuis des modèles. AWS CloudFormation Cette ressource spécifie l'ARN de la fonction Lambda à appeler pour cette macro, ainsi que d'autres propriétés facultatives pour faciliter le débogage. Pour créer cette ressource dans un compte, créez un modèle qui inclut une <code class="code"><a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-resource-cloudformation-macro.html">AWS::CloudFormation::Macro</a></code> ressource, puis créez une pile ou un ensemble de piles avec des autorisations autogérées à partir du modèle. AWS CloudFormation StackSetsne prend actuellement pas en charge la création ou la mise à jour d'ensembles de piles avec des autorisations gérées par les services à partir de modèles faisant référence à des macros.</p>
        </li></ul></div><p>Pour utiliser une macro, référencez la macro dans votre modèle :</p><div class="itemizedlist">
         
         
    <ul class="itemizedlist"><li class="listitem">
            <p>Pour traiter une section ou un <em>extrait</em> d'un modèle, référencez la macro dans une fonction <code class="code"><a href="./intrinsic-function-reference-transform.html">Fn::Transform</a></code> située par rapport au contenu de modèle que vous souhaitez transformer. Lorsque vous utilisez <code class="code">Fn::Transform</code>, vous pouvez également transmettre tous les paramètres spécifiés qu'elle requiert.</p>
        </li><li class="listitem">
            <p>Pour traiter un modèle complet, référencez la macro dans la section <a href="./transform-section-structure.html">Transformation</a> du modèle.</p>
        </li></ul></div><p>En règle générale, vous créez ensuite un jeu de modifications que vous exécutez. (Le traitement des macros peut ajouter plusieurs ressources dont vous n'êtes peut-être pas au courant. Pour vous assurer que vous êtes au courant de toutes les modifications introduites par les macros, nous vous conseillons vivement d'utiliser des ensembles de modifications.) AWS CloudFormation transmet le contenu du modèle spécifié, ainsi que tous les paramètres supplémentaires spécifiés, à la fonction Lambda spécifiée dans la ressource macro. La fonction Lambda renvoie le contenu de modèle traité, qu'il s'agisse d'un extrait ou d'un modèle complet.</p><p>Une fois que toutes les macros du modèle ont été appelées, AWS CloudFormation génère un ensemble de modifications qui inclut le contenu du modèle traité. Après avoir passé en revue le jeu de modifications, exécutez-le pour appliquer les modifications.</p><div class="awsdocs-note awsdocs-important"><div class="awsdocs-note-title"><awsui-icon name="status-warning" variant="error"></awsui-icon><h6>Important</h6></div><div class="awsdocs-note-text"><p>Si votre modèle d'ensemble de piles référence une ou plusieurs macros, vous devez créer une pile directement à partir du modèle traité, sans examiner au préalable les modifications qui en résultent dans un jeu de modifications. Pour créer ou mettre à jour directement l'ensemble de piles, vous devez utiliser l'<a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/APIReference/API_UpdateStackSet.html"><code class="code">UpdateStackSet</code></a>action <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/APIReference/API_CreateStackSet.html"><code class="code">CreateStackSet</code></a>ou et spécifier la <code class="code">CAPABILITY_AUTO_EXPAND</code> fonctionnalité. Avant de créer ou de mettre à jour un ensemble de piles à partir d'un modèle qui référence directement les macros, assurez-vous de connaître les transformations effectuées par la macro.</p></div></div><div class="mediaobject">
         
            
            <img src="images/template-macro-use.png" class="aws-docs-img-whiteBg aws-docs-img-padding" alt="&#xA;            Utilisez la fonction Fn::Transform intrinsèque ou la Transform section du modèle pour transmettre le contenu du modèle et les paramètres associés à la Lambda fonction sous-jacente de la macro, qui renvoie le contenu du modèle traité.&#xA;        " style="max-width:100%" />
         
         
    </div><div class="awsdocs-note"><div class="awsdocs-note-title"><awsui-icon name="status-info" variant="link"></awsui-icon><h6>Note</h6></div><div class="awsdocs-note-text"><p>Si vous ne craignez pas de créer ou de mettre à jour une pile directement à partir d'un modèle traité, sans vérifier d'abord les modifications proposées dans un jeu de modifications, vous pouvez le faire en spécifiant la capacité <code class="code">CAPABILITY_AUTO_EXPAND</code> lors d'une requête <code class="code">UpdateStack</code> ou <code class="code">CreateStack</code>. Ne créez directement de piles à partir d'un modèle qui référence des macros qu'à la condition de connaître les transformations effectuées par la macro.</p><p>Pour plus d'informations, consultez <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/APIReference/API_CreateStack.html">CreateStack</a>ou consultez <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/APIReference/API_UpdateStack.html">UpdateStack</a>le Guide de <em>référence desAWS CloudFormation API</em>.</p></div></div><h2 id="template-macros-author">Création d'une définition de AWS CloudFormation macro</h2>
        <p>Lorsque vous créez une définition de macro, la définition de macro rend la fonction Lambda sous-jacente disponible dans le compte spécifié afin qu'elle l' AWS CloudFormation invoque pour traiter les modèles.</p>
        
        <h3 id="template-macros-lambda-interface">AWS CloudFormation interface de fonction macro</h3>
            <p>Pour les macros, AWS CloudFormation appelle les fonctions Lambda sous-jacentes avec le mappage d'événements suivant. AWS CloudFormation envoie sa demande au format JSON et s'attend à ce que la réponse de la fonction soit également formatée au format JSON.</p>
            <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Texte"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
    "region" : "<code class="replaceable">us-east-1</code>",
    "accountId" : "<code class="replaceable">$ACCOUNT_ID</code>",
    "fragment" : <span>{</span> <code class="replaceable">...</code> },
    "transformId" : "<code class="replaceable">$TRANSFORM_ID</code>",
    "params" : <span>{</span> <code class="replaceable">...</code> },
    "requestId" : "<code class="replaceable">$REQUEST_ID</code>",
    "templateParameterValues" : <span>{</span> <code class="replaceable">...</code> }
}</code></pre>

            <div class="itemizedlist">
                 
                 
                 
                 
                 
                 
                 
            <ul class="itemizedlist"><li class="listitem"><p><b>region</b></p>
                    <p>Région dans laquelle la macro réside.</p>
                </li><li class="listitem"><p><b>accountId</b></p>
                    <p>ID de compte du compte à partir duquel la macro appelle la fonction Lambda.</p>
                </li><li class="listitem"><p><b>fragment</b></p>
                    <p>Contenu de modèle disponible pour un traitement personnalisé, au format JSON.</p>
                    <div class="itemizedlist">
                         
                         
                    <ul class="itemizedlist"><li class="listitem"><p>Pour les macros incluses dans la section <code class="code">Transform</code> du modèle, il s'agit du modèle complet à l'exception de la section <code class="code">Transform</code>.</p></li><li class="listitem"><p>Pour les macros incluses dans un appel de fonction intrinsèque <code class="code">Fn::Transform</code>, cela inclut tous les nœuds frères (et leurs enfants) en fonction de l'emplacement de la fonction intrinsèque au sein du modèle à l'exception de la fonction <code class="code">Fn::Transform</code>. Pour de plus amples informations, veuillez consulter <a href="#template-macros-scope">AWS CloudFormation champ d'application macro</a>.</p></li></ul></div>
                </li><li class="listitem"><p><b>transformId</b></p>
                    <p>Nom de la macro qui appelle cette fonction.</p>
                </li><li class="listitem"><p><b>params</b></p>
                    <p>Pour les appels de <code class="code">Fn::Transform</code> fonction, tous les paramètres spécifiés pour la fonction. AWS CloudFormation n'évalue pas ces paramètres avant de les transmettre à la fonction.</p>
                    <p>Pour les macros incluses dans la section <code class="code">Transform</code> du modèle, cette section est vide.</p>
                </li><li class="listitem"><p><b>requestId</b></p>
                    <p>ID de la demande qui appelle cette fonction.</p>
                </li><li class="listitem"><p><b>templateParameterValues</b></p>
                    <p>Tous les paramètres spécifiés dans la section <a href="./parameters-section-structure.html">Paramètres</a> du modèle. AWS CloudFormation évalue ces paramètres avant de les transmettre à la fonction.</p>
                </li></ul></div>
            <p>AWS CloudFormation attend de la fonction sous-jacente qu'elle renvoie une réponse au format JSON suivant :</p>
            <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Texte"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
    "requestId" : "<code class="replaceable">$REQUEST_ID</code>",
    "status" : "<code class="replaceable">$STATUS</code>",
    "fragment" : <span>{</span> <code class="replaceable">...</code> }
    "errorMessage": "optional error message for failures"
}</code></pre>
            <div class="itemizedlist">
                 
                 
                 
                 
            <ul class="itemizedlist"><li class="listitem"><p><b>requestId</b></p>
                    <p>ID de la demande qui appelle cette fonction. Cela doit correspondre à l'ID de demande fourni AWS CloudFormation lors de l'appel de la fonction.</p>
                </li><li class="listitem"><p><b>status</b></p>
                    <p>Statut de la demande (non sensible à la casse). Doit être défini sur <code class="code">success</code>. AWS CloudFormation traite toute autre réponse comme un échec.</p>
                </li><li class="listitem"><p><b>fragment</b></p>
                    <p>Le contenu du modèle traité AWS CloudFormation à inclure dans le modèle traité, y compris les frères et sœurs. AWS CloudFormation remplace le contenu du modèle transmis à la fonction Lambda par le fragment de modèle qu'elle reçoit dans la réponse Lambda.</p>
                    <p>Le contenu de modèle traité doit être dans un format JSON valide et son inclusion dans le modèle traité doit engendrer un modèle valide.</p>
                    <p>Si votre fonction ne modifie pas réellement le contenu du modèle qui AWS CloudFormation
lui est transmis, mais que vous devez tout de même inclure ce contenu dans le modèle traité, votre fonction doit renvoyer le contenu du modèle AWS CloudFormation dans sa réponse.</p>
                </li><li class="listitem">
                    <p><b>errorMessage</b></p>
                    <p>Message d'erreur expliquant pourquoi la transformation a échoué.  CloudFormation affiche ce message d'erreur dans le volet <b>Événements</b> de la page d’<b>Informations de la pile</b> pour votre pile.</p>
                    <p>Par exemple, « Erreur de création de l'ensemble de modifications : Transformer le <code class="replaceable">numéro de compteCompte AWS
</code> : :<code class="replaceable">nom de macro</code> a échoué avec : <code class="replaceable">chaîne de message d'erreur</code> ».</p>
                </li></ul></div>
            <p>Pour obtenir des informations sur des considérations supplémentaires lors de la création de macros, consultez <a href="#template-macros-considerations">Considérations relatives à la création de définitions de AWS CloudFormation macros</a>.</p>
         
        
        <h3 id="template-macros-permissions">AWS CloudFormation étendue et autorisations du compte macro</h3>
            <p>Vous pouvez utiliser des macros uniquement dans le compte où elles ont été créées en tant que ressource. Le nom de la macro doit être unique au sein d'un compte donné. Toutefois, vous pouvez mettre à disposition les mêmes fonctionnalités dans plusieurs comptes en permettant l'accès entre comptes sur la fonction Lambda, puis en créant des définitions de macro référençant cette fonction dans plusieurs comptes. Dans l'exemple ci-dessous, trois comptes contiennent des définitions de macro qui pointent toutes vers la même fonction Lambda.</p>
            <div class="mediaobject">
                 
                    <img src="images/template-macro-accounts.png" class="aws-docs-img-whiteBg aws-docs-img-padding" alt="&#xA;                    En autorisant l'accès entre comptes à la Lambda fonction, AWS vous pouvez créer des macros dans plusieurs comptes qui font référence à cette fonction.&#xA;                " style="max-width:100%" />
                 
                 
            </div>
            <p>Pour plus d'informations, consultez la section <a href="https://docs.aws.amazon.com/lambda/latest/dg/access-control-overview.html">Présentation de la gestion des autorisations d'accès à vos ressources AWS Lambda</a> dans le Guide du <em>AWS Lambda développeur</em>.</p>
            <p>Afin de créer la définition d'une macro, l'utilisateur doit disposer d'autorisations pour créer une pile ou un ensemble de piles dans le compte spécifié.</p>
            <p> AWS CloudFormation Pour exécuter correctement une macro incluse dans un modèle, l'utilisateur doit disposer d'<code class="code">Invoke</code>autorisations pour la fonction Lambda sous-jacente. Pour éviter une éventuelle escalade des autorisations, AWS CloudFormation usurpe l'identité de l'utilisateur lors de l'exécution de la macro. Pour plus d'informations, veuillez consulter la rubrique <a href="https://docs.aws.amazon.com/lambda/latest/dg/intro-permission-model.html">Modèle d'autorisations Lambda</a> dans le <em>Guide du développeurAWS Lambda </em> et <a href="https://docs.aws.amazon.com/IAM/latest/UserGuide/list_lambda.html">Actions et clés de contexte de condition pour AWS Lambda</a> dans le <em>Guide de l'utilisateur IAM</em>.</p>
            <p>Les <a href="./create-reusable-transform-function-snippets-and-add-to-your-template-with-aws-include-transform.html">Transformation AWS::Include</a> transformations <a href="./transform-aws-serverless.html">Transformation AWS::Serverless</a> et sont des macros hébergées par AWS CloudFormation. Aucune autorisation spéciale n'est nécessaire pour les utiliser et elles sont disponibles à partir de n'importe quel compte dans AWS CloudFormation.</p>
          
        <h3 id="template-macros-debug">Macros de débogage AWS CloudFormation</h3>
            <p>Pour faciliter le débogage, vous pouvez également spécifier les propriétés <code class="code">LogGroupName</code> et <code class="code">LogRoleArn</code> lorsque vous créez le type de ressource <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-resource-cloudformation-macro.html">AWS::CloudFormation::Macro</a> pour votre macro. Ces propriétés vous permettent de spécifier le groupe de  CloudWatch  journaux auquel les informations de journalisation des erreurs sont AWS CloudFormation envoyées lorsque vous appelez la AWS Lambda fonction sous-jacente de la macro, et le rôle AWS CloudFormation doit être assumé lors de l'envoi d'entrées de journal à ces journaux.</p>
          
        <h3 id="template-macros-billing">Facturation</h3>
            <p>Lorsqu'une macro s'exécute, tous les frais liés à l'exécution de la fonction Lambda sont facturés au propriétaire de cette fonction.</p>
            <p>Les <a href="./create-reusable-transform-function-snippets-and-add-to-your-template-with-aws-include-transform.html">Transformation AWS::Include</a> transformations <a href="./transform-aws-serverless.html">Transformation AWS::Serverless</a> et sont des macros hébergées par AWS CloudFormation. Aucun frais ne s'applique à leur utilisation.</p>
         
        <h3 id="template-macros-considerations">Considérations relatives à la création de définitions de AWS CloudFormation macros</h3>
            <p>Lors de la création de définitions de macros, gardez à l'esprit les informations suivantes :</p>
            <div class="itemizedlist">
                 
                 
                 
                 
                
                 
                 
                 
                
                 
                 
                 
                 
                 
            <ul class="itemizedlist"><li class="listitem"><p>Les macros ne sont prises en charge que Régions AWS là où elles AWS Lambda sont disponibles. Pour obtenir une liste de toutes les régions où Lambda est actuellement disponible, veuillez consulter la rubrique <a href="https://docs.aws.amazon.com/general/latest/gr/lambda-service.html">Points de terminaison et quotasAWS Lambda</a>.</p></li><li class="listitem"><p>Tout les extraits de modèle traités doivent être dans un format JSON valide.</p></li><li class="listitem"><p>Tous les extraits de modèle traités doivent réussir les vérifications de validation pour une opération de création ou de mise à jour de pile ou d'ensemble de piles.</p></li><li class="listitem"><p>AWS CloudFormation résout d'abord les macros, puis traite le modèle. Le modèle résultant doit être dans un format JSON valide et ne doit pas dépasser la limite de taille de modèle.</p></li><li class="listitem"><p>En raison de l'ordre dans lequel  CloudFormation  les éléments d'un modèle sont traités, une macro ne peut pas inclure de modules dans le contenu du modèle traité auquel elle renvoie CloudFormation. Pour plus d'informations sur les modules, consultez la section <a href="https://docs.aws.amazon.com/cloudformation-cli/latest/userguide/modules.html">Développement de modules</a> dans le <em>guide de l'utilisateur de la CloudFormation  CLI</em>.</p></li><li class="listitem"><p>Lorsque vous utilisez la fonctionnalité d'annulation des mises à jour, AWS CloudFormation utilise une copie du modèle d'origine. Le modèle d'origine est restauré même si l'extrait inclus a été modifié.</p></li><li class="listitem"><p>L'inclusion de macros dans des macros ne fonctionne pas, car nous ne traitons pas les macros de façon itérative.</p></li><li class="listitem"><p>La fonction intrinsèque <code class="code">Fn::ImportValue</code> n'est pas actuellement prise en charge dans les macros.</p></li><li class="listitem"><p>Les fonctions intrinsèques incluses dans le modèle sont évaluées après les macros éventuelles. Par conséquent, le contenu de modèle traité que votre macro renvoie peut inclure des appels à des fonctions intrinsèques, et ils sont évalués comme d'habitude.</p></li><li class="listitem"><p>StackSets ne prend actuellement pas en charge la création ou la mise à jour d'ensembles de piles avec des autorisations gérées par les services à partir de modèles faisant référence AWS CloudFormation à des macros.</p></li><li class="listitem"><p>Si votre modèle d'ensemble de piles référence une ou plusieurs macros, vous devez créer ou mettre à jour une pile directement à partir du modèle traité, sans examiner au préalable les modifications qui en résultent dans un jeu de modifications. Pour créer ou mettre à jour directement l'ensemble de piles, utilisez l'<a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/APIReference/API_UpdateStackSet.html"><code class="code">UpdateStackSet</code></a>action <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/APIReference/API_CreateStackSet.html"><code class="code">CreateStackSet</code></a>ou et spécifiez la <code class="code">CAPABILITY_AUTO_EXPAND</code> fonctionnalité. Le traitement des macros peut ajouter plusieurs ressources à votre insu. Avant de créer ou de mettre à jour un ensemble de piles à partir d'un modèle qui référence directement les macros, assurez-vous de connaître les transformations effectuées par la macro.</p></li><li class="listitem">
                    
                    <p>Les jeux de modifications ne prennent pas en charge actuellement les piles imbriquées. Si vous souhaitez créer ou mettre à jour une pile à l'aide d'un modèle qui référence des macros <em>et</em> contient des piles imbriquées, vous devez créer ou mettre à jour la pile directement. Pour ce faire, utilisez l'<a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/APIReference/API_UpdateStack.html"><code class="code">UpdateStack</code></a>action <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/APIReference/API_CreateStack.html"><code class="code">CreateStack</code></a>ou et spécifiez la <code class="code">CAPABILITY_AUTO_EXPAND</code> fonctionnalité.</p>
                </li></ul></div>
         
        <div class="procedure"><h6>Pour créer une définition de AWS CloudFormation macro :</h6><ol><li>
                <p><a href="https://docs.aws.amazon.com/lambda/latest/dg/lambda-app.html">Créez une AWS Lambda fonction</a> qui traite les AWS CloudFormation modèles.</p>
                <p>La fonction Lambda que vous générez effectue le traitement du contenu du modèle. Votre fonction peut traiter n'importe quelle partie d'un modèle, jusqu'à l'intégralité du modèle. Pour obtenir des informations sur le mappage d'événements auquel votre fonction doit adhérer, consultez <a href="#template-macros-lambda-interface">AWS CloudFormation interface de fonction macro</a>. Pour obtenir des informations sur des considérations supplémentaires lors de la création de macros, consultez <a href="#template-macros-considerations">Considérations relatives à la création de définitions de AWS CloudFormation macros</a>.</p>
            </li><li>
                <p><a href="./template-guide.html">Créez un modèle</a> contenant un type de <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-resource-cloudformation-macro.html">AWS::CloudFormation::Macro</a>ressource.</p>
                <div class="itemizedlist">
                     
                     
                <ul class="itemizedlist"><li class="listitem"><p>Vous devez spécifier les propriétés <code class="code">Name</code> et <code class="code">FunctionName</code>. La <code class="code">FunctionName</code> propriété spécifie l'ARN de la fonction Lambda à invoquer lors de l' AWS CloudFormation exécution de la macro.</p></li><li class="listitem"><p>Pour faciliter le débogage, vous pouvez également spécifier les propriétés <code class="code">LogGroupName</code> et <code class="code">LogRoleArn</code>.</p></li></ul></div>
            </li><li>
                <p><a href="./cfn-console-create-stack.html">Créez une pile</a> à partir du modèle contenant la macro dans le compte souhaité ou <a href="./stacksets-getting-started-create.html#stacksets-getting-started-create-self-managed">créez un ensemble de piles avec des autorisations auto-gérées</a> à partir du modèle qui référence la macro dans le compte administrateur, puis créez des instances de pile dans les comptes cibles de votre choix.</p>
                <p>Une AWS CloudFormation fois que les piles contenant la définition de la macro ont été créées avec succès, la macro peut être utilisée dans ces comptes.</p>
            </li></ol></div>


    <h2 id="template-macros-use">Utilisation de AWS CloudFormation macros dans vos modèles</h2>
        <p>Une AWS CloudFormation fois que les piles contenant la définition de la macro ont été créées avec succès, la macro peut être utilisée dans ces comptes. Vous utilisez une macro en la référençant dans le modèle, à l'emplacement approprié correspondant au contenu de modèle que vous souhaitez traiter.</p>
        <h3 id="template-macros-order">AWS CloudFormation ordre d'évaluation des macros</h3>
            <p>Vous pouvez référencer plusieurs macros dans un modèle donné, y compris des transformations hébergées par AWS CloudFormation, telles que <a href="./create-reusable-transform-function-snippets-and-add-to-your-template-with-aws-include-transform.html">Transformation AWS::Include</a> et<a href="./transform-aws-serverless.html">Transformation AWS::Serverless</a>.</p>
            <p>Les macros sont évaluées dans l'ordre, en fonction de leur emplacement dans le modèle, du plus profondément imbriqué jusqu'au plus général. Les macros figurant dans le même emplacement dans le modèle sont évaluées en série en fonction de l'ordre dans lequel elles sont répertoriées.</p>
            <p>Les transformations telles que <code class="code">AWS::Include</code> et <code class="code">AWS::Transform</code> sont traitées de la même manière que toutes les autres macros en termes d'ordre et de portée d'action.</p>
            <p>Par exemple, dans l'exemple de modèle ci-dessous, AWS CloudFormation évalue d'abord la <code class="code">PolicyAdder</code> macro, car il s'agit de la macro la plus profondément imbriquée du modèle. AWS CloudFormation évalue ensuite <code class="code">MyMacro</code> avant d'évaluer <code class="code">AWS::Serverless</code> car il est répertorié précédemment <code class="code">AWS::Serverless</code> dans la <code class="code">Transform</code> section.</p>
            <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Texte"><awsui-icon name="copy"></awsui-icon></div></div><code class="yaml ">AWSTemplateFormatVersion: 2010-09-09
 Transform: [MyMacro, AWS::Serverless]
 Resources:
    WaitCondition:
      Type: AWS::CloudFormation::WaitCondition
    MyBucket:
      Type: 'AWS::S3::Bucket'
      Properties:
        BucketName: MyBucket
        Tags: [<span>{</span>"key":"value"}]
        'Fn::Transform':
          - Name: PolicyAdder
        CorsConfiguration:[]
    MyEc2Instance:
      Type: 'AWS::EC2::Instance'
      Properties:
        ImageID: "ami-123"</code></pre>
          
        
        <h3 id="template-macros-scope">AWS CloudFormation champ d'application macro</h3>
            <p>Les macros référencées dans la section <code class="code">Transform</code> d'un modèle peuvent traiter l'ensemble du contenu de ce modèle.</p>
            <p>Les macros référencées dans une fonction <code class="code">Fn::Transform</code> peuvent traiter le contenu de tous les éléments frères (y compris de leurs enfants) de cette fonction <code class="code">Fn::Transform</code> dans le modèle.</p>
            <p>Par exemple, dans l'exemple de modèle ci-dessous, <code class="code">AWS::Include</code> peut traiter toutes les propriétés <code class="code">MyBucket</code>, en fonction de l'emplacement de la fonction <code class="code">Fn::Transform</code> qui les contient. <code class="code">MyMacro</code> peut traiter le contenu du modèle complet en raison de son inclusion dans la section <code class="code">Transform</code>.</p>
            <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Texte"><awsui-icon name="copy"></awsui-icon></div></div><code class="yaml ">
// Start of processable content for MyMacro
AWSTemplateFormatVersion: 2010-09-09 
 Transform: [MyMacro]
 Resources:
    WaitCondition:
      Type: AWS::CloudFormation::WaitCondition
    MyBucket:
      Type: 'AWS::S3::Bucket'  //Start of processable content for AWS::Include
      Properties:
        BucketName: MyBucket 
        Tags: [<span>{</span>"key":"value"}] 
        'Fn::Transform':
          - Name: 'AWS::Include'
              Parameters:
                Location: s3://<code class="replaceable">DOC-EXAMPLE-BUCKET</code>/MyFileName.yaml
        CorsConfiguration:[]   //End of processable content for AWS::Include
    MyEc2Instance:
      Type: 'AWS::EC2::Instance' 
      Properties:
        ImageID: "ami-123"
// End of processable content for MyMacro         </code></pre>
          
        
         
         <h3 id="template-macros-change-sets">Ensembles de modifications et AWS CloudFormation macros</h3>
            <p>Pour créer ou mettre à jour une pile à l'aide d'un modèle qui référence des macros, en règle générale vous créez un jeu de modifications que vous exécutez ensuite. Un jeu de modifications décrit les actions qu' CloudFormation  va entreprendre en fonction du modèle traité. Le traitement des macros peut ajouter plusieurs ressources à votre insu. Pour garantir que vous ayez connaissance de toutes les modifications apportées par les macros, nous vous suggérons vivement d'utiliser des jeux de modifications. Après avoir passé en revue le jeu de modifications, vous pouvez l'exécuter pour en appliquer les modifications.</p>
            <p>Une macro peut ajouter des ressources IAM à votre modèle. Pour ces ressources, AWS CloudFormation
vous demande de <a href="./using-iam-template.html#using-iam-capabilities">reconnaître leurs capacités</a>. Comme il est AWS CloudFormation impossible de savoir quelles ressources sont ajoutées avant de traiter votre modèle, vous devrez peut-être reconnaître les fonctionnalités IAM lors de la création de l'ensemble de modifications, selon que les macros référencées contiennent ou non des ressources IAM. Ainsi, lorsque vous exécutez l'ensemble de modifications, il AWS CloudFormation dispose des fonctionnalités nécessaires pour créer des ressources IAM.</p>
            <div class="awsdocs-note awsdocs-important"><div class="awsdocs-note-title"><awsui-icon name="status-warning" variant="error"></awsui-icon><h6>Important</h6></div><div class="awsdocs-note-text"><p>Si votre modèle d'ensemble de piles référence une ou plusieurs macros, vous devez créer une pile directement à partir du modèle traité, sans examiner au préalable les modifications qui en résultent dans un jeu de modifications. Pour créer ou mettre à jour directement l'ensemble de piles, vous devez utiliser l'<a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/APIReference/API_UpdateStackSet.html"><code class="code">UpdateStackSet</code></a>action <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/APIReference/API_CreateStackSet.html"><code class="code">CreateStackSet</code></a>ou et spécifier la <code class="code">CAPABILITY_AUTO_EXPAND</code> fonctionnalité. Avant de créer ou de mettre à jour un ensemble de piles à partir d'un modèle qui référence directement les macros, assurez-vous de connaître les transformations effectuées par la macro.</p></div></div>
            <div class="awsdocs-note"><div class="awsdocs-note-title"><awsui-icon name="status-info" variant="link"></awsui-icon><h6>Note</h6></div><div class="awsdocs-note-text"><p>Si vous ne craignez pas de créer ou de mettre à jour une pile directement à partir d'un modèle traité, sans vérifier d'abord les modifications proposées dans un jeu de modifications, vous pouvez le faire en spécifiant la capacité <code class="code">CAPABILITY_AUTO_EXPAND</code> lors d'une requête <code class="code">UpdateStack</code> ou <code class="code">CreateStack</code>. Ne créez directement de piles à partir d'un modèle de pile qui contient des macros qu'à la condition de connaître les transformations effectuées par la macro. Vous ne pouvez pas utiliser de jeux de modifications avec des macros d'ensemble de piles. Vous devez mettre à jour votre ensemble de piles directement.</p><p>Pour plus d'informations, consultez <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/APIReference/API_CreateStack.html"><code class="code">CreateStack</code></a>ou consultez <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/APIReference/API_UpdateStack.html"><code class="code">UpdateStack</code></a>le Guide de <em>référence desAWS CloudFormation API</em>.</p></div></div>
            <p>Si vous utilisez les commandes AWS CLI, vous pouvez utiliser les <code class="code">deploy</code> commandes <code class="code">package</code> et pour réduire le nombre d'étapes de lancement de piles à partir de modèles faisant référence à des macros. Pour plus d'informations, veuillez consulter <a href="https://docs.aws.amazon.com/lambda/latest/dg/deploying-lambda-apps.html">Déploiement d'applications basées sur Lambda</a> dans le <em>Guide du développeurAWS Lambda </em>.</p>
         
   
        <h3 id="template-macros-template-stage">Étape du modèle et  CloudFormation  macros</h3>
            <p>L'<em>étape</em> d'un modèle indique s'il s'agit du modèle original soumis par l'utilisateur ou d'un modèle dans lequel les macros AWS CloudFormation ont été traitées.</p>
            <div class="itemizedlist">
                 
                 
            <ul class="itemizedlist"><li class="listitem"><p><code class="code">Original</code> : modèle initialement soumis par l'utilisateur pour créer ou mettre à jour la pile ou l'ensemble de piles.</p></li><li class="listitem"><p><code class="code">Processed</code>: modèle AWS CloudFormation utilisé pour créer ou mettre à jour la pile ou l'ensemble de piles après le traitement des macros référencées. Le modèle traité est formaté au format JSON, même si le modèle d'origine a été formaté comme YAML.</p></li></ul></div>
            <p>Utilisez le modèle traité pour le dépannage des problèmes de la pile. Si un modèle ne référence pas de macros, le modèle d'origine et le modèle traité sont identiques.</p>
            <p>Vous pouvez utiliser la AWS CloudFormation <a href="./cfn-console-view-stack-data-resources.html">console</a> ou <a href="./using-cfn-get-template.html">AWS CLI</a>voir le stade d'un modèle de pile.</p>
            <div class="awsdocs-note"><div class="awsdocs-note-title"><awsui-icon name="status-info" variant="link"></awsui-icon><h6>Note</h6></div><div class="awsdocs-note-text"><p>La taille maximale d'un modèle de pile traité est de 51 200 octets lorsqu'il est transmis directement dans une demande <code class="code">CreateStack</code>, <code class="code">UpdateStack</code> ou <code class="code">ValidateTemplate</code>, ou de 1 Mo lorsqu'il est transmis en tant qu'objet S3 à l'aide d'une URL de modèle Amazon S3. Cependant, pendant le traitement, l'état temporaire du modèle est mis à  CloudFormation  jour car il traite en série les macros contenues dans le modèle. De ce fait, la taille du modèle <em>pendant le traitement</em> peut temporairement dépasser la taille autorisée d'un modèle entièrement traité.  CloudFormation permet une certaine mémoire tampon pour ces modèles en cours de traitement. Cependant, vous devez concevoir vos modèles et vos macros en gardant à l'esprit la taille maximale autorisée pour un modèle de pile traité.</p><p>Si une <code class="code">Transformation data limit exceeded</code> erreur est  CloudFormation  renvoyée lors du traitement de votre modèle, cela signifie que votre modèle a dépassé la taille maximale  CloudFormation  autorisée pendant le traitement.</p><p>Pour résoudre ce problème, envisagez de faire ce qui suit :</p><div class="itemizedlist">
                     
                     
                <ul class="itemizedlist"><li class="listitem"><p>Restructurer votre modèle en plusieurs modèles pour éviter de dépasser la taille maximale autorisée pour les modèles en cours de traitement. Par exemple :</p>
                        <div class="itemizedlist">
                             
                             
                        <ul class="itemizedlist"><li class="listitem"><p>Utilisez des modèles de piles imbriquées pour encapsuler des parties du modèle. Pour de plus amples informations, veuillez consulter <a href="./using-cfn-nested-stacks.html">Utilisation des piles imbriquées</a>.</p></li><li class="listitem"><p>Créez plusieurs piles et utilisez des références entre piles pour échanger des informations entre elles. Pour de plus amples informations, veuillez consulter <a href="./walkthrough-crossstackref.html">Procédure pas à pas : création de références à des sorties de ressources dans une autre pile AWS CloudFormation</a>.</p></li></ul></div>
                    </li><li class="listitem"><p>Réduisez la taille du fragment de modèle renvoyé par une macro donnée.  CloudFormation n'altère pas le contenu des fragments renvoyés par les macros.</p></li></ul></div></div></div>
         
        
        <div class="procedure"><h6>Pour utiliser une AWS CloudFormation macro dans votre modèle</h6><div class="awsdocs-note"><div class="awsdocs-note-title"><awsui-icon name="status-info" variant="link"></awsui-icon><h6>Note</h6></div><div class="awsdocs-note-text"><p> AWS CloudFormation Pour exécuter correctement une macro référencée dans un modèle, l'utilisateur doit disposer d'<code class="code">Invoke</code>autorisations pour la fonction Lambda sous-jacente. Pour plus d'informations, consultez la section <a href="https://docs.aws.amazon.com/lambda/latest/dg/access-control-overview.html">Présentation de la gestion des autorisations d'accès à vos ressources AWS Lambda</a> dans le Guide du <em>AWS Lambda développeur</em>.</p></div></div><ol><li>
                <p>Insérez une référence à la macro dans le modèle.</p>
                <div class="itemizedlist">
                     
                      
                <ul class="itemizedlist"><li class="listitem">
                        <p>Pour traiter un extrait de modèle, référencez la macro dans une fonction <code class="code"><a href="./intrinsic-function-reference-transform.html">Fn::Transform</a></code> située par rapport au contenu de modèle que vous souhaitez traiter.</p>
                    </li><li class="listitem">
                        <p>Pour traiter le modèle complet, référencez la macro dans la section <a href="./transform-section-structure.html">Transformation</a> du modèle.</p>
                    </li></ul></div>
            </li><li>
                <p><a href="./using-cfn-updating-stacks-changesets-create.html">Créez un jeu de modifications</a> à l'aide du modèle.</p>
                <div class="awsdocs-note awsdocs-important"><div class="awsdocs-note-title"><awsui-icon name="status-warning" variant="error"></awsui-icon><h6>Important</h6></div><div class="awsdocs-note-text"><p>Si votre modèle d'ensemble de piles référence une ou plusieurs macros, vous devez créer une pile directement à partir du modèle traité, sans examiner au préalable les modifications qui en résultent dans un jeu de modifications. Pour créer ou mettre à jour directement l'ensemble de piles, vous devez utiliser l'<a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/APIReference/API_UpdateStackSet.html"><code class="code">UpdateStackSet</code></a>action <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/APIReference/API_CreateStackSet.html"><code class="code">CreateStackSet</code></a>ou et spécifier la <code class="code">CAPABILITY_AUTO_EXPAND</code> fonctionnalité. Avant de créer ou de mettre à jour un ensemble de piles à partir d'un modèle qui référence directement les macros, assurez-vous de connaître les transformations effectuées par la macro.</p></div></div>
            </li><li>
                <p>Vérifiez et <a href="./using-cfn-updating-stacks-changesets-execute.html">exécutez le jeu de modifications</a>.</p>
                <div class="awsdocs-note awsdocs-important"><div class="awsdocs-note-title"><awsui-icon name="status-warning" variant="error"></awsui-icon><h6>Important</h6></div><div class="awsdocs-note-text"><p>Si votre modèle d'ensemble de piles référence une ou plusieurs macros, vous devez créer une pile directement à partir du modèle traité, sans examiner au préalable les modifications qui en résultent dans un jeu de modifications. Pour créer ou mettre à jour directement l'ensemble de piles, vous devez utiliser l'<a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/APIReference/API_UpdateStackSet.html"><code class="code">UpdateStackSet</code></a>action <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/APIReference/API_CreateStackSet.html"><code class="code">CreateStackSet</code></a>ou et spécifier la <code class="code">CAPABILITY_AUTO_EXPAND</code> fonctionnalité. Avant de créer ou de mettre à jour un ensemble de piles à partir d'un modèle qui référence directement les macros, assurez-vous de connaître les transformations effectuées par la macro.</p></div></div>
            </li></ol></div>

     
        <h2 id="template-macros-examples-list">Exemples de macros</h2>
        <p>Outre la <a href="./macros-example.html">Exemple de macro : Création et utilisation d'une macro</a> procédure pas à pas présentée dans ce guide, vous trouverez des exemples de macros, notamment du code source et des modèles, dans la section <a href="https://github.com/awslabs/aws-cloudformation-templates/tree/master/aws/services/CloudFormation/MacrosExamples/" rel="noopener noreferrer" target="_blank"><span>Exemples de macros</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a> du référentiel <a href="https://github.com/awslabs" rel="noopener noreferrer" target="_blank"><span>Amazon Web Services - Labs</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a> sur.  GitHub Ces exemples sont fournis « en l'état » à des fins éducatives.</p>
    <h2 id="template-macros-seealso">Consultez aussi</h2>
        <p><a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-resource-cloudformation-macro.html">AWS::CloudFormation::Macro</a></p>

        <p><a href="./transform-section-structure.html">Transformation</a></p>
        <p><a href="./intrinsic-function-reference-transform.html">Fn::Transform</a></p>
        
        <p><a href="./transform-aws-serverless.html">Transformation AWS::Serverless</a></p>
        <p><a href="./create-reusable-transform-function-snippets-and-add-to-your-template-with-aws-include-transform.html">Transformation AWS::Include</a></p>
    <awsdocs-copyright class="copyright-print"></awsdocs-copyright><awsdocs-thumb-feedback right-edge="{{$ctrl.thumbFeedbackRightEdge}}"></awsdocs-thumb-feedback></div><noscript><div><div><div><div id="js_error_message"><p><img src="https://d1ge0kk1l5kms0.cloudfront.net/images/G/01/webservices/console/warning.png" alt="Avertissement" /> <strong>JavaScript est désactivé ou n'est pas disponible dans votre navigateur.</strong></p><p>Pour que vous puissiez utiliser la documentation AWS, Javascript doit être activé. Vous trouverez des instructions sur les pages d'aide de votre navigateur.</p></div></div></div></div></noscript><div id="main-col-footer" class="awsui-util-font-size-0"><div id="doc-conventions"><a target="_top" href="/general/latest/gr/docconventions.html">Conventions de rédaction</a></div><div class="prev-next"><div id="previous" class="prev-link" accesskey="p" href="./crpg-ref-requesttypes-update.html">Mettre à jour</div><div id="next" class="next-link" accesskey="n" href="./macros-example.html">Exemple de macro : Création et utilisation d'une macro</div></div></div><awsdocs-page-utilities></awsdocs-page-utilities></div><div id="quick-feedback-yes" style="display: none;"><div class="title">Cette page vous a-t-elle été utile ? - Oui</div><div class="content"><p>Merci de nous avoir fait part de votre satisfaction.</p><p>Si vous avez quelques minutes à nous consacrer, merci de nous indiquer ce qui vous a plu afin que nous puissions nous améliorer davantage.</p><p><awsui-button id="fblink" rel="noopener noreferrer" target="_blank" text="Commentaire" click="linkClick($event)" href="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=CloudFormation&amp;topic_url=https://docs.aws.amazon.com/fr_fr/AWSCloudFormation/latest/UserGuide/template-macros.html"></awsui-button></p></div></div><div id="quick-feedback-no" style="display: none;"><div class="title">Cette page vous a-t-elle été utile ? - Non</div><div class="content"><p>Merci de nous avoir avertis que cette page avait besoin d'être retravaillée. Nous sommes désolés de ne pas avoir répondu à vos attentes.</p><p>Si vous avez quelques minutes à nous consacrer, merci de nous indiquer comment nous pourrions améliorer cette documentation.</p><p><awsui-button id="fblink" rel="noopener noreferrer" target="_blank" text="Commentaire" click="linkClick($event)" href="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=CloudFormation&amp;topic_url=https://docs.aws.amazon.com/fr_fr/AWSCloudFormation/latest/UserGuide/template-macros.html"></awsui-button></p></div></div></div></body></div></awsdocs-view><div class="page-loading-indicator" id="page-loading-indicator"><awsui-spinner size="large"></awsui-spinner></div></div><div id="tools-panel" dom-region="tools"><awsdocs-tools-panel id="awsdocs-tools-panel"></awsdocs-tools-panel></div></awsui-app-layout><awsdocs-cookie-banner class="doc-cookie-banner"></awsdocs-cookie-banner></div></body></html>