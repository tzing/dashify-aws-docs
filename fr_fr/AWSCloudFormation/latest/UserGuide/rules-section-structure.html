<!DOCTYPE html>
    <html xmlns="http://www.w3.org/1999/xhtml" lang="fr-FR"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Règles - AWS CloudFormation</title><meta name="viewport" content="width=device-width,initial-scale=1" /><meta name="assets_root" content="/assets" /><meta name="target_state" content="rules-section-structure" /><meta name="default_state" content="rules-section-structure" /><link rel="icon" type="image/ico" href="/assets/images/favicon.ico" /><link rel="shortcut icon" type="image/ico" href="/assets/images/favicon.ico" /><link rel="canonical" href="https://docs.aws.amazon.com/fr_fr/AWSCloudFormation/latest/UserGuide/rules-section-structure.html" /><meta name="description" content="Décrit les contraintes de paramètres pour les ressources dans la section Rules d'un modèle AWS CloudFormation ." /><meta name="deployment_region" content="IAD" /><meta name="product" content="AWS CloudFormation" /><meta name="guide" content="Guide de l'utilisateur" /><meta name="abstract" content="Créez et gérez des déploiements AWS d'infrastructure de manière prévisible et répétée à l'aide de ce AWS CloudFormation guide de l'utilisateur." /><meta name="guide-locale" content="fr_fr" /><meta name="tocs" content="toc-contents.json" /><link rel="canonical" href="https://docs.aws.amazon.com/fr_fr/AWSCloudFormation/latest/UserGuide/rules-section-structure.html" /><link rel="alternative" href="https://docs.aws.amazon.com/id_id/AWSCloudFormation/latest/UserGuide/rules-section-structure.html" hreflang="id-id" /><link rel="alternative" href="https://docs.aws.amazon.com/id_id/AWSCloudFormation/latest/UserGuide/rules-section-structure.html" hreflang="id" /><link rel="alternative" href="https://docs.aws.amazon.com/de_de/AWSCloudFormation/latest/UserGuide/rules-section-structure.html" hreflang="de-de" /><link rel="alternative" href="https://docs.aws.amazon.com/de_de/AWSCloudFormation/latest/UserGuide/rules-section-structure.html" hreflang="de" /><link rel="alternative" href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/rules-section-structure.html" hreflang="en-us" /><link rel="alternative" href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/rules-section-structure.html" hreflang="en" /><link rel="alternative" href="https://docs.aws.amazon.com/es_es/AWSCloudFormation/latest/UserGuide/rules-section-structure.html" hreflang="es-es" /><link rel="alternative" href="https://docs.aws.amazon.com/es_es/AWSCloudFormation/latest/UserGuide/rules-section-structure.html" hreflang="es" /><link rel="alternative" href="https://docs.aws.amazon.com/fr_fr/AWSCloudFormation/latest/UserGuide/rules-section-structure.html" hreflang="fr-fr" /><link rel="alternative" href="https://docs.aws.amazon.com/fr_fr/AWSCloudFormation/latest/UserGuide/rules-section-structure.html" hreflang="fr" /><link rel="alternative" href="https://docs.aws.amazon.com/it_it/AWSCloudFormation/latest/UserGuide/rules-section-structure.html" hreflang="it-it" /><link rel="alternative" href="https://docs.aws.amazon.com/it_it/AWSCloudFormation/latest/UserGuide/rules-section-structure.html" hreflang="it" /><link rel="alternative" href="https://docs.aws.amazon.com/ja_jp/AWSCloudFormation/latest/UserGuide/rules-section-structure.html" hreflang="ja-jp" /><link rel="alternative" href="https://docs.aws.amazon.com/ja_jp/AWSCloudFormation/latest/UserGuide/rules-section-structure.html" hreflang="ja" /><link rel="alternative" href="https://docs.aws.amazon.com/ko_kr/AWSCloudFormation/latest/UserGuide/rules-section-structure.html" hreflang="ko-kr" /><link rel="alternative" href="https://docs.aws.amazon.com/ko_kr/AWSCloudFormation/latest/UserGuide/rules-section-structure.html" hreflang="ko" /><link rel="alternative" href="https://docs.aws.amazon.com/pt_br/AWSCloudFormation/latest/UserGuide/rules-section-structure.html" hreflang="pt-br" /><link rel="alternative" href="https://docs.aws.amazon.com/pt_br/AWSCloudFormation/latest/UserGuide/rules-section-structure.html" hreflang="pt" /><link rel="alternative" href="https://docs.aws.amazon.com/zh_cn/AWSCloudFormation/latest/UserGuide/rules-section-structure.html" hreflang="zh-cn" /><link rel="alternative" href="https://docs.aws.amazon.com/zh_tw/AWSCloudFormation/latest/UserGuide/rules-section-structure.html" hreflang="zh-tw" /><link rel="alternative" href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/rules-section-structure.html" hreflang="x-default" /><meta name="feedback-item" content="CloudFormation" /><meta name="this_doc_product" content="AWS CloudFormation" /><meta name="this_doc_guide" content="Guide de l'utilisateur" /><script defer="" src="/assets/r/vendor4.js?version=2021.12.02"></script><script defer="" src="/assets/r/vendor3.js?version=2021.12.02"></script><script defer="" src="/assets/r/vendor1.js?version=2021.12.02"></script><script defer="" src="/assets/r/awsdocs-common.js?version=2021.12.02"></script><script defer="" src="/assets/r/awsdocs-doc-page.js?version=2021.12.02"></script><link href="/assets/r/vendor4.css?version=2021.12.02" rel="stylesheet" /><link href="/assets/r/awsdocs-common.css?version=2021.12.02" rel="stylesheet" /><link href="/assets/r/awsdocs-doc-page.css?version=2021.12.02" rel="stylesheet" /><script async="" id="awsc-panorama-bundle" type="text/javascript" src="https://prod.pa.cdn.uis.awsstatic.com/panorama-nav-init.js" data-config="{'appEntity':'aws-documentation','region':'us-east-1','service':'cloudformation'}"></script><meta id="panorama-serviceSubSection" value="Guide de l'utilisateur" /><meta id="panorama-serviceConsolePage" value="Règles" /></head><body class="awsdocs awsui"><div class="awsdocs-container"><awsdocs-header></awsdocs-header><awsui-app-layout id="app-layout" class="awsui-util-no-gutters" ng-controller="ContentController as $ctrl" header-selector="awsdocs-header" navigation-hide="false" navigation-width="$ctrl.navWidth" navigation-open="$ctrl.navOpen" navigation-change="$ctrl.onNavChange($event)" tools-hide="$ctrl.hideTools" tools-width="$ctrl.toolsWidth" tools-open="$ctrl.toolsOpen" tools-change="$ctrl.onToolsChange($event)"><div id="guide-toc" dom-region="navigation"><awsdocs-toc></awsdocs-toc></div><div id="main-column" dom-region="content" tabindex="-1"><awsdocs-view class="awsdocs-view"><div id="awsdocs-content"><head><title>Règles - AWS CloudFormation</title><meta name="rss" content="aws-cloudformation-release-notes.rss" /><meta name="forums" content="http://forums.aws.amazon.com/forum.jspa?forumID=92" /><meta name="feedback" content="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=CloudFormation&amp;topic_url=https://docs.aws.amazon.com/fr_fr/AWSCloudFormation/latest/UserGuide/rules-section-structure.html" /><meta name="feedback-yes" content="feedbackyes.html?topic_url=https://docs.aws.amazon.com/fr_fr/AWSCloudFormation/latest/UserGuide/rules-section-structure.html" /><meta name="feedback-no" content="feedbackno.html?topic_url=https://docs.aws.amazon.com/fr_fr/AWSCloudFormation/latest/UserGuide/rules-section-structure.html" /><meta name="keywords" content="CloudFormation,AWSCloudFormation,provisionnement des ressources,configuration des ressources,gestion de l'infrastructure,CloudFormer,CloudFormation pile,CloudFormation stackset,CloudFormation modèle,jeu de modifications" /><script type="application/ld+json">
{
    "@context" : "https://schema.org",
    "@type" : "BreadcrumbList",
    "itemListElement" : [
      {
        "@type" : "ListItem",
        "position" : 1,
        "name" : "AWS",
        "item" : "https://aws.amazon.com"
      },
      {
        "@type" : "ListItem",
        "position" : 2,
        "name" : "AWS CloudFormation",
        "item" : "https://docs.aws.amazon.com/cloudformation/index.html"
      },
      {
        "@type" : "ListItem",
        "position" : 3,
        "name" : "Guide de l'utilisateur",
        "item" : "https://docs.aws.amazon.com/fr_fr/AWSCloudFormation/latest/UserGuide"
      },
      {
        "@type" : "ListItem",
        "position" : 4,
        "name" : "Utilisation des modèles AWS CloudFormation",
        "item" : "https://docs.aws.amazon.com/fr_fr/AWSCloudFormation/latest/UserGuide/template-guide.html"
      },
      {
        "@type" : "ListItem",
        "position" : 5,
        "name" : "Anatomie du modèle",
        "item" : "https://docs.aws.amazon.com/fr_fr/AWSCloudFormation/latest/UserGuide/template-anatomy.html"
      },
      {
        "@type" : "ListItem",
        "position" : 6,
        "name" : "Règles",
        "item" : "https://docs.aws.amazon.com/fr_fr/AWSCloudFormation/latest/UserGuide/template-anatomy.html"
      }
    ]
}
</script></head><body><div id="main"><div style="display: none"></div><div id="breadcrumbs" class="breadcrumb"><a href="https://aws.amazon.com">AWS</a><a href="/index.html">Documentation</a><a href="/cloudformation/index.html">AWS CloudFormation</a><a href="Welcome.html">Guide de l'utilisateur</a></div><div id="page-toc-src"><a href="#rules-specific-intrinsic-working-with-rules">Utilisation des règles</a><a href="#rules-specific-intrinsic-section-structure">Fonctions intrinsèques spécifiques aux règles</a><a href="#template-constraint-rules-syntax">Syntaxe</a><a href="#template-constraint-rules-example">Exemples</a><a href="#template-cross-parameter-rules-example">Validation entre paramètres</a></div><div id="page-filters" style="display:none"><filter label="All" id="All"></filter><filter label="JSON" id="JSON"></filter><filter label="YAML" id="YAML"></filter><filter label="Exemple JSON" id="Exemple JSON"></filter><filter label="Exemple YAML" id="Exemple YAML"></filter></div><div id="main-content" class="awsui-util-container"><div id="main-col-body"><awsdocs-language-banner data-service="$ctrl.pageService"></awsdocs-language-banner><awsui-alert class="awsdocs-page-banner awsui-util-mb-l"><p>Les traductions sont fournies par des outils de traduction automatique. En cas de conflit entre le contenu d'une traduction et celui de la version originale en anglais, la version anglaise prévaudra.</p></awsui-alert><h1 class="topictitle" id="rules-section-structure">Règles</h1><div class="awsdocs-page-header-container"><awsdocs-page-header></awsdocs-page-header><awsdocs-filter-selector id="awsdocs-filter-selector"></awsdocs-filter-selector></div><p>La section facultative <code class="code">Rules</code> valide un paramètre ou une combinaison de paramètres transmis à un modèle lors d'une création ou d’une mise à jour de pile. Pour utiliser des règles de modèle, déclarez explicitement <code class="code">Rules</code> dans votre modèle suivi d'une assertion. Utilisez la section Règles pour valider les valeurs des paramètres avant de créer ou de mettre à jour des ressources.</p>
        <h2 id="rules-specific-intrinsic-working-with-rules">Utilisation des règles</h2>
        <p>Chaque règle de modèle se compose de deux propriétés :</p>
        <div class="itemizedlist">
             
             
        <ul class="itemizedlist"><li class="listitem">
                <p>La <em>condition de règle</em> (facultative) : détermine quand une règle prend effet.</p>
            </li><li class="listitem">
                <p>Les <em>assertions</em> (requises) : décrivent les valeurs que les utilisateurs peuvent spécifier pour un paramètre particulier.</p>
            </li></ul></div>
        <p>Une règle peut inclure une propriété <code class="code">RuleCondition</code> et doit inclure une propriété <code class="code">Assertions</code>. Pour chaque règle, vous ne pouvez définir qu'une seule condition de règle. Vous pouvez définir une ou plusieurs assertions dans la propriété <code class="code">Assertions</code>. Si vous ne définissez pas de condition de règle, les assertions de la règle prennent toujours effet.</p>
     
            <h2 id="rules-specific-intrinsic-section-structure">Fonctions intrinsèques spécifiques aux règles</h2>
        <p>Pour définir une condition de règle et des assertions, vous utilisez des <em>fonctions intrinsèques spécifiques aux règles</em> qui sont des fonctions qui peuvent uniquement être utilisées dans la section <code class="code">Rules</code> d'un modèle. Vous pouvez imbriquer des fonctions, mais le résultat final d'une condition de règle ou d'une assertion doit avoir la valeur true (vrai) ou false (faux).</p>
        <p>Vous pouvez utiliser les fonctions intrinsèques spécifiques aux règles suivantes pour définir des conditions de règle et des assertions :</p>
        <div class="itemizedlist">
             
             
             
             
             
             
             
             
             
             
             
        <ul class="itemizedlist"><li class="listitem">
                <p><code class="code"><a href="./intrinsic-function-reference-conditions.html#intrinsic-function-reference-conditions-and">Fn::And</a></code></p>
            </li><li class="listitem">
                <p><code class="code"><a href="./intrinsic-function-reference-rules.html#fn-contains">Fn::Contains</a></code></p>
            </li><li class="listitem">
                <p><code class="code"><a href="./intrinsic-function-reference-rules.html#fn-eachmemberequals">Fn::EachMemberEquals</a></code></p>
            </li><li class="listitem">
                <p><code class="code"><a href="./intrinsic-function-reference-rules.html#fn-eachmemberin">Fn::EachMemberIn</a></code></p>
            </li><li class="listitem">
                <p><code class="code"><a href="./intrinsic-function-reference-conditions.html#intrinsic-function-reference-conditions-equals">Fn::Equals</a></code></p>
            </li><li class="listitem">
                <p><code class="code"><a href="./intrinsic-function-reference-conditions.html#intrinsic-function-reference-conditions-if">Fn::If</a></code></p>
            </li><li class="listitem">
                <p><code class="code"><a href="./intrinsic-function-reference-conditions.html#intrinsic-function-reference-conditions-not">Fn::Not</a></code></p>
            </li><li class="listitem">
                <p><code class="code"><a href="./intrinsic-function-reference-conditions.html#intrinsic-function-reference-conditions-or">Fn::Or</a></code></p>
            </li><li class="listitem">
                <p><code class="code"><a href="./intrinsic-function-reference-rules.html#fn-refall">Fn::RefAll</a></code></p>
            </li><li class="listitem">
                <p><code class="code"><a href="./intrinsic-function-reference-rules.html#fn-valueof">Fn::ValueOf</a></code></p>
            </li><li class="listitem">
                <p><code class="code"><a href="./intrinsic-function-reference-rules.html#fn-valueofall">Fn::ValueOfAll</a></code></p>
            </li></ul></div>
        <p>Les fonctions intrinsèques spécifiques à une règle sont utilisées dans la condition ou les assertions d'une règle. La propriété condition détermine si les AWS CloudFormation assertions sont appliquées. Si la condition est évaluée à<code class="code">true</code>, AWS CloudFormation évalue les assertions pour vérifier si une valeur de paramètre est valide lors de la création ou de la mise à jour d'un produit approvisionné. Si la valeur d'un paramètre n'est pas valide, AWS CloudFormation ne crée ni ne met à jour la pile. Si la condition est évaluée à<code class="code">false</code>, AWS CloudFormation elle ne vérifie pas la valeur du paramètre et poursuit l'opération de pile.</p>
     
        <h2 id="template-constraint-rules-syntax">Syntaxe</h2>
        <div id="JSON" name="JSON" class="section langfilter">
            <h3 id="rules-section-structure-syntax.json">JSON</h3>
            <p>La section <code class="code">Rules</code> d'un modèle se compose du nom de clé <code class="code">Rules</code>, suivi d'un seul signe deux points. Vous devez utiliser des accolades pour inclure toutes les déclarations de règle. Si vous déclarez plusieurs règles, celles-ci sont séparées par des virgules. Pour chaque règle, vous déclarez un nom logique entre guillemets, suivi d'un signe deux points et d'accolades qui entourent la condition de règle et les assertions.</p>
            <pre class="programlisting"><div class="code-btn-container"></div><code class="json "><span>{</span>
    "Rules": <span>{</span>
        "Rule01": <span>{</span>
            "RuleCondition": <span>{</span>
                "rule-specific intrinsic function": "Value01"
            },
            "Assertions": [
                <span>{</span>
                    "Assert": <span>{</span>
                        "rule-specific intrinsic function": "Value02"
                    },
                    "AssertDescription": "Information about this assert"
                },
                <span>{</span>
                    "Assert": <span>{</span>
                        "rule-specific intrinsic function": "Value03"
                    },
                    "AssertDescription": "Information about this assert"
                }
            ]
        },
        "Rule02": <span>{</span>
            "Assertions": [
                <span>{</span>
                    "Assert": <span>{</span>
                        "rule-specific intrinsic function": "Value04"
                    },
                    "AssertDescription": "Information about this assert"
                }
            ]
        }
    }
}</code></pre>
        </div>
        <div id="YAML" name="YAML" class="section langfilter">
            <h3 id="rules-section-structure-syntax.yaml">YAML</h3>
            <pre class="programlisting"><div class="code-btn-container"></div><code class="yaml ">Rules:
  Rule01:
    RuleCondition:
      rule-specific intrinsic function: Value01
    Assertions:
      - Assert:
          rule-specific intrinsic function: Value02
        AssertDescription: Information about this assert
      - Assert:
          rule-specific intrinsic function: Value03
        AssertDescription: Information about this assert
  Rule02:
    Assertions:
      - Assert:
          rule-specific intrinsic function: Value04
        AssertDescription: Information about this assert</code></pre>
        </div>



     
        <h2 id="template-constraint-rules-example">Exemples</h2>
         
            <h3 id="template-constraint-rules-example-verify">Vérifier conditionnellement une valeur de paramètre</h3>

            <p>Dans l'exemple suivant, les deux règles vérifient la valeur du paramètre <code class="code">InstanceType</code>. En fonction de la valeur du paramètre d'environnement (<code class="code">test</code> ou <code class="code">prod</code>), l'utilisateur doit spécifier <code class="code">a1.medium</code> ou <code class="code">a1.large</code> pour le paramètre <code class="code">InstanceType</code>. Les paramètres <code class="code">InstanceType</code> et <code class="code">Environment</code> doivent être déclarés dans la section <code class="code">Parameters</code> du même modèle.</p>
            <div id="Exemple JSON" name="Exemple JSON" class="section langfilter">
                <h4 id="rules-section-example-conditionally-verify.json">Exemple JSON</h4>
                <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Texte"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
    "Rules": <span>{</span>
        "testInstanceType": <span>{</span>
            "RuleCondition": <span>{</span>
                "Fn::Equals": [
                    <span>{</span>
                        "Ref": "Environment"
                    },
                    "test"
                ]
            },
            "Assertions": [
                <span>{</span>
                    "Assert": <span>{</span>
                        "Fn::Contains": [
                            [
                                "a1.medium"
                            ],
                            <span>{</span>
                                "Ref": "InstanceType"
                            }
                        ]
                    },
                    "AssertDescription": "For a test environment, the instance type must be a1.medium"
                }
            ]
        },
        "prodInstanceType": <span>{</span>
            "RuleCondition": <span>{</span>
                "Fn::Equals": [
                    <span>{</span>
                        "Ref": "Environment"
                    },
                    "prod"
                ]
            },
            "Assertions": [
                <span>{</span>
                    "Assert": <span>{</span>
                        "Fn::Contains": [
                            [
                                "a1.large"
                            ],
                            <span>{</span>
                                "Ref": "InstanceType"
                            }
                        ]
                    },
                    "AssertDescription": "For a production environment, the instance type must be a1.large"
                }
            ]
        }
    }
}</code></pre>
            </div>
            <div id="Exemple YAML" name="Exemple YAML" class="section langfilter">
                <h4 id="rules-section-example-conditionally-verify-2.yaml">Exemple YAML</h4>
                <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Texte"><awsui-icon name="copy"></awsui-icon></div></div><code class="yaml ">Rules:
  testInstanceType:
    RuleCondition: !Equals 
      - !Ref Environment
      - test
    Assertions:
      - Assert:
          'Fn::Contains':
            - - a1.medium
            - !Ref InstanceType
        AssertDescription: 'For a test environment, the instance type must be a1.medium'
  prodInstanceType:
    RuleCondition: !Equals 
      - !Ref Environment
      - prod
    Assertions:
      - Assert:
          'Fn::Contains':
            - - a1.large
            - !Ref InstanceType
        AssertDescription: 'For a production environment, the instance type must be a1.large'</code></pre>
            </div>
         
     
        <h2 id="template-cross-parameter-rules-example">Validation entre paramètres</h2>
        <p>L'exemple de modèle suivant crée un exemple de site web qui utilise Amazon EC2 Auto Scaling et Elastic Load Balancing et qui est configuré pour utiliser plusieurs zones de disponibilité. Le modèle contient également des  CloudWatch  alarmes qui exécutent des politiques de dimensionnement pour ajouter ou supprimer des instances du groupe Auto Scaling lorsque les seuils définis sont dépassés. Ce modèle crée au moins une instance Amazon EC2.</p>
        <div class="awsdocs-note"><div class="awsdocs-note-title"><awsui-icon name="status-info" variant="link"></awsui-icon><h6>Note</h6></div><div class="awsdocs-note-text"><p>Les AWS ressources utilisées vous seront facturées si vous créez une pile à partir de ce modèle.</p></div></div>

        <div id="Exemple JSON" name="Exemple JSON" class="section langfilter">
            <h3 id="rules-section-example-cross-parameter-validation.json">Exemple JSON</h3>
            <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Texte"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
    "AWSTemplateFormatVersion": "2010-09-09",
    "Description": "AWS CloudFormation Sample Template for using Assertions: Create a load balanced, Auto Scaled sample website where the instances are locked down to only accept traffic from the load balancer. This example creates an Auto Scaling group behind a load balancer with a health check. The web site is available on port 80 or 443 based on the input.",
    "Parameters": <span>{</span>
        "VpcId": <span>{</span>
            "Type": "AWS::EC2::VPC::Id",
            "Description": "VpcId of your existing Virtual Private Cloud (VPC)",
            "ConstraintDescription": "must be the VPC Id of an existing Virtual Private Cloud."
        },
        "Subnets": <span>{</span>
            "Type": "List&lt;AWS::EC2::Subnet::Id&gt;",
            "Description": "The list of SubnetIds in your Virtual Private Cloud (VPC)",
            "ConstraintDescription": "must be a list of at least two existing subnets associated with at least two different availability zones. They should be residing in the selected Virtual Private Cloud."
        },
        "InstanceType": <span>{</span>
            "Description": "WebServer EC2 instance type",
            "Type": "String",
            "Default": "t2.small",
            "AllowedValues": [
                "t2.nano",
                "t2.micro",
                "t2.small",
                "t2.medium",
                "t2.large",
                "m4.large",
                "m4.xlarge",
                "m4.2xlarge",
                "m4.4xlarge",
                "m4.10xlarge",
                "m3.medium",
                "m3.large",
                "m3.xlarge",
                "m3.2xlarge",
                "c4.large",
                "c4.xlarge",
                "c4.2xlarge",
                "c4.4xlarge",
                "c4.8xlarge",
                "c3.large",
                "c3.xlarge",
                "c3.2xlarge",
                "c3.4xlarge",
                "c3.8xlarge",
                "r3.large",
                "r3.xlarge"
            ],
            "ConstraintDescription": "must be a valid EC2 instance type."
        },
        "KeyName": <span>{</span>
            "Description": "Name of an existing EC2 KeyPair to enable SSH access to the instances",
            "Type": "AWS::EC2::KeyPair::KeyName",
            "ConstraintDescription": "must be the name of an existing EC2 KeyPair."
        },
        "SSHLocation": <span>{</span>
            "Description": "The IP address range that can be used to SSH to the EC2 instances",
            "Type": "String",
            "MinLength": "9",
            "MaxLength": "18",
            "Default": "0.0.0.0/0",
            "AllowedPattern": "(\\d<span>{</span>1,3})\\.(\\d<span>{</span>1,3})\\.(\\d<span>{</span>1,3})\\.(\\d<span>{</span>1,3})/(\\d<span>{</span>1,2})",
            "ConstraintDescription": "must be a valid IP CIDR range of the form x.x.x.x/x."
        },
        "UseSSL": <span>{</span>
            "AllowedValues": [
                "Yes",
                "No"
            ],
            "ConstraintDescription": "Select Yes to create a HTTPS Listener",
            "Default": "No",
            "Description": "Select \"Yes\" to implement SSL, \"No\" to skip (default).",
            "Type": "String"
        },
        "ALBSSLCertificateARN": <span>{</span>
            "Default": "",
            "Description": "[Optional] The ARN of the SSL certificate to be used for the Application Load Balancer",
            "Type": "String"
        },
        "HostedZoneName": <span>{</span>
            "AllowedPattern": "^$|(([a-zA-Z0-9]|[a-zA-Z0-9][a-zA-Z0-9\\-]*[a-zA-Z0-9])\\.)*([A-Za-z0-9]|[A-Za-z0-9][A-Za-z0-9\\-]*[A-Za-z0-9])$",
            "Default": "",
            "Description": "[Optional] The domain name of a valid Hosted Zone on AWS.",
            "Type": "String"
        }
    },
    "Conditions": <span>{</span>
        "UseALBSSL": <span>{</span>
            "Fn::Not": [
                <span>{</span>
                    "Fn::Equals": [
                        <span>{</span>
                            "Ref": "UseSSL"
                        },
                        "Yes"
                    ]
                }
            ]
        }
    },
    "Rules": <span>{</span>
        "SubnetsInVPC": <span>{</span>
            "Assertions": [
                <span>{</span>
                    "Assert": <span>{</span>
                        ""Fn::EachMemberEquals": [
                            <span>{</span>
                                "Fn::ValueOf": [
                                    "Subnets",
                                    "VpcId"
                                ]
                            },
                            <span>{</span>
                                "Ref": "VpcId"
                            }
                        ]
                    },
                    "AssertDescription": "All subnets must in the VPC"
                }
            ]
        },
        "ValidateHostedZone": <span>{</span>
            "RuleCondition": <span>{</span>
                "Fn::Equals": [
                    <span>{</span>
                        "Ref": "UseSSL"
                    },
                    "Yes"
                ]
            },
            "Assertions": [
                <span>{</span>
                    "Assert": <span>{</span>
                        "Fn::Not": [
                            <span>{</span>
                                "Fn::Equals": [
                                    <span>{</span>
                                        "Ref": "ALBSSLCertificateARN"
                                    },
                                    ""
                                ]
                            }
                        ]
                    },
                    "AssertDescription": "ACM Certificate value cannot be empty if SSL is required"
                },
                <span>{</span>
                    "Assert": <span>{</span>
                        "Fn::Not": [
                            <span>{</span>
                                "Fn::Equals": [
                                    <span>{</span>
                                        "Ref": "HostedZoneName"
                                    },
                                    ""
                                ]
                            }
                        ]
                    },
                    "AssertDescription": "Route53 Hosted Zone Name is mandatory when SSL is required"
                }
            ]
        }
    },
    "Mappings": <span>{</span>
        "AWSAMIRegionMap": <span>{</span>
            "AMI": <span>{</span>
                "AMZNLINUXHVM": "amzn-ami-hvm-2017.09.1.20171120-x86_64-gp2"
            },
            "ap-northeast-1": <span>{</span>
                "AMZNLINUXHVM": "ami-da9e2cbc"
            },
            "ap-northeast-2": <span>{</span>
                "AMZNLINUXHVM": "ami-1196317f"
            },
            "ap-south-1": <span>{</span>
                "AMZNLINUXHVM": "ami-d5c18eba"
            },
            "ap-southeast-1": <span>{</span>
                "AMZNLINUXHVM": "ami-c63d6aa5"
            },
            "ap-southeast-2": <span>{</span>
                "AMZNLINUXHVM": "ami-ff4ea59d"
            },
            "ca-central-1": <span>{</span>
                "AMZNLINUXHVM": "ami-d29e25b6"
            },
            "eu-central-1": <span>{</span>
                "AMZNLINUXHVM": "ami-bf2ba8d0"
            },
            "eu-west-1": <span>{</span>
                "AMZNLINUXHVM": "ami-1a962263"
            },
            "eu-west-2": <span>{</span>
                "AMZNLINUXHVM": "ami-e7d6c983"
            },
            "sa-east-1": <span>{</span>
                "AMZNLINUXHVM": "ami-286f2a44"
            },
            "us-east-1": <span>{</span>
                "AMZNLINUXHVM": "ami-55ef662f"
            },
            "us-east-2": <span>{</span>
                "AMZNLINUXHVM": "ami-15e9c770"
            },
            "us-west-1": <span>{</span>
                "AMZNLINUXHVM": "ami-a51f27c5"
            },
            "us-west-2": <span>{</span>
                "AMZNLINUXHVM": "ami-bf4193c7"
            }
        }
    },
    "Resources": <span>{</span>
        "WebServerGroup": <span>{</span>
            "Type": "AWS::AutoScaling::AutoScalingGroup",
            "Properties": <span>{</span>
                "VPCZoneIdentifier": <span>{</span>
                    "Ref": "Subnets"
                },
                "LaunchConfigurationName": <span>{</span>
                    "Ref": "LaunchConfig"
                },
                "MinSize": "2",
                "MaxSize": "2",
                "TargetGroupARNs": [
                    <span>{</span>
                        "Ref": "ALBTargetGroup"
                    }
                ]
            },
            "CreationPolicy": <span>{</span>
                "ResourceSignal": <span>{</span>
                    "Timeout": "PT15M"
                }
            },
            "UpdatePolicy": <span>{</span>
                "AutoScalingRollingUpdate": <span>{</span>
                    "MinInstancesInService": "1",
                    "MaxBatchSize": "1",
                    "PauseTime": "PT15M",
                    "WaitOnResourceSignals": "true"
                }
            }
        },
        "LaunchConfig": <span>{</span>
            "Type": "AWS::AutoScaling::LaunchConfiguration",
            "Metadata": <span>{</span>
                "Comment": "Install a simple application",
                "AWS::CloudFormation::Init": <span>{</span>
                    "config": <span>{</span>
                        "packages": <span>{</span>
                            "yum": <span>{</span>
                                "httpd": []
                            }
                        },
                        "files": <span>{</span>
                            "/var/www/html/index.html": <span>{</span>
                                "content": <span>{</span>
                                    "Fn::Join": [
                                        "\n",
                                        [
                                            "&lt;h1&gt;Congratulations, you have successfully launched the AWS CloudFormation sample.&lt;h1&gt;"
                                        ]
                                    ]
                                },
                                "mode": "000644",
                                "owner": "root",
                                "group": "root"
                            },
                            "/etc/cfn/cfn-hup.conf": <span>{</span>
                                "content": <span>{</span>
                                    "Fn::Join": [
                                        "",
                                        [
                                            "[main]\n",
                                            "stack=",
                                            <span>{</span>
                                                "Ref": "AWS::StackId"
                                            },
                                            "\n",
                                            "region=",
                                            <span>{</span>
                                                "Ref": "AWS::Region"
                                            },
                                            "\n"
                                        ]
                                    ]
                                },
                                "mode": "000400",
                                "owner": "root",
                                "group": "root"
                            },
                            "/etc/cfn/hooks.d/cfn-auto-reloader.conf": <span>{</span>
                                "content": <span>{</span>
                                    "Fn::Join": [
                                        "",
                                        [
                                            "[cfn-auto-reloader-hook]\n",
                                            "triggers=post.update\n",
                                            "path=Resources.LaunchConfig.Metadata.AWS::CloudFormation::Init\n",
                                            "action=/opt/aws/bin/cfn-init -v ",
                                            "         --stack ",
                                            <span>{</span>
                                                "Ref": "AWS::StackName"
                                            },
                                            "         --resource LaunchConfig ",
                                            "         --region ",
                                            <span>{</span>
                                                "Ref": "AWS::Region"
                                            },
                                            "\n",
                                            "runas=root\n"
                                        ]
                                    ]
                                },
                                "mode": "000400",
                                "owner": "root",
                                "group": "root"
                            }
                        },
                        "services": <span>{</span>
                            "sysvinit": <span>{</span>
                                "httpd": <span>{</span>
                                    "enabled": "true",
                                    "ensureRunning": "true"
                                },
                                "cfn-hup": <span>{</span>
                                    "enabled": "true",
                                    "ensureRunning": "true",
                                    "files": [
                                        "/etc/cfn/cfn-hup.conf",
                                        "/etc/cfn/hooks.d/cfn-auto-reloader.conf"
                                    ]
                                }
                            }
                        }
                    }
                }
            },
            "Properties": <span>{</span>
                "ImageId": <span>{</span>
                    "Fn::FindInMap": [
                        "AWSAMIRegionMap",
                        <span>{</span>
                            "Ref": "AWS::Region"
                        },
                        "AMZNLINUXHVM"
                    ]
                },
                "SecurityGroups": [
                    <span>{</span>
                        "Ref": "InstanceSecurityGroup"
                    }
                ],
                "InstanceType": <span>{</span>
                    "Ref": "InstanceType"
                },
                "KeyName": <span>{</span>
                    "Ref": "KeyName"
                },
                "UserData": <span>{</span>
                    "Fn::Base64": <span>{</span>
                        "Fn::Join": [
                            "",
                            [
                                "#!/bin/bash -xe\n",
                                "yum update -y aws-cfn-bootstrap\n",
                                "/opt/aws/bin/cfn-init -v ",
                                "         --stack ",
                                <span>{</span>
                                    "Ref": "AWS::StackName"
                                },
                                "         --resource LaunchConfig ",
                                "         --region ",
                                <span>{</span>
                                    "Ref": "AWS::Region"
                                },
                                "\n",
                                "/opt/aws/bin/cfn-signal -e $? ",
                                "         --stack ",
                                <span>{</span>
                                    "Ref": "AWS::StackName"
                                },
                                "         --resource WebServerGroup ",
                                "         --region ",
                                <span>{</span>
                                    "Ref": "AWS::Region"
                                },
                                "\n"
                            ]
                        ]
                    }
                }
            }
        },
        "ELBSecurityGroup": <span>{</span>
            "Type": "AWS::EC2::SecurityGroup",
            "Properties": <span>{</span>
                "GroupDescription": "Allow access to the ELB",
                "VpcId": <span>{</span>
                    "Ref": "VpcId"
                },
                "SecurityGroupIngress": [
                    <span>{</span>
                        "Fn::If": [
                            "UseALBSSL",
                            <span>{</span>
                                "IpProtocol": "tcp",
                                "FromPort": 443,
                                "ToPort": 443,
                                "CidrIp": "0.0.0.0/0"
                            },
                            <span>{</span>
                                "IpProtocol": "tcp",
                                "FromPort": 80,
                                "ToPort": 80,
                                "CidrIp": "0.0.0.0/0"
                            }
                        ]
                    }
                ]
            }
        },
        "ApplicationLoadBalancer": <span>{</span>
            "Type": "AWS::ElasticLoadBalancingV2::LoadBalancer",
            "Properties": <span>{</span>
                "Subnets": <span>{</span>
                    "Ref": "Subnets"
                },
                "SecurityGroups": [
                    <span>{</span>
                        "Ref": "ELBSecurityGroup"
                    }
                ]
            }
        },
        "ALBListener": <span>{</span>
            "Type": "AWS::ElasticLoadBalancingV2::Listener",
            "Properties": <span>{</span>
                "DefaultActions": [
                    <span>{</span>
                        "Type": "forward",
                        "TargetGroupArn": <span>{</span>
                            "Ref": "ALBTargetGroup"
                        }
                    }
                ],
                "LoadBalancerArn": <span>{</span>
                    "Ref": "ApplicationLoadBalancer"
                },
                "Port": <span>{</span>
                    "Fn::If": [
                        "UseALBSSL",
                        443,
                        80
                    ]
                },
                "Protocol": <span>{</span>
                    "Fn::If": [
                        "UseALBSSL",
                        "HTTPS",
                        "HTTP"
                    ]
                },
                "Certificates": [
                    <span>{</span>
                        "Fn::If": [
                            "UseALBSSL",
                            <span>{</span>
                                "CertificateArn": <span>{</span>
                                    "Ref": "ALBSSLCertificateARN"
                                }
                            },
                            <span>{</span>
                                "Ref": "AWS::NoValue"
                            }
                        ]
                    }
                ]
            }
        },
        "ALBTargetGroup": <span>{</span>
            "Type": "AWS::ElasticLoadBalancingV2::TargetGroup",
            "Properties": <span>{</span>
                "HealthCheckIntervalSeconds": 30,
                "HealthCheckTimeoutSeconds": 5,
                "HealthyThresholdCount": 3,
                "Port": 80,
                "Protocol": "HTTP",
                "UnhealthyThresholdCount": 5,
                "VpcId": <span>{</span>
                    "Ref": "VpcId"
                }
            }
        },
        "InstanceSecurityGroup": <span>{</span>
            "Type": "AWS::EC2::SecurityGroup",
            "Properties": <span>{</span>
                "GroupDescription": "Enable SSH access and HTTP access on the inbound port",
                "SecurityGroupIngress": [
                    <span>{</span>
                        "IpProtocol": "tcp",
                        "FromPort": 80,
                        "ToPort": 80,
                        "SourceSecurityGroupId": <span>{</span>
                            "Fn::Select": [
                                0,
                                <span>{</span>
                                    "Fn::GetAtt": [
                                        "ApplicationLoadBalancer",
                                        "SecurityGroups"
                                    ]
                                }
                            ]
                        }
                    },
                    <span>{</span>
                        "IpProtocol": "tcp",
                        "FromPort": 22,
                        "ToPort": 22,
                        "CidrIp": <span>{</span>
                            "Ref": "SSHLocation"
                        }
                    }
                ],
                "VpcId": <span>{</span>
                    "Ref": "VpcId"
                }
            }
        },
        "RecordSet": <span>{</span>
            "Type": "AWS::Route53::RecordSetGroup",
            "Condition": "UseALBSSL",
            "Properties": <span>{</span>
                "HostedZoneName": <span>{</span>
                    "Fn::Join": [
                        "",
                        [
                            <span>{</span>
                                "Ref": "HostedZoneName"
                            },
                            "."
                        ]
                    ]
                },
                "RecordSets": [
                    <span>{</span>
                        "Name": <span>{</span>
                            "Fn::Join": [
                                "",
                                [
                                    <span>{</span>
                                        "Fn::Select": [
                                            "0",
                                            <span>{</span>
                                                "Fn::Split": [
                                                    ".",
                                                    <span>{</span>
                                                        "Fn::GetAtt": [
                                                            "ApplicationLoadBalancer",
                                                            "DNSName"
                                                        ]
                                                    }
                                                ]
                                            }
                                        ]
                                    },
                                    ".",
                                    <span>{</span>
                                        "Ref": "HostedZoneName"
                                    },
                                    "."
                                ]
                            ]
                        },
                        "Type": "A",
                        "AliasTarget": <span>{</span>
                            "DNSName": <span>{</span>
                                "Fn::GetAtt": [
                                    "ApplicationLoadBalancer",
                                    "DNSName"
                                ]
                            },
                            "EvaluateTargetHealth": true,
                            "HostedZoneId": <span>{</span>
                                "Fn::GetAtt": [
                                    "ApplicationLoadBalancer",
                                    "CanonicalHostedZoneID"
                                ]
                            }
                        }
                    }
                ]
            }
        }
    },
    "Outputs": <span>{</span>
        "URL": <span>{</span>
            "Description": "URL of the website",
            "Value": <span>{</span>
                "Fn::Join": [
                    "",
                    [
                        <span>{</span>
                            "Fn::If": [
                                "UseALBSSL",
                                <span>{</span>
                                    "Fn::Join": [
                                        "",
                                        [
                                            "https://",
                                            <span>{</span>
                                                "Fn::Join": [
                                                    "",
                                                    [
                                                        <span>{</span>
                                                            "Fn::Select": [
                                                                "0",
                                                                <span>{</span>
                                                                    "Fn::Split": [
                                                                        ".",
                                                                        <span>{</span>
                                                                            "Fn::GetAtt": [
                                                                                "ApplicationLoadBalancer",
                                                                                "DNSName"
                                                                            ]
                                                                        }
                                                                    ]
                                                                }
                                                            ]
                                                        },
                                                        ".",
                                                        <span>{</span>
                                                            "Ref": "HostedZoneName"
                                                        },
                                                        "."
                                                    ]
                                                ]
                                            }
                                        ]
                                    ]
                                },
                                <span>{</span>
                                    "Fn::Join": [
                                        "",
                                        [
                                            "http://",
                                            <span>{</span>
                                                "Fn::GetAtt": [
                                                    "ApplicationLoadBalancer",
                                                    "DNSName"
                                                ]
                                            }
                                        ]
                                    ]
                                }
                            ]
                        }
                    ]
                ]
            }
        }
    }
}</code></pre>
        </div>
        <div id="Exemple YAML" name="Exemple YAML" class="section langfilter">
            <h3 id="rules-section-example-syntax.yaml">Exemple YAML</h3>
            <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Texte"><awsui-icon name="copy"></awsui-icon></div></div><code class="yaml ">AWSTemplateFormatVersion: 2010-09-09
Description: &gt;-
  AWS CloudFormation Sample Template for using Assertions: Create a load balanced,
  Auto Scaled sample website where the instances are locked down to only accept
  traffic from the load balancer. This example creates an Auto Scaling group
  behind a load balancer with a health check. The web site is available on port
  80 or 443 based on the input.
Parameters:
  VpcId:
    Type: 'AWS::EC2::VPC::Id'
    Description: VpcId of your existing Virtual Private Cloud (VPC)
    ConstraintDescription: must be the VPC Id of an existing Virtual Private Cloud.
  Subnets:
    Type: 'List&lt;AWS::EC2::Subnet::Id&gt;'
    Description: The list of SubnetIds in your Virtual Private Cloud (VPC)
    ConstraintDescription: &gt;-
      must be a list of at least two existing subnets associated with at least
      two different availability zones. They should be residing in the selected
      Virtual Private Cloud.
  InstanceType:
    Description: WebServer EC2 instance type
    Type: String
    Default: t2.small
    AllowedValues:
      - t2.nano
      - t2.micro
      - t2.small
      - t2.medium
      - t2.large
      - m4.large
      - m4.xlarge
      - m4.2xlarge
      - m4.4xlarge
      - m4.10xlarge
      - m3.medium
      - m3.large
      - m3.xlarge
      - m3.2xlarge
      - c4.large
      - c4.xlarge
      - c4.2xlarge
      - c4.4xlarge
      - c4.8xlarge
      - c3.large
      - c3.xlarge
      - c3.2xlarge
      - c3.4xlarge
      - c3.8xlarge
      - r3.large
      - r3.xlarge
    ConstraintDescription: must be a valid EC2 instance type.
  KeyName:
    Description: Name of an existing EC2 KeyPair to enable SSH access to the instances
    Type: 'AWS::EC2::KeyPair::KeyName'
    ConstraintDescription: must be the name of an existing EC2 KeyPair.
  SSHLocation:
    Description: The IP address range that can be used to SSH to the EC2 instances
    Type: String
    MinLength: '9'
    MaxLength: '18'
    Default: 0.0.0.0/0
    AllowedPattern: '(\d<span>{</span>1,3})\.(\d<span>{</span>1,3})\.(\d<span>{</span>1,3})\.(\d<span>{</span>1,3})/(\d<span>{</span>1,2})'
    ConstraintDescription: must be a valid IP CIDR range of the form x.x.x.x/x.
  UseSSL:
    AllowedValues:
      - 'Yes'
      - 'No'
    ConstraintDescription: Select Yes to create a HTTPS Listener
    Default: 'No'
    Description: 'Select "Yes" to implement SSL, "No" to skip (default).'
    Type: String
  ALBSSLCertificateARN:
    Default: ''
    Description: &gt;-
      [Optional] The ARN of the SSL certificate to be used for the Application
      Load Balancer
    Type: String
  HostedZoneName:
    AllowedPattern: &gt;-
      ^$|(([a-zA-Z0-9]|[a-zA-Z0-9][a-zA-Z0-9\-]*[a-zA-Z0-9])\.)*([A-Za-z0-9]|[A-Za-z0-9][A-Za-z0-9\-]*[A-Za-z0-9])$
    Default: ''
    Description: '[Optional] The domain name of a valid Hosted Zone on AWS.'
    Type: String
Conditions:
  UseALBSSL: !Not 
    - !Equals 
      - !Ref UseSSL
      - 'Yes'
Rules:
  SubnetsInVPC:
    Assertions:
      - Assert:
          'Fn::EachMemberEquals':
            - 'Fn::ValueOf':
                - Subnets
                - VpcId
            - Ref: VpcId
        AssertDescription: All subnets must in the VPC
  ValidateHostedZone:
    RuleCondition: !Equals 
      - !Ref UseSSL
      - 'Yes'
    Assertions:
      - Assert: !Not 
          - !Equals 
            - !Ref ALBSSLCertificateARN
            - ''
        AssertDescription: ACM Certificate value cannot be empty if SSL is required
      - Assert: !Not 
          - !Equals 
            - !Ref HostedZoneName
            - ''
        AssertDescription: Route53 Hosted Zone Name is mandatory when SSL is required
Mappings:
  AWSAMIRegionMap:
    AMI:
      AMZNLINUXHVM: amzn-ami-hvm-2017.09.1.20171120-x86_64-gp2
    ap-northeast-1:
      AMZNLINUXHVM: ami-da9e2cbc
    ap-northeast-2:
      AMZNLINUXHVM: ami-1196317f
    ap-south-1:
      AMZNLINUXHVM: ami-d5c18eba
    ap-southeast-1:
      AMZNLINUXHVM: ami-c63d6aa5
    ap-southeast-2:
      AMZNLINUXHVM: ami-ff4ea59d
    ca-central-1:
      AMZNLINUXHVM: ami-d29e25b6
    eu-central-1:
      AMZNLINUXHVM: ami-bf2ba8d0
    eu-west-1:
      AMZNLINUXHVM: ami-1a962263
    eu-west-2:
      AMZNLINUXHVM: ami-e7d6c983
    sa-east-1:
      AMZNLINUXHVM: ami-286f2a44
    us-east-1:
      AMZNLINUXHVM: ami-55ef662f
    us-east-2:
      AMZNLINUXHVM: ami-15e9c770
    us-west-1:
      AMZNLINUXHVM: ami-a51f27c5
    us-west-2:
      AMZNLINUXHVM: ami-bf4193c7
Resources:
  WebServerGroup:
    Type: 'AWS::AutoScaling::AutoScalingGroup'
    Properties:
      VPCZoneIdentifier: !Ref Subnets
      LaunchConfigurationName: !Ref LaunchConfig
      MinSize: '2'
      MaxSize: '2'
      TargetGroupARNs:
        - !Ref ALBTargetGroup
    CreationPolicy:
      ResourceSignal:
        Timeout: PT15M
    UpdatePolicy:
      AutoScalingRollingUpdate:
        MinInstancesInService: '1'
        MaxBatchSize: '1'
        PauseTime: PT15M
        WaitOnResourceSignals: 'true'
  LaunchConfig:
    Type: 'AWS::AutoScaling::LaunchConfiguration'
    Metadata:
      Comment: Install a simple application
      'AWS::CloudFormation::Init':
        config:
          packages:
            yum:
              httpd: []
          files:
            /var/www/html/index.html:
              content: !Join 
                - |+

                - - &gt;-
                    &lt;h1&gt;Congratulations, you have successfully launched the AWS
                    CloudFormation sample.&lt;h1&gt;
              mode: '000644'
              owner: root
              group: root
            /etc/cfn/cfn-hup.conf:
              content: !Join 
                - ''
                - - |
                    [main]
                  - stack=
                  - !Ref 'AWS::StackId'
                  - |+

                  - region=
                  - !Ref 'AWS::Region'
                  - |+

              mode: '000400'
              owner: root
              group: root
            /etc/cfn/hooks.d/cfn-auto-reloader.conf:
              content: !Join 
                - ''
                - - |
                    [cfn-auto-reloader-hook]
                  - |
                    triggers=post.update
                  - &gt;
                    path=Resources.LaunchConfig.Metadata.AWS::CloudFormation::Init
                  - 'action=/opt/aws/bin/cfn-init -v '
                  - '         --stack '
                  - !Ref 'AWS::StackName'
                  - '         --resource LaunchConfig '
                  - '         --region '
                  - !Ref 'AWS::Region'
                  - |+

                  - |
                    runas=root
              mode: '000400'
              owner: root
              group: root
          services:
            sysvinit:
              httpd:
                enabled: 'true'
                ensureRunning: 'true'
              cfn-hup:
                enabled: 'true'
                ensureRunning: 'true'
                files:
                  - /etc/cfn/cfn-hup.conf
                  - /etc/cfn/hooks.d/cfn-auto-reloader.conf
    Properties:
      ImageId: !FindInMap 
        - AWSAMIRegionMap
        - !Ref 'AWS::Region'
        - AMZNLINUXHVM
      SecurityGroups:
        - !Ref InstanceSecurityGroup
      InstanceType: !Ref InstanceType
      KeyName: !Ref KeyName
      UserData: !Base64 
        'Fn::Join':
          - ''
          - - |
              #!/bin/bash -xe
            - |
              yum update -y aws-cfn-bootstrap
            - '/opt/aws/bin/cfn-init -v '
            - '         --stack '
            - !Ref 'AWS::StackName'
            - '         --resource LaunchConfig '
            - '         --region '
            - !Ref 'AWS::Region'
            - |+

            - '/opt/aws/bin/cfn-signal -e $? '
            - '         --stack '
            - !Ref 'AWS::StackName'
            - '         --resource WebServerGroup '
            - '         --region '
            - !Ref 'AWS::Region'
            - |+

  ELBSecurityGroup:
    Type: 'AWS::EC2::SecurityGroup'
    Properties:
      GroupDescription: Allow access to the ELB
      VpcId: !Ref VpcId
      SecurityGroupIngress:
        - !If 
          - UseALBSSL
          - IpProtocol: tcp
            FromPort: 443
            ToPort: 443
            CidrIp: 0.0.0.0/0
          - IpProtocol: tcp
            FromPort: 80
            ToPort: 80
            CidrIp: 0.0.0.0/0
  ApplicationLoadBalancer:
    Type: 'AWS::ElasticLoadBalancingV2::LoadBalancer'
    Properties:
      Subnets: !Ref Subnets
      SecurityGroups:
        - !Ref ELBSecurityGroup
  ALBListener:
    Type: 'AWS::ElasticLoadBalancingV2::Listener'
    Properties:
      DefaultActions:
        - Type: forward
          TargetGroupArn: !Ref ALBTargetGroup
      LoadBalancerArn: !Ref ApplicationLoadBalancer
      Port: !If 
        - UseALBSSL
        - 443
        - 80
      Protocol: !If 
        - UseALBSSL
        - HTTPS
        - HTTP
      Certificates:
        - !If 
          - UseALBSSL
          - CertificateArn: !Ref ALBSSLCertificateARN
          - !Ref 'AWS::NoValue'
  ALBTargetGroup:
    Type: 'AWS::ElasticLoadBalancingV2::TargetGroup'
    Properties:
      HealthCheckIntervalSeconds: 30
      HealthCheckTimeoutSeconds: 5
      HealthyThresholdCount: 3
      Port: 80
      Protocol: HTTP
      UnhealthyThresholdCount: 5
      VpcId: !Ref VpcId
  InstanceSecurityGroup:
    Type: 'AWS::EC2::SecurityGroup'
    Properties:
      GroupDescription: Enable SSH access and HTTP access on the inbound port
      SecurityGroupIngress:
        - IpProtocol: tcp
          FromPort: 80
          ToPort: 80
          SourceSecurityGroupId: !Select 
            - 0
            - !GetAtt 
              - ApplicationLoadBalancer
              - SecurityGroups
        - IpProtocol: tcp
          FromPort: 22
          ToPort: 22
          CidrIp: !Ref SSHLocation
      VpcId: !Ref VpcId
  RecordSet:
    Type: 'AWS::Route53::RecordSetGroup'
    Condition: UseALBSSL
    Properties:
      HostedZoneName: !Join 
        - ''
        - - !Ref HostedZoneName
          - .
      RecordSets:
        - Name: !Join 
            - ''
            - - !Select 
                - '0'
                - !Split 
                  - .
                  - !GetAtt 
                    - ApplicationLoadBalancer
                    - DNSName
              - .
              - !Ref HostedZoneName
              - .
          Type: A
          AliasTarget:
            DNSName: !GetAtt 
              - ApplicationLoadBalancer
              - DNSName
            EvaluateTargetHealth: true
            HostedZoneId: !GetAtt 
              - ApplicationLoadBalancer
              - CanonicalHostedZoneID
Outputs:
  URL:
    Description: URL of the website
    Value: !Join 
      - ''
      - - !If 
          - UseALBSSL
          - !Join 
            - ''
            - - 'https://'
              - !Join 
                - ''
                - - !Select 
                    - '0'
                    - !Split 
                      - .
                      - !GetAtt 
                        - ApplicationLoadBalancer
                        - DNSName
                  - .
                  - !Ref HostedZoneName
                  - .
          - !Join 
            - ''
            - - 'http://'
              - !GetAtt 
                - ApplicationLoadBalancer
                - DNSName</code></pre>
        </div>
    <awsdocs-copyright class="copyright-print"></awsdocs-copyright><awsdocs-thumb-feedback right-edge="{{$ctrl.thumbFeedbackRightEdge}}"></awsdocs-thumb-feedback></div><noscript><div><div><div><div id="js_error_message"><p><img src="https://d1ge0kk1l5kms0.cloudfront.net/images/G/01/webservices/console/warning.png" alt="Avertissement" /> <strong>JavaScript est désactivé ou n'est pas disponible dans votre navigateur.</strong></p><p>Pour que vous puissiez utiliser la documentation AWS, Javascript doit être activé. Vous trouverez des instructions sur les pages d'aide de votre navigateur.</p></div></div></div></div></noscript><div id="main-col-footer" class="awsui-util-font-size-0"><div id="doc-conventions"><a target="_top" href="/general/latest/gr/docconventions.html">Conventions de rédaction</a></div><div class="prev-next"><div id="previous" class="prev-link" accesskey="p" href="./dynamic-references.html">Utilisation de références dynamiques pour spécifier les valeurs de modèle</div><div id="next" class="next-link" accesskey="n" href="./intrinsic-function-reference-rules.html">Fonctions de règle</div></div></div><awsdocs-page-utilities></awsdocs-page-utilities></div><div id="quick-feedback-yes" style="display: none;"><div class="title">Cette page vous a-t-elle été utile ? - Oui</div><div class="content"><p>Merci de nous avoir fait part de votre satisfaction.</p><p>Si vous avez quelques minutes à nous consacrer, merci de nous indiquer ce qui vous a plu afin que nous puissions nous améliorer davantage.</p><p><awsui-button id="fblink" rel="noopener noreferrer" target="_blank" text="Commentaire" click="linkClick($event)" href="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=CloudFormation&amp;topic_url=https://docs.aws.amazon.com/fr_fr/AWSCloudFormation/latest/UserGuide/rules-section-structure.html"></awsui-button></p></div></div><div id="quick-feedback-no" style="display: none;"><div class="title">Cette page vous a-t-elle été utile ? - Non</div><div class="content"><p>Merci de nous avoir avertis que cette page avait besoin d'être retravaillée. Nous sommes désolés de ne pas avoir répondu à vos attentes.</p><p>Si vous avez quelques minutes à nous consacrer, merci de nous indiquer comment nous pourrions améliorer cette documentation.</p><p><awsui-button id="fblink" rel="noopener noreferrer" target="_blank" text="Commentaire" click="linkClick($event)" href="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=CloudFormation&amp;topic_url=https://docs.aws.amazon.com/fr_fr/AWSCloudFormation/latest/UserGuide/rules-section-structure.html"></awsui-button></p></div></div></div></body></div></awsdocs-view><div class="page-loading-indicator" id="page-loading-indicator"><awsui-spinner size="large"></awsui-spinner></div></div><div id="tools-panel" dom-region="tools"><awsdocs-tools-panel id="awsdocs-tools-panel"></awsdocs-tools-panel></div></awsui-app-layout><awsdocs-cookie-banner class="doc-cookie-banner"></awsdocs-cookie-banner></div></body></html>