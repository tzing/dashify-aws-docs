<!DOCTYPE html>
    <html xmlns="http://www.w3.org/1999/xhtml" lang="pt-BR"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Conceder permissões autogerenciadas - AWS CloudFormation</title><meta name="viewport" content="width=device-width,initial-scale=1" /><meta name="assets_root" content="/assets" /><meta name="target_state" content="stacksets-prereqs-self-managed" /><meta name="default_state" content="stacksets-prereqs-self-managed" /><link rel="icon" type="image/ico" href="/assets/images/favicon.ico" /><link rel="shortcut icon" type="image/ico" href="/assets/images/favicon.ico" /><link rel="canonical" href="https://docs.aws.amazon.com/pt_br/AWSCloudFormation/latest/UserGuide/stacksets-prereqs-self-managed.html" /><meta name="description" content="Com permissões autogerenciadas, você cria os perfis do AWS Identity and Access Management (IAM) necessários para o StackSets implantar em contas e Regiões da AWS. Essas funções são necessárias para estabelecer um relacionamento confiável entre a conta na qual você está administrando o conjunto de pilhas e a conta na qual você está implantando instâncias de pilha. Usando esse modelo de permissões, o StackSets pode implantar em qualquer Conta da AWS na qual você tenha permissões para criar um perfil do IAM." /><meta name="deployment_region" content="IAD" /><meta name="product" content="AWS CloudFormation" /><meta name="guide" content="Guia do usuário" /><meta name="abstract" content="Crie e gerencie implantações da infraestrutura da AWS de maneira previsível e que pode ser repetida usando o AWS CloudFormation com este Guia do usuário." /><meta name="guide-locale" content="pt_br" /><meta name="tocs" content="toc-contents.json" /><link rel="canonical" href="https://docs.aws.amazon.com/pt_br/AWSCloudFormation/latest/UserGuide/stacksets-prereqs-self-managed.html" /><link rel="alternative" href="https://docs.aws.amazon.com/id_id/AWSCloudFormation/latest/UserGuide/stacksets-prereqs-self-managed.html" hreflang="id-id" /><link rel="alternative" href="https://docs.aws.amazon.com/id_id/AWSCloudFormation/latest/UserGuide/stacksets-prereqs-self-managed.html" hreflang="id" /><link rel="alternative" href="https://docs.aws.amazon.com/de_de/AWSCloudFormation/latest/UserGuide/stacksets-prereqs-self-managed.html" hreflang="de-de" /><link rel="alternative" href="https://docs.aws.amazon.com/de_de/AWSCloudFormation/latest/UserGuide/stacksets-prereqs-self-managed.html" hreflang="de" /><link rel="alternative" href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/stacksets-prereqs-self-managed.html" hreflang="en-us" /><link rel="alternative" href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/stacksets-prereqs-self-managed.html" hreflang="en" /><link rel="alternative" href="https://docs.aws.amazon.com/es_es/AWSCloudFormation/latest/UserGuide/stacksets-prereqs-self-managed.html" hreflang="es-es" /><link rel="alternative" href="https://docs.aws.amazon.com/es_es/AWSCloudFormation/latest/UserGuide/stacksets-prereqs-self-managed.html" hreflang="es" /><link rel="alternative" href="https://docs.aws.amazon.com/fr_fr/AWSCloudFormation/latest/UserGuide/stacksets-prereqs-self-managed.html" hreflang="fr-fr" /><link rel="alternative" href="https://docs.aws.amazon.com/fr_fr/AWSCloudFormation/latest/UserGuide/stacksets-prereqs-self-managed.html" hreflang="fr" /><link rel="alternative" href="https://docs.aws.amazon.com/it_it/AWSCloudFormation/latest/UserGuide/stacksets-prereqs-self-managed.html" hreflang="it-it" /><link rel="alternative" href="https://docs.aws.amazon.com/it_it/AWSCloudFormation/latest/UserGuide/stacksets-prereqs-self-managed.html" hreflang="it" /><link rel="alternative" href="https://docs.aws.amazon.com/ja_jp/AWSCloudFormation/latest/UserGuide/stacksets-prereqs-self-managed.html" hreflang="ja-jp" /><link rel="alternative" href="https://docs.aws.amazon.com/ja_jp/AWSCloudFormation/latest/UserGuide/stacksets-prereqs-self-managed.html" hreflang="ja" /><link rel="alternative" href="https://docs.aws.amazon.com/ko_kr/AWSCloudFormation/latest/UserGuide/stacksets-prereqs-self-managed.html" hreflang="ko-kr" /><link rel="alternative" href="https://docs.aws.amazon.com/ko_kr/AWSCloudFormation/latest/UserGuide/stacksets-prereqs-self-managed.html" hreflang="ko" /><link rel="alternative" href="https://docs.aws.amazon.com/pt_br/AWSCloudFormation/latest/UserGuide/stacksets-prereqs-self-managed.html" hreflang="pt-br" /><link rel="alternative" href="https://docs.aws.amazon.com/pt_br/AWSCloudFormation/latest/UserGuide/stacksets-prereqs-self-managed.html" hreflang="pt" /><link rel="alternative" href="https://docs.aws.amazon.com/zh_cn/AWSCloudFormation/latest/UserGuide/stacksets-prereqs-self-managed.html" hreflang="zh-cn" /><link rel="alternative" href="https://docs.aws.amazon.com/zh_tw/AWSCloudFormation/latest/UserGuide/stacksets-prereqs-self-managed.html" hreflang="zh-tw" /><link rel="alternative" href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/stacksets-prereqs-self-managed.html" hreflang="x-default" /><meta name="feedback-item" content="CloudFormation" /><meta name="this_doc_product" content="AWS CloudFormation" /><meta name="this_doc_guide" content="Guia do usuário" /><script defer="" src="/assets/r/vendor4.js?version=2021.12.02"></script><script defer="" src="/assets/r/vendor3.js?version=2021.12.02"></script><script defer="" src="/assets/r/vendor1.js?version=2021.12.02"></script><script defer="" src="/assets/r/awsdocs-common.js?version=2021.12.02"></script><script defer="" src="/assets/r/awsdocs-doc-page.js?version=2021.12.02"></script><link href="/assets/r/vendor4.css?version=2021.12.02" rel="stylesheet" /><link href="/assets/r/awsdocs-common.css?version=2021.12.02" rel="stylesheet" /><link href="/assets/r/awsdocs-doc-page.css?version=2021.12.02" rel="stylesheet" /><script async="" id="awsc-panorama-bundle" type="text/javascript" src="https://prod.pa.cdn.uis.awsstatic.com/panorama-nav-init.js" data-config="{'appEntity':'aws-documentation','region':'us-east-1','service':'cloudformation'}"></script><meta id="panorama-serviceSubSection" value="Guia do usuário" /><meta id="panorama-serviceConsolePage" value="Conceder permissões autogerenciadas" /></head><body class="awsdocs awsui"><div class="awsdocs-container"><awsdocs-header></awsdocs-header><awsui-app-layout id="app-layout" class="awsui-util-no-gutters" ng-controller="ContentController as $ctrl" header-selector="awsdocs-header" navigation-hide="false" navigation-width="$ctrl.navWidth" navigation-open="$ctrl.navOpen" navigation-change="$ctrl.onNavChange($event)" tools-hide="$ctrl.hideTools" tools-width="$ctrl.toolsWidth" tools-open="$ctrl.toolsOpen" tools-change="$ctrl.onToolsChange($event)"><div id="guide-toc" dom-region="navigation"><awsdocs-toc></awsdocs-toc></div><div id="main-column" dom-region="content" tabindex="-1"><awsdocs-view class="awsdocs-view"><div id="awsdocs-content"><head><title>Conceder permissões autogerenciadas - AWS CloudFormation</title><meta name="rss" content="aws-cloudformation-release-notes.rss" /><meta name="forums" content="http://forums.aws.amazon.com/forum.jspa?forumID=92" /><meta name="feedback" content="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=CloudFormation&amp;topic_url=https://docs.aws.amazon.com/pt_br/AWSCloudFormation/latest/UserGuide/stacksets-prereqs-self-managed.html" /><meta name="feedback-yes" content="feedbackyes.html?topic_url=https://docs.aws.amazon.com/pt_br/AWSCloudFormation/latest/UserGuide/stacksets-prereqs-self-managed.html" /><meta name="feedback-no" content="feedbackno.html?topic_url=https://docs.aws.amazon.com/pt_br/AWSCloudFormation/latest/UserGuide/stacksets-prereqs-self-managed.html" /><meta name="keywords" content="CloudFormation,AWSCloudFormation,provisionamento de recursos,configuração de recursos,gerenciamento da infraestrutura,CloudFormer,Pilha do CloudFormation,Stackset do CloudFormation,Modelo do CloudFormation,conjunto de alterações" /><script type="application/ld+json">
{
    "@context" : "https://schema.org",
    "@type" : "BreadcrumbList",
    "itemListElement" : [
      {
        "@type" : "ListItem",
        "position" : 1,
        "name" : "AWS",
        "item" : "https://aws.amazon.com"
      },
      {
        "@type" : "ListItem",
        "position" : 2,
        "name" : "AWS CloudFormation",
        "item" : "https://docs.aws.amazon.com/cloudformation/index.html"
      },
      {
        "@type" : "ListItem",
        "position" : 3,
        "name" : "Guia do usuário",
        "item" : "https://docs.aws.amazon.com/pt_br/AWSCloudFormation/latest/UserGuide"
      },
      {
        "@type" : "ListItem",
        "position" : 4,
        "name" : "Trabalhar com o AWS CloudFormation StackSets",
        "item" : "https://docs.aws.amazon.com/pt_br/AWSCloudFormation/latest/UserGuide/what-is-cfnstacksets.html"
      },
      {
        "@type" : "ListItem",
        "position" : 5,
        "name" : "Pré-requisitos para operações de conjunto de pilhas",
        "item" : "https://docs.aws.amazon.com/pt_br/AWSCloudFormation/latest/UserGuide/stacksets-prereqs.html"
      },
      {
        "@type" : "ListItem",
        "position" : 6,
        "name" : "Conceder permissões autogerenciadas",
        "item" : "https://docs.aws.amazon.com/pt_br/AWSCloudFormation/latest/UserGuide/stacksets-prereqs.html"
      }
    ]
}
</script></head><body><div id="main"><div style="display: none"></div><div id="breadcrumbs" class="breadcrumb"><a href="https://aws.amazon.com">AWS</a><a href="/index.html">Documentação</a><a href="/cloudformation/index.html">AWS CloudFormation</a><a href="Welcome.html">Guia do usuário</a></div><div id="page-toc-src"><a href="#prereqs-self-managed-permissions">Permissões autogerenciadas</a><a href="#stacksets-prereqs-accountsetup">Definir permissões básicas para operações de conjuntos de pilhas</a><a href="#stacksets-prereqs-advanced-perms">Definir opções de permissões avançadas para operações de conjuntos de pilhas</a><a href="#confused-deputy-mitigation">Prevenção do problema do “confused deputy”</a></div><div id="main-content" class="awsui-util-container"><div id="main-col-body"><awsdocs-language-banner data-service="$ctrl.pageService"></awsdocs-language-banner><h1 class="topictitle" id="stacksets-prereqs-self-managed">Conceder permissões autogerenciadas</h1><div class="awsdocs-page-header-container"><awsdocs-page-header></awsdocs-page-header><awsdocs-filter-selector id="awsdocs-filter-selector"></awsdocs-filter-selector></div><p>Com permissões autogerenciadas, você cria os perfis do AWS Identity and Access Management (IAM) necessários para o StackSets implantar em contas e Regiões da AWS. Essas funções são necessárias para estabelecer um relacionamento confiável entre a conta na qual você está administrando o conjunto de pilhas e a conta na qual você está implantando instâncias de pilha. Usando esse modelo de permissões, o StackSets pode implantar em qualquer Conta da AWS na qual você tenha permissões para criar um perfil do IAM.</p><div class="highlights" id="inline-topiclist"><h6>Tópicos</h6><ul><li><a href="#prereqs-self-managed-permissions">Permissões autogerenciadas</a></li><li><a href="#stacksets-prereqs-accountsetup">Definir permissões básicas para operações de conjuntos de pilhas</a></li><li><a href="#stacksets-prereqs-advanced-perms">Definir opções de permissões avançadas para operações de conjuntos de pilhas</a></li><li><a href="#confused-deputy-mitigation">Configurar chaves globais para atenuar problemas de confused deputy</a></li></ul></div>
            <h2 id="prereqs-self-managed-permissions">Permissões autogerenciadas</h2>
            <p>Para configurar as permissões necessárias para s criação de um conjunto de pilhas <b>gerenciadas pelo serviço</b>, consulte <a href="./stacksets-orgs-activate-trusted-access.html">Ativar o acesso confiável com AWS Organizations</a>.</p>
            <p>Para criar um conjunto de pilhas com permissões <b>autogerenciadas</b>, você precisa estabelecer uma relação de confiança entre as contas de administrador e de destino criando funções do IAM em cada conta.</p>
            <div class="orderedlist">
                 
                 
                 
            <ol><li>
                    <p>Determine qual conta da AWS é a <em>conta do administrador</em>.</p>
                    <p>Os conjuntos de pilha serão criados nessa conta de administrador. Uma <em>conta de destino</em> é a conta na qual você cria as pilhas individuais que pertencem a um conjunto de pilhas.</p>
                </li><li>
                    <p>Determine como você deseja estruturar as permissões para os conjuntos de pilha.</p>
                    <p>A configuração de permissões mais simples (e mais permissiva) é oferecer a <em>todos</em> os usuários e grupos na conta de administrador a capacidade de criar e atualizar <em>todos</em> os conjuntos de pilhas gerenciados por meio daquela conta. Se precisar de um controle mais refinado, defina permissões para especificar:</p>
                    <div class="itemizedlist">
                         
                         
                         
                    <ul class="itemizedlist"><li class="listitem">
                            <p>Quais usuários e grupos podem executar operações do conjunto de pilhas em quais contas de destino.</p>
                        </li><li class="listitem">
                            <p>Quais recursos os usuários e grupos podem incluir em seus conjuntos de pilhas.</p>
                        </li><li class="listitem">
                            <p>Quais operações do conjunto de pilhas os usuários e grupos específicos podem realizar.</p>
                        </li></ul></div>
                </li><li>
                    <p>Crie as funções de serviço do IAM necessárias nas contas de administrador e de destino para definir as permissões desejadas.</p>
                </li></ol></div>
         
            <h2 id="stacksets-prereqs-accountsetup">Definir permissões básicas para operações de conjuntos de pilhas</h2>
            <p>A configuração de permissões mais simples (e mais permissiva) é oferecer a <em>todos</em> os usuários e grupos na conta de administrador a capacidade de criar e atualizar <em>todos</em> os conjuntos de pilhas gerenciados por meio daquela conta. Para fazer isso, crie funções de serviço do IAM para as contas de administrador e de destino. Qualquer pessoa com permissões para a conta de administrador tem permissões para criar, atualizar ou excluir qualquer pilha em qualquer uma das contas de destino.</p>
            <p>A conta de administrador e as contas de destino devem ter funções de serviço configuradas para criar uma relação de confiança entre as contas e conceder às contas de destino a permissão para criar e gerenciar os recursos descritos em seu modelo.</p>
            <p>Se você estrutura as permissões dessa forma, os usuários não passam uma função de administrador ao criar ou atualizar conjuntos de pilhas.</p>
            <div class="mediaobject">
                 
                    <img src="images/stacksets_perms_master_target.png" class="aws-docs-img-whiteBg aws-docs-img-padding" alt="&#xA;                     Configure uma relação de confiança entre a conta do administrador e as contas de destino. Assim, qualquer usuário na conta de administrador poderá criar um conjunto de pilhas.&#xA;                " style="max-width:100%" />
                 
                 
            </div>
            <div class="procedure"><h6>Definir permissões para todos os usuários da conta de administrador para executar operações do conjunto de pilhas em todas as contas de destino</h6><ol><li>
                    <p>Na conta do administrador, crie uma função do IAM denominada <b>AWSCloudFormationStackSetAdministrationRole</b>. Você pode fazer isso criando uma pilha a partir do modelo do AWS CloudFormation a seguir, que está disponível online em <a href="https://s3.amazonaws.com/cloudformation-stackset-sample-templates-us-east-1/AWSCloudFormationStackSetAdministrationRole.yml" rel="noopener noreferrer" target="_blank"><span>https://s3.amazonaws.com/cloudformation-stackset-sample-templates-us-east-1/AWSCloudFormationStackSetAdministrationRole.yml</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a>. A função criada por este modelo habilita a seguinte política na conta do administrador.</p>
                    <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copiar"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
  "Version": "2012-10-17",
  "Statement": [
    <span>{</span>
      "Action": [
        "sts:AssumeRole"
      ],
      "Resource": [
        "arn:aws:iam::*:role/AWSCloudFormationStackSetExecutionRole"
      ],
      "Effect": "Allow"
    }
  ]
}</code></pre>
                    <p>A seguinte relação de confiança é criada pelo modelo anterior.</p>
                    <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copiar"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
  "Version": "2012-10-17",
  "Statement": [
    <span>{</span>
      "Effect": "Allow",
      "Principal": <span>{</span>
        "Service": "cloudformation.amazonaws.com"
      },
      "Action": "sts:AssumeRole"
    }
  ]
}</code></pre>
                    <p>Esteja ciente de que, para implantar instâncias de pilha em uma conta de destino que reside em uma região que está desabilitada por padrão, você também precisará incluir o principal de serviço regional para essa região. Cada região desabilitada por padrão terá sua própria entidade principal de serviço regional.</p>
                    <p>Para obter mais informações sobre endpoints regionais, incluindo uma lista de endpoints, consulte <a href="https://docs.aws.amazon.com/general/latest/gr/rande.html#regional-endpoints">Endpoints regionais</a> no <em>Guia de referência geral da AWS </em>.</p>
                    <p>O exemplo a seguir inclui a entidade principal de serviço regional (<code class="code">cloudformation.ap-east-1.amazonaws.com</code>) para a região Ásia-Pacífico (Hong Kong), uma região que está desabilitada por padrão.</p>
                    <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copiar"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
  "Version": "2012-10-17",
  "Statement": [
    <span>{</span>
      "Effect": "Allow",
      "Principal": <span>{</span>
        "Service": [
            "cloudformation.amazonaws.com",
            "cloudformation.ap-east-1.amazonaws.com"
         ]
      },
      "Action": "sts:AssumeRole"
    }
  ]
}</code></pre>
                    <p>Para ter mais informações, consulte <a href="./stacksets-prereqs.html#stacksets-opt-in-regions">Executar operações de conjunto de pilha envolvendo regiões desativadas por padrão</a>.</p>
                </li><li>
                    <p>Em cada conta de destino, crie uma função de serviço chamada <b>AWSCloudFormationStackSetExecutionRole</b> que confie na conta do administrador. Essa função deve ter esse nome exato. Você pode fazer isso criando uma pilha a partir do modelo do AWS CloudFormation a seguir, que está disponível online em <a href="https://s3.amazonaws.com/cloudformation-stackset-sample-templates-us-east-1/AWSCloudFormationStackSetExecutionRole.yml" rel="noopener noreferrer" target="_blank"><span>https://s3.amazonaws.com/cloudformation-stackset-sample-templates-us-east-1/AWSCloudFormationStackSetExecutionRole.yml</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a>. Ao usar este modelo, você será solicitado a fornecer o nome da conta do administrador com a qual sua conta de destino deve estabelecer uma relação de confiança.</p>
                    <div class="awsdocs-note awsdocs-important"><div class="awsdocs-note-title"><awsui-icon name="status-warning" variant="error"></awsui-icon><h6>Importante</h6></div><div class="awsdocs-note-text"><p>Lembre-se de que este modelo concede acesso de administrador. Depois de usar o modelo para criar uma função de execução da conta de destino, você deve definir o escopo das permissões na declaração de política para os tipos de recursos que você criará usando o StackSets.</p></div></div>
                    <p>A função de serviço da conta de destino requer permissões para executar qualquer operação que está especificada no modelo do AWS CloudFormation. Por exemplo, se o seu modelo estiver criando um bucket do S3, então você precisará de permissões para criar novos objetos para o S3. Sua conta de destino sempre precisa de permissão total no AWS CloudFormation, o que inclui as permissões para criar, atualizar, excluir e descrever pilhas. A função criada por este modelo habilita a seguinte política em uma conta de destino.</p>
                    <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copiar"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
  "Version": "2012-10-17",
  "Statement": [
    <span>{</span>
      "Effect": "Allow",
      "Action": "*",
      "Resource": "*"
    }
  ]
}</code></pre>
                    <p>Você deve adicionar a ação de serviço e os recursos do S3 à instrução da política de <code class="code">AWSCloudFormationStackSetExecutionRole</code> para cada conta de destino para que o StackSets funcione. O StackSets utiliza essas permissões para notificar o estado da instância da pilha nas contas de destino e na conta do administrador.</p>
                    <p>Para criar pilhas em contas de destino que usam recursos de serviços que não sejam o CloudFormation, você deve adicionar essas ações de serviço e recursos à declaração de política <code class="code">AWSCloudFormationStackSetExecutionRole</code> para cada conta de destino. O exemplo a seguir mostra uma declaração de política com as permissões necessárias para o StackSets.</p>
                    <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copiar"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
  "Version": "2012-10-17",
  "Statement": [
    <span>{</span>
      "Effect": "Allow",
      "Action": [
         "cloudformation:*",
         "s3:*"
      ],
      "Resource": "*"
    }
  ]
}</code></pre>
                    <p>A seguinte relação de confiança é criada pelo modelo. O ID da conta do administrador é mostrado como <code class="replaceable">admin_account_id</code>.</p>
                    <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copiar"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
  "Version": "2012-10-17",
  "Statement": [
    <span>{</span>
      "Effect": "Allow",
      "Principal": <span>{</span>
        "AWS": "arn:aws:iam::<code class="replaceable">admin_account_id</code>:root"
      },
      "Action": "sts:AssumeRole"
    }
  ]
}</code></pre>
                    <p>Você pode configurar a relação de confiança de uma função de execução da conta de destino existente para confiar em uma função específica na conta do administrador. Se você excluir a função na conta de administrador e criar uma nova para substituí-la, deve configurar suas relações de confiança da conta de destino com a função da nova conta de administrador, representada por <code class="replaceable">admin_account_id</code> no exemplo anterior.</p>
                </li></ol></div>
         
            <h2 id="stacksets-prereqs-advanced-perms">Definir opções de permissões avançadas para operações de conjuntos de pilhas</h2>
            <p>Se precisar de um controle mais refinado sobre os conjuntos de pilhas que os usuários e os grupos criam por meio de uma única conta de administrador, use funções do IAM para especificar:</p>
            <div class="itemizedlist">
                 
                 
                 
            <ul class="itemizedlist"><li class="listitem">
                    <p>Quais usuários e grupos podem executar operações do conjunto de pilhas em quais contas de destino.</p>
                </li><li class="listitem">
                    <p>Quais recursos os usuários e grupos podem incluir em seus conjuntos de pilhas.</p>
                </li><li class="listitem">
                    <p>Quais operações do conjunto de pilhas os usuários e grupos específicos podem realizar.</p>
                </li></ul></div>
             
                <h3 id="stacksets-prereqs-multiadmin">Definir permissões para controlar o acesso à conta de destino</h3>
                <p>Use as funções de administrador personalizadas para controlar quais usuários e grupos podem executar operações de conjunto de pilhas em que contas de destino. Você pode controlar quais usuários da conta de administrador podem executar as operações de conjunto de pilhas em que contas de destino. Para fazer isso, crie uma relação de confiança entre cada conta de destino e uma função de administração personalizada específica, em vez de criar a função de serviço <b>AWSCloudFormationStackSetAdministrationRole</b> na própria conta de administrador. Em seguida, ative usuários e grupos específicos para usar a função de administração personalizada apropriada ao executar operações de conjunto de pilhas em uma determinada conta de destino.</p>
                <p>Por exemplo, você pode criar uma função A e uma função B na sua conta de administrador. Você pode conceder à função A permissões para acessar as contas de destino de 1 a 8. Você pode conceder à função B permissões para acessar as contas de destino de 9 a 16.</p>
                <div class="mediaobject">
                     
                        <img src="images/stacksets_perms_admin_target.png" class="aws-docs-img-whiteBg aws-docs-img-padding" alt="&#xA;                         Configure uma relação de confiança entre a função do administrador personalizada e as contas de destino. Em seguida, o usuário passará essa função ao criar o conjunto de pilhas.&#xA;                    " style="max-width:100%" />
                     
                     
                </div>
                <p>A configuração das permissões necessárias envolve a definição de uma função de administrador personalizada, a criação de uma função de serviço para a conta de destino e a concessão da permissão aos usuários para passar a função de administrador personalizada ao executar as operações de conjunto de pilhas.</p>
                <p>Em geral, uma vez que você já tenha as permissões necessárias, é assim que isso funciona: ao criar um conjunto de pilhas, o usuário deve especificar um administrador personalizado. O usuário deve ter a permissão para passar a função para o AWS CloudFormation. Além disso, a função de administrador personalizada deve ter uma relação de confiança com as contas de destino especificadas para o conjunto de pilhas. O AWS CloudFormation cria o conjunto de pilhas e associa a ele essa função de administrador personalizada. Ao atualizar um conjunto de pilhas, o usuário deve especificar explicitamente uma função de administrador personalizada, mesmo que seja a mesma função de administrador personalizada usada com esse conjunto de pilha anteriormente. O AWS CloudFormation usa essa função para atualizar a pilha, sujeita aos requisitos acima.</p>
                <div class="procedure"><h6>Definir permissões para as quais usuários e grupos podem executar operações do conjunto de pilhas em contas de destino específicas</h6><ol><li>
                        <p>Para cada conjunto de pilhas, crie uma função de administrador personalizada com permissões para assumir a função de serviço <b>AWSCloudFormationStackSetExecutionRole</b> nas contas de destino.</p>
                        <p>Crie um <a href="https://docs.aws.amazon.com/IAM/latest/UserGuide/id_roles_create_for-service.html">perfil de serviço do IAM</a> com um nome personalizado usando a política de permissões a seguir:</p>
                        <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copiar"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
  "Version": "2012-10-17",
  "Statement": [
    <span>{</span>
      "Action": [
        "sts:AssumeRole"
      ],
      "Resource": [
        "arn:aws:iam::<code class="replaceable">target_account_id</code>:role/AWSCloudFormationStackSetExecutionRole"
      ],
      "Effect": "Allow"
    }
  ]
}</code></pre>
                        <p>Ou, se você deseja especificar todas as contas de destino, use a política de permissões a seguir:</p>
                        <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copiar"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
  "Version": "2012-10-17",
  "Statement": [
    <span>{</span>
      "Action": [
        "sts:AssumeRole"
      ],
      "Resource": [
        "arn:aws:iam::<code class="replaceable">*</code>:role/AWSCloudFormationStackSetExecutionRole"
      ],
      "Effect": "Allow"
    }
  ]
}</code></pre>
                        <p>Você deve fornecer a política de confiança a seguir ao criar a função para definir a relação de confiança:</p>
                        <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copiar"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span> 
  "Version": "2012-10-17", 
  "Statement": [ 
    <span>{</span> 
      "Effect": "Allow", 
      "Principal": <span>{</span> 
        "Service": "cloudformation.amazonaws.com" 
      }, 
      "Action": "sts:AssumeRole" 
    } 
  ] 
}</code></pre>
                        <p>Esteja ciente de que, para implantar instâncias de pilha em uma conta de destino que reside em uma região que está desabilitada por padrão, você também precisará incluir o principal de serviço regional para essa região. Cada região não disponível por padrão terá sua própria entidade principal de serviço regional.</p>
                        <p>Para obter mais informações sobre endpoints regionais, incluindo uma lista de endpoints, consulte <a href="https://docs.aws.amazon.com/general/latest/gr/rande.html#regional-endpoints">Endpoints regionais</a> no <em>Guia de referência geral da AWS </em>.</p>
                        <p>O exemplo a seguir inclui a entidade principal de serviço regional (<code class="code">cloudformation.ap-east-1.amazonaws.com</code>) para a região Ásia-Pacífico (Hong Kong), uma região que está desabilitada por padrão.</p>
                        <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copiar"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
  "Version": "2012-10-17",
  "Statement": [
    <span>{</span>
      "Effect": "Allow",
      "Principal": <span>{</span>
        "Service": [
            "cloudformation.amazonaws.com",
            "cloudformation.ap-east-1.amazonaws.com"
         ]
      },
      "Action": "sts:AssumeRole"
    }
  ]
}</code></pre>
                        <p>Para ter mais informações, consulte <a href="./stacksets-prereqs.html#stacksets-opt-in-regions">Executar operações de conjunto de pilha envolvendo regiões desativadas por padrão</a>.</p>
                    </li><li>
                        <p>Em cada conta de destino, crie uma função de serviço chamada <b>AWSCloudFormationStackSetExecutionRole</b> que confie na função de administrador personalizada que você deseja usar com esta conta.</p>
                        <div class="awsdocs-note awsdocs-important"><div class="awsdocs-note-title"><awsui-icon name="status-warning" variant="error"></awsui-icon><h6>Importante</h6></div><div class="awsdocs-note-text"><p>Você deve definir o escopo das permissões na declaração de política para os tipos de recursos que está criando com o StackSets.</p></div></div>
                        <p>A função de serviço da conta de destino requer permissões para executar qualquer operação que está especificada no modelo do AWS CloudFormation. Por exemplo, se o seu modelo estiver criando um bucket do S3, você precisará de permissões para criar novos objetos no S3. Sua conta de destino sempre precisa de permissão total no AWS CloudFormation, o que inclui as permissões para criar, atualizar, excluir e descrever pilhas.</p>
                        <p>O exemplo a seguir mostra uma declaração de política com as permissões <em>mínimas</em> para que o StackSets funcione. Para criar pilhas em contas de destino que usam recursos de serviços que não sejam o AWS CloudFormation, você deve adicionar essas ações de serviço e recursos às permissões da declaração de política <b>AWSCloudFormationStackSetExecutionRole</b> para cada conta de destino.</p>
                        <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copiar"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
  "Version": "2012-10-17",
  "Statement": [
    <span>{</span>
      "Effect": "Allow",
      "Action": [
        "cloudformation:*",
        "s3:*"
      ],
      "Resource": "*"
    }
  ]
}</code></pre>
                        <p>Você deve fornecer a política de confiança a seguir ao criar a função para definir a relação de confiança:</p>
                        <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copiar"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
  "Version": "2012-10-17", 
  "Statement": [ 
    <span>{</span> 
      "Effect": "Allow", 
      "Principal": <span>{</span> 
      "AWS": "arn:aws:iam::<code class="replaceable">admin_account_id</code>:role/<code class="replaceable">customized_admin_role</code>" 
      }, 
      "Action": "sts:AssumeRole"
    } 
  ] 
} </code></pre>
                    </li><li>
                        <p>Permita que os usuários passem a função de administrador personalizada ao executar operações de conjunto de pilhas.</p>
                        <p>Anexe uma política de permissões do IAM para usuários ou grupos que permita que eles passem a função de administrador personalizada apropriada ao criar ou atualizar conjuntos de pilhas específicas. Para obter mais informações, consulte <a href="https://docs.aws.amazon.com/IAM/latest/UserGuide/id_roles_use_passrole.html">Conceder a um usuário permissões para transmitir uma função a um produto da AWS</a>. No exemplo abaixo, <code class="replaceable">customized_admin_role</code> refere-se à função do administrador que o usuário precisa passar.</p>

                        <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copiar"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
  "Version": "2012-10-17",
  "Statement": [
    <span>{</span>
      "Effect": "Allow",
      "Action": [
        "iam:GetRole",
        "iam:PassRole"
      ],
      "Resource": "arn:aws:iam::*:role/<code class="replaceable">customized_admin_role</code>"
    }
  ]
}</code></pre>
                    </li></ol></div>
             
             
                <h3 id="stacksets-prereqs-executionrole">Definir permissões para controlar a inclusão de recursos de pilha</h3>
                <p>Use funções de execução personalizadas para controlar quais recursos de pilha os usuários e grupos podem incluir em seus conjuntos de pilhas. Por exemplo, é possível configurar um grupo que só pode incluir recursos relacionados ao Amazon S3 nos conjuntos de pilhas criados, enquanto outra equipe só pode incluir recursos do DynamoDB. Para fazer isso, crie uma relação de confiança entre a função de administrador personalizada para cada grupo e uma função de execução personalizada para cada conjunto de recursos. A função de execução personalizada define quais recursos de pilha podem ser inclusos no conjuntos de pilhas. A função de administrador personalizada reside na conta de administrador, enquanto a função de execução personalizada reside em cada conta de destino onde deseja criar conjuntos de pilhas usando recursos definidos. Em seguida, ative usuários e grupos específicos para usar a função de administração personalizada apropriada ao executar operações de conjunto de pilhas.</p>
                <p>Por exemplo, você pode criar funções de administrador personalizadas A, B e C na conta do administrador. Usuários e grupos com permissão para usar Função A podem criar conjuntos de pilhas que contém os recursos de pilha especificamente listados na função de execução personalizada X, mas não aqueles nas funções Y ou Z, ou recursos não incluídos em qualquer função de execução.</p>
                <div class="mediaobject">
                     
                        <img src="images/stacksets_perms_admin_execution.png" class="aws-docs-img-whiteBg aws-docs-img-padding" alt="&#xA;                        Defina uma relação de confiança entre a função do administrador personalizada e uma função de execução personalizada nas contas de destino. Em seguida, o usuário envia essas funções ao criar o conjunto de pilhas.&#xA;                    " style="max-width:100%" />
                     
                     
                </div>
                <p>Ao atualizar um conjunto de pilhas, o usuário deve especificar explicitamente uma função de administrador personalizada, mesmo que seja a mesma função de administrador personalizada usada com esse conjunto de pilhas anteriormente. O AWS CloudFormation executa a atualização usando a função de administrador personalizada especificada, desde que o usuário tenha permissões para executar operações nesse conjunto de pilhas.</p>
                <p>Da mesma forma, o usuário também pode especificar uma função de execução personalizada. Se for especificada uma função de execução personalizada, o AWS CloudFormation usará essa função para atualizar a pilha, de acordo com os requisitos acima. Se o usuário não especificar uma função de execução personalizada, o AWS CloudFormation executará a atualização usando a função de execução personalizada anteriormente associada ao conjunto de pilhas, desde que o usuário tenha as permissões para executar as operações no conjunto de pilhas.</p>
                <div class="procedure"><h6>Definir permissões para quais recursos os usuários e grupos podem incluir em conjunto de pilhas específicos</h6><ol><li>
                        <p>Nas contas de destino em que deseja criar os conjuntos de pilhas, crie uma função de execução personalizada que concede permissões aos serviços e recursos que deseja que os usuários e grupos possam incluir nos conjuntos de pilhas.</p>
                        <p>O exemplo a seguir fornece as permissões mínimas para conjuntos de pilhas, junto com a permissão para criar tabelas do Amazon DynamoDB.</p>
                        <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copiar"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
  "Version": "2012-10-17",
  "Statement": [
    <span>{</span>
      "Effect": "Allow",
      "Action": [
        "cloudformation:*",
        "s3:*",
      ],
      "Resource": "*"
    },
    <span>{</span>
      "Effect": "Allow",
      "Action": [
        "dynamoDb:createTable"
      ],
      "Resource": "*"
    }
  ]
}</code></pre>
                        <p>Você deve fornecer a política de confiança a seguir ao criar a função para definir a relação de confiança:</p>
                        <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copiar"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
  "Version": "2012-10-17", 
  "Statement": [ 
    <span>{</span> 
      "Effect": "Allow", 
      "Principal": <span>{</span> 
      "AWS": "arn:aws:iam::<code class="replaceable">admin_account_id</code>:role/<code class="replaceable">customized_admin_role</code>" 
      }, 
      "Action": "sts:AssumeRole"
    } 
  ] 
} </code></pre>
                    </li><li>
                        <p>Crie uma função de administrador personalizada na sua conta de administrador, conforme detalhado em <a href="#stacksets-prereqs-multiadmin">Definir permissões para controlar o acesso à conta de destino</a>. Inclua uma relação de confiança entre a função de administrador personalizada e as funções de execução personalizadas que deseja usar.</p>
                        <p>O exemplo a seguir inclui uma política <code class="code">sts::AssumeRole</code> para <b>AWSCloudFormationStackSetExecutionRole</b> definida para a conta de destino, bem como um perfil de execução personalizado.</p>
                    </li></ol></div>
                <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copiar"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
  "Version": "2012-10-17",
   "Statement": [
    <span>{</span>
      "Sid": "Stmt1487980684000",
      "Effect": "Allow",
      "Action": [
        "sts:AssumeRole" 
      ],
      "Resource": [ 
        "arn:aws:iam::*:role/AWSCloudFormationStackSetExecutionRole",
        "arn:aws:iam::*:role/<code class="replaceable">custom_execution_role</code>" 
      ]
    } 
  ]
}</code></pre>
             
             
                <h3 id="stacksets-prereqs-iam-actions">Definir permissões para operações específicas de conjuntos de pilhas</h3>
                <p>Além disso, você pode definir permissões para quais usuários e grupos podem executar operações específicas do conjunto de pilhas, como criação, atualização ou exclusão de conjuntos de pilhas ou instâncias de pilha. Para obter mais informações, consulte <a href="https://docs.aws.amazon.com/IAM/latest/UserGuide/list_awscloudformation.html">Ações, recursos e chaves de condição para o AWS CloudFormation</a>, no <em>Guia do Usuário do IAM</em>.</p>
             
         
            <h2 id="confused-deputy-mitigation">Configurar chaves globais para atenuar problemas de confused deputy</h2>
            <p>‘Confused deputy’ é um problema de segurança em que uma entidade que não tem permissão para executar uma ação pode coagir uma entidade com mais privilégios a executá-la. Na AWS, a personificação entre serviços pode resultar no problema do ‘confused deputy’. A imitação entre serviços pode ocorrer quando um serviço (o <em>serviço de chamada</em>) chama outro serviço (o <em>serviço chamado</em>). O serviço de chamada pode ser manipulado de modo a usar suas permissões para atuar nos recursos de outro cliente de uma forma na qual ele não deveria ter permissão para acessar. Para evitar isso, a AWS fornece ferramentas que ajudam você a proteger seus dados para todos os serviços com entidades principais de serviço que receberam acesso aos recursos em sua conta.</p>
            <p>Recomendamos usar chaves de contexto de condição global <a href="https://docs.aws.amazon.com/IAM/latest/UserGuide/reference_policies_condition-keys.html#condition-keys-sourcearn"><code class="code">aws:SourceArn</code></a> e <a href="https://docs.aws.amazon.com/IAM/latest/UserGuide/reference_policies_condition-keys.html#condition-keys-sourceaccount"><code class="code">aws:SourceAccount</code></a> nas políticas de recursos para limitar as permissões que o AWS CloudFormation StackSets concede a outro serviço para o recurso. Se você utilizar ambas as chaves de contexto de condição global, o valor <code class="code">aws:SourceAccount</code> e a conta no valor <code class="code">aws:SourceArn</code> deverão utilizar o mesmo ID de conta quando utilizados na mesma instrução de política.</p>

            <p>A maneira mais eficaz de se proteger do problema ‘confused deputy’ é usar a chave de contexto de condição global <code class="code">aws:SourceArn</code> com o ARN completo do recurso. Se você não souber o ARN completo do recurso ou se estiver especificando vários recursos, use a chave de condição de contexto global <code class="code">aws:SourceArn</code> com curingas (<code class="code">*</code>) para as partes desconhecidas do ARN. Por exemplo, <code class="code">arn:aws:<code class="replaceable">cloudformation</code>::<code class="replaceable">123456789012</code>:*</code>. Sempre que possível, use <code class="code">aws:SourceArn</code>, pois ela é mais específica. Use <code class="code">aws:SourceAccount</code> apenas quando não puder determinar o ARN ou padrão de ARN correto.</p>


            <p>Quando o StackSets assume a função de <b>Administração</b> na sua conta de <b>administrador</b>, ele preenche o ID dessa conta de <b>administrador</b> e nome do recurso da Amazon (ARN) do StackSets. Portanto, é possível definir condições para <a href="https://docs.aws.amazon.com/IAM/latest/UserGuide/reference_policies_condition-keys.html#condition-keys-sourceaccount">chaves globais</a> <code class="code">aws:SourceAccount</code> e <code class="code">aws:SourceArn</code> nas relações de confiança para evitar <a href="https://docs.aws.amazon.com/IAM/latest/UserGuide/confused-deputy.html">problemas de confused deputy</a>. O exemplo a seguir mostra como é possível usar as chaves de contexto de condição globais <code class="code">aws:SourceArn</code> e <code class="code">aws:SourceAccount</code> em StackSets para evitar o problema “confused deputy”.</p>
            <div class="example"><h6>exemplo Chaves globais para <code class="code">aws:SourceAccount</code> e <code class="code">aws:SourceArn</code></h6><div class="example-contents"><p>Ao utilizar StackSets, defina as chaves globais <code class="code">aws:SourceAccount</code> e <code class="code">aws:SourceArn</code> na sua política de confiança <code class="code">AWSCloudFormationStackSetAdministrationRole</code> para evitar problemas de confused deputy.</p><pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copiar"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
  "Version": "2012-10-17",
  "Statement": [
    <span>{</span>
      "Effect": "Allow",
      "Principal": <span>{</span>
        "Service": "cloudformation.amazonaws.com"
      },
      "Action": "sts:AssumeRole",
      "Condition": <span>{</span>
        "StringEquals": <span>{</span>
          "aws:SourceAccount": "<code class="replaceable">111122223333</code>"
        },
        "StringLike": <span>{</span>
          "aws:SourceArn": "arn:aws:cloudformation:*:<code class="replaceable">111122223333</code>:stackset/*"
        }
      }
    }
  ]
}</code></pre></div></div>
            <div class="example"><h6>exemplo ARNs de StackSets</h6><div class="example-contents"><p>Especifique seus ARNs de StackSets associados para um controle mais definido.</p><pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copiar"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
  "Version": "2012-10-17",
  "Statement": [
    <span>{</span>
      "Effect": "Allow",
      "Principal": <span>{</span>
        "Service": "cloudformation.amazonaws.com"
      },
      "Action": "sts:AssumeRole",
      "Condition": <span>{</span>
        "StringEquals": <span>{</span>
          "aws:SourceAccount": "<code class="replaceable">111122223333</code>",
          "aws:SourceArn": [
            "arn:aws:cloudformation:<code class="replaceable">STACKSETS-REGION</code>:<code class="replaceable">111122223333</code>:stackset/<code class="replaceable">STACK-SET-ID-1</code>",
            "arn:aws:cloudformation:<code class="replaceable">STACKSETS-REGION</code>:<code class="replaceable">111122223333</code>:stackset/<code class="replaceable">STACK-SET-ID-2</code>",
          ]
        }
      }
    }
  ]
}</code></pre></div></div>
        <awsdocs-copyright class="copyright-print"></awsdocs-copyright><awsdocs-thumb-feedback right-edge="{{$ctrl.thumbFeedbackRightEdge}}"></awsdocs-thumb-feedback></div><noscript><div><div><div><div id="js_error_message"><p><img src="https://d1ge0kk1l5kms0.cloudfront.net/images/G/01/webservices/console/warning.png" alt="Atenção" /> <strong>O Javascript está desativado ou não está disponível no seu navegador.</strong></p><p>Para usar a documentação da AWS, o Javascript deve estar ativado. Consulte as páginas de Ajuda do navegador para obter instruções.</p></div></div></div></div></noscript><div id="main-col-footer" class="awsui-util-font-size-0"><div id="doc-conventions"><a target="_top" href="/general/latest/gr/docconventions.html">Convenções do documento</a></div><div class="prev-next"><div id="previous" class="prev-link" accesskey="p" href="./stacksets-prereqs.html">Pré-requisitos para operações de conjunto de pilhas</div><div id="next" class="next-link" accesskey="n" href="./stacksets-orgs-activate-trusted-access.html">Ativar o acesso confiável com AWS Organizations</div></div></div><awsdocs-page-utilities></awsdocs-page-utilities></div><div id="quick-feedback-yes" style="display: none;"><div class="title">Essa página foi útil? - Sim</div><div class="content"><p>Obrigado por nos informar que estamos fazendo um bom trabalho!</p><p>Se tiver tempo, conte-nos sobre o que você gostou para que possamos melhorar ainda mais.</p><p><awsui-button id="fblink" rel="noopener noreferrer" target="_blank" text="Feedback" click="linkClick($event)" href="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=CloudFormation&amp;topic_url=https://docs.aws.amazon.com/pt_br/AWSCloudFormation/latest/UserGuide/stacksets-prereqs-self-managed.html"></awsui-button></p></div></div><div id="quick-feedback-no" style="display: none;"><div class="title">Essa página foi útil? - Não</div><div class="content"><p>Obrigado por nos informar que precisamos melhorar a página. Lamentamos ter decepcionado você.</p><p>Se tiver tempo, conte-nos como podemos melhorar a documentação.</p><p><awsui-button id="fblink" rel="noopener noreferrer" target="_blank" text="Feedback" click="linkClick($event)" href="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=CloudFormation&amp;topic_url=https://docs.aws.amazon.com/pt_br/AWSCloudFormation/latest/UserGuide/stacksets-prereqs-self-managed.html"></awsui-button></p></div></div></div></body></div></awsdocs-view><div class="page-loading-indicator" id="page-loading-indicator"><awsui-spinner size="large"></awsui-spinner></div></div><div id="tools-panel" dom-region="tools"><awsdocs-tools-panel id="awsdocs-tools-panel"></awsdocs-tools-panel></div></awsui-app-layout><awsdocs-cookie-banner class="doc-cookie-banner"></awsdocs-cookie-banner></div></body></html>