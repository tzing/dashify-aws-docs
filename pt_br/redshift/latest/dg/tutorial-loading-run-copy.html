<!DOCTYPE html>
    <html xmlns="http://www.w3.org/1999/xhtml" lang="pt-BR"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Etapa 5: Executar os comandos COPY - Amazon Redshift</title><meta name="viewport" content="width=device-width,initial-scale=1" /><meta name="assets_root" content="/assets" /><meta name="target_state" content="tutorial-loading-run-copy" /><meta name="default_state" content="tutorial-loading-run-copy" /><link rel="icon" type="image/ico" href="/assets/images/favicon.ico" /><link rel="shortcut icon" type="image/ico" href="/assets/images/favicon.ico" /><link rel="canonical" href="https://docs.aws.amazon.com/pt_br/redshift/latest/dg/tutorial-loading-run-copy.html" /><meta name="description" content="Aprenda a sintaxe básica do comando COPY e execute o comando COPY em seu cliente SQL com opções diferentes para saber como carregar tabelas usando formatos de arquivo diferentes." /><meta name="deployment_region" content="IAD" /><meta name="product" content="Amazon Redshift" /><meta name="guide" content="Guia do desenvolvedor de banco de dados" /><meta name="abstract" content="Crie e gerencie um data warehouse com o Amazon Redshift, um serviço de data warehouse totalmente gerenciado, em escala de petabyte e de nível empresarial." /><meta name="guide-locale" content="pt_br" /><meta name="tocs" content="toc-contents.json" /><link rel="canonical" href="https://docs.aws.amazon.com/pt_br/redshift/latest/dg/tutorial-loading-run-copy.html" /><link rel="alternative" href="https://docs.aws.amazon.com/id_id/redshift/latest/dg/tutorial-loading-run-copy.html" hreflang="id-id" /><link rel="alternative" href="https://docs.aws.amazon.com/id_id/redshift/latest/dg/tutorial-loading-run-copy.html" hreflang="id" /><link rel="alternative" href="https://docs.aws.amazon.com/de_de/redshift/latest/dg/tutorial-loading-run-copy.html" hreflang="de-de" /><link rel="alternative" href="https://docs.aws.amazon.com/de_de/redshift/latest/dg/tutorial-loading-run-copy.html" hreflang="de" /><link rel="alternative" href="https://docs.aws.amazon.com/redshift/latest/dg/tutorial-loading-run-copy.html" hreflang="en-us" /><link rel="alternative" href="https://docs.aws.amazon.com/redshift/latest/dg/tutorial-loading-run-copy.html" hreflang="en" /><link rel="alternative" href="https://docs.aws.amazon.com/es_es/redshift/latest/dg/tutorial-loading-run-copy.html" hreflang="es-es" /><link rel="alternative" href="https://docs.aws.amazon.com/es_es/redshift/latest/dg/tutorial-loading-run-copy.html" hreflang="es" /><link rel="alternative" href="https://docs.aws.amazon.com/fr_fr/redshift/latest/dg/tutorial-loading-run-copy.html" hreflang="fr-fr" /><link rel="alternative" href="https://docs.aws.amazon.com/fr_fr/redshift/latest/dg/tutorial-loading-run-copy.html" hreflang="fr" /><link rel="alternative" href="https://docs.aws.amazon.com/it_it/redshift/latest/dg/tutorial-loading-run-copy.html" hreflang="it-it" /><link rel="alternative" href="https://docs.aws.amazon.com/it_it/redshift/latest/dg/tutorial-loading-run-copy.html" hreflang="it" /><link rel="alternative" href="https://docs.aws.amazon.com/ja_jp/redshift/latest/dg/tutorial-loading-run-copy.html" hreflang="ja-jp" /><link rel="alternative" href="https://docs.aws.amazon.com/ja_jp/redshift/latest/dg/tutorial-loading-run-copy.html" hreflang="ja" /><link rel="alternative" href="https://docs.aws.amazon.com/ko_kr/redshift/latest/dg/tutorial-loading-run-copy.html" hreflang="ko-kr" /><link rel="alternative" href="https://docs.aws.amazon.com/ko_kr/redshift/latest/dg/tutorial-loading-run-copy.html" hreflang="ko" /><link rel="alternative" href="https://docs.aws.amazon.com/pt_br/redshift/latest/dg/tutorial-loading-run-copy.html" hreflang="pt-br" /><link rel="alternative" href="https://docs.aws.amazon.com/pt_br/redshift/latest/dg/tutorial-loading-run-copy.html" hreflang="pt" /><link rel="alternative" href="https://docs.aws.amazon.com/zh_cn/redshift/latest/dg/tutorial-loading-run-copy.html" hreflang="zh-cn" /><link rel="alternative" href="https://docs.aws.amazon.com/zh_tw/redshift/latest/dg/tutorial-loading-run-copy.html" hreflang="zh-tw" /><link rel="alternative" href="https://docs.aws.amazon.com/redshift/latest/dg/tutorial-loading-run-copy.html" hreflang="x-default" /><meta name="feedback-item" content="Redshift" /><meta name="this_doc_product" content="Amazon Redshift" /><meta name="this_doc_guide" content="Guia do desenvolvedor de banco de dados" /><script defer="" src="/assets/r/vendor4.js?version=2021.12.02"></script><script defer="" src="/assets/r/vendor3.js?version=2021.12.02"></script><script defer="" src="/assets/r/vendor1.js?version=2021.12.02"></script><script defer="" src="/assets/r/awsdocs-common.js?version=2021.12.02"></script><script defer="" src="/assets/r/awsdocs-doc-page.js?version=2021.12.02"></script><link href="/assets/r/vendor4.css?version=2021.12.02" rel="stylesheet" /><link href="/assets/r/awsdocs-common.css?version=2021.12.02" rel="stylesheet" /><link href="/assets/r/awsdocs-doc-page.css?version=2021.12.02" rel="stylesheet" /><script async="" id="awsc-panorama-bundle" type="text/javascript" src="https://prod.pa.cdn.uis.awsstatic.com/panorama-nav-init.js" data-config="{'appEntity':'aws-documentation','region':'us-east-1','service':'redshift'}"></script><meta id="panorama-serviceSubSection" value="Guia do desenvolvedor de banco de dados" /><meta id="panorama-serviceConsolePage" value="Etapa 5: Executar os comandos COPY" /></head><body class="awsdocs awsui"><div class="awsdocs-container"><awsdocs-header></awsdocs-header><awsui-app-layout id="app-layout" class="awsui-util-no-gutters" ng-controller="ContentController as $ctrl" header-selector="awsdocs-header" navigation-hide="false" navigation-width="$ctrl.navWidth" navigation-open="$ctrl.navOpen" navigation-change="$ctrl.onNavChange($event)" tools-hide="$ctrl.hideTools" tools-width="$ctrl.toolsWidth" tools-open="$ctrl.toolsOpen" tools-change="$ctrl.onToolsChange($event)"><div id="guide-toc" dom-region="navigation"><awsdocs-toc></awsdocs-toc></div><div id="main-column" dom-region="content" tabindex="-1"><awsdocs-view class="awsdocs-view"><div id="awsdocs-content"><head><title>Etapa 5: Executar os comandos COPY - Amazon Redshift</title><meta name="pdf" content="redshift-dg.pdf#tutorial-loading-run-copy" /><meta name="rss" content="Dochistory.rss" /><meta name="forums" content="http://forums.aws.amazon.com/forum.jspa?forumID=155" /><meta name="feedback" content="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=Redshift&amp;topic_url=https://docs.aws.amazon.com/pt_br/redshift/latest/dg/tutorial-loading-run-copy.html" /><meta name="feedback-yes" content="feedbackyes.html?topic_url=https://docs.aws.amazon.com/pt_br/redshift/latest/dg/tutorial-loading-run-copy.html" /><meta name="feedback-no" content="feedbackno.html?topic_url=https://docs.aws.amazon.com/pt_br/redshift/latest/dg/tutorial-loading-run-copy.html" /><meta name="keywords" content="Amazon Redshift,AWS Redshift,Redshift,Redshift Spectrum,cluster,data warehouse,desenvolvedor,dados de amostra,banco de dados,desenvolvedor do banco de dados,HLL" /><script type="application/ld+json">
{
    "@context" : "https://schema.org",
    "@type" : "BreadcrumbList",
    "itemListElement" : [
      {
        "@type" : "ListItem",
        "position" : 1,
        "name" : "AWS",
        "item" : "https://aws.amazon.com"
      },
      {
        "@type" : "ListItem",
        "position" : 2,
        "name" : "Amazon Redshift",
        "item" : "https://docs.aws.amazon.com/redshift/index.html"
      },
      {
        "@type" : "ListItem",
        "position" : 3,
        "name" : "Guia do desenvolvedor de banco de dados",
        "item" : "https://docs.aws.amazon.com/pt_br/redshift/latest/dg"
      },
      {
        "@type" : "ListItem",
        "position" : 4,
        "name" : "Carregamento de dados",
        "item" : "https://docs.aws.amazon.com/pt_br/redshift/latest/dg/t_Loading_data.html"
      },
      {
        "@type" : "ListItem",
        "position" : 5,
        "name" : "Tutorial: Carregar dados do Amazon S3",
        "item" : "https://docs.aws.amazon.com/pt_br/redshift/latest/dg/tutorial-loading-data.html"
      },
      {
        "@type" : "ListItem",
        "position" : 6,
        "name" : "Etapa 5: Executar os comandos COPY",
        "item" : "https://docs.aws.amazon.com/pt_br/redshift/latest/dg/tutorial-loading-data.html"
      }
    ]
}
</script></head><body><div id="main"><div style="display: none"><a href="redshift-dg.pdf#tutorial-loading-run-copy" target="_blank" rel="noopener noreferrer" title="Abrir em PDF"></a></div><div id="breadcrumbs" class="breadcrumb"><a href="https://aws.amazon.com">AWS</a><a href="/index.html">Documentação</a><a href="/redshift/index.html">Amazon Redshift</a><a href="welcome.html">Guia do desenvolvedor de banco de dados</a></div><div id="page-toc-src"><a href="#tutorial-loading-data-copy-syntax">Sintaxe do comando COPY</a><a href="#tutorial-loading-run-copy-load-tables">Carregar as tabelas SSB</a></div><div id="main-content" class="awsui-util-container"><div id="main-col-body"><awsdocs-language-banner data-service="$ctrl.pageService"></awsdocs-language-banner><h1 class="topictitle" id="tutorial-loading-run-copy">Etapa 5: Executar os comandos COPY</h1><div class="awsdocs-page-header-container"><awsdocs-page-header></awsdocs-page-header><awsdocs-filter-selector id="awsdocs-filter-selector"></awsdocs-filter-selector></div><p>Você executa os comandos COPY para carregar cada uma das tabelas no esquema SSB. Os exemplos de comando COPY demonstram como carregar de formatos de arquivo diferentes usando várias opções de comando COPY e solucionando erros de carga.</p><div class="highlights" id="inline-topiclist"><h6>Tópicos</h6><ul><li><a href="#tutorial-loading-data-copy-syntax">Sintaxe do comando COPY</a></li><li><a href="#tutorial-loading-run-copy-load-tables">Carregar as tabelas SSB</a></li></ul></div>
            <h2 id="tutorial-loading-data-copy-syntax">Sintaxe do comando COPY</h2>


            <p>A seguir, a sintaxe básica do comando <a href="./r_COPY.html">COPY</a>. </p>
            <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copiar"><awsui-icon name="copy"></awsui-icon></div></div><code class="">COPY table_name [ column_list ] FROM data_source CREDENTIALS access_credentials [options] </code></pre>
            <p>Para executar um comando COPY, forneça os valores a seguir. </p>
             
                <h6>Nome da tabela </h6>
                <p>A tabela de destino do comando COPY. A tabela já deve existir no banco de dados. A tabela pode ser temporária ou persistente. O comando COPY acrescenta os novos dados de entrada a todas as linhas existentes na tabela. </p>
             
             
                <h6>Lista de colunas</h6>
                <p>Por padrão, COPY carrega campos dos dados de origem para as colunas da tabela na ordem. Você pode especificar uma <em>lista de colunas</em>, uma lista separada por vírgulas de nomes de coluna, a fim de mapear campos de dados para colunas específicas. Você não usa listas de colunas neste tutorial. Para obter mais informações, consulte <a href="./copy-parameters-column-mapping.html#copy-column-list">Column List</a> na referência do comando COPY.</p>
             
            <p><span class="topcon">Fonte de dados</span></p>
            <p>Você pode usar o comando COPY para carregar dados de um bucket do Amazon S3, um cluster do Amazon EMR, um host remoto usando uma conexão SSH ou uma tabela do Amazon DynamoDB. Para este tutorial, você carrega de arquivos de dados em um bucket do Amazon S3. Ao carregar do Amazon S3, você deve fornecer o nome do bucket e a localização dos arquivos de dados. Para fazer isso, forneça o caminho de um objeto para os arquivos de dados ou a localização de um arquivo manifesto que lista explicitamente cada arquivo de dados e sua localização. </p>
            <div class="itemizedlist">
                 
                 
            <ul class="itemizedlist"><li class="listitem">
                    <p>Prefixo de chaves </p>
                    <p>Um objeto armazenado no Amazon S3 é identificado exclusivamente por uma chave de objeto, que inclui o nome do bucket, os nomes das pastas, se houver, e o nome do objeto. Um <em>prefixo de chaves </em>se refere a um conjunto de objetos com o mesmo prefixo. O caminho do objeto é um prefixo de chaves usado pelo comando COPY para carregar todos os objetos que compartilham o prefixo de chaves. Por exemplo, o prefixo de chaves <code class="code">custdata.txt</code> pode referenciar um único arquivo ou um conjunto de arquivos, inclusive <code class="code">custdata.txt.001</code><code class="code">custdata.txt.002</code> e assim por diante. </p>
                </li><li class="listitem">
                    <p>Arquivo manifesto</p>
                    <p>Em alguns casos, pode ser necessário carregar os arquivos com prefixos diferentes, por exemplo, de vários buckets ou pastas. Em outros, pode ser necessário excluir arquivos que compartilham um prefixo. Nesses casos, é possível usar um arquivo manifesto. Um <em>arquivo manifesto</em> lista cada arquivo de carga e a chave de objeto exclusiva. Você usa um arquivo manifesto para carregar a tabela PART posteriormente neste tutorial. </p>
                </li></ul></div>
             
                <h6>Credenciais</h6>
                <p>Para acessar os recursos da AWS que contêm os dados a serem carregados, você deve fornecer as credenciais de acesso da AWS a um usuário com privilégios suficientes. Essas credenciais incluem um nome do recurso da Amazon (ARN) da função do IAM. Para carregar dados do Amazon S3, as credenciais devem incluir as permissões ListBucket e GetObject. Serão necessárias outras credenciais, se os dados estiverem criptografados. Para obter mais informações, consulte <a href="./copy-parameters-authorization.html">Parâmetros de autorização</a> na referência do comando COPY. Para obter mais informações sobre como gerenciar o acesso, consulte <a href="https://docs.aws.amazon.com/AmazonS3/latest/dev/s3-access-control.html">Gerenciar permissões de acesso aos seus recursos do Amazon S3</a>. </p>
             
            <p><span class="topcon">Opções</span></p>
            <p>Você pode especificar vários parâmetros com o comando COPY para especificar formatos de arquivo, gerenciar formatos de dados, gerenciar erros e controlar outros recursos. Neste tutorial, você usa as seguintes opções e os seguintes recursos do comando COPY: </p>
            <div class="itemizedlist">
                 
                 
                 
                 
                 
                 
                 
                 
                 
                 
                 
                 
                 
            <ul class="itemizedlist"><li class="listitem">
                    <p>Prefixo de chaves</p>
                    <p>Para obter informações sobre como carregar de vários arquivos especificando um prefixo de chave, consulte <a href="#tutorial-loading-load-part">Carregar a tabela PART usando NULL AS</a>.</p>
                </li><li class="listitem">
                    <p>Formato CSV</p>
                    <p>Para obter informações sobre como carregar dados que estão no formato CSV, consulte <a href="#tutorial-loading-load-part">Carregar a tabela PART usando NULL AS</a>.</p>
                </li><li class="listitem">
                    <p>NULL AS</p>
                    <p>Para obter informações sobre como carregar PART usando a opção NULL AS, consulte <a href="#tutorial-loading-load-part">Carregar a tabela PART usando NULL AS</a>.</p>
                </li><li class="listitem">
                    <p>Formato delimitado por caracteres</p>
                    <p>Para obter informações sobre como usar a opção DELIMITER, consulte <a href="#tutorial-loading-load-supplier">Carregar a tabela SUPPLIER usando REGION</a>.</p>
                </li><li class="listitem">
                    <p>REGION</p>
                    <p>Para obter informações sobre como usar a opção REGION, consulte <a href="#tutorial-loading-load-supplier">Carregar a tabela SUPPLIER usando REGION</a>.</p>
                </li><li class="listitem">
                    <p>Largura de formato fixo</p>
                    <p>Para obter informações sobre como carregar a tabela CUSTOMER de dados de largura fixa, consulte <a href="#tutorial-loading-load-customer">Carregar a tabela CUSTOMER usando MANIFEST</a>.</p>
                </li><li class="listitem">
                    <p>MAXERROR</p>
                    <p>Para obter informações sobre como usar a opção MAXERROR, consulte <a href="#tutorial-loading-load-customer">Carregar a tabela CUSTOMER usando MANIFEST</a>.</p>
                </li><li class="listitem">
                    <p>ACCEPTINVCHARS</p>
                    <p>Para obter informações sobre como usar a opção ACCEPTINVCHARS, consulte <a href="#tutorial-loading-load-customer">Carregar a tabela CUSTOMER usando MANIFEST</a>.</p>
                </li><li class="listitem">
                    <p>MANIFEST</p>
                    <p>Para obter informações sobre como usar a opção MANIFEST, consulte <a href="#tutorial-loading-load-customer">Carregar a tabela CUSTOMER usando MANIFEST</a>.</p>
                </li><li class="listitem">
                    <p>DATEFORMAT</p>
                    <p>Para obter informações sobre como usar a opção DATEFORMAT, consulte <a href="#tutorial-loading-load-dwdate">Carregar a tabela DWDATE usando DATEFORMAT</a>.</p>
                </li><li class="listitem">
                    <p>GZIP, LZOP e BZIP2</p>
                    <p>Para obter informações sobre como compactar arquivos, consulte <a href="#tutorial-loading-load-lineorder">Carregar a tabela LINEORDER usando vários arquivos</a>.</p>
                </li><li class="listitem">
                    <p>COMPUPDATE</p>
                    <p>Para obter informações sobre como usar a opção COMPUPDATE, consulte <a href="#tutorial-loading-load-lineorder">Carregar a tabela LINEORDER usando vários arquivos</a>.</p>
                </li><li class="listitem">
                    <p>Vários arquivos</p>
                    <p>Para obter informações sobre como carregar vários arquivos, consulte <a href="#tutorial-loading-load-lineorder">Carregar a tabela LINEORDER usando vários arquivos</a>.</p>
                </li></ul></div>
         
            <h2 id="tutorial-loading-run-copy-load-tables">Carregar as tabelas SSB</h2>

            <p>Você usa os comandos COPY a seguir para carregar cada uma das tabelas no esquema SSB. O comando para cada tabela demonstra opções de COPY e técnicas para solução de problemas diferentes.</p>
            <p>Para carregar as tabelas SSB, siga estas etapas: </p>
            <div class="orderedlist">
                 
                 
                 
                 
                 
                 
            <ol><li>
                    <p><a href="#tutorial-loading-run-copy-replaceables">Substituir o nome do bucket e as credenciais da AWS</a></p>

                </li><li>
                    <p><a href="#tutorial-loading-load-part">Carregar a tabela PART usando NULL AS</a></p>

                </li><li>
                    <p><a href="#tutorial-loading-load-supplier">Carregar a tabela SUPPLIER usando REGION</a></p>

                </li><li>
                    <p><a href="#tutorial-loading-load-customer">Carregar a tabela CUSTOMER usando MANIFEST</a></p>

                </li><li>
                    <p><a href="#tutorial-loading-load-dwdate">Carregar a tabela DWDATE usando DATEFORMAT</a></p>

                </li><li>
                    <p><a href="#tutorial-loading-load-lineorder">Carregar a tabela LINEORDER usando vários arquivos</a></p>

                </li></ol></div>
             
                <h3 id="tutorial-loading-run-copy-replaceables">Substituir o nome do bucket e as credenciais da AWS</h3>

                <p>Os comandos COPY neste tutorial são apresentados no formato a seguir.</p>
                
                <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copiar"><awsui-icon name="copy"></awsui-icon></div></div><code class="nohighlight">copy table from 's3://<code class="replaceable">&lt;your-bucket-name&gt;</code>/load/<em>key_prefix</em>' 
credentials 'aws_iam_role=arn:aws:iam::<code class="replaceable">&lt;aws-account-id&gt;</code>:role/<code class="replaceable">&lt;role-name&gt;</code>'
options;</code></pre>
                
                <p>Para cada comando COPY, faça o seguinte:</p>
                <div class="orderedlist">
                     
                     
                <ol><li>
                        <p>Substitua <code class="replaceable">&lt;your-bucket-name&gt;</code> pelo nome de um bucket na mesma região do cluster. </p>
                        <p>Essa etapa pressupõe que o bucket e o cluster estejam na mesma região. Você também pode especificar a região usando a opção <a href="./copy-parameters-data-source-s3.html#copy-region">REGION</a> com o comando COPY. </p>
                    </li><li>
                        <p>Substitua <code class="replaceable">&lt;aws-account-id&gt;</code> e <code class="replaceable">&lt;role-name&gt;</code> por sua Conta da AWS e função do IAM. O segmento da string de credenciais entre aspas não deve conter espaços ou quebras de linha. O formato do ARN pode ser levemente diferente do formato da amostra. Ao executar os comandos COPY, é melhor copiar o ARN do perfil pelo console do IAM, para garantir que ele seja preciso. </p>
                        
                    </li></ol></div>
             
             
                <h3 id="tutorial-loading-load-part">Carregar a tabela PART usando NULL AS</h3>

                <p>Nesta etapa, você usa as opções CSV e NULL AS para carregar a tabela PART. </p>
                <p>O comando COPY pode carregar dados de vários arquivos em paralelo, o que é muito mais rápido do que carregar de um único arquivo. Para demonstrar esse princípio, os dados de cada tabela neste tutorial estão divididos em oito arquivos, mesmo que os arquivos sejam muito pequenos. Em uma etapa posterior, você compara a diferença de tempo entre o carregamento de um único arquivo e carregar de vários arquivos. Para obter mais informações, consulte <a href="./c_best-practices-use-multiple-files.html">Carregar arquivos de dados</a>. </p>
                 
                    <h6>Prefixo de chaves</h6>
                    <p>Você pode carregar de vários arquivos especificando um prefixo de chaves para o conjunto de arquivos ou listando explicitamente os arquivos em um arquivo manifesto. Nesta etapa, você usa um prefixo de chaves. Em uma etapa posterior, você usa um arquivo manifesto. O prefixo de chaves <code class="code">'s3://mybucket/load/part-csv.tbl'</code> carrega o conjunto de arquivos a seguir na pasta <code class="code">load</code>. </p>
                 
                <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copiar"><awsui-icon name="copy"></awsui-icon></div></div><code class="">part-csv.tbl-000
part-csv.tbl-001
part-csv.tbl-002
part-csv.tbl-003
part-csv.tbl-004
part-csv.tbl-005
part-csv.tbl-006
part-csv.tbl-007
</code></pre>
                 
                    <h6>Formato CSV</h6>
                    <p>CSV, que significa comma separated values, ou valores separados por vírgulas, é um formato comum usado para importar e exportar dados da planilha. CSV é mais flexível do que o formato delimitado por vírgulas porque permite incluir strings de aspas dentro dos campos. O caractere de aspa padrão para o formato COPY from CSV é uma aspa dupla ("), mas você pode especificar outro caractere de aspa usando a opção QUOTE AS. Ao usar aspas dentro do campo, escape o caractere com aspas adicionais.</p>
                 
                <p>O seguinte trecho de um arquivo de dados formatado em CSV para a tabela PART mostra strings entre aspas duplas (<code class="code">"LARGE ANODIZED
                    BRASS"</code>). Ele também mostra uma string entre aspas duplas dentro da string entre aspas (<code class="code">"MEDIUM ""BURNISHED"" TIN"</code>).</p>
                <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copiar"><awsui-icon name="copy"></awsui-icon></div></div><code class="">15,dark sky,MFGR#3,MFGR#47,MFGR#3438,indigo,"LARGE ANODIZED BRASS",45,LG CASE
22,floral beige,MFGR#4,MFGR#44,MFGR#4421,medium,"PROMO, POLISHED BRASS",19,LG DRUM
23,bisque slate,MFGR#4,MFGR#41,MFGR#4137,firebrick,"MEDIUM ""BURNISHED"" TIN",42,JUMBO JAR</code></pre>
                <p>Os dados da tabela PART contêm caracteres que causam uma falha no comando COPY. Neste exercício, você soluciona problemas e corrige-os. </p>
                <p>Para carregar dados que estejam em formato CSV, adicione <code class="code">csv</code> ao comando COPY. Execute o comando a seguir para carregar a tabela PART. </p>
                
                
                <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copiar"><awsui-icon name="copy"></awsui-icon></div></div><code class="nohighlight">copy part from 's3://<code class="replaceable">&lt;your-bucket-name&gt;</code>/load/part-csv.tbl' 
credentials 'aws_iam_role=arn:aws:iam::<code class="replaceable">&lt;aws-account-id&gt;</code>:role/<code class="replaceable">&lt;role-name&gt;</code>'
csv;</code></pre>
                
                <p>Você poderá receber uma mensagem de erro semelhante à mensagem a seguir.</p>
                <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copiar"><awsui-icon name="copy"></awsui-icon></div></div><code class="">An error occurred when executing the SQL command:
copy part from 's3://mybucket/load/part-csv.tbl' 
credentials' ...

ERROR: Load into table 'part' failed.  Check 'stl_load_errors' system table for details. [SQL State=XX000] 

Execution time: 1.46s

1 statement(s) failed.
1 statement(s) failed.</code></pre>
                <p>Para obter mais informações sobre o erro, consulte a tabela STL_LOAD_ERRORS. A consulta a seguir usar a função SUBSTRING para encurtar colunas para fins de legibilidade e usa LIMIT 10 para reduzir o número de linhas retornadas. Você pode ajustar os valores em <code class="code">substring(filename,22,25)</code> para permitir o comprimento do nome do bucket.</p>
                <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copiar"><awsui-icon name="copy"></awsui-icon></div></div><code class="">select query, substring(filename,22,25) as filename,line_number as line, 
substring(colname,0,12) as column, type, position as pos, substring(raw_line,0,30) as line_text,
substring(raw_field_value,0,15) as field_text, 
substring(err_reason,0,45) as reason
from stl_load_errors 
order by query desc
limit 10;</code></pre>
                <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copiar"><awsui-icon name="copy"></awsui-icon></div></div><code class=""> query  |    filename      | line |  column   |    type    | pos |      
--------+-------------------------+-----------+------------+------------+-----+----
 333765 | part-csv.tbl-000 |    1 |           |            |   0 |

 line_text        | field_text |                    reason
------------------+------------+----------------------------------------------
 15,NUL next,     |            | Missing newline: Unexpected character 0x2c f</code></pre>


                 
                    <h6>NULL AS</h6>
                    <p>Os arquivos de dados <code class="code">part-csv.tbl</code> usam o caractere terminador NUL (<code class="code">\x000</code> ou <code class="code">\x0</code>) para indicar valores NULL.</p>
                 
                <div class="awsdocs-note"><div class="awsdocs-note-title"><awsui-icon name="status-info" variant="link"></awsui-icon><h6>nota</h6></div><div class="awsdocs-note-text"><p>Apesar da ortografia muito semelhante, NUL e NULL não são iguais. NUL é um caractere UTF-8 com codepoint <code class="code">x000</code> normalmente usado para indicar End Of Record (EOR – Fim do registro). NULL é um valor SQL que representa uma ausência de dados. </p></div></div>
                <p>Por padrão, COPY trata um caractere terminador NUL como um caractere EOR e encerra o registro, o que normalmente acarreta em resultados inesperados ou em um erro. Não existe um único método padrão para indicar NULL em dados de texto. Assim, a opção do comando NULL AS COPY permite especificar qual caractere substituir por NULL ao carregar a tabela. Neste exemplo, você deseja que COPY trate o caractere terminador NUL como um valor NULL.</p>
                <div class="awsdocs-note"><div class="awsdocs-note-title"><awsui-icon name="status-info" variant="link"></awsui-icon><h6>nota</h6></div><div class="awsdocs-note-text"><p>A coluna da tabela que recebe o valor NULL deve ser configurada como <em>anulável.</em> Ou seja, ela não deve incluir a restrição NOT NULL na especificação CREATE TABLE.</p></div></div>
                <p>Para carregar PART usando a opção NULL AS, execute o comando COPY a seguir.</p>
                <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copiar"><awsui-icon name="copy"></awsui-icon></div></div><code class="nohighlight">copy part from 's3://<code class="replaceable">&lt;your-bucket-name&gt;</code>/load/part-csv.tbl' 
credentials 'aws_iam_role=arn:aws:iam::<code class="replaceable">&lt;aws-account-id&gt;</code>:role/<code class="replaceable">&lt;role-name&gt;</code>' 
csv
null as '\000';</code></pre>
                
                <p>Para verificar se o COPY carregou valores NULL, execute o comando a seguir para selecionar somente as linhas que contenham NULL.</p>
                <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copiar"><awsui-icon name="copy"></awsui-icon></div></div><code class="">select p_partkey, p_name, p_mfgr, p_category from part where p_mfgr is null;</code></pre>
                <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copiar"><awsui-icon name="copy"></awsui-icon></div></div><code class=""> p_partkey |  p_name  | p_mfgr | p_category
-----------+----------+--------+------------
        15 | NUL next |        | MFGR#47
        81 | NUL next |        | MFGR#23
       133 | NUL next |        | MFGR#44 
(2 rows)</code></pre>
             

             
                <h3 id="tutorial-loading-load-supplier">Carregar a tabela SUPPLIER usando REGION</h3>

                <p>Nesta etapa, você usa as opções DELIMITER e REGION para carregar a tabela SUPPLIER.</p>
                <div class="awsdocs-note"><div class="awsdocs-note-title"><awsui-icon name="status-info" variant="link"></awsui-icon><h6>nota</h6></div><div class="awsdocs-note-text"><p>Os arquivos para carregar a tabela SUPPLIER são fornecidos em um bucket de amostra AWS. Você não precisa fazer upload de arquivos nesta etapa.</p></div></div>
                 
                    <h6>Formato delimitado por caracteres</h6>
                    <p>Os campos em um arquivo delimitado por caracteres são separados por um caractere específico, como uma barra ( | ), uma vírgula ( , ) ou uma tabulação ( \t ). Os arquivos delimitados por caractere podem usar qualquer caractere ASCII único, inclusive um dos caracteres ASCII não imprimíveis, como o delimitador. Você especifica o caractere delimitador usando a opção DELIMITER. O delimitador padrão é um caractere de barra ( | ). </p>
                 
                <p>O trecho a seguir dos dados da tabela SUPPLIER usa o formato delimitado por barras. </p>
                <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copiar"><awsui-icon name="copy"></awsui-icon></div></div><code class="">1|1|257368|465569|41365|19950218|2-HIGH|0|17|2608718|9783671|4|2504369|92072|2|19950331|TRUCK
1|2|257368|201928|8146|19950218|2-HIGH|0|36|6587676|9783671|9|5994785|109794|6|19950416|MAIL</code></pre>

                
                 
                    <h6>REGION</h6>
                    <p>Sempre que possível, você deve localizar seus dados de carga na mesma região da AWS do cluster do Amazon Redshift. Se seus dados e cluster estiverem na mesma região, você reduz a latência e evita custos de transferência de dados entre regiões. Para obter mais informações, consulte <a href="./c_loading-data-best-practices.html">Práticas recomendadas do Amazon Redshift para carregamento de dados</a> </p>
                 
                <p>Se você precisar carregar dados de uma região da AWS diferente, use a opção REGION para especificar a região da AWS na qual os dados de carga estão localizados. Se você especificar uma região, todos os dados da carga, inclusive arquivos manifestos, deverão estar na região nomeada. Para obter mais informações, consulte <a href="./copy-parameters-data-source-s3.html#copy-region">REGION</a>. </p>
                <p>Se o cluster estiver na região Leste dos EUA (Norte da Virgínia), execute o seguinte comando para carregar a tabela SUPPLIER de dados delimitados por barra vertical em um bucket do Amazon S3 localizado na região Oeste dos EUA (Oregon). Para este exemplo, não altere o nome do bucket. </p>
                <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copiar"><awsui-icon name="copy"></awsui-icon></div></div><code class="nohighlight">copy supplier from 's3://awssampledbuswest2/ssbgz/supplier.tbl' 
credentials 'aws_iam_role=arn:aws:iam::<code class="replaceable">&lt;aws-account-id&gt;</code>:role/<code class="replaceable">&lt;role-name&gt;</code>' 
delimiter '|' 
gzip
region 'us-west-2';</code></pre>
                
                <p>Se o cluster <em>não</em> estiver na região Leste dos EUA (Norte da Virgínia), execute o seguinte comando para carregar a tabela SUPPLIER de dados delimitados por barra vertical em um bucket do Amazon S3 localizado na região Leste dos EUA (Norte da Virgínia). Para este exemplo, não altere o nome do bucket.</p>
                
                <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copiar"><awsui-icon name="copy"></awsui-icon></div></div><code class="nohighlight">copy supplier from 's3://awssampledb/ssbgz/supplier.tbl' 
credentials 'aws_iam_role=arn:aws:iam::<code class="replaceable">&lt;aws-account-id&gt;</code>:role/<code class="replaceable">&lt;role-name&gt;</code>' 
delimiter '|' 
gzip
region 'us-east-1';
</code></pre>
                
             

             
                <h3 id="tutorial-loading-load-customer">Carregar a tabela CUSTOMER usando MANIFEST</h3>

                <p>Nesta etapa, você usa as opções FIXEDWIDTH, MAXERROR, ACCEPTINVCHARS e MANIFEST para carregar a tabela CUSTOMER.</p>
                <p>Os dados de exemplo deste exercício contêm caracteres que causam erros quando COPY tenta carregá-los. Você usa a opção MAXERRORS e a tabela do sistema STL_LOAD_ERRORS para solucionar erros de carga e usa as opções ACCEPTINVCHARS e MANIFEST para eliminar os erros.</p>
                 
                    <h6>Formato de largura fixa</h6>
                    <p>O formato de largura fixa define cada campo como um número de caracteres fixo, em vez de separar campos com um delimitador. O trecho a seguir dos dados da tabela CUSTOMER usa o formato de largura fixa.</p>
                 
                <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copiar"><awsui-icon name="copy"></awsui-icon></div></div><code class="">1   Customer#000000001   IVhzIApeRb           MOROCCO  0MOROCCO  AFRICA      25-705 
2   Customer#000000002   XSTf4,NCwDVaWNe6tE   JORDAN   6JORDAN   MIDDLE EAST 23-453
3   Customer#000000003   MG9kdTD              ARGENTINA5ARGENTINAAMERICA     11-783</code></pre>

                <p>A ordem dos pares de rótulo/largura deve corresponder exatamente à ordem das colunas da tabela. Para obter mais informações, consulte <a href="./copy-parameters-data-format.html#copy-fixedwidth">FIXEDWIDTH</a>.</p>
                <p>A seguir, a string de especificação de largura fixa dos dados da tabela CUSTOMER.</p>
                <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copiar"><awsui-icon name="copy"></awsui-icon></div></div><code class="">fixedwidth 'c_custkey:10, c_name:25, c_address:25, c_city:10, c_nation:15, 
c_region :12, c_phone:15,c_mktsegment:10'</code></pre>
                <p>Para carregar a tabela CUSTOMER de dados de largura fixa, execute o comando a seguir.</p>
                
                <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copiar"><awsui-icon name="copy"></awsui-icon></div></div><code class="nohighlight">copy customer
from 's3://<code class="replaceable">&lt;your-bucket-name&gt;</code>/load/customer-fw.tbl'
credentials 'aws_iam_role=arn:aws:iam::<code class="replaceable">&lt;aws-account-id&gt;</code>:role/<code class="replaceable">&lt;role-name&gt;</code>' 
fixedwidth 'c_custkey:10, c_name:25, c_address:25, c_city:10, c_nation:15, c_region :12, c_phone:15,c_mktsegment:10';</code></pre>
                
                <p>Você deve receber uma mensagem de erro, semelhante à mensagem a seguir.</p>
                <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copiar"><awsui-icon name="copy"></awsui-icon></div></div><code class="">An error occurred when executing the SQL command:
copy customer
from 's3://mybucket/load/customer-fw.tbl'
credentials'...

ERROR: Load into table 'customer' failed.  Check 'stl_load_errors' system table for details. [SQL State=XX000] 

Execution time: 2.95s

1 statement(s) failed.</code></pre>
                 
                    <h6>MAXERROR</h6>
                    <p>Por padrão, a primeira vez em que COPY encontra um erro, o comando falha e retorna uma mensagem de erro. Para economizar tempo durante testes, você pode usar a opção MAXERROR para instruir COPY a ignorar um número especificado de erros antes de falhar. Como esperamos erros na primeira vez em que testamos o carregamento dos dados da tabela CUSTOMER, adicionamos <code class="code">maxerror 10</code> ao comando COPY. </p>
                 
                <p>Para testar usando as opções FIXEDWIDTH e MAXERROR, execute o comando a seguir.</p>
                
                <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copiar"><awsui-icon name="copy"></awsui-icon></div></div><code class="nohighlight">copy customer
from 's3://<code class="replaceable">&lt;your-bucket-name&gt;</code>/load/customer-fw.tbl'
credentials 'aws_iam_role=arn:aws:iam::<code class="replaceable">&lt;aws-account-id&gt;</code>:role/<code class="replaceable">&lt;role-name&gt;</code>' 
fixedwidth 'c_custkey:10, c_name:25, c_address:25, c_city:10, c_nation:15, c_region :12, c_phone:15,c_mktsegment:10'
maxerror 10;</code></pre>
                
                <p>Desta vez, em vez de uma mensagem de erro, você recebe uma mensagem de aviso semelhante à que se segue.</p>
                <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copiar"><awsui-icon name="copy"></awsui-icon></div></div><code class="">Warnings:
Load into table 'customer' completed, 112497 record(s) loaded successfully.
Load into table 'customer' completed, 7 record(s) could not be loaded.  Check 'stl_load_errors' system table for details.</code></pre>
                <p>O aviso indica que COPY encontrou sete erros. Para verificar erros, consulte a tabela STL_LOAD_ERRORS, conforme mostrado no exemplo a seguir.</p>
                <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copiar"><awsui-icon name="copy"></awsui-icon></div></div><code class="">select query, substring(filename,22,25) as filename,line_number as line, 
substring(colname,0,12) as column, type, position as pos, substring(raw_line,0,30) as line_text,
substring(raw_field_value,0,15) as field_text, 
substring(err_reason,0,45) as error_reason
from stl_load_errors 
order by query desc, filename 
limit 7;</code></pre>
                <p>Os resultados da consulta STL_LOAD_ERRORS devem ser semelhantes aos resultados a seguir.</p>
                <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copiar"><awsui-icon name="copy"></awsui-icon></div></div><code class=""> query  |         filename          | line |  column   |    type    | pos |           line_text           | field_text |              error_reason
--------+---------------------------+------+-----------+------------+-----+-------------------------------+------------+----------------------------------------------
 334489 | customer-fw.tbl.log       |    2 | c_custkey | int4       |  -1 | customer-fw.tbl               | customer-f | Invalid digit, Value 'c', Pos 0, Type: Integ
 334489 | customer-fw.tbl.log       |    6 | c_custkey | int4       |  -1 | Complete                      | Complete   | Invalid digit, Value 'C', Pos 0, Type: Integ
 334489 | customer-fw.tbl.log       |    3 | c_custkey | int4       |  -1 | #Total rows                   | #Total row | Invalid digit, Value '#', Pos 0, Type: Integ
 334489 | customer-fw.tbl.log       |    5 | c_custkey | int4       |  -1 | #Status                       | #Status    | Invalid digit, Value '#', Pos 0, Type: Integ
 334489 | customer-fw.tbl.log       |    1 | c_custkey | int4       |  -1 | #Load file                    | #Load file | Invalid digit, Value '#', Pos 0, Type: Integ
 334489 | customer-fw.tbl000        |    1 | c_address | varchar    |  34 | 1         Customer#000000001  | .Mayag.ezR | String contains invalid or unsupported UTF8
 334489 | customer-fw.tbl000        |    1 | c_address | varchar    |  34 | 1         Customer#000000001  | .Mayag.ezR | String contains invalid or unsupported UTF8
(7 rows)</code></pre>
                <p>Examinando os resultados, você pode ver que existem duas mensagens na coluna <code class="code">error_reasons</code>:</p>
                <div class="itemizedlist">
                     
                     
                <ul class="itemizedlist"><li class="listitem">
                        <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copiar"><awsui-icon name="copy"></awsui-icon></div></div><code class="">Invalid digit, Value '#', Pos 0, Type: Integ </code></pre>
                        <p>Esses erros são causados pelo arquivo <code class="code">customer-fw.tbl.log</code>. O problema é que se trata de um arquivo de log, não um arquivo de dados, e não deve ser carregado. Você pode usar um arquivo manifesto para evitar carregar o arquivo errado. </p>
                    </li><li class="listitem">
                        <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copiar"><awsui-icon name="copy"></awsui-icon></div></div><code class="">String contains invalid or unsupported UTF8 </code></pre>
                        <p>O tipo de dados VARCHAR dá suporte a caracteres UTF-8 multibyte até três bytes. Se os dados de carga contiverem caracteres incompatíveis ou inválidos, você poderá usar a opção ACCEPTINVCHARS para substituir cada caractere inválido por um caractere alternativo especificado.</p>
                    </li></ul></div>
                <p>Outro problema com a carga é mais difícil de detectar — a carga produziu resultados inesperados. Para investigar esse problema, execute o comando a seguir para consultar a tabela CUSTOMER.</p>
                <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copiar"><awsui-icon name="copy"></awsui-icon></div></div><code class="">select c_custkey, c_name, c_address        
from customer
order by c_custkey
limit 10;
</code></pre>
                <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copiar"><awsui-icon name="copy"></awsui-icon></div></div><code class=""> c_custkey |          c_name           |         c_address
-----------+---------------------------+---------------------------
         2 | Customer#000000002        | XSTf4,NCwDVaWNe6tE
         2 | Customer#000000002        | XSTf4,NCwDVaWNe6tE
         3 | Customer#000000003        | MG9kdTD
         3 | Customer#000000003        | MG9kdTD
         4 | Customer#000000004        | XxVSJsL
         4 | Customer#000000004        | XxVSJsL
         5 | Customer#000000005        | KvpyuHCplrB84WgAi
         5 | Customer#000000005        | KvpyuHCplrB84WgAi
         6 | Customer#000000006        | sKZz0CsnMD7mp4Xd0YrBvx
         6 | Customer#000000006        | sKZz0CsnMD7mp4Xd0YrBvx
(10 rows)</code></pre>
                <p>As linhas devem ser exclusivas, mas há duplicações. </p>
                <p>Outra maneira de verificar se há resultados inesperados é consultar o número de linhas que foram carregadas. Em nosso caso, 100.000 linhas devem ter sido carregadas, mas a mensagem de carga relatou o carregamento de 112.497. As linhas extra foram carregadas porque COPY carregou um arquivo estranho, <code class="code">customer-fw.tbl0000.bak</code>. </p>
                <p>Neste exercício, você usa um arquivo manifesto para evitar carregar os arquivos errados. </p>
                 
                    <h6>ACCEPTINVCHARS</h6>
                    <p>Por padrão, quando encontra um caractere que não seja compatível com o tipo de dados da coluna, COPY ignora a linha retorna um erro. Para obter informações sobre caracteres UTF-8 inválidos, consulte <a href="./multi-byte-character-load-errors.html">Erros no carregamento de caracteres multibyte</a>. </p>
                 
                <p>Você pode usar a opção MAXERRORS para ignorar erros e continuar carregando, a consulta STL_LOAD_ERRORS para localizar os caracteres inválidos e corrigir os arquivos de dados. Porém, MAXERRORS é mais bem usado na solução de problemas de carga e normalmente não deve ser usado em um ambiente de produção. </p>
                <p>A opção ACCEPTINVCHARS normalmente é uma opção melhor para gerenciar caracteres inválidos. ACCEPTINVCHARS orienta COPY a substituir cada caractere inválido por um caractere válido especificado e continuar a operação de carga. Você pode especificar qualquer caractere ASCII válido, exceto NULL, como o caractere substituto. O caractere de substituição padrão é um ponto de interrogação (? ). COPY substitui caracteres multibyte por uma string de substituição de comprimento igual. Por exemplo, um caractere de 4 bytes seria substituído por <code class="code">'????'</code>. </p>
                <p>COPY retorna o número de linhas que continham caracteres UTF-8 errados. Ele também adiciona uma entrada à tabela STL_REPLACEMENTS para cada linha afetada, até um máximo de 100 linhas por fatia de nó. Os caracteres UTF-8 inválidos adicionais também são substituídos, mas esses eventos substitutos não são registrados. </p>
                <p>ACCEPTINVCHARS só é válido para colunas VARCHAR. </p>
                <p>Para esta etapa, você adiciona o ACCEPTINVCHARS com o caractere de substituição <code class="code">'^'</code>. </p>
                 
                    <h6>MANIFEST</h6>
                    <p>Quando você COPY do Amazon S3 usando um prefixo das chave, há o risco de carregar tabelas indesejadas. Por exemplo, a pasta <code class="code">'s3://mybucket/load/</code> contém oito arquivos de dados que compartilham o prefixo de chaves <code class="code">customer-fw.tbl</code>: <code class="code">customer-fw.tbl0000</code>, <code class="code">customer-fw.tbl0001</code> e assim por diante. Porém, a mesma pasta também contém arquivos estranhos <code class="code">customer-fw.tbl.log</code> e <code class="code">customer-fw.tbl-0001.bak</code>. </p>
                 
                <p>Para garantir que você carregue todos os arquivos corretos, e somente os corretos, use um arquivo manifesto. Manifesto é um arquivo de texto em formato JSON que lista explicitamente a chave de objeto exclusiva para cada arquivo de origem a ser carregado. Os objetos de arquivo podem estar em pastas ou em buckets diferentes, mas devem estar na mesma região. Para obter mais informações, consulte <a href="./copy-parameters-data-source-s3.html#copy-manifest">MANIFEST</a>.</p>
                <p>A seguir, o texto <code class="code">customer-fw-manifest</code>. </p>
                <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copiar"><awsui-icon name="copy"></awsui-icon></div></div><code class="nohighlight"><span>{</span>
  "entries": [
    <span>{</span>"url":"s3://<code class="replaceable">&lt;your-bucket-name&gt;</code>/load/customer-fw.tbl-000"},
    <span>{</span>"url":"s3://<code class="replaceable">&lt;your-bucket-name&gt;</code>/load/customer-fw.tbl-001"},
    <span>{</span>"url":"s3://<code class="replaceable">&lt;your-bucket-name&gt;</code>/load/customer-fw.tbl-002"},
    <span>{</span>"url":"s3://<code class="replaceable">&lt;your-bucket-name&gt;</code>/load/customer-fw.tbl-003"},
    <span>{</span>"url":"s3://<code class="replaceable">&lt;your-bucket-name&gt;</code>/load/customer-fw.tbl-004"},    
    <span>{</span>"url":"s3://<code class="replaceable">&lt;your-bucket-name&gt;</code>/load/customer-fw.tbl-005"},
    <span>{</span>"url":"s3://<code class="replaceable">&lt;your-bucket-name&gt;</code>/load/customer-fw.tbl-006"}, 
    <span>{</span>"url":"s3://<code class="replaceable">&lt;your-bucket-name&gt;</code>/load/customer-fw.tbl-007"} 
    ]
}</code></pre>
                <div class="procedure"><h6>Para carregar os dados da tabela CUSTOMER usando o arquivo manifesto</h6><ol><li>
                        <p>Abra o arquivo <code class="code">customer-fw-manifest</code> em um editor de texto.</p>
                    </li><li>
                        <p>Substitua <code class="replaceable">&lt;your-bucket-name&gt;</code> pelo nome do seu bucket.</p>
                    </li><li>
                        <p>Salve o arquivo.</p>
                    </li><li>
                        <p>Faça upload do arquivo na pasta de carga do bucket.</p>
                    </li><li>
                        <p>Execute o comando COPY a seguir.</p>
                        
                        <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copiar"><awsui-icon name="copy"></awsui-icon></div></div><code class="nohighlight">copy customer from 's3://<code class="replaceable">&lt;your-bucket-name&gt;</code>/load/customer-fw-manifest'
credentials 'aws_iam_role=arn:aws:iam::<code class="replaceable">&lt;aws-account-id&gt;</code>:role/<code class="replaceable">&lt;role-name&gt;</code>' 
fixedwidth 'c_custkey:10, c_name:25, c_address:25, c_city:10, c_nation:15, c_region :12, c_phone:15,c_mktsegment:10'
maxerror 10 
acceptinvchars as '^'
manifest;</code></pre>
                        
                    </li></ol></div>
             
             
                <h3 id="tutorial-loading-load-dwdate">Carregar a tabela DWDATE usando DATEFORMAT</h3>

                <p>Nesta etapa, você usa as opções DELIMITER e DATEFORMAT para carregar a tabela DWDATE.</p>
                
                <p>Ao carregar as colunas DATE e TIMESTAMP, COPY espera o formato padrão, que é AAAA-MM-DD para datas e AAAA-MM-DD HH:MI SS para timestamps. Se os dados de carga não usarem um formato padrão, você poderá usar DATEFORMAT e TIMEFORMAT para especificar o formato. </p>
                <p>O trecho a seguir mostra formatos de data na tabela DWDATE. Observe que os formatos de data na coluna dois são inconsistentes.</p>
                <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copiar"><awsui-icon name="copy"></awsui-icon></div></div><code class="">19920104	1992-01-04          Sunday		January	1992	199201	Jan1992	1	4	4	1...
19920112	January 12, 1992	Monday		January	1992	199201	Jan1992	2	12	12	1...
19920120	January 20, 1992	Tuesday	    January	1992	199201	Jan1992	3	20	20	1...</code></pre>
                 
                    <h6>DATEFORMAT</h6>
                    <p>Você pode especificar somente um formato de data. Se os dados de carga contiverem formatos inconsistentes, possivelmente em colunas diferentes, ou se o formato não for conhecido no tempo de carregamento, você usará DATEFORMAT com o argumento <code class="code">'auto'</code>. Quando <code class="code">'auto'</code> for especificado, COPY reconhece qualquer formato de data ou hora válido e o converterá no formato padrão. A opção <code class="code">'auto'</code> reconhece diversos formatos não compatíveis ao usar uma string DATEFORMAT e TIMEFORMAT. Para obter mais informações, consulte <a href="./automatic-recognition.html">Usar o reconhecimento automático com DATEFORMAT e TIMEFORMAT</a>. </p>
                 
                <p>Para carregar a tabela DWDATE, execute o comando COPY a seguir.</p>
                <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copiar"><awsui-icon name="copy"></awsui-icon></div></div><code class="nohighlight">copy dwdate from 's3://<code class="replaceable">&lt;your-bucket-name&gt;</code>/load/dwdate-tab.tbl'
credentials 'aws_iam_role=arn:aws:iam::<code class="replaceable">&lt;aws-account-id&gt;</code>:role/<code class="replaceable">&lt;role-name&gt;</code>' 
delimiter '\t' 
dateformat 'auto';</code></pre>
                
             
             
                <h3 id="tutorial-loading-load-lineorder">Carregar a tabela LINEORDER usando vários arquivos</h3>

                <p>Esta etapa usa as opções GZIP e COMPUPDATE para carregar a tabela LINEORDER.</p>
                <p>Neste exercício, você carrega a tabela LINEORDER de um único arquivo de dados e recarrega-a de vários arquivos. Isso permite comparar os tempos de carregamento dos dois métodos. </p>
                <div class="awsdocs-note"><div class="awsdocs-note-title"><awsui-icon name="status-info" variant="link"></awsui-icon><h6>nota</h6></div><div class="awsdocs-note-text"><p>Os arquivos para carregar a tabela LINEORDER são fornecidos em um bucket de amostra AWS. Você não precisa fazer upload de arquivos nesta etapa.</p></div></div>
                 
                    <h6>GZIP, LZOP e BZIP2</h6>
                    <p>Você pode compactar os arquivos usando os formatos de compactação gzip, lzop ou bzip2. Ao carregar de arquivos compactados, COPY descompacta os arquivos durante o processo de carga. Compactar os arquivos economiza espaço de armazenamento e encurta tempos de upload. </p>
                 
                 
                    <h6>COMPUPDATE</h6>
                    <p>Quando carrega uma tabela vazia sem codificações de compactação, COPY analisa os dados de carga para determinar as codificações ideais. Em seguida, ele altera a tabela para usar essas codificações antes de iniciar a carga. Esse processo de análise demora, mas ocorre, no máximo, uma vez por tabela. Para economizar tempo, você pode ignorar esta etapa desativando COMPUPDATE. Para permitir uma avaliação precisa dos tempos de COPY, você desativa COMPUPDATE para esta etapa.</p>
                 
                 
                    <h6>Vários arquivos</h6>
                    <p>O comando COPY pode carregar dados de maneira muito eficiente ao carregar de vários arquivos em paralelo, em vez de carregar de um único arquivo. É possível dividir seus dados em arquivos de modo que o número de arquivos seja um múltiplo do número de fatias em seu cluster. Se você fizer isso, o Amazon Redshift dividirá o workload e distribuirá os dados uniformemente entre as fatias. O número de fatias por nó depende do tamanho do nó do cluster. Para obter mais informações sobre o número de fatias que cada tamanho de nó possui, acesse “<a href="https://docs.aws.amazon.com/redshift/latest/mgmt/working-with-clusters.html#rs-about-clusters-and-nodes">Clusters e nós no Amazon Redshift</a>” no <em>Guia de gerenciamento de clusters do Amazon Redshift</em>.</p>
                 
                <p>Por exemplo, os nós de computação dc2.large usados neste tutorial têm duas fatias cada, portanto, o cluster de quatro nós tem oito fatias. Em etapas anteriores, os dados da carga estavam contidos em oito arquivos, mesmo que os arquivos fossem muito pequenos. Nesta etapa, você compara a diferença de tempo entre o carregamento de um único arquivo grande e o carregamento de vários arquivos. </p>
                <p>Os arquivos que você usa neste tutorial contêm aproximadamente 15 milhões de registros e ocupam cerca de 1,2 GB. Esses arquivos são muito pequenos na escala do Amazon Redshift, mas suficientes para demonstrar a vantagem de performance do carregamento de vários arquivos. Os arquivos são grandes o suficiente para que o tempo necessário para baixá-los e carregá-los no Amazon S3 seja excessivo para este tutorial. Portanto, você carrega os arquivos diretamente de um bucket de exemplo da AWS. </p>
                <p>A captura de tela a seguir mostra os arquivos de dados de LINEORDER.</p>

                <div class="mediaobject">
                     
                        <img src="images/tutorial-load-lineorder-files.png" class="aws-docs-img-whiteBg aws-docs-img-padding" />
                     
                </div>
                <div class="procedure"><h6>Para avaliar a performance de COPY com vários arquivos</h6><ol><li>
                        <p>Execute o comando a seguir para executar COPY de um único arquivo. Não altere o nome do bucket.</p>
                        
                        <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copiar"><awsui-icon name="copy"></awsui-icon></div></div><code class="nohighlight">copy lineorder from 's3://awssampledb/load/lo/lineorder-single.tbl' 
credentials 'aws_iam_role=arn:aws:iam::<code class="replaceable">&lt;aws-account-id&gt;</code>:role/<code class="replaceable">&lt;role-name&gt;</code>' 
gzip
compupdate off
region 'us-east-1';</code></pre>
                        
                    </li><li>
                        <p>Os resultados devem ser semelhantes aos que se seguem. Observe o tempo de execução.</p>
                        <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copiar"><awsui-icon name="copy"></awsui-icon></div></div><code class="">Warnings:
Load into table 'lineorder' completed, 14996734 record(s) loaded successfully.

0 row(s) affected.
copy executed successfully

Execution time: 51.56s</code></pre>
                    </li><li>
                        <p>Execute o comando a seguir para executar COPY de vários arquivos. Não altere o nome do bucket.</p>
                        
                        <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copiar"><awsui-icon name="copy"></awsui-icon></div></div><code class="nohighlight">copy lineorder from 's3://awssampledb/load/lo/lineorder-multi.tbl' 
credentials 'aws_iam_role=arn:aws:iam::<code class="replaceable">&lt;aws-account-id&gt;</code>:role/<code class="replaceable">&lt;role-name&gt;</code>' 
gzip
compupdate off
region 'us-east-1';
</code></pre>
                        
                    </li><li>
                        <p>Os resultados devem ser semelhantes aos que se seguem. Observe o tempo de execução.</p>
                        <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copiar"><awsui-icon name="copy"></awsui-icon></div></div><code class="">Warnings:
Load into table 'lineorder' completed, 14996734 record(s) loaded successfully.

0 row(s) affected.
copy executed successfully

Execution time: 17.7s</code></pre>
                    </li><li>
                        <p>Compare tempos de execução.</p>
                        <p>No exemplo, o tempo para carregar 15 milhões de registros diminuiu de 51,56 segundos para 17,7 segundos, uma redução de 65,7%. </p>
                        <p>Esses resultados se baseiam no uso de um cluster de quatro nós. Se o cluster tiver mais nós, o tempo economizado será multiplicado. Para clusters típicos do Amazon Redshift, com dezenas a centenas de nós, a diferença é ainda mais dramática. Se você tiver um único cluster de nó, haverá pouca diferença entre os tempos de execução. </p>
                    </li></ol></div>
             
             
                <h3 id="tutorial-loading-next-step6">Próxima etapa</h3>

                <p><a href="./tutorial-loading-data-vacuum.html">Etapa 6: Vacuum e análise do banco de dados</a></p>
             
        <awsdocs-copyright class="copyright-print"></awsdocs-copyright><awsdocs-thumb-feedback right-edge="{{$ctrl.thumbFeedbackRightEdge}}"></awsdocs-thumb-feedback></div><noscript><div><div><div><div id="js_error_message"><p><img src="https://d1ge0kk1l5kms0.cloudfront.net/images/G/01/webservices/console/warning.png" alt="Atenção" /> <strong>O Javascript está desativado ou não está disponível no seu navegador.</strong></p><p>Para usar a documentação da AWS, o Javascript deve estar ativado. Consulte as páginas de Ajuda do navegador para obter instruções.</p></div></div></div></div></noscript><div id="main-col-footer" class="awsui-util-font-size-0"><div id="doc-conventions"><a target="_top" href="/general/latest/gr/docconventions.html">Convenções do documento</a></div><div class="prev-next"><div id="previous" class="prev-link" accesskey="p" href="./tutorial-loading-data-create-tables.html">Etapa 4: Criar as tabelas de exemplo</div><div id="next" class="next-link" accesskey="n" href="./tutorial-loading-data-vacuum.html">Etapa 6: Vacuum e análise do banco de dados</div></div></div><awsdocs-page-utilities></awsdocs-page-utilities></div><div id="quick-feedback-yes" style="display: none;"><div class="title">Essa página foi útil? - Sim</div><div class="content"><p>Obrigado por nos informar que estamos fazendo um bom trabalho!</p><p>Se tiver tempo, conte-nos sobre o que você gostou para que possamos melhorar ainda mais.</p><p><awsui-button id="fblink" rel="noopener noreferrer" target="_blank" text="Feedback" click="linkClick($event)" href="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=Redshift&amp;topic_url=https://docs.aws.amazon.com/pt_br/redshift/latest/dg/tutorial-loading-run-copy.html"></awsui-button></p></div></div><div id="quick-feedback-no" style="display: none;"><div class="title">Essa página foi útil? - Não</div><div class="content"><p>Obrigado por nos informar que precisamos melhorar a página. Lamentamos ter decepcionado você.</p><p>Se tiver tempo, conte-nos como podemos melhorar a documentação.</p><p><awsui-button id="fblink" rel="noopener noreferrer" target="_blank" text="Feedback" click="linkClick($event)" href="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=Redshift&amp;topic_url=https://docs.aws.amazon.com/pt_br/redshift/latest/dg/tutorial-loading-run-copy.html"></awsui-button></p></div></div></div></body></div></awsdocs-view><div class="page-loading-indicator" id="page-loading-indicator"><awsui-spinner size="large"></awsui-spinner></div></div><div id="tools-panel" dom-region="tools"><awsdocs-tools-panel id="awsdocs-tools-panel"></awsdocs-tools-panel></div></awsui-app-layout><awsdocs-cookie-banner class="doc-cookie-banner"></awsdocs-cookie-banner></div></body></html>