<!DOCTYPE html>
    <html xmlns="http://www.w3.org/1999/xhtml" lang="pt-BR"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>CREATE EXTERNAL FUNCTION - Amazon Redshift</title><meta name="viewport" content="width=device-width,initial-scale=1" /><meta name="assets_root" content="/assets" /><meta name="target_state" content="r_CREATE_EXTERNAL_FUNCTION" /><meta name="default_state" content="r_CREATE_EXTERNAL_FUNCTION" /><link rel="icon" type="image/ico" href="/assets/images/favicon.ico" /><link rel="shortcut icon" type="image/ico" href="/assets/images/favicon.ico" /><link rel="canonical" href="https://docs.aws.amazon.com/pt_br/redshift/latest/dg/r_CREATE_EXTERNAL_FUNCTION.html" /><meta name="description" content="Cria uma função definida pelo usuário (UDF) escalar baseada em AWS Lambda para o Amazon Redshift." /><meta name="deployment_region" content="IAD" /><meta name="product" content="Amazon Redshift" /><meta name="guide" content="Guia do desenvolvedor de banco de dados" /><meta name="abstract" content="Crie e gerencie um data warehouse com o Amazon Redshift, um serviço de data warehouse totalmente gerenciado, em escala de petabyte e de nível empresarial." /><meta name="guide-locale" content="pt_br" /><meta name="tocs" content="toc-contents.json" /><link rel="canonical" href="https://docs.aws.amazon.com/pt_br/redshift/latest/dg/r_CREATE_EXTERNAL_FUNCTION.html" /><link rel="alternative" href="https://docs.aws.amazon.com/id_id/redshift/latest/dg/r_CREATE_EXTERNAL_FUNCTION.html" hreflang="id-id" /><link rel="alternative" href="https://docs.aws.amazon.com/id_id/redshift/latest/dg/r_CREATE_EXTERNAL_FUNCTION.html" hreflang="id" /><link rel="alternative" href="https://docs.aws.amazon.com/de_de/redshift/latest/dg/r_CREATE_EXTERNAL_FUNCTION.html" hreflang="de-de" /><link rel="alternative" href="https://docs.aws.amazon.com/de_de/redshift/latest/dg/r_CREATE_EXTERNAL_FUNCTION.html" hreflang="de" /><link rel="alternative" href="https://docs.aws.amazon.com/redshift/latest/dg/r_CREATE_EXTERNAL_FUNCTION.html" hreflang="en-us" /><link rel="alternative" href="https://docs.aws.amazon.com/redshift/latest/dg/r_CREATE_EXTERNAL_FUNCTION.html" hreflang="en" /><link rel="alternative" href="https://docs.aws.amazon.com/es_es/redshift/latest/dg/r_CREATE_EXTERNAL_FUNCTION.html" hreflang="es-es" /><link rel="alternative" href="https://docs.aws.amazon.com/es_es/redshift/latest/dg/r_CREATE_EXTERNAL_FUNCTION.html" hreflang="es" /><link rel="alternative" href="https://docs.aws.amazon.com/fr_fr/redshift/latest/dg/r_CREATE_EXTERNAL_FUNCTION.html" hreflang="fr-fr" /><link rel="alternative" href="https://docs.aws.amazon.com/fr_fr/redshift/latest/dg/r_CREATE_EXTERNAL_FUNCTION.html" hreflang="fr" /><link rel="alternative" href="https://docs.aws.amazon.com/it_it/redshift/latest/dg/r_CREATE_EXTERNAL_FUNCTION.html" hreflang="it-it" /><link rel="alternative" href="https://docs.aws.amazon.com/it_it/redshift/latest/dg/r_CREATE_EXTERNAL_FUNCTION.html" hreflang="it" /><link rel="alternative" href="https://docs.aws.amazon.com/ja_jp/redshift/latest/dg/r_CREATE_EXTERNAL_FUNCTION.html" hreflang="ja-jp" /><link rel="alternative" href="https://docs.aws.amazon.com/ja_jp/redshift/latest/dg/r_CREATE_EXTERNAL_FUNCTION.html" hreflang="ja" /><link rel="alternative" href="https://docs.aws.amazon.com/ko_kr/redshift/latest/dg/r_CREATE_EXTERNAL_FUNCTION.html" hreflang="ko-kr" /><link rel="alternative" href="https://docs.aws.amazon.com/ko_kr/redshift/latest/dg/r_CREATE_EXTERNAL_FUNCTION.html" hreflang="ko" /><link rel="alternative" href="https://docs.aws.amazon.com/pt_br/redshift/latest/dg/r_CREATE_EXTERNAL_FUNCTION.html" hreflang="pt-br" /><link rel="alternative" href="https://docs.aws.amazon.com/pt_br/redshift/latest/dg/r_CREATE_EXTERNAL_FUNCTION.html" hreflang="pt" /><link rel="alternative" href="https://docs.aws.amazon.com/zh_cn/redshift/latest/dg/r_CREATE_EXTERNAL_FUNCTION.html" hreflang="zh-cn" /><link rel="alternative" href="https://docs.aws.amazon.com/zh_tw/redshift/latest/dg/r_CREATE_EXTERNAL_FUNCTION.html" hreflang="zh-tw" /><link rel="alternative" href="https://docs.aws.amazon.com/redshift/latest/dg/r_CREATE_EXTERNAL_FUNCTION.html" hreflang="x-default" /><meta name="feedback-item" content="Redshift" /><meta name="this_doc_product" content="Amazon Redshift" /><meta name="this_doc_guide" content="Guia do desenvolvedor de banco de dados" /><script defer="" src="/assets/r/vendor4.js?version=2021.12.02"></script><script defer="" src="/assets/r/vendor3.js?version=2021.12.02"></script><script defer="" src="/assets/r/vendor1.js?version=2021.12.02"></script><script defer="" src="/assets/r/awsdocs-common.js?version=2021.12.02"></script><script defer="" src="/assets/r/awsdocs-doc-page.js?version=2021.12.02"></script><link href="/assets/r/vendor4.css?version=2021.12.02" rel="stylesheet" /><link href="/assets/r/awsdocs-common.css?version=2021.12.02" rel="stylesheet" /><link href="/assets/r/awsdocs-doc-page.css?version=2021.12.02" rel="stylesheet" /><script async="" id="awsc-panorama-bundle" type="text/javascript" src="https://prod.pa.cdn.uis.awsstatic.com/panorama-nav-init.js" data-config="{'appEntity':'aws-documentation','region':'us-east-1','service':'redshift'}"></script><meta id="panorama-serviceSubSection" value="Guia do desenvolvedor de banco de dados" /><meta id="panorama-serviceConsolePage" value="CREATE EXTERNAL FUNCTION" /></head><body class="awsdocs awsui"><div class="awsdocs-container"><awsdocs-header></awsdocs-header><awsui-app-layout id="app-layout" class="awsui-util-no-gutters" ng-controller="ContentController as $ctrl" header-selector="awsdocs-header" navigation-hide="false" navigation-width="$ctrl.navWidth" navigation-open="$ctrl.navOpen" navigation-change="$ctrl.onNavChange($event)" tools-hide="$ctrl.hideTools" tools-width="$ctrl.toolsWidth" tools-open="$ctrl.toolsOpen" tools-change="$ctrl.onToolsChange($event)"><div id="guide-toc" dom-region="navigation"><awsdocs-toc></awsdocs-toc></div><div id="main-column" dom-region="content" tabindex="-1"><awsdocs-view class="awsdocs-view"><div id="awsdocs-content"><head><title>CREATE EXTERNAL FUNCTION - Amazon Redshift</title><meta name="pdf" content="redshift-dg.pdf#r_CREATE_EXTERNAL_FUNCTION" /><meta name="rss" content="Dochistory.rss" /><meta name="forums" content="http://forums.aws.amazon.com/forum.jspa?forumID=155" /><meta name="feedback" content="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=Redshift&amp;topic_url=https://docs.aws.amazon.com/pt_br/redshift/latest/dg/r_CREATE_EXTERNAL_FUNCTION.html" /><meta name="feedback-yes" content="feedbackyes.html?topic_url=https://docs.aws.amazon.com/pt_br/redshift/latest/dg/r_CREATE_EXTERNAL_FUNCTION.html" /><meta name="feedback-no" content="feedbackno.html?topic_url=https://docs.aws.amazon.com/pt_br/redshift/latest/dg/r_CREATE_EXTERNAL_FUNCTION.html" /><meta name="keywords" content="Amazon Redshift,AWS Redshift,Redshift,Redshift Spectrum,cluster,data warehouse,desenvolvedor,dados de amostra,banco de dados,desenvolvedor do banco de dados,HLL" /><script type="application/ld+json">
{
    "@context" : "https://schema.org",
    "@type" : "BreadcrumbList",
    "itemListElement" : [
      {
        "@type" : "ListItem",
        "position" : 1,
        "name" : "AWS",
        "item" : "https://aws.amazon.com"
      },
      {
        "@type" : "ListItem",
        "position" : 2,
        "name" : "Amazon Redshift",
        "item" : "https://docs.aws.amazon.com/redshift/index.html"
      },
      {
        "@type" : "ListItem",
        "position" : 3,
        "name" : "Guia do desenvolvedor de banco de dados",
        "item" : "https://docs.aws.amazon.com/pt_br/redshift/latest/dg"
      },
      {
        "@type" : "ListItem",
        "position" : 4,
        "name" : "Referência SQL",
        "item" : "https://docs.aws.amazon.com/pt_br/redshift/latest/dg/cm_chap_SQLCommandRef.html"
      },
      {
        "@type" : "ListItem",
        "position" : 5,
        "name" : "Comandos SQL",
        "item" : "https://docs.aws.amazon.com/pt_br/redshift/latest/dg/c_SQL_commands.html"
      },
      {
        "@type" : "ListItem",
        "position" : 6,
        "name" : "CREATE EXTERNAL FUNCTION",
        "item" : "https://docs.aws.amazon.com/pt_br/redshift/latest/dg/c_SQL_commands.html"
      }
    ]
}
</script></head><body><div id="main"><div style="display: none"><a href="redshift-dg.pdf#r_CREATE_EXTERNAL_FUNCTION" target="_blank" rel="noopener noreferrer" title="Abrir em PDF"></a></div><div id="breadcrumbs" class="breadcrumb"><a href="https://aws.amazon.com">AWS</a><a href="/index.html">Documentação</a><a href="/redshift/index.html">Amazon Redshift</a><a href="welcome.html">Guia do desenvolvedor de banco de dados</a></div><div id="page-toc-src"><a href="#r_CREATE_EXTERNAL_FUNCTION-privileges">Privilégios obrigatórios</a><a href="#r_CREATE_EXTERNAL_FUNCTION-synopsis">Sintaxe</a><a href="#r_CREATE_EXTERNAL_FUNCTION-parameters">Parâmetros</a><a href="#r_CREATE_FUNCTION-usage-notes">Observações de uso</a><a href="#r_CREATE_FUNCTION-examples">Exemplos</a></div><div id="main-content" class="awsui-util-container"><div id="main-col-body"><awsdocs-language-banner data-service="$ctrl.pageService"></awsdocs-language-banner><h1 class="topictitle" id="r_CREATE_EXTERNAL_FUNCTION">CREATE EXTERNAL FUNCTION</h1><div class="awsdocs-page-header-container"><awsdocs-page-header></awsdocs-page-header><awsdocs-filter-selector id="awsdocs-filter-selector"></awsdocs-filter-selector></div><p>Cria uma função definida pelo usuário (UDF) escalar baseada em AWS Lambda para o Amazon Redshift. Para obter mais informações sobre as funções definidas pelo usuário do Lambda, consulte <a href="./udf-creating-a-lambda-sql-udf.html">Criar uma UDF do Lambda escalar</a>.</p>
         <h2 id="r_CREATE_EXTERNAL_FUNCTION-privileges">Privilégios obrigatórios</h2>
         <p>A seguir estão os privilégios necessários para CREATE EXTERNAL FUNCTION:</p>
         <div class="itemizedlist">
             
             
         <ul class="itemizedlist"><li class="listitem"><p>Superusuário</p></li><li class="listitem"><p>Usuários com o privilégio CREATE [ OR REPLACE ] EXTERNAL FUNCTION</p></li></ul></div>
       
         <h2 id="r_CREATE_EXTERNAL_FUNCTION-synopsis">Sintaxe</h2>

         <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copiar"><awsui-icon name="copy"></awsui-icon></div></div><code class="nohighlight">CREATE [ OR REPLACE ] EXTERNAL FUNCTION <em>external_fn_name</em> ( [<em>data_type</em>] [, ...] )
RETURNS <em>data_type</em>
<span>{</span> VOLATILE | STABLE }
LAMBDA <em>'lambda_fn_name'</em>
IAM_ROLE <span>{</span> default | ‘arn:aws:iam::<code class="replaceable">&lt;Conta da AWS-id&gt;</code>:role/<code class="replaceable">&lt;role-name&gt;</code>’
RETRY_TIMEOUT <em>milliseconds</em>
MAX_BATCH_ROWS count
MAX_BATCH_SIZE size [ KB | MB ];</code></pre>

         
         
         <p>A seguir está a sintaxe para Machine Learning no Amazon Redshift. Para obter informações sobre parâmetros específicos do modelo, consulte <a href="./r_GRANT.html#r_GRANT-parameters">Parâmetros</a>.</p>
         <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copiar"><awsui-icon name="copy"></awsui-icon></div></div><code class="nohighlight">CREATE [ OR REPLACE ] EXTERNAL FUNCTION <em>external_fn_name</em> ( [<em>data_type</em>] [, ...] )
RETURNS <em>data_type</em>
<span>{</span> VOLATILE | STABLE }
SAGEMAKER<em>'endpoint_name'</em>
IAM_ROLE <span>{</span> default | ‘arn:aws:iam::<code class="replaceable">&lt;Conta da AWS-id&gt;</code>:role/<code class="replaceable">&lt;role-name&gt;</code>’ };</code></pre>


       
         <h2 id="r_CREATE_EXTERNAL_FUNCTION-parameters">Parâmetros</h2>


         <div class="variablelist">
             
             
             
             
            
             
          

             
            
         

             

             
             
          
         <dl>
               <dt><span class="term">OR REPLACE</span></dt>
               <dd>
                  <p>Uma cláusula que especifica que se uma função com o mesmo nome e tipo de dados do argumento de entrada ou <em>assinatura</em> já existir, a função existente será substituída. Você só pode substituir uma função por uma nova função que defina um conjunto idêntico de tipos de dados. É preciso ser um superusuário para substituir uma função.</p>
                  <p>Se uma função for definida com o mesmo nome que uma função existente mas com uma assinatura diferente, uma nova função será criada. Em outras palavras, o nome da função fica sobrecarregado. Para obter mais informações, consulte <a href="./udf-naming-udfs.html#udf-naming-overloading-function-names">Sobrecarga de nomes de função</a>.</p>
               </dd>
             
               <dt><span class="term"><em>external_fn_name</em></span></dt>
               <dd>
                  <p>O nome da função externa. Se você especificar um nome de esquema (como myschema.myfunction), a função será criada usando o esquema especificado. Caso contrário, a função será criada no esquema atual. Para obter mais informações sobre nomes válidos, consulte <a href="./r_names.html">Nomes e identificadores</a>. </p>
                  <p>Recomendamos que você prefixe os nomes de todos os UDF com <code class="code">f_</code>. O Amazon Redshift reserva o prefixo <code class="code">f_</code> para nomes UDF. Usando o prefixo <code class="code">f_</code>, você ajuda a garantir que o nome de seu UDF não entrará em conflito com qualquer nome de função SQL integrada do Amazon Redshift agora ou no futuro. Para obter mais informações, consulte <a href="./udf-naming-udfs.html">Nomeação de UDFs</a>.</p>
               </dd>
             
               <dt><span class="term"><em>data_type</em></span></dt>
               <dd>
                  <p>O tipo de dados dos argumentos de entrada. Para obter mais informações, consulte <a href="./c_Supported_data_types.html">Tipos de dados</a>.</p>
               </dd>
             
               <dt><span class="term">RETURNS <em>tipo_dados</em></span></dt>
               <dd>
                  <p>Tipo de dados do valor retornado pela função. O tipo de dados RETURNS pode ser qualquer tipo de dados padrão do Amazon Redshift. Para ter mais informações, consulte <a href="./udf-data-types.html">Tipos de dados da UDF Python</a>.</p>
               </dd>
             
               <dt><span class="term">VOLATILE | STABLE</span></dt>
               <dd>
                  <p>Informa o otimizador de consulta sobre a volatilidade da função. </p>
                  <p>Você terá a melhor otimização se rotular sua função com a categoria mais restrita de volatilidade válida para ela. Por ordem de nível de restrição, começando a partir da menos restrita, as categorias são:</p>
                  <div class="itemizedlist">
                       
                      
                  <ul class="itemizedlist"><li class="listitem">
                        <p>VOLATILE</p>
                     </li><li class="listitem">
                        <p>STABLE</p>
                     </li></ul></div>
                  <p>VOLATILE</p>
                  <p>Dados os mesmos argumentos, a função pode retornar resultados diferentes em chamadas sucessivas, mesmo para as linhas em uma única instrução. O otimizador de consultas não pode fazer suposições sobre o comportamento de uma função volátil. Uma consulta que usa uma função volátil deve reavaliar a função para cada entrada.</p>
                  <p>STABLE</p>
                  <p>Em vista dos mesmos argumentos, a função com certeza retorna os mesmos resultados em chamadas sucessivas processadas em uma única instrução. A função pode retornar resultados diferentes quando chamada em instruções diferentes. Essa categoria possibilita que o otimizador reduza o número de vezes que a função é chamada em uma única instrução.</p>
                  <p>Se a rigidez escolhida não for válida para a função, existe o risco de o otimizador ignorar  algumas chamadas com base nessa rigidez. Isso pode resultar em um conjunto de resultados incorreto.</p>
                  <p>No momento, a cláusula IMMUTABLE não é compatível com UDFs do Lambda.</p>
                  

               </dd>
             
               <dt><span class="term">LAMBDA <em>'lambda_fn_name'</em> </span></dt>
               <dd>
                  <p> O nome da função chamada pelo Amazon Redshift.</p>
                  <p>Para obter etapas para criar uma função AWS Lambda, consulte <a href="https://docs.aws.amazon.com/lambda/latest/dg/getting-started-create-function.html">Criar uma função do Lambda com o console</a> no <em>AWS LambdaGuia do desenvolvedor</em>.</p>
                 <p>Para obter informações sobre permissões necessárias para a função do Lambda, consulte <a href="https://docs.aws.amazon.com/lambda/latest/dg/lambda-permissions.html">Permissões do AWS Lambda</a> no <em>AWS LambdaGuia do desenvolvedor</em>.</p>

               </dd>
             
               <dt><span class="term">IAM_ROLE <span>{</span> default | ‘arn:aws:iam::<code class="replaceable">&lt;Conta da AWS-id&gt;</code>:role/<code class="replaceable">&lt;role-name&gt;</code>’ </span></dt>
               <dd>
                  <p>Use a palavra-chave padrão para que o Amazon Redshift use a função do IAM definida como padrão e associada ao cluster quando o comando CREATE EXTERNAL FUNCTION for executado.</p>
                  <p>Use o nome do recurso da Amazon (ARN) de uma função do IAM que seu cluster usa para autenticação e autorização. O comando CREATE EXTERNAL FUNCTION está autorizado a invocar funções do Lambda por meio desta função do IAM. Se o cluster tiver uma função do IAM existente com permissões para invocar funções do Lambda anexadas, você poderá substituir o ARN da função. Para obter mais informações, consulte <a href="./udf-creating-a-lambda-sql-udf.html#udf-lambda-authorization">Configurar o parâmetro de autorização para UDFs do Lambda</a>.</p>
                  <p>A seguir, a sintaxe do parâmetro IAM_ROLE.</p>
                  <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copiar"><awsui-icon name="copy"></awsui-icon></div></div><code class="nohighlight">IAM_ROLE 'arn:aws:iam::<em>aws-account-id</em>:role/<em>role-name</em>'</code></pre>
               </dd>
             
               <dt><span class="term">RETRY_TIMEOUT <em>milliseconds</em> </span></dt>
               <dd>
                  <p>A quantidade de tempo total em milissegundos que o Amazon Redshift usa para os atrasos em recuos de novas tentativas. </p>
                  <p>Em vez de tentar novamente imediatamente para quaisquer consultas com falha, o Amazon Redshift realiza backoffs e espera por um certo período de tempo entre novas tentativas. Em seguida, o Amazon Redshift tenta novamente a solicitação para executar novamente a consulta com falha até que a soma de todos os atrasos seja igual ou exceda o valor RETRY_TIMEOUT especificado. O valor padrão é 20.000 milissegundos.</p>
                  <p>Quando uma função do Lambda é chamada, o Amazon Redshift tenta novamente consultas que recebem erros como <code class="code">TooManyRequestsException</code>, <code class="code">EC2ThrottledException</code>, e<code class="code">ServiceException</code>. </p>
                  <p>Você pode definir o parâmetro RETRY_TIMEOUT como 0 milissegundos para evitar quaisquer tentativas para um Lambda UDF.</p>
               </dd>
             
               <dt><span class="term"><em>Contagem</em> de MAX_BATCH_ROWS</span></dt>
               <dd>
                  <p> O número máximo de linhas que o Amazon Redshift envia em uma única solicitação em lote para uma invocação do Lambda. </p>
                  <p> O valor mínimo desse parâmetro é 1. O valor máximo é INT_MAX, ou 2.147.483.647. </p>
                  <p> Esse parâmetro é opcional. O valor padrão é INT_MAX, ou 2.147.483.647. </p>
               </dd>
             
            <dt><span class="term"><em>Tamanho</em> de MAX_BATCH_SIZE [ KB | MB ] </span></dt>
            <dd>
               <p> O tamanho máximo da carga de dados que o Amazon Redshift envia em uma única solicitação em lote para uma invocação do Lambda. </p>
               <p> O valor mínimo desse parâmetro é 1 KB. O valor máximo é 5 MB. </p>
               <p> O valor padrão desse parâmetro é 5 MB. </p>
               <p> KB e MB são opcionais. Se você não definir a unidade de medida, o Amazon Redshift usará KB como padrão. </p>
            </dd>
         </dl></div>
       
         <h2 id="r_CREATE_FUNCTION-usage-notes">Observações de uso</h2>
         <p>Considere o seguinte ao criar UDFs do Lambda: </p>
         <div class="itemizedlist">
             
             
         <ul class="itemizedlist"><li class="listitem"><p>A ordem das chamadas da função do Lambda nos argumentos de entrada não é fixa nem garantida. Isso pode variar entre as instâncias de execução de consultas, dependendo da configuração do cluster.</p></li><li class="listitem"><p>Não é garantido que as funções sejam aplicadas a cada argumento de entrada somente uma vez. A interação entre o Amazon Redshift e o AWS Lambda pode levar a chamadas repetitivas com as mesmas entradas.</p></li></ul></div>
       
         <h2 id="r_CREATE_FUNCTION-examples">Exemplos</h2>
         <p>A seguir estão exemplos de uso de funções definidas pelo usuário (UDFs) do Lambda escalar.</p>
          
            <h3 id="r_CREATE_FUNCTION-lambda-example-node">Exemplo de UDF Lambda escalar usando uma função Node.js Lambda</h3>
            <p>O exemplo a seguir cria uma função externa chamada <code class="code">exfunc_sum</code> que leva dois inteiros como argumentos de entrada. Esta função retorna a soma como uma saída inteira. O nome da função do Lambda a ser chamada é <code class="code">lambda_sum</code>. A linguagem usada para essa função do Lambda é Node.js 12.x. Especifique a função do IAM. O exemplo usa <code class="code">'arn:aws:iam::123456789012:user/johndoe'</code> como a função do IAM.</p>
            
            <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copiar"><awsui-icon name="copy"></awsui-icon></div></div><code class="">CREATE EXTERNAL FUNCTION exfunc_sum(INT,INT)
RETURNS INT
VOLATILE
LAMBDA 'lambda_sum'
IAM_ROLE 'arn:aws:iam::123456789012:role/Redshift-Exfunc-Test';</code></pre>
            <p>A função do Lambda recebe a carga útil de solicitação e itera sobre cada linha. Todos os valores em uma única linha são adicionados para calcular a soma dessa linha, que é salva na matriz de resposta. O número de linhas na matriz de resultados é semelhante ao número de linhas recebidas na carga útil da solicitação. </p>
            <p>A carga útil da resposta JSON deve ter os dados do resultado no campo “resultados” para que ele seja reconhecido pela função externa. O campo argumentos na solicitação enviada para a função Lambda contém a carga útil de dados. Pode haver várias linhas na carga útil de dados no caso de uma solicitação em lote. A seguinte função do Lambda itera sobre todas as linhas na carga útil de dados de solicitação. Ele também itera individualmente sobre todos os valores dentro de uma única linha.</p>
            <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copiar"><awsui-icon name="copy"></awsui-icon></div></div><code class="">exports.handler = async (event) =&gt; <span>{</span>
    // The 'arguments' field in the request sent to the Lambda function contains the data payload.
    var t1 = event['arguments'];

    // 'len(t1)' represents the number of rows in the request payload.
    // The number of results in the response payload should be the same as the number of rows received.
    const resp = new Array(t1.length);

    // Iterating over all the rows in the request payload.
    for (const [i, x] of t1.entries())
    <span>{</span>
        var sum = 0;
        // Iterating over all the values in a single row.
        for (const y of x) <span>{</span>
            sum = sum + y;
        }
        resp[i] = sum;
    }
    // The 'results' field should contain the results of the lambda call.
    const response = <span>{</span>
        results: resp
    };
    return JSON.stringify(response);
};</code></pre>
            <p>O exemplo a seguir chama a função externa com valores literais.</p>
            
            <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copiar"><awsui-icon name="copy"></awsui-icon></div></div><code class="">select exfunc_sum(1,2);
exfunc_sum
------------
 3
(1 row)</code></pre>
            <p>O exemplo a seguir cria uma tabela chamada t_sum com duas colunas, c1 e c2, do tipo de dados inteiro e insere duas linhas de dados. Em seguida, a função externa é chamada passando os nomes de coluna desta tabela. As duas linhas da tabela são enviadas em uma solicitação de lote na carga útil de solicitação como uma única invocação do Lambda.</p>
            
<pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copiar"><awsui-icon name="copy"></awsui-icon></div></div><code class="">CREATE TABLE t_sum(c1 int, c2 int);
INSERT INTO t_sum VALUES (4,5), (6,7);
SELECT exfunc_sum(c1,c2) FROM t_sum;
 exfunc_sum
---------------
 9
 13
(2 rows)</code></pre>
          

         
          
            <h3 id="r_CREATE_FUNCTION-lambda-example-retry">Exemplo de UDF Lambda escalar usando o atributo RETRY_TIMEOUT</h3>
            <p>Na seção a seguir, você pode encontrar um exemplo de como usar o atributo RETRY_TIMEOUT em UDFs do Lambda. </p>
            <p>Funções AWS Lambda têm limites de simultaneidade que você pode definir para cada função. Para obter mais informações sobre limites de simultaneidade, consulte <a href="https://docs.aws.amazon.com/lambda/latest/dg/configuration-concurrency.html">Gerenciamento de simultaneidade para uma função do Lambda</a> no <em>Guia do desenvolvedor do AWS Lambda</em> e a publicação <a href="https://aws.amazon.com/blogs/compute/managing-aws-lambda-function-concurrency" rel="noopener noreferrer" target="_blank"><span>Gerenciamento da simultaneidade de funções do AWS Lambda</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a> no Blog de computação da AWS. </p>
            <p>Quando o número de solicitações que estão sendo atendidas por um UDF Lambda excede os limites de simultaneidade, as novas solicitações recebem o erro <code class="code">TooManyRequestsException</code>. O UDF Lambda tenta novamente neste erro até que a soma de todos os atrasos entre as solicitações enviadas para a função do Lambda seja igual ou exceda o valor RETRY_TIMEOUT definido. O valor padrão de RETRY_TIMEOUT é 20.000 milissegundos.</p>
              <p>O exemplo a seguir cria uma função do Lambda chamada <code class="code">exfunc_sleep_3</code>. Esta função recebe a carga útil de solicitação, itera sobre cada linha e converte a entrada para maiúsculas. Em seguida, dorme por 3 segundos e retorna o resultado. A linguagem usada para esta função do Lambda é Python 3.8. </p>
            <p>O número de linhas na matriz de resultados é semelhante ao número de linhas recebidas na carga útil da solicitação. A carga útil da resposta JSON deve ter os dados do resultado no campo <code class="code">results</code> para que ele seja reconhecido pela função externa. O campo <code class="code">arguments</code> na solicitação enviada para a função do Lambda contém a carga útil de dados. Pode haver várias linhas na carga útil de dados no caso de uma solicitação em lote.</p>
              <p>O limite de simultaneidade para essa função é definido especificamente como 1 em simultaneidade reservada para demonstrar o uso do atributo RETRY_TIMEOUT. Quando o atributo é definido como 1, a função do Lambda só pode servir uma solicitação por vez.</p>
            <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copiar"><awsui-icon name="copy"></awsui-icon></div></div><code class="">import json
import time
def lambda_handler(event, context):
    t1 = event['arguments']
    # 'len(t1)' represents the number of rows in the request payload.
    # The number of results in the response payload should be the same as the number of rows received.
    resp = [None]*len(t1)

    # Iterating over all rows in the request payload.
    for i, x in enumerate(t1):
        # Iterating over all the values in a single row.
        for j, y in enumerate(x):
            resp[i] = y.upper()

    time.sleep(3)
    ret = dict()
    ret['results'] = resp
    ret_json = json.dumps(ret)
    return ret_json</code></pre>
            <p>A seguir, dois exemplos adicionais ilustram o atributo RETRY_TIMEOUT. Cada um deles invoca um único UDF Lambda. Ao invocar o UDF Lambda, cada exemplo executa a mesma consulta SQL para invocar o UDF Lambda de duas sessões simultâneas de banco de dados ao mesmo tempo. Quando a primeira consulta que invoca o UDF Lambda está sendo atendida pelo UDF, a segunda consulta recebe o erro <code class="code">TooManyRequestsException</code>. Esse resultado ocorre porque você define especificamente a simultaneidade reservada no UDF como 1. Para obter informações sobre como definir a simultaneidade reservada para funções do Lambda, consulte <a href="https://docs.aws.amazon.com/lambda/latest/dg/configuration-concurrency.html#configuration-concurrency-reservedconfiguration-concurrency-reserved">Configurar a simultaneidade reservada</a>.</p>


            

            <p>O primeiro exemplo a seguir define o atributo RETRY_TIMEOUT para o UDF Lambda como 0 milissegundos. Se a solicitação do Lambda receber exceções da função do Lambda, o Amazon Redshift não fará novas tentativas. Esse resultado ocorre porque o atributo RETRY_TIMEOUT está definido como 0.</p>
            
            <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copiar"><awsui-icon name="copy"></awsui-icon></div></div><code class="">CREATE OR REPLACE EXTERNAL FUNCTION exfunc_upper(varchar)
RETURNS varchar
VOLATILE
LAMBDA 'exfunc_sleep_3'
IAM_ROLE 'arn:aws:iam::123456789012:role/Redshift-Exfunc-Test'
RETRY_TIMEOUT 0;</code></pre>
            <p>Com o RETRY_TIMEOUT definido como 0, você pode executar as duas consultas a seguir de sessões de banco de dados separadas para ver resultados diferentes.</p>
            <p>A primeira consulta SQL que usa o UDF Lambda é executada com êxito.</p>
            
            <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copiar"><awsui-icon name="copy"></awsui-icon></div></div><code class="">select exfunc_upper('Varchar');
 exfunc_upper
 --------------
 VARCHAR
(1 row)</code></pre>
            <p>A segunda consulta, que é executada a partir de uma sessão de banco de dados separada ao mesmo tempo, recebe o erro <code class="code">TooManyRequestsException</code>.</p>
                  
            <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copiar"><awsui-icon name="copy"></awsui-icon></div></div><code class="">select exfunc_upper('Varchar');
ERROR:  Rate Exceeded.; Exception: TooManyRequestsException; ShouldRetry: 1
DETAIL:
-----------------------------------------------
error:  Rate Exceeded.; Exception: TooManyRequestsException; ShouldRetry: 1
code:      32103
context:query:     0
location:  exfunc_client.cpp:102
process:   padbmaster [pid=26384]
-----------------------------------------------</code></pre>

                  <p>O segundo exemplo a seguir define o atributo RETRY_TIMEOUT para o UDF Lambda como 3.000 milissegundos. Mesmo se a segunda consulta for executada simultaneamente, o UDF Lambda tenta novamente até que o total de atrasos seja de 3.000 milissegundos. Assim, ambas as consultas são executadas com êxito.</p>
                  
                  <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copiar"><awsui-icon name="copy"></awsui-icon></div></div><code class="">CREATE OR REPLACE EXTERNAL FUNCTION exfunc_upper(varchar)
RETURNS varchar
VOLATILE
LAMBDA 'exfunc_sleep_3'
IAM_ROLE 'arn:aws:iam::123456789012:role/Redshift-Exfunc-Test'
RETRY_TIMEOUT 3000;</code></pre>
                  <p>Com o RETRY_TIMEOUT definido como 3.000 milissegundos, você pode executar as duas consultas a seguir de sessões de banco de dados separadas para ver os mesmos resultados.</p>
                  <p>A primeira consulta SQL que usa o UDF Lambda é executada com êxito.</p>
                  
                  <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copiar"><awsui-icon name="copy"></awsui-icon></div></div><code class="">select exfunc_upper('Varchar');
 exfunc_upper
 --------------
 VARCHAR
(1 row)</code></pre>
                  <p>A segunda consulta é executada simultaneamente e o UDF Lambda tenta novamente até que o atraso total seja de 3.000 milissegundos.</p>
                  
                  <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copiar"><awsui-icon name="copy"></awsui-icon></div></div><code class="">select exfunc_upper('Varchar');
 exfunc_upper
--------------
 VARCHAR
(1 row)</code></pre>

          

          
            <h3 id="r_CREATE_FUNCTION-lambda-example-python">Exemplo de UDF Lambda escalar usando uma função Python Lambda</h3>
            <p>O exemplo a seguir cria uma função externa chamada <code class="code">exfunc_multiplication</code> que multiplica números e retorna um inteiro. Este exemplo incorpora o campo success e <code class="code">error_msg</code> na resposta do Lambda. O campo success é definido como false quando há um estouro de inteiro no resultado da multiplicação, e a propriedade <code class="code">error_msg</code> está definida como <code class="code">Integer multiplication overflow</code>. A função <code class="code">exfunc_multiplication</code> leva três inteiros como argumentos de entrada e retorna a soma como uma saída inteira. </p>
            <p>O nome da função do Lambda chamada é <code class="code">lambda_multiplication</code>. A linguagem usada para esta função do Lambda é Python 3.8. Especifique a função do IAM.</p>
            
            <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copiar"><awsui-icon name="copy"></awsui-icon></div></div><code class="">CREATE EXTERNAL FUNCTION exfunc_multiplication(int, int, int)
RETURNS INT
VOLATILE
LAMBDA 'lambda_multiplication'
IAM_ROLE 'arn:aws:iam::123456789012:role/Redshift-Exfunc-Test'; </code></pre>
            <p>A função do Lambda recebe a carga útil de solicitação e itera sobre cada linha. Todos os valores em uma única linha são multiplicados para calcular o resultado dessa linha, que é salvo na lista de respostas. Este exemplo usa um valor de sucesso booleano definido como true por padrão. Se o resultado da multiplicação de uma linha tiver um estouro de inteiro, o valor de sucesso será definido como false. Em seguida, o loop de iteração quebra. </p>
            <p>Ao criar a carga útil de resposta, se o valor de sucesso for false, a seguinte função do Lambda adiciona o campo <code class="code">error_msg</code> na carga útil. Também define a mensagem de erro como <code class="code">Integer multiplication overflow</code>. Se o valor de sucesso for true, os dados do resultado serão adicionados no campo de resultados. O número de linhas na matriz de resultados, se houver, é semelhante ao número de linhas recebidas na carga útil da solicitação. </p>
            <p>O campo argumentos na solicitação enviada para a função Lambda contém a carga útil de dados. Pode haver várias linhas na carga útil de dados no caso de uma solicitação em lote. A seguinte função do Lambda itera sobre todas as linhas na carga útil de dados de solicitação e itera individualmente sobre todos os valores dentro de uma única linha. </p>
            <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copiar"><awsui-icon name="copy"></awsui-icon></div></div><code class="">import json
def lambda_handler(event, context):
    t1 = event['arguments']
    # 'len(t1)' represents the number of rows in the request payload.
    # The number of results in the response payload should be the same as the number of rows received.
    resp = [None]*len(t1)

    # By default success is set to 'True'.
    success = True
    # Iterating over all rows in the request payload.
    for i, x in enumerate(t1):
        mul = 1
        # Iterating over all the values in a single row.
        for j, y in enumerate(x):
            mul = mul*y

        # Check integer overflow.
        if (mul &gt;= 9223372036854775807 or mul &lt;= -9223372036854775808):
            success = False
            break
        else:
            resp[i] = mul
    ret = dict()
    ret['success'] = success
    if not success:
        ret['error_msg'] = "Integer multiplication overflow"
    else:
        ret['results'] = resp
    ret_json = json.dumps(ret)

    return ret_json</code></pre>

            <p>O exemplo a seguir chama a função externa com valores literais.</p>
            
            <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copiar"><awsui-icon name="copy"></awsui-icon></div></div><code class="">SELECT exfunc_multiplication(8, 9, 2);
  exfunc_multiplication
---------------------------
          144
(1 row)</code></pre>

            <p>O exemplo a seguir cria uma tabela chamada t_multi com três colunas, c1, c2 e c3, do tipo de dados inteiro. A função externa é chamada passando os nomes das colunas desta tabela. Os dados são inseridos de forma a causar estouro de inteiro para mostrar como o erro é propagado.</p>
            
            <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copiar"><awsui-icon name="copy"></awsui-icon></div></div><code class="">CREATE TABLE t_multi (c1 int, c2 int, c3 int);
INSERT INTO t_multi VALUES (2147483647, 2147483647, 4);
SELECT exfunc_multiplication(c1, c2, c3) FROM t_multi;
DETAIL:
  -----------------------------------------------
  error:  Integer multiplication overflow
  code:      32004context:
  context:
  query:     38
  location:  exfunc_data.cpp:276
  process:   query2_16_38 [pid=30494]
  -----------------------------------------------</code></pre>
          




         
      <awsdocs-copyright class="copyright-print"></awsdocs-copyright><awsdocs-thumb-feedback right-edge="{{$ctrl.thumbFeedbackRightEdge}}"></awsdocs-thumb-feedback></div><noscript><div><div><div><div id="js_error_message"><p><img src="https://d1ge0kk1l5kms0.cloudfront.net/images/G/01/webservices/console/warning.png" alt="Atenção" /> <strong>O Javascript está desativado ou não está disponível no seu navegador.</strong></p><p>Para usar a documentação da AWS, o Javascript deve estar ativado. Consulte as páginas de Ajuda do navegador para obter instruções.</p></div></div></div></div></noscript><div id="main-col-footer" class="awsui-util-font-size-0"><div id="doc-conventions"><a target="_top" href="/general/latest/gr/docconventions.html">Convenções do documento</a></div><div class="prev-next"><div id="previous" class="prev-link" accesskey="p" href="./r_CREATE_DATASHARE.html">CREATE DATASHARE</div><div id="next" class="next-link" accesskey="n" href="./r_CREATE_EXTERNAL_SCHEMA.html">CREATE EXTERNAL SCHEMA</div></div></div><awsdocs-page-utilities></awsdocs-page-utilities></div><div id="quick-feedback-yes" style="display: none;"><div class="title">Essa página foi útil? - Sim</div><div class="content"><p>Obrigado por nos informar que estamos fazendo um bom trabalho!</p><p>Se tiver tempo, conte-nos sobre o que você gostou para que possamos melhorar ainda mais.</p><p><awsui-button id="fblink" rel="noopener noreferrer" target="_blank" text="Feedback" click="linkClick($event)" href="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=Redshift&amp;topic_url=https://docs.aws.amazon.com/pt_br/redshift/latest/dg/r_CREATE_EXTERNAL_FUNCTION.html"></awsui-button></p></div></div><div id="quick-feedback-no" style="display: none;"><div class="title">Essa página foi útil? - Não</div><div class="content"><p>Obrigado por nos informar que precisamos melhorar a página. Lamentamos ter decepcionado você.</p><p>Se tiver tempo, conte-nos como podemos melhorar a documentação.</p><p><awsui-button id="fblink" rel="noopener noreferrer" target="_blank" text="Feedback" click="linkClick($event)" href="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=Redshift&amp;topic_url=https://docs.aws.amazon.com/pt_br/redshift/latest/dg/r_CREATE_EXTERNAL_FUNCTION.html"></awsui-button></p></div></div></div></body></div></awsdocs-view><div class="page-loading-indicator" id="page-loading-indicator"><awsui-spinner size="large"></awsui-spinner></div></div><div id="tools-panel" dom-region="tools"><awsdocs-tools-panel id="awsdocs-tools-panel"></awsdocs-tools-panel></div></awsui-app-layout><awsdocs-cookie-banner class="doc-cookie-banner"></awsdocs-cookie-banner></div></body></html>