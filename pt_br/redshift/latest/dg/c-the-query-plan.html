<!DOCTYPE html>
    <html xmlns="http://www.w3.org/1999/xhtml" lang="pt-BR"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Plano de consulta - Amazon Redshift</title><meta name="viewport" content="width=device-width,initial-scale=1" /><meta name="assets_root" content="/assets" /><meta name="target_state" content="c-the-query-plan" /><meta name="default_state" content="c-the-query-plan" /><link rel="icon" type="image/ico" href="/assets/images/favicon.ico" /><link rel="shortcut icon" type="image/ico" href="/assets/images/favicon.ico" /><link rel="canonical" href="https://docs.aws.amazon.com/pt_br/redshift/latest/dg/c-the-query-plan.html" /><meta name="description" content="Descreve como interpretar um plano de consulta." /><meta name="deployment_region" content="IAD" /><meta name="product" content="Amazon Redshift" /><meta name="guide" content="Guia do desenvolvedor de banco de dados" /><meta name="abstract" content="Crie e gerencie um data warehouse com o Amazon Redshift, um serviço de data warehouse totalmente gerenciado, em escala de petabyte e de nível empresarial." /><meta name="guide-locale" content="pt_br" /><meta name="tocs" content="toc-contents.json" /><link rel="canonical" href="https://docs.aws.amazon.com/pt_br/redshift/latest/dg/c-the-query-plan.html" /><link rel="alternative" href="https://docs.aws.amazon.com/id_id/redshift/latest/dg/c-the-query-plan.html" hreflang="id-id" /><link rel="alternative" href="https://docs.aws.amazon.com/id_id/redshift/latest/dg/c-the-query-plan.html" hreflang="id" /><link rel="alternative" href="https://docs.aws.amazon.com/de_de/redshift/latest/dg/c-the-query-plan.html" hreflang="de-de" /><link rel="alternative" href="https://docs.aws.amazon.com/de_de/redshift/latest/dg/c-the-query-plan.html" hreflang="de" /><link rel="alternative" href="https://docs.aws.amazon.com/redshift/latest/dg/c-the-query-plan.html" hreflang="en-us" /><link rel="alternative" href="https://docs.aws.amazon.com/redshift/latest/dg/c-the-query-plan.html" hreflang="en" /><link rel="alternative" href="https://docs.aws.amazon.com/es_es/redshift/latest/dg/c-the-query-plan.html" hreflang="es-es" /><link rel="alternative" href="https://docs.aws.amazon.com/es_es/redshift/latest/dg/c-the-query-plan.html" hreflang="es" /><link rel="alternative" href="https://docs.aws.amazon.com/fr_fr/redshift/latest/dg/c-the-query-plan.html" hreflang="fr-fr" /><link rel="alternative" href="https://docs.aws.amazon.com/fr_fr/redshift/latest/dg/c-the-query-plan.html" hreflang="fr" /><link rel="alternative" href="https://docs.aws.amazon.com/it_it/redshift/latest/dg/c-the-query-plan.html" hreflang="it-it" /><link rel="alternative" href="https://docs.aws.amazon.com/it_it/redshift/latest/dg/c-the-query-plan.html" hreflang="it" /><link rel="alternative" href="https://docs.aws.amazon.com/ja_jp/redshift/latest/dg/c-the-query-plan.html" hreflang="ja-jp" /><link rel="alternative" href="https://docs.aws.amazon.com/ja_jp/redshift/latest/dg/c-the-query-plan.html" hreflang="ja" /><link rel="alternative" href="https://docs.aws.amazon.com/ko_kr/redshift/latest/dg/c-the-query-plan.html" hreflang="ko-kr" /><link rel="alternative" href="https://docs.aws.amazon.com/ko_kr/redshift/latest/dg/c-the-query-plan.html" hreflang="ko" /><link rel="alternative" href="https://docs.aws.amazon.com/pt_br/redshift/latest/dg/c-the-query-plan.html" hreflang="pt-br" /><link rel="alternative" href="https://docs.aws.amazon.com/pt_br/redshift/latest/dg/c-the-query-plan.html" hreflang="pt" /><link rel="alternative" href="https://docs.aws.amazon.com/zh_cn/redshift/latest/dg/c-the-query-plan.html" hreflang="zh-cn" /><link rel="alternative" href="https://docs.aws.amazon.com/zh_tw/redshift/latest/dg/c-the-query-plan.html" hreflang="zh-tw" /><link rel="alternative" href="https://docs.aws.amazon.com/redshift/latest/dg/c-the-query-plan.html" hreflang="x-default" /><meta name="feedback-item" content="Redshift" /><meta name="this_doc_product" content="Amazon Redshift" /><meta name="this_doc_guide" content="Guia do desenvolvedor de banco de dados" /><script defer="" src="/assets/r/vendor4.js?version=2021.12.02"></script><script defer="" src="/assets/r/vendor3.js?version=2021.12.02"></script><script defer="" src="/assets/r/vendor1.js?version=2021.12.02"></script><script defer="" src="/assets/r/awsdocs-common.js?version=2021.12.02"></script><script defer="" src="/assets/r/awsdocs-doc-page.js?version=2021.12.02"></script><link href="/assets/r/vendor4.css?version=2021.12.02" rel="stylesheet" /><link href="/assets/r/awsdocs-common.css?version=2021.12.02" rel="stylesheet" /><link href="/assets/r/awsdocs-doc-page.css?version=2021.12.02" rel="stylesheet" /><script async="" id="awsc-panorama-bundle" type="text/javascript" src="https://prod.pa.cdn.uis.awsstatic.com/panorama-nav-init.js" data-config="{'appEntity':'aws-documentation','region':'us-east-1','service':'redshift'}"></script><meta id="panorama-serviceSubSection" value="Guia do desenvolvedor de banco de dados" /><meta id="panorama-serviceConsolePage" value="Plano de consulta" /></head><body class="awsdocs awsui"><div class="awsdocs-container"><awsdocs-header></awsdocs-header><awsui-app-layout id="app-layout" class="awsui-util-no-gutters" ng-controller="ContentController as $ctrl" header-selector="awsdocs-header" navigation-hide="false" navigation-width="$ctrl.navWidth" navigation-open="$ctrl.navOpen" navigation-change="$ctrl.onNavChange($event)" tools-hide="$ctrl.hideTools" tools-width="$ctrl.toolsWidth" tools-open="$ctrl.toolsOpen" tools-change="$ctrl.onToolsChange($event)"><div id="guide-toc" dom-region="navigation"><awsdocs-toc></awsdocs-toc></div><div id="main-column" dom-region="content" tabindex="-1"><awsdocs-view class="awsdocs-view"><div id="awsdocs-content"><head><title>Plano de consulta - Amazon Redshift</title><meta name="pdf" content="redshift-dg.pdf#c-the-query-plan" /><meta name="rss" content="Dochistory.rss" /><meta name="forums" content="http://forums.aws.amazon.com/forum.jspa?forumID=155" /><meta name="feedback" content="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=Redshift&amp;topic_url=https://docs.aws.amazon.com/pt_br/redshift/latest/dg/c-the-query-plan.html" /><meta name="feedback-yes" content="feedbackyes.html?topic_url=https://docs.aws.amazon.com/pt_br/redshift/latest/dg/c-the-query-plan.html" /><meta name="feedback-no" content="feedbackno.html?topic_url=https://docs.aws.amazon.com/pt_br/redshift/latest/dg/c-the-query-plan.html" /><meta name="keywords" content="Amazon Redshift,AWS Redshift,Redshift,Redshift Spectrum,cluster,data warehouse,desenvolvedor,dados de amostra,banco de dados,desenvolvedor do banco de dados,HLL" /><script type="application/ld+json">
{
    "@context" : "https://schema.org",
    "@type" : "BreadcrumbList",
    "itemListElement" : [
      {
        "@type" : "ListItem",
        "position" : 1,
        "name" : "AWS",
        "item" : "https://aws.amazon.com"
      },
      {
        "@type" : "ListItem",
        "position" : 2,
        "name" : "Amazon Redshift",
        "item" : "https://docs.aws.amazon.com/redshift/index.html"
      },
      {
        "@type" : "ListItem",
        "position" : 3,
        "name" : "Guia do desenvolvedor de banco de dados",
        "item" : "https://docs.aws.amazon.com/pt_br/redshift/latest/dg"
      },
      {
        "@type" : "ListItem",
        "position" : 4,
        "name" : "Ajustar a performance da consulta",
        "item" : "https://docs.aws.amazon.com/pt_br/redshift/latest/dg/c-optimizing-query-performance.html"
      },
      {
        "@type" : "ListItem",
        "position" : 5,
        "name" : "Processamento de consulta",
        "item" : "https://docs.aws.amazon.com/pt_br/redshift/latest/dg/c-query-processing.html"
      },
      {
        "@type" : "ListItem",
        "position" : 6,
        "name" : "Plano de consulta",
        "item" : "https://docs.aws.amazon.com/pt_br/redshift/latest/dg/c-query-processing.html"
      }
    ]
}
</script></head><body><div id="main"><div style="display: none"><a href="redshift-dg.pdf#c-the-query-plan" target="_blank" rel="noopener noreferrer" title="Abrir em PDF"></a></div><div id="breadcrumbs" class="breadcrumb"><a href="https://aws.amazon.com">AWS</a><a href="/index.html">Documentação</a><a href="/redshift/index.html">Amazon Redshift</a><a href="welcome.html">Guia do desenvolvedor de banco de dados</a></div><div id="page-toc-src"><a href="#EXPLAIN-operators">Operadores EXPLAIN</a><a href="#joins-in-EXPLAIN">Junções em EXPLAIN</a></div><div id="main-content" class="awsui-util-container"><div id="main-col-body"><awsdocs-language-banner data-service="$ctrl.pageService"></awsdocs-language-banner><h1 class="topictitle" id="c-the-query-plan">Plano de consulta</h1><div class="awsdocs-page-header-container"><awsdocs-page-header></awsdocs-page-header><awsdocs-filter-selector id="awsdocs-filter-selector"></awsdocs-filter-selector></div><p>É possível usar o plano de consulta para obter informações sobre operações individuais necessárias para executar uma consulta. Antes de trabalhar com um plano de consulta, recomendamos que você primeiro entenda como o Amazon Redshift lida com o processamento de consultas e a criação de planos de consulta. Para ter mais informações, consulte <a href="./c-query-planning.html">Planejamento de consulta e fluxo de trabalho de execução</a>.</p><p>Para criar um plano de consulta, execute o comando <a href="./r_EXPLAIN.html">EXPLAIN</a> seguido pelo texto real da consulta. O plano de consulta oferece as seguintes informações:</p><div class="itemizedlist">
             
             
             
             
             
         <ul class="itemizedlist"><li class="listitem">
               <p>Quais operações o mecanismo de execução executa, lendo os resultados de baixo para cima.</p>
            </li><li class="listitem">
               <p>Que tipo de etapa cada operação executa.</p>
            </li><li class="listitem">
               <p>Quais tabelas e colunas são usadas em cada operação.</p>
            </li><li class="listitem">
               <p>Quantos dados são processados em cada operação, em termos de número de linhas e largura de dados em bytes.</p>
            </li><li class="listitem">
               <p>O custo relativo da operação. <em>Custo</em> é uma medida que compara os tempos relativos de execução das etapas em um plano. O custo não fornece qualquer informação precisa sobre o real tempo de execução ou consumo de memória, nem fornece uma comparação significativa entre planos de execução. Ele fornece uma indicação de quais operações em uma consulta estão consumindo a maioria dos recursos.</p>
            </li></ul></div><p>O comando EXPLAIN não executa a consulta de fato. Ele mostra apenas o plano que o Amazon Redshift executa se a consulta for executada nas condições operacionais atuais. Se você alterar o esquema ou os dados de uma tabela e executar <a href="./r_ANALYZE.html">ANALYZE</a> novamente para atualizar os metadados estatísticos, o plano de consulta poderá ser diferente.</p><p>A saída do plano de consulta pelo comando EXPLAIN é uma exibição de alto nível simplificada da execução da consulta. Ela não ilustra os detalhes do processamento paralelo da consulta. Para visualizar informações detalhadas, execute a própria consultas e obtenha as informações de resumo na visualização SVL_QUERY_SUMMARY ou SVL_QUERY_REPORT. Para obter mais informações sobre como usar essas visualizações, consulte <a href="./c-analyzing-the-query-summary.html">Analisar o resumo da consulta</a>.</p><p>O seguinte exemplo mostra a saída de EXPLAIN para uma consulta GROUP BY simples na tabela EVENT:</p><pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copiar"><awsui-icon name="copy"></awsui-icon></div></div><code class="">explain select eventname, count(*) from event group by eventname;

                            QUERY PLAN
-------------------------------------------------------------------
XN HashAggregate  (cost=131.97..133.41 rows=576 width=17)
  -&gt;  XN Seq Scan on event  (cost=0.00..87.98 rows=8798 width=17)</code></pre><p>EXPLAIN retorna as seguintes métricas para cada operação:</p><div class="variablelist">
             
             
             
         <dl>
               <dt><b><span class="term">Custo</span></b></dt>
               <dd>
                  <p>Um valor relativo que é útil para comparar operações em um plano. Custo consiste em dois valores decimais separados por dois pontos, por exemplo <code class="code">cost=131.97..133.41</code>. O primeiro valor, nesse caso 131,97, fornece o custo relativo de retornar a primeira linha para essa operação. O segundo valor, nesse caso 133,41, fornece o custo relativo de concluir a operação. Os custos em plano de consulta são cumulativos à medida que você lê o plano, portanto o custo HashAggregate neste exemplo (131,97..133,41) inclui o custo da Seq Scan abaixo dele (0.00..87.98).</p>
               </dd>
            
               <dt><b><span class="term">Linhas</span></b></dt>
               <dd>
                  <p>O número previsto de linhas a retornar. Neste exemplo, a previsão de retorno da varredura é 8.798 linhas. O operador HashAggregate deve, sozinho, retornar 576 linhas (depois que os nomes de evento duplicados são descartados do conjunto de resultados).</p>
                  <div class="awsdocs-note"><div class="awsdocs-note-title"><awsui-icon name="status-info" variant="link"></awsui-icon><h6>nota</h6></div><div class="awsdocs-note-text"><p>A estimativa de linhas baseia-se nas estatísticas disponíveis geradas pelo comando ANALYZE. Se ANALYZE não tiver sido executado recentemente, a estimativa será menos confiável.</p></div></div>
               </dd>
            
               <dt><b><span class="term">Largura</span></b></dt>
               <dd>
                  <p>A largura estimada da linha média, em bytes. Neste exemplo, a previsão de largura da linha média é de 17 bytes.</p>
               </dd>
            </dl></div><h2 id="EXPLAIN-operators">Operadores EXPLAIN</h2>
            
            <p>Esta seção descreve resumidamente os operadores que você verá com mais frequência na saída de EXPLAIN. Para uma lista completa dos operadores, consulte <a href="./r_EXPLAIN.html">EXPLAIN</a> na seção de comandos SQL.</p>
            <h3 id="scan-operator">Operador de varredura sequencial</h3>
               
               <p>O operador de varredura sequencial (Seq Scan) indica uma varredura de tabela. A Seq Scan faz a varredura de cada coluna na tabela sequencialmente do começo ao fim e avalia as restrições da consulta (na cláusula WHERE) para cada linha.</p>
             
            <h3 id="join-operators">Operadores de junção</h3>
               
               <p>O Amazon Redshift seleciona operadores de junção com base no design físico das tabelas que estão sendo juntadas, a localização dos dados necessários para a junção e os requisitos específicos da própria consulta.</p>
               <div class="itemizedlist">
                   
                   
                   
                   
               <ul class="itemizedlist"><li class="listitem">
                     <p><span class="topcom">Loop aninhado</span></p>
                     <p>Um loop aninhado, a junção menos ideal, é usado sobretudo para junções cruzadas (produtos cartesianos) e algumas junções de desigualdade.</p>
                  </li><li class="listitem">
                     <p><span class="topcom">Hash e junção hash</span></p>
                     <p>Normalmente mais rápida que uma junção de loop aninhado, hash e junção hash são usadas para junções internas e junções externas da esquerda e direita. Esses operadores são usados para juntar tabelas onde as colunas de junção não são chaves de distribuição <em>e</em> chaves de classificação. O operador hash cria a tabela hash para a junção da tabela interna; o operador de junção hash lê a tabela externa, hash a coluna de junção e localiza correspondências na tabela hash interna.</p>
                  </li><li class="listitem">
                     <p><span class="topcom">Merge Join</span></p>
                     <p>Normalmente a junção mais rápida, uma junção de mesclagem é usada para junções internas e externas. A junção de mesclagem não é usada para junções completas. Este operador é usado para juntar tabelas onde as colunas de junção são chaves de distribuição <em>e</em> chaves de classificação e quando menos que 20 por cento das tabelas para junção não estão classificadas. Ele lê duas tabelas classificadas na ordem e localiza as linhas correspondentes. Para ver a porcentagem de linhas não classificadas, consulte a tabela de sistema <a href="./r_SVV_TABLE_INFO.html">SVV_TABLE_INFO</a>.</p>
                  </li><li class="listitem"> 
                     <p><span class="topcom">Junção espacial</span></p>
                     <p>Normalmente, uma junção rápida com base na proximidade de dados espaciais, usados em tipos de dados <code class="code">GEOMETRY</code> e <code class="code">GEOGRAPHY</code>.</p>
                  </li></ul></div>
             
            <h3 id="aggregate-operators">Operadores de agregação</h3>
               
               <p>O plano de consulta usa os seguintes operadores em consultas que envolvem funções agregadas e operações GROUP BY.</p>
               <div class="itemizedlist">
                   
                   
                   
               <ul class="itemizedlist"><li class="listitem">
                     <p><span class="topcom">Aggregate</span></p>
                     <p>Operador para funções agregadas escalares, tais como AVG e SUM.</p>
                  </li><li class="listitem">
                     <p><span class="topcom">HashAggregate</span></p>
                     <p>Operador para funções agregadas agrupadas não classificadas.</p>
                  </li><li class="listitem">
                     <p><span class="topcom">GroupAggregate</span></p>
                     <p>Operador para funções agregadas agrupadas classificadas.</p>
                  </li></ul></div>
             
            <h3 id="sort-operators">Operadores de classificação</h3>
               
               <p>O plano de consulta usa os seguintes operadores quando as consultas precisam classificar ou mesclar conjuntos de resultados.</p>
               <div class="itemizedlist">
                   
                   
               <ul class="itemizedlist"><li class="listitem">
                     <p><span class="topcom">Sort</span></p>
                     <p>Avalia a cláusula ORDER BY e outras operações de classificação, tais como classificações exigidas por consultas e junções UNION, consultas SELECT DISTINCT e funções de janela.</p>
                  </li><li class="listitem">
                     <p><span class="topcom">Merge</span></p>
                     <p>Produz resultados finais classificados de acordo com os resultados classificados intermediários derivados de operações paralelas.</p>
                  </li></ul></div>
             
            <h3 id="UNION-INTERSECT-and-EXCEPT-operators">Operadores UNION, INTERSECT e EXCEPT</h3>
               
               <p>O plano de consulta usa os seguintes operadores para consultas que envolvem operações de conjunto com UNION, INTERSECT e EXCEPT.</p>
               <div class="itemizedlist">
                   
                   
                   
               <ul class="itemizedlist"><li class="listitem">
                     <p><span class="topcom">Subconsulta</span></p>
                     <p>Usada para executar consultas UNION.</p>
                  </li><li class="listitem">
                     <p><span class="topcom">Hash Intersect Distinct </span></p>
                     <p>Usado para executar consultas INTERSECT .</p>
                  </li><li class="listitem">
                     <p><span class="topcom">SetOp Except</span></p>
                     <p>Usada para executar consultas EXCEPT (ou MINUS).</p>
                  </li></ul></div>
             
            <h3 id="other-operators">Outros operadores</h3>
               
               <p>Os operadores a seguir também aparecem frequentemente na saída de EXPLAIN para consultas de rotina.</p>
               <div class="itemizedlist">
                   
                   
                   
                   
                   
                   
                   
               <ul class="itemizedlist"><li class="listitem">
                     <p><span class="topcom">Unique</span></p>
                     <p>Remove duplicidades para consultas SELECT DISTINCT e UNION.</p>
                  </li><li class="listitem">
                     <p><span class="topcom">Limite</span></p>
                     <p>Processa a cláusula LIMIT.</p>
                  </li><li class="listitem">
                     <p><span class="topcom">Window</span></p>
                     <p>Executa funções de janela.</p>
                  </li><li class="listitem">
                     <p><span class="topcom">Resultado</span></p>
                     <p>Executa funções escalares que não envolvem qualquer acesso à tabela.</p>
                  </li><li class="listitem">
                     <p><span class="topcom">Subplan</span></p>
                     <p>Usado para determinadas subconsultas.</p>
                  </li><li class="listitem">
                     <p><span class="topcom">Rede</span></p>
                     <p>Envia resultados intermediários ao nó de liderança para processamento adicional.</p>
                  </li><li class="listitem">
                     <p><span class="topcom">Materialize</span></p>
                     <p>Salva linhas para entrada em junções de loop aninhado e algumas junções de mesclagem.</p>
                  </li></ul></div>
             
         <h2 id="joins-in-EXPLAIN">Junções em EXPLAIN</h2>
            
            <p>O otimizador de consulta usa diferentes tipos de junção para recuperar dados da tabela, dependendo da estrutura da consulta e das tabelas subjacentes. A saída de EXPLAIN menciona o tipo de junção, as tabelas usadas e a forma que os dados da tabela estão distribuídos pelo cluster para descrever como a consulta é processada.</p>

            <h3 id="join-types">Exemplos de tipos de junção</h3>
               
               <p>Os seguintes exemplos mostram os diferentes tipos de junção que o otimizador de consulta pode utilizar. O tipo de junção usado no plano de consulta depende do design físico das tabelas envolvidas.</p>
               <h4 id="hash-join-two-tables">Exemplo: junção hash de duas tabelas</h4>
                  
                  <p>A seguinte consulta faz a junção de EVENT e CATEGORY na coluna CATID. CATID é a chave de distribuição e classificação para CATEGORY, mas não para EVENT. Uma junção hash é realizada com EVENT como a tabela externa e CATEGORY como a tabela interna. Como CATEGORY é a tabela menor, o planejador transmite uma cópia dela para os nós de computação durante o processamento da consulta usando DS_BCAST_INNER. O custo da junção neste exemplo corresponde à maioria do custo cumulativo do plano.</p>
                  <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copiar"><awsui-icon name="copy"></awsui-icon></div></div><code class="">explain select * from category, event where category.catid=event.catid;

                               QUERY PLAN
-------------------------------------------------------------------------
 XN Hash Join DS_BCAST_INNER  (cost=0.14..6600286.07 rows=8798 width=84)
   Hash Cond: ("outer".catid = "inner".catid)
   -&gt;  XN Seq Scan on event  (cost=0.00..87.98 rows=8798 width=35)
   -&gt;  XN Hash  (cost=0.11..0.11 rows=11 width=49)
         -&gt;  XN Seq Scan on category  (cost=0.00..0.11 rows=11 width=49)</code></pre>
                  <div class="awsdocs-note"><div class="awsdocs-note-title"><awsui-icon name="status-info" variant="link"></awsui-icon><h6>nota</h6></div><div class="awsdocs-note-text"><p>Os recuos alinhados para operadores na saída de EXPLAIN às vezes indicam que aquelas operações não dependem uma das outras e podem começar em paralelo. No exemplo anterior, embora a varredura na tabela EVENT e a operação de hash estejam alinhadas, a varredura de EVENT deve esperar até que a operação de hash seja totalmente concluída.</p></div></div>
                
               <h4 id="merge-join-two-tables">Exemplo: junção de mesclagem de duas tabelas</h4>
                  
                  <p>A seguinte consulta também usa SELECT *, mas faz a junção de SALES e LISTING na coluna LISTID, onde LISTID foi definida tanto como a chave de distribuição quanto a chave de classificação para ambas as tabelas. Um junção de mesclagem é escolhida e nenhuma redistribuição de dados é necessária para a junção (DS_DIST_NONE).</p>
                  <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copiar"><awsui-icon name="copy"></awsui-icon></div></div><code class="">explain select * from sales, listing where sales.listid = listing.listid;
QUERY PLAN
-----------------------------------------------------------------------------
XN Merge Join DS_DIST_NONE  (cost=0.00..6285.93 rows=172456 width=97)
  Merge Cond: ("outer".listid = "inner".listid)
  -&gt;  XN Seq Scan on listing  (cost=0.00..1924.97 rows=192497 width=44)
  -&gt;  XN Seq Scan on sales  (cost=0.00..1724.56 rows=172456 width=53)</code></pre>
                  <p>O seguinte exemplo demonstra os diferentes tipos de junção dentro da mesma consulta. Como no exemplo anterior, a junção de mesclagem de SALES e LISTING ocorre, mas a junção da terceira tabela, EVENT, deve ser uma junção hash com os resultados da junção de mesclagem. Outra vez, a junção hash incorre em custos de transmissão.</p>
                  <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copiar"><awsui-icon name="copy"></awsui-icon></div></div><code class="">explain select * from sales, listing, event
where sales.listid = listing.listid and sales.eventid = event.eventid;
                                  QUERY PLAN
----------------------------------------------------------------------------
XN Hash Join DS_BCAST_INNER  (cost=109.98..3871130276.17 rows=172456 width=132)
  Hash Cond: ("outer".eventid = "inner".eventid)
  -&gt;  XN Merge Join DS_DIST_NONE  (cost=0.00..6285.93 rows=172456 width=97)
        Merge Cond: ("outer".listid = "inner".listid)
        -&gt;  XN Seq Scan on listing  (cost=0.00..1924.97 rows=192497 width=44)
        -&gt;  XN Seq Scan on sales  (cost=0.00..1724.56 rows=172456 width=53)
  -&gt;  XN Hash  (cost=87.98..87.98 rows=8798 width=35)
        -&gt;  XN Seq Scan on event  (cost=0.00..87.98 rows=8798 width=35)</code></pre>
                
               <h4 id="join-aggregate-and-sort-example">Exemplo: junção, agregação e classificação</h4>
                  
                  <p>A seguinte consulta executa a junção hash das tabelas SALES e EVENT, seguidas por operações de agregação e classificação para contabilizar a função SUM agrupada e a cláusula ORDER BY. O operador de classificação inicial executa em paralelo nos nós de computação. Então, o operador de rede envia os resultados ao nó de liderança, onde o operador de mesclagem produz os resultados classificados finais.</p>
                  <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copiar"><awsui-icon name="copy"></awsui-icon></div></div><code class="">explain select eventname, sum(pricepaid) from sales, event 
where sales.eventid=event.eventid group by eventname
order by 2 desc;
                                           QUERY PLAN
---------------------------------------------------------------------------------
 XN Merge  (cost=1002815366604.92..1002815366606.36 rows=576 width=27)
  Merge Key: sum(sales.pricepaid)
  -&gt;  XN Network  (cost=1002815366604.92..1002815366606.36 rows=576 width=27)
        Send to leader
        -&gt;  XN Sort  (cost=1002815366604.92..1002815366606.36 rows=576 width=27)
              Sort Key: sum(sales.pricepaid)
              -&gt;  XN HashAggregate  (cost=2815366577.07..2815366578.51 rows=576 width=27)
                    -&gt;  XN Hash Join DS_BCAST_INNER  (cost=109.98..2815365714.80 rows=172456 width=27)
                          Hash Cond: ("outer".eventid = "inner".eventid)
                          -&gt;  XN Seq Scan on sales  (cost=0.00..1724.56 rows=172456 width=14)
                          -&gt;  XN Hash  (cost=87.98..87.98 rows=8798 width=21)
                                -&gt;  XN Seq Scan on event  (cost=0.00..87.98 rows=8798 width=21)</code></pre>
                
             
            <h3 id="data-redistribution">Redistribuição de dados</h3>
               
               <p>A saída EXPLAIN para junções também especifica um método de como os dados serão movidos em torno de um cluster para facilitar a junção. Esta movimentação de dados pode ser uma transmissão ou uma redistribuição. Em uma transmissão, os valores dos dados de um lado de uma junção são copiados de cada nó de computação para todos os outros nós de computação, de forma que todos os nós de computação tenham uma cópia completa dos dados. Em uma redistribuição, os valores dos dados participantes são enviados de sua fatia atual para uma nova fatia (possivelmente em um nó diferente). Os dados são tipicamente redistribuídos para corresponder à chave de distribuição de outra tabela que participa da junção se aquela chave de distribuição for uma das colunas de junção. Se nenhuma das tabelas possui chaves de distribuição em uma das colunas de junção, ambas as tabelas são distribuídas ou a tabela interna é transmitida para cada nó.</p>
               <p>A saída EXPLAIN também faz referência à tabelas internas e externas. A varredura da tabela interna é realizada primeiro e aparece mais próximo da parte inferior do plano de consulta. A tabela interna é a tabela que é examinada quanto a correspondências. Ela é geralmente mantida na memória e normalmente é a tabela de origem para hashing e, se possível, é a menor das duas tabelas da junção. A tabela externa é a origem das linhas para correspondência na tabela interna. Ela é geralmente lida a partir do disco. O otimizador de consulta escolhe a tabela interna e externa com base em estatísticas do banco de dados e do comando ANALYZE executado mais recentemente. A ordem das tabelas na cláusula FROM de uma consulta não determina qual tabela é interna e qual é externa.</p>
               <p>Use the following attributes in query plans to identify how data is moved to facilitate a query:</p>
               <div class="itemizedlist">
                   
                   
                   
                   
                   
                   
                   
               <ul class="itemizedlist"><li class="listitem">
                     <p><span class="topcom">DS_BCAST_INNER</span></p>
                     <p>Uma cópia de toda a tabela interna é transmitida a todos os nós de computação.</p>
                  </li><li class="listitem">
                     <p><span class="topcom">DS_DIST_ALL_NONE</span></p>
                     <p>Nenhuma redistribuição é necessária, pois a tabela interna já foi distribuída a todos os nós usando DISTSTYLE ALL.</p>
                  </li><li class="listitem">
                     <p><span class="topcom">DS_DIST_NONE</span></p>
                     <p>Nenhuma tabela é redistribuída. As junções colocadas são possíveis pois as fatias correspondentes são juntadas sem movimentação de dados entre nós.</p>
                  </li><li class="listitem">
                     <p><span class="topcom">DS_DIST_INNER</span></p>
                     <p>A tabela interna é redistribuída.</p>
                  </li><li class="listitem">
                     <p><span class="topcom">DS_DIST_OUTER</span></p>
                     <p>A tabela externa é redistribuída.</p>
                  </li><li class="listitem">
                     <p><span class="topcom">DS_DIST_ALL_INNER</span></p>
                     <p>Toda a tabela interna é redistribuída a uma única fatia, pois a tabela externa usa DISTSTYLE ALL.</p>
                  </li><li class="listitem">
                     <p><span class="topcom">DS_DIST_BOTH</span></p>
                     <p>Ambas as tabelas são redistribuídas.</p>
                  </li></ul></div>
             
         <awsdocs-copyright class="copyright-print"></awsdocs-copyright><awsdocs-thumb-feedback right-edge="{{$ctrl.thumbFeedbackRightEdge}}"></awsdocs-thumb-feedback></div><noscript><div><div><div><div id="js_error_message"><p><img src="https://d1ge0kk1l5kms0.cloudfront.net/images/G/01/webservices/console/warning.png" alt="Atenção" /> <strong>O Javascript está desativado ou não está disponível no seu navegador.</strong></p><p>Para usar a documentação da AWS, o Javascript deve estar ativado. Consulte as páginas de Ajuda do navegador para obter instruções.</p></div></div></div></div></noscript><div id="main-col-footer" class="awsui-util-font-size-0"><div id="doc-conventions"><a target="_top" href="/general/latest/gr/docconventions.html">Convenções do documento</a></div><div class="prev-next"><div id="previous" class="prev-link" accesskey="p" href="./c-query-planning.html">Planejamento de consulta e fluxo de trabalho de execução</div><div id="next" class="next-link" accesskey="n" href="./reviewing-query-plan-steps.html">Revisar as etapas do plano de consulta</div></div></div><awsdocs-page-utilities></awsdocs-page-utilities></div><div id="quick-feedback-yes" style="display: none;"><div class="title">Essa página foi útil? - Sim</div><div class="content"><p>Obrigado por nos informar que estamos fazendo um bom trabalho!</p><p>Se tiver tempo, conte-nos sobre o que você gostou para que possamos melhorar ainda mais.</p><p><awsui-button id="fblink" rel="noopener noreferrer" target="_blank" text="Feedback" click="linkClick($event)" href="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=Redshift&amp;topic_url=https://docs.aws.amazon.com/pt_br/redshift/latest/dg/c-the-query-plan.html"></awsui-button></p></div></div><div id="quick-feedback-no" style="display: none;"><div class="title">Essa página foi útil? - Não</div><div class="content"><p>Obrigado por nos informar que precisamos melhorar a página. Lamentamos ter decepcionado você.</p><p>Se tiver tempo, conte-nos como podemos melhorar a documentação.</p><p><awsui-button id="fblink" rel="noopener noreferrer" target="_blank" text="Feedback" click="linkClick($event)" href="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=Redshift&amp;topic_url=https://docs.aws.amazon.com/pt_br/redshift/latest/dg/c-the-query-plan.html"></awsui-button></p></div></div></div></body></div></awsdocs-view><div class="page-loading-indicator" id="page-loading-indicator"><awsui-spinner size="large"></awsui-spinner></div></div><div id="tools-panel" dom-region="tools"><awsdocs-tools-panel id="awsdocs-tools-panel"></awsdocs-tools-panel></div></awsui-app-layout><awsdocs-cookie-banner class="doc-cookie-banner"></awsdocs-cookie-banner></div></body></html>