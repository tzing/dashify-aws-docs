<!DOCTYPE html>
    <html xmlns="http://www.w3.org/1999/xhtml" lang="pt-BR"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Exemplos de COPY - Amazon Redshift</title><meta name="viewport" content="width=device-width,initial-scale=1" /><meta name="assets_root" content="/assets" /><meta name="target_state" content="r_COPY_command_examples" /><meta name="default_state" content="r_COPY_command_examples" /><link rel="icon" type="image/ico" href="/assets/images/favicon.ico" /><link rel="shortcut icon" type="image/ico" href="/assets/images/favicon.ico" /><link rel="canonical" href="https://docs.aws.amazon.com/pt_br/redshift/latest/dg/r_COPY_command_examples.html" /><meta name="description" content="Fornece exemplos de como usar COPY para carregar dados de uma grande variedade de fontes." /><meta name="deployment_region" content="IAD" /><meta name="product" content="Amazon Redshift" /><meta name="guide" content="Guia do desenvolvedor de banco de dados" /><meta name="abstract" content="Crie e gerencie um data warehouse com o Amazon Redshift, um serviço de data warehouse totalmente gerenciado, em escala de petabyte e de nível empresarial." /><meta name="guide-locale" content="pt_br" /><meta name="tocs" content="toc-contents.json" /><link rel="canonical" href="https://docs.aws.amazon.com/pt_br/redshift/latest/dg/r_COPY_command_examples.html" /><link rel="alternative" href="https://docs.aws.amazon.com/id_id/redshift/latest/dg/r_COPY_command_examples.html" hreflang="id-id" /><link rel="alternative" href="https://docs.aws.amazon.com/id_id/redshift/latest/dg/r_COPY_command_examples.html" hreflang="id" /><link rel="alternative" href="https://docs.aws.amazon.com/de_de/redshift/latest/dg/r_COPY_command_examples.html" hreflang="de-de" /><link rel="alternative" href="https://docs.aws.amazon.com/de_de/redshift/latest/dg/r_COPY_command_examples.html" hreflang="de" /><link rel="alternative" href="https://docs.aws.amazon.com/redshift/latest/dg/r_COPY_command_examples.html" hreflang="en-us" /><link rel="alternative" href="https://docs.aws.amazon.com/redshift/latest/dg/r_COPY_command_examples.html" hreflang="en" /><link rel="alternative" href="https://docs.aws.amazon.com/es_es/redshift/latest/dg/r_COPY_command_examples.html" hreflang="es-es" /><link rel="alternative" href="https://docs.aws.amazon.com/es_es/redshift/latest/dg/r_COPY_command_examples.html" hreflang="es" /><link rel="alternative" href="https://docs.aws.amazon.com/fr_fr/redshift/latest/dg/r_COPY_command_examples.html" hreflang="fr-fr" /><link rel="alternative" href="https://docs.aws.amazon.com/fr_fr/redshift/latest/dg/r_COPY_command_examples.html" hreflang="fr" /><link rel="alternative" href="https://docs.aws.amazon.com/it_it/redshift/latest/dg/r_COPY_command_examples.html" hreflang="it-it" /><link rel="alternative" href="https://docs.aws.amazon.com/it_it/redshift/latest/dg/r_COPY_command_examples.html" hreflang="it" /><link rel="alternative" href="https://docs.aws.amazon.com/ja_jp/redshift/latest/dg/r_COPY_command_examples.html" hreflang="ja-jp" /><link rel="alternative" href="https://docs.aws.amazon.com/ja_jp/redshift/latest/dg/r_COPY_command_examples.html" hreflang="ja" /><link rel="alternative" href="https://docs.aws.amazon.com/ko_kr/redshift/latest/dg/r_COPY_command_examples.html" hreflang="ko-kr" /><link rel="alternative" href="https://docs.aws.amazon.com/ko_kr/redshift/latest/dg/r_COPY_command_examples.html" hreflang="ko" /><link rel="alternative" href="https://docs.aws.amazon.com/pt_br/redshift/latest/dg/r_COPY_command_examples.html" hreflang="pt-br" /><link rel="alternative" href="https://docs.aws.amazon.com/pt_br/redshift/latest/dg/r_COPY_command_examples.html" hreflang="pt" /><link rel="alternative" href="https://docs.aws.amazon.com/zh_cn/redshift/latest/dg/r_COPY_command_examples.html" hreflang="zh-cn" /><link rel="alternative" href="https://docs.aws.amazon.com/zh_tw/redshift/latest/dg/r_COPY_command_examples.html" hreflang="zh-tw" /><link rel="alternative" href="https://docs.aws.amazon.com/redshift/latest/dg/r_COPY_command_examples.html" hreflang="x-default" /><meta name="feedback-item" content="Redshift" /><meta name="this_doc_product" content="Amazon Redshift" /><meta name="this_doc_guide" content="Guia do desenvolvedor de banco de dados" /><script defer="" src="/assets/r/vendor4.js?version=2021.12.02"></script><script defer="" src="/assets/r/vendor3.js?version=2021.12.02"></script><script defer="" src="/assets/r/vendor1.js?version=2021.12.02"></script><script defer="" src="/assets/r/awsdocs-common.js?version=2021.12.02"></script><script defer="" src="/assets/r/awsdocs-doc-page.js?version=2021.12.02"></script><link href="/assets/r/vendor4.css?version=2021.12.02" rel="stylesheet" /><link href="/assets/r/awsdocs-common.css?version=2021.12.02" rel="stylesheet" /><link href="/assets/r/awsdocs-doc-page.css?version=2021.12.02" rel="stylesheet" /><script async="" id="awsc-panorama-bundle" type="text/javascript" src="https://prod.pa.cdn.uis.awsstatic.com/panorama-nav-init.js" data-config="{'appEntity':'aws-documentation','region':'us-east-1','service':'redshift'}"></script><meta id="panorama-serviceSubSection" value="Guia do desenvolvedor de banco de dados" /><meta id="panorama-serviceConsolePage" value="Exemplos de COPY" /></head><body class="awsdocs awsui"><div class="awsdocs-container"><awsdocs-header></awsdocs-header><awsui-app-layout id="app-layout" class="awsui-util-no-gutters" ng-controller="ContentController as $ctrl" header-selector="awsdocs-header" navigation-hide="false" navigation-width="$ctrl.navWidth" navigation-open="$ctrl.navOpen" navigation-change="$ctrl.onNavChange($event)" tools-hide="$ctrl.hideTools" tools-width="$ctrl.toolsWidth" tools-open="$ctrl.toolsOpen" tools-change="$ctrl.onToolsChange($event)"><div id="guide-toc" dom-region="navigation"><awsdocs-toc></awsdocs-toc></div><div id="main-column" dom-region="content" tabindex="-1"><awsdocs-view class="awsdocs-view"><div id="awsdocs-content"><head><title>Exemplos de COPY - Amazon Redshift</title><meta name="pdf" content="redshift-dg.pdf#r_COPY_command_examples" /><meta name="rss" content="Dochistory.rss" /><meta name="forums" content="http://forums.aws.amazon.com/forum.jspa?forumID=155" /><meta name="feedback" content="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=Redshift&amp;topic_url=https://docs.aws.amazon.com/pt_br/redshift/latest/dg/r_COPY_command_examples.html" /><meta name="feedback-yes" content="feedbackyes.html?topic_url=https://docs.aws.amazon.com/pt_br/redshift/latest/dg/r_COPY_command_examples.html" /><meta name="feedback-no" content="feedbackno.html?topic_url=https://docs.aws.amazon.com/pt_br/redshift/latest/dg/r_COPY_command_examples.html" /><meta name="keywords" content="Amazon Redshift,AWS Redshift,Redshift,Redshift Spectrum,cluster,data warehouse,desenvolvedor,dados de amostra,banco de dados,desenvolvedor do banco de dados,HLL" /><script type="application/ld+json">
{
    "@context" : "https://schema.org",
    "@type" : "BreadcrumbList",
    "itemListElement" : [
      {
        "@type" : "ListItem",
        "position" : 1,
        "name" : "AWS",
        "item" : "https://aws.amazon.com"
      },
      {
        "@type" : "ListItem",
        "position" : 2,
        "name" : "Amazon Redshift",
        "item" : "https://docs.aws.amazon.com/redshift/index.html"
      },
      {
        "@type" : "ListItem",
        "position" : 3,
        "name" : "Guia do desenvolvedor de banco de dados",
        "item" : "https://docs.aws.amazon.com/pt_br/redshift/latest/dg"
      },
      {
        "@type" : "ListItem",
        "position" : 4,
        "name" : "Referência SQL",
        "item" : "https://docs.aws.amazon.com/pt_br/redshift/latest/dg/cm_chap_SQLCommandRef.html"
      },
      {
        "@type" : "ListItem",
        "position" : 5,
        "name" : "Comandos SQL",
        "item" : "https://docs.aws.amazon.com/pt_br/redshift/latest/dg/c_SQL_commands.html"
      },
      {
        "@type" : "ListItem",
        "position" : 6,
        "name" : "COPY",
        "item" : "https://docs.aws.amazon.com/pt_br/redshift/latest/dg/r_COPY.html"
      },
      {
        "@type" : "ListItem",
        "position" : 7,
        "name" : "Exemplos de COPY",
        "item" : "https://docs.aws.amazon.com/pt_br/redshift/latest/dg/r_COPY.html"
      }
    ]
}
</script></head><body><div id="main"><div style="display: none"><a href="redshift-dg.pdf#r_COPY_command_examples" target="_blank" rel="noopener noreferrer" title="Abrir em PDF"></a></div><div id="breadcrumbs" class="breadcrumb"><a href="https://aws.amazon.com">AWS</a><a href="/index.html">Documentação</a><a href="/redshift/index.html">Amazon Redshift</a><a href="welcome.html">Guia do desenvolvedor de banco de dados</a></div><div id="page-toc-src"><a href="#r_COPY_command_examples-load-favoritemovies-from-an-amazon-dynamodb-table">Carregar FAVORITEMOVIES de uma tabela do DynamoDB</a><a href="#r_COPY_command_examples-load-listing-from-an-amazon-s3-bucket">Carregar LISTING de um bucket do Amazon S3</a><a href="#copy-command-examples-emr">Carregar LISTING de um cluster do Amazon EMR</a><a href="#copy-command-examples-manifest">Uso de um manifesto para especificar arquivos de dados</a><a href="#r_COPY_command_examples-load-listing-from-a-pipe-delimited-file-default-delimiter">Carregar LISTING de um arquivo delimitado por barras (delimitador padrão)</a><a href="#r_COPY_command_examples-load-listing-from-parquet">Carregar LISTING usando dados de colunas no formato Parquet</a><a href="#r_COPY_command_examples-load-listing-from-orc">Carregar LISTING usando dados de colunas no formato ORC</a><a href="#r_COPY_command_examples-load-event-with-options">Carregar EVENT com opções</a><a href="#r_COPY_command_examples-load-venue-from-a-fixed-width-data-file">Carregar VENUE de um arquivo de dados de largura fixa</a><a href="#load-from-csv">Carregar CATEGORY de um arquivo CSV</a><a href="#r_COPY_command_examples-load-venue-with-explicit-values-for-an-identity-column">Carregar VENUE com valores explícitos para uma coluna IDENTITY</a><a href="#r_COPY_command_examples-load-time-from-a-pipe-delimited-gzip-file">Carregar TIME de um arquivo GZIP delimitado por barras</a><a href="#r_COPY_command_examples-load-a-time-datestamp">Carregar um time stamp ou date stamp</a><a href="#r_COPY_command_examples-load-data-from-a-file-with-default-values">Carregar dados de um arquivo com valores padrão</a><a href="#r_COPY_command_examples-copy-data-with-the-escape-option">Dados de COPY com a opção ESCAPE</a><a href="#r_COPY_command_examples-copy-from-json">Copiar de exemplos JSON</a><a href="#r_COPY_command_examples-copy-from-avro">Copiar de exemplos Avro</a><a href="#r_COPY_preparing_data">Preparar arquivos para COPY com a opção ESCAPE</a><a href="#copy-example-spatial-copy-shapefile">Carregar um shapefile</a><a href="#r_COPY_command_examples-load-noload-option">Comando COPY com a opção NOLOAD</a></div><div id="main-content" class="awsui-util-container"><div id="main-col-body"><awsdocs-language-banner data-service="$ctrl.pageService"></awsdocs-language-banner><h1 class="topictitle" id="r_COPY_command_examples">Exemplos de COPY</h1><div class="awsdocs-page-header-container"><awsdocs-page-header></awsdocs-page-header><awsdocs-filter-selector id="awsdocs-filter-selector"></awsdocs-filter-selector></div><div class="awsdocs-note"><div class="awsdocs-note-title"><awsui-icon name="status-info" variant="link"></awsui-icon><h6>nota</h6></div><div class="awsdocs-note-text"><p>Estes exemplos contêm quebras de linha para garantir legibilidade. Não inclua quebras de linha nem espaços na string <em>credentials-args</em>.</p></div></div><div class="highlights" id="inline-topiclist"><h6>Tópicos</h6><ul><li><a href="#r_COPY_command_examples-load-favoritemovies-from-an-amazon-dynamodb-table">Carregar FAVORITEMOVIES de uma tabela do DynamoDB</a></li><li><a href="#r_COPY_command_examples-load-listing-from-an-amazon-s3-bucket">Carregar LISTING de um bucket do Amazon S3</a></li><li><a href="#copy-command-examples-emr">Carregar LISTING de um cluster do Amazon EMR</a></li><li><a href="#copy-command-examples-manifest">Uso de um manifesto para especificar arquivos de dados</a></li><li><a href="#r_COPY_command_examples-load-listing-from-a-pipe-delimited-file-default-delimiter">Carregar LISTING de um arquivo delimitado por barras (delimitador padrão)</a></li><li><a href="#r_COPY_command_examples-load-listing-from-parquet">Carregar LISTING usando dados de colunas no formato Parquet</a></li><li><a href="#r_COPY_command_examples-load-listing-from-orc">Carregar LISTING usando dados de colunas no formato ORC</a></li><li><a href="#r_COPY_command_examples-load-event-with-options">Carregar EVENT com opções</a></li><li><a href="#r_COPY_command_examples-load-venue-from-a-fixed-width-data-file">Carregar VENUE de um arquivo de dados de largura fixa</a></li><li><a href="#load-from-csv">Carregar CATEGORY de um arquivo CSV</a></li><li><a href="#r_COPY_command_examples-load-venue-with-explicit-values-for-an-identity-column">Carregar VENUE com valores explícitos para uma coluna IDENTITY</a></li><li><a href="#r_COPY_command_examples-load-time-from-a-pipe-delimited-gzip-file">Carregar TIME de um arquivo GZIP delimitado por barras</a></li><li><a href="#r_COPY_command_examples-load-a-time-datestamp">Carregar um time stamp ou date stamp</a></li><li><a href="#r_COPY_command_examples-load-data-from-a-file-with-default-values">Carregar dados de um arquivo com valores padrão</a></li><li><a href="#r_COPY_command_examples-copy-data-with-the-escape-option">Dados de COPY com a opção ESCAPE</a></li><li><a href="#r_COPY_command_examples-copy-from-json">Copiar de exemplos JSON</a></li><li><a href="#r_COPY_command_examples-copy-from-avro">Copiar de exemplos Avro</a></li><li><a href="#r_COPY_preparing_data">Preparar arquivos para COPY com a opção ESCAPE</a></li><li><a href="#copy-example-spatial-copy-shapefile">Carregar um shapefile no Amazon Redshift</a></li><li><a href="#r_COPY_command_examples-load-noload-option">Comando COPY com a opção NOLOAD</a></li></ul></div>
         <h2 id="r_COPY_command_examples-load-favoritemovies-from-an-amazon-dynamodb-table">Carregar FAVORITEMOVIES de uma tabela do DynamoDB</h2>


         <p>Os SDKs da AWS incluem um exemplo simples de como criar uma tabela do DynamoDB chamada <em>Movies</em>. (Para esse exemplo, consulte <a href="https://docs.aws.amazon.com/amazondynamodb/latest/developerguide/GettingStarted.html">Conceitos básicos do DynamoDB</a>.) O exemplo a seguir carrega a tabela MOVIES do Amazon Redshift com dados da tabela do DynamoDB. A tabela do Amazon Redshift já deve existir no banco de dados.</p>
         <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copiar"><awsui-icon name="copy"></awsui-icon></div></div><code class="">copy favoritemovies from 'dynamodb://Movies'
iam_role 'arn:aws:iam::0123456789012:role/MyRedshiftRole' 
readratio 50;</code></pre>
       
         <h2 id="r_COPY_command_examples-load-listing-from-an-amazon-s3-bucket">Carregar LISTING de um bucket do Amazon S3</h2>


         <p>O exemplo a seguir carrega LISTING de um bucket do Amazon S3. O comando COPY carrega todos os arquivos na pasta <code class="code">/data/listing/</code>.</p>
         <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copiar"><awsui-icon name="copy"></awsui-icon></div></div><code class="">copy listing
from 's3://mybucket/data/listing/' 
iam_role 'arn:aws:iam::0123456789012:role/MyRedshiftRole';</code></pre>
       
         <h2 id="copy-command-examples-emr">Carregar LISTING de um cluster do Amazon EMR</h2>

         <p>O exemplo a seguir carrega a tabela SALES com dados delimitados por tabulação de arquivos compactados por lzop em um cluster do Amazon EMR. COPY carrega cada arquivo na pasta <code class="code">myoutput/</code> que começa com <code class="code">part-</code>.</p>
         <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copiar"><awsui-icon name="copy"></awsui-icon></div></div><code class="">copy sales
from 'emr://j-SAMPLE2B500FC/myoutput/part-*' 
iam_role 'arn:aws:iam::0123456789012:role/MyRedshiftRole'
delimiter '\t' lzop;</code></pre>
         <p>O exemplo a seguir carrega a tabela SALES com dados formatados JSON em um cluster do Amazon EMR. COPY carrega cada arquivo na pasta <code class="code">myoutput/json/</code>.</p>
         <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copiar"><awsui-icon name="copy"></awsui-icon></div></div><code class="">copy sales
from 'emr://j-SAMPLE2B500FC/myoutput/json/' 
iam_role 'arn:aws:iam::0123456789012:role/MyRedshiftRole'
JSON 's3://mybucket/jsonpaths.txt';</code></pre>
       
         <h2 id="copy-command-examples-manifest">Uso de um manifesto para especificar arquivos de dados</h2>

         <p>Você pode usar um manifesto para garantir que o comando COPY carregue todos os arquivos necessários, e somente os arquivos necessários, do Amazon S3. Você também pode usar um manifesto ao precisar carregar vários arquivos de buckets diferentes ou arquivos que não tenham o mesmo prefixo. </p>
         <p>Por exemplo, suponha que você precise carregar os seguintes três arquivos: <code class="code">custdata1.txt</code>, <code class="code">custdata2.txt</code> e <code class="code">custdata3.txt</code>. Você pode usar o seguinte comando para carregar todos os arquivos em <code class="code">mybucket</code> que comecem com <code class="code">custdata</code> especificando um prefixo: </p>
         <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copiar"><awsui-icon name="copy"></awsui-icon></div></div><code class="">copy category
from 's3://mybucket/custdata' 
iam_role 'arn:aws:iam::0123456789012:role/MyRedshiftRole';</code></pre>
         <p>Se somente dois dos arquivos existirem por causa de um erro, COPY carrega somente esses dois arquivos e será concluído com êxito, resultando em uma carga de dados incompleta. Se o bucket também contiver um arquivo indesejado que acabe usando o mesmo prefixo, como um arquivo chamado <code class="code">custdata.backup</code> por exemplo, COPY carregará esse arquivo também, resultando no carregamento de dados indesejados.</p>
         <p>Para garantir que todos os arquivos necessários sejam carregados e para evitar que arquivos indesejados sejam carregados, você pode usar um arquivo manifesto. O manifesto é um arquivo de texto formatado em JSON que lista os arquivos a serem processados pelo comando COPY. Por exemplo, o manifesto a seguir carrega os três arquivos no exemplo anterior.</p>
         <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copiar"><awsui-icon name="copy"></awsui-icon></div></div><code class=""><span>{</span>  
   "entries":[  
      <span>{</span>  
         "url":"s3://mybucket/custdata.1",
         "mandatory":true
      },
      <span>{</span>  
         "url":"s3://mybucket/custdata.2",
         "mandatory":true
      },
      <span>{</span>  
         "url":"s3://mybucket/custdata.3",
         "mandatory":true
      }
   ]
}</code></pre>
         <p>O sinalizador <code class="code">mandatory</code> opcional indica se COPY deverá ser encerrado se o arquivo não existir. O padrão é <code class="code">false</code>. Independentemente de qualquer configuração obrigatória, o COPY encerra se nenhum arquivo for encontrado. Neste exemplo, COPY retornará um erro se algum dos arquivos não for encontrado. Arquivos indesejados que possam ter sido escolhidos se você tiver especificado somente um prefixo de chaves, como <code class="code">custdata.backup</code>, são ignorados, pois não estão no manifesto. </p>
         <p>Ao carregar arquivos de dados em ORC ou em formato Parquet, um campo <code class="code">meta</code> é necessário, conforme exibido no seguinte exemplo.</p>
         <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copiar"><awsui-icon name="copy"></awsui-icon></div></div><code class=""><span>{</span>  
   "entries":[  
      <span>{</span>  
         "url":"s3://mybucket-alpha/orc/2013-10-04-custdata",
         "mandatory":true,
         "meta":<span>{</span>  
            "content_length":99
         }
      },
      <span>{</span>  
         "url":"s3://mybucket-beta/orc/2013-10-05-custdata",
         "mandatory":true,
         "meta":<span>{</span>  
            "content_length":99
         }
      }
   ]
}</code></pre>
         <p>O exemplo a seguir usa um manifesto nomeado <code class="code">cust.manifest</code>. </p>
         <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copiar"><awsui-icon name="copy"></awsui-icon></div></div><code class="">copy customer
from 's3://mybucket/cust.manifest' 
iam_role 'arn:aws:iam::0123456789012:role/MyRedshiftRole'
format as orc
manifest;</code></pre>
         <p>Você pode usar um manifesto para carregar vários arquivos de buckets diferentes ou arquivos que não compartilham o mesmo prefixo. O exemplo a seguir mostra o JSON para carregar dados com arquivos cujos nomes começam com uma data e hora.</p>
         <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copiar"><awsui-icon name="copy"></awsui-icon></div></div><code class=""><span>{</span>
  "entries": [
    <span>{</span>"url":"s3://mybucket/2013-10-04-custdata.txt","mandatory":true},
    <span>{</span>"url":"s3://mybucket/2013-10-05-custdata.txt","mandatory":true},
    <span>{</span>"url":"s3://mybucket/2013-10-06-custdata.txt","mandatory":true},
    <span>{</span>"url":"s3://mybucket/2013-10-07-custdata.txt","mandatory":true}
  ]
}</code></pre>
         <p>O manifesto pode listar arquivos em buckets diferentes, desde que os buckets estejam na mesma região da AWS do cluster. </p>
         <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copiar"><awsui-icon name="copy"></awsui-icon></div></div><code class=""><span>{</span>
  "entries": [
    <span>{</span>"url":"s3://mybucket-alpha/custdata1.txt","mandatory":false},
    <span>{</span>"url":"s3://mybucket-beta/custdata1.txt","mandatory":false},
    <span>{</span>"url":"s3://mybucket-beta/custdata2.txt","mandatory":false}
  ]
}</code></pre>
       
         <h2 id="r_COPY_command_examples-load-listing-from-a-pipe-delimited-file-default-delimiter">Carregar LISTING de um arquivo delimitado por barras (delimitador padrão)</h2>


         <p>O exemplo a seguir é um caso muito simples em que nenhuma opção é especificada e o arquivo de entrada contém o delimitador padrão, um caractere de barra ('|'). </p>
         <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copiar"><awsui-icon name="copy"></awsui-icon></div></div><code class="">copy listing 
from 's3://mybucket/data/listings_pipe.txt' 
iam_role 'arn:aws:iam::0123456789012:role/MyRedshiftRole';</code></pre>
       
         <h2 id="r_COPY_command_examples-load-listing-from-parquet">Carregar LISTING usando dados de colunas no formato Parquet</h2>
         <p>O exemplo a seguir carrega dados de uma pasta no Amazon S3, chamada Parquet. </p>
         <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copiar"><awsui-icon name="copy"></awsui-icon></div></div><code class="">copy listing 
from 's3://mybucket/data/listings/parquet/' 
iam_role 'arn:aws:iam::0123456789012:role/MyRedshiftRole'
format as parquet;</code></pre>
       
         <h2 id="r_COPY_command_examples-load-listing-from-orc">Carregar LISTING usando dados de colunas no formato ORC</h2>
         <p>O exemplo a seguir carrega dados de uma pasta no Amazon S3, chamada <code class="code">orc</code>. </p>
         <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copiar"><awsui-icon name="copy"></awsui-icon></div></div><code class="">copy listing 
from 's3://mybucket/data/listings/orc/' 
iam_role 'arn:aws:iam::0123456789012:role/MyRedshiftRole'
format as orc;</code></pre>
       
         <h2 id="r_COPY_command_examples-load-event-with-options">Carregar EVENT com opções</h2>


         <p>O exemplo a seguir carrega dados delimitados por barra na tabela EVENT e aplica as seguintes regras: </p>
         <div class="itemizedlist">
             
             
             
             
         <ul class="itemizedlist"><li class="listitem">
               <p>Se forem usados para todas as strings de caracteres, os pares de aspas serão removidos.</p>
            </li><li class="listitem">
               <p>As strings vazias e as que contêm espaços em branco serão carregadas como valores NULL.</p>
            </li><li class="listitem">
               <p>A carga falha se mais de 5 erros forem retornados.</p>
            </li><li class="listitem">
               <p>Os valores de data e hora devem respeitar o formato especificado; por exemplo, uma data e hora válida é <code class="code">2008-09-26 05:43:12</code>.</p>
            </li></ul></div>
         <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copiar"><awsui-icon name="copy"></awsui-icon></div></div><code class="">copy event
from 's3://mybucket/data/allevents_pipe.txt' 
iam_role 'arn:aws:iam::0123456789012:role/MyRedshiftRole' 
removequotes
emptyasnull
blanksasnull
maxerror 5
delimiter '|'
timeformat 'YYYY-MM-DD HH:MI:SS';</code></pre>
       
         <h2 id="r_COPY_command_examples-load-venue-from-a-fixed-width-data-file">Carregar VENUE de um arquivo de dados de largura fixa</h2>


         <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copiar"><awsui-icon name="copy"></awsui-icon></div></div><code class="">copy venue
from 's3://mybucket/data/venue_fw.txt' 
iam_role 'arn:aws:iam::0123456789012:role/MyRedshiftRole'
fixedwidth 'venueid:3,venuename:25,venuecity:12,venuestate:2,venueseats:6';</code></pre>
         <p>O exemplo anterior pressupõe um arquivo de dados formatado da mesma maneira que os dados de exemplo mostrados. No exemplo a seguir, os espaços funcionam como espaços reservados, de maneira que todas as colunas tenham a mesma largura conforme observado na especificação: </p>
         <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copiar"><awsui-icon name="copy"></awsui-icon></div></div><code class="">1  Toyota Park              Bridgeview  IL0
2  Columbus Crew Stadium    Columbus    OH0
3  RFK Stadium              Washington  DC0
4  CommunityAmerica BallparkKansas City KS0
5  Gillette Stadium         Foxborough  MA68756</code></pre>
       
         <h2 id="load-from-csv">Carregar CATEGORY de um arquivo CSV</h2>

         <p>Suponhamos que você queira carregar CATEGORY com os valores mostrados na tabela a seguir.</p>
         <div class="table-container"><div class="table-contents"><table id="w319aac47b9c67c31c25b5"><thead>
                  <tr>
                     <th>catid</th>
                     <th>catgroup</th>
                     <th>catname</th>
                     <th>catdesc </th>
                  </tr>
               </thead>
                  <tr>
                     <td tabindex="-1">12</td>
                     <td tabindex="-1">Shows </td>
                     <td tabindex="-1">Musicais</td>
                     <td tabindex="-1">Casa de espetáculo</td>
                  </tr>
                  <tr>
                     <td tabindex="-1">13</td>
                     <td tabindex="-1">Shows</td>
                     <td tabindex="-1">Peças</td>
                     <td tabindex="-1">Todos os teatros "não musicais"</td>
                  </tr>
                  <tr>
                     <td tabindex="-1">14</td>
                     <td tabindex="-1">Shows</td>
                     <td tabindex="-1">Opera</td>
                     <td tabindex="-1">Todas as óperas, leves e óperas "rock"</td>
                  </tr>
                  <tr>
                     <td tabindex="-1">15</td>
                     <td tabindex="-1">Concertos</td>
                     <td tabindex="-1">Clássicos </td>
                     <td tabindex="-1">Todas as sinfonias, os concertos e os corais</td>
                  </tr>

               </table></div></div>
         <p>O exemplo a seguir mostra o conteúdo de um arquivo de texto com os valores de campo separados por vírgulas.</p>
         <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copiar"><awsui-icon name="copy"></awsui-icon></div></div><code class="">12,Shows,Musicals,Musical theatre
13,Shows,Plays,All "non-musical" theatre  
14,Shows,Opera,All opera, light, and "rock" opera
15,Concerts,Classical,All symphony, concerto, and choir concerts</code></pre>
         <p>Se você carregar o arquivo usando o parâmetro DELIMITER para especificar uma entrada delimitada por vírgulas, o comando COPY falha porque alguns campos de entrada contêm vírgulas. Você pode evitar esse problema usando o parâmetro CSV e colocando os campos que contenham vírgulas entre aspas. Se as aspas forem exibidas dentro de uma string com aspas, você precisará escapá-las dobrando as aspas. Como as aspas padrão são duplas, você precisa escapar todas as aspas duplas com aspas adicionais. O novo arquivo de entrada é algo assim. </p>
         <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copiar"><awsui-icon name="copy"></awsui-icon></div></div><code class="">12,Shows,Musicals,Musical theatre
13,Shows,Plays,"All ""non-musical"" theatre"
14,Shows,Opera,"All opera, light, and ""rock"" opera"
15,Concerts,Classical,"All symphony, concerto, and choir concerts"</code></pre>
         <p>Supondo que o nome de arquivo seja <code class="code">category_csv.txt</code>, você pode carregar o arquivo usando o seguinte comando COPY:</p>
         <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copiar"><awsui-icon name="copy"></awsui-icon></div></div><code class="">copy category
from 's3://mybucket/data/category_csv.txt' 
iam_role 'arn:aws:iam::0123456789012:role/MyRedshiftRole' 
csv;</code></pre>
         <p>Como alternativa, para evitar a necessidade de escapar as aspas duplas na entrada, você pode especificar aspas diferentes usando o parâmetro QUOTE AS. Por exemplo, a versão a seguir de <code class="code">category_csv.txt</code> usa '<code class="code">%</code>' como aspas.</p>
         <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copiar"><awsui-icon name="copy"></awsui-icon></div></div><code class="">12,Shows,Musicals,Musical theatre
13,Shows,Plays,%All "non-musical" theatre%
14,Shows,Opera,%All opera, light, and "rock" opera%
15,Concerts,Classical,%All symphony, concerto, and choir concerts%</code></pre>
         <p>O seguinte comando COPY usa QUOTE AS para carregar <code class="code">category_csv.txt</code>:</p>
         <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copiar"><awsui-icon name="copy"></awsui-icon></div></div><code class="">copy category
from 's3://mybucket/data/category_csv.txt' 
iam_role 'arn:aws:iam::0123456789012:role/MyRedshiftRole' 
csv quote as '%';</code></pre>
       
         <h2 id="r_COPY_command_examples-load-venue-with-explicit-values-for-an-identity-column">Carregar VENUE com valores explícitos para uma coluna IDENTITY</h2>


         <p>O exemplo a seguir pressupõe que, quando a tabela VENUE foi criada, pelo menos uma coluna (como a coluna <code class="code">venueid</code>) foi especificada para ser uma coluna IDENTITY. Esse comando substitui o comportamento de IDENTITY padrão de valores gerados automaticamente para uma coluna IDENTITY e, em vez disso, carrega os valores explícitos do arquivo venue.txt. O Amazon Redshift não verifica se valores de IDENTITY duplicados são carregados na tabela ao usar a opção EXLICIT_IDS. </p>
         <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copiar"><awsui-icon name="copy"></awsui-icon></div></div><code class="">copy venue
from 's3://mybucket/data/venue.txt' 
iam_role 'arn:aws:iam::0123456789012:role/MyRedshiftRole'
explicit_ids;</code></pre>
       
         <h2 id="r_COPY_command_examples-load-time-from-a-pipe-delimited-gzip-file">Carregar TIME de um arquivo GZIP delimitado por barras</h2>


         <p>O seguinte exemplo carrega a tabela TIME de um arquivo GZIP delimitado por barras:</p>
         <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copiar"><awsui-icon name="copy"></awsui-icon></div></div><code class="">copy time
from 's3://mybucket/data/timerows.gz' 
iam_role 'arn:aws:iam::0123456789012:role/MyRedshiftRole'
gzip
delimiter '|';</code></pre>
       
         <h2 id="r_COPY_command_examples-load-a-time-datestamp">Carregar um time stamp ou date stamp</h2>


         <p>O exemplo a seguir carrega dados com uma data e hora formatada.</p>
         <div class="awsdocs-note"><div class="awsdocs-note-title"><awsui-icon name="status-info" variant="link"></awsui-icon><h6>nota</h6></div><div class="awsdocs-note-text"><p>O TIMEFORMAT de <code class="code">HH:MI:SS</code> também pode dar suporte a segundos fracionários além do <code class="code">SS</code> para um nível detalhado de microssegundos. O arquivo <code class="code">time.txt</code> usado nesse exemplo contém uma linha <code class="code">2009-01-12
               14:15:57.119568</code>.</p></div></div>
         <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copiar"><awsui-icon name="copy"></awsui-icon></div></div><code class="">copy timestamp1 
from 's3://mybucket/data/time.txt' 
iam_role 'arn:aws:iam::0123456789012:role/MyRedshiftRole'
timeformat 'YYYY-MM-DD HH:MI:SS';</code></pre>
         <p>O resultado dessa cópia é o seguinte: </p>
         <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copiar"><awsui-icon name="copy"></awsui-icon></div></div><code class="">select * from timestamp1;
c1
----------------------------
2009-01-12 14:15:57.119568
(1 row)</code></pre>
       
         <h2 id="r_COPY_command_examples-load-data-from-a-file-with-default-values">Carregar dados de um arquivo com valores padrão</h2>


         <p>O exemplo a seguir usa uma variação da tabela VENUE no banco de dados TICKIT. Leve em consideração uma tabela VENUE_NEW definida com o seguinte comando: </p>
         <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copiar"><awsui-icon name="copy"></awsui-icon></div></div><code class="">create table venue_new(
venueid smallint not null,
venuename varchar(100) not null,
venuecity varchar(30),
venuestate char(2),
venueseats integer not null default '1000');</code></pre>
         <p>Leve em consideração um arquivo de dados venue_noseats.txt que não contenha valores para a coluna VENUESEATS, conforme mostrado no seguinte exemplo: </p>
         <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copiar"><awsui-icon name="copy"></awsui-icon></div></div><code class="">1|Toyota Park|Bridgeview|IL|
2|Columbus Crew Stadium|Columbus|OH|
3|RFK Stadium|Washington|DC|
4|CommunityAmerica Ballpark|Kansas City|KS|
5|Gillette Stadium|Foxborough|MA|
6|New York Giants Stadium|East Rutherford|NJ|
7|BMO Field|Toronto|ON|
8|The Home Depot Center|Carson|CA|
9|Dick's Sporting Goods Park|Commerce City|CO|
10|Pizza Hut Park|Frisco|TX|</code></pre>
         <p>A seguinte instrução COPY carregará com êxito a tabela do arquivo e aplicará o valor DEFAULT ('1000') à coluna omitida: </p>
         <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copiar"><awsui-icon name="copy"></awsui-icon></div></div><code class="">copy venue_new(venueid, venuename, venuecity, venuestate) 
from 's3://mybucket/data/venue_noseats.txt' 
iam_role 'arn:aws:iam::0123456789012:role/MyRedshiftRole'
delimiter '|';</code></pre>
         <p>Agora veja a tabela carregada: </p>
         <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copiar"><awsui-icon name="copy"></awsui-icon></div></div><code class="">select * from venue_new order by venueid;
venueid |         venuename          |    venuecity    | venuestate | venueseats
---------+----------------------------+-----------------+------------+------------
1 | Toyota Park                | Bridgeview      | IL         |       1000
2 | Columbus Crew Stadium      | Columbus        | OH         |       1000
3 | RFK Stadium                | Washington      | DC         |       1000
4 | CommunityAmerica Ballpark  | Kansas City     | KS         |       1000
5 | Gillette Stadium           | Foxborough      | MA         |       1000
6 | New York Giants Stadium    | East Rutherford | NJ         |       1000
7 | BMO Field                  | Toronto         | ON         |       1000
8 | The Home Depot Center      | Carson          | CA         |       1000
9 | Dick's Sporting Goods Park | Commerce City   | CO         |       1000
10 | Pizza Hut Park             | Frisco          | TX         |       1000
(10 rows)</code></pre>
         <p>Para o seguinte exemplo, além de pressupor que nenhum dado de VENUESEATS esteja incluído no arquivo, também pressuponha que não haja dados VENUENAME incluídos: </p>
         <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copiar"><awsui-icon name="copy"></awsui-icon></div></div><code class="">1||Bridgeview|IL|
2||Columbus|OH|
3||Washington|DC|
4||Kansas City|KS|
5||Foxborough|MA|
6||East Rutherford|NJ|
7||Toronto|ON|
8||Carson|CA|
9||Commerce City|CO|
10||Frisco|TX|</code></pre>
         <p> Usando a mesma definição de tabela, a seguinte instrução COPY falha porque nenhum valor DEFAULT foi especificado para VENUENAME, e VENUENAME é uma coluna NOT NULL: </p>
         <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copiar"><awsui-icon name="copy"></awsui-icon></div></div><code class="">copy venue(venueid, venuecity, venuestate) 
from 's3://mybucket/data/venue_pipe.txt' 
iam_role 'arn:aws:iam::0123456789012:role/MyRedshiftRole'
delimiter '|';</code></pre>
         <p>Agora leve em consideração uma variação da tabela VENUE que usa uma coluna IDENTITY: </p>
         <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copiar"><awsui-icon name="copy"></awsui-icon></div></div><code class="">create table venue_identity(
venueid int identity(1,1),
venuename varchar(100) not null,
venuecity varchar(30),
venuestate char(2),
venueseats integer not null default '1000');</code></pre>
         <p>Assim como acontece com o exemplo anterior, pressuponha que a coluna VENUESEATS não tenha valores correspondentes no arquivo de origem. A instrução COPY a seguir carrega a tabela com êxito, inclusive os valores de dados IDENTITY predefinidos em vez de gerar automaticamente esses valores: </p>
         <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copiar"><awsui-icon name="copy"></awsui-icon></div></div><code class="">copy venue(venueid, venuename, venuecity, venuestate) 
from 's3://mybucket/data/venue_pipe.txt' 
iam_role 'arn:aws:iam::0123456789012:role/MyRedshiftRole'
delimiter '|' explicit_ids;</code></pre>
         <p>Ocorre uma falha nessa instrução porque não inclui a coluna IDENTITY (VENUEID não é encontrado na lista de colunas), além de incluir um parâmetro EXPLICIT_IDS: </p>
         <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copiar"><awsui-icon name="copy"></awsui-icon></div></div><code class="">copy venue(venuename, venuecity, venuestate) 
from 's3://mybucket/data/venue_pipe.txt' 
iam_role 'arn:aws:iam::0123456789012:role/MyRedshiftRole'
delimiter '|' explicit_ids;</code></pre>
         <p>Ocorre uma falha nessa instrução porque não inclui um parâmetro EXPLICIT_IDS: </p>
         <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copiar"><awsui-icon name="copy"></awsui-icon></div></div><code class="">copy venue(venueid, venuename, venuecity, venuestate)
from 's3://mybucket/data/venue_pipe.txt' 
iam_role 'arn:aws:iam::0123456789012:role/MyRedshiftRole'
delimiter '|';</code></pre>
       
         <h2 id="r_COPY_command_examples-copy-data-with-the-escape-option">Dados de COPY com a opção ESCAPE</h2>


         <p>O exemplo a seguir mostra como carregar caracteres correspondentes ao caractere delimitador (nesse caso, o caractere de barra). No arquivo de entrada, verifique se todos os caracteres de barra (|) que você deseja carregar sejam escapados com o caractere de barra invertida (\). Em seguida, carregue o arquivo com o parâmetro ESCAPE. </p>
         <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copiar"><awsui-icon name="copy"></awsui-icon></div></div><code class="">$ more redshiftinfo.txt
1|public\|event\|dwuser
2|public\|sales\|dwuser

create table redshiftinfo(infoid int,tableinfo varchar(50));

copy redshiftinfo from 's3://mybucket/data/redshiftinfo.txt' 
iam_role 'arn:aws:iam::0123456789012:role/MyRedshiftRole' 
delimiter '|' escape;

select * from redshiftinfo order by 1;
infoid |       tableinfo
-------+--------------------
1      | public|event|dwuser
2      | public|sales|dwuser
(2 rows)</code></pre>
         <p>Sem o parâmetro ESCAPE, esse comando COPY falha com um erro <code class="code">Extra column(s)
               found</code>.</p>
         <div class="awsdocs-note awsdocs-important"><div class="awsdocs-note-title"><awsui-icon name="status-warning" variant="error"></awsui-icon><h6>Importante</h6></div><div class="awsdocs-note-text"><p>Se carregar os dados usando um COPY com o parâmetro ESCAPE, você também deverá especificar o parâmetro ESCAPE com o comando UNLOAD para gerar o arquivo de saída recíproco. Da mesma maneira, se usar UNLOAD com o parâmetro ESCAPE, você precisa usar ESCAPE quando usar o comando COPY nos mesmos dados.</p></div></div>
       
         <h2 id="r_COPY_command_examples-copy-from-json">Copiar de exemplos JSON</h2>

         <p>Nos exemplos a seguir, você carrega a tabela CATEGORY com os dados a seguir. </p>
         <div class="table-container"><div class="table-contents"><table id="w319aac47b9c67c31c37b5"><thead>
                  <tr>
                     <th>CATID</th>
                     <th>CATGROUP</th>
                     <th>CATNAME</th>
                     <th>CATDESC</th>
                  </tr>
               </thead>
                  <tr>
                     <td tabindex="-1">1</td>
                     <td tabindex="-1">Esportes</td>
                     <td tabindex="-1">MLB</td>
                     <td tabindex="-1"> Major League Baseball</td>
                  </tr>
                  <tr>
                     <td tabindex="-1">2</td>
                     <td tabindex="-1">Esportes</td>
                     <td tabindex="-1">NHL</td>
                     <td tabindex="-1">National Hockey League</td>
                  </tr>
                  <tr>
                     <td tabindex="-1">3</td>
                     <td tabindex="-1">Esportes</td>
                     <td tabindex="-1">NFL</td>
                     <td tabindex="-1">National Football League</td>
                  </tr>
                  <tr>
                     <td tabindex="-1">4</td>
                     <td tabindex="-1">Esportes</td>
                     <td tabindex="-1">NBA</td>
                     <td tabindex="-1">National Basketball Association</td>
                  </tr>
                  <tr>
                     <td tabindex="-1">5</td>
                     <td tabindex="-1">Concertos</td>
                     <td tabindex="-1">Clássicos</td>
                     <td tabindex="-1">Todas as sinfonias, os concertos e os corais</td>
                  </tr>
               </table></div></div>
         <div class="highlights" id="inline-topiclist"><h6>Tópicos</h6><ul><li><a href="#copy-from-json-examples-using-auto">Carregar de dados JSON usando a opção "auto"</a></li><li><a href="#copy-from-json-examples-using-auto-ignorecase">Carregar de dados JSON usando a opção "auto ignorecase"</a></li><li><a href="#copy-from-json-examples-using-jsonpaths">Carregar de dados JSON usando um arquivo JSONPaths</a></li><li><a href="#copy-from-json-examples-using-jsonpaths-arrays">Carregar de matrizes JSON usando um arquivo JSONPaths</a></li></ul></div>

          
            <h3 id="copy-from-json-examples-using-auto">Carregar de dados JSON usando a opção "auto"</h3>

            <p>Para carregar de dados JSON usando o argumento <code class="code">'auto'</code>, os dados JSON devem consistir em um conjunto de objetos. Os nomes de chave devem corresponder aos nomes de coluna, mas, nesse caso, a ordem não importa. A seguir, o conteúdo de um arquivo chamado <code class="code">category_object_auto.json</code>.</p>
            <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copiar"><awsui-icon name="copy"></awsui-icon></div></div><code class=""><span>{</span>
    "catdesc": "Major League Baseball",
    "catid": 1,
    "catgroup": "Sports",
    "catname": "MLB"
}
<span>{</span>
    "catgroup": "Sports",
    "catid": 2,
    "catname": "NHL",
    "catdesc": "National Hockey League"
}<span>{</span>
    "catid": 3,
    "catname": "NFL",
    "catgroup": "Sports",
    "catdesc": "National Football League"
}
<span>{</span>
    "bogus": "Bogus Sports LLC",
    "catid": 4,
    "catgroup": "Sports",
    "catname": "NBA",
    "catdesc": "National Basketball Association"
}
<span>{</span>
    "catid": 5,
    "catgroup": "Shows",
    "catname": "Musicals",
    "catdesc": "All symphony, concerto, and choir concerts"
}</code></pre>
            <p>Para carregar do arquivo de dados JSON no exemplo anterior, execute o comando COPY a seguir.</p>
            <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copiar"><awsui-icon name="copy"></awsui-icon></div></div><code class="">copy category
from 's3://mybucket/category_object_auto.json'
iam_role 'arn:aws:iam::0123456789012:role/MyRedshiftRole' 
json 'auto';</code></pre>
          
         
          
            <h3 id="copy-from-json-examples-using-auto-ignorecase">Carregar de dados JSON usando a opção "auto ignorecase"</h3>
            
            <p>Para carregar de dados JSON usando o argumento <code class="code">'auto ignorecase'</code>, os dados JSON devem consistir em um conjunto de objetos. As maiúsculas e minúsculas dos nomes de chave não precisam corresponder aos nomes de coluna e a ordem não importa. A seguir, o conteúdo de um arquivo chamado <code class="code">category_object_auto-ignorecase.json</code>.</p>
            <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copiar"><awsui-icon name="copy"></awsui-icon></div></div><code class=""><span>{</span>
    "CatDesc": "Major League Baseball",
    "CatID": 1,
    "CatGroup": "Sports",
    "CatName": "MLB"
}
<span>{</span>
    "CatGroup": "Sports",
    "CatID": 2,
    "CatName": "NHL",
    "CatDesc": "National Hockey League"
}<span>{</span>
    "CatID": 3,
    "CatName": "NFL",
    "CatGroup": "Sports",
    "CatDesc": "National Football League"
}
<span>{</span>
    "bogus": "Bogus Sports LLC",
    "CatID": 4,
    "CatGroup": "Sports",
    "CatName": "NBA",
    "CatDesc": "National Basketball Association"
}
<span>{</span>
    "CatID": 5,
    "CatGroup": "Shows",
    "CatName": "Musicals",
    "CatDesc": "All symphony, concerto, and choir concerts"
}</code></pre>
            <p>Para carregar do arquivo de dados JSON no exemplo anterior, execute o comando COPY a seguir.</p>
            <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copiar"><awsui-icon name="copy"></awsui-icon></div></div><code class="">copy category
from 's3://mybucket/category_object_auto ignorecase.json'
iam_role 'arn:aws:iam::0123456789012:role/MyRedshiftRole' 
json 'auto ignorecase';</code></pre>
          
          
            <h3 id="copy-from-json-examples-using-jsonpaths">Carregar de dados JSON usando um arquivo JSONPaths</h3>
            
            <p>Se os objetos de dados JSON não corresponderem diretamente aos nomes de coluna, você poderá usar um arquivo JSONPaths a fim de mapear os elementos JSON para colunas. Além disso, a ordem não importa nos dados de origem JSON, mas a ordem das expressões do arquivo JSONPaths deve corresponder à ordem da coluna. Suponha que você tenha o seguinte arquivo de dados, chamado <code class="code">category_object_paths.json</code>.</p>
            <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copiar"><awsui-icon name="copy"></awsui-icon></div></div><code class=""><span>{</span>
    "one": 1,
    "two": "Sports",
    "three": "MLB",
    "four": "Major League Baseball"
}
<span>{</span>
    "three": "NHL",
    "four": "National Hockey League",
    "one": 2,
    "two": "Sports"
}
<span>{</span>
    "two": "Sports",
    "three": "NFL",
    "one": 3,
    "four": "National Football League"
}
<span>{</span>
    "one": 4,
    "two": "Sports",
    "three": "NBA",
    "four": "National Basketball Association"
}
<span>{</span>
    "one": 6,
    "two": "Shows",
    "three": "Musicals",
    "four": "All symphony, concerto, and choir concerts"
}</code></pre>
            <p>O arquivo JSONPaths a seguir, chamado <code class="code">category_jsonpath.json</code>, mapeia os dados de origem para as colunas de tabela.</p>
            <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copiar"><awsui-icon name="copy"></awsui-icon></div></div><code class=""><span>{</span>
    "jsonpaths": [
        "$['one']",
        "$['two']",
        "$['three']",
        "$['four']"
    ]
}</code></pre>
            <p>Para carregar do arquivo de dados JSON no exemplo anterior, execute o comando COPY a seguir.</p>
            <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copiar"><awsui-icon name="copy"></awsui-icon></div></div><code class="">copy category
from 's3://mybucket/category_object_paths.json'
iam_role 'arn:aws:iam::0123456789012:role/MyRedshiftRole' 
json 's3://mybucket/category_jsonpath.json';</code></pre>
          
         
         
          
            <h3 id="copy-from-json-examples-using-jsonpaths-arrays">Carregar de matrizes JSON usando um arquivo JSONPaths</h3>

            <p>Para carregar de dados JSON que consistem em um conjunto de matrizes, você deve usar um arquivo JSONPaths a fim de mapear os elementos de matriz para as colunas. Suponha que você tenha o seguinte arquivo de dados, chamado <code class="code">category_array_data.json</code>.</p>
            <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copiar"><awsui-icon name="copy"></awsui-icon></div></div><code class="">[1,"Sports","MLB","Major League Baseball"]
[2,"Sports","NHL","National Hockey League"]
[3,"Sports","NFL","National Football League"]
[4,"Sports","NBA","National Basketball Association"]
[5,"Concerts","Classical","All symphony, concerto, and choir concerts"]</code></pre>
            <p>O arquivo JSONPaths a seguir, chamado <code class="code">category_array_jsonpath.json</code>, mapeia os dados de origem para as colunas de tabela.</p>
            <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copiar"><awsui-icon name="copy"></awsui-icon></div></div><code class=""><span>{</span>
    "jsonpaths": [
        "$[0]",
        "$[1]",
        "$[2]",
        "$[3]"
    ]
}</code></pre>
            <p>Para carregar do arquivo de dados JSON no exemplo anterior, execute o comando COPY a seguir.</p>
            <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copiar"><awsui-icon name="copy"></awsui-icon></div></div><code class="">copy category
from 's3://mybucket/category_array_data.json'
iam_role 'arn:aws:iam::0123456789012:role/MyRedshiftRole' 
json 's3://mybucket/category_array_jsonpath.json';</code></pre>
          
             
         <h2 id="r_COPY_command_examples-copy-from-avro">Copiar de exemplos Avro</h2>

         <p>Nos exemplos a seguir, você carrega a tabela CATEGORY com os dados a seguir. </p>
         <div class="table-container"><div class="table-contents"><table id="w319aac47b9c67c31c39b5"><thead>
                  <tr>
                     <th>CATID</th>
                     <th>CATGROUP</th>
                     <th>CATNAME</th>
                     <th>CATDESC</th>
                  </tr>
               </thead>
                  <tr>
                     <td tabindex="-1">1</td>
                     <td tabindex="-1">Esportes</td>
                     <td tabindex="-1">MLB</td>
                     <td tabindex="-1"> Major League Baseball</td>
                  </tr>
                  <tr>
                     <td tabindex="-1">2</td>
                     <td tabindex="-1">Esportes</td>
                     <td tabindex="-1">NHL</td>
                     <td tabindex="-1">National Hockey League</td>
                  </tr>
                  <tr>
                     <td tabindex="-1">3</td>
                     <td tabindex="-1">Esportes</td>
                     <td tabindex="-1">NFL</td>
                     <td tabindex="-1">National Football League</td>
                  </tr>
                  <tr>
                     <td tabindex="-1">4</td>
                     <td tabindex="-1">Esportes</td>
                     <td tabindex="-1">NBA</td>
                     <td tabindex="-1">National Basketball Association</td>
                  </tr>
                  <tr>
                     <td tabindex="-1">5</td>
                     <td tabindex="-1">Concertos</td>
                     <td tabindex="-1">Clássicos</td>
                     <td tabindex="-1">Todas as sinfonias, os concertos e os corais</td>
                  </tr>
               </table></div></div>
         <div class="highlights" id="inline-topiclist"><h6>Tópicos</h6><ul><li><a href="#copy-from-avro-examples-using-auto">Carregar de dados Avro usando a opção "auto"</a></li><li><a href="#copy-from-avro-examples-using-auto-ignorecase">Carregar de dados Avro usando a opção "auto ignorecase"</a></li><li><a href="#copy-from-avro-examples-using-avropaths">Carregar de dados Avro usando um arquivo JSONPaths</a></li></ul></div>
          
            <h3 id="copy-from-avro-examples-using-auto">Carregar de dados Avro usando a opção "auto"</h3>

            <p>Para carregar de dados Avro usando o argumento <code class="code">'auto'</code>, os nomes de campo no esquema Avro devem corresponder aos nomes de coluna. Durante o uso do argumento <code class="code">'auto'</code>, a ordem não importa. A seguir, o esquema de um arquivo chamado <code class="code">category_auto.avro</code>.</p>
            <pre class="screen"><span>{</span>
    "name": "category",
    "type": "record",
    "fields": [
        <span>{</span>"name": "catid", "type": "int"},
        <span>{</span>"name": "catdesc", "type": "string"},
        <span>{</span>"name": "catname", "type": "string"},
        <span>{</span>"name": "catgroup", "type": "string"},
}</pre>
            <p>Como estão em formato binário, os dados em um arquivo Avro não são legíveis. A seguir, uma representação JSON dos dados no arquivo <code class="code">category_auto.avro</code>. </p>
            <pre class="screen"><span>{</span>
   "catid": 1,
   "catdesc": "Major League Baseball",
   "catname": "MLB",
   "catgroup": "Sports"
}
<span>{</span>
   "catid": 2,
   "catdesc": "National Hockey League",
   "catname": "NHL",
   "catgroup": "Sports"
}
<span>{</span>
   "catid": 3,
   "catdesc": "National Basketball Association",
   "catname": "NBA",
   "catgroup": "Sports"
}
<span>{</span>
   "catid": 4,
   "catdesc": "All symphony, concerto, and choir concerts",
   "catname": "Classical",
   "catgroup": "Concerts"
}</pre>
            <p>Para carregar do arquivo de dados Avro no exemplo anterior, execute o comando COPY a seguir.</p>
            <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copiar"><awsui-icon name="copy"></awsui-icon></div></div><code class="">copy category
from 's3://mybucket/category_auto.avro'
iam_role 'arn:aws:iam::0123456789012:role/MyRedshiftRole'
format as avro 'auto';</code></pre>
          
         
          
            <h3 id="copy-from-avro-examples-using-auto-ignorecase">Carregar de dados Avro usando a opção "auto ignorecase"</h3>
            
            <p>Para carregar de dados Avro usando o argumento <code class="code">'auto ignorecase'</code>, a maiúscula e minúscula nos nomes de campo no esquema Avro devem corresponder aos nomes de coluna. Durante o uso do argumento <code class="code">'auto ignorecase'</code>, a ordem não importa. A seguir, o esquema de um arquivo chamado <code class="code">category_auto-ignorecase.avro</code>.</p>
            <pre class="screen"><span>{</span>
    "name": "category",
    "type": "record",
    "fields": [
        <span>{</span>"name": "CatID", "type": "int"},
        <span>{</span>"name": "CatDesc", "type": "string"},
        <span>{</span>"name": "CatName", "type": "string"},
        <span>{</span>"name": "CatGroup", "type": "string"},
}</pre>
            <p>Como estão em formato binário, os dados em um arquivo Avro não são legíveis. A seguir, uma representação JSON dos dados no arquivo <code class="code">category_auto-ignorecase.avro</code>. </p>
            <pre class="screen"><span>{</span>
   "CatID": 1,
   "CatDesc": "Major League Baseball",
   "CatName": "MLB",
   "CatGroup": "Sports"
}
<span>{</span>
   "CatID": 2,
   "CatDesc": "National Hockey League",
   "CatName": "NHL",
   "CatGroup": "Sports"
}
<span>{</span>
   "CatID": 3,
   "CatDesc": "National Basketball Association",
   "CatName": "NBA",
   "CatGroup": "Sports"
}
<span>{</span>
   "CatID": 4,
   "CatDesc": "All symphony, concerto, and choir concerts",
   "CatName": "Classical",
   "CatGroup": "Concerts"
}</pre>
            <p>Para carregar do arquivo de dados Avro no exemplo anterior, execute o comando COPY a seguir.</p>
            <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copiar"><awsui-icon name="copy"></awsui-icon></div></div><code class="">copy category
from 's3://mybucket/category_auto-ignorecase.avro'
iam_role 'arn:aws:iam::0123456789012:role/MyRedshiftRole'
format as avro 'auto ignorecase';</code></pre>
          
         
          
            <h3 id="copy-from-avro-examples-using-avropaths">Carregar de dados Avro usando um arquivo JSONPaths</h3>

            <p>Se os nomes de campo no esquema Avro não corresponderem diretamente aos nomes de coluna, você poderá usar um arquivo JSONPaths a fim de mapear os elementos de esquema para colunas. A ordem das expressões do arquivo JSONPaths deve corresponder à ordem das colunas. </p>
            <p>Suponha que você tenha um arquivo de dados chamado <code class="code">category_paths.avro</code> contendo os mesmos dados do exemplo anterior, mas com o esquema a seguir.</p>
            <pre class="screen"><span>{</span>
    "name": "category",
    "type": "record",
    "fields": [
        <span>{</span>"name": "id", "type": "int"},
        <span>{</span>"name": "desc", "type": "string"},
        <span>{</span>"name": "name", "type": "string"},
        <span>{</span>"name": "group", "type": "string"},
        <span>{</span>"name": "region", "type": "string"} 
     ]
}</pre>
            <p>O arquivo JSONPaths a seguir, chamado <code class="code">category_path.avropath</code>, mapeia os dados de origem para as colunas de tabela.</p>
            <pre class="screen"><span>{</span>
    "jsonpaths": [
        "$['id']",
        "$['group']",
        "$['name']",
        "$['desc']"
    ]
}</pre>
            <p>Para carregar do arquivo de dados Avro no exemplo anterior, execute o comando COPY a seguir.</p>
            <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copiar"><awsui-icon name="copy"></awsui-icon></div></div><code class="">copy category
from 's3://mybucket/category_object_paths.avro'
iam_role 'arn:aws:iam::0123456789012:role/MyRedshiftRole' 
format avro 's3://mybucket/category_path.avropath ';</code></pre>
          

       
         <h2 id="r_COPY_preparing_data">Preparar arquivos para COPY com a opção ESCAPE</h2>


         <p>O exemplo a seguir descreve como convém preparar dados para "escapar" caracteres de nova linha antes de importar os dados para uma tabela do Amazon Redshift usando o comando COPY com o parâmetro ESCAPE. Sem preparar os dados para delimitar os caracteres de nova linha, o Amazon Redshift retorna erros de carga quando você executar o comando COPY, porque o caractere de nova linha normalmente é usado como um separador de registros. </p>
         <p>Por exemplo, leve em consideração um arquivo ou uma coluna em uma tabela externa que você deseja copiar para uma tabela do Amazon Redshift. Se o arquivo ou a coluna apresentar conteúdo formatado em XML ou dados semelhantes, você precisa verificar se todos os caracteres de nova linha (\n) que fazem parte do conteúdo são escapados com o caractere de barra invertida (\). </p>
         <p>Um arquivo ou tabela contendo caracteres de nova linha incorporados fornece um padrão relativamente fácil de combinar. Cada caractere de nova linha interno quase sempre vem depois de um caractere <code class="code">&gt;</code> com alguns caracteres de espaço em branco em potencial (<code class="code">' '</code> ou tabulação) entre eles, como você pode ver no exemplo a seguir de um arquivo de texto chamado <code>nlTest1.txt</code>. </p>
         <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copiar"><awsui-icon name="copy"></awsui-icon></div></div><code class="">$ cat nlTest1.txt
&lt;xml start&gt;
&lt;newline characters provide&gt;
&lt;line breaks at the end of each&gt;
&lt;line in content&gt;
&lt;/xml&gt;|1000
&lt;xml&gt;
&lt;/xml&gt;|2000</code></pre>
         <p>Com o exemplo a seguir, você pode executar um utilitário de processamento de texto para pré-processar o arquivo de origem e inserir os caracteres de escape quando necessário. (O caractere <code class="code">|</code> deve ser usado como delimitador para separar dados de coluna quando copiados para uma tabela do Amazon Redshift.) </p>
         <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copiar"><awsui-icon name="copy"></awsui-icon></div></div><code class="">$ sed -e ':a;N;$!ba;s/&gt;[[:space:]]*\n/&gt;\\\n/g' nlTest1.txt &gt; nlTest2.txt</code></pre>
         <p>Da mesma maneira, você pode usar Perl para realizar uma operação semelhante: </p>
         <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copiar"><awsui-icon name="copy"></awsui-icon></div></div><code class="">cat nlTest1.txt | perl -p -e 's/&gt;\s*\n/&gt;\\\n/g' &gt; nlTest2.txt</code></pre>
         <p>Para acomodar ao carregamento dos dados do arquivo <code>nlTest2.txt</code> para o Amazon Redshift, criamos uma tabela de duas colunas no Amazon Redshift. A primeira coluna c1 é uma coluna de caracteres que mantém o conteúdo formatado do arquivo <code>nlTest2.txt</code>. A segunda coluna c2 mantém valores inteiros carregados do mesmo arquivo. </p>
         <p>Depois de executar o comando <code class="code">sed</code>, você poderá carregar corretamente dados do arquivo <code>nlTest2.txt</code> para uma tabela do Amazon Redshift usando o parâmetro ESCAPE. </p>
         <div class="awsdocs-note"><div class="awsdocs-note-title"><awsui-icon name="status-info" variant="link"></awsui-icon><h6>nota</h6></div><div class="awsdocs-note-text"><p>Quando você inclui o parâmetro ESCAPE com o comando COPY, ele escapa vários caracteres especiais, dentre os quais estão caractere de barra invertida (inclusive nova linha). </p></div></div>
         <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copiar"><awsui-icon name="copy"></awsui-icon></div></div><code class="">copy t2 from 's3://mybucket/data/nlTest2.txt' 
iam_role 'arn:aws:iam::0123456789012:role/MyRedshiftRole'  
escape
delimiter as '|';

select * from t2 order by 2;

c1           |  c2
-------------+------
&lt;xml start&gt;
&lt;newline characters provide&gt;
&lt;line breaks at the end of each&gt;
&lt;line in content&gt;
&lt;/xml&gt;
| 1000
&lt;xml&gt;
&lt;/xml&gt;       | 2000
(2 rows)</code></pre>
         <p>Você pode preparar arquivos de dados exportados de bancos de dados externos de maneira semelhante. Por exemplo, com um banco de dados Oracle, você pode usar a função REPLACE em cada coluna afetada em uma tabela que deseja copiar para o Amazon Redshift. </p>
         <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copiar"><awsui-icon name="copy"></awsui-icon></div></div><code class="">SELECT c1, REPLACE(c2, \n',\\n' ) as c2 from my_table_with_xml</code></pre>
         <p>Além disso, muitas ferramentas Export e Extract, Transform, Load (ETL – Exportação e extração, transformação, carga) de banco de dados que processam sempre muitos dados oferecem opções para especificar caracteres de escape e delimitadores. </p>
       
         
         
         <h2 id="copy-example-spatial-copy-shapefile">Carregar um shapefile no Amazon Redshift</h2>
         
         <p>Os exemplos a seguir demonstram como carregar um shapefile da Esri usando COPY. Para obter mais informações o carregamento de shapefiles, consulte <a href="./spatial-copy-shapefile.html">Carregar um shapefile no Amazon Redshift</a>. </p>        

         
         
          
            <h3 id="copy-example-spatial-copy-shapefile-loading-copy">Carregar um shapefile</h3>
            
            
            <p>As etapas a seguir mostram como ingerir dados do OpenStreetMap do Amazon S3 usando o comando COPY. Este exemplo pressupõe que o arquivo shapefile da Noruega do <a href="https://download.geofabrik.de/europe.html" rel="noopener noreferrer" target="_blank"><span>site de download de Geofabrik</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a> foi carregado para um bucket privado do Amazon S3 em sua região da AWS. Os arquivos <code>.shp</code>, <code>.shx</code> e<code>.dbf</code> devem compartilhar o mesmo prefixo do Amazon S3 e nome de arquivo.</p>
            
             
               <h4 id="spatial-copy-shapefile-loading-copy-fits">Ingestão de dados sem simplificação</h4>
               <p>Os comandos a seguir criam tabelas e ingerem dados que podem caber no tamanho máximo da geometria sem qualquer simplificação. Abra o <code>gis_osm_natural_free_1.shp</code> em seu software GIS preferido e inspecione as colunas nesta camada. Por padrão, as colunas IDENTITY ou GEOMETRY são as primeiras. Quando uma coluna GEOMETRY é a primeira, você pode criar a tabela como mostrado a seguir.</p>
               <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copiar"><awsui-icon name="copy"></awsui-icon></div></div><code class="sql ">CREATE TABLE norway_natural (
   wkb_geometry GEOMETRY,
   osm_id BIGINT,
   code INT,
   fclass VARCHAR,
   name VARCHAR);            
</code></pre>
               
               <p>Ou, quando uma coluna IDENTITY é a primeira, você pode criar a tabela como mostrado a seguir.</p>
               
               <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copiar"><awsui-icon name="copy"></awsui-icon></div></div><code class="sql ">CREATE TABLE norway_natural_with_id (
   fid INT IDENTITY(1,1),
   wkb_geometry GEOMETRY,
   osm_id BIGINT,
   code INT,
   fclass VARCHAR,
   name VARCHAR);            
</code></pre>
               
               <p>Agora você pode ingerir os dados usando COPY.</p>
               <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copiar"><awsui-icon name="copy"></awsui-icon></div></div><code class="sql ">COPY norway_natural FROM 's3://<code class="replaceable">bucket_name</code>/shapefiles/norway/gis_osm_natural_free_1.shp'
FORMAT SHAPEFILE
CREDENTIALS 'aws_iam_role=arn:aws:iam::123456789012:role/MyRoleName';
INFO: Load into table 'norway_natural' completed, 83891 record(s) loaded successfully
</code></pre>
               
               <p>Ou você pode ingerir os dados como mostrado a seguir. </p>
               
               <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copiar"><awsui-icon name="copy"></awsui-icon></div></div><code class="sql ">COPY norway_natural_with_id FROM 's3://<code class="replaceable">bucket_name</code>/shapefiles/norway/gis_osm_natural_free_1.shp'
FORMAT SHAPEFILE
CREDENTIALS 'aws_iam_role=arn:aws:iam::123456789012:role/MyRoleName';
INFO: Load into table 'norway_natural_with_id' completed, 83891 record(s) loaded successfully.
</code></pre>         
             
            
             
               <h4 id="spatial-copy-shapefile-loading-copy-no-fit">Ingestão de dados com simplificação</h4>
               <p>Os comandos a seguir criam uma tabela e tentam ingerir dados que não podem caber no tamanho máximo da geometria sem qualquer simplificação. Inspecione o shapefile <code>gis_osm_water_a_free_1.shp</code> e crie a tabela apropriada como mostrado a seguir.</p>             
               <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copiar"><awsui-icon name="copy"></awsui-icon></div></div><code class="sql ">CREATE TABLE norway_water (
   wkb_geometry GEOMETRY,
   osm_id BIGINT,
   code INT,
   fclass VARCHAR,
   name VARCHAR);
</code></pre>
               
               <p>Quando o comando COPY é executado, isso resulta em um erro.</p>
               
               <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copiar"><awsui-icon name="copy"></awsui-icon></div></div><code class="sql ">COPY norway_water FROM 's3://<code class="replaceable">bucket_name</code>/shapefiles/norway/gis_osm_water_a_free_1.shp'
FORMAT SHAPEFILE
CREDENTIALS 'aws_iam_role=arn:aws:iam::123456789012:role/MyRoleName';
ERROR:  Load into table 'norway_water' failed.  Check 'stl_load_errors' system table for details.              
</code></pre>
               
               <p>Consultar <code class="code">STL_LOAD_ERRORS</code> mostra que a geometria é muito grande. </p>
               
               <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copiar"><awsui-icon name="copy"></awsui-icon></div></div><code class="nohighlight">SELECT line_number, btrim(colname), btrim(err_reason) FROM stl_load_errors WHERE query = pg_last_copy_id();
 line_number |    btrim     |                                 btrim
-------------+--------------+-----------------------------------------------------------------------
     1184705 | wkb_geometry | Geometry size: 1513736 is larger than maximum supported size: 1048447              
</code></pre>
               
               <p>Para superar isso, o parâmetro <code class="code">SIMPLIFY AUTO</code> é adicionado ao comando COPY para simplificar geometrias.</p>
               
               <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copiar"><awsui-icon name="copy"></awsui-icon></div></div><code class="sql ">COPY norway_water FROM 's3://<code class="replaceable">bucket_name</code>/shapefiles/norway/gis_osm_water_a_free_1.shp'
FORMAT SHAPEFILE
SIMPLIFY AUTO
CREDENTIALS 'aws_iam_role=arn:aws:iam::123456789012:role/MyRoleName';

INFO:  Load into table 'norway_water' completed, 1989196 record(s) loaded successfully.              
</code></pre>
               
               <p>Para exibir as linhas e geometrias que foram simplificadas, consulte <code class="code">SVL_SPATIAL_SIMPLIFY</code>.</p>
               
               <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copiar"><awsui-icon name="copy"></awsui-icon></div></div><code class="nohighlight">SELECT * FROM svl_spatial_simplify WHERE query = pg_last_copy_id();
 query | line_number | maximum_tolerance | initial_size | simplified | final_size |   final_tolerance
-------+-------------+-------------------+--------------+------------+------------+----------------------
    20 |     1184704 |                -1 |      1513736 | t          |    1008808 |   1.276386653895e-05
    20 |     1664115 |                -1 |      1233456 | t          |    1023584 | 6.11707814796635e-06               
</code></pre>
               
               <p>Utilizar SIMPLIFY AUTO <em>max_tolerance</em> com a tolerância menor do que as calculadas automaticamente provavelmente resulta em um erro de ingestão. Nesse caso, use MAXERROR para ignorar erros.</p>
               
               <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copiar"><awsui-icon name="copy"></awsui-icon></div></div><code class="sql ">COPY norway_water FROM 's3://<code class="replaceable">bucket_name</code>/shapefiles/norway/gis_osm_water_a_free_1.shp'
FORMAT SHAPEFILE
SIMPLIFY AUTO 1.1E-05
MAXERROR 2
CREDENTIALS 'aws_iam_role=arn:aws:iam::123456789012:role/MyRoleName';

INFO:  Load into table 'norway_water' completed, 1989195 record(s) loaded successfully.
INFO:  Load into table 'norway_water' completed, 1 record(s) could not be loaded.  Check 'stl_load_errors' system table for details.               
</code></pre>
               
               <p>Consulte <code class="code">SVL_SPATIAL_SIMPLIFY</code> novamente para identificar o registro que COPY não conseguiu carregar.</p>
               <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copiar"><awsui-icon name="copy"></awsui-icon></div></div><code class="nohighlight">SELECT * FROM svl_spatial_simplify WHERE query = pg_last_copy_id();
 query | line_number | maximum_tolerance | initial_size | simplified | final_size | final_tolerance
-------+-------------+-------------------+--------------+------------+------------+-----------------
    29 |     1184704 |           1.1e-05 |      1513736 | f          |          0 |               0
    29 |     1664115 |           1.1e-05 |      1233456 | t          |     794432 |         1.1e-05             
</code></pre>
               
               <p>Neste exemplo, o primeiro registro não conseguiu caber, então o <code class="code">simplified</code> está mostrando “false”. O segundo registro foi carregado dentro da tolerância dada. No entanto, o tamanho final é maior do que usar a tolerância calculada automaticamente sem especificar a tolerância máxima. </p>             
                       
             
                       
          
         
          
            <h3 id="copy-example-spatial-copy-shapefile-compressed">Carregar a partir de um shapefile compactado</h3>
            <p>O Amazon Redshift COPY oferece suporte à ingestão de dados de um shapefile compactado. Todos os componentes shapefile devem ter o mesmo prefixo do Amazon S3 e o mesmo sufixo de compactação. Como exemplo, suponha que você deseja carregar os dados do exemplo anterior. Neste caso, os arquivos <code>gis_osm_water_a_free_1.shp.gz</code>, <code>gis_osm_water_a_free_1.dbf.gz</code>, e <code>gis_osm_water_a_free_1.shx.gz</code> devem compartilhar o mesmo diretório do Amazon S3. O comando COPY requer a opção GZIP e a cláusula FROM deve especificar o arquivo compactado correto, conforme mostrado a seguir.</p>
            
            <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copiar"><awsui-icon name="copy"></awsui-icon></div></div><code class="sql ">COPY norway_natural FROM 's3://<code class="replaceable">bucket_name</code>/shapefiles/norway/compressed/gis_osm_natural_free_1.shp.gz'
FORMAT SHAPEFILE
GZIP
CREDENTIALS 'aws_iam_role=arn:aws:iam::123456789012:role/MyRoleName';
INFO:  Load into table 'norway_natural' completed, 83891 record(s) loaded successfully.          
</code></pre>
          
         
          
            <h3 id="copy-example-spatial-copy-shapefile-column-order">Carregar dados em uma tabela com uma ordem de coluna diferente</h3>
            <p>Se você tiver uma tabela que não tenha <code class="code">GEOMETRY</code> como a primeira coluna, você pode usar o mapeamento de coluna para mapear colunas para a tabela de destino. Por exemplo, crie uma tabela com <code class="code">osm_id</code> especificado como uma primeira coluna.</p>
            
            <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copiar"><awsui-icon name="copy"></awsui-icon></div></div><code class="sql ">CREATE TABLE norway_natural_order (
   osm_id BIGINT,
   wkb_geometry GEOMETRY,
   code INT,
   fclass VARCHAR,
   name VARCHAR);         
</code></pre>
            <p>Em seguida, faça a ingestão de um shapefile usando o mapeamento de coluna.</p>
            <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copiar"><awsui-icon name="copy"></awsui-icon></div></div><code class="sql ">COPY norway_natural_order(wkb_geometry, osm_id, code, fclass, name) 
FROM 's3://<code class="replaceable">bucket_name</code>/shapefiles/norway/gis_osm_natural_free_1.shp'
FORMAT SHAPEFILE
CREDENTIALS 'aws_iam_role=arn:aws:iam::123456789012:role/MyRoleName';
INFO:  Load into table 'norway_natural_order' completed, 83891 record(s) loaded successfully.         
</code></pre>
            
          
         
          
            
            <h3 id="copy-example-spatial-copy-shapefile-geography">Carregar dados em uma tabela com uma coluna geography</h3>
            <p>Caso você tenha uma tabela com uma coluna <code class="code">GEOGRAPHY</code>, ingira primeiro para uma coluna <code class="code">GEOMETRY</code> e converta os objetos para objetos <code class="code">GEOGRAPHY</code>. Por exemplo, depois de copiar seu arquivo de formato para uma coluna <code class="code">GEOMETRY</code>, altere a tabela para adicionar uma coluna do tipo de dados <code class="code">GEOGRAPHY</code>.</p>           
            <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copiar"><awsui-icon name="copy"></awsui-icon></div></div><code class="sql ">ALTER TABLE norway_natural ADD COLUMN wkb_geography GEOGRAPHY;</code></pre>
            
            <p>Então converta geometrias em geografias.</p>
            <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copiar"><awsui-icon name="copy"></awsui-icon></div></div><code class="sql ">UPDATE norway_natural SET wkb_geography = wkb_geometry::geography;</code></pre>
            
            <p>Se preferir, você pode descartar a coluna <code class="code">GEOMETRY</code>.</p>
            <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copiar"><awsui-icon name="copy"></awsui-icon></div></div><code class="sql ">ALTER TABLE norway_natural DROP COLUMN wkb_geometry;</code></pre>
            
          
         
       
         
         <h2 id="r_COPY_command_examples-load-noload-option">Comando COPY com a opção NOLOAD</h2>
              
         <p>Para validar os arquivos de dados antes de realmente carregar os dados, use a opção NOLOAD com o comando COPY. O Amazon Redshift analisa o arquivo de entrada e exibe todos os erros que ocorrem. O exemplo a seguir usa a opção NOLOAD e nenhuma linha é realmente carregada na tabela.</p>
         <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copiar"><awsui-icon name="copy"></awsui-icon></div></div><code class="sql "><code class="userinput">COPY public.zipcode1
FROM 's3://mybucket/mydata/zipcode.csv' 
DELIMITER ';' 
IGNOREHEADER 1 REGION 'us-east-1'
NOLOAD
CREDENTIALS 'aws_iam_role=arn:aws:iam::123456789012:role/myRedshiftRole'</code>;
<code class="computeroutput" copy="false">
Warnings:
Load into table 'zipcode1' completed, 0 record(s) loaded successfully.  
</code>       
         
         </code></pre>
      <awsdocs-copyright class="copyright-print"></awsdocs-copyright><awsdocs-thumb-feedback right-edge="{{$ctrl.thumbFeedbackRightEdge}}"></awsdocs-thumb-feedback></div><noscript><div><div><div><div id="js_error_message"><p><img src="https://d1ge0kk1l5kms0.cloudfront.net/images/G/01/webservices/console/warning.png" alt="Atenção" /> <strong>O Javascript está desativado ou não está disponível no seu navegador.</strong></p><p>Para usar a documentação da AWS, o Javascript deve estar ativado. Consulte as páginas de Ajuda do navegador para obter instruções.</p></div></div></div></div></noscript><div id="main-col-footer" class="awsui-util-font-size-0"><div id="doc-conventions"><a target="_top" href="/general/latest/gr/docconventions.html">Convenções do documento</a></div><div class="prev-next"><div id="previous" class="prev-link" accesskey="p" href="./automatic-recognition.html">Usar o reconhecimento automático com DATEFORMAT e TIMEFORMAT</div><div id="next" class="next-link" accesskey="n" href="./r_CREATE_DATABASE.html">CREATE DATABASE</div></div></div><awsdocs-page-utilities></awsdocs-page-utilities></div><div id="quick-feedback-yes" style="display: none;"><div class="title">Essa página foi útil? - Sim</div><div class="content"><p>Obrigado por nos informar que estamos fazendo um bom trabalho!</p><p>Se tiver tempo, conte-nos sobre o que você gostou para que possamos melhorar ainda mais.</p><p><awsui-button id="fblink" rel="noopener noreferrer" target="_blank" text="Feedback" click="linkClick($event)" href="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=Redshift&amp;topic_url=https://docs.aws.amazon.com/pt_br/redshift/latest/dg/r_COPY_command_examples.html"></awsui-button></p></div></div><div id="quick-feedback-no" style="display: none;"><div class="title">Essa página foi útil? - Não</div><div class="content"><p>Obrigado por nos informar que precisamos melhorar a página. Lamentamos ter decepcionado você.</p><p>Se tiver tempo, conte-nos como podemos melhorar a documentação.</p><p><awsui-button id="fblink" rel="noopener noreferrer" target="_blank" text="Feedback" click="linkClick($event)" href="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=Redshift&amp;topic_url=https://docs.aws.amazon.com/pt_br/redshift/latest/dg/r_COPY_command_examples.html"></awsui-button></p></div></div></div></body></div></awsdocs-view><div class="page-loading-indicator" id="page-loading-indicator"><awsui-spinner size="large"></awsui-spinner></div></div><div id="tools-panel" dom-region="tools"><awsdocs-tools-panel id="awsdocs-tools-panel"></awsdocs-tools-panel></div></awsui-app-layout><awsdocs-cookie-banner class="doc-cookie-banner"></awsdocs-cookie-banner></div></body></html>