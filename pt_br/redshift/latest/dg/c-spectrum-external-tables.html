<!DOCTYPE html>
    <html xmlns="http://www.w3.org/1999/xhtml" lang="pt-BR"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Criar tabelas externas do Redshift Spectrum - Amazon Redshift</title><meta name="viewport" content="width=device-width,initial-scale=1" /><meta name="assets_root" content="/assets" /><meta name="target_state" content="c-spectrum-external-tables" /><meta name="default_state" content="c-spectrum-external-tables" /><link rel="icon" type="image/ico" href="/assets/images/favicon.ico" /><link rel="shortcut icon" type="image/ico" href="/assets/images/favicon.ico" /><link rel="canonical" href="https://docs.aws.amazon.com/pt_br/redshift/latest/dg/c-spectrum-external-tables.html" /><meta name="description" content="Crie uma tabela externa em um esquema externo. Para criar tabelas externas, você deve ser proprietário do esquema externo ou um superusuário. Para transferir a propriedade de um esquema externo, use para alterar o proprietário. O exemplo a seguir altera o proprietário do esquema" /><meta name="deployment_region" content="IAD" /><meta name="product" content="Amazon Redshift" /><meta name="guide" content="Guia do desenvolvedor de banco de dados" /><meta name="abstract" content="Crie e gerencie um data warehouse com o Amazon Redshift, um serviço de data warehouse totalmente gerenciado, em escala de petabyte e de nível empresarial." /><meta name="guide-locale" content="pt_br" /><meta name="tocs" content="toc-contents.json" /><link rel="canonical" href="https://docs.aws.amazon.com/pt_br/redshift/latest/dg/c-spectrum-external-tables.html" /><link rel="alternative" href="https://docs.aws.amazon.com/id_id/redshift/latest/dg/c-spectrum-external-tables.html" hreflang="id-id" /><link rel="alternative" href="https://docs.aws.amazon.com/id_id/redshift/latest/dg/c-spectrum-external-tables.html" hreflang="id" /><link rel="alternative" href="https://docs.aws.amazon.com/de_de/redshift/latest/dg/c-spectrum-external-tables.html" hreflang="de-de" /><link rel="alternative" href="https://docs.aws.amazon.com/de_de/redshift/latest/dg/c-spectrum-external-tables.html" hreflang="de" /><link rel="alternative" href="https://docs.aws.amazon.com/redshift/latest/dg/c-spectrum-external-tables.html" hreflang="en-us" /><link rel="alternative" href="https://docs.aws.amazon.com/redshift/latest/dg/c-spectrum-external-tables.html" hreflang="en" /><link rel="alternative" href="https://docs.aws.amazon.com/es_es/redshift/latest/dg/c-spectrum-external-tables.html" hreflang="es-es" /><link rel="alternative" href="https://docs.aws.amazon.com/es_es/redshift/latest/dg/c-spectrum-external-tables.html" hreflang="es" /><link rel="alternative" href="https://docs.aws.amazon.com/fr_fr/redshift/latest/dg/c-spectrum-external-tables.html" hreflang="fr-fr" /><link rel="alternative" href="https://docs.aws.amazon.com/fr_fr/redshift/latest/dg/c-spectrum-external-tables.html" hreflang="fr" /><link rel="alternative" href="https://docs.aws.amazon.com/it_it/redshift/latest/dg/c-spectrum-external-tables.html" hreflang="it-it" /><link rel="alternative" href="https://docs.aws.amazon.com/it_it/redshift/latest/dg/c-spectrum-external-tables.html" hreflang="it" /><link rel="alternative" href="https://docs.aws.amazon.com/ja_jp/redshift/latest/dg/c-spectrum-external-tables.html" hreflang="ja-jp" /><link rel="alternative" href="https://docs.aws.amazon.com/ja_jp/redshift/latest/dg/c-spectrum-external-tables.html" hreflang="ja" /><link rel="alternative" href="https://docs.aws.amazon.com/ko_kr/redshift/latest/dg/c-spectrum-external-tables.html" hreflang="ko-kr" /><link rel="alternative" href="https://docs.aws.amazon.com/ko_kr/redshift/latest/dg/c-spectrum-external-tables.html" hreflang="ko" /><link rel="alternative" href="https://docs.aws.amazon.com/pt_br/redshift/latest/dg/c-spectrum-external-tables.html" hreflang="pt-br" /><link rel="alternative" href="https://docs.aws.amazon.com/pt_br/redshift/latest/dg/c-spectrum-external-tables.html" hreflang="pt" /><link rel="alternative" href="https://docs.aws.amazon.com/zh_cn/redshift/latest/dg/c-spectrum-external-tables.html" hreflang="zh-cn" /><link rel="alternative" href="https://docs.aws.amazon.com/zh_tw/redshift/latest/dg/c-spectrum-external-tables.html" hreflang="zh-tw" /><link rel="alternative" href="https://docs.aws.amazon.com/redshift/latest/dg/c-spectrum-external-tables.html" hreflang="x-default" /><meta name="feedback-item" content="Redshift" /><meta name="this_doc_product" content="Amazon Redshift" /><meta name="this_doc_guide" content="Guia do desenvolvedor de banco de dados" /><script defer="" src="/assets/r/vendor4.js?version=2021.12.02"></script><script defer="" src="/assets/r/vendor3.js?version=2021.12.02"></script><script defer="" src="/assets/r/vendor1.js?version=2021.12.02"></script><script defer="" src="/assets/r/awsdocs-common.js?version=2021.12.02"></script><script defer="" src="/assets/r/awsdocs-doc-page.js?version=2021.12.02"></script><link href="/assets/r/vendor4.css?version=2021.12.02" rel="stylesheet" /><link href="/assets/r/awsdocs-common.css?version=2021.12.02" rel="stylesheet" /><link href="/assets/r/awsdocs-doc-page.css?version=2021.12.02" rel="stylesheet" /><script async="" id="awsc-panorama-bundle" type="text/javascript" src="https://prod.pa.cdn.uis.awsstatic.com/panorama-nav-init.js" data-config="{'appEntity':'aws-documentation','region':'us-east-1','service':'redshift'}"></script><meta id="panorama-serviceSubSection" value="Guia do desenvolvedor de banco de dados" /><meta id="panorama-serviceConsolePage" value="Criar tabelas externas do Redshift Spectrum" /></head><body class="awsdocs awsui"><div class="awsdocs-container"><awsdocs-header></awsdocs-header><awsui-app-layout id="app-layout" class="awsui-util-no-gutters" ng-controller="ContentController as $ctrl" header-selector="awsdocs-header" navigation-hide="false" navigation-width="$ctrl.navWidth" navigation-open="$ctrl.navOpen" navigation-change="$ctrl.onNavChange($event)" tools-hide="$ctrl.hideTools" tools-width="$ctrl.toolsWidth" tools-open="$ctrl.toolsOpen" tools-change="$ctrl.onToolsChange($event)"><div id="guide-toc" dom-region="navigation"><awsdocs-toc></awsdocs-toc></div><div id="main-column" dom-region="content" tabindex="-1"><awsdocs-view class="awsdocs-view"><div id="awsdocs-content"><head><title>Criar tabelas externas do Redshift Spectrum - Amazon Redshift</title><meta name="pdf" content="redshift-dg.pdf#c-spectrum-external-tables" /><meta name="rss" content="Dochistory.rss" /><meta name="forums" content="http://forums.aws.amazon.com/forum.jspa?forumID=155" /><meta name="feedback" content="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=Redshift&amp;topic_url=https://docs.aws.amazon.com/pt_br/redshift/latest/dg/c-spectrum-external-tables.html" /><meta name="feedback-yes" content="feedbackyes.html?topic_url=https://docs.aws.amazon.com/pt_br/redshift/latest/dg/c-spectrum-external-tables.html" /><meta name="feedback-no" content="feedbackno.html?topic_url=https://docs.aws.amazon.com/pt_br/redshift/latest/dg/c-spectrum-external-tables.html" /><meta name="keywords" content="Amazon Redshift,AWS Redshift,Redshift,Redshift Spectrum,cluster,data warehouse,desenvolvedor,dados de amostra,banco de dados,desenvolvedor do banco de dados,HLL" /><script type="application/ld+json">
{
    "@context" : "https://schema.org",
    "@type" : "BreadcrumbList",
    "itemListElement" : [
      {
        "@type" : "ListItem",
        "position" : 1,
        "name" : "AWS",
        "item" : "https://aws.amazon.com"
      },
      {
        "@type" : "ListItem",
        "position" : 2,
        "name" : "Amazon Redshift",
        "item" : "https://docs.aws.amazon.com/redshift/index.html"
      },
      {
        "@type" : "ListItem",
        "position" : 3,
        "name" : "Guia do desenvolvedor de banco de dados",
        "item" : "https://docs.aws.amazon.com/pt_br/redshift/latest/dg"
      },
      {
        "@type" : "ListItem",
        "position" : 4,
        "name" : "Consultar dados externos usando o Amazon Redshift Spectrum",
        "item" : "https://docs.aws.amazon.com/pt_br/redshift/latest/dg/c-using-spectrum.html"
      },
      {
        "@type" : "ListItem",
        "position" : 5,
        "name" : "Criar tabelas externas do Redshift Spectrum",
        "item" : "https://docs.aws.amazon.com/pt_br/redshift/latest/dg/c-using-spectrum.html"
      }
    ]
}
</script></head><body><div id="main"><div style="display: none"><a href="redshift-dg.pdf#c-spectrum-external-tables" target="_blank" rel="noopener noreferrer" title="Abrir em PDF"></a></div><div id="breadcrumbs" class="breadcrumb"><a href="https://aws.amazon.com">AWS</a><a href="/index.html">Documentação</a><a href="/redshift/index.html">Amazon Redshift</a><a href="welcome.html">Guia do desenvolvedor de banco de dados</a></div><div id="page-toc-src"><a href="#c-spectrum-external-tables-pseudocolumns">Pseudocolunas</a><a href="#c-spectrum-external-tables-partitioning">Dividir as tabelas externas do Redshift Spectrum</a><a href="#c-spectrum-column-mapping-orc">Mapeamento para colunas do ORC</a><a href="#c-spectrum-column-mapping-hudi">Criar tabelas externas para dados gerenciados no Hudi</a><a href="#c-spectrum-column-mapping-delta">Criar tabelas externas para dados do Delta Lake</a></div><div id="main-content" class="awsui-util-container"><div id="main-col-body"><awsdocs-language-banner data-service="$ctrl.pageService"></awsdocs-language-banner><h1 class="topictitle" id="c-spectrum-external-tables">Criar tabelas externas do Redshift Spectrum</h1><div class="awsdocs-page-header-container"><awsdocs-page-header></awsdocs-page-header><awsdocs-filter-selector id="awsdocs-filter-selector"></awsdocs-filter-selector></div><p></p><p>Crie uma tabela externa em um esquema externo. Para criar tabelas externas, você deve ser proprietário do esquema externo ou um superusuário. Para transferir a propriedade de um esquema externo, use <a href="./r_ALTER_SCHEMA.html">ALTER SCHEMA</a> para alterar o proprietário. O exemplo a seguir altera o proprietário do esquema <code class="code">spectrum_schema</code> para <code class="code">newowner</code>.</p><pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copiar"><awsui-icon name="copy"></awsui-icon></div></div><code class="">alter schema spectrum_schema owner to newowner;</code></pre><p>Para executar uma consulta do Redshift Spectrum, você precisa das seguintes permissões:</p><div class="itemizedlist">
          
          
      <ul class="itemizedlist"><li class="listitem">
            <p>Permissão de uso no esquema </p>
         </li><li class="listitem">
            <p>Permissão para criar tabelas temporárias no banco de dados atual </p>
         </li></ul></div><p>O exemplo a seguir concede permissão de uso no esquema <code class="code">spectrum_schema</code> para o grupo de usuários <code class="code">spectrumusers</code>.</p><pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copiar"><awsui-icon name="copy"></awsui-icon></div></div><code class="">grant usage on schema spectrum_schema to group spectrumusers;</code></pre><p>O exemplo a seguir concede permissão temporária no banco de dados <code class="code">spectrumdb</code> para o grupo de usuários <code class="code">spectrumusers</code>. </p><pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copiar"><awsui-icon name="copy"></awsui-icon></div></div><code class="">grant temp on database spectrumdb to group spectrumusers;</code></pre><p>Você pode criar uma tabela externa no Amazon Redshift, AWS Glue, Amazon Athena ou em uma metastore do Apache Hive. Para obter mais informações, consulte <a href="https://docs.aws.amazon.com/glue/latest/dg/getting-started.html">Conceitos básicos do uso do AWS Glue</a> no <em>Guia do desenvolvedor do AWS Glue</em>, <a href="https://docs.aws.amazon.com/athena/latest/ug/getting-started.html">Conceitos básicos</a> no <em>Manual do usuário do Amazon Athena</em> ou <a href="https://docs.aws.amazon.com/emr/latest/ReleaseGuide/emr-hive.html">Apache Hive</a> no <em>Guia do desenvolvedor do Amazon EMR</em>. </p><p>Se sua tabela externa estiver definida no AWS Glue, no Athena ou em uma metastore do Hive, crie primeiro um esquema externo que faça referência ao banco de dados externo. Em seguida, inclua uma referência à tabela externa na instrução SELECT prefixando o nome da tabela com o nome do esquema, sem precisar criar a tabela no Amazon Redshift. Para obter mais informações, consulte <a href="./c-spectrum-external-schemas.html">Criação de esquemas externos do Amazon Redshift Spectrum</a>. </p><p>Para permitir que o Amazon Redshift visualize tabelas no AWS Glue Data Catalog, adicione o <code class="code">glue:GetTable</code> para a função do IAM do Amazon Redshift. Caso contrário, poderá ocorrer um erro semelhante ao seguinte.</p><pre class="programlisting"><div class="code-btn-container"></div><code class="nohighlight">RedshiftIamRoleSession is not authorized to perform: glue:GetTable on resource: *;</code></pre><p>Por exemplo, suponha que você tem uma tabela externa denominada <code class="code">lineitem_athena</code> definida em um catálogo externo do Athena. Nesse caso, você pode definir um esquema externo denominado <code class="code">athena_schema</code> e, em seguida, consultar a tabela usando o comando SELECT a seguir.</p><pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copiar"><awsui-icon name="copy"></awsui-icon></div></div><code class="">select count(*) from athena_schema.lineitem_athena;</code></pre><p>Para definir uma tabela externa no Amazon Redshift, use o comando <a href="./r_CREATE_EXTERNAL_TABLE.html">CREATE EXTERNAL TABLE</a>. A instrução da tabela externa define as colunas da tabela, o formato dos arquivos de dados e a localização dos dados no Amazon S3. O Redshift Spectrum faz uma varredura dos arquivos na pasta especificada e em todas as subpastas. O Redshift Spectrum ignora os arquivos ocultos e os arquivos que começam com um ponto, um sublinhado ou um símbolo do jogo da velha (. , _, ou #) ou terminam com um til (~). </p><p>O exemplo a seguir cria uma tabela chamada SALES no esquema externo do Amazon Redshift denominado <code class="code">spectrum</code>. Os dados estão em arquivos de texto delimitados por tabulação.</p><pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copiar"><awsui-icon name="copy"></awsui-icon></div></div><code class="">create external table spectrum.sales(
salesid integer,
listid integer,
sellerid integer,
buyerid integer,
eventid integer,
dateid smallint,
qtysold smallint,
pricepaid decimal(8,2),
commission decimal(8,2),
saletime timestamp)
row format delimited
fields terminated by '\t'
stored as textfile
location 's3://redshift-downloads/tickit/spectrum/sales/'
table properties ('numRows'='172000');</code></pre><p>Para visualizar as tabelas externas, consulte a exibição do sistema <a href="./r_SVV_EXTERNAL_TABLES.html">SVV_EXTERNAL_TABLES</a>. </p>
         <h2 id="c-spectrum-external-tables-pseudocolumns">Pseudocolunas</h2>

         
         <p>Por padrão, o Amazon Redshift cria tabelas externas com as pseudocolunas <code class="code">$path</code>, <code class="code">$size</code> e <code class="code">$spectrum_oid</code>. Selecione a coluna <code class="code">$path</code> para exibir o caminho para os arquivos de dados no Amazon S3 e selecione a coluna <code class="code">$size</code> para exibir o tamanho dos arquivos de dados em cada linha retornada por uma consulta. A coluna <code class="code">$spectrum_oid</code> possibilita realizar consultas correlacionadas com o Redshift Spectrum. Para ver um exemplo, consulte <a href="./c_performing-correlated-subqueries-spectrum.html">Exemplo: Executar subconsultas correlacionadas no Redshift Spectrum</a>. Você precisa delimitar os nomes de colunas <code class="code">$path</code>, <code class="code">$size</code> e <code class="code">$spectrum_oid</code> com aspas duplas. A cláusula SELECT * não retornará as pseudocolunas. Você deve incluir explicitamente os nomes de coluna <code class="code">$path</code>, <code class="code">$size</code> e <code class="code">$spectrum_oid</code> na consulta, como mostra o exemplo a seguir.</p>
         
         <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copiar"><awsui-icon name="copy"></awsui-icon></div></div><code class="SQL ">select "$path", "$size", "$spectrum_oid"
from spectrum.sales_part where saledate = '2008-12-01';</code></pre>
         
         <p>Você pode desabilitar a criação de pseudocolunas em uma sessão. Basta definir o parâmetro de configuração <code class="code">spectrum_enable_pseudo_columns</code> como <code class="code">false</code>. Para obter mais informações, consulte <a href="./r_spectrum_enable_pseudo_columns.html">spectrum_enable_pseudo_columns</a>. Você também pode desabilitar somente a pseudocoluna <code class="code">$spectrum_oid</code> definindo o parâmetro <code class="code">enable_spectrum_oid</code> como <code class="code">false</code>. Para obter mais informações, consulte <a href="./r_spectrum_enable_spectrum_oid.html">enable_spectrum_oid</a>. No entanto, desabilitar a pseudocoluna <code class="code">$spectrum_oid</code> também desabilita a compatibilidade de consultas correlacionadas com o Redshift Spectrum.</p>
         <div class="awsdocs-note awsdocs-important"><div class="awsdocs-note-title"><awsui-icon name="status-warning" variant="error"></awsui-icon><h6>Importante</h6></div><div class="awsdocs-note-text"><p>A seleção de <code class="code">$size</code>, <code class="code">$path</code> ou <code class="code">$spectrum_oid</code> gera cobranças porque o Redshift Spectrum verifica os arquivos de dados no Amazon S3 para determinar o tamanho do conjunto de resultados. Para obter mais informações, consulte <a href="https://aws.amazon.com/redshift/pricing/" rel="noopener noreferrer" target="_blank"><span>Preço do Amazon Redshift</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a>.</p></div></div>
          
            <h3 id="c-spectrum-external-tables-pseudocolumns-example">Exemplo de pseudocolunas</h3>

            <p>O exemplo a seguir retorna o tamanho total de arquivos de dados relacionados de uma tabela externa.</p>
            <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copiar"><awsui-icon name="copy"></awsui-icon></div></div><code class="">select distinct "$path", "$size"
from spectrum.sales_part;

 $path                                                                    | $size
--------------------------------------------------------------------------+-------
s3://redshift-downloads/tickit/spectrum/sales_partition/saledate=2008-01/ |  1616
s3://redshift-downloads/tickit/spectrum/sales_partition/saledate=2008-02/ |  1444
s3://redshift-downloads/tickit/spectrum/sales_partition/saledate=2008-03/ |  1644</code></pre>
          
       
         <h2 id="c-spectrum-external-tables-partitioning">Dividir as tabelas externas do Redshift Spectrum</h2>

         <p>Ao dividir seus dados em partições, você pode restringir a quantidade de varreduras de dados do Redshift Spectrum filtrando pela chave de partição. Você pode dividir seus dados em partições usando qualquer chave. </p>
         <p>Uma prática comum é dividir os dados com base no tempo. Por exemplo, você pode escolher a partição por ano, mês, data e hora. Se você tiver dados vindos de várias origens, pode dividi-los em partições por um identificador de origem dos dados e por data. </p>
         <p>O procedimento a seguir descreve como dividir os dados em partições.</p>
         <div class="procedure"><h6>Para dividir seus dados em partições</h6><ol><li>
               <p>Armazene os dados em pastas no Amazon S3 de acordo com sua chave de partição. </p>
               <p>Crie uma pasta para cada valor de partição e nomeie a pasta com a chave e o valor da partição. Por exemplo, se você dividir por data, pode ter pastas denominadas <code class="code">saledate=2017-04-01</code>, <code class="code">saledate=2017-04-02</code>, e assim por diante. O Redshift Spectrum faz uma varredura dos arquivos na pasta da partição e em todas as subpastas. O Redshift Spectrum ignora os arquivos ocultos e os arquivos que começam com um ponto, um sublinhado ou um símbolo do jogo da velha (. , _, ou #) ou terminam com um til (~). </p>

            </li><li>
               <p>Crie uma tabela externa e especifique a chave de partição na cláusula PARTITIONED BY. </p>
               <p>A chave de partição não pode ser o nome de uma coluna da tabela. O tipo dos dados pode ser SMALLINT, INTEGER, BIGINT, DECIMAL, REAL, DOUBLE PRECISION, BOOLEAN, CHAR, VARCHAR, DATE ou TIMESTAMP. </p>
            </li><li>
               <p>Adicione as partições. </p>
               <p>Usando o <a href="./r_ALTER_TABLE.html">ALTER TABLE</a> … ADD PARTITION, adicione cada partição especificando a coluna e a chave-valor de partição, além do local da pasta de partição no Amazon S3. Você pode adicionar várias partições em um único comando ALTER TABLE… ADD. O exemplo a seguir inclui partições para <code class="code">'2008-01'</code> e <code class="code">'2008-03'</code>.</p>
               <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copiar"><awsui-icon name="copy"></awsui-icon></div></div><code class="">alter table spectrum.sales_part add
partition(saledate='2008-01-01') 
location 's3://redshift-downloads/tickit/spectrum/sales_partition/saledate=2008-01/'
partition(saledate='2008-03-01') 
location 's3://redshift-downloads/tickit/spectrum/sales_partition/saledate=2008-03/';</code></pre>
               <div class="awsdocs-note"><div class="awsdocs-note-title"><awsui-icon name="status-info" variant="link"></awsui-icon><h6>nota</h6></div><div class="awsdocs-note-text"><p>Se usar o catálogo do AWS Glue, você poderá adicionar até 100 partições usando um único comando ALTER TABLE.</p></div></div>
            </li></ol></div>

          
            <h3 id="c-spectrum-external-tables-partitioning-example">Exemplos de particionamento de dados</h3>


            <p>Neste exemplo, você cria uma tabela externa que é particionada por uma única chave de partição e uma tabela externa que é particionada por duas chaves de partição.</p>

            <p>Os dados deste exemplo estão localizados em um bucket do Amazon S3 que oferece acesso de leitura a todos os usuários autenticados da AWS. O cluster e os arquivos de dados externos devem estar localizados na mesma Região da AWS. O bucket de dados de exemplo está na região Leste dos EUA (Norte da Virgínia) (us-east-1). Para acessar os dados usando o Redshift Spectrum, seu cluster também deve estar em us-east-1. Para listar as pastas no Amazon S3, execute o comando a seguir.</p>
            <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copiar"><awsui-icon name="copy"></awsui-icon></div></div><code class="">aws s3 ls s3://redshift-downloads/tickit/spectrum/sales_partition/</code></pre>
            <pre class="screen">PRE saledate=2008-01/
PRE saledate=2008-03/
PRE saledate=2008-04/
PRE saledate=2008-05/
PRE saledate=2008-06/
PRE saledate=2008-12/</pre>
            <p>Se você ainda não tiver um esquema externo, execute o seguinte comando. Substitua o nome de recurso da Amazon (ARN) para a sua função do AWS Identity and Access Management (IAM).</p>
            <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copiar"><awsui-icon name="copy"></awsui-icon></div></div><code class="">create external schema spectrum
from data catalog
database 'spectrumdb'
iam_role 'arn:aws:iam::123456789012:role/myspectrumrole'
create external database if not exists;</code></pre>
             
               <h4 id="c-spectrum-external-tables-single-partition-example">Exemplo 1: particionamento com uma única chave de partição</h4>
               <p>No exemplo a seguir, você cria uma tabela externa que é particionada pelo mês.</p>
               <p>Para criar uma tabela externa particionada pelo mês, execute o seguinte comando.</p>
               <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copiar"><awsui-icon name="copy"></awsui-icon></div></div><code class="">create external table spectrum.sales_part(
salesid integer,
listid integer,
sellerid integer,
buyerid integer,
eventid integer,
dateid smallint,
qtysold smallint,
pricepaid decimal(8,2),
commission decimal(8,2),
saletime timestamp)
partitioned by (saledate char(10))
row format delimited
fields terminated by '|'
stored as textfile
location 's3://redshift-downloads/tickit/spectrum/sales_partition/'
table properties ('numRows'='172000');</code></pre>
               <p>Para adicionar as partições, execute o seguinte comando ALTER TABLE.</p>
               <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copiar"><awsui-icon name="copy"></awsui-icon></div></div><code class="">alter table spectrum.sales_part add
partition(saledate='2008-01') 
location 's3://redshift-downloads/tickit/spectrum/sales_partition/saledate=2008-01/'

partition(saledate='2008-03') 
location 's3://redshift-downloads/tickit/spectrum/sales_partition/saledate=2008-03/'

partition(saledate='2008-04') 
location 's3://redshift-downloads/tickit/spectrum/sales_partition/saledate=2008-04/';</code></pre>
               <p>Para selecionar dados na tabela particionada, execute a consulta a seguir.</p>
               <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copiar"><awsui-icon name="copy"></awsui-icon></div></div><code class="">select top 5 spectrum.sales_part.eventid, sum(spectrum.sales_part.pricepaid) 
from spectrum.sales_part, event
where spectrum.sales_part.eventid = event.eventid
  and spectrum.sales_part.pricepaid &gt; 30
  and saledate = '2008-01'
group by spectrum.sales_part.eventid
order by 2 desc;</code></pre>

               <pre class="screen">eventid | sum     
--------+---------
   4124 | 21179.00
   1924 | 20569.00
   2294 | 18830.00
   2260 | 17669.00
   6032 | 17265.00</pre>
               <p>Para visualizar as partições da tabela externa, consulte a exibição do sistema <a href="./r_SVV_EXTERNAL_PARTITIONS.html">SVV_EXTERNAL_PARTITIONS</a>.</p>
               <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copiar"><awsui-icon name="copy"></awsui-icon></div></div><code class="">select schemaname, tablename, values, location from svv_external_partitions
where tablename = 'sales_part';</code></pre>

               <pre class="screen">schemaname | tablename  | values      | location                                                                
-----------+------------+-------------+-------------------------------------------------------------------------
spectrum   | sales_part | ["2008-01"] | s3://redshift-downloads/tickit/spectrum/sales_partition/saledate=2008-01
spectrum   | sales_part | ["2008-03"] | s3://redshift-downloads/tickit/spectrum/sales_partition/saledate=2008-03
spectrum   | sales_part | ["2008-04"] | s3://redshift-downloads/tickit/spectrum/sales_partition/saledate=2008-04</pre>
             
             
               <h4 id="c-spectrum-external-tables-multi-partition-example">Exemplo 2: particionamento com várias chaves de partição</h4>

               <p>Para criar uma tabela externa particionada por <code class="code">date</code> e por <code class="code">eventid</code>, execute o seguinte comando.</p>
               <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copiar"><awsui-icon name="copy"></awsui-icon></div></div><code class="">create external table spectrum.sales_event(
salesid integer,
listid integer,
sellerid integer,
buyerid integer,
eventid integer,
dateid smallint,
qtysold smallint,
pricepaid decimal(8,2),
commission decimal(8,2),
saletime timestamp)
partitioned by (salesmonth char(10), event integer)
row format delimited
fields terminated by '|'
stored as textfile
location 's3://redshift-downloads/tickit/spectrum/salesevent/'
table properties ('numRows'='172000');</code></pre>
               <p>Para adicionar as partições, execute o seguinte comando ALTER TABLE.</p>
               <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copiar"><awsui-icon name="copy"></awsui-icon></div></div><code class="">alter table spectrum.sales_event add
partition(salesmonth='2008-01', event='101') 
location 's3://redshift-downloads/tickit/spectrum/salesevent/salesmonth=2008-01/event=101/'

partition(salesmonth='2008-01', event='102') 
location 's3://redshift-downloads/tickit/spectrum/salesevent/salesmonth=2008-01/event=102/'

partition(salesmonth='2008-01', event='103') 
location 's3://redshift-downloads/tickit/spectrum/salesevent/salesmonth=2008-01/event=103/'

partition(salesmonth='2008-02', event='101') 
location 's3://redshift-downloads/tickit/spectrum/salesevent/salesmonth=2008-02/event=101/'

partition(salesmonth='2008-02', event='102') 
location 's3://redshift-downloads/tickit/spectrum/salesevent/salesmonth=2008-02/event=102/'

partition(salesmonth='2008-02', event='103') 
location 's3://redshift-downloads/tickit/spectrum/salesevent/salesmonth=2008-02/event=103/'

partition(salesmonth='2008-03', event='101') 
location 's3://redshift-downloads/tickit/spectrum/salesevent/salesmonth=2008-03/event=101/'

partition(salesmonth='2008-03', event='102') 
location 's3://redshift-downloads/tickit/spectrum/salesevent/salesmonth=2008-03/event=102/'

partition(salesmonth='2008-03', event='103') 
location 's3://redshift-downloads/tickit/spectrum/salesevent/salesmonth=2008-03/event=103/';</code></pre>
               <p>Execute a consulta a seguir para selecionar os dados da tabela particionada.</p>
               <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copiar"><awsui-icon name="copy"></awsui-icon></div></div><code class="">select spectrum.sales_event.salesmonth, event.eventname, sum(spectrum.sales_event.pricepaid) 
from spectrum.sales_event, event
where spectrum.sales_event.eventid = event.eventid
  and salesmonth = '2008-02'
	and (event = '101'
	or event = '102'
	or event = '103')
group by event.eventname, spectrum.sales_event.salesmonth
order by 3 desc;</code></pre>
               <pre class="screen">salesmonth | eventname       | sum    
-----------+-----------------+--------
2008-02    | The Magic Flute | 5062.00
2008-02    | La Sonnambula   | 3498.00
2008-02    | Die Walkure     |  534.00</pre>
             
          
       
         <h2 id="c-spectrum-column-mapping-orc">Mapeamento de colunas de tabela externa para colunas do ORC</h2>
         <p>Você usa tabelas externas do Amazon Redshift Spectrum para consultar dados de arquivos no formato ORC. O formato de coluna de linha otimizada (ORC) é um formato de arquivo de armazenamento colunar que oferece suporte para estruturas de dados aninhadas. Para obter mais informações sobre como consultar dados aninhados, consulte <a href="./tutorial-query-nested-data.html#tutorial-nested-data-overview">Consultar dados aninhados com o Amazon Redshift Spectrum</a>. </p>
         <p>Ao criar uma tabela externa que faz referência a dados em um arquivo ORC, você mapeia cada coluna na tabela externa para uma coluna nos dados ORC. Para fazer isso, você usa um dos seguintes métodos:</p>
         <div class="itemizedlist">
             
             
         <ul class="itemizedlist"><li class="listitem">
               <p><a href="#orc-mapping-by-position">Mapeamento por posição</a></p>
            </li><li class="listitem">
               <p><a href="#orc-mapping-by-name">Mapeamento por nome de coluna</a> </p>
            </li></ul></div>
         <p>O mapeamento por nome de coluna é o padrão. </p>
          
            <h3 id="orc-mapping-by-position">Mapeamento por posição</h3>
            <p>Com o mapeamento por posição, a primeira coluna definida na tabela externa é mapeada para a primeira coluna no arquivo de dados ORC, a segundo para a segundo e assim por diante. O mapeamento por posição requer que a ordem das colunas na tabela externa e no arquivo ORC corresponda. Se a ordem das colunas não corresponder, você poderá mapear as colunas por nome. </p>
            <div class="awsdocs-note awsdocs-important"><div class="awsdocs-note-title"><awsui-icon name="status-warning" variant="error"></awsui-icon><h6>Importante</h6></div><div class="awsdocs-note-text"><p>Em releases anteriores, o Redshift Spectrum usava o mapeamento de posição por padrão. Se você precisar continuar usando o mapeamento por posição para tabelas existentes, defina a propriedade de tabela <code class="code">orc.schema.resolution</code> como <code class="code">position</code>, como mostra o exemplo a seguir. </p><pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copiar"><awsui-icon name="copy"></awsui-icon></div></div><code class="">alter table spectrum.orc_example 
set table properties('orc.schema.resolution'='position'); </code></pre></div></div>
            <p>Por exemplo, a tabela <code class="code">SPECTRUM.ORC_EXAMPLE</code> é definida da seguinte maneira. </p>
            <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copiar"><awsui-icon name="copy"></awsui-icon></div></div><code class="">create external table spectrum.orc_example(
int_col int,
float_col float,
nested_col struct&lt;
  "int_col" : int,
  "map_col" : map&lt;int, array&lt;float &gt;&gt;
   &gt;
) stored as orc
location 's3://example/orc/files/';</code></pre>
            <p>A estrutura da tabela pode ser abstraída como segue. </p>
            <pre class="screen">• 'int_col' : int
• 'float_col' : float
• 'nested_col' : struct
   o 'int_col' : int
   o 'map_col' : map
      - key : int
      - value : array
         - value : float</pre>
            <p>O arquivo ORC subjacente tem a seguinte estrutura de arquivos.</p>
            <pre class="screen">• ORC file root(id = 0)
   o 'int_col' : int (id = 1)
   o 'float_col' : float (id = 2)
   o 'nested_col' : struct (id = 3)
      - 'int_col' : int (id = 4)
      - 'map_col' : map (id = 5)
         - key : int (id = 6)
         - value : array (id = 7)
            - value : float (id = 8)</pre>
            <p>Neste exemplo, você pode mapear cada coluna na tabela externa para uma coluna no arquivo ORC estritamente por posição. Veja o mapeamento a seguir.</p>

            <div class="table-container"><div class="table-contents"><table id="w319aac29c19c45c11c21"><thead>
                     <tr>
                        <th>Nome da coluna de tabela externa</th>
                        <th>ID de coluna ORC</th>
                        <th>Nome da coluna ORC</th>
                     </tr>
                  </thead>
                     <tr>
                        <td tabindex="-1">int_col</td>
                        <td tabindex="-1">1</td>
                        <td tabindex="-1">int_col</td>
                     </tr>
                     <tr>
                        <td tabindex="-1">float_col</td>
                        <td tabindex="-1">2</td>
                        <td tabindex="-1">float_col</td>
                     </tr>
                     <tr>
                        <td tabindex="-1">nested_col</td>
                        <td tabindex="-1">3</td>
                        <td tabindex="-1">nested_col</td>
                     </tr>
                     <tr>
                        <td tabindex="-1">nested_col.int_col</td>
                        <td tabindex="-1">4</td>
                        <td tabindex="-1">int_col</td>
                     </tr>
                     <tr>
                        <td tabindex="-1">nested_col.map_col</td>
                        <td tabindex="-1">5</td>
                        <td tabindex="-1">map_col</td>
                     </tr>
                     <tr>
                        <td tabindex="-1">nested_col.map_col.key</td>
                        <td tabindex="-1">6</td>
                        <td tabindex="-1">N/D</td>
                     </tr>
                     <tr>
                        <td tabindex="-1">nested_col.map_col.value</td>
                        <td tabindex="-1">7</td>
                        <td tabindex="-1">N/D</td>
                     </tr>
                     <tr>
                        <td tabindex="-1">nested_col.map_col.value.item</td>
                        <td tabindex="-1">8</td>
                        <td tabindex="-1">N/D</td>
                     </tr>
                  </table></div></div>
          
          
            <h3 id="orc-mapping-by-name">Mapeamento por nome de coluna</h3>
            <p>Usando o mapeamento de nomes, você mapeia colunas em uma tabela externa para colunas nomeadas em arquivos ORC no mesmo nível, com o mesmo nome. </p>
            <p>Por exemplo, suponha que você queira mapear a tabela do exemplo anterior, <code class="code">SPECTRUM.ORC_EXAMPLE</code>, com um arquivo ORC que usa a seguinte estrutura de arquivo.</p>
            <pre class="screen">• ORC file root(id = 0)
   o 'nested_col' : struct (id = 1)
      - 'map_col' : map (id = 2)
         - key : int (id = 3)
         - value : array (id = 4)
            - value : float (id = 5)
      - 'int_col' : int (id = 6)
   o 'int_col' : int (id = 7)
   o 'float_col' : float (id = 8)</pre>

            <p>Usando mapeamento por posição, o Redshift Spectrum tenta o seguinte mapeamento. </p>
            <div class="table-container"><div class="table-contents"><table id="w319aac29c19c45c13c11"><thead>
                     <tr>
                        <th>Nome da coluna de tabela externa</th>
                        <th>ID de coluna ORC</th>
                        <th>Nome da coluna ORC</th>
                     </tr>
                  </thead>
                     <tr>
                        <td tabindex="-1">int_col</td>
                        <td tabindex="-1">1</td>
                        <td tabindex="-1">struct</td>
                     </tr>
                     <tr>
                        <td tabindex="-1">float_col</td>
                        <td tabindex="-1">7</td>
                        <td tabindex="-1">int_col</td>
                     </tr>
                     <tr>
                        <td tabindex="-1">nested_col</td>
                        <td tabindex="-1">8</td>
                        <td tabindex="-1">float_col</td>
                     </tr>
                  </table></div></div>
            <p>Quando você consulta uma tabela com o mapeamento de posição anterior, o comando SELECT falha na validação de tipo, pois as estruturas são diferentes. </p>
            <p>Você pode mapear a mesma tabela externa para ambas as estruturas de arquivo mostradas nos exemplos anteriores usando o mapeamento por nome de coluna. As colunas da tabela <code class="code">int_col</code>, <code class="code">float_col</code> e <code class="code">nested_col</code> são mapeadas por nome de coluna para colunas com os mesmos nomes no arquivo ORC. A coluna denominada <code class="code">nested_col</code> na tabela externa é uma coluna <code class="code">struct</code> com subcolunas denominadas <code class="code">map_col</code> e <code class="code">int_col</code>. As subcolunas também são mapeadas corretamente para as colunas correspondentes no arquivo ORC por nome da coluna. </p>

          
       
      <h2 id="c-spectrum-column-mapping-hudi">Criar tabelas externas para dados gerenciados no Apache Hudi</h2>
      <p>Para consultar dados no formato Apache Hudi Copy On Write (CoW), use tabelas externas do Amazon Redshift Spectrum. Uma tabela do Delta Lake é uma coleção de arquivos do Apache Parquet armazenados no Amazon S3. É possível ler tabelas de cópia em gravação (CoW) nas versões 0.5.2, 0.6.0, 0.7.0, 0.8.0, 0.9.0, 0.10.0, 0.10.1, 0.11.0 e 0.11.1 do Apache Hudi que são criadas e modificadas com operações de gravação insert, delete e upsert. Por exemplo, tabelas de bootstrap não são compatíveis. Para obter mais informações, consulte <a href="https://hudi.apache.org/docs/next/table_types#copy-on-write-table" rel="noopener noreferrer" target="_blank"><span>Tabela do Copy On Write</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a> na documentação de código aberto do Apache Hudi. </p>
      <p>Ao criar uma tabela externa que faz referência a dados em um formato Hudi CoW, você mapeia cada coluna na tabela externa para uma coluna nos dados do Hudi. O mapeamento é feito por coluna. </p>

      <p>As instruções de linguagem de definição de dados (DDL) para tabelas particionadas e não particionadas do Hudi são semelhantes às de outros formatos de arquivo do Apache Parquet. Para tabelas do Hudi, defina <code class="code">INPUTFORMAT</code> como <code class="code">org.apache.hudi.hadoop.HoodieParquetInputFormat</code>. O parâmetro <code class="code">LOCATION</code> deve apontar para a pasta base da tabela do Hudi que contém a pasta <code class="code">.hoodie</code>, necessária para estabelecer a linha do tempo de confirmação do Hudi. Em alguns casos, uma operação SELECT em uma tabela do Hudi pode falhar, exibindo a mensagem <strong class="errortext"><code>Nenhuma linha de tempo de confirmação válida do Hudi foi encontrada</code></strong>. Se for o caso, verifique se a pasta <code class="code">.hoodie</code> está no local correto e contém uma linha de tempo de confirmação do Hudi válida. </p>
      <div class="awsdocs-note"><div class="awsdocs-note-title"><awsui-icon name="status-info" variant="link"></awsui-icon><h6>nota</h6></div><div class="awsdocs-note-text"><p>O formato Apache Hudi só é compatível quando você usa um AWS Glue Data Catalog. Ele não é compatível quando você usa uma metastore do Apache Hive como o catálogo externo. </p></div></div>
      <p>O DDL para definir uma tabela não particionada tem o formato a seguir. </p>
      <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copiar"><awsui-icon name="copy"></awsui-icon></div></div><code class="sql ">CREATE EXTERNAL TABLE <em>tbl_name</em> (<em>columns</em>)
ROW FORMAT SERDE 'org.apache.hadoop.hive.ql.io.parquet.serde.ParquetHiveSerDe'
STORED AS
INPUTFORMAT 'org.apache.hudi.hadoop.HoodieParquetInputFormat'
OUTPUTFORMAT 'org.apache.hadoop.hive.ql.io.parquet.MapredParquetOutputFormat'
LOCATION 's3://<em>s3-bucket</em>/<em>prefix</em>'</code></pre>
      <p>O DDL para definir uma tabela particionada tem o formato a seguir. </p>
      <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copiar"><awsui-icon name="copy"></awsui-icon></div></div><code class="sql ">CREATE EXTERNAL TABLE <em>tbl_name</em> (<em>columns</em>)
PARTITIONED BY(<em>pcolumn1</em> <em>pcolumn1-type</em>[,...])
ROW FORMAT SERDE 'org.apache.hadoop.hive.ql.io.parquet.serde.ParquetHiveSerDe'
STORED AS
INPUTFORMAT 'org.apache.hudi.hadoop.HoodieParquetInputFormat'
OUTPUTFORMAT 'org.apache.hadoop.hive.ql.io.parquet.MapredParquetOutputFormat'
LOCATION 's3://<em>s3-bucket</em>/<em>prefix</em>'</code></pre>
      <p>Para adicionar partições a uma tabela do Hudi particionada, execute um comando ALTER TABLE ADD PARTITION, no qual o parâmetro <code class="code">LOCATION</code> aponta para a subpasta do Amazon S3 com os arquivos que pertencem à partição.</p>
      <p>O DDL para adicionar partições tem o formato a seguir.</p>
      <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copiar"><awsui-icon name="copy"></awsui-icon></div></div><code class="sql ">ALTER TABLE <em>tbl_name</em>
ADD IF NOT EXISTS PARTITION(<em>pcolumn1</em>=<em>pvalue1</em>[,...])
LOCATION 's3://<em>s3-bucket</em>/<em>prefix</em>/<em>partition-path</em>'</code></pre>
    
      <h2 id="c-spectrum-column-mapping-delta">Criar tabelas externas para dados gerenciados no Delta Lake</h2>
      <p>Para consultar dados em tabelas do Delta Lake, você pode usar tabelas externas do Amazon Redshift Spectrum. </p>
         <p>Para acessar uma tabela do Delta Lake a partir do Redshift Spectrum, gere um manifesto antes da consulta. Um <em>manifesto</em> do Delta Lake contém uma lista de arquivos que compõem um snapshot consistente da tabela do Delta Lake. Em uma tabela particionada, há um manifesto por partição. Uma tabela do Delta Lake é uma coleção de arquivos do Apache Parquet armazenados no Amazon S3. Para obter mais informações, consulte <a href="https://delta.io" rel="noopener noreferrer" target="_blank"><span>Delta Lake</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a> na documentação de código aberto do Delta Lake. </p>
      <p>Ao criar uma tabela externa que faz referência a dados em tabelas do Delta Lake, você mapeia cada coluna na tabela externa para uma coluna na tabela do Delta Lake. O mapeamento é feito pelo nome da coluna. </p>
      
      <p>O DDL para tabelas particionadas e não particionadas do Delta Lake é semelhante ao dos outros formatos de arquivo do Apache Parquet. Para tabelas do Delta Lake, defina <code class="code">INPUTFORMAT</code> como <code class="code">org.apache.hadoop.hive.ql.io.SymlinkTextInputFormat</code> e <code class="code">OUTPUTFORMAT</code> como <code class="code">org.apache.hadoop.hive.ql.io.HiveIgnoreKeyTextOutputFormat</code>. O <code class="code">LOCATION</code> deve apontar para a pasta de manifesto na pasta base da tabela. Se uma operação SELECT em uma tabela do Delta Lake falhar, consulte <a href="#c-spectrum-column-mapping-delta-limitations">Limitações e solução de problemas para tabelas do Delta Lake</a> para obter os possíveis motivos. </p>
      <p>O DDL para definir uma tabela não particionada tem o formato a seguir. </p>
      <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copiar"><awsui-icon name="copy"></awsui-icon></div></div><code class="sql ">CREATE EXTERNAL TABLE <em>tbl_name</em> (<em>columns</em>)
ROW FORMAT SERDE 'org.apache.hadoop.hive.ql.io.parquet.serde.ParquetHiveSerDe'
STORED AS
INPUTFORMAT 'org.apache.hadoop.hive.ql.io.SymlinkTextInputFormat'
OUTPUTFORMAT 'org.apache.hadoop.hive.ql.io.HiveIgnoreKeyTextOutputFormat'
LOCATION 's3://<em>s3-bucket</em>/<em>prefix</em>/_symlink_format_manifest'</code></pre>
      <p>O DDL para definir uma tabela particionada tem o formato a seguir. </p>
      <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copiar"><awsui-icon name="copy"></awsui-icon></div></div><code class="sql ">CREATE EXTERNAL TABLE <em>tbl_name</em> (<em>columns</em>)
PARTITIONED BY(<em>pcolumn1</em> <em>pcolumn1-type</em>[,...])
ROW FORMAT SERDE 'org.apache.hadoop.hive.ql.io.parquet.serde.ParquetHiveSerDe'
STORED AS
INPUTFORMAT 'org.apache.hadoop.hive.ql.io.SymlinkTextInputFormat'
OUTPUTFORMAT 'org.apache.hadoop.hive.ql.io.HiveIgnoreKeyTextOutputFormat'
LOCATION 's3://<em>s3-bucket</em>&gt;/<em>prefix</em>/_symlink_format_manifest'</code></pre>
      <p>Para adicionar partições a uma tabela particionada do Delta Lake, execute um comando ALTER TABLE ADD PARTITION no qual o parâmetro <code class="code">LOCATION</code> aponte para a subpasta do Amazon S3 que contém o manifesto para a partição.</p>
      <p>O DDL para adicionar partições tem o formato a seguir.</p>
      <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copiar"><awsui-icon name="copy"></awsui-icon></div></div><code class="sql ">ALTER TABLE <em>tbl_name</em>
ADD IF NOT EXISTS PARTITION(<em>pcolumn1</em>=<em>pvalue1</em>[,...])
LOCATION
's3://<em>s3-bucket</em>/<em>prefix</em>/_symlink_format_manifest/<em>partition-path</em>'</code></pre>
      <p>Ou execute o DDL que aponte diretamente para o arquivo manifesto do Delta Lake.</p>
      <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copiar"><awsui-icon name="copy"></awsui-icon></div></div><code class="sql ">ALTER TABLE <em>tbl_name</em>
ADD IF NOT EXISTS PARTITION(<em>pcolumn1</em>=<em>pvalue1</em>[,...])
LOCATION
's3://<em>s3-bucket</em>/<em>prefix</em>/_symlink_format_manifest/<em>partition-path</em>/manifest'</code></pre>
      
       
         <h3 id="c-spectrum-column-mapping-delta-limitations">Limitações e solução de problemas para tabelas do Delta Lake</h3>
       
      <p>Considere o seguinte ao consultar tabelas do Delta Lake do Redshift Spectrum:</p>
      <div class="itemizedlist">
          
          
      <ul class="itemizedlist"><li class="listitem"><p>Se um manifesto apontar para um snapshot ou partição que não existe mais, as consultas falharão até que um novo manifesto válido seja gerado. Por exemplo, isso pode resultar de uma operação VACUUM na tabela subjacente,</p></li><li class="listitem"><p>Os manifestos do Delta Lake fornecem apenas consistência em nível de partição. </p></li></ul></div>
      <p>A tabela a seguir explica alguns potenciais motivos para determinados erros quando você consulta uma tabela do Delta Lake. </p>
      <div class="table-container"><div class="table-contents"><table id="w319aac29c19c49c37"><thead>
               <tr>
                  <th>Mensagem de erro</th>
                  <th>Possível motivo</th>
               </tr>
            </thead>
               
               
               <tr>
                  <td tabindex="-1"><p><strong class="errortext"><code>O manifesto do Delta Lake no bucket <em>s3-bucket-1</em> não pode conter entradas no bucket <em>s3-bucket-2</em>.</code></strong></p></td>
                  <td tabindex="-1"><p>As entradas de manifesto apontam para arquivos em um bucket do Amazon S3 diferente do especificado. </p></td>
               </tr>
               <tr>
                  <td tabindex="-1"><p><strong class="errortext"><code>Os arquivos do Delta Lake devem estar na mesma pasta.</code></strong></p></td>
                  <td tabindex="-1"><p>As entradas de manifesto apontam para arquivos que têm um prefixo do Amazon S3 diferente do especificado.</p></td>
               </tr>
               <tr>
                  <td tabindex="-1"><p><strong class="errortext"><code>Não foi possível encontrar o arquivo <em>filename</em> listado no manifesto do Delta Lake <em>manifest-path</em>.</code></strong></p></td>
                  <td tabindex="-1"><p>Um arquivo listado no manifesto não foi encontrado no Amazon S3. </p></td>
               </tr>
               <tr>
                  <td tabindex="-1"><p><strong class="errortext"><code>Erro ao buscar o manifesto do Delta Lake.</code></strong></p></td>
                  <td tabindex="-1"><p>O manifesto não foi encontrado no Amazon S3. </p></td>
               </tr>
               <tr>
                  <td tabindex="-1"><p><strong class="errortext"><code>Caminho do S3 inválido.</code></strong></p></td>
                  <td tabindex="-1"><p>Uma entrada no arquivo manifesto não é um caminho válido do Amazon S3 ou o arquivo manifesto foi corrompido. </p></td>
               </tr>

            </table></div></div>
      
   <awsdocs-copyright class="copyright-print"></awsdocs-copyright><awsdocs-thumb-feedback right-edge="{{$ctrl.thumbFeedbackRightEdge}}"></awsdocs-thumb-feedback></div><noscript><div><div><div><div id="js_error_message"><p><img src="https://d1ge0kk1l5kms0.cloudfront.net/images/G/01/webservices/console/warning.png" alt="Atenção" /> <strong>O Javascript está desativado ou não está disponível no seu navegador.</strong></p><p>Para usar a documentação da AWS, o Javascript deve estar ativado. Consulte as páginas de Ajuda do navegador para obter instruções.</p></div></div></div></div></noscript><div id="main-col-footer" class="awsui-util-font-size-0"><div id="doc-conventions"><a target="_top" href="/general/latest/gr/docconventions.html">Convenções do documento</a></div><div class="prev-next"><div id="previous" class="prev-link" accesskey="p" href="./c-spectrum-external-schemas.html">Criação de esquemas externos</div><div id="next" class="next-link" accesskey="n" href="./querying-iceberg.html">Usar tabelas do Apache Iceberg</div></div></div><awsdocs-page-utilities></awsdocs-page-utilities></div><div id="quick-feedback-yes" style="display: none;"><div class="title">Essa página foi útil? - Sim</div><div class="content"><p>Obrigado por nos informar que estamos fazendo um bom trabalho!</p><p>Se tiver tempo, conte-nos sobre o que você gostou para que possamos melhorar ainda mais.</p><p><awsui-button id="fblink" rel="noopener noreferrer" target="_blank" text="Feedback" click="linkClick($event)" href="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=Redshift&amp;topic_url=https://docs.aws.amazon.com/pt_br/redshift/latest/dg/c-spectrum-external-tables.html"></awsui-button></p></div></div><div id="quick-feedback-no" style="display: none;"><div class="title">Essa página foi útil? - Não</div><div class="content"><p>Obrigado por nos informar que precisamos melhorar a página. Lamentamos ter decepcionado você.</p><p>Se tiver tempo, conte-nos como podemos melhorar a documentação.</p><p><awsui-button id="fblink" rel="noopener noreferrer" target="_blank" text="Feedback" click="linkClick($event)" href="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=Redshift&amp;topic_url=https://docs.aws.amazon.com/pt_br/redshift/latest/dg/c-spectrum-external-tables.html"></awsui-button></p></div></div></div></body></div></awsdocs-view><div class="page-loading-indicator" id="page-loading-indicator"><awsui-spinner size="large"></awsui-spinner></div></div><div id="tools-panel" dom-region="tools"><awsdocs-tools-panel id="awsdocs-tools-panel"></awsdocs-tools-panel></div></awsui-app-layout><awsdocs-cookie-banner class="doc-cookie-banner"></awsdocs-cookie-banner></div></body></html>