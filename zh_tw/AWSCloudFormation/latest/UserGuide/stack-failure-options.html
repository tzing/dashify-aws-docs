<!DOCTYPE html>
    <html xmlns="http://www.w3.org/1999/xhtml" lang="zh-TW"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>堆疊失敗選項 - AWS CloudFormation</title><meta name="viewport" content="width=device-width,initial-scale=1" /><meta name="assets_root" content="/assets" /><meta name="target_state" content="stack-failure-options" /><meta name="default_state" content="stack-failure-options" /><link rel="icon" type="image/ico" href="/assets/images/favicon.ico" /><link rel="shortcut icon" type="image/ico" href="/assets/images/favicon.ico" /><link rel="canonical" href="https://docs.aws.amazon.com/zh_tw/AWSCloudFormation/latest/UserGuide/stack-failure-options.html" /><meta name="description" content="在發生佈建失敗時，可以從失敗點開始，而不復原成功佈建的資源，以反覆開發應用程式。" /><meta name="deployment_region" content="IAD" /><meta name="product" content="AWS CloudFormation" /><meta name="guide" content="使用者指南" /><meta name="abstract" content="使 AWS CloudFormation 用本使用者指南可預測並重複地建立和管理 AWS 基礎架構部署。" /><meta name="guide-locale" content="zh_tw" /><meta name="tocs" content="toc-contents.json" /><link rel="canonical" href="https://docs.aws.amazon.com/zh_tw/AWSCloudFormation/latest/UserGuide/stack-failure-options.html" /><link rel="alternative" href="https://docs.aws.amazon.com/id_id/AWSCloudFormation/latest/UserGuide/stack-failure-options.html" hreflang="id-id" /><link rel="alternative" href="https://docs.aws.amazon.com/id_id/AWSCloudFormation/latest/UserGuide/stack-failure-options.html" hreflang="id" /><link rel="alternative" href="https://docs.aws.amazon.com/de_de/AWSCloudFormation/latest/UserGuide/stack-failure-options.html" hreflang="de-de" /><link rel="alternative" href="https://docs.aws.amazon.com/de_de/AWSCloudFormation/latest/UserGuide/stack-failure-options.html" hreflang="de" /><link rel="alternative" href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/stack-failure-options.html" hreflang="en-us" /><link rel="alternative" href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/stack-failure-options.html" hreflang="en" /><link rel="alternative" href="https://docs.aws.amazon.com/es_es/AWSCloudFormation/latest/UserGuide/stack-failure-options.html" hreflang="es-es" /><link rel="alternative" href="https://docs.aws.amazon.com/es_es/AWSCloudFormation/latest/UserGuide/stack-failure-options.html" hreflang="es" /><link rel="alternative" href="https://docs.aws.amazon.com/fr_fr/AWSCloudFormation/latest/UserGuide/stack-failure-options.html" hreflang="fr-fr" /><link rel="alternative" href="https://docs.aws.amazon.com/fr_fr/AWSCloudFormation/latest/UserGuide/stack-failure-options.html" hreflang="fr" /><link rel="alternative" href="https://docs.aws.amazon.com/it_it/AWSCloudFormation/latest/UserGuide/stack-failure-options.html" hreflang="it-it" /><link rel="alternative" href="https://docs.aws.amazon.com/it_it/AWSCloudFormation/latest/UserGuide/stack-failure-options.html" hreflang="it" /><link rel="alternative" href="https://docs.aws.amazon.com/ja_jp/AWSCloudFormation/latest/UserGuide/stack-failure-options.html" hreflang="ja-jp" /><link rel="alternative" href="https://docs.aws.amazon.com/ja_jp/AWSCloudFormation/latest/UserGuide/stack-failure-options.html" hreflang="ja" /><link rel="alternative" href="https://docs.aws.amazon.com/ko_kr/AWSCloudFormation/latest/UserGuide/stack-failure-options.html" hreflang="ko-kr" /><link rel="alternative" href="https://docs.aws.amazon.com/ko_kr/AWSCloudFormation/latest/UserGuide/stack-failure-options.html" hreflang="ko" /><link rel="alternative" href="https://docs.aws.amazon.com/pt_br/AWSCloudFormation/latest/UserGuide/stack-failure-options.html" hreflang="pt-br" /><link rel="alternative" href="https://docs.aws.amazon.com/pt_br/AWSCloudFormation/latest/UserGuide/stack-failure-options.html" hreflang="pt" /><link rel="alternative" href="https://docs.aws.amazon.com/zh_cn/AWSCloudFormation/latest/UserGuide/stack-failure-options.html" hreflang="zh-cn" /><link rel="alternative" href="https://docs.aws.amazon.com/zh_tw/AWSCloudFormation/latest/UserGuide/stack-failure-options.html" hreflang="zh-tw" /><link rel="alternative" href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/stack-failure-options.html" hreflang="x-default" /><meta name="feedback-item" content="CloudFormation" /><meta name="this_doc_product" content="AWS CloudFormation" /><meta name="this_doc_guide" content="使用者指南" /><script defer="" src="/assets/r/vendor4.js?version=2021.12.02"></script><script defer="" src="/assets/r/vendor3.js?version=2021.12.02"></script><script defer="" src="/assets/r/vendor1.js?version=2021.12.02"></script><script defer="" src="/assets/r/awsdocs-common.js?version=2021.12.02"></script><script defer="" src="/assets/r/awsdocs-doc-page.js?version=2021.12.02"></script><link href="/assets/r/vendor4.css?version=2021.12.02" rel="stylesheet" /><link href="/assets/r/awsdocs-common.css?version=2021.12.02" rel="stylesheet" /><link href="/assets/r/awsdocs-doc-page.css?version=2021.12.02" rel="stylesheet" /><script async="" id="awsc-panorama-bundle" type="text/javascript" src="https://prod.pa.cdn.uis.awsstatic.com/panorama-nav-init.js" data-config="{'appEntity':'aws-documentation','region':'us-east-1','service':'cloudformation'}"></script><meta id="panorama-serviceSubSection" value="使用者指南" /><meta id="panorama-serviceConsolePage" value="堆疊失敗選項" /></head><body class="awsdocs awsui"><div class="awsdocs-container"><awsdocs-header></awsdocs-header><awsui-app-layout id="app-layout" class="awsui-util-no-gutters" ng-controller="ContentController as $ctrl" header-selector="awsdocs-header" navigation-hide="false" navigation-width="$ctrl.navWidth" navigation-open="$ctrl.navOpen" navigation-change="$ctrl.onNavChange($event)" tools-hide="$ctrl.hideTools" tools-width="$ctrl.toolsWidth" tools-open="$ctrl.toolsOpen" tools-change="$ctrl.onToolsChange($event)"><div id="guide-toc" dom-region="navigation"><awsdocs-toc></awsdocs-toc></div><div id="main-column" dom-region="content" tabindex="-1"><awsdocs-view class="awsdocs-view"><div id="awsdocs-content"><head><title>堆疊失敗選項 - AWS CloudFormation</title><meta name="rss" content="aws-cloudformation-release-notes.rss" /><meta name="forums" content="http://forums.aws.amazon.com/forum.jspa?forumID=92" /><meta name="feedback" content="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=CloudFormation&amp;topic_url=https://docs.aws.amazon.com/zh_tw/AWSCloudFormation/latest/UserGuide/stack-failure-options.html" /><meta name="feedback-yes" content="feedbackyes.html?topic_url=https://docs.aws.amazon.com/zh_tw/AWSCloudFormation/latest/UserGuide/stack-failure-options.html" /><meta name="feedback-no" content="feedbackno.html?topic_url=https://docs.aws.amazon.com/zh_tw/AWSCloudFormation/latest/UserGuide/stack-failure-options.html" /><meta name="keywords" content="CloudFormation,AWSCloudFormation,資源佈建,資源組態,基礎設施管理,CloudFormer,CloudFormation 堆疊,CloudFormation 堆疊集,CloudFormation 範本,變更集合" /><script type="application/ld+json">
{
    "@context" : "https://schema.org",
    "@type" : "BreadcrumbList",
    "itemListElement" : [
      {
        "@type" : "ListItem",
        "position" : 1,
        "name" : "AWS",
        "item" : "https://aws.amazon.com"
      },
      {
        "@type" : "ListItem",
        "position" : 2,
        "name" : "AWS CloudFormation",
        "item" : "https://docs.aws.amazon.com/cloudformation/index.html"
      },
      {
        "@type" : "ListItem",
        "position" : 3,
        "name" : "使用者指南",
        "item" : "https://docs.aws.amazon.com/zh_tw/AWSCloudFormation/latest/UserGuide"
      },
      {
        "@type" : "ListItem",
        "position" : 4,
        "name" : "使用堆疊",
        "item" : "https://docs.aws.amazon.com/zh_tw/AWSCloudFormation/latest/UserGuide/stacks.html"
      },
      {
        "@type" : "ListItem",
        "position" : 5,
        "name" : "堆疊失敗選項",
        "item" : "https://docs.aws.amazon.com/zh_tw/AWSCloudFormation/latest/UserGuide/stacks.html"
      }
    ]
}
</script></head><body><div id="main"><div style="display: none"></div><div id="breadcrumbs" class="breadcrumb"><a href="https://aws.amazon.com">AWS</a><a href="/index.html">文件</a><a href="/cloudformation/index.html">AWS CloudFormation</a><a href="Welcome.html">使用者指南</a></div><div id="page-toc-src"><a href="#stack-failure-options-overview">堆疊失敗選項概觀</a><a href="#stack-failure-options-conditions">暫停堆疊復原的條件</a><a href="#stack-failure-options-console">保留已成功佈建的資源 (主控台)</a><a href="#stack-failure-options-cli">保留已成功佈建的資源 (AWS CLI)</a></div><div id="main-content" class="awsui-util-container"><div id="main-col-body"><awsdocs-language-banner data-service="$ctrl.pageService"></awsdocs-language-banner><awsui-alert class="awsdocs-page-banner awsui-util-mb-l"><p>本文為英文版的機器翻譯版本，如內容有任何歧義或不一致之處，概以英文版為準。</p></awsui-alert><h1 class="topictitle" id="stack-failure-options">堆疊失敗選項</h1><div class="awsdocs-page-header-container"><awsdocs-page-header></awsdocs-page-header><awsdocs-filter-selector id="awsdocs-filter-selector"></awsdocs-filter-selector></div><p>在發生佈建失敗時，您可以從失敗點開始，而不復原成功佈建的資源，以反覆開發應用程式。透過指定堆疊失敗選項，您可以疑難排解處於 <code class="code">CREATE_FAILED</code> 或 <code class="code">UPDATE_FAILED</code> 狀態的資源。您可以為所有堆疊部署和變更集操作佈建失敗選項。</p><div class="itemizedlist">
   
   
  
 <ul class="itemizedlist"><li class="listitem">
   <p>建立操作集以 <b>Preserve successfully provisioned resources</b> (保留已成功佈建的資源)，可保留成功資源的狀態，而失敗的資源會保持失敗狀態，直到執行下一次更新操作為止。</p>
  </li><li class="listitem">
   <p>更新與變更操作集以 <b>Preserve successfully provisioned resources</b> (保留已成功佈建的資源)，可保留成功資源的狀態，同時將失敗的資源復原到上一個已知穩定狀態。失敗的資源將處於 <code class="code">UPDATE_FAILED</code> 狀態。沒有上一個已知穩定狀態的資源將在下一次堆疊操作時遭刪除。</p>
  </li></ul></div><p>如需有關暫停失敗資源復原的更多詳細資訊，請參閱下列章節：</p><div class="itemizedlist">
   
   
   
   
 <ul class="itemizedlist"><li class="listitem">
   <p><a href="#stack-failure-options-overview">堆疊失敗選項概觀</a></p>
  </li><li class="listitem">
   <p><a href="#stack-failure-options-conditions">暫停堆疊復原的條件</a></p>
  </li><li class="listitem">
   <p><a href="#stack-failure-options-console">保留已成功佈建的資源 (主控台)</a></p>
  </li><li class="listitem">
   <p><a href="#stack-failure-options-cli">保留已成功佈建的資源 (AWS CLI)</a></p>
  </li></ul></div>
  <h2 id="stack-failure-options-overview">堆疊失敗選項概觀</h2>
  <p>從 AWS CloudFormation 主控台、API 或 AWS Command Line Interface (AWS CLI) 發出操作之前，指定佈建資源失敗的行為。然後，繼續進行資源的部署過程，而無需進行任何其他修改。在操作失敗的情況下，CloudFormation 會在每個獨立佈建路徑中的第一次失敗時停止。CloudFormation 可識別資源之間的相依性，以平行化獨立佈建動作。然後，它會繼續在每個獨立佈建路徑上佈建資源，直到遇到失敗為止。一個路徑中的失敗不會影響其他佈建路徑。CloudFormation 將繼續佈建資源，直到完成或在遇到其他失敗時停止。</p>
  <p>修復任何問題以繼續部署程序。在早些時候無法成功佈建的資源上重試佈建動作之前，CloudFormation 會先執行必要的更新。您可以透過提交 <b>Retry</b> (重試)、<b>Update</b> (更新) 或 <b>Roll back</b> (復原) 操作來修復問題。例如，如果您要佈建 Amazon EC2 執行個體，且 EC2 執行個體在建立操作期間失敗，您可能需要調查錯誤，而不是立即復原失敗的資源。您可以檢閱系統狀態檢查和執行個體狀態檢查，一旦問題得到解決，選取 <b>Retry</b> (重試) 操作。</p>
  
  
  <p>當堆疊操作失敗，並且您已經從 <b>Stack failure options</b> (堆疊失敗選項) 選單指定 <b>Preserve successfully provisioned resources</b> (保留已成功佈建的資源) 時，您可以選取下列選項。</p>
  <div class="itemizedlist">
    
    
    
  <ul class="itemizedlist"><li class="listitem">
    <p><b>Retry</b> (重試) – 在失敗的資源上重試佈建操作，並繼續佈建範本，直到成功完成堆疊操作或下一次失敗為止。如果資源因不需要修改範本的問題而無法佈建，請選取此選項，例如 AWS Identity and Access Management (IAM) 許可。</p>
   </li><li class="listitem">
    <p><b>Update</b> (更新) – 已佈建的資源會在範本更新時更新。將重試建立或更新失敗的資源。如果資源因範本錯誤而無法佈建，且您已修改範本，請選取此選項。當您更新狀態為 <code class="code">FAILED</code> 的堆疊時，您必須針對 <b>Stack failure options</b> (堆疊失敗選項) 選取 <b>Preserve successfully provisioned resources</b> (保留已成功佈建的資源)，以繼續更新您的堆疊。</p>
   </li><li class="listitem">
    <p><b>Roll back</b> (復原) – CloudFormation 會將堆疊復原到上一個已知穩定狀態。</p>
   </li></ul></div>

 
  
  <h2 id="stack-failure-options-conditions">暫停堆疊復原的條件</h2>
  <p>若要暫停堆疊中失敗資源的復原，則必須符合下列條件。</p>
  <div class="itemizedlist">
    
    
  <ul class="itemizedlist"><li class="listitem">
    <p>在堆疊操作期間，您必須指定 <b>Preserve successfully provisioned resources</b> (保留已成功佈建的資源) 參數。如需有關復原行為的詳細資訊，請參閱<a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/cfn-console-add-tags.html#rollback">設定 AWS CloudFormation 堆疊選項</a>。</p>
   </li><li class="listitem">
    <p>堆疊操作的堆疊狀態必須為 <code class="code">CREATE_FAILED</code> 或 <code class="code">UPDATE_FAILED</code>。如需有關堆疊狀態的詳細資訊，請參閱<a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/using-cfn-describing-stacks.html#w2ab1c23c15c17c11">堆疊狀態碼</a>。</p>
   </li></ul></div>
  <div class="awsdocs-note"><div class="awsdocs-note-title"><awsui-icon name="status-info" variant="link"></awsui-icon><h6>注意</h6></div><div class="awsdocs-note-text"><p>不支援不可變更新類型。</p></div></div>
  
  <h2 id="stack-failure-options-console">保留已成功佈建的資源 (主控台)</h2>
  <awsdocs-tabs><dl style="display: none">
   <dt>Create stack</dt><dd tab-id="create-stack">
     <div class="procedure"><h6>在建立堆疊操作期間保留已成功佈建的資源</h6><ol><li><p>請登入 AWS Management Console，開啟位於 <a href="https://console.aws.amazon.com/cloudformation/" rel="noopener noreferrer" target="_blank"><span>https://console.aws.amazon.com/cloudformation</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a> 的 AWS CloudFormation 主控台。</p></li><li>
       <p>選擇 <b>Create stack</b> (建立堆疊)，然後選取 <b>With new resources (standard)</b> (使用新資源 (標準))。</p>
      </li><li>
       <p>在 <b>Specify template (指定範本)</b> 頁面上，使用下列其中一個選項選擇堆疊範本：</p>
       <div class="itemizedlist">
         
         
         
       <ul class="itemizedlist"><li class="listitem">
         <p><b>範本已就緒</b></p>
        </li><li class="listitem">
         <p><b>使用範例範本</b></p>
        </li><li class="listitem">
         <p><b>使用設計工具建立範本</b></p>
        </li></ul></div>
       <p>接受您的設定並選取 <b>Next</b> (下一步)。</p>
      </li><li>
       <p>在 <b>Specify stack details</b> (指定堆疊詳細資訊) 頁面上，在 <b>Stack name</b> (堆疊名稱) 方塊中輸入堆疊名稱。</p>
      </li><li>
       <p>在 <b>Parameters</b> (參數) 部分中，指定堆疊範本中定義的參數。</p>
       <p>您可以用預設值來使用或變更任何參數。</p>
      </li><li>
       <p>當您滿意參數值時，請選擇 <b>Next</b> (下一步)。</p>
      </li><li>
       <p>在 <b>Configure stack options</b> (設定堆疊選項) 頁面上，您可以設定堆疊的其他選項。</p>
      </li><li>
       <p>對於 <b>Stack failure options</b> (堆疊失敗選項)，請選取 <b>Preserve successfully provisioned resources</b> (保留已成功佈建的資源)。</p>
      </li><li>
       <p>當您滿意堆疊選項時，請選擇 <b>Next</b> (下一步)。</p>
      </li><li>
       <p>在 <b>Review</b> (檢閱) 頁面上檢閱您的堆疊並選取 <b>Create stack</b> (建立堆疊)。</p>
      </li></ol></div>
     <p><em>結果</em>：建立失敗的堆疊會將堆疊狀態轉換為 <code class="code">CREATE_FAILED</code>，以防止堆疊在堆疊操作遭遇失敗時復原。已成功佈建的資源處於 <code class="code">CREATE_COMPLETE</code> 狀態。您可以在 <b>Stack events</b> (堆疊事件) 索引標籤中監控堆疊。</p>
    </dd>
   <dt>Update stack</dt><dd tab-id="update-stack">
     <div class="procedure"><h6>在更新堆疊操作期間保留已成功佈建的資源</h6><ol><li><p>請登入 AWS Management Console，開啟位於 <a href="https://console.aws.amazon.com/cloudformation/" rel="noopener noreferrer" target="_blank"><span>https://console.aws.amazon.com/cloudformation</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a> 的 AWS CloudFormation 主控台。</p></li><li>
       <p>選取您希望更新的堆疊，然後選擇 <b>Update</b> (更新)。</p>
      </li><li>
       <p>在 <b>Update stack</b> (更新堆疊) 頁面上，使用下列其中一個選項選擇堆疊範本：</p>
       <div class="itemizedlist">
         
         
         
       <ul class="itemizedlist"><li class="listitem">
         <p><b>Use current template</b> (使用目前範本)</p>
        </li><li class="listitem">
         <p><b>Replace current template</b> (取代目前範本)</p>
        </li><li class="listitem">
         <p><b>Edit template in designer</b> (在設計工具中編輯範本)</p>
        </li></ul></div>
       <p>接受您的設定並選取 <b>Next</b> (下一步)。</p>
      </li><li>
       <p>在 <b>Specify stack details</b> (指定堆疊詳細資訊) 頁面上，指定堆疊範本中所定義的參數。</p>
       <p>您可以用預設值來使用或變更任何參數。</p>
      </li><li>
       <p>當您滿意參數值時，請選擇 <b>Next</b> (下一步)。</p>
      </li><li>
       <p>在 <b>Configure stack options</b> (設定堆疊選項) 頁面上，您可以設定堆疊的其他選項。</p>
      </li><li>
       <p>對於 <b>Behavior on provisioning failure</b> (佈建失敗時的行為)，選取 <b>Preserve successfully provisioned resources</b> (保留已成功佈建的資源)。</p>
      </li><li>
       <p>當您滿意堆疊選項時，請選擇 <b>Next</b> (下一步)。</p>
      </li><li>
       <p>在 <b>Review</b> (檢閱) 頁面上檢閱您的堆疊並選取 <b>Update stack</b> (更新堆疊)。</p>
      </li></ol></div>
     <p><em>結果</em>：更新失敗的堆疊會將狀態轉換為 <code class="code">UPDATE_FAILED</code>，並復原到上一個已知穩定狀態。沒有上一個已知穩定狀態的資源將在下一次堆疊操作時由 CloudFormation 刪除。已成功佈建的資源處於 <code class="code">CREATE_COMPLETE</code> 或 <code class="code">UPDATE_COMPLETE</code> 狀態。您可以在 <b>Stack events</b> (堆疊事件) 索引標籤中監控堆疊。</p>
    </dd>
   <dt>Change set</dt><dd tab-id="change-set">
     <div class="awsdocs-note"><div class="awsdocs-note-title"><awsui-icon name="status-info" variant="link"></awsui-icon><h6>注意</h6></div><div class="awsdocs-note-text"><p>您可以為狀態為 <code class="code">CREATE_FAILED</code> 或 <code class="code">UPDATE_FAILED</code> 的堆疊啟動變更集，但不適用於狀態 <code class="code">UPDATE_ROLLBACK_FAILED</code>。</p></div></div>
     <div class="procedure"><h6>在變更集操作期間保留已成功佈建的資源</h6><ol><li><p>請登入 AWS Management Console，開啟位於 <a href="https://console.aws.amazon.com/cloudformation/" rel="noopener noreferrer" target="_blank"><span>https://console.aws.amazon.com/cloudformation</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a> 的 AWS CloudFormation 主控台。</p></li><li>
       <p>選取包含您要啟動的變更集的堆疊，然後選擇 <b>Change sets</b> (變更集) 索引標籤。</p>
      </li><li>
       <p>選取變更集，然後選擇 <b>Execute</b> (執行)。</p>
      </li><li>
       <p>對於 <b>Execute change set</b> (執行變更集)，選取 <b>Preserve successfully provisioned resources</b> (保留已成功佈建的資源) 選項。</p>
      </li><li>
       <p>選取 <b>Execute change set</b> (執行變更集)。</p>
      </li></ol></div>
     <p><em>結果</em>：更新失敗的堆疊會將狀態轉換為 <code class="code">UPDATE_FAILED</code>，並復原到上一個已知穩定狀態。沒有上一個已知穩定狀態的資源將在下一次堆疊操作時由 CloudFormation 刪除。已成功佈建的資源處於 <code class="code">CREATE_COMPLETE</code> 或 <code class="code">UPDATE_COMPLETE</code> 狀態。您可以在 <b>Stack events</b> (堆疊事件) 索引標籤中監控堆疊。</p>
    </dd>
  </dl></awsdocs-tabs>
  
  <h2 id="stack-failure-options-cli">保留已成功佈建的資源 (AWS CLI)</h2>
  <awsdocs-tabs><dl style="display: none">
   <dt>Create stack</dt><dd tab-id="create-stack">
     <div class="procedure"><h6>在堆疊建立操作期間保留已成功佈建的資源</h6><p>指定 <a href="https://docs.aws.amazon.com/cli/latest/reference/cloudformation/create-stack.html">create-stack</a> 操作期間的 <code class="code">disable-rollback</code> 選項或 <code class="code">on-failure DO_NOTHING</code> 列舉。</p><ol><li>
       <p>使用 <code class="code">disable-rollback</code> 選項向 <code class="code">create-stack</code> 命令提供堆疊名稱和範本。</p>
       <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="複製"><awsui-icon name="copy"></awsui-icon></div></div><code class="sh ">aws cloudformation create-stack --stack-name <code class="code" copy="true">myteststack</code> --template-body <code class="replaceable">file://DOC-EXAMPLE-BUCKET.json</code> --disable-rollback</code></pre>
       <p>命令會傳回下列輸出：</p>
       <pre class="screen"><span>{</span>
    "StackId": "arn:aws:cloudformation:us-east-1:123456789012:stack/myteststack/466df9e0-0dff-08e3-8e2f-5088487c4896"
}</pre>
      </li><li>
       <p>使用 <code class="code">describe-stacks</code> 選項描述堆疊的狀態。</p>
       <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="複製"><awsui-icon name="copy"></awsui-icon></div></div><code class="sh ">aws cloudformation describe-stacks --stack-name <code class="replaceable">myteststack</code></code></pre>
       <p>命令會傳回下列輸出：</p>
       <pre class="screen"><span>{</span>
    "Stacks":  [
        <span>{</span>
            "StackId": "arn:aws:cloudformation:us-east-1:123456789012:stack/myteststack/466df9e0-0dff-08e3-8e2f-5088487c4896",
            "Description": "AWS CloudFormation Sample Template",
            "Tags": [],
            "Outputs": [],
            "StackStatusReason": “The following resource(s) failed to create: [MyBucket]”,
            "CreationTime": "2013-08-23T01:02:15.422Z",
            "Capabilities": [],
            "StackName": "myteststack",
            "StackStatus": "CREATE_FAILED",
            "DisableRollback": true
        }
    ]
}</pre>
      </li></ol></div>
    </dd>
   <dt>Update stack</dt><dd tab-id="update-stack">
     <div class="procedure"><h6>在更新堆疊操作期間保留已成功佈建的資源。</h6><ol><li>
       <p>使用 <code class="code">disable-rollback</code> 選項向 <code class="code">update-stack</code> 命令提供現有堆疊名稱和範本。</p>
       <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="複製"><awsui-icon name="copy"></awsui-icon></div></div><code class="sh ">aws cloudformation update-stack --stack-name <code class="replaceable">myteststack</code> --template-url <code class="replaceable">DOC-EXAMPLE-BUCKET.template</code> --disable-rollback</code></pre>
       <p>命令會傳回下列輸出：</p>
       <pre class="screen"><span>{</span>
    "StackId": "arn:aws:cloudformation:us-east-1:123456789012:stack/myteststack/466df9e0-0dff-08e3-8e2f-5088487c4896"
}</pre>
      </li><li>
       <p>使用 <code class="code">describe-stacks</code> 或 <code class="code">describe-stack-events</code> 選項描述堆疊的狀態。</p>
       <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="複製"><awsui-icon name="copy"></awsui-icon></div></div><code class="sh ">aws cloudformation describe-stacks --stack-name <code class="replaceable">myteststack</code></code></pre>
       <p>命令會傳回下列輸出：</p>
       <pre class="screen"><span>{</span>
    "Stacks":  [
        <span>{</span>
            "StackId": "arn:aws:cloudformation:us-east-1:123456789012:stack/myteststack/466df9e0-0dff-08e3-8e2f-5088487c4896",
            "Description": "AWS CloudFormation Sample Template",
            "Tags": [],
            "Outputs": [],
            "CreationTime": "2013-08-23T01:02:15.422Z",
            "Capabilities": [],
            "StackName": "myteststack",
            "StackStatus": "UPDATE_COMPLETE",
            "DisableRollback": true
        }
    ]
}</pre>
      </li></ol></div>
    </dd>
   <dt>Change set</dt><dd tab-id="change-set">
     <div class="awsdocs-note"><div class="awsdocs-note-title"><awsui-icon name="status-info" variant="link"></awsui-icon><h6>注意</h6></div><div class="awsdocs-note-text"><p>您可以為狀態為 <code class="code">CREATE_FAILED</code> 或 <code class="code">UPDATE_FAILED</code> 的堆疊啟動變更集，但不適用於狀態 <code class="code">UPDATE_ROLLBACK_FAILED</code>。</p></div></div>
     <div class="procedure"><h6>在變更集操作期間保留已成功佈建的資源</h6><p>指定 <a href="https://docs.aws.amazon.com/cli/latest/reference/cloudformation/execute-change-set.html">execute-change-set</a> 操作期間的 <code class="code">disable-rollback</code> 選項。</p><ol><li>
       <p>使用 <code class="code">disable-rollback</code> 選項向 <code class="code">execute-change-set</code> 命令提供堆疊名稱和範本。</p>
       <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="複製"><awsui-icon name="copy"></awsui-icon></div></div><code class="sh ">aws cloudformation execute-change-set --stack-name <code class="replaceable">myteststack</code> --change-set-name <code class="replaceable">my-change-set</code> --template-body file://template.yaml</code></pre>
       <p>命令會傳回下列輸出：</p>
       <pre class="screen"><span>{</span>
 "Id": "arn:aws:cloudformation:us-east-1:123456789012:changeSet/my-change-set/bc9555ba-a949-xmpl-bfb8-f41d04ec5784",
 "StackId": "arn:aws:cloudformation:us-east-1:123456789012:stack/myteststack/466df9e0-0dff-08e3-8e2f-5088487c4896"
}</pre>
      </li><li>
       <p>使用 <code class="code">disable-rollback</code> 選項啟動變更集。</p>
       <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="複製"><awsui-icon name="copy"></awsui-icon></div></div><code class="sh ">aws cloudformation execute-change-set --stack-name <code class="replaceable">myteststack</code> --change-set-name <code class="replaceable">my-change-set</code> -–disable-rollback</code></pre>
      </li><li>
       <p>使用 <code class="code">describe-stacks</code> 或 <code class="code">describe-stack-events</code> 選項判斷堆疊的狀態。</p>
       <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="複製"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
   "StackEvents": [
     <span>{</span>
        "StackId": "arn:aws:cloudformation:us-east-1:123456789012:stack/myteststack/466df9e0-0dff-08e3-8e2f-5088487c4896",
        "EventId": "49c966a0-7b74-11ea-8071-024244bb0672",
        "StackName": "myteststack",
        "LogicalResourceId": " MyBucket",
        "PhysicalResourceId": "MyBucket",
        "ResourceType": "AWS::S3::Bucket",
        "Timestamp": "2020-04-10T21:43:17.015Z",
        "ResourceStatus": "UPDATE_FAILED"
        "ResourceStatusReason": "User XYZ is not allowed to perform S3::UpdateBucket on MyBucket"
     }
}</code></pre>
      </li><li>
       <p>修正許可錯誤，然後重試操作。</p>
       <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="複製"><awsui-icon name="copy"></awsui-icon></div></div><code class="sh ">aws cloudformation update-stack --stack-name <code class="replaceable">myteststack</code> --use-previous-template --disable-rollback</code></pre>
       <p>命令會傳回下列輸出：</p>
       <pre class="screen"><span>{</span>
    "StackId": "arn:aws:cloudformation:us-east-1:123456789012:stack/myteststack/466df9e0-0dff-08e3-8e2f-5088487c4896"
}</pre>
      </li><li>
       <p>使用 <code class="code">describe-stacks</code> 或 <code class="code">describe-stack-events</code> 選項描述堆疊的狀態。</p>
       <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="複製"><awsui-icon name="copy"></awsui-icon></div></div><code class="sh ">aws cloudformation describe-stacks --stack-name <code class="replaceable">myteststack</code></code></pre>
       <p>命令會傳回下列輸出：</p>
       <pre class="screen"><span>{</span>
    "Stacks":  [
        <span>{</span>
            "StackId": "arn:aws:cloudformation:us-east-1:123456789012:stack/myteststack/466df9e0-0dff-08e3-8e2f-5088487c4896",
            "Description": "AWS CloudFormation Sample Template",
            "Tags": [],
            "Outputs": [],
            "CreationTime": "2013-08-23T01:02:15.422Z",
            "Capabilities": [],
            "StackName": "myteststack",
            "StackStatus": "UPDATE_COMPLETE",
            "DisableRollback": true
        }
    ]
}</pre>
      </li></ol></div>
    </dd>
  </dl></awsdocs-tabs>
  
   
   <h3 id="roll-back-stack-cli">復原堆疊</h3>
   
   <div class="procedure"><h6>將堆疊從 CREATE_FAILED 或 UPDATE_FAILED 堆疊狀態復原</h6><p>指定 <code class="code">rollback-stack</code> 操作，以將堆疊復原到上一個穩定狀態。</p><ul><li>
     <p>使用 <code class="code">rollback-stack</code> 操作啟動復原並指定堆疊名稱。</p>
     <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="複製"><awsui-icon name="copy"></awsui-icon></div></div><code class="sh ">aws cloudformation rollback-stack --stack-name <code class="replaceable">myteststack</code></code></pre>
     <p>命令會傳回下列輸出：</p>
     <pre class="screen"><span>{</span>
    "StackId": "arn:aws:cloudformation:us-east-1:123456789012:stack/myteststack/466df9e0-0dff-08e3-8e2f-5088487c4896"
}</pre>
    </li></ul></div>
   <div class="awsdocs-note"><div class="awsdocs-note-title"><awsui-icon name="status-info" variant="link"></awsui-icon><h6>注意</h6></div><div class="awsdocs-note-text"><p>如果堆疊不包含上一個已知穩定狀態，<code class="code">rollback-stack</code> 操作將刪除堆疊。</p></div></div>
   
  
 <awsdocs-copyright class="copyright-print"></awsdocs-copyright><awsdocs-thumb-feedback right-edge="{{$ctrl.thumbFeedbackRightEdge}}"></awsdocs-thumb-feedback></div><noscript><div><div><div><div id="js_error_message"><p><img src="https://d1ge0kk1l5kms0.cloudfront.net/images/G/01/webservices/console/warning.png" alt="警告" /> <strong>您的瀏覽器已停用或無法使用 Javascript。</strong></p><p>您必須啟用 Javascript，才能使用 AWS 文件。請參閱您的瀏覽器說明頁以取得說明。</p></div></div></div></div></noscript><div id="main-col-footer" class="awsui-util-font-size-0"><div id="doc-conventions"><a target="_top" href="/general/latest/gr/docconventions.html">文件慣用形式</a></div><div class="prev-next"><div id="previous" class="prev-link" accesskey="p" href="./stack-resource-configuration-complete.html">堆疊部署</div><div id="next" class="next-link" accesskey="n" href="./refactor-stacks.html">在堆疊之間移動資源</div></div></div><awsdocs-page-utilities></awsdocs-page-utilities></div><div id="quick-feedback-yes" style="display: none;"><div class="title">此頁面是否有幫助？ - 是</div><div class="content"><p>感謝您，讓我們知道我們做得很好！</p><p>若您有空，歡迎您告知我們值得讚許的地方，這樣才能保持良好服務。</p><p><awsui-button id="fblink" rel="noopener noreferrer" target="_blank" text="意見回饋" click="linkClick($event)" href="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=CloudFormation&amp;topic_url=https://docs.aws.amazon.com/zh_tw/AWSCloudFormation/latest/UserGuide/stack-failure-options.html"></awsui-button></p></div></div><div id="quick-feedback-no" style="display: none;"><div class="title">此頁面是否有幫助？ - 否</div><div class="content"><p>感謝讓我們知道此頁面仍須改善。很抱歉，讓您失望。</p><p>若您有空，歡迎您提供改善文件的方式。</p><p><awsui-button id="fblink" rel="noopener noreferrer" target="_blank" text="意見回饋" click="linkClick($event)" href="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=CloudFormation&amp;topic_url=https://docs.aws.amazon.com/zh_tw/AWSCloudFormation/latest/UserGuide/stack-failure-options.html"></awsui-button></p></div></div></div></body></div></awsdocs-view><div class="page-loading-indicator" id="page-loading-indicator"><awsui-spinner size="large"></awsui-spinner></div></div><div id="tools-panel" dom-region="tools"><awsdocs-tools-panel id="awsdocs-tools-panel"></awsdocs-tools-panel></div></awsui-app-layout><awsdocs-cookie-banner class="doc-cookie-banner"></awsdocs-cookie-banner></div></body></html>