<!DOCTYPE html>
    <html xmlns="http://www.w3.org/1999/xhtml" lang="zh-TW"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>避免更新堆疊資源 - AWS CloudFormation</title><meta name="viewport" content="width=device-width,initial-scale=1" /><meta name="assets_root" content="/assets" /><meta name="target_state" content="protect-stack-resources" /><meta name="default_state" content="protect-stack-resources" /><link rel="icon" type="image/ico" href="/assets/images/favicon.ico" /><link rel="shortcut icon" type="image/ico" href="/assets/images/favicon.ico" /><link rel="canonical" href="https://docs.aws.amazon.com/zh_tw/AWSCloudFormation/latest/UserGuide/protect-stack-resources.html" /><meta name="description" content="使 AWS CloudFormation 用堆疊原則，防止堆疊資源在堆疊更新期間意外更新或刪除。" /><meta name="deployment_region" content="IAD" /><meta name="product" content="AWS CloudFormation" /><meta name="guide" content="使用者指南" /><meta name="abstract" content="使 AWS CloudFormation 用本使用者指南可預測並重複地建立和管理 AWS 基礎架構部署。" /><meta name="guide-locale" content="zh_tw" /><meta name="tocs" content="toc-contents.json" /><link rel="canonical" href="https://docs.aws.amazon.com/zh_tw/AWSCloudFormation/latest/UserGuide/protect-stack-resources.html" /><link rel="alternative" href="https://docs.aws.amazon.com/id_id/AWSCloudFormation/latest/UserGuide/protect-stack-resources.html" hreflang="id-id" /><link rel="alternative" href="https://docs.aws.amazon.com/id_id/AWSCloudFormation/latest/UserGuide/protect-stack-resources.html" hreflang="id" /><link rel="alternative" href="https://docs.aws.amazon.com/de_de/AWSCloudFormation/latest/UserGuide/protect-stack-resources.html" hreflang="de-de" /><link rel="alternative" href="https://docs.aws.amazon.com/de_de/AWSCloudFormation/latest/UserGuide/protect-stack-resources.html" hreflang="de" /><link rel="alternative" href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/protect-stack-resources.html" hreflang="en-us" /><link rel="alternative" href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/protect-stack-resources.html" hreflang="en" /><link rel="alternative" href="https://docs.aws.amazon.com/es_es/AWSCloudFormation/latest/UserGuide/protect-stack-resources.html" hreflang="es-es" /><link rel="alternative" href="https://docs.aws.amazon.com/es_es/AWSCloudFormation/latest/UserGuide/protect-stack-resources.html" hreflang="es" /><link rel="alternative" href="https://docs.aws.amazon.com/fr_fr/AWSCloudFormation/latest/UserGuide/protect-stack-resources.html" hreflang="fr-fr" /><link rel="alternative" href="https://docs.aws.amazon.com/fr_fr/AWSCloudFormation/latest/UserGuide/protect-stack-resources.html" hreflang="fr" /><link rel="alternative" href="https://docs.aws.amazon.com/it_it/AWSCloudFormation/latest/UserGuide/protect-stack-resources.html" hreflang="it-it" /><link rel="alternative" href="https://docs.aws.amazon.com/it_it/AWSCloudFormation/latest/UserGuide/protect-stack-resources.html" hreflang="it" /><link rel="alternative" href="https://docs.aws.amazon.com/ja_jp/AWSCloudFormation/latest/UserGuide/protect-stack-resources.html" hreflang="ja-jp" /><link rel="alternative" href="https://docs.aws.amazon.com/ja_jp/AWSCloudFormation/latest/UserGuide/protect-stack-resources.html" hreflang="ja" /><link rel="alternative" href="https://docs.aws.amazon.com/ko_kr/AWSCloudFormation/latest/UserGuide/protect-stack-resources.html" hreflang="ko-kr" /><link rel="alternative" href="https://docs.aws.amazon.com/ko_kr/AWSCloudFormation/latest/UserGuide/protect-stack-resources.html" hreflang="ko" /><link rel="alternative" href="https://docs.aws.amazon.com/pt_br/AWSCloudFormation/latest/UserGuide/protect-stack-resources.html" hreflang="pt-br" /><link rel="alternative" href="https://docs.aws.amazon.com/pt_br/AWSCloudFormation/latest/UserGuide/protect-stack-resources.html" hreflang="pt" /><link rel="alternative" href="https://docs.aws.amazon.com/zh_cn/AWSCloudFormation/latest/UserGuide/protect-stack-resources.html" hreflang="zh-cn" /><link rel="alternative" href="https://docs.aws.amazon.com/zh_tw/AWSCloudFormation/latest/UserGuide/protect-stack-resources.html" hreflang="zh-tw" /><link rel="alternative" href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/protect-stack-resources.html" hreflang="x-default" /><meta name="feedback-item" content="CloudFormation" /><meta name="this_doc_product" content="AWS CloudFormation" /><meta name="this_doc_guide" content="使用者指南" /><script defer="" src="/assets/r/vendor4.js?version=2021.12.02"></script><script defer="" src="/assets/r/vendor3.js?version=2021.12.02"></script><script defer="" src="/assets/r/vendor1.js?version=2021.12.02"></script><script defer="" src="/assets/r/awsdocs-common.js?version=2021.12.02"></script><script defer="" src="/assets/r/awsdocs-doc-page.js?version=2021.12.02"></script><link href="/assets/r/vendor4.css?version=2021.12.02" rel="stylesheet" /><link href="/assets/r/awsdocs-common.css?version=2021.12.02" rel="stylesheet" /><link href="/assets/r/awsdocs-doc-page.css?version=2021.12.02" rel="stylesheet" /><script async="" id="awsc-panorama-bundle" type="text/javascript" src="https://prod.pa.cdn.uis.awsstatic.com/panorama-nav-init.js" data-config="{'appEntity':'aws-documentation','region':'us-east-1','service':'cloudformation'}"></script><meta id="panorama-serviceSubSection" value="使用者指南" /><meta id="panorama-serviceConsolePage" value="避免更新堆疊資源" /></head><body class="awsdocs awsui"><div class="awsdocs-container"><awsdocs-header></awsdocs-header><awsui-app-layout id="app-layout" class="awsui-util-no-gutters" ng-controller="ContentController as $ctrl" header-selector="awsdocs-header" navigation-hide="false" navigation-width="$ctrl.navWidth" navigation-open="$ctrl.navOpen" navigation-change="$ctrl.onNavChange($event)" tools-hide="$ctrl.hideTools" tools-width="$ctrl.toolsWidth" tools-open="$ctrl.toolsOpen" tools-change="$ctrl.onToolsChange($event)"><div id="guide-toc" dom-region="navigation"><awsdocs-toc></awsdocs-toc></div><div id="main-column" dom-region="content" tabindex="-1"><awsdocs-view class="awsdocs-view"><div id="awsdocs-content"><head><title>避免更新堆疊資源 - AWS CloudFormation</title><meta name="rss" content="aws-cloudformation-release-notes.rss" /><meta name="forums" content="http://forums.aws.amazon.com/forum.jspa?forumID=92" /><meta name="feedback" content="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=CloudFormation&amp;topic_url=https://docs.aws.amazon.com/zh_tw/AWSCloudFormation/latest/UserGuide/protect-stack-resources.html" /><meta name="feedback-yes" content="feedbackyes.html?topic_url=https://docs.aws.amazon.com/zh_tw/AWSCloudFormation/latest/UserGuide/protect-stack-resources.html" /><meta name="feedback-no" content="feedbackno.html?topic_url=https://docs.aws.amazon.com/zh_tw/AWSCloudFormation/latest/UserGuide/protect-stack-resources.html" /><meta name="keywords" content="CloudFormation,AWSCloudFormation,資源佈建,資源組態,基礎設施管理,CloudFormer,CloudFormation 堆疊,CloudFormation 堆疊集,CloudFormation 範本,變更集合" /><script type="application/ld+json">
{
    "@context" : "https://schema.org",
    "@type" : "BreadcrumbList",
    "itemListElement" : [
      {
        "@type" : "ListItem",
        "position" : 1,
        "name" : "AWS",
        "item" : "https://aws.amazon.com"
      },
      {
        "@type" : "ListItem",
        "position" : 2,
        "name" : "AWS CloudFormation",
        "item" : "https://docs.aws.amazon.com/cloudformation/index.html"
      },
      {
        "@type" : "ListItem",
        "position" : 3,
        "name" : "使用者指南",
        "item" : "https://docs.aws.amazon.com/zh_tw/AWSCloudFormation/latest/UserGuide"
      },
      {
        "@type" : "ListItem",
        "position" : 4,
        "name" : "使用堆疊",
        "item" : "https://docs.aws.amazon.com/zh_tw/AWSCloudFormation/latest/UserGuide/stacks.html"
      },
      {
        "@type" : "ListItem",
        "position" : 5,
        "name" : "AWS CloudFormation 堆疊更新",
        "item" : "https://docs.aws.amazon.com/zh_tw/AWSCloudFormation/latest/UserGuide/using-cfn-updating-stacks.html"
      },
      {
        "@type" : "ListItem",
        "position" : 6,
        "name" : "避免更新堆疊資源",
        "item" : "https://docs.aws.amazon.com/zh_tw/AWSCloudFormation/latest/UserGuide/using-cfn-updating-stacks.html"
      }
    ]
}
</script></head><body><div id="main"><div style="display: none"></div><div id="breadcrumbs" class="breadcrumb"><a href="https://aws.amazon.com">AWS</a><a href="/index.html">文件</a><a href="/cloudformation/index.html">AWS CloudFormation</a><a href="Welcome.html">使用者指南</a></div><div id="page-toc-src"><a href="#stack-policy-intro-example">範例堆疊政策</a><a href="#stack-policy-reference">定義堆疊政策</a><a href="#protect-stack-resources-protecting">設定堆疊政策</a><a href="#protect-stack-resources-updating">更新受保護的資源</a><a href="#protect-stack-resources-modifying">修改堆疊政策 </a><a href="#stack-policy-samples">更多範例堆疊政策</a></div><div id="main-content" class="awsui-util-container"><div id="main-col-body"><awsdocs-language-banner data-service="$ctrl.pageService"></awsdocs-language-banner><awsui-alert class="awsdocs-page-banner awsui-util-mb-l"><p>本文為英文版的機器翻譯版本，如內容有任何歧義或不一致之處，概以英文版為準。</p></awsui-alert><h1 class="topictitle" id="protect-stack-resources">避免更新堆疊資源</h1><div class="awsdocs-page-header-container"><awsdocs-page-header></awsdocs-page-header><awsdocs-filter-selector id="awsdocs-filter-selector"></awsdocs-filter-selector></div><p>當您建立堆疊時，可以對所有的資源執行所有更新動作。根據預設，有堆疊更新許可的任何人都可以更新堆疊中的所有資源。在更新期間，有些資源可能需要中斷或是完全替換，以致產生新的實體 ID 或全新的儲存體。您可避免在使用堆疊政策更新堆疊期間，無意中更新或刪除<a href="./aws-template-resource-type-ref.html">堆疊資源</a>。堆疊政策是一種 JSON 文件，定義可在指定資源上執行的更新動作。</p><p>在您設定堆疊政策之後，堆疊中的所有資源預設都會受到保護。若要允許特定資源的更新，您可以為您堆疊政策中的這些資源指定明確的 <code class="code">Allow</code> 陳述式。您每個堆疊只能定義一個堆疊政策，但可以保護單一政策內的多個資源。堆疊原則適 AWS CloudFormation 用於所有嘗試更新堆疊的使用者。您無法建立不同堆疊政策與不同使用者的關聯。</p><p>堆疊政策僅適用於堆疊更新期間。它不提供像 AWS Identity and Access Management (IAM) 政策這樣的存取控制。堆疊政策僅作為容錯移轉的安全機制，以避免意外更新特定的堆疊資源。若要控制對資 AWS 源或動作的存取，請使用 IAM。</p><div class="highlights" id="inline-topiclist"><h6>主題</h6><ul><li><a href="#stack-policy-intro-example">範例堆疊政策</a></li><li><a href="#stack-policy-reference">定義堆疊政策</a></li><li><a href="#protect-stack-resources-protecting">設定堆疊政策</a></li><li><a href="#protect-stack-resources-updating">更新受保護的資源</a></li><li><a href="#protect-stack-resources-modifying">修改堆疊政策 </a></li><li><a href="#stack-policy-samples">更多範例堆疊政策</a></li></ul></div>
   <h2 id="stack-policy-intro-example">範例堆疊政策</h2>
    <p>下列範例堆疊政策會避免更新 <code class="code">ProductionDatabase</code> 資源：</p><pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="複製"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
  "Statement" : [
    <span>{</span>
      "Effect" : "Allow",
      "Action" : "Update:*",
      "Principal": "*",
      "Resource" : "*"
    },
    <span>{</span>
      "Effect" : "Deny",
      "Action" : "Update:*",
      "Principal": "*",
      "Resource" : "LogicalResourceId/ProductionDatabase"
    }
  ]
}</code></pre>
    <p>在您設定堆疊政策時，所有資源預設都會受到保護。為允許更新所有資源，我們新增在所有資源上允許所有動作的 <code class="code">Allow</code> 陳述式。雖然 <code class="code">Allow</code> 陳述式指定所有的資源，但明確的 <code class="code">Deny</code> 陳述式會針對邏輯 ID 為 <code class="code">ProductionDatabase</code> 的資源覆寫它。此 <code class="code">Deny</code> 陳述式會避免 <code class="code">ProductionDatabase</code> 資源上所有的更新動作，例如替換或刪除。</p>
    <p><code class="code">Principal</code> 元素是必要的，但只支援萬用字元 (<code class="code">*</code>)，這表示此陳述式適用於所有<a href="https://docs.aws.amazon.com/glossary/latest/reference/glos-chap.html#principal">主體</a>。</p>
    <div class="awsdocs-note"><div class="awsdocs-note-title"><awsui-icon name="status-info" variant="link"></awsui-icon><h6>注意</h6></div><div class="awsdocs-note-text"><p>在堆疊更新期間， AWS CloudFormation 會自動更新依賴於其他更新資源的資源。例如，更 AWS CloudFormation 新參照已更新資源的資源。 AWS CloudFormation 不會對自動更新資源進行實體變更 (例如資源的 ID)，但如果堆疊政策與這些資源相關聯，您必須擁有更新資源的權限。</p></div></div>
   
   <h2 id="stack-policy-reference">定義堆疊政策</h2>
    <p>當您建立堆疊時，未設定任何堆疊政策，所以可對所有的資源執行所有更新動作。為了保護堆疊資源不受更新動作影響，請定義堆疊政策，然後在您的堆疊上設定它。堆疊原則是 JSON 文件，定義 AWS CloudFormation 使用者可以執行的 AWS CloudFormation 堆疊更新動作以及動作套用的資源。您在建立堆疊時，透過指定包含您堆疊政策的文字檔案或將它輸出的方式，設定堆疊政策。當您在堆疊上設定堆疊政策時，預設拒絕任何未明確允許的更新。</p>
    <p>您可以使用五種元素定義堆疊政策：<code class="code">Effect</code>、<code class="code">Action</code>、<code class="code">Principal</code>、<code class="code">Resource</code> 和 <code class="code">Condition</code>。下列虛擬程式碼顯示堆疊政策的語法。</p><pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="複製"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
  "Statement" : [
    <span>{</span>
      "Effect" : "<code class="replaceable">Deny_or_Allow</code>",
      "Action" : "<code class="replaceable">update_actions</code>",
      "Principal" : "*",
      "Resource" : "LogicalResourceId/<code class="replaceable">resource_logical_ID</code>",
      "Condition" : <span>{</span>
        "<code class="replaceable">StringEquals_or_StringLike</code>" : <span>{</span>
          "ResourceType" : [<code class="replaceable">resource_type, ...</code>]
        }
      }
    }
  ]
}</code></pre>
    <div class="variablelist">
       
       
       
       
       
    <dl>
        <dt><span class="term"><code class="code">Effect</code></span></dt>
        <dd>
          <p>決定在您指定的資源上拒絕或允許您指定的動作。您只能指定 <code class="code">Deny</code> 或 <code class="code">Allow</code>，例如：</p>
         <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="複製"><awsui-icon name="copy"></awsui-icon></div></div><code class="json ">"Effect" : "Deny"</code></pre>
          <div class="awsdocs-note awsdocs-important"><div class="awsdocs-note-title"><awsui-icon name="status-warning" variant="error"></awsui-icon><h6>重要</h6></div><div class="awsdocs-note-text"><p>如果堆疊政策包含重疊的陳述式 (允許和拒絕對資源的更新)，則 <code class="code">Deny</code> 陳述式一律會覆寫 <code class="code">Allow</code> 陳述式。為了確保資源受到保護，請為該資源使用 <code class="code">Deny</code> 陳述式。</p></div></div>
        </dd>
       
        <dt><span class="term">動作</span></dt>
        <dd>
          <p>指定拒絕或允許的更新動作：</p><div class="variablelist">
               
               
               
               
            <dl>
                <dt><span class="term">Update:Modify</span></dt>
                <dd>
                  <p>指定在其執行期間，資源可能不會中斷，或套用變更時有些中斷的更新動作。所有資源都保持它們的實體 ID。</p>
                </dd>
               
                <dt><span class="term">Update:Replace</span></dt>
                <dd>
                  <p>指定在其中重新建立資源的更新動作。 AWS CloudFormation 創建具有指定更新的新資源，然後刪除舊資源。由於資源是重新建立的，所以新資源的實體 ID 可能不同。</p>
                </dd>
               
                <dt><span class="term">Update:Delete</span></dt>
                <dd>
                  <p>指定在其執行期間，會移除資源的更新動作。從堆疊範本完全移除資源的更新，需要此動作。</p>
                </dd>
               
                <dt><span class="term">更新:*</span></dt>
                <dd>
                  <p>指定所有更新動作。星號是萬用字元，代表所有更新動作。</p>
                </dd>
              </dl></div>
          <p>下列範例說明如何只指定取代和刪除動作：</p>
          <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="複製"><awsui-icon name="copy"></awsui-icon></div></div><code class="json ">"Action" : ["Update:Replace", "Update:Delete"]</code></pre>
          <p>若要允許某個除外的所有更新動作，請使用 <code class="code">NotAction</code>。例如，若要允許 <code class="code">Update:Delete</code> 除外的所有更新動作，請使用 <code class="code">NotAction</code>，如這個範例所示：</p><pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="複製"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
  "Statement" : [
    <span>{</span>
      "Effect" : "Allow",
      "NotAction" : "Update:Delete",
      "Principal": "*",
      "Resource" : "*"
    }
  ]
}</code></pre>
          <p>如需堆疊更新的詳細資訊，請參閱<a href="./using-cfn-updating-stacks.html">AWS CloudFormation 堆疊更新</a>。</p>
        </dd>
       
        <dt><span class="term">Principal</span></dt>
        <dd>
          <p><code class="code">Principal</code> 元素指定套用政策的實體。此元素是必要的，但只支援萬用字元 (<code class="code">*</code>)，這表示政策適用於所有<a href="https://docs.aws.amazon.com/glossary/latest/reference/glos-chap.html#principal">主體</a>。</p>
        </dd>
       
        <dt><span class="term">資源</span></dt>
        <dd>
          <p>指定套用政策的資源邏輯 ID。若要指定<a href="./aws-template-resource-type-ref.html">資源類型</a>，請使用 <code class="code">Condition</code> 元素。</p>
          <p>若要指定單一資源，請使用它的邏輯 ID。例如：</p>
         <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="複製"><awsui-icon name="copy"></awsui-icon></div></div><code class="json ">"Resource" : ["LogicalResourceId/myEC2instance"]</code></pre>
          <p>邏輯 ID 可以使用萬用字元。例如，如果所有相關資源都使用常見的邏輯 ID 字首，您可以用萬用字元指定它們全部：</p>
         <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="複製"><awsui-icon name="copy"></awsui-icon></div></div><code class="json ">"Resource" : ["LogicalResourceId/CriticalResource*"]</code></pre>
          <p>資源也可以使用 <code class="code">Not</code> 元素。例如，若要允許某個以外的所有資源更新，請使用 <code class="code">NotResource</code> 元素來保護該資源：</p><pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="複製"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
  "Statement" : [
    <span>{</span>
      "Effect" : "Allow",
      "Action" : "Update:*",
      "Principal": "*",
      "NotResource" : "LogicalResourceId/ProductionDatabase"
    }
  ]
}</code></pre>
          <p>當您設定堆疊政策時，預設拒絕任何未明確允許的更新。透過允許 <code class="code">ProductionDatabase</code> 資源以外的所有資源更新，您拒絕更新 <code class="code">ProductionDatabase</code> 資源。</p>
        </dd>
       
        <dt><span class="term">條件</span></dt>
        <dd>
          <p>指定套用政策的<a href="./aws-template-resource-type-ref.html">資源類型</a>。若要指定特定資源的邏輯 ID，請使用 <code class="code">Resource</code> 元素。</p>
          <p>您可以指定資源類型，例如所有 EC2 和 RDS 資料庫執行個體，如下列範例所示：</p><pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="複製"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
  "Statement" : [
  <span>{</span>
    "Effect" : "Deny",
    "Principal" : "*",
    "Action" : "Update:*",
    "Resource" : "*",
    "Condition" : <span>{</span>
      "StringEquals" : <span>{</span>
        "ResourceType" : ["AWS::EC2::Instance", "AWS::RDS::DBInstance"]
      }
    }
  },
  <span>{</span>
    "Effect" : "Allow",
    "Principal" : "*",
    "Action" : "Update:*",
    "Resource" : "*"
  }
  ]
}</code></pre>
          <p><code class="code">Allow</code> 陳述式將更新許可授予所有資源，而 <code class="code">Deny</code> 陳述式拒絕更新 EC2 和 RDS 資料庫執行個體。<code class="code">Deny</code> 陳述式一律會覆寫允許動作。</p>
          <p>資源類型可以使用萬用字元。例如，您可以使用萬用字元拒絕所有 Amazon EC2 資源的更新許可 —例如執行個體、安全群組和子網路— 如下列範例所示：</p>
         <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="複製"><awsui-icon name="copy"></awsui-icon></div></div><code class="json ">"Condition" : <span>{</span>
  "StringLike" : <span>{</span>
    "ResourceType" : ["AWS::EC2::*"]
  }
}</code></pre>
          <p>使用萬用字元時，您必須使用 <code class="code">StringLike</code> 條件。</p>
        </dd>
      </dl></div>
   
   <h2 id="protect-stack-resources-protecting">設定堆疊政策</h2>
    <p>您可以使用主控台或 AWS CLI 在建立堆疊時套用堆疊原則。您也可以使用 AWS CLI 將堆疊原則套用至現有堆疊。套用堆疊原則之後，您無法將其從堆疊中移除，但您可以使用 AWS CLI 來修改它。</p>
    <p>堆疊原則適 AWS CloudFormation 用於嘗試更新堆疊的所有使用者。您無法建立不同堆疊政策與不同使用者的關聯。</p>
    <p>如需撰寫堆疊政策的資訊，請參閱<a href="#stack-policy-reference">定義堆疊政策</a>。</p>
    <div class="procedure"><h6>在建立堆疊時設定堆疊政策 (主控台)</h6><ol><li><p><a href="https://console.aws.amazon.com/cloudformation/" rel="noopener noreferrer" target="_blank"><span>請在以下位置開啟 AWS CloudFormation 主控台。</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a> https://console.aws.amazon.com/cloudformation</p></li><li>
        <p>在「<b>CloudFormation 堆疊</b>」頁面上，選擇「<b>建立堆疊</b>」。</p>
      </li><li>
        <p>在 Create Stack (建立堆疊) 精靈的 <b>Configure stack options (設定堆疊選項)</b> 頁面上，展開 <b>Advanced (進階)</b> 區段，然後選擇 <b>Stack policy (堆疊政策)</b>。</p>
      </li><li>
        <p>指定堆疊政策：</p>
        <div class="itemizedlist">
           
           
        <ul class="itemizedlist"><li class="listitem"><p>若要直接在主控台中編寫政策，請選擇 <b>Enter stack policy (輸入堆疊政策)</b>，然後直接在文字欄位中輸入堆疊政策。</p></li><li class="listitem"><p>若要使用其他檔案定義的政策，請選擇 <b>Upload a file (上傳檔案)</b>，然後選擇 <b>Choose file (選擇檔案)</b>，選取包含堆疊政策的檔案。</p></li></ul></div>
      </li></ol></div>
    <div class="procedure"><h6>在建立堆疊時設定堆疊政策 (AWS CLI)</h6><ul><li>
        <p>使用 <code class="code"><a href="https://docs.aws.amazon.com/cli/latest/reference/cloudformation/create-stack.html">aws cloudformation create-stack</a></code> 命令搭配 <code class="code">--stack-policy-body</code> 選項輸入修改的政策，或搭配 <code class="code">--stack-policy-url</code> 選項指定包含政策的檔案。</p>
      </li></ul></div>
    <div class="procedure"><h6>若要在現有堆疊上設定堆疊原則 (AWS CLI 僅限)</h6><ul><li>
        <p>使用 <code class="code"><a href="https://docs.aws.amazon.com/cli/latest/reference/cloudformation/set-stack-policy.html">aws cloudformation set-stack-policy</a></code> 命令搭配 <code class="code">--stack-policy-body</code> 選項輸入修改的政策，或搭配 <code class="code">--stack-policy-url</code> 選項指定包含政策的檔案。</p>
        <div class="awsdocs-note"><div class="awsdocs-note-title"><awsui-icon name="status-info" variant="link"></awsui-icon><h6>注意</h6></div><div class="awsdocs-note-text"><p>若要將原則新增至現有堆疊，您必須具有 AWS CloudFormation <code class="code"><a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/APIReference/API_SetStackPolicy.html">SetStackPolicy</a></code>動作的權限。</p></div></div>
      </li></ul></div>
   
   <h2 id="protect-stack-resources-updating">更新受保護的資源</h2>
    <p>若要更新受保護的資源，請建立覆寫堆疊政策的暫時政策，並允許更新這些資源。在更新堆疊時您指定覆寫政策。覆寫的政策不會永久變更堆疊政策。</p>
    <p>若要更新受保護的資源，您必須具有使用 AWS CloudFormation
<code class="code"><a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/APIReference/API_SetStackPolicy.html">SetStackPolicy</a></code>動作的權限。如需有關設定 AWS CloudFormation 權限的資訊，請參閱<a href="./using-iam-template.html">控制存取 AWS Identity and Access Management</a>。</p>
    <div class="awsdocs-note"><div class="awsdocs-note-title"><awsui-icon name="status-info" variant="link"></awsui-icon><h6>注意</h6></div><div class="awsdocs-note-text"><p>在堆疊更新期間， AWS CloudFormation 會自動更新依賴於其他更新資源的資源。例如，更 AWS CloudFormation 新參照已更新資源的資源。 AWS CloudFormation 不會對自動更新的資源進行實體變更 (例如資源的 ID)，但如果堆疊政策與這些資源相關聯，您必須擁有更新資源的權限。</p></div></div>
    <div class="procedure"><h6>更新受保護的資源 (主控台)</h6><ol><li><p><a href="https://console.aws.amazon.com/cloudformation/" rel="noopener noreferrer" target="_blank"><span>請在以下位置開啟 AWS CloudFormation 主控台。</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a> https://console.aws.amazon.com/cloudformation</p></li><li>
        <p>選取您希望更新的堆疊，選擇 <b>Stack actions (堆疊動作)</b>，然後選擇 <b>Update stack (更新堆疊)</b>。</p>
      </li><li>
        <p>如「尚未」<em></em>修改堆疊範本，請選取 <b>Use current template (使用目前的範本)</b>，然後按一下 <b>Next (下一步)</b>。如已修改範本，請選取 <b>Replace current template (取代目前的範本)</b>，然後在 <b>Specify template (指定範本)</b> 區段中指定更新的範本位置：</p>
        <div class="itemizedlist">
           
           
        <ul class="itemizedlist"><li class="listitem">
            <p>如果是存放在本機電腦上的範本，請選取 <b>Upload a template file (上傳範本檔案)</b>。選擇 <b>Choose File</b> (選擇檔案) 以瀏覽至該檔案，然後按一下 <b>Next</b> (下一步)。</p>
          </li><li class="listitem">
            <p>如需存放在 Amazon S3 儲存貯體的範本，請選取 <b>Amazon S3 URL</b>。輸入或貼上範本的 URL，然後按一下 <b>Next</b> (下一步)。</p>
            <p>如果您的範本位於已啟用版本控制的儲存貯體中，則您可以指定範本的特定版本，例如 <code class="code">https://s3.amazonaws.com/templates/myTemplate.template?versionId=123ab1cdeKdOW5IH4GAcYbEngcpTJTDW</code>。如需詳細資訊，請參閱《Amazon Simple Storage Service 使用者指南》中的<a href="https://docs.aws.amazon.com/AmazonS3/latest/user-guide/managing-objects-versioned-bucket.html">管理已啟用版本控制之儲存貯體中的物件</a>。</p>
          </li></ul></div>
      </li><li>
        <p>如果您的範本包含參數，請在 <b>Specify stack details (指定堆疊詳細資訊)</b> 頁面上輸入或修改參數值，然後選擇 <b>Next (下一步)</b>。</p>
        <p>AWS CloudFormation 將目前在堆疊中設定的值填入每個參數，但使用<code class="code">NoEcho</code>屬性宣告的參數除外。您可以選擇 <b>Use existing value (使用現有的值)</b>，為這些參數使用目前的值。</p>
        <p>如需使用 <code class="code">NoEcho</code> 遮罩敏感資訊，以及使用動態參數管理密碼的詳細資訊，請參閱<a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/best-practices.html#creds">請勿在您的範本中內嵌憑證</a>最佳實務。</p>
      </li><li>
        <p>指定覆寫堆疊政策。</p>
        <ol><li><p>在 <b>Configure stack options (設定堆疊選項)</b> 頁面的 <b>Advanced options (進階選項)</b> 區段中，選取 <b>Stack policy (堆疊政策)</b>。</p></li><li><p>選取 <b>Upload a file (上傳檔案)</b>。</p></li><li><p>按一下 <b>Choose file (選擇檔案)</b>，導覽至包含覆寫堆疊政策的檔案，或輸入政策。</p></li><li><p>選擇<b>下一步</b>。</p></li></ol>
        
        <p>覆寫政策必須為您要更新的受保護資源指定 <code class="code">Allow</code> 陳述式。例如，若要更新所有受保護的資源，請指定允許所有更新的暫時覆寫政策：</p><pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="複製"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
  "Statement" : [
    <span>{</span>
      "Effect" : "Allow",
      "Action" : "Update:*",
      "Principal": "*",
      "Resource" : "*"
    }
  ]
}</code></pre>
        <div class="awsdocs-note"><div class="awsdocs-note-title"><awsui-icon name="status-info" variant="link"></awsui-icon><h6>注意</h6></div><div class="awsdocs-note-text"><p>AWS CloudFormation 僅在此更新期間套用覆寫原則。覆寫的政策不會永久變更堆疊政策。若要修改堆疊政策，請參閱<a href="#protect-stack-resources-modifying">修改堆疊政策 </a>。</p></div></div>
      </li><li>
        <p>檢閱堆疊資訊和您提交的變更。</p>
        <p>檢查是否提交了正確的資訊，例如正確的參數值或範本 URL。如果您的範本包含 IAM 資源，請選擇 <b>I acknowledge that this template may create IAM resources (我知道此範本可能會建立 IAM 資源)</b> 以指定您要使用此範本中的 IAM 資源。如需有關使用範本中 IAM 資源的詳細資訊，請參閱<a href="./using-iam-template.html">控制存取 AWS Identity and Access Management</a>。</p>
        <p>在 [<b>預覽您的變更</b>] 區段中，勾選是否 AWS CloudFormation 會進行您預期的所有變更。例如，檢查是否新 AWS CloudFormation 增、移除和修改您要新增、移除或修改的資源。 AWS CloudFormation 透過為堆疊建立變更集來產生此預覽。如需詳細資訊，請參閱 <a href="./using-cfn-updating-stacks-changesets.html">透過變更集更新堆疊</a>。</p>
      </li><li>
        <p>當您完成變更後，請按一下 <b>Update (更新)</b>。</p>
        <div class="awsdocs-note"><div class="awsdocs-note-title"><awsui-icon name="status-info" variant="link"></awsui-icon><h6>注意</h6></div><div class="awsdocs-note-text"><p>此時，您也可以選擇檢視變更集，更仔細地檢閱您提出的更新。若要這麼做，請按一下 [<b>檢視變更集</b>] 而不是 [<b>更新</b>]。  CloudFormation 顯示根據您的更新產生的變更集。當您準備好執行堆疊更新時，請按一下 <b>Execute (執行)</b>。</p></div></div>
        <p>CloudFormation 顯示堆疊的「<b>堆疊詳細資料</b>」頁面。您的堆疊狀態現為 <b>UPDATE_IN_PROGRESS (正在更新)</b>。成功完 CloudFormation 成堆疊更新之後，它會將堆疊狀態設定為「<b>更新 _</b> 完成」。</p>
        <p>如果堆疊更新失敗， CloudFormation則會自動復原變更，並將堆疊狀態設定為 <b>UPDATE_ROLLBACK_CO</b> MPLETE。</p>
      </li></ol></div>
    <div class="procedure"><h6>更新受保護的資源 (AWS CLI)</h6><ul><li>
        <p>使用 <code class="code"><a href="https://docs.aws.amazon.com/cli/latest/reference/cloudformation/update-stack.html">aws cloudformation update-stack</a></code> 命令搭配 <code class="code">--stack-policy-during-update-body</code> 選項輸入修改的政策，或搭配 <code class="code">--stack-policy-during-update-url</code> 選項指定包含政策的檔案。</p>
        <div class="awsdocs-note"><div class="awsdocs-note-title"><awsui-icon name="status-info" variant="link"></awsui-icon><h6>注意</h6></div><div class="awsdocs-note-text"><p>AWS CloudFormation 僅在此更新期間套用覆寫原則。覆寫的政策不會永久變更堆疊政策。若要修改堆疊政策，請參閱<a href="#protect-stack-resources-modifying">修改堆疊政策 </a>。</p></div></div>
      </li></ul></div>
   
   <h2 id="protect-stack-resources-modifying">修改堆疊政策 </h2>
    <p>若要保護其他資源或移除對資源的保護，請修改堆疊政策。例如，當您將想要保護的資料庫新增到您的堆疊時，請為該資料庫將 <code class="code">Deny</code> 陳述式新增到堆疊政策。若要修改政策，您必須有使用 <code class="code"><a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/APIReference/API_SetStackPolicy.html">SetStackPolicy</a></code> 動作的許可。</p>
    <p>使用修 AWS CLI 改堆疊原則。</p>
    <div class="procedure"><h6>修改堆疊政策 (AWS CLI)</h6><ul><li>
        <p>使用 <code class="code"><a href="https://docs.aws.amazon.com/cli/latest/reference/cloudformation/set-stack-policy.html">aws cloudformation set-stack-policy</a></code> 命令搭配 <code class="code">--stack-policy-body</code> 選項輸入修改的政策，或搭配 <code class="code">--stack-policy-url</code> 選項指定包含政策的檔案。</p>
      </li></ul></div>
    <p>您無法刪除堆疊政策。若要移除所有資源的所有保護，您要修改政策，明確允許對所有資源的所有動作。下列政策允許所有資源的所有更新：</p><pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="複製"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
  "Statement" : [
    <span>{</span>
      "Effect" : "Allow",
      "Action" : "Update:*",
      "Principal": "*",
      "Resource" : "*"
    }
  ]
}</code></pre>
   
   <h2 id="stack-policy-samples">更多範例堆疊政策</h2>
    <p>下列範例政策示範如何防止更新所有堆疊資源和特定資源，並防止特定類型的更新。</p>
     
     <h3 id="w9aac25c17c29c21b5">避免更新所有堆疊資源</h3>
      <p>為了防止更新所有堆疊資源，下列政策為所有資源的所有更新動作指定 <code class="code">Deny</code> 陳述式。</p>
      <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="複製"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
  "Statement" : [
    <span>{</span>
      "Effect" : "Deny",
      "Action" : "Update:*",
      "Principal": "*",
      "Resource" : "*"
    }
  ]
}</code></pre>
     
     
     <h3 id="w9aac25c17c29c21b7">避免更新單一資源</h3>
      <p>下列政策拒絕邏輯 ID 為 <code class="code">MyDatabase</code> 之資料庫的所有更新動作。<code class="code">Allow</code> 陳述式允許所有其他堆疊資源的所有更新動作。<code class="code">Allow</code> 陳述式不適用於 <code class="code">MyDatabase</code> 資源，因為 <code class="code">Deny</code> 陳述式一律會覆寫允許動作。</p>
      <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="複製"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
  "Statement" : [
    <span>{</span>
      "Effect" : "Deny",
      "Action" : "Update:*",
      "Principal": "*",
      "Resource" : "LogicalResourceId/MyDatabase"
    },
    <span>{</span>
      "Effect" : "Allow",
      "Action" : "Update:*",
      "Principal": "*",
      "Resource" : "*"
    }
  ]
}</code></pre>
      <p>使用預設拒絕可以達到和前例相同的結果。當您設定堆疊原則時，會 AWS CloudFormation 拒絕任何未明確允許的更新。下列政策允許更新所有資源，預設拒絕的 <code class="code">ProductionDatabase</code> 資源除外。</p>
      <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="複製"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
  "Statement" : [
    <span>{</span>
      "Effect" : "Allow",
      "Action" : "Update:*",
      "Principal": "*",
      "NotResource" : "LogicalResourceId/ProductionDatabase"
    }
  ]
}</code></pre>
      <div class="awsdocs-note awsdocs-important"><div class="awsdocs-note-title"><awsui-icon name="status-warning" variant="error"></awsui-icon><h6>重要</h6></div><div class="awsdocs-note-text"><p>使用預設拒絕有風險。如果政策的其他位置有一個 <code class="code">Allow</code> 陳述式 (例如使用萬用字元的 <code class="code">Allow</code> 陳述式)，您可能會在不知情的狀況下將更新許可授予您不打算更新的資源。由於明確拒絕會覆寫任何允許動作，所以您可以使用 <code class="code">Deny</code> 陳述式確保資源受到保護。</p></div></div>
     
     
     <h3 id="w9aac25c17c29c21b9">避免更新某種資源類型的所有執行個體</h3>
      <p>下列政策拒絕 RDS 資料庫執行個體資源類型的所有更新動作。<code class="code">Allow</code> 陳述式允許所有其他堆疊資源的所有更新動作。<code class="code">Allow</code> 陳述式不適用於 RDS 資料庫執行個體資源，因為 <code class="code">Deny</code> 陳述式一律會覆寫允許動作。</p>
      <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="複製"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
  "Statement" : [
    <span>{</span>
      "Effect" : "Deny",
      "Action" : "Update:*",
      "Principal": "*",
      "Resource" : "*",
      "Condition" : <span>{</span>
        "StringEquals" : <span>{</span>
          "ResourceType" : ["AWS::RDS::DBInstance"]
        }
      }
    },
    <span>{</span>
      "Effect" : "Allow",
      "Action" : "Update:*",
      "Principal": "*",
      "Resource" : "*"
    }
  ]
}</code></pre>
     
     
     <h3 id="w9aac25c17c29c21c11">避免更換執行個體的更新</h3>
      <p>下列政策拒絕會造成更換邏輯 ID 為 <code class="code">MyInstance</code> 之執行個體的更新。<code class="code">Allow</code> 陳述式允許所有其他堆疊資源的所有更新動作。<code class="code">Allow</code> 陳述式不適用於 <code class="code">MyInstance</code> 資源，因為 <code class="code">Deny</code> 陳述式一律會覆寫允許動作。</p>
      <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="複製"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
  "Statement" : [
    <span>{</span>
      "Effect" : "Deny",
      "Action" : "Update:Replace",
      "Principal": "*",
      "Resource" : "LogicalResourceId/MyInstance"
    },
    <span>{</span>
      "Effect" : "Allow",
      "Action" : "Update:*",
      "Principal": "*",
      "Resource" : "*"
    }
  ]
}</code></pre>
     
     
     <h3 id="w9aac25c17c29c21c13">避免巢狀堆疊的更新</h3>
      <p>下列原則會拒絕堆疊資源類型 (巢狀 AWS CloudFormation 堆疊) 上的所有更新動作。<code class="code">Allow</code> 陳述式允許所有其他堆疊資源的所有更新動作。該<code class="code">Allow</code>語句不適用於 AWS CloudFormation堆棧資源，因為<code class="code">Deny</code>語句總是覆蓋允許操作。</p>
      <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="複製"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
  "Statement" : [
    <span>{</span>
      "Effect" : "Deny",
      "Action" : "Update:*",
      "Principal": "*",
      "Resource" : "*",
      "Condition" : <span>{</span>
        "StringEquals" : <span>{</span>
          "ResourceType" : ["AWS::CloudFormation::Stack"]
        }
      }
    },
    <span>{</span>
      "Effect" : "Allow",
      "Action" : "Update:*",
      "Principal": "*",
      "Resource" : "*"
    }
  ]
}</code></pre>
     
  <awsdocs-copyright class="copyright-print"></awsdocs-copyright><awsdocs-thumb-feedback right-edge="{{$ctrl.thumbFeedbackRightEdge}}"></awsdocs-thumb-feedback></div><noscript><div><div><div><div id="js_error_message"><p><img src="https://d1ge0kk1l5kms0.cloudfront.net/images/G/01/webservices/console/warning.png" alt="警告" /> <strong>您的瀏覽器已停用或無法使用 Javascript。</strong></p><p>您必須啟用 Javascript，才能使用 AWS 文件。請參閱您的瀏覽器說明頁以取得說明。</p></div></div></div></div></noscript><div id="main-col-footer" class="awsui-util-font-size-0"><div id="doc-conventions"><a target="_top" href="/general/latest/gr/docconventions.html">文件慣用形式</a></div><div class="prev-next"><div id="previous" class="prev-link" accesskey="p" href="./using-cfn--stack-update-cancel.html">取消堆疊更新</div><div id="next" class="next-link" accesskey="n" href="./using-cfn-updating-stacks-continueupdaterollback.html">繼續復原更新</div></div></div><awsdocs-page-utilities></awsdocs-page-utilities></div><div id="quick-feedback-yes" style="display: none;"><div class="title">此頁面是否有幫助？ - 是</div><div class="content"><p>感謝您，讓我們知道我們做得很好！</p><p>若您有空，歡迎您告知我們值得讚許的地方，這樣才能保持良好服務。</p><p><awsui-button id="fblink" rel="noopener noreferrer" target="_blank" text="意見回饋" click="linkClick($event)" href="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=CloudFormation&amp;topic_url=https://docs.aws.amazon.com/zh_tw/AWSCloudFormation/latest/UserGuide/protect-stack-resources.html"></awsui-button></p></div></div><div id="quick-feedback-no" style="display: none;"><div class="title">此頁面是否有幫助？ - 否</div><div class="content"><p>感謝讓我們知道此頁面仍須改善。很抱歉，讓您失望。</p><p>若您有空，歡迎您提供改善文件的方式。</p><p><awsui-button id="fblink" rel="noopener noreferrer" target="_blank" text="意見回饋" click="linkClick($event)" href="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=CloudFormation&amp;topic_url=https://docs.aws.amazon.com/zh_tw/AWSCloudFormation/latest/UserGuide/protect-stack-resources.html"></awsui-button></p></div></div></div></body></div></awsdocs-view><div class="page-loading-indicator" id="page-loading-indicator"><awsui-spinner size="large"></awsui-spinner></div></div><div id="tools-panel" dom-region="tools"><awsdocs-tools-panel id="awsdocs-tools-panel"></awsdocs-tools-panel></div></awsui-app-layout><awsdocs-cookie-banner class="doc-cookie-banner"></awsdocs-cookie-banner></div></body></html>