<!DOCTYPE html>
    <html xmlns="http://www.w3.org/1999/xhtml" lang="zh-TW"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>AWS CloudFormation 最佳做法 - AWS CloudFormation</title><meta name="viewport" content="width=device-width,initial-scale=1" /><meta name="assets_root" content="/assets" /><meta name="target_state" content="best-practices" /><meta name="default_state" content="best-practices" /><link rel="icon" type="image/ico" href="/assets/images/favicon.ico" /><link rel="shortcut icon" type="image/ico" href="/assets/images/favicon.ico" /><link rel="canonical" href="https://docs.aws.amazon.com/zh_tw/AWSCloudFormation/latest/UserGuide/best-practices.html" /><meta name="description" content="使用最佳做法協助您 AWS CloudFormation 更有效且安全地使用。" /><meta name="deployment_region" content="IAD" /><meta name="product" content="AWS CloudFormation" /><meta name="guide" content="使用者指南" /><meta name="abstract" content="使 AWS CloudFormation 用本使用者指南可預測並重複地建立和管理 AWS 基礎架構部署。" /><meta name="guide-locale" content="zh_tw" /><meta name="tocs" content="toc-contents.json" /><link rel="canonical" href="https://docs.aws.amazon.com/zh_tw/AWSCloudFormation/latest/UserGuide/best-practices.html" /><link rel="alternative" href="https://docs.aws.amazon.com/id_id/AWSCloudFormation/latest/UserGuide/best-practices.html" hreflang="id-id" /><link rel="alternative" href="https://docs.aws.amazon.com/id_id/AWSCloudFormation/latest/UserGuide/best-practices.html" hreflang="id" /><link rel="alternative" href="https://docs.aws.amazon.com/de_de/AWSCloudFormation/latest/UserGuide/best-practices.html" hreflang="de-de" /><link rel="alternative" href="https://docs.aws.amazon.com/de_de/AWSCloudFormation/latest/UserGuide/best-practices.html" hreflang="de" /><link rel="alternative" href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/best-practices.html" hreflang="en-us" /><link rel="alternative" href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/best-practices.html" hreflang="en" /><link rel="alternative" href="https://docs.aws.amazon.com/es_es/AWSCloudFormation/latest/UserGuide/best-practices.html" hreflang="es-es" /><link rel="alternative" href="https://docs.aws.amazon.com/es_es/AWSCloudFormation/latest/UserGuide/best-practices.html" hreflang="es" /><link rel="alternative" href="https://docs.aws.amazon.com/fr_fr/AWSCloudFormation/latest/UserGuide/best-practices.html" hreflang="fr-fr" /><link rel="alternative" href="https://docs.aws.amazon.com/fr_fr/AWSCloudFormation/latest/UserGuide/best-practices.html" hreflang="fr" /><link rel="alternative" href="https://docs.aws.amazon.com/it_it/AWSCloudFormation/latest/UserGuide/best-practices.html" hreflang="it-it" /><link rel="alternative" href="https://docs.aws.amazon.com/it_it/AWSCloudFormation/latest/UserGuide/best-practices.html" hreflang="it" /><link rel="alternative" href="https://docs.aws.amazon.com/ja_jp/AWSCloudFormation/latest/UserGuide/best-practices.html" hreflang="ja-jp" /><link rel="alternative" href="https://docs.aws.amazon.com/ja_jp/AWSCloudFormation/latest/UserGuide/best-practices.html" hreflang="ja" /><link rel="alternative" href="https://docs.aws.amazon.com/ko_kr/AWSCloudFormation/latest/UserGuide/best-practices.html" hreflang="ko-kr" /><link rel="alternative" href="https://docs.aws.amazon.com/ko_kr/AWSCloudFormation/latest/UserGuide/best-practices.html" hreflang="ko" /><link rel="alternative" href="https://docs.aws.amazon.com/pt_br/AWSCloudFormation/latest/UserGuide/best-practices.html" hreflang="pt-br" /><link rel="alternative" href="https://docs.aws.amazon.com/pt_br/AWSCloudFormation/latest/UserGuide/best-practices.html" hreflang="pt" /><link rel="alternative" href="https://docs.aws.amazon.com/zh_cn/AWSCloudFormation/latest/UserGuide/best-practices.html" hreflang="zh-cn" /><link rel="alternative" href="https://docs.aws.amazon.com/zh_tw/AWSCloudFormation/latest/UserGuide/best-practices.html" hreflang="zh-tw" /><link rel="alternative" href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/best-practices.html" hreflang="x-default" /><meta name="feedback-item" content="CloudFormation" /><meta name="this_doc_product" content="AWS CloudFormation" /><meta name="this_doc_guide" content="使用者指南" /><script defer="" src="/assets/r/vendor4.js?version=2021.12.02"></script><script defer="" src="/assets/r/vendor3.js?version=2021.12.02"></script><script defer="" src="/assets/r/vendor1.js?version=2021.12.02"></script><script defer="" src="/assets/r/awsdocs-common.js?version=2021.12.02"></script><script defer="" src="/assets/r/awsdocs-doc-page.js?version=2021.12.02"></script><link href="/assets/r/vendor4.css?version=2021.12.02" rel="stylesheet" /><link href="/assets/r/awsdocs-common.css?version=2021.12.02" rel="stylesheet" /><link href="/assets/r/awsdocs-doc-page.css?version=2021.12.02" rel="stylesheet" /><script async="" id="awsc-panorama-bundle" type="text/javascript" src="https://prod.pa.cdn.uis.awsstatic.com/panorama-nav-init.js" data-config="{'appEntity':'aws-documentation','region':'us-east-1','service':'cloudformation'}"></script><meta id="panorama-serviceSubSection" value="使用者指南" /><meta id="panorama-serviceConsolePage" value="AWS CloudFormation 最佳做法" /></head><body class="awsdocs awsui"><div class="awsdocs-container"><awsdocs-header></awsdocs-header><awsui-app-layout id="app-layout" class="awsui-util-no-gutters" ng-controller="ContentController as $ctrl" header-selector="awsdocs-header" navigation-hide="false" navigation-width="$ctrl.navWidth" navigation-open="$ctrl.navOpen" navigation-change="$ctrl.onNavChange($event)" tools-hide="$ctrl.hideTools" tools-width="$ctrl.toolsWidth" tools-open="$ctrl.toolsOpen" tools-change="$ctrl.onToolsChange($event)"><div id="guide-toc" dom-region="navigation"><awsdocs-toc></awsdocs-toc></div><div id="main-column" dom-region="content" tabindex="-1"><awsdocs-view class="awsdocs-view"><div id="awsdocs-content"><head><title>AWS CloudFormation 最佳做法 - AWS CloudFormation</title><meta name="rss" content="aws-cloudformation-release-notes.rss" /><meta name="forums" content="http://forums.aws.amazon.com/forum.jspa?forumID=92" /><meta name="feedback" content="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=CloudFormation&amp;topic_url=https://docs.aws.amazon.com/zh_tw/AWSCloudFormation/latest/UserGuide/best-practices.html" /><meta name="feedback-yes" content="feedbackyes.html?topic_url=https://docs.aws.amazon.com/zh_tw/AWSCloudFormation/latest/UserGuide/best-practices.html" /><meta name="feedback-no" content="feedbackno.html?topic_url=https://docs.aws.amazon.com/zh_tw/AWSCloudFormation/latest/UserGuide/best-practices.html" /><meta name="keywords" content="CloudFormation,AWSCloudFormation,資源佈建,資源組態,基礎設施管理,CloudFormer,CloudFormation 堆疊,CloudFormation 堆疊集,CloudFormation 範本,變更集合" /><script type="application/ld+json">
{
    "@context" : "https://schema.org",
    "@type" : "BreadcrumbList",
    "itemListElement" : [
      {
        "@type" : "ListItem",
        "position" : 1,
        "name" : "AWS",
        "item" : "https://aws.amazon.com"
      },
      {
        "@type" : "ListItem",
        "position" : 2,
        "name" : "AWS CloudFormation",
        "item" : "https://docs.aws.amazon.com/cloudformation/index.html"
      },
      {
        "@type" : "ListItem",
        "position" : 3,
        "name" : "使用者指南",
        "item" : "https://docs.aws.amazon.com/zh_tw/AWSCloudFormation/latest/UserGuide"
      },
      {
        "@type" : "ListItem",
        "position" : 4,
        "name" : "AWS CloudFormation 最佳做法",
        "item" : "https://docs.aws.amazon.com/zh_tw/AWSCloudFormation/latest/UserGuide/best-practices.html"
      }
    ]
}
</script></head><body><div id="main"><div style="display: none"></div><div id="breadcrumbs" class="breadcrumb"><a href="https://aws.amazon.com">AWS</a><a href="/index.html">文件</a><a href="/cloudformation/index.html">AWS CloudFormation</a><a href="Welcome.html">使用者指南</a></div><div id="page-toc-src"><a href="#shortenfeedbackloop">縮短回饋迴圈以提高交付速度</a><a href="#organizingstacks">依生命週期和所有權組織您的堆疊</a><a href="#cross-stack">使用跨堆疊參考匯出共享資源</a><a href="#limits">驗證所有資源類型的配額</a><a href="#reuse">重複使用範本在多個環境中複製堆疊</a><a href="#modules-reuse">使用模組以重複使用資源組態</a><a href="#parmtypes">使用 AWS特定參數類型</a><a href="#parmconstraints">使用參數限制條件</a><a href="#pseudoparameters">使用虛擬參數提升可攜性</a><a href="#cfninit">使用 AWS::CloudFormation::Init 在 Amazon EC2 執行個體上部署軟體應用程式</a><a href="#helper-scripts">使用最新的協助程式指令碼</a><a href="#validate">驗證後再使用範本</a><a href="#donttouch">通過管理所有堆棧資源 AWS CloudFormation</a><a href="#cfn-best-practices-changesets">更新您的堆疊之前建立變更集</a><a href="#stackpolicy">使用堆疊政策</a><a href="#code">使用程式碼檢閱和修訂控制管理您的範本</a><a href="#update-ec2-linux">定期更新 Amazon EC2 執行個體</a></div><div id="main-content" class="awsui-util-container"><div id="main-col-body"><awsdocs-language-banner data-service="$ctrl.pageService"></awsdocs-language-banner><awsui-alert class="awsdocs-page-banner awsui-util-mb-l"><p>本文為英文版的機器翻譯版本，如內容有任何歧義或不一致之處，概以英文版為準。</p></awsui-alert><h1 class="topictitle" id="best-practices">AWS CloudFormation 最佳做法</h1><div class="awsdocs-page-header-container"><awsdocs-page-header></awsdocs-page-header><awsdocs-filter-selector id="awsdocs-filter-selector"></awsdocs-filter-selector></div><p>最佳做法是可協助您在整個工作流程中 AWS CloudFormation 更有效且安全地使用的建議。了解如何規劃和組織您的堆疊、建立範本來描述您的資源和對其執行的軟體應用程式，以及管理您的堆疊及其資源。以下最佳做法是根據目前 CloudFormation 客戶的實際經驗為基礎。</p><div class="variablelist">
     
     
     
  <dl>
      <dt><b><span class="term">規劃與組織</span></b></dt>
      <dd>
        <div class="itemizedlist">
           
           
           
           
           
           
           
        <ul class="itemizedlist"><li class="listitem">
            <p><a href="#shortenfeedbackloop">縮短回饋迴圈以提高交付速度</a></p>
          </li><li class="listitem">
            <p><a href="#organizingstacks">依生命週期和所有權組織您的堆疊</a></p>
          </li><li class="listitem">
            <p><a href="#cross-stack">使用跨堆疊參考匯出共享資源</a></p>
          </li><li class="listitem">
            <p><a href="./security-best-practices.html#use-iam-to-control-access">使用 IAM 控制存取</a></p>
          </li><li class="listitem">
            <p><a href="#reuse">重複使用範本在多個環境中複製堆疊</a></p>
          </li><li class="listitem">
            <p><a href="#limits">驗證所有資源類型的配額</a>
            </p>
          </li><li class="listitem">
            <p><a href="#modules-reuse">使用模組以重複使用資源組態</a></p>
          </li></ul></div>
      </dd>
    
      <dt><b><span class="term">建立範本</span></b></dt>
      <dd>
        <div class="itemizedlist">
           
           
           
           
           
           
           
        <ul class="itemizedlist"><li class="listitem">
            <p><a href="./security-best-practices.html#creds">請勿在您的範本中內嵌憑證</a></p>
          </li><li class="listitem">
            <p><a href="#parmtypes">使用 AWS特定參數類型</a></p>
          </li><li class="listitem">
            <p><a href="#parmconstraints">使用參數限制條件</a></p>
          </li><li class="listitem">
            <p><a href="#pseudoparameters">使用虛擬參數提升可攜性</a></p>
          </li><li class="listitem">
            <p><a href="#cfninit">使用 AWS::CloudFormation::Init 在 Amazon EC2 執行個體上部署軟體應用程式</a></p>
          </li><li class="listitem">
            <p><a href="#helper-scripts">使用最新的協助程式指令碼</a></p>
          </li><li class="listitem">
            <p><a href="#validate">驗證後再使用範本</a></p>
          </li></ul></div>
      </dd>
    
      <dt><b><span class="term">管理堆疊</span></b></dt>
      <dd>
        <div class="itemizedlist">
           
           
           
           
           
           
        <ul class="itemizedlist"><li class="listitem">
            <p><a href="#donttouch">通過管理所有堆棧資源 AWS CloudFormation</a></p>
          </li><li class="listitem">
            <p><a href="#cfn-best-practices-changesets">更新您的堆疊之前建立變更集</a></p>
          </li><li class="listitem">
            <p><a href="#stackpolicy">使用堆疊政策</a></p>
          </li><li class="listitem">
            <p><a href="./security-best-practices.html#cloudtrail">使用 AWS CloudTrail 記錄 AWS CloudFormation 呼叫</a></p>
          </li><li class="listitem">
            <p><a href="#code">使用程式碼檢閱和修訂控制管理您的範本</a></p>
          </li><li class="listitem">
            <p><a href="#update-ec2-linux">定期更新 Amazon EC2 執行個體</a></p>
          </li></ul></div>
      </dd>
    </dl></div>
    <h2 id="shortenfeedbackloop">縮短回饋迴圈以提高交付速度</h2>

    <p>採用實務和工具，協助您縮短使用 CloudFormation 範本描述之基礎結構的意見回饋迴圈。這包括在工作站中對範本執行早期檢查和測試；這樣一來，在將成品提交至原始碼儲存庫之前，您還有機會發現潛在的語法和組態問題。早期發現這類問題有助於防止它們進入正式的生命週期環境，例如開發、品質保證和生產。這種早期測試、快速檢錯方法可讓您減少重工等待時間、減少潛在的影響區域，以及增加成功佈建作業的信心程度。</p>
    <p>幫助您實現快速失敗實踐的工具選擇包括 <a href="https://github.com/aws-cloudformation/cfn-lint" rel="noopener noreferrer" target="_blank"><span>AWS CloudFormation Linter（cfn-lin</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a> t）和命令行工具。<a href="https://github.com/aws-ia/taskcat" rel="noopener noreferrer" target="_blank"><span>TaskCat</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a><a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/cfn-resource-specification.html">cfn-lint 工具使您能夠根據資源規範驗證 CloudFormation 模板。AWS CloudFormation</a>這包括檢查資源屬性的有效值，以及最佳實務。cfn-lint 的外掛程式<a href="https://github.com/aws-cloudformation/cfn-lint#editor-plugins" rel="noopener noreferrer" target="_blank"><span>適用於許多程式碼編輯器</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a>；這可讓問題在編輯器中一目了然，為您提供直接的 linter 回饋。您也可以選擇將 cfn-lint 整合到原始碼儲存庫的組態中，以便在提交成品時執行範本驗證。有關更多信息，請參閱<a href="https://aws.amazon.com/blogs/mt/git-pre-commit-validation-of-aws-cloudformation-templates-with-cfn-lint/" rel="noopener noreferrer" target="_blank"><span>使用 cfn-lint 對 AWS CloudFormation 模板進行 Git 預提交驗證</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a>。一旦您執行了初始連結並修正了 cfn-lint 可能發生的任何問題，就可以使用以程式設計方式在您選擇的區域中建立堆疊 TaskCat 來測試範本。 AWS TaskCat還會為您選擇的每個區域產生一個包含合格/失敗等級的報告。</p>
    <p>如需如何使用這兩種工具縮短回饋迴圈的實作逐步解說，請參閱工<a href="https://catalog.workshops.aws/cfn101/en-US" rel="noopener noreferrer" target="_blank"><span>AWS CloudFormation 作坊</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a>的 <a href="https://catalog.workshops.aws/cfn101/en-US/basics/templates/linting-and-testing" rel="noopener noreferrer" target="_blank"><span>Linting and Test 實驗室</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a>。 step-by-step</p>
   
    <h2 id="organizingstacks">依生命週期和所有權組織您的堆疊</h2>

    <p>使用 AWS 資源的生命週期和擁有權來協助您決定每個堆疊中應使用哪些資源。一開始，您可能會將所有資源放在一個堆疊中，但隨著您的堆疊逐漸成比例成長且範圍越來越廣泛，管理單一堆疊可能既繁瑣又耗時。透過根據通用生命週期和所有權來分組資源，擁有者就可以使用自己的程序和排程來變更一組資源，無需影響其他資源。</p>
    <p>例如，假設開發人員和工程師團隊擁有一個網站，在負載平衡器後方自動調整規模的執行個體上託管。由於網站有自己的生命週期並由網站團隊維護，因此您可以建立網站及其資源的堆疊。現在，假設網站也會使用後端資料庫，這些資料庫位於資料庫管理員擁有及維護的個別堆疊中。每當網站團隊或資料庫團隊需要更新其資源時，都可以在不影響彼此的堆疊下執行這項操作。如果所有資源都在同一個堆疊中，協調及傳達更新可能很困難。</p>
    <p>如需組織您堆疊的其他指引，您可以使用兩個常見架構：多層架構和服務導向架構 (SOA)。</p>
    <p>分層架構可將堆疊組織成彼此重疊的多個水平層，每個 layer 會相依於其正下方的 layer。您可以在每個 layer 中有一或多個堆疊，但在每個 layer 內，您的堆疊應該有生命週期和所有權類似的 AWS
資源。</p>
    <p>使用服務導向架構，您可以將龐大的商務問題組織成多個易於管理的部分。每個部分都是一項服務，其具有明確定義的用途，並代表獨立的功能單位。您可以將這些服務映射至堆疊，每個堆疊都有自己的生命週期和擁有者。所有服務 (堆疊) 都可連接在一起，以便彼此互動。</p>
   
    <h2 id="cross-stack">使用跨堆疊參考匯出共享資源</h2>

    <p>當您根據生命週期和擁有權來組織 AWS 資源時，您可能會想要建置使用其他堆疊中資源的堆疊。您可以硬式編碼值，或使用輸入參數來傳遞資源名稱和 ID。不過，這些方法可能會讓範本難以重複使用，或可能增加讓堆疊執行的成本。請改用跨堆疊參考從堆疊匯出資源，讓其他堆疊可以使用這些資源。堆疊可以透過使用 <code class="code">Fn::ImportValue</code> 函數呼叫匯出的資源，來使用這些資源。</p>
    <p>例如，您可能有一個網路堆疊，其中包含 VPC、安全群組和子網路。您想要讓所有公有 Web 應用程式使用這些資源。透過匯出資源，即允許具有公有 Web 應用程式的所有堆疊使用這些資源。如需詳細資訊，請參閱 <a href="./walkthrough-crossstackref.html">演練：參考在另一個 AWS CloudFormation 堆疊中的資源輸出</a>。</p>
   
    <h2 id="limits">驗證所有資源類型的配額</h2>

    <p>在啟動堆疊之前，請確定您可以建立所需的所有資源，而不會達到 AWS 帳戶限制。如果您達到限制，除非您增加配額或刪除額外資源，否則不 CloudFormation 會成功建立堆疊。每項服務可能會有各種限制，需要您在啟動堆疊前注意。例如，根據預設，您只能在您的區域中啟動 2000 個 CloudFormation 堆疊 AWS 帳戶。如需有關限制及如何提高預設限制的詳細資訊，請參閱 <em>AWS 一般參考</em> 中的 <a href="https://docs.aws.amazon.com/general/latest/gr/aws_service_limits.html">AWS 服務配額</a>。</p>
   
    <h2 id="reuse">重複使用範本在多個環境中複製堆疊</h2>

    <p>設定您的堆疊和資源之後，您可以重複使用範本在多個環境中複製您的基礎設施。例如，您可以建立適用於開發、測試和生產的環境，讓您可以測試變更，再將其實作到生產環境中。為了讓範本可重複使用，請使用參數、映射和條件區段，以便在建立堆疊時能夠自訂這些堆疊。例如，對於您的開發環境，您可以指定相較於生產環境成本較低的執行個體類型，但所有其他組態和設定則保持不變。如需參數、映射和條件的詳細資訊，請參閱<a href="./template-anatomy.html">範本剖析</a>。</p>
   
    <h2 id="modules-reuse">使用模組以重複使用資源組態</h2>

    <p>隨著您的基礎設施逐漸成長，可能出現的常見模式即是您會在每個範本中宣告相同的元件。<em>模組</em>可讓您以透明、易於管理且可重複的方式，來封裝可包含在堆疊範本之間的資源組態。模組可透過可自訂的模組化建置區塊形式，來封裝通用服務組態和最佳實務，以便您將其納入堆疊範本中。</p>
    <p>這些建置區塊可用於單一資源，例如定義 Amazon Elastic Compute Cloud (Amazon EC2) 執行個體的最佳實務；也可以用於多個資源，以定義應用程式架構的常見模式。這些構建塊可以嵌套到其他模塊中，因此您可以將最佳實踐堆疊到更高級別的構建塊中。  CloudFormation 模塊在<a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/registry.html">CloudFormation 註冊表</a>中可用，因此您可以像本地資源一樣使用它們。當您使用 CloudFormation 模塊時，模塊模板將擴展到消費模板中，這使您可以使用 <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/intrinsic-function-reference-ref.html">Ref</a> 或 <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/intrinsic-function-reference-getatt.html">Fn::</a> 訪問模塊內的資源GetAtt。如需詳細資訊，請參閱<a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/modules.html">模組</a>。</p>
   
    <h2 id="parmtypes">使用 AWS特定參數類型</h2>

    <p>如果您的範本需要為現有的 AWS特定值輸入，例如現有的 Amazon Virtual Private Cloud ID 或 Amazon EC2 key pair 名稱，請使用 AWS特定的參數類型。例如，您可以將參數指定為 type<code class="code">AWS::EC2::KeyPair::KeyName</code>，該參數會使用您 AWS 帳戶中和建立堆疊所在區域中的現有 key pair 名稱。 AWS CloudFormation 在建立堆疊之前，可以快速驗證 AWS特定參數類型的值。此外，如果您使用 CloudFormation 主控台，會 CloudFormation 顯示有效值的下拉式清單，因此您不必查詢或記住正確的 VPC ID 或 key pair 名稱。如需詳細資訊，請參閱 <a href="./parameters-section-structure.html">參數</a>。</p>
   
    <h2 id="parmconstraints">使用參數限制條件</h2>

    <p>使用約束，您可以描述允許的輸入值，以便在創建堆棧之前 CloudFormation 捕獲任何無效的值。您可以設定限制條件，例如長度下限、長度上限和允許的模式。例如，您可以對資料庫使用者名稱值設定限制條件，讓其長度至少為八個字元並只包含英數字元。如需詳細資訊，請參閱 <a href="./parameters-section-structure.html">參數</a>。</p>
   
    <h2 id="pseudoparameters">使用虛擬參數提升可攜性</h2>

    <p>您可以在範本中使用<a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/pseudo-parameter-reference.html">虛擬參數</a>作為<a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/intrinsic-function-reference.html">內部函數</a>的引數，例如 <code class="code">Ref</code> 和 <code class="code">Fn::Sub</code>。虛擬參數是由 CloudFormation預先定義的參數。請勿在範本中宣告這些參數。在內部函數中使用虛擬參數可增加堆疊範本跨區域和帳戶的可攜性。</p>
    <p>例如，假設您想要建立範本，其中需要針對特定資源屬性指定另一個現有資源的 <a href="https://docs.aws.amazon.com/general/latest/gr/aws-arns-and-namespaces.html">Amazon Resource Name</a> (ARN)。在此情況下，現有資源是具有以下 ARN 的 <a href="https://docs.aws.amazon.com/systems-manager/latest/userguide/systems-manager-parameter-store.html">AWS Systems Manager
參數存放區</a>資源：<code class="code">arn:aws:ssm:us-east-1:111122223333:parameter/MySampleParameter</code>。您需要將 <a href="https://docs.aws.amazon.com/general/latest/gr/aws-arns-and-namespaces.html#arns-syntax">ARN 格式</a>調整為目標 AWS 分區，區域和帳戶 ID。您可以使用 <code class="code">AWS::Partition</code>、<code class="code">AWS::Region</code> 和 <code class="code">AWS::AccountId</code> 虛擬參數提升範本可攜性，而非對此類值進行硬式編碼。在這種情況下，下面的例子顯示了如何將 ARN 中的元素與:連接起 CloudFormation來。<code class="code">!Sub
        'arn:$<span>{</span>AWS::Partition}:ssm:$<span>{</span>AWS::Region}:$<span>{</span>AWS::AccountId}:parameter/MySampleParameter</code></p>
    <p>對於另一個例子，假設您想<a href="./walkthrough-crossstackref.html">演練：參考在另一個 AWS CloudFormation 堆疊中的資源輸出</a>要使用引用另一個 CloudFormation 堆棧中的資源輸出。在此範例中，假設您已為 VPC 建立<a href="https://docs.aws.amazon.com/vpc/latest/userguide/configure-subnets.html">子網路</a>，然後<a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/outputs-section-structure.html">匯出</a>其 ID，以便與相同帳戶和區域中的其他堆疊搭配使用。在另一個堆疊中，您可以在描述 Amazon EC2 執行個體時，參考子網路 ID 的匯出值。</p>
    <p>堆疊匯出在每個帳戶和區域中必須是唯一。因此，在此情況下，您可以使用 <code class="code">AWS::StackName</code> 虛擬參數為匯出建立字首。由於每個帳戶和區域的堆疊名稱也必須是唯一，因此使用此虛擬參數作為字首會增加具有唯一匯出名稱的可能性，同時也促使在匯出值的堆疊間採行可重複使用的方法。或者，您可以自行選擇使用的字首。</p>
    <p>如需使用 <code class="code">Export</code> 輸出欄位和 <code class="code">Fn::ImportValue</code> 內部函數的詳細範例，請參閱 <a href="./walkthrough-crossstackref.html">演練：參考在另一個 AWS CloudFormation 堆疊中的資源輸出</a>。</p>
   
    <h2 id="cfninit">使用 <code class="code">AWS::CloudFormation::Init</code> 在 Amazon EC2 執行個體上部署軟體應用程式</h2>

    <p>當您啟動堆疊時，您可以使用 cfn-init 協助程式指令碼和 <code class="code">AWS::CloudFormation::Init</code> 資源，在 Amazon EC2 執行個體上安裝及設定軟體應用程式。透過使用 <code class="code">AWS::CloudFormation::Init</code>，您可以描述想要的組態，而不用編寫程序性步驟的指令碼。您也可以更新組態，無需重新建立執行個體。此外，如果您的組態發生任何錯誤， CloudFormation 會產生日誌，以供您用來調查問題。</p>
    <p>在您的範本中，透過 <code class="code">AWS::CloudFormation::Init</code> 資源指定安裝和組態狀態。如需說明如何使用 cfn-init 和 <code class="code">AWS::CloudFormation::Init</code> 的演練，請參閱<a href="./deploying.applications.html">在 Amazon EC2 上部署應用程式 AWS CloudFormation</a>。</p>
   
    <h2 id="helper-scripts">使用最新的協助程式指令碼</h2>

    <p><a href="./cfn-helper-scripts-reference.html">協助程式指令碼</a>會定期更新。請務必在您範本的 <code class="code">UserData</code> 屬性中包含下列命令，再呼叫協助程式指令碼，以確保您已啟動的執行個體取得最新的協助程式指令碼：</p>
    <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="複製"><awsui-icon name="copy"></awsui-icon></div></div><code class="sh "><code class="userinput">yum install -y aws-cfn-bootstrap</code></code></pre>
    <p>如需取得最新協助程式指令碼的詳細資訊，請參閱 <a href="./cfn-helper-scripts-reference.html">CloudFormation 協助程式指令碼參考</a>。</p>
   
    <h2 id="validate">驗證後再使用範本</h2>

    <p>在您使用範本建立或更新堆疊之前，您可以使用 CloudFormation 來驗證它。驗證樣板可以幫助您在 CloudFormation 創建任何資源之前 catch 語法和一些語義錯誤，例如循環依賴關係。如果您使用 CloudFormation 主控台，主控台會在您指定輸入參數之後自動驗證範本。對於 AWS CLI 或  CloudFormation  API，請使用命<a href="https://docs.aws.amazon.com/cli/latest/reference/cloudformation/validate-template.html"><code class="code">aws cloudformation validate-template</code></a>令或 <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/APIReference/API_ValidateTemplate.html"><code class="code">ValidateTemplate</code></a>API 作業。</p>
    <p>在驗證期間， CloudFormation 首先檢查範本是否為有效的 JSON。如果不是， CloudFormation  會檢查範本是否為有效的 YAML。如果兩項檢查都失敗，則會 CloudFormation 傳回範本驗證錯誤。</p>
     
      <h3 id="validate-compliance">驗證範本是否符合組織政策規範</h3>
      <p>您也可以驗證範本是否符合組織原則指導方針。 AWS CloudFormation Guard (<code class="code">cfn-guard</code>) 是一種開放原始碼命令列介面 (CLI) 工具，提供一種 policy-as-code 語言來定義可檢查必要和禁止資源組態的規則。然後，它可讓您根據這些規則驗證您的範本。例如，管理員可建立規則以確保使用者一律建立加密的 Amazon S3 儲存貯體。</p>
      <p>您可在本機使用 <code class="code">cfn-guard</code>，或自動作為 CI/CD 管道的一部分，以停止不合規資源的部署。</p>
      <p>此外，還<code class="code">cfn-guard</code>包含可讓您從現有合規 CloudFormation 範本擷取規則的功能。<code class="code">rulegen</code></p>
      <p>如需詳細資訊，請參閱上的 <a href="https://github.com/aws-cloudformation/cloudformation-guard" rel="noopener noreferrer" target="_blank"><span>cfn-guard</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a> 儲存庫。 GitHub</p>
     
   
    <h2 id="donttouch">通過管理所有堆棧資源 AWS CloudFormation</h2>

    <p>啟動堆疊後，請使用 CloudFormation <a href="https://console.aws.amazon.com/cloudformation/home" rel="noopener noreferrer" target="_blank"><span>主控台</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a>、<a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/APIReference/">API</a> 或 <a href="https://docs.aws.amazon.com/cli/latest/reference/cloudformation/index.html">AWS CLI</a> 更新堆疊中的資源。不要對堆疊資源進行變更 CloudFormation。這樣做可能會在您堆疊的範本與您堆疊資源的目前狀態之間產生不相符的情況，如果您更新或刪除堆疊，這可能會造成錯誤。如需詳細資訊，請參閱 <a href="./updating.stacks.walkthrough.html">演練：更新堆疊</a>。</p>
   
    <h2 id="cfn-best-practices-changesets">更新您的堆疊之前建立變更集</h2>

    <p>變更集可讓您在實作之前，查看對堆疊提議的變更可能會對執行中的資源造成什麼影響。  CloudFormation 在您執行變更集之前，不會對堆疊進行任何變更，讓您決定要繼續進行提議的變更或建立另一個變更集。</p>
    <p>使用變更集可查看您的變更對執行中資源 (特別是重要資源) 造成的影響。例如，如果您變更 Amazon RDS 資料庫執行個體的名稱， CloudFormation 將會建立新資料庫並刪除舊資料庫；除非您已備份舊資料庫，否則您將遺失舊資料庫中的資料。如果您產生變更集，您會看到變更取代您的資料庫。這可協助您先規劃，再更新您的堆疊。如需詳細資訊，請參閱 <a href="./using-cfn-updating-stacks-changesets.html">透過變更集更新堆疊</a>。</p>
   
    <h2 id="stackpolicy">使用堆疊政策</h2>

    <p>堆疊政策可協助防止意外更新重要的堆疊資源，這可能會導致資源被中斷或甚至被取代。堆疊政策是一種 JSON 文件，描述可在指定資源上執行的更新動作。每當您建立具有重要資源的堆疊時，請指定堆疊政策。</p>
    <p>在堆疊更新期間，您必須明確地指定要更新的受保護資源，否則不會對受保護的資源進行任何變更。如需詳細資訊，請參閱 <a href="./protect-stack-resources.html">避免更新堆疊資源</a>。</p>
   
    <h2 id="code">使用程式碼檢閱和修訂控制管理您的範本</h2>

    <p>您的堆疊範本會描述 AWS 資源的組態，例如其屬性值。若要檢閱變更並保留確切的資源歷史記錄，請使用程式碼檢閱和修訂控制。這些方法可協助您追蹤不同版本的範本之間的變更，如此有助於追蹤您堆疊資源的變更。此外，透過維護歷史記錄，您就可以隨時將堆疊還原至範本的特定版本。</p>
   
    <h2 id="update-ec2-linux">定期更新 Amazon EC2 執行個體</h2>

    <p>在所有使用建立的 Amazon EC2 Windows 執行個體和 Amazon EC2 Linux 執行個體上 CloudFormation，定期執行<code class="code">yum update</code>命令來更新 RPM 套件。這可確保您取得最新的修正程式和安全性更新。</p>
  <awsdocs-copyright class="copyright-print"></awsdocs-copyright><awsdocs-thumb-feedback right-edge="{{$ctrl.thumbFeedbackRightEdge}}"></awsdocs-thumb-feedback></div><noscript><div><div><div><div id="js_error_message"><p><img src="https://d1ge0kk1l5kms0.cloudfront.net/images/G/01/webservices/console/warning.png" alt="警告" /> <strong>您的瀏覽器已停用或無法使用 Javascript。</strong></p><p>您必須啟用 Javascript，才能使用 AWS 文件。請參閱您的瀏覽器說明頁以取得說明。</p></div></div></div></div></noscript><div id="main-col-footer" class="awsui-util-font-size-0"><div id="doc-conventions"><a target="_top" href="/general/latest/gr/docconventions.html">文件慣用形式</a></div><div class="prev-next"><div id="previous" class="prev-link" accesskey="p" href="./vpc-interface-endpoints.html">VPC 端點 (AWS PrivateLink)</div><div id="next" class="next-link" accesskey="n" href="./continuous-delivery-codepipeline.html">持續交付</div></div></div><awsdocs-page-utilities></awsdocs-page-utilities></div><div id="quick-feedback-yes" style="display: none;"><div class="title">此頁面是否有幫助？ - 是</div><div class="content"><p>感謝您，讓我們知道我們做得很好！</p><p>若您有空，歡迎您告知我們值得讚許的地方，這樣才能保持良好服務。</p><p><awsui-button id="fblink" rel="noopener noreferrer" target="_blank" text="意見回饋" click="linkClick($event)" href="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=CloudFormation&amp;topic_url=https://docs.aws.amazon.com/zh_tw/AWSCloudFormation/latest/UserGuide/best-practices.html"></awsui-button></p></div></div><div id="quick-feedback-no" style="display: none;"><div class="title">此頁面是否有幫助？ - 否</div><div class="content"><p>感謝讓我們知道此頁面仍須改善。很抱歉，讓您失望。</p><p>若您有空，歡迎您提供改善文件的方式。</p><p><awsui-button id="fblink" rel="noopener noreferrer" target="_blank" text="意見回饋" click="linkClick($event)" href="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=CloudFormation&amp;topic_url=https://docs.aws.amazon.com/zh_tw/AWSCloudFormation/latest/UserGuide/best-practices.html"></awsui-button></p></div></div></div></body></div></awsdocs-view><div class="page-loading-indicator" id="page-loading-indicator"><awsui-spinner size="large"></awsui-spinner></div></div><div id="tools-panel" dom-region="tools"><awsdocs-tools-panel id="awsdocs-tools-panel"></awsdocs-tools-panel></div></awsui-app-layout><awsdocs-cookie-banner class="doc-cookie-banner"></awsdocs-cookie-banner></div></body></html>