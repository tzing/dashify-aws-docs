<!DOCTYPE html>
    <html xmlns="http://www.w3.org/1999/xhtml" lang="zh-TW"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>逐步解說：使用 AWS CloudFormation 設計工具來修改堆疊的範本 - AWS CloudFormation</title><meta name="viewport" content="width=device-width,initial-scale=1" /><meta name="assets_root" content="/assets" /><meta name="target_state" content="working-with-templates-cfn-designer-walkthrough-updatebasicwebserver" /><meta name="default_state" content="working-with-templates-cfn-designer-walkthrough-updatebasicwebserver" /><link rel="icon" type="image/ico" href="/assets/images/favicon.ico" /><link rel="shortcut icon" type="image/ico" href="/assets/images/favicon.ico" /><link rel="canonical" href="https://docs.aws.amazon.com/zh_tw/AWSCloudFormation/latest/UserGuide/working-with-templates-cfn-designer-walkthrough-updatebasicwebserver.html" /><meta name="description" content="使用 AWS CloudFormation 設計工具來更新基本 Web 伺服器。" /><meta name="deployment_region" content="IAD" /><meta name="product" content="AWS CloudFormation" /><meta name="guide" content="使用者指南" /><meta name="abstract" content="使 AWS CloudFormation 用本使用者指南可預測並重複地建立和管理 AWS 基礎架構部署。" /><meta name="guide-locale" content="zh_tw" /><meta name="tocs" content="toc-contents.json" /><link rel="canonical" href="https://docs.aws.amazon.com/zh_tw/AWSCloudFormation/latest/UserGuide/working-with-templates-cfn-designer-walkthrough-updatebasicwebserver.html" /><link rel="alternative" href="https://docs.aws.amazon.com/id_id/AWSCloudFormation/latest/UserGuide/working-with-templates-cfn-designer-walkthrough-updatebasicwebserver.html" hreflang="id-id" /><link rel="alternative" href="https://docs.aws.amazon.com/id_id/AWSCloudFormation/latest/UserGuide/working-with-templates-cfn-designer-walkthrough-updatebasicwebserver.html" hreflang="id" /><link rel="alternative" href="https://docs.aws.amazon.com/de_de/AWSCloudFormation/latest/UserGuide/working-with-templates-cfn-designer-walkthrough-updatebasicwebserver.html" hreflang="de-de" /><link rel="alternative" href="https://docs.aws.amazon.com/de_de/AWSCloudFormation/latest/UserGuide/working-with-templates-cfn-designer-walkthrough-updatebasicwebserver.html" hreflang="de" /><link rel="alternative" href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/working-with-templates-cfn-designer-walkthrough-updatebasicwebserver.html" hreflang="en-us" /><link rel="alternative" href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/working-with-templates-cfn-designer-walkthrough-updatebasicwebserver.html" hreflang="en" /><link rel="alternative" href="https://docs.aws.amazon.com/es_es/AWSCloudFormation/latest/UserGuide/working-with-templates-cfn-designer-walkthrough-updatebasicwebserver.html" hreflang="es-es" /><link rel="alternative" href="https://docs.aws.amazon.com/es_es/AWSCloudFormation/latest/UserGuide/working-with-templates-cfn-designer-walkthrough-updatebasicwebserver.html" hreflang="es" /><link rel="alternative" href="https://docs.aws.amazon.com/fr_fr/AWSCloudFormation/latest/UserGuide/working-with-templates-cfn-designer-walkthrough-updatebasicwebserver.html" hreflang="fr-fr" /><link rel="alternative" href="https://docs.aws.amazon.com/fr_fr/AWSCloudFormation/latest/UserGuide/working-with-templates-cfn-designer-walkthrough-updatebasicwebserver.html" hreflang="fr" /><link rel="alternative" href="https://docs.aws.amazon.com/it_it/AWSCloudFormation/latest/UserGuide/working-with-templates-cfn-designer-walkthrough-updatebasicwebserver.html" hreflang="it-it" /><link rel="alternative" href="https://docs.aws.amazon.com/it_it/AWSCloudFormation/latest/UserGuide/working-with-templates-cfn-designer-walkthrough-updatebasicwebserver.html" hreflang="it" /><link rel="alternative" href="https://docs.aws.amazon.com/ja_jp/AWSCloudFormation/latest/UserGuide/working-with-templates-cfn-designer-walkthrough-updatebasicwebserver.html" hreflang="ja-jp" /><link rel="alternative" href="https://docs.aws.amazon.com/ja_jp/AWSCloudFormation/latest/UserGuide/working-with-templates-cfn-designer-walkthrough-updatebasicwebserver.html" hreflang="ja" /><link rel="alternative" href="https://docs.aws.amazon.com/ko_kr/AWSCloudFormation/latest/UserGuide/working-with-templates-cfn-designer-walkthrough-updatebasicwebserver.html" hreflang="ko-kr" /><link rel="alternative" href="https://docs.aws.amazon.com/ko_kr/AWSCloudFormation/latest/UserGuide/working-with-templates-cfn-designer-walkthrough-updatebasicwebserver.html" hreflang="ko" /><link rel="alternative" href="https://docs.aws.amazon.com/pt_br/AWSCloudFormation/latest/UserGuide/working-with-templates-cfn-designer-walkthrough-updatebasicwebserver.html" hreflang="pt-br" /><link rel="alternative" href="https://docs.aws.amazon.com/pt_br/AWSCloudFormation/latest/UserGuide/working-with-templates-cfn-designer-walkthrough-updatebasicwebserver.html" hreflang="pt" /><link rel="alternative" href="https://docs.aws.amazon.com/zh_cn/AWSCloudFormation/latest/UserGuide/working-with-templates-cfn-designer-walkthrough-updatebasicwebserver.html" hreflang="zh-cn" /><link rel="alternative" href="https://docs.aws.amazon.com/zh_tw/AWSCloudFormation/latest/UserGuide/working-with-templates-cfn-designer-walkthrough-updatebasicwebserver.html" hreflang="zh-tw" /><link rel="alternative" href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/working-with-templates-cfn-designer-walkthrough-updatebasicwebserver.html" hreflang="x-default" /><meta name="feedback-item" content="CloudFormation" /><meta name="this_doc_product" content="AWS CloudFormation" /><meta name="this_doc_guide" content="使用者指南" /><script defer="" src="/assets/r/vendor4.js?version=2021.12.02"></script><script defer="" src="/assets/r/vendor3.js?version=2021.12.02"></script><script defer="" src="/assets/r/vendor1.js?version=2021.12.02"></script><script defer="" src="/assets/r/awsdocs-common.js?version=2021.12.02"></script><script defer="" src="/assets/r/awsdocs-doc-page.js?version=2021.12.02"></script><link href="/assets/r/vendor4.css?version=2021.12.02" rel="stylesheet" /><link href="/assets/r/awsdocs-common.css?version=2021.12.02" rel="stylesheet" /><link href="/assets/r/awsdocs-doc-page.css?version=2021.12.02" rel="stylesheet" /><script async="" id="awsc-panorama-bundle" type="text/javascript" src="https://prod.pa.cdn.uis.awsstatic.com/panorama-nav-init.js" data-config="{'appEntity':'aws-documentation','region':'us-east-1','service':'cloudformation'}"></script><meta id="panorama-serviceSubSection" value="使用者指南" /><meta id="panorama-serviceConsolePage" value="逐步解說：使用 AWS CloudFormation 設計工具來修改堆疊的範本" /></head><body class="awsdocs awsui"><div class="awsdocs-container"><awsdocs-header></awsdocs-header><awsui-app-layout id="app-layout" class="awsui-util-no-gutters" ng-controller="ContentController as $ctrl" header-selector="awsdocs-header" navigation-hide="false" navigation-width="$ctrl.navWidth" navigation-open="$ctrl.navOpen" navigation-change="$ctrl.onNavChange($event)" tools-hide="$ctrl.hideTools" tools-width="$ctrl.toolsWidth" tools-open="$ctrl.toolsOpen" tools-change="$ctrl.onToolsChange($event)"><div id="guide-toc" dom-region="navigation"><awsdocs-toc></awsdocs-toc></div><div id="main-column" dom-region="content" tabindex="-1"><awsdocs-view class="awsdocs-view"><div id="awsdocs-content"><head><title>逐步解說：使用 AWS CloudFormation 設計工具來修改堆疊的範本 - AWS CloudFormation</title><meta name="rss" content="aws-cloudformation-release-notes.rss" /><meta name="forums" content="http://forums.aws.amazon.com/forum.jspa?forumID=92" /><meta name="feedback" content="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=CloudFormation&amp;topic_url=https://docs.aws.amazon.com/zh_tw/AWSCloudFormation/latest/UserGuide/working-with-templates-cfn-designer-walkthrough-updatebasicwebserver.html" /><meta name="feedback-yes" content="feedbackyes.html?topic_url=https://docs.aws.amazon.com/zh_tw/AWSCloudFormation/latest/UserGuide/working-with-templates-cfn-designer-walkthrough-updatebasicwebserver.html" /><meta name="feedback-no" content="feedbackno.html?topic_url=https://docs.aws.amazon.com/zh_tw/AWSCloudFormation/latest/UserGuide/working-with-templates-cfn-designer-walkthrough-updatebasicwebserver.html" /><meta name="keywords" content="CloudFormation,AWSCloudFormation,資源佈建,資源組態,基礎設施管理,CloudFormer,CloudFormation 堆疊,CloudFormation 堆疊集,CloudFormation 範本,變更集合" /><script type="application/ld+json">
{
    "@context" : "https://schema.org",
    "@type" : "BreadcrumbList",
    "itemListElement" : [
      {
        "@type" : "ListItem",
        "position" : 1,
        "name" : "AWS",
        "item" : "https://aws.amazon.com"
      },
      {
        "@type" : "ListItem",
        "position" : 2,
        "name" : "AWS CloudFormation",
        "item" : "https://docs.aws.amazon.com/cloudformation/index.html"
      },
      {
        "@type" : "ListItem",
        "position" : 3,
        "name" : "使用者指南",
        "item" : "https://docs.aws.amazon.com/zh_tw/AWSCloudFormation/latest/UserGuide"
      },
      {
        "@type" : "ListItem",
        "position" : 4,
        "name" : "使用 AWS CloudFormation 範本",
        "item" : "https://docs.aws.amazon.com/zh_tw/AWSCloudFormation/latest/UserGuide/template-guide.html"
      },
      {
        "@type" : "ListItem",
        "position" : 5,
        "name" : "演練",
        "item" : "https://docs.aws.amazon.com/zh_tw/AWSCloudFormation/latest/UserGuide/CHAP_Using.html"
      },
      {
        "@type" : "ListItem",
        "position" : 6,
        "name" : "逐步解說：使用 AWS CloudFormation 設計工具來修改堆疊的範本",
        "item" : "https://docs.aws.amazon.com/zh_tw/AWSCloudFormation/latest/UserGuide/CHAP_Using.html"
      }
    ]
}
</script></head><body><div id="main"><div style="display: none"></div><div id="breadcrumbs" class="breadcrumb"><a href="https://aws.amazon.com">AWS</a><a href="/index.html">文件</a><a href="/cloudformation/index.html">AWS CloudFormation</a><a href="Welcome.html">使用者指南</a></div><div id="page-toc-src"><a href="#working-with-templates-cfn-designer-walkthrough-updatebasicwebserver-get-template">步驟 1：取得堆疊範本</a><a href="#working-with-templates-cfn-designer-walkthrough-updatebasicwebserver-modify-template">步驟 2：修改範本</a><a href="#working-with-templates-cfn-designer-walkthrough-updatebasicwebserver-update-stack">步驟 3：更新堆疊</a><a href="#working-with-templates-cfn-designer-walkthrough-updatebasicwebserver-delete-stack">步驟 4：清除資源</a></div><div id="main-content" class="awsui-util-container"><div id="main-col-body"><awsdocs-language-banner data-service="$ctrl.pageService"></awsdocs-language-banner><awsui-alert class="awsdocs-page-banner awsui-util-mb-l"><p>本文為英文版的機器翻譯版本，如內容有任何歧義或不一致之處，概以英文版為準。</p></awsui-alert><h1 class="topictitle" id="working-with-templates-cfn-designer-walkthrough-updatebasicwebserver">逐步解說：使用 AWS CloudFormation 設計工具來修改堆疊的範本</h1><div class="awsdocs-page-header-container"><awsdocs-page-header></awsdocs-page-header><awsdocs-filter-selector id="awsdocs-filter-selector"></awsdocs-filter-selector></div><p>您可以使用 AWS CloudFormation 設計工具修改堆疊的範本，然後將範本提交給 AWS CloudFormation 以更新堆疊。通常，當您修改堆疊時，您需要取得其範本的複本，在文字編輯器中修改範本，然後使用 CloudFormation 來更新堆疊。您可以使用 AWS CloudFormation 設計工具快速取得任何執行中堆疊之範本的複本，修改複本，然後在同一個主控台更新堆疊。</p><p>在此演練中，我們將從<a href="./working-with-templates-cfn-designer-walkthrough-createbasicwebserver.html">基本 Web 伺服器</a>堆疊開始，然後修改它，使 Web 伺服器可擴展且安全耐久。</p><p>在此演練期間，我們將完成以下步驟：</p><div class="orderedlist">
     
     
     
     
  <ol><li>
      <p><a href="#working-with-templates-cfn-designer-walkthrough-updatebasicwebserver-get-template">取得堆疊的範本</a>。</p>
      <p>我們將取得執行中堆疊之範本的範本，與以下逐步解說中相同的基本 Web 伺服器堆疊：<a href="./working-with-templates-cfn-designer-walkthrough-createbasicwebserver.html">演練：使用 AWS CloudFormation 設計工具來建立基本 Web 伺服器</a>。</p>
    </li><li>
      <p><a href="#working-with-templates-cfn-designer-walkthrough-updatebasicwebserver-modify-template">修改範本</a>。</p>
      <p>我們將使用 AWS CloudFormation 設計工具修改堆疊的範本，以 Auto Scaling 群組和 Elastic Load Balancing 負載平衡器取代 EC2 執行個體，讓您的網站可擴展且安全耐久。</p>
    </li><li>
      <p><a href="#working-with-templates-cfn-designer-walkthrough-updatebasicwebserver-update-stack">更新堆疊</a></p>
      <p>儲存修改之後，我們將以修改後的範本更新基本 Web 伺服器堆疊。</p>
      <div class="awsdocs-note"><div class="awsdocs-note-title"><awsui-icon name="status-info" variant="link"></awsui-icon><h6>注意</h6></div><div class="awsdocs-note-text"><p>CloudFormation 這是一項免費服務；但是，您需要按照每個服務的當前費率向您收取包含在堆棧中的AWS資源費用。如需有關 AWS 定價的詳細資訊，請參閱 <a href="https://aws.amazon.com/" rel="noopener noreferrer" target="_blank"><span>http://aws.amazon.com</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a> 上各項產品的詳細資訊頁面。</p></div></div>
    </li><li>
      <p><a href="#working-with-templates-cfn-designer-walkthrough-updatebasicwebserver-delete-stack">刪除堆疊</a></p>
      <p>我們將刪除堆疊以清除所有資源。</p>
    </li></ol></div><p>必要條件</p><p>本逐步解說假設您具備 Amazon 虛擬私有雲 (Amazon VPC)、Auto Scaling、Elastic Load Balancing 和 CloudFormation. 在內容方面，每個程序都提供各項資源的一些基本資訊。</p><p>另外，此逐步解說假設您已完成以下逐步解說：<a href="./working-with-templates-cfn-designer-walkthrough-createbasicwebserver.html">演練：使用 AWS CloudFormation 設計工具來建立基本 Web 伺服器</a>。透過該逐步解說，您應已擁有名為 <code class="code">BasicWebServerStack</code> 的執行中堆疊。</p><h2 id="working-with-templates-cfn-designer-walkthrough-updatebasicwebserver-get-template">步驟 1：取得堆疊範本</h2>
    
    <p>在此步驟中，我們將使用 AWS CloudFormation 設計工具取得並開啟執行中堆疊之範本的複本。</p>
    <div class="procedure"><h6>取得執行中堆疊之範本的副本</h6><ol><li>
        <p><a href="https://console.aws.amazon.com/cloudformation/" rel="noopener noreferrer" target="_blank"><span>請在以下位置開啟 CloudFormation 主控台。</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a> https://console.aws.amazon.com/cloudformation/</p>
      </li><li>
        <p>從堆疊清單中，選擇 <code class="code">BasicWebServerStack</code>。</p>
      </li><li>
        <p>選擇 <b>Actions (動作)</b>，然後選擇 <b>View/Edit template in Designer (在設計工具中檢視/編輯範本)</b>。</p>
      </li></ol></div>
    <p>CloudFormation 取得<code class="code">BasicWebServerStack</code>堆疊範本的副本，並將其顯示在 AWS CloudFormation Designer 中，您可以在其中檢視範本資源及其關聯性。在以下步驟中，我們將使用 AWS CloudFormation 設計工具修改範本。</p>
  <h2 id="working-with-templates-cfn-designer-walkthrough-updatebasicwebserver-modify-template">步驟 2：修改範本</h2>
    
    <p>我們將使用AWS CloudFormation設計師的 drag-and-drop 界面和整合的 JSON 和 YAML 編輯器來修改基本 Web 伺服器範本，將單一 Amazon EC2 執行個體取代為 Auto Scaling 展群組和負載平衡器，以使網站具有可擴展性。如果網站流量突然增加，請使用 Auto Scaling 快速增加 Web 伺服器的數量。負載平衡器將在您的執行個體之間平均分配流量。</p>
    <div class="procedure"><h6>修改堆疊範本</h6><ol><li>
        <p>移除 <code class="code">WebServerInstance</code> 資源。</p>
        <ol><li>
            <p>在 <code class="code">WebServerInstance</code> 資源上按一下滑鼠右鍵。</p>
          </li><li>
            <p>從資源選單中，選擇 <b>Delete (刪除)</b> (<span class="inlinemediaobject">
                 
                  <img src="images/designer-resourcemenu-delete.png" class="aws-docs-img-whiteBg aws-docs-img-xs-padding" />
                 
              </span>)。</p>
          </li><li>
            <p>選擇 <b>OK (確定)</b> 以確認。</p>
          </li></ol>
      </li><li>
        <p>從 [資<b>源類型</b>] 窗格中，將下列資<code class="code">PublicSubnet</code>源新增至資源：<b>AutoScalingGroup<b>LaunchConfiguration</b></b>、和<b>LoadBalancer</b>。在新增資源之前，您可能需要擴展子網路以包含所有資源。</p>
        <p>資源會依資源類別來組織。Auto Scaling 群組和啟動組態位於<b>AutoScaling</b>類別中，而負載平衡器位於該<b>ElasticLoadBalancing</b>類別中。</p>
        <div class="awsdocs-note"><div class="awsdocs-note-title"><awsui-icon name="status-info" variant="link"></awsui-icon><h6>注意</h6></div><div class="awsdocs-note-text"><p>這些資源不會遵循容器模型，所以 AWS CloudFormation 設計工具不會自動將它們與子網路關聯。我們稍後會在此步驟中建立連線。</p></div></div>
      </li><li>
        <p>從 <b>EC2</b> 類別的 [<b>資源類型</b>] 窗格中，將<b>SecurityGroup</b>資源新增至 VPC 中的任何位置 (子網路除外)。</p>
        <p>此安全群組將控制負載平衡器的傳入和傳出流量。</p>
      </li><li>
        <p>重新命名資源，讓它們更容易地識別：</p>
        <div class="itemizedlist">
           
           
           
           
        <ul class="itemizedlist"><li class="listitem">
            <p>重新命名 <b>AutoScalingGroup</b> 為 <code class="code">WebServerFleet</code>。</p>
          </li><li class="listitem">
            <p>重新命名 <b>LaunchConfiguration</b> 為 <code class="code">WebServerLaunchConfig</code>。</p>
          </li><li class="listitem">
            <p>重新命名 <b>LoadBalancer</b> 為 <code class="code">PublicElasticLoadBalancer</code>。</p>
          </li><li class="listitem">
            <p>重新命名 <b>SecurityGroup</b> 為 <code class="code">PublicLoadBalancerSecurityGroup</code>。</p>
          </li></ul></div>
      </li><li>
        <p>為您新增的資源建立關聯。</p>
        <ol><li>
            <p>建立負載平衡器及 Auto Scaling 群組資源與公有子網路的關聯：</p>
            <div class="itemizedlist">
               
               
            <ul class="itemizedlist"><li class="listitem">
                <p>從 <code class="code">PublicElasticLoadBalancer</code> 資源，將 <code class="code">AWS::EC2::Subnet (Property: Subnets)</code> 連線拖曳至 <code class="code">PublicSubnet</code> 資源。</p>
              </li><li class="listitem">
                <p>從 <code class="code">WebServerFleet</code> 資源，將 <code class="code">AWS::EC2::Subnet (Property: VPCZoneIdentifier)</code> 連線拖曳至 <code class="code">PublicSubnet</code> 資源。</p>
              </li></ul></div>
          </li><li>
            <p>建立負載平衡器與其安全群組的關聯：</p>
            <div class="itemizedlist">
               
            <ul class="itemizedlist"><li class="listitem">
                <p>從 <code class="code">PublicElasticLoadBalancer</code> 資源，將 <code class="code">AWS::EC2::SecurityGroup (Property:
                    SecurityGroups)</code> 連線拖曳至 <code class="code">PublicLoadBalancerSecurityGroup</code> 資源。</p>
              </li></ul></div>
          </li><li>
            <p>建立 Auto Scaling 群組與負載平衡器及啟動組態的關聯：</p>
            <div class="itemizedlist">
               
               
            <ul class="itemizedlist"><li class="listitem">
                <p>從 <code class="code">WebServerFleet</code> 資源，將 <code class="code">AWS::ElasticLoadBalancing::LoadBalancer (Property:
                    LoadBalancerNames)</code> 連線拖曳至 <code class="code">PublicElasticLoadBalancer</code> 資源。</p>
              </li><li class="listitem">
                <p>從 <code class="code">WebServerFleet</code> 資源，將 <code class="code">AWS::ElasticLoadBalancing::LaunchConfiguration
                    (Property: LaunchConfigurationName)</code> 連線拖曳至 <code class="code">WebServerLaunchConfig</code> 資源。</p>
              </li></ul></div>
          </li><li>
            <p>建立啟動組態與安全群組的關聯：</p>
            <div class="itemizedlist">
               
            <ul class="itemizedlist"><li class="listitem">
                <p>從 <code class="code">WebServerLaunchConfig</code> 資源，將 <code class="code">AWS::EC2::SecurityGroup (Property:
                    SecurityGroups)</code> 連線拖曳至 <code class="code">WebServerSecurityGroup</code> 資源。</p>
              </li></ul></div>
          </li><li>
            <p>定義 Auto Scaling 群組對公有路由的相依性：</p>
            <div class="itemizedlist">
               
            <ul class="itemizedlist"><li class="listitem">
                <p>從 <code class="code">WebServerFleet</code> 資源，將 <code class="code">DependsOn</code> 連線拖曳至 <code class="code">PublicRoute</code> 資源。</p>
              </li></ul></div>
            <p>這種依賴性 CloudFormation 意味著在公共路由完成之前不會創建<code class="code">WebServerFleet</code>資源。否則，如果在 Web 服務器實例啟動時公共路由不可用，則它們將無法發送信號（使用 cfn-signal 幫助程序腳本）以在其配置和應用程序部署完成 CloudFormation 時通知。</p>
          </li></ol>
      </li><li>
        <p>指定您新增資源的屬性。</p>
        <ol><li>
            <p>在 AWS CloudFormation 設計工具畫布中，選擇 <code class="code">PublicElasticLoadBalancer</code> 資源。</p>
          </li><li>
            <p>在整合式編輯器窗格中，選擇 <b>Properties (屬性)</b> 標籤，然後複製以下程式碼片段並貼在 <b>Properties (屬性)</b> 大括號 (<code class="code"><span>{</span>}</code>) 之間。</p>
            <p>AWS CloudFormation 設計工具已自動新增安全群組與子網路的關聯，因此您只需新增 <code class="code">Listeners</code> 與 <code class="code">HealthCheck</code> 屬性。<code class="code">Listeners</code> 屬性指定要監聽哪裡的哪種流量類型，<code class="code">HealthCheck</code> 屬性則描述用於判斷負載平衡器運作狀態的設定。</p>
            <p>JSON</p>
            <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="複製"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><b>          "Listeners": [
          <span>{</span>
            "LoadBalancerPort": "80",
            "InstancePort": "80",
            "Protocol": "HTTP"
          }
        ],
        "HealthCheck": <span>{</span>
          "Target": "HTTP:80/",
          "HealthyThreshold": "3",
          "UnhealthyThreshold": "5",
          "Interval": "90",
          "Timeout": "60"
        },</b>
        "SecurityGroups": [
          <span>{</span>
            "Ref": "PublicLoadBalancerSecurityGroup"
          }
        ],
        "Subnets": [
          <span>{</span>
            "Ref": "PublicSubnet"
          }
        ]</code></pre>

            <p>YAML</p>
            <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="複製"><awsui-icon name="copy"></awsui-icon></div></div><code class="yaml "><b>      Listeners:
        - LoadBalancerPort: '80'
          InstancePort: '80'
          Protocol: HTTP
      HealthCheck:
        Target: 'HTTP:80/'
        HealthyThreshold: '3'
        UnhealthyThreshold: '5'
        Interval: '90'
        Timeout: '60'</b>
      SecurityGroups:
        - !Ref PublicLoadBalancerSecurityGroup
      Subnets:
        - !Ref PublicSubnet</code></pre>
          </li><li>
            <p>針對下列資源重複這個程序：</p>
            <div class="variablelist">
               
               
               
               
            <dl>
                <dt><span class="term"><code class="code">WebServerFleet</code></span></dt>
                <dd>
                  <p>新增 <code class="code">MaxSize</code>、<code class="code">MinSize</code> 和 <code class="code">DesiredCapacity</code> 屬性。這些屬性指定您可在 Auto Scaling 群組中啟動的執行個體最大和最小數量，以及啟動的執行個體初始數量。所需的容量數值是指新的參數，我們將在此程序稍後新增。</p>
                  <p>JSON</p>
                  <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="複製"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><b>        "MinSize": "1",
        "MaxSize": "10",
        "DesiredCapacity": <span>{</span>
          "Ref": "WebServerCount"
        },</b>
        "VPCZoneIdentifier": [
          <span>{</span>
            "Ref": "PublicSubnet"
          }
        ],
        "LaunchConfigurationName": <span>{</span>
          "Ref": "WebServerLaunchConfig"
        },
        "LoadBalancerNames": [
          <span>{</span>
            "Ref": "PublicElasticLoadBalancer"
          }
        ]</code></pre>
                  <p>YAML</p>
                  <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="複製"><awsui-icon name="copy"></awsui-icon></div></div><code class="yaml "><b>      MinSize: '1'
      MaxSize: '10'
      DesiredCapacity: !Ref WebServerCount</b>
      VPCZoneIdentifier:
        - !Ref PublicSubnet
      LaunchConfigurationName: !Ref WebServerLaunchConfig
      LoadBalancerNames:
        - !Ref PublicElasticLoadBalancer</code></pre>
                </dd>
               
                <dt><span class="term"><code class="code">PublicLoadBalancerSecurityGroup</code></span></dt>
                <dd>
                  <p>新增以下傳入和傳出規則，以判斷可到達與離開負載平衡器的流量。這些規則可讓所有 HTTP 流量到達及離開負載平衡器。</p>
                  <p>JSON</p>
                  <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="複製"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><b>        "GroupDescription": "Public Elastic Load Balancing security group with HTTP access on port 80 from the Internet",
        "SecurityGroupIngress": [
          <span>{</span>
            "IpProtocol": "tcp",
            "FromPort": 80,
            "ToPort": 80,
            "CidrIp": "0.0.0.0/0"
          }
        ],
        "SecurityGroupEgress": [
          <span>{</span>
            "IpProtocol": "tcp",
            "FromPort": 80,
            "ToPort": 80,
            "CidrIp": "0.0.0.0/0"
          }
        ],</b>
        "VpcId": <span>{</span>
          "Ref": "VPC"
        }</code></pre>

                  <p>YAML</p>
                  <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="複製"><awsui-icon name="copy"></awsui-icon></div></div><code class="yaml "><b>      GroupDescription: &gt;-
        Public Elastic Load Balancing security group with HTTP access on port 80
        from the Internet
      SecurityGroupIngress:
        - IpProtocol: tcp
          FromPort: 80
          ToPort: 80
          CidrIp: 0.0.0.0/0
      SecurityGroupEgress:
        - IpProtocol: tcp
          FromPort: 80
          ToPort: 80
          CidrIp: 0.0.0.0/0</b>
      VpcId: !Ref VPC</code></pre>
                </dd>
               
                <dt><span class="term"><code class="code">WebServerSecurityGroup</code></span></dt>
                <dd>
                  <p>修改 HTTP 傳入規則，僅允許來自負載平衡器的流量。</p>
                  <p>JSON</p>
                  <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="複製"><awsui-icon name="copy"></awsui-icon></div></div><code class="json ">        "GroupDescription": "Allow access from load balancer and SSH traffic",
        "SecurityGroupIngress": [
          <span>{</span>
            "IpProtocol": "tcp",
            "FromPort": 80,
            "ToPort": 80,
<b>            "SourceSecurityGroupId": <span>{</span>
              "Ref": "PublicLoadBalancerSecurityGroup"
            }</b>
          },
          <span>{</span>
            "IpProtocol": "tcp",
            "FromPort": 22,
            "ToPort": 22,
            "CidrIp": <span>{</span>
              "Ref": "SSHLocation"
            }
          }
        ],
        "VpcId": <span>{</span>
          "Ref": "VPC"
        }</code></pre>
                  <p>YAML</p>
                  <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="複製"><awsui-icon name="copy"></awsui-icon></div></div><code class="yaml ">      VpcId: !Ref VPC
      GroupDescription: Allow access from load balancer and SSH traffic
      SecurityGroupIngress:
        - IpProtocol: tcp
          FromPort: 80
          ToPort: 80
          <b>SourceSecurityGroupId: !Ref PublicLoadBalancerSecurityGroup</b>
        - IpProtocol: tcp
          FromPort: 22
          ToPort: 22
          CidrIp: !Ref SSHLocation</code></pre>
                </dd>
               
                <dt><span class="term"><code class="code">WebServerLaunchConfig</code></span></dt>
                <dd>
                  <p>啟動組態有多種您必須指定的不同屬性，因此我們將僅說明其中幾個屬性。<code class="code">InstanceType</code> 和 <code class="code">ImageId</code> 屬性會使用我們在範本中指定的參數和對應值。在建立堆疊時，您可以將執行個體類型指定為參數值。<code class="code">ImageId</code> 值為映射項目，其會以您的堆疊區域及您指定的執行個體類型為依據。</p>
                  <p>在 <code class="code">UserData</code> 屬性中，我們會指定要在執行個體啟動與執行之後執行的組態指令碼。執行個體的中繼資料定義組態資訊；我們會在下一個步驟中新增此中繼資料。</p>
                  <p>JSON</p>
                  <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="複製"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><b>        "InstanceType": <span>{</span>
          "Ref": "InstanceType"
        },
        "ImageId": <span>{</span>
          "Fn::FindInMap": [
            "AWSRegionArch2AMI",
            <span>{</span>
              "Ref": "AWS::Region"
            },
            <span>{</span>
              "Fn::FindInMap": [
                "AWSInstanceType2Arch",
                <span>{</span>
                  "Ref": "InstanceType"
                },
                "Arch"
              ]
            }
          ]
        },
        "KeyName": <span>{</span>
          "Ref": "KeyName"
        },
        "AssociatePublicIpAddress": "true",
        "UserData": <span>{</span>
          "Fn::Base64": <span>{</span>
            "Fn::Join": [
              "",
              [
                "#!/bin/bash -xe\n",
                "yum install -y aws-cfn-bootstrap\n",
                "# Install the files and packages from the metadata\n",
                "/opt/aws/bin/cfn-init -v ",
                "         --stack ",
                <span>{</span>
                  "Ref": "AWS::StackName"
                },
                "         --resource WebServerLaunchConfig ",
                "         --configsets All ",
                "         --region ",
                <span>{</span>
                  "Ref": "AWS::Region"
                },
                "\n",
                "# Signal the status from cfn-init\n",
                "/opt/aws/bin/cfn-signal -e $? ",
                "         --stack ",
                <span>{</span>
                  "Ref": "AWS::StackName"
                },
                "         --resource WebServerFleet ",
                "         --region ",
                <span>{</span>
                  "Ref": "AWS::Region"
                },
                "\n"
              ]
            ]
          }
        },</b>
        "SecurityGroups": [
          <span>{</span>
            "Ref": "WebServerSecurityGroup"
          }
        ]</code></pre>
                  <p>YAML</p>
                  <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="複製"><awsui-icon name="copy"></awsui-icon></div></div><code class="yaml "><b>      InstanceType: !Ref InstanceType
      ImageId: !FindInMap 
        - AWSRegionArch2AMI
        - !Ref 'AWS::Region'
        - !FindInMap 
          - AWSInstanceType2Arch
          - !Ref InstanceType
          - Arch
      KeyName: !Ref KeyName
      AssociatePublicIpAddress: 'true'
      UserData: !Base64 
        'Fn::Join':
          - ''
          - - |
              #!/bin/bash -xe
            - |
              yum install -y aws-cfn-bootstrap
            - |
              # Install the files and packages from the metadata
            - '/opt/aws/bin/cfn-init -v '
            - '         --stack '
            - !Ref 'AWS::StackName'
            - '         --resource WebServerLaunchConfig '
            - '         --configsets All '
            - '         --region '
            - !Ref 'AWS::Region'
            - |+

            - |
              # Signal the status from cfn-init
            - '/opt/aws/bin/cfn-signal -e $? '
            - '         --stack '
            - !Ref 'AWS::StackName'
            - '         --resource WebServerFleet '
            - '         --region '
            - !Ref 'AWS::Region'
            - |+</b>

      SecurityGroups:
        - !Ref WebServerSecurityGroup</code></pre>
                </dd>
              </dl></div>
          </li></ol>
      </li><li>
        <p>將啟動組態中繼資料新增至 <code class="code">WebServerLaunchConfig</code> 資源，以指示 cfn-init 協助程式指令碼啟動 Web 伺服器並建立基本網頁。</p>
        <ol><li>
            <p>選擇 <code class="code">WebServerLaunchConfig</code> 資源，然後選擇整合式編輯器中的 <b>Metadata (中繼資料)</b> 標籤。</p>
          </li><li>
            <p><em>如果您是以 JSON 編寫範本</em>：請在 <code class="code">AWS::CloudFormation::Designer</code> 右大括號之後的 <code class="code">Metadata</code> 大括號 (<code class="code"><span>{</span>}</code>) 內，新增逗號 (<code class="code">,</code>)。</p>
          </li><li>
            <p>將下列程式碼片段新增至 <code class="code">AWS::CloudFormation::Designer</code> 屬性之後，以指示 cfn-init 協助程式指令碼啟動 Web 伺服器並建立基本網頁。</p>
            <p>JSON</p>
            <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="複製"><awsui-icon name="copy"></awsui-icon></div></div><code class="json ">        "AWS::CloudFormation::Init" : <span>{</span>
          "configSets" : <span>{</span>
            "All" : [ "ConfigureSampleApp" ]
          },
          "ConfigureSampleApp" : <span>{</span>
            "packages" : <span>{</span>
              "yum" : <span>{</span>
                "httpd" : []
              }
            },
            "files" : <span>{</span>
              "/var/www/html/index.html" : <span>{</span>
                "content" : <span>{</span> "Fn::Join" : ["\n", [
                  "&lt;h1&gt;Congratulations, you have successfully launched the AWS CloudFormation sample.&lt;/h1&gt;"
                ]]},
                "mode"    : "000644",
                "owner"   : "root",
                "group"   : "root"
              }
            },
            "services" : <span>{</span>
              "sysvinit" : <span>{</span>
                "httpd"    : <span>{</span> "enabled" : "true", "ensureRunning" : "true" }
              }
            }
          }
        }</code></pre>
            <p>YAML</p>
            <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="複製"><awsui-icon name="copy"></awsui-icon></div></div><code class="yaml ">      'AWS::CloudFormation::Init':
        configSets:
          All:
            - ConfigureSampleApp
        ConfigureSampleApp:
          packages:
            yum:
              httpd: []
          files:
            /var/www/html/index.html:
              content: !Join 
                - |+

                - - &gt;-
                    &lt;h1&gt;Congratulations, you have successfully launched the AWS
                    CloudFormation sample.&lt;/h1&gt;
              mode: '000644'
              owner: root
              group: root
          services:
            sysvinit:
              httpd:
                enabled: 'true'
                ensureRunning: 'true'</code></pre>
          </li></ol>
      </li><li>
        <p>新增 <code class="code">WebServerCount</code> 參數。此參數指定建 CloudFormation 立「Auto Scaling 例」群組時要建立的例證數目。</p>
        <ol><li>
            <p>選取 AWS CloudFormation 設計工具畫布上的開放區域。</p>
          </li><li>
            <p>在整合式編輯器窗格中，選擇 <b>Parameters (參數)</b> 標籤。</p>
          </li><li>
            <p>在 整合式編輯器 中，新增以下參數。如果您是以 JSON 編寫範本，請視需要新增逗號。</p>
            <p>JSON</p>
            <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="複製"><awsui-icon name="copy"></awsui-icon></div></div><code class="json ">    "WebServerCount": <span>{</span>
      "Description": "Number of Amazon EC2 instances to launch for the WebServer server",
      "Type": "Number",
      "Default": "1"
    }</code></pre>
            <p>YAML</p>
            <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="複製"><awsui-icon name="copy"></awsui-icon></div></div><code class="yaml ">  WebServerCount:
    Description: Number of Amazon EC2 instances to launch for the WebServer server
    Type: Number
    Default: '1'</code></pre>
          </li></ol>
      </li><li>
        <p>修改範本輸出以顯示負載平衡器的 DNS 名稱。</p>
        <ol><li>
            <p>在整合式編輯器窗格中，選擇 <b>Outputs (輸出)</b> 標籤。</p>
          </li><li>
            <p>如以下程式碼片段所示，修改 JSON 以使用負載平衡器 DNS 名稱。</p>
            <p>JSON</p>
            <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="複製"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
  "Outputs": <span>{</span>
    "URL": <span>{</span>
      "Value": <span>{</span>
<b>        "Fn::GetAtt": [
          "PublicElasticLoadBalancer",
          "DNSName"
        ]</b>
      },
      "Description": "Newly created application URL"
    }
  }
}</code></pre>
            <p>如果您是以 YAML 編寫範本，請使用下列程式碼片段。</p>
            <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="複製"><awsui-icon name="copy"></awsui-icon></div></div><code class="yaml ">Outputs:
  URL:
    Value: !GetAtt 
      - PublicElasticLoadBalancer
      - DNSName
    Description: Newly created application URL</code></pre>
          </li></ol>
      </li><li>
        <p>在 AWS CloudFormation 設計工具工具列上，選擇 <b>Validate template</b> (驗證範本) (<span class="inlinemediaobject">
             
              <img src="images/designer-validate-icon.png" class="aws-docs-img-whiteBg aws-docs-img-xs-padding" />
             
          </span>) 檢查範本中的語法錯誤。</p>
        <p>在 <b>Messages</b> (訊息) 窗格中檢視並修復錯誤，接著再次驗證範本。如果您沒有看到錯誤，表示該範本的語法有效。</p>
      </li><li>
        <p>從 AWS CloudFormation 設計工具工具列中，選擇 <b>File</b> (檔案) (<span class="inlinemediaobject">
             
              <img src="images/designer-file-menu.png" class="aws-docs-img-whiteBg aws-docs-img-xs-padding" />
             
          </span>)，然後選擇 <b>Save</b> (儲存)，將範本儲存於本機。</p>
      </li></ol></div>
    <p>您現在有一個修改過的 CloudFormation 範本，可用來更新基本 Web 伺服器堆疊。在下個步驟中，我們將使用此範本來更新基本 Web 伺服器堆疊。</p>
   
   <h2 id="working-with-templates-cfn-designer-walkthrough-updatebasicwebserver-update-stack">步驟 3：更新堆疊</h2>
    <p>若要實作您的範本變更，我們需要更新基本 Web 伺服器堆疊。您可以直接從 AWS CloudFormation Designer 啟動 CloudFormation 更新堆疊精靈。</p>
    <div class="procedure"><h6>更新堆疊</h6><ol><li>
        <p>在 AWS CloudFormation 設計工具工具列中，選擇 <b>Create Stack</b> (建立堆疊) (<span class="inlinemediaobject">
             
              <img src="images/designer-create-stack-icon.png" class="aws-docs-img-whiteBg aws-docs-img-xs-padding" />
             
          </span>)。</p>
        <p>AWS CloudFormation設計師將開啟的範本儲存在 S3 儲存貯體中，然後啟動 CloudFormation 更新堆疊精靈。因為我們修改了<code class="code">BasicWebServerStack</code>堆疊的範本，所以會 CloudFormation 啟動該堆疊的「更新堆疊精靈」。</p>
      </li><li>
        <p>CloudFormation 會自動填入範本 URL；選擇「<b>下一步</b>」。</p>
      </li><li>
        <p>在 <b>Stack</b> (堆疊) 區段的 <b>Name</b> (名稱) 欄位中，確認堆疊名稱為 <code class="code">BasicWebServerStack</code>。</p>
      </li><li>
        <p>在 <b>Parameters</b> (參數) 區段中，使用現有的值；選擇 <b>Next</b> (下一步)。</p>
      </li><li>
        <p>在此逐步解說中，您不需要新增標籤或指定進階設定，因此請選擇 <b>Next (下一步)</b>。</p>
      </li><li>
        <p>確定堆疊名稱正確，然後選擇 <b>Update (更新)</b>。</p>
      </li></ol></div>
    <p>更新堆疊可能需 CloudFormation 要幾分鐘的時間。若要監控進度，請檢視堆疊事件。如需詳細資訊，請參閱 <a href="./cfn-console-view-stack-data-resources.html">檢視 AWS CloudFormation 堆疊資料和資源 AWS Management Console</a>。更新堆疊之後，請檢視堆疊輸出並前往網站的 URL，以驗證網站是否正在執行。如需詳細資訊，請參閱 <a href="./cfn-console-view-stack-data-resources.html">檢視 AWS CloudFormation 堆疊資料和資源 AWS Management Console</a>。您已使用 AWS CloudFormation 設計工具成功更新範本和堆疊。</p>
    <p>為了確保您不需要為不必要的服務支付費用，您可以刪除堆疊。</p>
   
   <h2 id="working-with-templates-cfn-designer-walkthrough-updatebasicwebserver-delete-stack">步驟 4：清除資源</h2>
    
    <p>為避免您為不需要的服務支付費用，請刪除您的堆疊及其資源。</p>
    <div class="procedure"><h6>刪除堆疊</h6><ol><li>
        <p>從主 CloudFormation 控台選擇<b>BasicWebServerStack</b>堆疊。</p>
      </li><li>
        <p>選擇 <b>Delete Stack (刪除堆疊)</b>。</p>
      </li><li>
        <p>在確認訊息中，選擇 <b>Yes, Delete (是，刪除)</b>。</p>
      </li></ol></div>
    <p>刪除堆疊可能需 CloudFormation 要幾分鐘的時間。若要監控進度，請檢視堆疊事件。刪除堆疊後，會一併刪除您建立的所有資源。現在您已了解如何使用 AWS CloudFormation 設計工具，您可以使用它來建置和修改自己的範本。</p>
  <awsdocs-copyright class="copyright-print"></awsdocs-copyright><awsdocs-thumb-feedback right-edge="{{$ctrl.thumbFeedbackRightEdge}}"></awsdocs-thumb-feedback></div><noscript><div><div><div><div id="js_error_message"><p><img src="https://d1ge0kk1l5kms0.cloudfront.net/images/G/01/webservices/console/warning.png" alt="警告" /> <strong>您的瀏覽器已停用或無法使用 Javascript。</strong></p><p>您必須啟用 Javascript，才能使用 AWS 文件。請參閱您的瀏覽器說明頁以取得說明。</p></div></div></div></div></noscript><div id="main-col-footer" class="awsui-util-font-size-0"><div id="doc-conventions"><a target="_top" href="/general/latest/gr/docconventions.html">文件慣用形式</a></div><div class="prev-next"><div id="previous" class="prev-link" accesskey="p" href="./working-with-templates-cfn-designer-walkthrough-createbasicwebserver.html">演練：使用 AWS CloudFormation 設計工具來建立基本 Web 伺服器</div><div id="next" class="next-link" accesskey="n" href="./peer-with-vpc-in-another-account.html">與另一個帳戶中的 VPC 對等</div></div></div><awsdocs-page-utilities></awsdocs-page-utilities></div><div id="quick-feedback-yes" style="display: none;"><div class="title">此頁面是否有幫助？ - 是</div><div class="content"><p>感謝您，讓我們知道我們做得很好！</p><p>若您有空，歡迎您告知我們值得讚許的地方，這樣才能保持良好服務。</p><p><awsui-button id="fblink" rel="noopener noreferrer" target="_blank" text="意見回饋" click="linkClick($event)" href="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=CloudFormation&amp;topic_url=https://docs.aws.amazon.com/zh_tw/AWSCloudFormation/latest/UserGuide/working-with-templates-cfn-designer-walkthrough-updatebasicwebserver.html"></awsui-button></p></div></div><div id="quick-feedback-no" style="display: none;"><div class="title">此頁面是否有幫助？ - 否</div><div class="content"><p>感謝讓我們知道此頁面仍須改善。很抱歉，讓您失望。</p><p>若您有空，歡迎您提供改善文件的方式。</p><p><awsui-button id="fblink" rel="noopener noreferrer" target="_blank" text="意見回饋" click="linkClick($event)" href="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=CloudFormation&amp;topic_url=https://docs.aws.amazon.com/zh_tw/AWSCloudFormation/latest/UserGuide/working-with-templates-cfn-designer-walkthrough-updatebasicwebserver.html"></awsui-button></p></div></div></div></body></div></awsdocs-view><div class="page-loading-indicator" id="page-loading-indicator"><awsui-spinner size="large"></awsui-spinner></div></div><div id="tools-panel" dom-region="tools"><awsdocs-tools-panel id="awsdocs-tools-panel"></awsdocs-tools-panel></div></awsui-app-layout><awsdocs-cookie-banner class="doc-cookie-banner"></awsdocs-cookie-banner></div></body></html>