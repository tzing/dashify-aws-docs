<!DOCTYPE html>
    <html xmlns="http://www.w3.org/1999/xhtml" lang="zh-TW"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>UpdatePolicy 屬性 - AWS CloudFormation</title><meta name="viewport" content="width=device-width,initial-scale=1" /><meta name="assets_root" content="/assets" /><meta name="target_state" content="aws-attribute-updatepolicy" /><meta name="default_state" content="aws-attribute-updatepolicy" /><link rel="icon" type="image/ico" href="/assets/images/favicon.ico" /><link rel="shortcut icon" type="image/ico" href="/assets/images/favicon.ico" /><link rel="canonical" href="https://docs.aws.amazon.com/zh_tw/AWSCloudFormation/latest/UserGuide/aws-attribute-updatepolicy.html" /><meta name="description" content="指定如何使用 UpdatePolicy 屬性處理下列資源的更新： AWS::AutoScaling::AutoScalingGroup、AWS::AutoScaling::AutoScalingGroup、AWS::ElastiCache::ReplicationGroup、AWS::OpenSearchService::Domain、AWS::Elasticsearch::Domain 或 AWS::Lambda::Alias。" /><meta name="deployment_region" content="IAD" /><meta name="product" content="AWS CloudFormation" /><meta name="guide" content="使用者指南" /><meta name="abstract" content="使 AWS CloudFormation 用本使用者指南可預測並重複地建立和管理 AWS 基礎架構部署。" /><meta name="guide-locale" content="zh_tw" /><meta name="tocs" content="toc-contents.json" /><link rel="canonical" href="https://docs.aws.amazon.com/zh_tw/AWSCloudFormation/latest/UserGuide/aws-attribute-updatepolicy.html" /><link rel="alternative" href="https://docs.aws.amazon.com/id_id/AWSCloudFormation/latest/UserGuide/aws-attribute-updatepolicy.html" hreflang="id-id" /><link rel="alternative" href="https://docs.aws.amazon.com/id_id/AWSCloudFormation/latest/UserGuide/aws-attribute-updatepolicy.html" hreflang="id" /><link rel="alternative" href="https://docs.aws.amazon.com/de_de/AWSCloudFormation/latest/UserGuide/aws-attribute-updatepolicy.html" hreflang="de-de" /><link rel="alternative" href="https://docs.aws.amazon.com/de_de/AWSCloudFormation/latest/UserGuide/aws-attribute-updatepolicy.html" hreflang="de" /><link rel="alternative" href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-attribute-updatepolicy.html" hreflang="en-us" /><link rel="alternative" href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-attribute-updatepolicy.html" hreflang="en" /><link rel="alternative" href="https://docs.aws.amazon.com/es_es/AWSCloudFormation/latest/UserGuide/aws-attribute-updatepolicy.html" hreflang="es-es" /><link rel="alternative" href="https://docs.aws.amazon.com/es_es/AWSCloudFormation/latest/UserGuide/aws-attribute-updatepolicy.html" hreflang="es" /><link rel="alternative" href="https://docs.aws.amazon.com/fr_fr/AWSCloudFormation/latest/UserGuide/aws-attribute-updatepolicy.html" hreflang="fr-fr" /><link rel="alternative" href="https://docs.aws.amazon.com/fr_fr/AWSCloudFormation/latest/UserGuide/aws-attribute-updatepolicy.html" hreflang="fr" /><link rel="alternative" href="https://docs.aws.amazon.com/it_it/AWSCloudFormation/latest/UserGuide/aws-attribute-updatepolicy.html" hreflang="it-it" /><link rel="alternative" href="https://docs.aws.amazon.com/it_it/AWSCloudFormation/latest/UserGuide/aws-attribute-updatepolicy.html" hreflang="it" /><link rel="alternative" href="https://docs.aws.amazon.com/ja_jp/AWSCloudFormation/latest/UserGuide/aws-attribute-updatepolicy.html" hreflang="ja-jp" /><link rel="alternative" href="https://docs.aws.amazon.com/ja_jp/AWSCloudFormation/latest/UserGuide/aws-attribute-updatepolicy.html" hreflang="ja" /><link rel="alternative" href="https://docs.aws.amazon.com/ko_kr/AWSCloudFormation/latest/UserGuide/aws-attribute-updatepolicy.html" hreflang="ko-kr" /><link rel="alternative" href="https://docs.aws.amazon.com/ko_kr/AWSCloudFormation/latest/UserGuide/aws-attribute-updatepolicy.html" hreflang="ko" /><link rel="alternative" href="https://docs.aws.amazon.com/pt_br/AWSCloudFormation/latest/UserGuide/aws-attribute-updatepolicy.html" hreflang="pt-br" /><link rel="alternative" href="https://docs.aws.amazon.com/pt_br/AWSCloudFormation/latest/UserGuide/aws-attribute-updatepolicy.html" hreflang="pt" /><link rel="alternative" href="https://docs.aws.amazon.com/zh_cn/AWSCloudFormation/latest/UserGuide/aws-attribute-updatepolicy.html" hreflang="zh-cn" /><link rel="alternative" href="https://docs.aws.amazon.com/zh_tw/AWSCloudFormation/latest/UserGuide/aws-attribute-updatepolicy.html" hreflang="zh-tw" /><link rel="alternative" href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-attribute-updatepolicy.html" hreflang="x-default" /><meta name="feedback-item" content="CloudFormation" /><meta name="this_doc_product" content="AWS CloudFormation" /><meta name="this_doc_guide" content="使用者指南" /><script defer="" src="/assets/r/vendor4.js?version=2021.12.02"></script><script defer="" src="/assets/r/vendor3.js?version=2021.12.02"></script><script defer="" src="/assets/r/vendor1.js?version=2021.12.02"></script><script defer="" src="/assets/r/awsdocs-common.js?version=2021.12.02"></script><script defer="" src="/assets/r/awsdocs-doc-page.js?version=2021.12.02"></script><link href="/assets/r/vendor4.css?version=2021.12.02" rel="stylesheet" /><link href="/assets/r/awsdocs-common.css?version=2021.12.02" rel="stylesheet" /><link href="/assets/r/awsdocs-doc-page.css?version=2021.12.02" rel="stylesheet" /><script async="" id="awsc-panorama-bundle" type="text/javascript" src="https://prod.pa.cdn.uis.awsstatic.com/panorama-nav-init.js" data-config="{'appEntity':'aws-documentation','region':'us-east-1','service':'cloudformation'}"></script><meta id="panorama-serviceSubSection" value="使用者指南" /><meta id="panorama-serviceConsolePage" value="UpdatePolicy 屬性" /></head><body class="awsdocs awsui"><div class="awsdocs-container"><awsdocs-header></awsdocs-header><awsui-app-layout id="app-layout" class="awsui-util-no-gutters" ng-controller="ContentController as $ctrl" header-selector="awsdocs-header" navigation-hide="false" navigation-width="$ctrl.navWidth" navigation-open="$ctrl.navOpen" navigation-change="$ctrl.onNavChange($event)" tools-hide="$ctrl.hideTools" tools-width="$ctrl.toolsWidth" tools-open="$ctrl.toolsOpen" tools-change="$ctrl.onToolsChange($event)"><div id="guide-toc" dom-region="navigation"><awsdocs-toc></awsdocs-toc></div><div id="main-column" dom-region="content" tabindex="-1"><awsdocs-view class="awsdocs-view"><div id="awsdocs-content"><head><title>UpdatePolicy 屬性 - AWS CloudFormation</title><meta name="rss" content="aws-cloudformation-release-notes.rss" /><meta name="forums" content="http://forums.aws.amazon.com/forum.jspa?forumID=92" /><meta name="feedback" content="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=CloudFormation&amp;topic_url=https://docs.aws.amazon.com/zh_tw/AWSCloudFormation/latest/UserGuide/aws-attribute-updatepolicy.html" /><meta name="feedback-yes" content="feedbackyes.html?topic_url=https://docs.aws.amazon.com/zh_tw/AWSCloudFormation/latest/UserGuide/aws-attribute-updatepolicy.html" /><meta name="feedback-no" content="feedbackno.html?topic_url=https://docs.aws.amazon.com/zh_tw/AWSCloudFormation/latest/UserGuide/aws-attribute-updatepolicy.html" /><meta name="keywords" content="CloudFormation,AWSCloudFormation,資源佈建,資源組態,基礎設施管理,CloudFormer,CloudFormation 堆疊,CloudFormation 堆疊集,CloudFormation 範本,變更集合" /><script type="application/ld+json">
{
    "@context" : "https://schema.org",
    "@type" : "BreadcrumbList",
    "itemListElement" : [
      {
        "@type" : "ListItem",
        "position" : 1,
        "name" : "AWS",
        "item" : "https://aws.amazon.com"
      },
      {
        "@type" : "ListItem",
        "position" : 2,
        "name" : "AWS CloudFormation",
        "item" : "https://docs.aws.amazon.com/cloudformation/index.html"
      },
      {
        "@type" : "ListItem",
        "position" : 3,
        "name" : "使用者指南",
        "item" : "https://docs.aws.amazon.com/zh_tw/AWSCloudFormation/latest/UserGuide"
      },
      {
        "@type" : "ListItem",
        "position" : 4,
        "name" : "範本參考",
        "item" : "https://docs.aws.amazon.com/zh_tw/AWSCloudFormation/latest/UserGuide/template-reference.html"
      },
      {
        "@type" : "ListItem",
        "position" : 5,
        "name" : "資源屬性參考",
        "item" : "https://docs.aws.amazon.com/zh_tw/AWSCloudFormation/latest/UserGuide/aws-product-attribute-reference.html"
      },
      {
        "@type" : "ListItem",
        "position" : 6,
        "name" : "UpdatePolicy 屬性",
        "item" : "https://docs.aws.amazon.com/zh_tw/AWSCloudFormation/latest/UserGuide/aws-product-attribute-reference.html"
      }
    ]
}
</script></head><body><div id="main"><div style="display: none"></div><div id="breadcrumbs" class="breadcrumb"><a href="https://aws.amazon.com">AWS</a><a href="/index.html">文件</a><a href="/cloudformation/index.html">AWS CloudFormation</a><a href="Welcome.html">使用者指南</a></div><div id="page-toc-src"><a href="#aws-resource-update-policies">資源更新政策</a><a href="#aws-attribute-update-policy-app-stream-fleet">AppStream 2.0 更新政策</a><a href="#cfn-attributes-updatepolicy-replacingupdate">AutoScalingReplacingUpdate 政策</a><a href="#cfn-attributes-updatepolicy-rollingupdate">AutoScalingRollingUpdate 政策</a><a href="#cfn-attributes-updatepolicy-scheduledactions">AutoScalingScheduledAction 政策</a><a href="#cfn-attributes-updatepolicy-useonlineresharding">UseOnlineResharding 政策</a><a href="#cfn-attributes-updatepolicy-upgradeopensearchdomain">EnableVersionUpgrade 政策</a><a href="#cfn-attributes-updatepolicy-codedeploylambdaaliasupdate">CodeDeployLambdaAlias 更新政策</a><a href="#aws-attribute-updatepolicy-examples">範例</a></div><div id="page-filters" style="display:none"><filter label="All" id="All"></filter><filter label="JSON" id="JSON"></filter><filter label="YAML" id="YAML"></filter></div><div id="main-content" class="awsui-util-container"><div id="main-col-body"><awsdocs-language-banner data-service="$ctrl.pageService"></awsdocs-language-banner><awsui-alert class="awsdocs-page-banner awsui-util-mb-l"><p>本文為英文版的機器翻譯版本，如內容有任何歧義或不一致之處，概以英文版為準。</p></awsui-alert><h1 class="topictitle" id="aws-attribute-updatepolicy"><code class="code">UpdatePolicy</code> 屬性</h1><div class="awsdocs-page-header-container"><awsdocs-page-header></awsdocs-page-header><awsdocs-filter-selector id="awsdocs-filter-selector"></awsdocs-filter-selector></div><p>使用 <code class="code">UpdatePolicy</code> 屬性指定 AWS CloudFormation 如何處理下列資源的更新：</p><div class="itemizedlist">
     
     
     
     
     
     
  <ul class="itemizedlist"><li class="listitem">
      <p><a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-resource-appstream-fleet.html"><code class="code">AWS::AppStream::Fleet</code></a></p>
    </li><li class="listitem">
      <p><a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-properties-as-group.html"><code class="code">AWS::AutoScaling::AutoScalingGroup</code></a></p>
    </li><li class="listitem">
      <p><a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-resource-elasticache-replicationgroup.html"><code class="code">AWS::ElastiCache::ReplicationGroup</code></a></p>
    </li><li class="listitem">
      <p><a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-resource-opensearchservice-domain.html"><code class="code">AWS::OpenSearchService::Domain</code></a></p>
    </li><li class="listitem">
      <p><a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-resource-elasticsearch-domain.html"><code class="code">AWS::Elasticsearch::Domain</code></a></p>
    </li><li class="listitem">
      <p><a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-resource-lambda-alias.html"><code class="code">AWS::Lambda::Alias</code></a></p>
    </li></ul></div>
  <h2 id="aws-resource-update-policies">資源更新政策</h2>

  <div class="itemizedlist">
     

     

     

     

     
  <ul class="itemizedlist"><li class="listitem">
      <p>對於<code class="code">AWS::AppStream::Fleet</code>資源， CloudFormation 可以使用較新的  AppStream  2.0 代理程式軟體更新 Image Builder。如需詳細資訊，請參閱<a href="https://docs.aws.amazon.com/appstream2/latest/developerguide/base-images-agent.html">管理  AppStream  2.0 版本</a>。</p>
    </li><li class="listitem">
      <p>對於<code class="code">AWS::AutoScaling::AutoScalingGroup</code>資源，請根據您所做的變更類型或排程作業是否與 Auto Scaling 群組相關聯， CloudFormation 叫用三個更新原則中的一個。</p>
      <div class="itemizedlist">
         
         
      <ul class="itemizedlist"><li class="listitem">
          <p><code class="code">AutoScalingReplacingUpdate</code> 與 <code class="code">AutoScalingRollingUpdate</code> 政策<em>僅</em>適用於您完成以下一項或多項動作時：</p>
          <div class="itemizedlist">
             
             
             
             
          <ul class="itemizedlist"><li class="listitem">
              <p>變更 Auto Scaling 群組的 <code class="code"><a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-properties-as-launchconfig.html">AWS::AutoScaling::LaunchConfiguration</a></code>。</p>
            </li><li class="listitem">
              <p>變更 Auto Scaling 群組的 <code class="code">VPCZoneIdentifier</code> 屬性。</p>
            </li><li class="listitem">
              <p>變更 Auto Scaling 群組的 <code class="code">LaunchTemplate</code> 屬性。</p>
            </li><li class="listitem">
              <p>更新 Auto Scaling 群組，其中包含不符合目前 <code class="code">LaunchConfiguration</code> 的執行個體。</p>
            </li></ul></div>
          <p>如果已指定 <code class="code">AutoScalingReplacingUpdate</code> 與 <code class="code">AutoScalingRollingUpdate</code> 政策屬性，請將 <code class="code">WillReplace</code> 屬性設定為 <code class="code">true</code>，為 <code class="code">AutoScalingReplacingUpdate</code> 提供優先順序。</p>
        </li><li class="listitem">
          <p>當您更新堆疊 (其中包含具備關聯排程動作之 Auto Scaling 群組) 時，將會套用 <code class="code">AutoScalingScheduledAction</code> 政策。</p>
        </li></ul></div>
    </li><li class="listitem">
      <p>對於<code class="code">AWS::ElastiCache::ReplicationGroup</code>資源， CloudFormation 可以透過新增或移除碎片來修改複寫群組的碎片，而不是取代整個資源。如需詳細資訊，請參閱 <a href="#cfn-attributes-updatepolicy-useonlineresharding">UseOnlineResharding 政策</a>。</p>
    </li><li class="listitem">
      <p>對於<code class="code">AWS::OpenSearchService::Domain</code>和舊版<code class="code">AWS::Elasticsearch::Domain</code>資源， CloudFormation 可以將 OpenSearch 服務網域升級為新版本的 OpenSearch 或 Elasticsearch，而無需取代整個資源。如需詳細資訊，請參閱 <a href="#cfn-attributes-updatepolicy-upgradeopensearchdomain">EnableVersionUpgrade 政策</a>。</p>
    </li><li class="listitem">
      <p>對於<code class="code">AWS::Lambda::Alias</code>資源，請在別名上的版本變更時 CloudFormation 執行 CodeDeploy 部署。如需詳細資訊，請參閱 <a href="#cfn-attributes-updatepolicy-codedeploylambdaaliasupdate">CodeDeployLambdaAlias 更新政策</a>。</p>
    </li></ul></div>
 
    <h2 id="aws-attribute-update-policy-app-stream-fleet">AppStream 2.0 更新政策</h2>
    <p>AppStream 2.0 更新策略的配置。</p>
     
      <h3 id="aws-attribute-update-policy-app-stream-fleet-syntax">語法</h3>
      <div id="JSON" name="JSON" class="section langfilter">
        <h4 id="aws-attribute-update-policy-app-stream-fleet-syntax-json">JSON</h4>
        <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="複製"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
    "UpdatePolicy": <span>{</span>
        "<a href="#cfn-attributes-updatepolicy-replacingupdate-StopBeforeUpdate">StopBeforeUpdate</a>": <span>{</span>
            "Type": "<code class="replaceable">Boolean</code>"
        },
        "<a href="#cfn-attributes-updatepolicy-replacingupdate-StartAfterUpdate">StartAfterUpdate</a>": <span>{</span>
            "Type": "<code class="replaceable">Boolean</code>"
        }
    }
}</code></pre>
      </div>
      <div id="YAML" name="YAML" class="section langfilter">
        <h4 id="aws-attribute-update-policy-app-stream-fleet-syntax-yaml">YAML</h4>
        <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="複製"><awsui-icon name="copy"></awsui-icon></div></div><code class="yaml ">UpdatePolicy:
  <a href="#cfn-attributes-updatepolicy-replacingupdate-StopBeforeUpdate">StopBeforeUpdate</a>:
    Type: <code class="replaceable">Boolean</code>
  <a href="#cfn-attributes-updatepolicy-replacingupdate-StartAfterUpdate">StartAfterUpdate</a>:
    Type: <code class="replaceable">Boolean</code></code></pre>
      </div>
      <div class="variablelist">
         
         
      <dl>
          <dt id="cfn-attributes-updatepolicy-replacingupdate-StopBeforeUpdate"><span class="term"><code class="code">StopBeforeUpdate</code></span></dt>
          <dd>
            <p>在更新前停止指定機群。</p>
            <p><em>必要</em>：否</p>
          </dd>
         
          <dt id="cfn-attributes-updatepolicy-replacingupdate-StartAfterUpdate"><span class="term"><code class="code">StartAfterUpdate</code></span></dt>
          <dd>
            <p>在更新後啟動指定機群。</p>
            <p><em>必要</em>：否</p>
          </dd>

        </dl></div>
     
   
    <h2 id="cfn-attributes-updatepolicy-replacingupdate">AutoScalingReplacingUpdate 政策</h2>

    <p>若要指定 AWS CloudFormation 如何處理 Auto Scaling 群組的替換更新，請使用 <code class="code">AutoScalingReplacingUpdate</code> 政策。此政策可讓您指定 AWS CloudFormation 是否以新的群組取代 Auto Scaling 群組，或者僅取代 Auto Scaling 群組中的執行個體。</p>
    <div class="awsdocs-note awsdocs-important"><div class="awsdocs-note-title"><awsui-icon name="status-warning" variant="error"></awsui-icon><h6>重要</h6></div><div class="awsdocs-note-text"><p>在嘗試更新之前，請確定您有足夠的 Amazon EC2 容量，以同時容納舊的與新的 Auto Scaling 群組。</p></div></div>


     
      <h3 id="cfn-attributes-updatepolicy-replacingupdate-syntax">語法</h3>

      <div id="JSON" name="JSON" class="section langfilter">
        <h4 id="aws-attribute-updatepolicy-replacingupdate-syntax.json">JSON</h4>

        <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="複製"><awsui-icon name="copy"></awsui-icon></div></div><code class="json ">"UpdatePolicy" : <span>{</span>
  "<a href="#cfn-attributes-updatepolicy-replacingupdate">AutoScalingReplacingUpdate</a>" : <span>{</span>
    "<a href="#cfn-attributes-updatepolicy-replacingupdate-willreplace">WillReplace</a>" : <code class="replaceable">Boolean</code>
  }
}</code></pre>
      </div>
      <div id="YAML" name="YAML" class="section langfilter">
        <h4 id="aws-attribute-updatepolicy-replacingupdate-syntax.yaml">YAML</h4>

        <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="複製"><awsui-icon name="copy"></awsui-icon></div></div><code class="yaml ">UpdatePolicy:
  <a href="#cfn-attributes-updatepolicy-replacingupdate">AutoScalingReplacingUpdate</a>:
    <a href="#cfn-attributes-updatepolicy-replacingupdate-willreplace">WillReplace</a>: <code class="replaceable">Boolean</code></code></pre>
      </div>
     
     
      <h3 id="cfn-attributes-updatepolicy-replacingupdate-properties">屬性</h3>

      <div class="variablelist">
         
      <dl>
          <dt id="cfn-attributes-updatepolicy-replacingupdate-willreplace"><span class="term"><code class="code">WillReplace</code></span></dt>
          <dd>
            <p>指定是否要在更新期間替換 Auto Scaling 群組及其所包含的執行個體。取代期間， CloudFormation 會保留舊群組，直到完成建立新群組為止。如果更新失敗， CloudFormation 可以復原至舊的「Auto Scaling」群組，並刪除新的「Auto Scaling」群組。</p>
            <p> CloudFormation 建立新群組時，不會分離或貼附任何例證。成功建立新的「Auto Scaling」群組後，請在清理過程中 CloudFormation 刪除舊的「Auto Scaling」群組。</p>
            <p>當您設定 <code class="code">WillReplace</code> 參數時，請記住指定相符的 <code class="code"><a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-attribute-creationpolicy.html">CreationPolicy</a></code>。如果執行個體的數目下限 (透過 <code class="code">MinSuccessfulInstancesPercent</code> 屬性指定) 未能在 <code class="code">Timeout</code> 期間 (在 <code class="code">CreationPolicy</code> 政策中指定) 發出成功訊號，替換更新將會失敗，AWS CloudFormation 將復原到舊 Auto Scaling 群組。</p>
            <p><em>類型</em>：布林值</p>
            <p><em>必要</em>：否</p>
          </dd>
        </dl></div>
     
   
    <h2 id="cfn-attributes-updatepolicy-rollingupdate">AutoScalingRollingUpdate 政策</h2>

    <p>若要指定如何 CloudFormation 處理 Auto Scaling 群組的滾動更新，請使用<code class="code">AutoScalingRollingUpdate</code>原則。滾動更新可讓您指定 AWS CloudFormation 是以批次方式還是一次全部更新 Auto Scaling 群組中的執行個體。</p>
    <div class="awsdocs-note awsdocs-important"><div class="awsdocs-note-title"><awsui-icon name="status-warning" variant="error"></awsui-icon><h6>重要</h6></div><div class="awsdocs-note-text"><p>在滾動式更新期間，某些 Auto Scaling 程序可能會在 CloudFormation 完成滾動更新之前對「Auto Scaling」群組進行變更。這些變更可能會導致滾動更新失敗。為避免 Auto Scaling 在滾動更新期間執行程序，請使用 <code class="code">SuspendProcesses</code> 屬性。如需詳細資訊，請參閱 <a href="https://aws.amazon.com/premiumsupport/knowledge-center/auto-scaling-group-rolling-updates/" rel="noopener noreferrer" target="_blank"><span>執行 Auto Scaling 群組滾動更新的建議最佳實務為何？</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a></p></div></div>

    <p>請注意，在堆疊更新復原作業期間， CloudFormation 會在目前的堆疊更新作業之前使用範本中指定的<code class="code">UpdatePolicy</code>組態。例如，假設您已將堆疊範本 <code class="code">UpdatePolicy</code> 的 <code class="code">MaxBatchSize</code> 從 1 更新到 10。然後，您會執行堆疊更新，且該更新會失敗，並 CloudFormation 啟動更新復原作業。在這種情況下， CloudFormation  將使用 1 做為批次大小上限，而不是 10。因此，我們建議您在對可能會啟動滾動更新的 <code class="code">AWS::AutoScaling::AutoScalingGroup</code> 資源進行任何更新前，單獨先在堆疊更新中的 <code class="code">UpdatePolicy</code> 組態進行變更。</p>

    
      <h3 id="cfn-attributes-updatepolicy-rollingupdate-syntax">語法</h3>

      <div id="JSON" name="JSON" class="section langfilter">
        <h4 id="aws-attribute-updatepolicy-rollingupdate-syntax.json">JSON</h4>

        <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="複製"><awsui-icon name="copy"></awsui-icon></div></div><code class="json ">"UpdatePolicy" : <span>{</span>
  "<a href="#cfn-attributes-updatepolicy-rollingupdate">AutoScalingRollingUpdate</a>" : <span>{</span>
    "<a href="#cfn-attributes-updatepolicy-rollingupdate-maxbatchsize">MaxBatchSize</a>" : <code class="replaceable">Integer</code>,
    "<a href="#cfn-attributes-updatepolicy-rollingupdate-minactiveinstancespercent">MinActiveInstancesPercent</a>" : <code class="replaceable">Integer</code>,
    "<a href="#cfn-attributes-updatepolicy-rollingupdate-mininstancesinservice">MinInstancesInService</a>" : <code class="replaceable">Integer</code>,
    "<a href="#cfn-attributes-updatepolicy-rollingupdate-minsuccessfulinstancespercent">MinSuccessfulInstancesPercent</a>" : <code class="replaceable">Integer</code>,
    "<a href="#cfn-attributes-updatepolicy-rollingupdate-pausetime">PauseTime</a>" : <code class="replaceable">String</code>,
    "<a href="#cfn-attributes-updatepolicy-rollingupdate-suspendprocesses">SuspendProcesses</a>" : [ <code class="replaceable">List of processes</code> ],
    "<a href="#cfn-attributes-updatepolicy-rollingupdate-waitonresourcesignals">WaitOnResourceSignals</a>" : <code class="replaceable">Boolean</code>
  }
}</code></pre>
      </div>
      <div id="YAML" name="YAML" class="section langfilter">
        <h4 id="aws-attribute-updatepolicy-rollingupdate-syntax.yaml">YAML</h4>

        <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="複製"><awsui-icon name="copy"></awsui-icon></div></div><code class="yaml ">UpdatePolicy:
  <a href="#cfn-attributes-updatepolicy-rollingupdate">AutoScalingRollingUpdate</a>:
    <a href="#cfn-attributes-updatepolicy-rollingupdate-maxbatchsize">MaxBatchSize</a>: <code class="replaceable">Integer</code>
    <a href="#cfn-attributes-updatepolicy-rollingupdate-minactiveinstancespercent">MinActiveInstancesPercent</a>: <code class="replaceable">Integer</code>
    <a href="#cfn-attributes-updatepolicy-rollingupdate-mininstancesinservice">MinInstancesInService</a>: <code class="replaceable">Integer</code>
    <a href="#cfn-attributes-updatepolicy-rollingupdate-minsuccessfulinstancespercent">MinSuccessfulInstancesPercent</a>: <code class="replaceable">Integer</code>
    <a href="#cfn-attributes-updatepolicy-rollingupdate-pausetime">PauseTime</a>: <code class="replaceable">String</code>
    <a href="#cfn-attributes-updatepolicy-rollingupdate-suspendprocesses">SuspendProcesses</a>:
      - <code class="replaceable">List of processes</code>
    <a href="#cfn-attributes-updatepolicy-rollingupdate-waitonresourcesignals">WaitOnResourceSignals</a>: <code class="replaceable">Boolean</code></code></pre>
      </div>
     
     
      <h3 id="aws-attribute-updatepolicy-rollingupdate-properties">屬性</h3>
      <div class="variablelist">
         
        
         
         
         
         
         
      <dl>
          <dt id="cfn-attributes-updatepolicy-rollingupdate-maxbatchsize"><span class="term"><code class="code">MaxBatchSize</code></span></dt>
          <dd>
            <p>指定可同時取代的最大執行個體數目。</p>
            <p><em>預設</em>：<code class="code">1</code></p>
            <p><em>上限</em>：<code class="code">100</code></p>
            <p><em>類型</em>：整數</p>
            <p><em>必要</em>：否</p>
          </dd>
         
     <dt id="cfn-attributes-updatepolicy-rollingupdate-minactiveinstancespercent"><span class="term"><code class="code">MinActiveInstancesPercent</code></span></dt>
     <dd>
      <p>指定 Auto Scaling 群組中執行個體的百分比，該執行個體必須在循環更新期間處於與該群組所需容量相關的<code class="code">InService</code>狀態，才能成功更新。您可以指定介於 0 到 100 之間的值。  CloudFormation 四捨五入至最接近的百分之十。例如，如果您以至少 50 個<code class="code">InService</code>百分比更新五個執行個體，則至少必須有三個執行個體處於該<code class="code">InService</code>狀態。</p>
      <p>如果執行個體未在 1 小時的固定時間內轉換至<code class="code">InService</code>狀態，則 CloudFormation 假設執行個體未更新。</p>
      <p>如果您指定此屬性，則還必須啟用該<code class="code">PauseTime</code>屬性。</p>
      <p>該<code class="code">MinActiveInstancesPercent</code>參數僅適用於穩定目的的的例證。若要指定 Auto Scaling 群組中的執行個體數目<code class="code">MinSize</code>，請參閱<a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-properties-as-group.html#cfn-as-group-maxsize"><code class="code">MaxSize</code></a>、和<code class="code">AWS::AutoScaling::AutoScalingGroup</code>資源的<code class="code">DesiredCapacity</code>屬性。</p>
      <p><code class="code">MinActiveInstancesPercent</code>在您的設定也<code class="code">UpdatePolicy</code>會影響啟動的執行個體，以回應<a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-properties-as-group.html"><code class="code">AWS::AutoScaling::AutoScalingGroup</code></a>資源中的<code class="code">DesiredCapacity</code>屬性高於該 Auto Scaling 群組目前所需的容量。</p>
      <p><em>預設</em>：<code class="code">100</code></p>
      <p><em>類型</em>：整數</p>
      <p><em>必要</em>：否</p>
     </dd>
     
          <dt id="cfn-attributes-updatepolicy-rollingupdate-mininstancesinservice"><span class="term"><code class="code">MinInstancesInService</code></span></dt>
          <dd>
            <p>指定在更新舊執行個體時，Auto Scaling 群組內必須使用的執行個 CloudFormation 體數目下限。此值必須小於「Auto Scaling」群組<a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-properties-as-group.html#cfn-as-group-maxsize"><code class="code">MaxSize</code></a>的值。</p>
            <p><em>預設</em>：<code class="code">0</code></p>
            <p><em>類型</em>：整數</p>
            <p><em>必要</em>：否</p>
          </dd>
         
          <dt id="cfn-attributes-updatepolicy-rollingupdate-minsuccessfulinstancespercent"><span class="term"><code class="code">MinSuccessfulInstancesPercent</code></span></dt>
          <dd>
            <p>指定 Auto Scaling 滾動更新中必須有多少百分比的執行個體成功發出訊號才能成功更新。您可以指定從<code class="code">0</code>到的值<code class="code">100</code>。  CloudFormation 四捨五入至最接近的百分之十。例如，如果更新 5 個執行個體，最低成功百分比為 <code class="code">50</code>，則必須有 3 個執行個體成功發出訊號。</p>
            <p>如果執行個體未在<code class="code">PauseTime</code>屬性中指定的時間內傳送訊號，則 CloudFormation 假設執行個體未更新。</p>
            <p>如果您指定此屬性，則必須也啟用 <code class="code">WaitOnResourceSignals</code> 與 <code class="code">PauseTime</code> 屬性。</p>
            <p><code class="code">MinSuccessfulInstancesPercent</code> 參數只會套用至僅用於傳送訊號的執行個體。若要指定自動調度資源群組中的執行個體數目，請參閱<code class="code">MinSize</code><code class="code">MaxSize</code>、和<a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-properties-as-group.html"><code class="code">AWS::AutoScaling::AutoScalingGroup</code></a>資源的<code class="code">DesiredCapacity</code>屬性。</p>
            <p><em>預設</em>：<code class="code">100</code></p>
            <p><em>類型</em>：整數</p>
            <p><em>必要</em>：否</p>

            <div class="awsdocs-note awsdocs-important"><div class="awsdocs-note-title"><awsui-icon name="status-warning" variant="error"></awsui-icon><h6>重要</h6></div><div class="awsdocs-note-text"><p>當<code class="code">MinSuccessfulInstancesPercent</code>屬性設定為時<code class="code">0</code>，會 CloudFormation 等待 0% 的容量執行個體處於某個<code class="code">InService</code>狀態。 <code class="code">MinSuccessfulInstancesPercent</code>立即傳回，並在考慮 Auto Scaling 群組狀態之前，以移<code class="code">Update
                  Complete</code>至堆疊範本中定義的後續資源。</p><p>如果在 CloudFormation 範本中定義了其他「Auto Scaling」群組，它們將會同時更新。當一次部署所有 Auto Scaling 群組且 0% 的容量執行個體處於 <code class="code">InService</code> 狀態時，您將會遇到可用性問題，因為沒有執行個體提供客戶流量。</p><p>CloudFormation 建議設定<code class="code">MinSuccessfulInstancesPercent</code>為大於 0 的值，允許在考慮完成 Auto Scaling 群組更新之前，先驗證合理的最小執行個體。</p></div></div>

          </dd>

         
          <dt id="cfn-attributes-updatepolicy-rollingupdate-pausetime"><span class="term"><code class="code">PauseTime</code></span></dt>
          <dd>
            <p>對批次執行個體進行變更後 CloudFormation 暫停的時間，讓這些執行個體有時間啟動軟體應用程式。例如，在擴展 Auto Scaling 群組中的執行個體數量時，您可能必須指定 <code class="code">PauseTime</code>。</p>
            <p>如果啟用此<code class="code">WaitOnResourceSignals</code> CloudFormation 屬性，<code class="code">PauseTime</code>則為等待 Auto Scaling 群組從新增或取代的執行個體接收所需數目的有效訊號的時間量。如果 Auto Scaling 群組接收所需訊號數量的時間超過 <code class="code">PauseTime</code>，更新將會失敗。為獲得最佳結果，請指定可讓您的應用程式有足夠時間啟動的時間。如果需要復原更新，較短的 <code class="code">PauseTime</code> 可能會導致復原失敗。</p>
            <p>以 <a href="http://en.wikipedia.org/wiki/ISO_8601#Durations" rel="noopener noreferrer" target="_blank"><span>ISO8601 持續時間格式</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a>指定 <code class="code">PauseTime</code> (格式為 <code class="code">PT<code class="replaceable">#</code>H<code class="replaceable">#</code>M<code class="replaceable">#</code>S</code>，其中的各個 <code class="replaceable">#</code> 分別為小時、分鐘、秒鐘的數字)。<code class="code">PauseTime</code> 上限為 1 小時 (<code class="code">PT1H</code>)。</p>
            <p><em>預設</em>：<code class="code">PT1H</code> (1 小時) 若 <code class="code">WaitOnResourceSignals</code> 屬性設為 <code class="code">true</code>。</p>
            <p><em>類型</em>：字串</p>
            <p><em>必要</em>：否</p>
          </dd>
         
          <dt id="cfn-attributes-updatepolicy-rollingupdate-suspendprocesses"><span class="term"><code class="code">SuspendProcesses</code></span></dt>
          <dd>
            <p>指定 Auto Scaling 程序在堆疊更新期間暫停。暫停程序可避免 Auto Scaling 影響堆疊更新。例如，您可以暫停警示，這樣 Amazon EC2 Auto Scaling 就不會啟動與警示相關的擴展政策。如需有效值，請<code class="code">ScalingProcesses.member.N</code>參閱 <em>Amazon EC2 自<a href="https://docs.aws.amazon.com/autoscaling/ec2/APIReference/API_SuspendProcesses.html">SuspendProcesses</a>動擴展 API 參考</em>中該動作的參數。</p>
            <p><em>預設</em>：未指定</p>
            <p><em>類型</em>：Auto Scaling 程序清單</p>
            <p><em>必要</em>：否</p>
          </dd>
         
          <dt id="cfn-attributes-updatepolicy-rollingupdate-waitonresourcesignals"><span class="term"><code class="code">WaitOnResourceSignals</code></span></dt>
          <dd>
            <p>指定 Auto Scaling 群組是否要在更新期間等待來自新執行個體的訊號。使用此屬性確保在 Auto Scaling 群組進行更新之前，執行個體已完成應用程式的安裝與設定。在將新的 EC2 執行個體啟動至群組後，AWS CloudFormation 會暫停 Auto Scaling 群組的更新。AWS CloudFormation 必須在指定的 <code class="code">PauseTime</code> 內接收來自每個新執行個體的訊號，才能繼續更新。若要將訊號傳送至 Auto Scaling 群組，請使用 <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/cfn-signal.html">cfn-signal</a> 協助程式指令碼或 <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/APIReference/API_SignalResource.html"><code class="code">SignalResource</code></a> API。</p>
            <p>若要讓執行個體在 Elastic Load Balancing 運作狀態檢查傳送成功訊號前等待，請使用 <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/cfn-init.html">cfn-init</a> 協助程式指令碼新增運作狀態檢查驗證。如需範例，請參閱 <a href="https://github.com/awslabs/aws-cloudformation-templates/blob/master/aws/services/AutoScaling/AutoScalingRollingUpdates.yaml" rel="noopener noreferrer" target="_blank"><span>Auto Scaling 滾動式更新</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a>範例範本中的 <code class="code">verify_instance_health</code> 命令。</p>
            <p><em>預設</em>：<code class="code">true</code></p>
            <p><em>類型</em>：布林值</p>
            <p><em>必要</em>：有條件限制。如果您指定 <code class="code">MinSuccessfulInstancesPercent</code> 屬性，則必須也啟用 <code class="code">WaitOnResourceSignals</code> 與 <code class="code">PauseTime</code> 屬性。</p>
          </dd>
        </dl></div>
     
   
    <h2 id="cfn-attributes-updatepolicy-scheduledactions">AutoScalingScheduledAction 政策</h2>

    <p>若要指定當 <code class="code">AWS::AutoScaling::AutoScalingGroup</code> 資源有一個關聯的排程動作時，AWS CloudFormation 如何處理 <code class="code">MinSize</code>、<code class="code">MaxSize</code> 和 <code class="code">DesiredCapacity</code> 屬性的更新，請使用 <code class="code">AutoScalingScheduledAction</code> 政策。</p>
    <p>透過排程動作，可隨時改變 Auto Scaling 群組的群組大小屬性。當您使用 Auto Scaling 群組和排程動作更新堆疊時，一 CloudFormation 律會將 Auto Scaling 群組的群組大小屬性值設定為範本<code class="code">AWS::AutoScaling::AutoScalingGroup</code>資源中定義的值，即使排程動作生效也一樣。</p>
    <p>如果您不 CloudFormation 想在排程動作生效時變更任何群組大小內容值，請使用<code class="code">AutoScalingScheduledAction</code>更新原則並<code class="code">IgnoreUnmodifiedGroupSizeProperties</code>將設定為<code class="code">true</code>以防 CloudFormation 止變更<code class="code">MinSize</code>、或<code class="code">DesiredCapacity</code>屬性<code class="code">MaxSize</code>，除非您已在範本中修改這些值。</p>
     
      <h3 id="cfn-attributes-updatepolicy-scheduledactions-syntax">語法</h3>

      <div id="JSON" name="JSON" class="section langfilter">
        <h4 id="aws-attribute-updatepolicy-scheduledactions-syntax.json">JSON</h4>

        <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="複製"><awsui-icon name="copy"></awsui-icon></div></div><code class="json ">"UpdatePolicy" : <span>{</span>
  "<a href="#cfn-attributes-updatepolicy-scheduledactions">AutoScalingScheduledAction</a>" : <span>{</span>
    "<a href="#cfn-attributes-updatepolicy-scheduledactions-ignoreunmodifiedgroupsizeproperties">IgnoreUnmodifiedGroupSizeProperties</a>" : <code class="replaceable">Boolean</code>
  }
}</code></pre>
      </div>
      <div id="YAML" name="YAML" class="section langfilter">
        <h4 id="aws-attribute-updatepolicy-scheduledactions-syntax.yaml">YAML</h4>

        <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="複製"><awsui-icon name="copy"></awsui-icon></div></div><code class="yaml ">UpdatePolicy:
  <a href="#cfn-attributes-updatepolicy-scheduledactions">AutoScalingScheduledAction</a>:
    <a href="#cfn-attributes-updatepolicy-scheduledactions-ignoreunmodifiedgroupsizeproperties">IgnoreUnmodifiedGroupSizeProperties</a>: <code class="replaceable">Boolean</code></code></pre>
      </div>
     
     
      <h3 id="cfn-attributes-updatepolicy-scheduledactions-properties">屬性</h3>

      <div class="variablelist">
         
      <dl>
          <dt id="cfn-attributes-updatepolicy-scheduledactions-ignoreunmodifiedgroupsizeproperties"><span class="term"><code class="code">IgnoreUnmodifiedGroupSizeProperties</code></span></dt>
          <dd>
            <p>如為 <code class="code">true</code>，在堆疊更新期間，AWS CloudFormation 會忽略目前 Auto Scaling 群組與範本之 <code class="code">AWS::AutoScaling::AutoScalingGroup</code> 資源中所描述 Auto Scaling 群組之間的群組大小屬性差異。如果您修改範本中的任何群組大小屬性值，AWS CloudFormation 將使用修改後的值並更新您的 Auto Scaling 群組。</p>
            <p><em>預設</em>：<code class="code">false</code></p>
            <p><em>類型</em>：布林值</p>
            <p><em>必要</em>：否</p>
          </dd>
        </dl></div>
     
   
    <h2 id="cfn-attributes-updatepolicy-useonlineresharding">UseOnlineResharding 政策</h2>
    <p>若要透過新增或移除碎片來修改複寫群組的碎片，而不是替換整個 <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-resource-elasticache-replicationgroup.html">AWS::ElastiCache::ReplicationGroup</a> 資源，請使用 <code class="code">UseOnlineResharding</code> 更新政策。</p>
    <p>如果設定<code class="code">UseOnlineResharding</code>為<code class="code">true</code>，您可以更新<code class="code">AWS::ElastiCache::ReplicationGroup</code>資源的<code class="code">NumNodeGroups</code>和<code class="code">NodeGroupConfiguration</code>屬性，並且不 CloudFormation 會中斷地更新這些屬性。當<code class="code">UseOnlineResharding</code>設定為 <code class="code">false</code> (或未指定) 時，更新<code class="code">NumNodeGroups</code>和<code class="code">NodeGroupConfiguration</code>屬性會 CloudFormation 取代整個<code class="code">AWS::ElastiCache::ReplicationGroup</code>資源。</p>
    <p><code class="code">UseOnlineResharding</code> 更新政策沒有屬性。</p>
    <p>將 <code class="code">UseOnlineResharding</code> 更新政策設定為 <code class="code">true</code> 時的一些考量事項：</p>
    <div class="itemizedlist">
       
       
       
    <ul class="itemizedlist"><li class="listitem">
        <p>我們強烈建議您將 <code class="code">NumNodeGroups</code> 和 <code class="code">NodeGroupConfiguration</code> 屬性作為特定堆疊更新操作中唯一的更新來執行更新。</p>
        <p>更新複寫群組的節點群組組態是需要耗費大量資源的操作。如果堆疊更新失敗，則 CloudFormation 不會復原對複寫群組之節點群組組態的變更。不過， CloudFormation 會復原任何其他在失敗更新作業中變更的屬性。</p>
      </li><li class="listitem">
        <p>任何節點群組更新都需要識別所有節點群組。</p>
        <p>如果您指定內<code class="code">NodeGroupConfiguration</code>容，您還必須 NodeGroupId 為每個節點群組組態指定，以 CloudFormation 便更新節點數目而不會中斷。</p>
        <p>在建立複寫群組時，如果您沒有為每個節點群組指定 ID， ElastiCache  會自動為每個節點群組產生 ID。若要在不中斷的情況下更新複寫群組，請使用 ElastiCache 主控台 (<a href="https://console.aws.amazon.com/elasticache/" rel="noopener noreferrer" target="_blank"><span>https://console.aws.amazon.com/elasticache/</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a>) 或<a href="https://docs.aws.amazon.com/AmazonElastiCache/latest/APIReference/API_DescribeReplicationGroups.html">DescribeReplicationGroups</a>擷取複寫群組中所有節點群組的 ID。然後，在嘗試新增或移除碎片之前，請為堆疊範本中的每個節點群組指定 ID。</p>
        <div class="awsdocs-note"><div class="awsdocs-note-title"><awsui-icon name="status-info" variant="link"></awsui-icon><h6>注意</h6></div><div class="awsdocs-note-text"><p>最佳實務是當您在堆疊範本中建立複寫群組時，就為您指定的每個節點群組包含 ID。</p></div></div>
        <p>此外，更新節點數量而不被中斷，也會需要您準確地為每個 <code class="code">NodeGroupConfiguration</code> 指定 <code class="code">PrimaryAvailabilityZone</code>、<code class="code">ReplicaAvailabilityZones</code> 和 <code class="code">ReplicaCount</code> 屬性。同樣地，您可以使用 ElastiCache 主控台 (<a href="https://console.aws.amazon.com/elasticache/" rel="noopener noreferrer" target="_blank"><span>https://console.aws.amazon.com/elasticache/</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a>) 或擷<a href="https://docs.aws.amazon.com/AmazonElastiCache/latest/APIReference/API_DescribeReplicationGroups.html">DescribeReplicationGroups</a>取每個節點群組的實際值，並將它們與堆疊範本中的值進行比較。您可以進行個別堆疊更新來更新節點群組的屬性值，或將更新作為變更節點群組數量相同堆疊更新的一部分。</p>
        <p>當您使用<code class="code">UseOnlineResharding</code>更新原則在不中斷的情況下更新節點群組數目時，會在指定的插槽數目之間 ElastiCache 平均分配金鑰空間。此設定之後將無法更新。因此，以這種方式更新節點群組後，您應該移除在堆疊範本中 <code class="code">NodeGroupConfiguration</code> 為每個 <code class="code">Slots</code> 屬性指定的值，因為其不再反映每個節點群組的實際值。</p>
      </li><li class="listitem">
        <p>實際節點群組移除結果可能有所差異。</p>
        <p>當您指定的<code class="code">NumNodeGroups</code>值小於目前節點群組數目時，會指 CloudFormation 示視需 ElastiCache 要移除盡可能多的節點群組，以達到指定的節點數目。但是， ElastiCache 可能並不總是能夠移除所需數量的節點群組。如果 ElastiCache 無法刪除所需數量的節點組，則 CloudFormation 生成一個堆棧事件，提醒您這一點。在無法移除<em>任何</em>節點群組的情況下，資 CloudFormation 源更新會失敗。 ElastiCache </p>
      </li></ul></div>
    <p>如需修改複寫群組的詳細資訊，請參閱 <em>Amazon  ElastiCache  API 參考<a href="https://docs.aws.amazon.com/AmazonElastiCache/latest/APIReference/API_ModifyReplicationGroupShardConfiguration.html">ModifyReplicationGroupShardConfiguration</a></em>中的。</p>

     
      <h3 id="cfn-attributes-updatepolicy-useonlineresharding-syntax">語法</h3>
      <div id="JSON" name="JSON" class="section langfilter">
        <h4 id="cfn-attributes-updatepolicy-useonlineresharding-syntax.json">JSON</h4>
        <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="複製"><awsui-icon name="copy"></awsui-icon></div></div><code class="json ">"UpdatePolicy" : <span>{</span>
  "<a href="#cfn-attributes-updatepolicy-useonlineresharding">UseOnlineResharding</a>" : <code class="replaceable">Boolean</code>
}</code></pre>
      </div>
      <div id="YAML" name="YAML" class="section langfilter">
        <h4 id="cfn-attributes-updatepolicy-useonlineresharding-syntax.yaml">YAML</h4>
        <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="複製"><awsui-icon name="copy"></awsui-icon></div></div><code class="yaml ">UpdatePolicy:
  <a href="#cfn-attributes-updatepolicy-useonlineresharding">UseOnlineResharding</a>: <code class="replaceable">Boolean</code></code></pre>
      </div>
     
   
    <h2 id="cfn-attributes-updatepolicy-upgradeopensearchdomain">EnableVersionUpgrade 政策</h2>

    <p>若要將 OpenSearch 服務網域升級為新版本的 OpenSearch 或 Elasticsearch，而不是取代整個<a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-resource-opensearchservice-domain.html">AWS::OpenSearchService::Domain</a>或<a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-resource-elasticsearch-domain.html">AWS::Elasticsearch::Domain</a>資源，請使用<code class="code">EnableVersionUpgrade</code>更新原則。</p>
    <p>如果設定<code class="code">EnableVersionUpgrade</code>為<code class="code">true</code>，您可以更新<code class="code">AWS::OpenSearchService::Domain</code>資源的<code class="code">EngineVersion</code>屬性 (或舊資<code class="code">AWS::Elasticsearch::Domain</code>源的<code class="code">ElasticsearchVersion</code>屬性)，並且不 CloudFormation 會中斷地更新該內容。當<code class="code">EnableVersionUpgrade</code>設定為<code class="code">false</code>或未指定時，更新<code class="code">EngineVersion</code>或內<code class="code">ElasticsearchVersion</code>容會導致 CloudFormation 取代整個<code class="code">AWS::OpenSearchService::Domain</code>/<code class="code">AWS::Elasticsearch::Domain</code>資源。</p>
    <p><code class="code">EnableVersionUpgrade</code> 更新政策沒有屬性。</p>
    <p>如需升級 OpenSearch 服務網域的詳細資訊，請參閱 Amazon  OpenSearch  服務開發人員指南<a href="https://docs.aws.amazon.com/opensearch-service/latest/developerguide/configuration-api.html#configuration-api-actions-upgrade-domain">UpgradeDomain</a>中的。</p>

     
      <h3 id="cfn-attributes-updatepolicy-upgradeopensearchdomain-syntax">語法</h3>

      <div id="JSON" name="JSON" class="section langfilter">
        <h4 id="cfn-attributes-updatepolicy-upgradeopensearchdomain-syntax.json">JSON</h4>
        <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="複製"><awsui-icon name="copy"></awsui-icon></div></div><code class="json ">"UpdatePolicy" : <span>{</span>
  "<a href="#cfn-attributes-updatepolicy-upgradeopensearchdomain">EnableVersionUpgrade</a>" : <code class="replaceable">Boolean</code>
}</code></pre>
      </div>

      <div id="YAML" name="YAML" class="section langfilter">
        <h4 id="cfn-attributes-updatepolicy-upgradeopensearchdomain-syntax.yaml">YAML</h4>
        <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="複製"><awsui-icon name="copy"></awsui-icon></div></div><code class="yaml ">UpdatePolicy:
  <a href="#cfn-attributes-updatepolicy-upgradeopensearchdomain">EnableVersionUpgrade</a>: <code class="replaceable">Boolean</code></code></pre>
      </div>

     

   
    <h2 id="cfn-attributes-updatepolicy-codedeploylambdaaliasupdate">CodeDeployLambdaAlias 更新政策</h2>

    <p>若要在<code class="code">AWS::Lambda::Alias</code>資源上的版本變更時執行 CodeDeploy 部署，請使用<code class="code">CodeDeployLambdaAliasUpdate</code>更新原則。</p>
     
      <h3 id="cfn-attributes-updatepolicy-codedeploylambdaaliasupdate-syntax">語法</h3>

      <div id="JSON" name="JSON" class="section langfilter">
        <h4 id="aws-attribute-updatepolicy-codedeploylambdaaliasupdate-syntax.json">JSON</h4>

        <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="複製"><awsui-icon name="copy"></awsui-icon></div></div><code class="json ">"UpdatePolicy" : <span>{</span>
  "<a href="#cfn-attributes-updatepolicy-codedeploylambdaaliasupdate">CodeDeployLambdaAliasUpdate</a>" : <span>{</span>
    "<a href="#cfn-attributes-updatepolicy-codedeploylambdaaliasupdate-afterallowtraffichook">AfterAllowTrafficHook</a>" : <code class="replaceable">String</code>,
    "<a href="#cfn-attributes-updatepolicy-codedeploylambdaaliasupdate-applicationname">ApplicationName</a>" : <code class="replaceable">String</code>,
    "<a href="#cfn-attributes-updatepolicy-codedeploylambdaaliasupdate-beforeallowtraffichook">BeforeAllowTrafficHook</a>" : <code class="replaceable">String</code>,
    "<a href="#cfn-attributes-updatepolicy-codedeploylambdaaliasupdate-deploymentgroupname">DeploymentGroupName</a>" : <code class="replaceable">String</code>
  }
}</code></pre>
      </div>
      <div id="YAML" name="YAML" class="section langfilter">
        <h4 id="aws-attribute-updatepolicy-codedeploylambdaaliasupdate-syntax.yaml">YAML</h4>

        <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="複製"><awsui-icon name="copy"></awsui-icon></div></div><code class="yaml ">UpdatePolicy:
  <a href="#cfn-attributes-updatepolicy-codedeploylambdaaliasupdate">CodeDeployLambdaAliasUpdate</a>:
    <a href="#cfn-attributes-updatepolicy-codedeploylambdaaliasupdate-afterallowtraffichook">AfterAllowTrafficHook</a>: <code class="replaceable">String</code>
    <a href="#cfn-attributes-updatepolicy-codedeploylambdaaliasupdate-applicationname">ApplicationName</a>: <code class="replaceable">String</code>
    <a href="#cfn-attributes-updatepolicy-codedeploylambdaaliasupdate-beforeallowtraffichook">BeforeAllowTrafficHook</a>: <code class="replaceable">String</code>
    <a href="#cfn-attributes-updatepolicy-codedeploylambdaaliasupdate-deploymentgroupname">DeploymentGroupName</a>: <code class="replaceable">String</code></code></pre>
      </div>
     
     
      <h3 id="aws-attribute-updatepolicy-codedeploylambdaaliasupdate-properties">屬性</h3>

      <div class="variablelist">
         
         
         
         
      <dl>
          <dt id="cfn-attributes-updatepolicy-codedeploylambdaaliasupdate-afterallowtraffichook"><span class="term"><code class="code">AfterAllowTrafficHook</code></span></dt>
          <dd>
            <p>在流量路由完成後，要執行的 Lambda 函數名稱。</p>
            <p><em>必要</em>：否</p>
            <p><em>類型</em>：字串</p>
          </dd>
         
          <dt id="cfn-attributes-updatepolicy-codedeploylambdaaliasupdate-applicationname"><span class="term"><code class="code">ApplicationName</code></span></dt>
          <dd>
            <p> CodeDeploy 應用程式的名稱。</p>
            <p><em>必要</em>：是</p>
            <p><em>類型</em>：字串</p>
          </dd>
         
          <dt id="cfn-attributes-updatepolicy-codedeploylambdaaliasupdate-beforeallowtraffichook"><span class="term"><code class="code">BeforeAllowTrafficHook</code></span></dt>
          <dd>
            <p>在流量路由開始前，要執行的 Lambda 函數名稱。</p>
            <p><em>必要</em>：否</p>
            <p><em>類型</em>：字串</p>
          </dd>
         
          <dt id="cfn-attributes-updatepolicy-codedeploylambdaaliasupdate-deploymentgroupname"><span class="term"><code class="code">DeploymentGroupName</code></span></dt>
          <dd>
            <p> CodeDeploy 部署群組的名稱。這是設置流量轉換政策的位置。</p>
            <p><em>必要</em>：是</p>
            <p><em>類型</em>：字串</p>
          </dd>
        </dl></div>
      <p>如需為 <code class="code">AWS::Lambda::Alias</code> 資源指定 <code class="code">UpdatePolicy</code> 屬性的範例，請參閱 <a href="#aws-resource-lambda-alias-example">Lambda 別名更新政策</a>。</p>
     
   
    <h2 id="aws-attribute-updatepolicy-examples">範例</h2>
    <p>以下範例說明如何將更新政策新增至 Auto Scaling 群組，以及如何在更新中繼資料時保持可用性。</p>
     
      <h3 id="w9aac34c23c23c23b5">將 <code class="code">UpdatePolicy</code> 新增至 Auto Scaling 群組</h3>

      <p>以下範例說明如何新增更新政策。在更新期間，Auto Scaling 群組將以兩個為一批更新執行個體，並至少保持一個服務中的執行個體。由於已設定 <code class="code">WaitOnResourceSignals</code> 旗標，Auto Scaling 群組將等待在群組中新增的新執行個體。新執行個體必須發出訊號至 Auto Scaling 群組，才能更新下一個批次的執行個體。</p>
      <div id="JSON" name="JSON" class="section langfilter">
        <h4 id="attribute-updatepolicy-example-1.json">JSON</h4>

        <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="複製"><awsui-icon name="copy"></awsui-icon></div></div><code class="json ">"ASG" : <span>{</span>
   "Type" : "AWS::AutoScaling::AutoScalingGroup",
   "Properties" : <span>{</span>
      "AvailabilityZones" : [
         "us-east-1a",
         "us-east-1b"
      ],
      "DesiredCapacity" : "1",
      "LaunchConfigurationName" : <span>{</span>
         "Ref" : "LaunchConfig"
      },
      "MaxSize" : "4",
      "MinSize" : "1"
   },
   "UpdatePolicy" : <span>{</span>
      "AutoScalingScheduledAction" : <span>{</span>
         "IgnoreUnmodifiedGroupSizeProperties" : "true"
      },
      "AutoScalingRollingUpdate" : <span>{</span>
         "MinInstancesInService" : "1",
         "MaxBatchSize" : "2",
         "WaitOnResourceSignals" : "true",
         "PauseTime" : "PT10M"
      }
   }
 },
"ScheduledAction" : <span>{</span>
   "Type" : "AWS::AutoScaling::ScheduledAction",
   "Properties" : <span>{</span>
      "AutoScalingGroupName" : <span>{</span>
         "Ref" : "ASG"
      },
      "DesiredCapacity" : "2",
      "StartTime" : "2017-06-02T20 : 00 : 00Z"
   }
}</code></pre>
      </div>
      <div id="YAML" name="YAML" class="section langfilter">
        <h4 id="attribute-updatepolicy-example-1.yaml">YAML</h4>

        <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="複製"><awsui-icon name="copy"></awsui-icon></div></div><code class="yaml ">ASG:
  Type: 'AWS::AutoScaling::AutoScalingGroup'
  Properties:
    AvailabilityZones:
    - us-east-1a
    - us-east-1b
    DesiredCapacity: '1'
    LaunchConfigurationName:
      Ref: LaunchConfig
    MaxSize: '4'
    MinSize: '1'
  UpdatePolicy:
    AutoScalingScheduledAction:
      IgnoreUnmodifiedGroupSizeProperties: 'true'
    AutoScalingRollingUpdate:
      MinInstancesInService: '1'
      MaxBatchSize: '2'
      WaitOnResourceSignals: 'true'
      PauseTime: PT10M
ScheduledAction:
  Type: 'AWS::AutoScaling::ScheduledAction'
  Properties:
    AutoScalingGroupName:
      Ref: ASG
    DesiredCapacity: '2'
    StartTime: '2017-06-02T20 : 00 : 00Z'</code></pre>
      </div>
     
     
      <h3 id="w9aac34c23c23c23b7">AutoScalingReplacingUpdate 政策</h3>

      <p>以下範例宣告一項政策，強制在更新期間替換關聯的 Auto Scaling 群組。為了成功更新，必須在 <code class="code">MinSuccessfulPercentParameter</code> 期間發出成功訊號的執行個體百分比 (以 <code class="code">Timeout</code> 參數指定)。</p>
      <div id="JSON" name="JSON" class="section langfilter">
        <h4 id="attribute-updatepolicy-example-2.json">JSON</h4>

        <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="複製"><awsui-icon name="copy"></awsui-icon></div></div><code class="json ">"UpdatePolicy" : <span>{</span>
  "AutoScalingReplacingUpdate" : <span>{</span>
    "WillReplace" : "true"
  }
},
"CreationPolicy" : <span>{</span>
  "ResourceSignal" : <span>{</span>
    "Count" : <span>{</span> "Ref" : "ResourceSignalsOnCreate"},
    "Timeout" : "PT10M"
  },
  "AutoScalingCreationPolicy" : <span>{</span>
    "MinSuccessfulInstancesPercent" : <span>{</span> "Ref" : "MinSuccessfulPercentParameter" }
  }
}</code></pre>
      </div>
      <div id="YAML" name="YAML" class="section langfilter">
        <h4 id="attribute-updatepolicy-example-2.yaml">YAML</h4>

        <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="複製"><awsui-icon name="copy"></awsui-icon></div></div><code class="yaml ">UpdatePolicy:
  AutoScalingReplacingUpdate:
    WillReplace: 'true'
CreationPolicy:
  ResourceSignal:
    Count: !Ref 'ResourceSignalsOnCreate'
    Timeout: PT10M
  AutoScalingCreationPolicy:
    MinSuccessfulInstancesPercent: !Ref 'MinSuccessfulPercentParameter'</code></pre>
      </div>
     
     
      <h3 id="w9aac34c23c23c23b9">在更新 cfn-init 協助程式指令碼的中繼資料時維持可用性</h3>

      <p>在執行個體上安裝軟體應用程式時，您可以使用中<a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-resource-init.html"><code class="code">AWS::CloudFormation::Init</code></a>繼資料金鑰和<a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/cfn-init.html"><code>cfn-init</code></a>輔助程式指令碼來啟動 Auto Scaling 群組中的執行個體。  CloudFormation 安裝套件、執行命令，以及執行中繼資料中描述的其他啟動載入動作。</p>
      <p>當您僅更新中繼資料時 (例如，將套件更新為另一個版本時)，可使用 <code><a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/cfn-hup.html">cfn-hup</a></code> 協助程式以偵測和套用更新。但是，<code>cfn-hup</code> 協助程式獨立執行於每個執行個體。如果協助程式剛好在所有執行個體上同時執行，您的應用程式或服務在更新期間可能會無法使用。為了保證可用性，您可以強制進行滾動更新，以便一次 CloudFormation 更新一個批次的執行個體。</p>
      <div class="awsdocs-note awsdocs-important"><div class="awsdocs-note-title"><awsui-icon name="status-warning" variant="error"></awsui-icon><h6>重要</h6></div><div class="awsdocs-note-text"><p>強制滾動更新需 CloudFormation 要創建一個新實例，然後刪除舊實例。存放在舊執行個體的任何資訊都會遺失。</p></div></div>
      <p>若要強制滾動更新，請變更啟動組態資源的邏輯 ID，然後更新堆疊以及指向原始邏輯 ID 的任何參照 (例如相關聯的 Auto Scaling 群組)。  CloudFormation 觸發 Auto Scaling 群組的滾動式更新，取代所有執行個體。</p>
     
     
      <h3 id="w9aac34c23c23c23c11">原始範本</h3>

      <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="複製"><awsui-icon name="copy"></awsui-icon></div></div><code class="json ">"LaunchConfig": <span>{</span>
  "Type" : "AWS::AutoScaling::LaunchConfiguration",
  "Metadata" : <span>{</span>
    "Comment" : "Install a simple PHP application",
    "AWS::CloudFormation::Init" : <span>{</span>
    ...
    }
  }
}</code></pre>
     
     
      <h3 id="w9aac34c23c23c23c13">更新的邏輯 ID</h3>

      <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="複製"><awsui-icon name="copy"></awsui-icon></div></div><code class="json ">"<b>LaunchConfigUpdateRubygemsPkg</b>": <span>{</span>
  "Type" : "AWS::AutoScaling::LaunchConfiguration",
  "Metadata" : <span>{</span>
    "Comment" : "Install a simple PHP application",
    "AWS::CloudFormation::Init" : <span>{</span>
    ...
    }
  }
}</code></pre>
     
     
      <h3 id="aws-resource-lambda-alias-example">Lambda 別名更新政策</h3>
      <p>以下範例指定 <code class="code">UpdatePolicy</code> 資源的 <code class="code">AWS::Lambda::Alias</code> 屬性。部署的所有詳細資訊皆由傳遞至政策的應用程式和部署群組所定義。</p>
      <div id="JSON" name="JSON" class="section langfilter">
        <h4 id="aws-attribute-updatepolicy-codedeploylambda.json">JSON</h4>

        <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="複製"><awsui-icon name="copy"></awsui-icon></div></div><code class="json ">"Alias": <span>{</span>
  "Type": "AWS::Lambda::Alias",
  "Properties": <span>{</span>
    "FunctionName": <span>{</span>
      "Ref": "LambdaFunction"
    },
    "FunctionVersion": <span>{</span>
      "Fn::GetAtt": [
        "FunctionVersionTwo",
        "Version"
      ]
    },
    "Name": "MyAlias"
  },
  "UpdatePolicy": <span>{</span>
    "CodeDeployLambdaAliasUpdate": <span>{</span>
      "ApplicationName": <span>{</span>
        "Ref": "CodeDeployApplication"
      },
      "DeploymentGroupName": <span>{</span>
        "Ref": "CodeDeployDeploymentGroup"
      },
      "BeforeAllowTrafficHook": <span>{</span>
        "Ref": "PreHookLambdaFunction"
      },
      "AfterAllowTrafficHook": <span>{</span>
        "Ref": "PreHookLambdaFunction"
      }
    }
  }
}</code></pre>
      </div>
      <div id="YAML" name="YAML" class="section langfilter">
        <h4 id="aws-attribute-updatepolicy-codedeploylambda-example.yaml">YAML</h4>

        <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="複製"><awsui-icon name="copy"></awsui-icon></div></div><code class="yaml ">Alias:
  Type: 'AWS::Lambda::Alias'
  Properties:
    FunctionName: !Ref LambdaFunction
    FunctionVersion: !GetAtt FunctionVersionTwo.Version
    Name: MyAlias
  UpdatePolicy:
    CodeDeployLambdaAliasUpdate:
      ApplicationName: !Ref CodeDeployApplication
      DeploymentGroupName: !Ref CodeDeployDeploymentGroup
      BeforeAllowTrafficHook: !Ref PreHookLambdaFunction
      AfterAllowTrafficHook: !Ref PreHookLambdaFunction</code></pre>
      </div>
     
  <awsdocs-copyright class="copyright-print"></awsdocs-copyright><awsdocs-thumb-feedback right-edge="{{$ctrl.thumbFeedbackRightEdge}}"></awsdocs-thumb-feedback></div><noscript><div><div><div><div id="js_error_message"><p><img src="https://d1ge0kk1l5kms0.cloudfront.net/images/G/01/webservices/console/warning.png" alt="警告" /> <strong>您的瀏覽器已停用或無法使用 Javascript。</strong></p><p>您必須啟用 Javascript，才能使用 AWS 文件。請參閱您的瀏覽器說明頁以取得說明。</p></div></div></div></div></noscript><div id="main-col-footer" class="awsui-util-font-size-0"><div id="doc-conventions"><a target="_top" href="/general/latest/gr/docconventions.html">文件慣用形式</a></div><div class="prev-next"><div id="previous" class="prev-link" accesskey="p" href="./aws-attribute-metadata.html">Metadata</div><div id="next" class="next-link" accesskey="n" href="./aws-attribute-updatereplacepolicy.html">UpdateReplacePolicy</div></div></div><awsdocs-page-utilities></awsdocs-page-utilities></div><div id="quick-feedback-yes" style="display: none;"><div class="title">此頁面是否有幫助？ - 是</div><div class="content"><p>感謝您，讓我們知道我們做得很好！</p><p>若您有空，歡迎您告知我們值得讚許的地方，這樣才能保持良好服務。</p><p><awsui-button id="fblink" rel="noopener noreferrer" target="_blank" text="意見回饋" click="linkClick($event)" href="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=CloudFormation&amp;topic_url=https://docs.aws.amazon.com/zh_tw/AWSCloudFormation/latest/UserGuide/aws-attribute-updatepolicy.html"></awsui-button></p></div></div><div id="quick-feedback-no" style="display: none;"><div class="title">此頁面是否有幫助？ - 否</div><div class="content"><p>感謝讓我們知道此頁面仍須改善。很抱歉，讓您失望。</p><p>若您有空，歡迎您提供改善文件的方式。</p><p><awsui-button id="fblink" rel="noopener noreferrer" target="_blank" text="意見回饋" click="linkClick($event)" href="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=CloudFormation&amp;topic_url=https://docs.aws.amazon.com/zh_tw/AWSCloudFormation/latest/UserGuide/aws-attribute-updatepolicy.html"></awsui-button></p></div></div></div></body></div></awsdocs-view><div class="page-loading-indicator" id="page-loading-indicator"><awsui-spinner size="large"></awsui-spinner></div></div><div id="tools-panel" dom-region="tools"><awsdocs-tools-panel id="awsdocs-tools-panel"></awsdocs-tools-panel></div></awsui-app-layout><awsdocs-cookie-banner class="doc-cookie-banner"></awsdocs-cookie-banner></div></body></html>