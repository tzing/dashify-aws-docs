<!DOCTYPE html>
    <html xmlns="http://www.w3.org/1999/xhtml" lang="zh-TW"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>變更集範例 - AWS CloudFormation</title><meta name="viewport" content="width=device-width,initial-scale=1" /><meta name="assets_root" content="/assets" /><meta name="target_state" content="using-cfn-updating-stacks-changesets-samples" /><meta name="default_state" content="using-cfn-updating-stacks-changesets-samples" /><link rel="icon" type="image/ico" href="/assets/images/favicon.ico" /><link rel="shortcut icon" type="image/ico" href="/assets/images/favicon.ico" /><link rel="canonical" href="https://docs.aws.amazon.com/zh_tw/AWSCloudFormation/latest/UserGuide/using-cfn-updating-stacks-changesets-samples.html" /><meta name="description" content="從範例 AWS CloudFormation 變更集中學習。" /><meta name="deployment_region" content="IAD" /><meta name="product" content="AWS CloudFormation" /><meta name="guide" content="使用者指南" /><meta name="abstract" content="使 AWS CloudFormation 用本使用者指南可預測並重複地建立和管理 AWS 基礎架構部署。" /><meta name="guide-locale" content="zh_tw" /><meta name="tocs" content="toc-contents.json" /><link rel="canonical" href="https://docs.aws.amazon.com/zh_tw/AWSCloudFormation/latest/UserGuide/using-cfn-updating-stacks-changesets-samples.html" /><link rel="alternative" href="https://docs.aws.amazon.com/id_id/AWSCloudFormation/latest/UserGuide/using-cfn-updating-stacks-changesets-samples.html" hreflang="id-id" /><link rel="alternative" href="https://docs.aws.amazon.com/id_id/AWSCloudFormation/latest/UserGuide/using-cfn-updating-stacks-changesets-samples.html" hreflang="id" /><link rel="alternative" href="https://docs.aws.amazon.com/de_de/AWSCloudFormation/latest/UserGuide/using-cfn-updating-stacks-changesets-samples.html" hreflang="de-de" /><link rel="alternative" href="https://docs.aws.amazon.com/de_de/AWSCloudFormation/latest/UserGuide/using-cfn-updating-stacks-changesets-samples.html" hreflang="de" /><link rel="alternative" href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/using-cfn-updating-stacks-changesets-samples.html" hreflang="en-us" /><link rel="alternative" href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/using-cfn-updating-stacks-changesets-samples.html" hreflang="en" /><link rel="alternative" href="https://docs.aws.amazon.com/es_es/AWSCloudFormation/latest/UserGuide/using-cfn-updating-stacks-changesets-samples.html" hreflang="es-es" /><link rel="alternative" href="https://docs.aws.amazon.com/es_es/AWSCloudFormation/latest/UserGuide/using-cfn-updating-stacks-changesets-samples.html" hreflang="es" /><link rel="alternative" href="https://docs.aws.amazon.com/fr_fr/AWSCloudFormation/latest/UserGuide/using-cfn-updating-stacks-changesets-samples.html" hreflang="fr-fr" /><link rel="alternative" href="https://docs.aws.amazon.com/fr_fr/AWSCloudFormation/latest/UserGuide/using-cfn-updating-stacks-changesets-samples.html" hreflang="fr" /><link rel="alternative" href="https://docs.aws.amazon.com/it_it/AWSCloudFormation/latest/UserGuide/using-cfn-updating-stacks-changesets-samples.html" hreflang="it-it" /><link rel="alternative" href="https://docs.aws.amazon.com/it_it/AWSCloudFormation/latest/UserGuide/using-cfn-updating-stacks-changesets-samples.html" hreflang="it" /><link rel="alternative" href="https://docs.aws.amazon.com/ja_jp/AWSCloudFormation/latest/UserGuide/using-cfn-updating-stacks-changesets-samples.html" hreflang="ja-jp" /><link rel="alternative" href="https://docs.aws.amazon.com/ja_jp/AWSCloudFormation/latest/UserGuide/using-cfn-updating-stacks-changesets-samples.html" hreflang="ja" /><link rel="alternative" href="https://docs.aws.amazon.com/ko_kr/AWSCloudFormation/latest/UserGuide/using-cfn-updating-stacks-changesets-samples.html" hreflang="ko-kr" /><link rel="alternative" href="https://docs.aws.amazon.com/ko_kr/AWSCloudFormation/latest/UserGuide/using-cfn-updating-stacks-changesets-samples.html" hreflang="ko" /><link rel="alternative" href="https://docs.aws.amazon.com/pt_br/AWSCloudFormation/latest/UserGuide/using-cfn-updating-stacks-changesets-samples.html" hreflang="pt-br" /><link rel="alternative" href="https://docs.aws.amazon.com/pt_br/AWSCloudFormation/latest/UserGuide/using-cfn-updating-stacks-changesets-samples.html" hreflang="pt" /><link rel="alternative" href="https://docs.aws.amazon.com/zh_cn/AWSCloudFormation/latest/UserGuide/using-cfn-updating-stacks-changesets-samples.html" hreflang="zh-cn" /><link rel="alternative" href="https://docs.aws.amazon.com/zh_tw/AWSCloudFormation/latest/UserGuide/using-cfn-updating-stacks-changesets-samples.html" hreflang="zh-tw" /><link rel="alternative" href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/using-cfn-updating-stacks-changesets-samples.html" hreflang="x-default" /><meta name="feedback-item" content="CloudFormation" /><meta name="this_doc_product" content="AWS CloudFormation" /><meta name="this_doc_guide" content="使用者指南" /><script defer="" src="/assets/r/vendor4.js?version=2021.12.02"></script><script defer="" src="/assets/r/vendor3.js?version=2021.12.02"></script><script defer="" src="/assets/r/vendor1.js?version=2021.12.02"></script><script defer="" src="/assets/r/awsdocs-common.js?version=2021.12.02"></script><script defer="" src="/assets/r/awsdocs-doc-page.js?version=2021.12.02"></script><link href="/assets/r/vendor4.css?version=2021.12.02" rel="stylesheet" /><link href="/assets/r/awsdocs-common.css?version=2021.12.02" rel="stylesheet" /><link href="/assets/r/awsdocs-doc-page.css?version=2021.12.02" rel="stylesheet" /><script async="" id="awsc-panorama-bundle" type="text/javascript" src="https://prod.pa.cdn.uis.awsstatic.com/panorama-nav-init.js" data-config="{'appEntity':'aws-documentation','region':'us-east-1','service':'cloudformation'}"></script><meta id="panorama-serviceSubSection" value="使用者指南" /><meta id="panorama-serviceConsolePage" value="變更集範例" /></head><body class="awsdocs awsui"><div class="awsdocs-container"><awsdocs-header></awsdocs-header><awsui-app-layout id="app-layout" class="awsui-util-no-gutters" ng-controller="ContentController as $ctrl" header-selector="awsdocs-header" navigation-hide="false" navigation-width="$ctrl.navWidth" navigation-open="$ctrl.navOpen" navigation-change="$ctrl.onNavChange($event)" tools-hide="$ctrl.hideTools" tools-width="$ctrl.toolsWidth" tools-open="$ctrl.toolsOpen" tools-change="$ctrl.onToolsChange($event)"><div id="guide-toc" dom-region="navigation"><awsdocs-toc></awsdocs-toc></div><div id="main-column" dom-region="content" tabindex="-1"><awsdocs-view class="awsdocs-view"><div id="awsdocs-content"><head><title>變更集範例 - AWS CloudFormation</title><meta name="rss" content="aws-cloudformation-release-notes.rss" /><meta name="forums" content="http://forums.aws.amazon.com/forum.jspa?forumID=92" /><meta name="feedback" content="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=CloudFormation&amp;topic_url=https://docs.aws.amazon.com/zh_tw/AWSCloudFormation/latest/UserGuide/using-cfn-updating-stacks-changesets-samples.html" /><meta name="feedback-yes" content="feedbackyes.html?topic_url=https://docs.aws.amazon.com/zh_tw/AWSCloudFormation/latest/UserGuide/using-cfn-updating-stacks-changesets-samples.html" /><meta name="feedback-no" content="feedbackno.html?topic_url=https://docs.aws.amazon.com/zh_tw/AWSCloudFormation/latest/UserGuide/using-cfn-updating-stacks-changesets-samples.html" /><meta name="keywords" content="CloudFormation,AWSCloudFormation,資源佈建,資源組態,基礎設施管理,CloudFormer,CloudFormation 堆疊,CloudFormation 堆疊集,CloudFormation 範本,變更集合" /><script type="application/ld+json">
{
    "@context" : "https://schema.org",
    "@type" : "BreadcrumbList",
    "itemListElement" : [
      {
        "@type" : "ListItem",
        "position" : 1,
        "name" : "AWS",
        "item" : "https://aws.amazon.com"
      },
      {
        "@type" : "ListItem",
        "position" : 2,
        "name" : "AWS CloudFormation",
        "item" : "https://docs.aws.amazon.com/cloudformation/index.html"
      },
      {
        "@type" : "ListItem",
        "position" : 3,
        "name" : "使用者指南",
        "item" : "https://docs.aws.amazon.com/zh_tw/AWSCloudFormation/latest/UserGuide"
      },
      {
        "@type" : "ListItem",
        "position" : 4,
        "name" : "使用堆疊",
        "item" : "https://docs.aws.amazon.com/zh_tw/AWSCloudFormation/latest/UserGuide/stacks.html"
      },
      {
        "@type" : "ListItem",
        "position" : 5,
        "name" : "AWS CloudFormation 堆疊更新",
        "item" : "https://docs.aws.amazon.com/zh_tw/AWSCloudFormation/latest/UserGuide/using-cfn-updating-stacks.html"
      },
      {
        "@type" : "ListItem",
        "position" : 6,
        "name" : "透過變更集更新堆疊",
        "item" : "https://docs.aws.amazon.com/zh_tw/AWSCloudFormation/latest/UserGuide/using-cfn-updating-stacks-changesets.html"
      },
      {
        "@type" : "ListItem",
        "position" : 7,
        "name" : "變更集範例",
        "item" : "https://docs.aws.amazon.com/zh_tw/AWSCloudFormation/latest/UserGuide/using-cfn-updating-stacks-changesets.html"
      }
    ]
}
</script></head><body><div id="main"><div style="display: none"></div><div id="breadcrumbs" class="breadcrumb"><a href="https://aws.amazon.com">AWS</a><a href="/index.html">文件</a><a href="/cloudformation/index.html">AWS CloudFormation</a><a href="Welcome.html">使用者指南</a></div><div id="page-toc-src"><a href="#using-cfn-updating-stacks-changesets-samples-directly-editing-a-template">直接編輯範本</a><a href="#using-cfn-updating-stacks-changesets-samples-modifying-a-single-input-parameter-value">修改輸入參數值</a><a href="#using-cfn-updating-stacks-changesets-samples-determining-the-value-of-the-replacement-field">判斷 Replacement 欄位的值</a><a href="#using-cfn-updating-stacks-changesets-samples-adding-and-removing-resources">新增與移除資源</a></div><div id="main-content" class="awsui-util-container"><div id="main-col-body"><awsdocs-language-banner data-service="$ctrl.pageService"></awsdocs-language-banner><awsui-alert class="awsdocs-page-banner awsui-util-mb-l"><p>本文為英文版的機器翻譯版本，如內容有任何歧義或不一致之處，概以英文版為準。</p></awsui-alert><h1 class="topictitle" id="using-cfn-updating-stacks-changesets-samples">變更集範例</h1><div class="awsdocs-page-header-container"><awsdocs-page-header></awsdocs-page-header><awsdocs-filter-selector id="awsdocs-filter-selector"></awsdocs-filter-selector></div><p>本節提供將為常見堆疊變更 CloudFormation 建立的變更集範例。這些範例將說明如何直接編輯範本、修改單一輸入參數、規劃資源重新建立 (替換) 作業，以免未備份的資料遺失，或是堆疊中執行的應用程式中斷；透過這些範例，您亦能掌握新增與移除資源的方法。為了示範變更集的運作方式，我們將逐步解說您所提交的變更，並探討隨後產生的變更集。本節的每個範例皆是以先前的範例為建立基礎，且會假設您已掌握之前的釋例，因此建議您按照順序詳讀。如需變更集各欄位的說明，請參閱《AWS CloudFormation API 參考》中的 <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/APIReference/API_Change.html">Change</a> (變更) 資料類型。</p><p>您可以使用<a href="./using-cfn-updating-stacks-changesets-view.html">控制台</a> AWS CLI、或  CloudFormation <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/APIReference/API_DescribeChangeSet.html"><code class="code">DescribeChangeSet</code></a>API 操作來檢視變更集詳細資料。</p><p>為了從堆疊中產生下述各個變更集，此處會採用以下<a href="https://s3.amazonaws.com/cloudformation-examples/user-guide/changesets/ec2-instance.txt" rel="noopener noreferrer" target="_blank"><span>範例範本</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a>：</p><pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="複製"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
  "AWSTemplateFormatVersion" : "2010-09-09",
  "Description" : "A sample EC2 instance template for testing change sets.",
  "Parameters" : <span>{</span>
    "Purpose" : <span>{</span>
      "Type" : "String",
      "Default" : "testing",
      "AllowedValues" : ["testing", "production"],
      "Description" : "The purpose of this instance."
    },
    "KeyPairName" : <span>{</span>
      "Type": "AWS::EC2::KeyPair::KeyName",
      "Description" : "Name of an existing EC2 KeyPair to enable SSH access to the instance"
    },
    "InstanceType" : <span>{</span>
      "Type" : "String",
      "Default" : "t2.micro",
      "AllowedValues" : ["t2.micro", "t2.small", "t2.medium"],
      "Description" : "The EC2 instance type."
    }
  },
  "Resources" : <span>{</span>
    "MyEC2Instance" : <span>{</span>
      "Type" : "AWS::EC2::Instance",
      "Properties" : <span>{</span>
        "KeyName" : <span>{</span> "Ref" : "KeyPairName" },
        "InstanceType" : <span>{</span> "Ref" : "InstanceType" },
        "ImageId" : "ami-8fcee4e5",
        "Tags" : [
          <span>{</span>
            "Key" : "Purpose",
            "Value" : <span>{</span> "Ref" : "Purpose" }
          }
        ]
      }
    }
  }
}</code></pre>
      <h2 id="using-cfn-updating-stacks-changesets-samples-directly-editing-a-template">直接編輯範本</h2>

      <p>當您為產生變更集而在堆疊範本中直接修改資源時， CloudFormation  即會將變更分類成直接修改作業，而不是由更新後參數值所啟動的變更。以下變更集便是直接修改的範例，其會將新標籤新增至 <code class="code">i-1abc23d4</code> 執行個體。由於要著重探討 <code class="code">Changes</code> 結構，參數值和功能等所有其他輸入值皆會保持不變。</p>
      <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="複製"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
    "StackId": "arn:aws:cloudformation:us-east-1:123456789012:stack/SampleStack/1a2345b6-0000-00a0-a123-00abc0abc000",
    "Status": "CREATE_COMPLETE",
    "ChangeSetName": "SampleChangeSet-direct",
    "Parameters": [
        <span>{</span>
            "ParameterValue": "testing",
            "ParameterKey": "Purpose"
        },
        <span>{</span>
            "ParameterValue": "MyKeyName",
            "ParameterKey": "KeyPairName"
        },
        <span>{</span>
            "ParameterValue": "t2.micro",
            "ParameterKey": "InstanceType"
        }
    ],
    "Changes": [
        <span>{</span>
            "ResourceChange": <span>{</span>
                "ResourceType": "AWS::EC2::Instance",
                "PhysicalResourceId": "i-1abc23d4",
                "Details": [
                    <span>{</span>
                        "ChangeSource": "DirectModification",
                        "Evaluation": "Static",
                        "Target": <span>{</span>
                            "Attribute": "Tags",
                            "RequiresRecreation": "Never"
                        }
                    }
                ],
                "Action": "Modify",
                "Scope": [
                    "Tags"
                ],
                "LogicalResourceId": "MyEC2Instance",
                "Replacement": "False"
            },
            "Type": "Resource"
        }
    ],
    "CreationTime": "2020-11-18T23:35:25.813Z",
    "Capabilities": [],
    "StackName": "SampleStack",
    "NotificationARNs": [],
    "ChangeSetId": "arn:aws:cloudformation:us-east-1:123456789012:changeSet/SampleChangeSet-direct/1a2345b6-0000-00a0-a123-00abc0abc000"
}</code></pre>
      <p>在 <code class="code">Changes</code> 結構中，僅有一個 <code class="code">ResourceChange</code> 結構。此結構描述的資訊包括要變更的資源 CloudFormation 類型、 CloudFormation 將採取的動作、資源的 ID、變更範圍，以及變更是否需要取代 (在此處 CloudFormation 建立新資源，然後刪除舊資源)。在此範例中，變更集表示 CloudFormation 將修改 <code class="code">i-1abc23d4</code> EC2 執行個體的<code class="code">Tags</code>屬性，而且不需要取代執行個體。</p>
      <p>在<code class="code">Details</code>結構中，將此變更 CloudFormation 標示為直接修改，永遠不需要重新建立 (取代) 實例。您可以自信地執行此更改，因為知道 CloudFormation 不會取代實例。</p>
      <p>CloudFormation 將此變更顯示為<code class="code">Static</code>評估。靜態評估意味著 CloudFormation 可以在執行變更集之前確定標籤的值。在某些情況下， CloudFormation 只有在執行變更集之後才能決定值。  CloudFormation將這些變更標示為<code class="code">Dynamic</code>評估。例如，如果您參考已有條件取代的更新資源，則 CloudFormation 無法判斷對更新資源的參考是否會變更。</p>
     
      <h2 id="using-cfn-updating-stacks-changesets-samples-modifying-a-single-input-parameter-value">修改輸入參數值</h2>

      <p>修改輸入參數值時， CloudFormation 會為每個使用更新參數值的資源產生兩項變更。在本範例中，我們會詳細說明這些變更的效果，以及應注重的資訊。系統在產生本範例時，僅有變更 <code class="code">Purpose</code> 輸入參數的值。</p>
      <p><code class="code">Purpose</code> 參數會指定 EC2 執行個體的標籤金鑰值。本範例會將 <code class="code">testing</code> 參數值變更為 <code class="code">production</code>。而 <code class="code">Parameters</code> 結構即會顯示新的值。</p>
      <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="複製"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
    "StackId": "arn:aws:cloudformation:us-east-1:123456789012:stack/SampleStack/1a2345b6-0000-00a0-a123-00abc0abc000",
    "Status": "CREATE_COMPLETE",
    "ChangeSetName": "SampleChangeSet",
    "Parameters": [
        <span>{</span>
            "ParameterValue": "production",
            "ParameterKey": "Purpose"
        },
        <span>{</span>
            "ParameterValue": "MyKeyName",
            "ParameterKey": "KeyPairName"
        },
        <span>{</span>
            "ParameterValue": "t2.micro",
            "ParameterKey": "InstanceType"
        }
    ],
    "Changes": [
        <span>{</span>
            "ResourceChange": <span>{</span>
                "ResourceType": "AWS::EC2::Instance",
                "PhysicalResourceId": "i-1abc23d4",
                "Details": [
                    <span>{</span>
                        "ChangeSource": "DirectModification",
                        "Evaluation": "Dynamic",
                        "Target": <span>{</span>
                            "Attribute": "Tags",
                            "RequiresRecreation": "Never"
                        }
                    },
                    <span>{</span>
                        "CausingEntity": "Purpose",
                        "ChangeSource": "ParameterReference",
                        "Evaluation": "Static",
                        "Target": <span>{</span>
                            "Attribute": "Tags",
                            "RequiresRecreation": "Never"
                        }
                    }
                ],
                "Action": "Modify",
                "Scope": [
                    "Tags"
                ],
                "LogicalResourceId": "MyEC2Instance",
                "Replacement": "False"
            },
            "Type": "Resource"
        }
    ],
    "CreationTime": "2020-11-18T23:59:18.447Z",
    "Capabilities": [],
    "StackName": "SampleStack",
    "NotificationARNs": [],
    "ChangeSetId": "arn:aws:cloudformation:us-east-1:123456789012:changeSet/SampleChangeSet/1a2345b6-0000-00a0-a123-00abc0abc000"
}</code></pre>
      <p>此處 <code class="code">Changes</code> 結構的運作方式，將與其在<a href="#using-cfn-updating-stacks-changesets-samples-directly-editing-a-template">直接編輯範本</a>範例中的運作方式類似。意即該結構僅有一個 <code class="code">ResourceChange</code> 結構，且會說明 <code class="code">Tags</code> EC2 執行個體 <code class="code">i-1abc23d4</code> 屬性的變更。</p>
      <p>不過，在 <code class="code">Details</code> 結構中，即便僅變更一個參數值，變更集仍會針對 <code class="code">Tags</code> 屬性顯示兩項變更。若資源是將變更後的參數值作為參考資料 (使用 <code class="code">Ref</code> 內部函數)，一律會產生兩項變更：一項是 <code class="code">Dynamic</code> 評估，另一項則是 <code class="code">Static</code> 評估。如需查看這類型的變更，請檢視下列欄位：</p>
      <div class="itemizedlist">
         
         
      <ul class="itemizedlist"><li class="listitem">
          <p>若變更屬於 <code class="code">Static</code> 評估，請檢視 <code class="code">ChangeSource</code> 欄位。在本範例中，<code class="code">ChangeSource</code> 欄位等於 <code class="code">ParameterReference</code>，這表示此變更是更新後參數參考值所產生的結果；該變更集必須包含類似的 <code class="code">Dynamic</code> 評估變更。</p>
        </li><li class="listitem">
          <p>透過比較兩項變更的 <code class="code">Dynamic</code> 結構，即可找到相符的 <code class="code">Target</code> 評估變更，當中將包含相同資訊。在本範例中，兩項變更的 <code class="code">Target</code> 結構皆涵蓋相同的 <code class="code">Attribute</code> 值和 <code class="code">RequireRecreation</code> 欄位。</p>
        </li></ul></div>
      <p>查看這類型的變更時，應該著重於 Static 評估，因為該評估所提供的變更資訊最為詳細。在本範例中，Static 評估顯示的變更屬於參數參考值 (<code class="code">ParameterReference</code>) 的更改結果；<code class="code">CauseEntity</code> 欄位 (<code class="code">Purpose</code> 參數) 則會確切指示已變更的參數。</p>
     
      <h2 id="using-cfn-updating-stacks-changesets-samples-determining-the-value-of-the-replacement-field">判斷 Replacement 欄位的值</h2>

      <p><code class="code">ResourceChange</code>結構中的<code class="code">Replacement</code>欄位 CloudFormation 會指出是否要重新建立資源。只需規劃資源的重新建立或替換作業，即可避免未備份的資料遺失，或是堆疊中執行的應用程式中斷。</p>
      <p><code class="code">Replacement</code> 欄位中的值會取決於是否需要替換變更項目，這會視變更 <code class="code">RequiresRecreation</code> 結構中的 <code class="code">Target</code> 欄位指示而定。舉例來說，若 <code class="code">RequiresRecreation</code> 欄位為 <code class="code">Never</code>，則 <code class="code">Replacement</code> 欄位的值將為 <code class="code">False</code>。但是，如果單一資源有多項變更，且每項變更的<code class="code">RequiresRecreation</code>欄位值不同，則會使用最具侵入性的行為來更 CloudFormation 新資源。換而言之，即使多項變更中僅有其中一項需要替換， CloudFormation  仍必須取代整個資源；因此，請將 <code class="code">Replacement</code> 欄位設為 <code class="code">True</code>。</p>
      <p>系統會變更每個 <code class="code">Purpose</code>、<code class="code">InstanceType</code> 和 <code class="code">KeyPairName</code> 參數的值，藉此產生下列變更集，而這些參數皆可供 EC2 執行個體使用。透過這些變更， CloudFormation 將需要取代執行個體，因為<code class="code">Replacement</code>欄位等於<code class="code">True</code>。</p>
      <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="複製"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
    "StackId": "arn:aws:cloudformation:us-east-1:123456789012:stack/SampleStack/1a2345b6-0000-00a0-a123-00abc0abc000",
    "Status": "CREATE_COMPLETE",
    "ChangeSetName": "SampleChangeSet-multiple",
    "Parameters": [
        <span>{</span>
            "ParameterValue": "production",
            "ParameterKey": "Purpose"
        },
        <span>{</span>
            "ParameterValue": "MyNewKeyName",
            "ParameterKey": "KeyPairName"
        },
        <span>{</span>
            "ParameterValue": "t2.small",
            "ParameterKey": "InstanceType"
        }
    ],
    "Changes": [
        <span>{</span>
            "ResourceChange": <span>{</span>
                "ResourceType": "AWS::EC2::Instance",
                "PhysicalResourceId": "i-7bef86f8",
                "Details": [
                    <span>{</span>
                        "ChangeSource": "DirectModification",
                        "Evaluation": "Dynamic",
                        "Target": <span>{</span>
                            "Attribute": "Properties",
                            "Name": "KeyName",
                            "RequiresRecreation": "Always"
                        }
                    },
                    <span>{</span>
                        "ChangeSource": "DirectModification",
                        "Evaluation": "Dynamic",
                        "Target": <span>{</span>
                            "Attribute": "Properties",
                            "Name": "InstanceType",
                            "RequiresRecreation": "Conditionally"
                        }
                    },
                    <span>{</span>
                        "ChangeSource": "DirectModification",
                        "Evaluation": "Dynamic",
                        "Target": <span>{</span>
                            "Attribute": "Tags",
                            "RequiresRecreation": "Never"
                        }
                    },
                    <span>{</span>
                        "CausingEntity": "KeyPairName",
                        "ChangeSource": "ParameterReference",
                        "Evaluation": "Static",
                        "Target": <span>{</span>
                            "Attribute": "Properties",
                            "Name": "KeyName",
                            "RequiresRecreation": "Always"
                        }
                    },
                    <span>{</span>
                        "CausingEntity": "InstanceType",
                        "ChangeSource": "ParameterReference",
                        "Evaluation": "Static",
                        "Target": <span>{</span>
                            "Attribute": "Properties",
                            "Name": "InstanceType",
                            "RequiresRecreation": "Conditionally"
                        }
                    },
                    <span>{</span>
                        "CausingEntity": "Purpose",
                        "ChangeSource": "ParameterReference",
                        "Evaluation": "Static",
                        "Target": <span>{</span>
                            "Attribute": "Tags",
                            "RequiresRecreation": "Never"
                        }
                    }
                ],
                "Action": "Modify",
                "Scope": [
                    "Tags",
                    "Properties"
                ],
                "LogicalResourceId": "MyEC2Instance",
                "Replacement": "True"
            },
            "Type": "Resource"
        }
    ],
    "CreationTime": "2020-11-18T00:39:35.974Z",
    "Capabilities": [],
    "StackName": "SampleStack",
    "NotificationARNs": [],
    "ChangeSetId": "arn:aws:cloudformation:us-east-1:123456789012:changeSet/SampleChangeSet-multiple/1a2345b6-0000-00a0-a123-00abc0abc000"
}</code></pre>
      <p>您可以檢視各項變更 (意即為 <code class="code">Details</code> 結構中的 Static 評估)，藉此找出需替換資源的變更。在此範例中，每個變更對<code class="code">RequireRecreation</code>欄位都有不同的值，但是對屬性的變更具有最具侵入<code class="code">KeyName</code>性的更新行為，總是需要重新設定。  CloudFormation 將替換實例，因為密鑰名稱已更改。</p>
      <p>若金鑰名稱保持不變，則系統變更 <code class="code">InstanceType</code> 屬性時會採取最具侵入性的更新行為 (<code class="code">Conditionally</code>)；如此一來，<code class="code">Replacement</code> 欄位的值將為 <code class="code">Conditionally</code>。若要尋找取 CloudFormation 代例證的條件，請檢視<a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-properties-ec2-instance.html#cfn-ec2-instance-instancetype"><code class="code">InstanceType</code></a>屬性的更新行為。</p>
     
      <h2 id="using-cfn-updating-stacks-changesets-samples-adding-and-removing-resources">新增與移除資源</h2>

      <p>系統將提交修改後的範本，進而產生以下範例；該範本會移除 EC2 執行個體並新增 Auto Scaling 群組與啟動組態。</p>
      <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="複製"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
    "StackId": "arn:aws:cloudformation:us-east-1:123456789012:stack/SampleStack/1a2345b6-0000-00a0-a123-00abc0abc000",
    "Status": "CREATE_COMPLETE",
    "ChangeSetName": "SampleChangeSet-addremove",
    "Parameters": [
        <span>{</span>
            "ParameterValue": "testing",
            "ParameterKey": "Purpose"
        },
        <span>{</span>
            "ParameterValue": "MyKeyName",
            "ParameterKey": "KeyPairName"
        },
        <span>{</span>
            "ParameterValue": "t2.micro",
            "ParameterKey": "InstanceType"
        }
    ],
    "Changes": [
        <span>{</span>
            "ResourceChange": <span>{</span>
                "Action": "Add",
                "ResourceType": "AWS::AutoScaling::AutoScalingGroup",
                "Scope": [],
                "Details": [],
                "LogicalResourceId": "AutoScalingGroup"
            },
            "Type": "Resource"
        },
        <span>{</span>
            "ResourceChange": <span>{</span>
                "Action": "Add",
                "ResourceType": "AWS::AutoScaling::LaunchConfiguration",
                "Scope": [],
                "Details": [],
                "LogicalResourceId": "LaunchConfig"
            },
            "Type": "Resource"
        },
        <span>{</span>
            "ResourceChange": <span>{</span>
                "ResourceType": "AWS::EC2::Instance",
                "PhysicalResourceId": "i-1abc23d4",
                "Details": [],
                "Action": "Remove",
                "Scope": [],
                "LogicalResourceId": "MyEC2Instance"
            },
            "Type": "Resource"
        }
    ],
    "CreationTime": "2020-11-18T01:44:08.444Z",
    "Capabilities": [],
    "StackName": "SampleStack",
    "NotificationARNs": [],
    "ChangeSetId": "arn:aws:cloudformation:us-east-1:123456789012:changeSet/SampleChangeSet-addremove/1a2345b6-0000-00a0-a123-00abc0abc000"
}</code></pre>
      <p><code class="code">Changes</code> 結構中有三種 <code class="code">ResourceChange</code> 結構，每個資源各有一種結構。對於每個資源，該<code class="code">Action</code>字段指示是 CloudFormation 添加還是刪除資源。<code class="code">Scope</code> 和 <code class="code">Details</code> 欄位則沒有內容，因為這些欄位僅適用於修改後的資源。</p>
      <p>對於新資源， CloudFormation 在執行變更集之前，無法判斷某些欄位的值。例如， CloudFormation 不提供 Auto Scaling 群組的實體 ID 和啟動設定，因為它們尚不存在。  CloudFormation 當您執行變更集時，會建立新資源。</p>
    <awsdocs-copyright class="copyright-print"></awsdocs-copyright><awsdocs-thumb-feedback right-edge="{{$ctrl.thumbFeedbackRightEdge}}"></awsdocs-thumb-feedback></div><noscript><div><div><div><div id="js_error_message"><p><img src="https://d1ge0kk1l5kms0.cloudfront.net/images/G/01/webservices/console/warning.png" alt="警告" /> <strong>您的瀏覽器已停用或無法使用 Javascript。</strong></p><p>您必須啟用 Javascript，才能使用 AWS 文件。請參閱您的瀏覽器說明頁以取得說明。</p></div></div></div></div></noscript><div id="main-col-footer" class="awsui-util-font-size-0"><div id="doc-conventions"><a target="_top" href="/general/latest/gr/docconventions.html">文件慣用形式</a></div><div class="prev-next"><div id="previous" class="prev-link" accesskey="p" href="./using-cfn-updating-stacks-changesets-delete.html">刪除變更集</div><div id="next" class="next-link" accesskey="n" href="./using-cfn-updating-stacks-direct.html">直接更新堆疊</div></div></div><awsdocs-page-utilities></awsdocs-page-utilities></div><div id="quick-feedback-yes" style="display: none;"><div class="title">此頁面是否有幫助？ - 是</div><div class="content"><p>感謝您，讓我們知道我們做得很好！</p><p>若您有空，歡迎您告知我們值得讚許的地方，這樣才能保持良好服務。</p><p><awsui-button id="fblink" rel="noopener noreferrer" target="_blank" text="意見回饋" click="linkClick($event)" href="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=CloudFormation&amp;topic_url=https://docs.aws.amazon.com/zh_tw/AWSCloudFormation/latest/UserGuide/using-cfn-updating-stacks-changesets-samples.html"></awsui-button></p></div></div><div id="quick-feedback-no" style="display: none;"><div class="title">此頁面是否有幫助？ - 否</div><div class="content"><p>感謝讓我們知道此頁面仍須改善。很抱歉，讓您失望。</p><p>若您有空，歡迎您提供改善文件的方式。</p><p><awsui-button id="fblink" rel="noopener noreferrer" target="_blank" text="意見回饋" click="linkClick($event)" href="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=CloudFormation&amp;topic_url=https://docs.aws.amazon.com/zh_tw/AWSCloudFormation/latest/UserGuide/using-cfn-updating-stacks-changesets-samples.html"></awsui-button></p></div></div></div></body></div></awsdocs-view><div class="page-loading-indicator" id="page-loading-indicator"><awsui-spinner size="large"></awsui-spinner></div></div><div id="tools-panel" dom-region="tools"><awsdocs-tools-panel id="awsdocs-tools-panel"></awsdocs-tools-panel></div></awsui-app-layout><awsdocs-cookie-banner class="doc-cookie-banner"></awsdocs-cookie-banner></div></body></html>