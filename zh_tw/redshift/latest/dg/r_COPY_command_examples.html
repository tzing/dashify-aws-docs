<!DOCTYPE html>
    <html xmlns="http://www.w3.org/1999/xhtml" lang="zh-TW"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>COPY 範例 - Amazon Redshift</title><meta name="viewport" content="width=device-width,initial-scale=1" /><meta name="assets_root" content="/assets" /><meta name="target_state" content="r_COPY_command_examples" /><meta name="default_state" content="r_COPY_command_examples" /><link rel="icon" type="image/ico" href="/assets/images/favicon.ico" /><link rel="shortcut icon" type="image/ico" href="/assets/images/favicon.ico" /><link rel="canonical" href="https://docs.aws.amazon.com/zh_tw/redshift/latest/dg/r_COPY_command_examples.html" /><meta name="description" content="提供如何使用 COPY 從各種來源載入資料的範例。" /><meta name="deployment_region" content="IAD" /><meta name="product" content="Amazon Redshift" /><meta name="guide" content="資料庫開發人員指南" /><meta name="abstract" content="使用 Amazon Redshift 這項 PB 級的完全受管企業等級資料倉儲服務，來建立和管理資料倉儲。" /><meta name="guide-locale" content="zh_tw" /><meta name="tocs" content="toc-contents.json" /><link rel="canonical" href="https://docs.aws.amazon.com/zh_tw/redshift/latest/dg/r_COPY_command_examples.html" /><link rel="alternative" href="https://docs.aws.amazon.com/id_id/redshift/latest/dg/r_COPY_command_examples.html" hreflang="id-id" /><link rel="alternative" href="https://docs.aws.amazon.com/id_id/redshift/latest/dg/r_COPY_command_examples.html" hreflang="id" /><link rel="alternative" href="https://docs.aws.amazon.com/de_de/redshift/latest/dg/r_COPY_command_examples.html" hreflang="de-de" /><link rel="alternative" href="https://docs.aws.amazon.com/de_de/redshift/latest/dg/r_COPY_command_examples.html" hreflang="de" /><link rel="alternative" href="https://docs.aws.amazon.com/redshift/latest/dg/r_COPY_command_examples.html" hreflang="en-us" /><link rel="alternative" href="https://docs.aws.amazon.com/redshift/latest/dg/r_COPY_command_examples.html" hreflang="en" /><link rel="alternative" href="https://docs.aws.amazon.com/es_es/redshift/latest/dg/r_COPY_command_examples.html" hreflang="es-es" /><link rel="alternative" href="https://docs.aws.amazon.com/es_es/redshift/latest/dg/r_COPY_command_examples.html" hreflang="es" /><link rel="alternative" href="https://docs.aws.amazon.com/fr_fr/redshift/latest/dg/r_COPY_command_examples.html" hreflang="fr-fr" /><link rel="alternative" href="https://docs.aws.amazon.com/fr_fr/redshift/latest/dg/r_COPY_command_examples.html" hreflang="fr" /><link rel="alternative" href="https://docs.aws.amazon.com/it_it/redshift/latest/dg/r_COPY_command_examples.html" hreflang="it-it" /><link rel="alternative" href="https://docs.aws.amazon.com/it_it/redshift/latest/dg/r_COPY_command_examples.html" hreflang="it" /><link rel="alternative" href="https://docs.aws.amazon.com/ja_jp/redshift/latest/dg/r_COPY_command_examples.html" hreflang="ja-jp" /><link rel="alternative" href="https://docs.aws.amazon.com/ja_jp/redshift/latest/dg/r_COPY_command_examples.html" hreflang="ja" /><link rel="alternative" href="https://docs.aws.amazon.com/ko_kr/redshift/latest/dg/r_COPY_command_examples.html" hreflang="ko-kr" /><link rel="alternative" href="https://docs.aws.amazon.com/ko_kr/redshift/latest/dg/r_COPY_command_examples.html" hreflang="ko" /><link rel="alternative" href="https://docs.aws.amazon.com/pt_br/redshift/latest/dg/r_COPY_command_examples.html" hreflang="pt-br" /><link rel="alternative" href="https://docs.aws.amazon.com/pt_br/redshift/latest/dg/r_COPY_command_examples.html" hreflang="pt" /><link rel="alternative" href="https://docs.aws.amazon.com/zh_cn/redshift/latest/dg/r_COPY_command_examples.html" hreflang="zh-cn" /><link rel="alternative" href="https://docs.aws.amazon.com/zh_tw/redshift/latest/dg/r_COPY_command_examples.html" hreflang="zh-tw" /><link rel="alternative" href="https://docs.aws.amazon.com/redshift/latest/dg/r_COPY_command_examples.html" hreflang="x-default" /><meta name="feedback-item" content="Redshift" /><meta name="this_doc_product" content="Amazon Redshift" /><meta name="this_doc_guide" content="資料庫開發人員指南" /><script defer="" src="/assets/r/vendor4.js?version=2021.12.02"></script><script defer="" src="/assets/r/vendor3.js?version=2021.12.02"></script><script defer="" src="/assets/r/vendor1.js?version=2021.12.02"></script><script defer="" src="/assets/r/awsdocs-common.js?version=2021.12.02"></script><script defer="" src="/assets/r/awsdocs-doc-page.js?version=2021.12.02"></script><link href="/assets/r/vendor4.css?version=2021.12.02" rel="stylesheet" /><link href="/assets/r/awsdocs-common.css?version=2021.12.02" rel="stylesheet" /><link href="/assets/r/awsdocs-doc-page.css?version=2021.12.02" rel="stylesheet" /><script async="" id="awsc-panorama-bundle" type="text/javascript" src="https://prod.pa.cdn.uis.awsstatic.com/panorama-nav-init.js" data-config="{'appEntity':'aws-documentation','region':'us-east-1','service':'redshift'}"></script><meta id="panorama-serviceSubSection" value="資料庫開發人員指南" /><meta id="panorama-serviceConsolePage" value="COPY 範例" /></head><body class="awsdocs awsui"><div class="awsdocs-container"><awsdocs-header></awsdocs-header><awsui-app-layout id="app-layout" class="awsui-util-no-gutters" ng-controller="ContentController as $ctrl" header-selector="awsdocs-header" navigation-hide="false" navigation-width="$ctrl.navWidth" navigation-open="$ctrl.navOpen" navigation-change="$ctrl.onNavChange($event)" tools-hide="$ctrl.hideTools" tools-width="$ctrl.toolsWidth" tools-open="$ctrl.toolsOpen" tools-change="$ctrl.onToolsChange($event)"><div id="guide-toc" dom-region="navigation"><awsdocs-toc></awsdocs-toc></div><div id="main-column" dom-region="content" tabindex="-1"><awsdocs-view class="awsdocs-view"><div id="awsdocs-content"><head><title>COPY 範例 - Amazon Redshift</title><meta name="pdf" content="redshift-dg.pdf#r_COPY_command_examples" /><meta name="rss" content="Dochistory.rss" /><meta name="forums" content="http://forums.aws.amazon.com/forum.jspa?forumID=155" /><meta name="feedback" content="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=Redshift&amp;topic_url=https://docs.aws.amazon.com/zh_tw/redshift/latest/dg/r_COPY_command_examples.html" /><meta name="feedback-yes" content="feedbackyes.html?topic_url=https://docs.aws.amazon.com/zh_tw/redshift/latest/dg/r_COPY_command_examples.html" /><meta name="feedback-no" content="feedbackno.html?topic_url=https://docs.aws.amazon.com/zh_tw/redshift/latest/dg/r_COPY_command_examples.html" /><meta name="keywords" content="Amazon Redshift,AWS Redshift,Redshift,Redshift Spectrum,叢集,資料倉儲,開發人員,範例資料,database,資料庫開發人員,HLL" /><script type="application/ld+json">
{
    "@context" : "https://schema.org",
    "@type" : "BreadcrumbList",
    "itemListElement" : [
      {
        "@type" : "ListItem",
        "position" : 1,
        "name" : "AWS",
        "item" : "https://aws.amazon.com"
      },
      {
        "@type" : "ListItem",
        "position" : 2,
        "name" : "Amazon Redshift",
        "item" : "https://docs.aws.amazon.com/redshift/index.html"
      },
      {
        "@type" : "ListItem",
        "position" : 3,
        "name" : "資料庫開發人員指南",
        "item" : "https://docs.aws.amazon.com/zh_tw/redshift/latest/dg"
      },
      {
        "@type" : "ListItem",
        "position" : 4,
        "name" : "SQL 參考",
        "item" : "https://docs.aws.amazon.com/zh_tw/redshift/latest/dg/cm_chap_SQLCommandRef.html"
      },
      {
        "@type" : "ListItem",
        "position" : 5,
        "name" : "SQL 命令",
        "item" : "https://docs.aws.amazon.com/zh_tw/redshift/latest/dg/c_SQL_commands.html"
      },
      {
        "@type" : "ListItem",
        "position" : 6,
        "name" : "COPY",
        "item" : "https://docs.aws.amazon.com/zh_tw/redshift/latest/dg/r_COPY.html"
      },
      {
        "@type" : "ListItem",
        "position" : 7,
        "name" : "COPY 範例",
        "item" : "https://docs.aws.amazon.com/zh_tw/redshift/latest/dg/r_COPY.html"
      }
    ]
}
</script></head><body><div id="main"><div style="display: none"><a href="redshift-dg.pdf#r_COPY_command_examples" target="_blank" rel="noopener noreferrer" title="開啟 PDF"></a></div><div id="breadcrumbs" class="breadcrumb"><a href="https://aws.amazon.com">AWS</a><a href="/index.html">文件</a><a href="/redshift/index.html">Amazon Redshift</a><a href="welcome.html">資料庫開發人員指南</a></div><div id="page-toc-src"><a href="#r_COPY_command_examples-load-favoritemovies-from-an-amazon-dynamodb-table">從 DynamoDB 資料表載入 FAVORITEMOVIES</a><a href="#r_COPY_command_examples-load-listing-from-an-amazon-s3-bucket">從 Amazon S3 儲存貯體載入 LISTING</a><a href="#copy-command-examples-emr">從 Amazon EMR 叢集載入 LISTING</a><a href="#copy-command-examples-manifest">使用資訊清單指定資料檔案</a><a href="#r_COPY_command_examples-load-listing-from-a-pipe-delimited-file-default-delimiter">從縱線分隔檔案 (預設分隔符號) 載入 LISTING</a><a href="#r_COPY_command_examples-load-listing-from-parquet">使用 Parquet 格式的單欄資料載入 LISTING</a><a href="#r_COPY_command_examples-load-listing-from-orc">使用 ORC 格式的單欄資料載入 LISTING</a><a href="#r_COPY_command_examples-load-event-with-options">使用選項載入 EVENT</a><a href="#r_COPY_command_examples-load-venue-from-a-fixed-width-data-file">從固定寬度資料檔案載入 VENUE</a><a href="#load-from-csv">從 CSV 檔案載入 CATEGORY</a><a href="#r_COPY_command_examples-load-venue-with-explicit-values-for-an-identity-column">載入 VENUE 時將明確值提供給 IDENTITY 欄</a><a href="#r_COPY_command_examples-load-time-from-a-pipe-delimited-gzip-file">從縱線分隔 GZIP 檔案載入 TIME</a><a href="#r_COPY_command_examples-load-a-time-datestamp">載入時間戳記或日期戳記</a><a href="#r_COPY_command_examples-load-data-from-a-file-with-default-values">從含有預設值的檔案載入資料</a><a href="#r_COPY_command_examples-copy-data-with-the-escape-option">搭配 ESCAPE 選項來 COPY 資料</a><a href="#r_COPY_command_examples-copy-from-json">從 JSON 複製的範例</a><a href="#r_COPY_command_examples-copy-from-avro">從 Avro 複製的範例</a><a href="#r_COPY_preparing_data">準備要搭配 ESCAPE 選項來 COPY 的檔案</a><a href="#copy-example-spatial-copy-shapefile">載入 Shapefile</a><a href="#r_COPY_command_examples-load-noload-option">具有 NOLOAD 選項的 COPY 命令</a></div><div id="main-content" class="awsui-util-container"><div id="main-col-body"><awsdocs-language-banner data-service="$ctrl.pageService"></awsdocs-language-banner><awsui-alert class="awsdocs-page-banner awsui-util-mb-l"><p>本文為英文版的機器翻譯版本，如內容有任何歧義或不一致之處，概以英文版為準。</p></awsui-alert><h1 class="topictitle" id="r_COPY_command_examples">COPY 範例</h1><div class="awsdocs-page-header-container"><awsdocs-page-header></awsdocs-page-header><awsdocs-filter-selector id="awsdocs-filter-selector"></awsdocs-filter-selector></div><div class="awsdocs-note"><div class="awsdocs-note-title"><awsui-icon name="status-info" variant="link"></awsui-icon><h6>注意</h6></div><div class="awsdocs-note-text"><p>這些範例包含換行以方便閱讀。請勿在 <em>credentials-args</em> 字串中包含換行或空格。</p></div></div><div class="highlights" id="inline-topiclist"><h6>主題</h6><ul><li><a href="#r_COPY_command_examples-load-favoritemovies-from-an-amazon-dynamodb-table">從 DynamoDB 資料表載入 FAVORITEMOVIES</a></li><li><a href="#r_COPY_command_examples-load-listing-from-an-amazon-s3-bucket">從 Amazon S3 儲存貯體載入 LISTING</a></li><li><a href="#copy-command-examples-emr">從 Amazon EMR 叢集載入 LISTING</a></li><li><a href="#copy-command-examples-manifest">使用資訊清單指定資料檔案</a></li><li><a href="#r_COPY_command_examples-load-listing-from-a-pipe-delimited-file-default-delimiter">從縱線分隔檔案 (預設分隔符號) 載入 LISTING</a></li><li><a href="#r_COPY_command_examples-load-listing-from-parquet">使用 Parquet 格式的單欄資料載入 LISTING</a></li><li><a href="#r_COPY_command_examples-load-listing-from-orc">使用 ORC 格式的單欄資料載入 LISTING</a></li><li><a href="#r_COPY_command_examples-load-event-with-options">使用選項載入 EVENT</a></li><li><a href="#r_COPY_command_examples-load-venue-from-a-fixed-width-data-file">從固定寬度資料檔案載入 VENUE</a></li><li><a href="#load-from-csv">從 CSV 檔案載入 CATEGORY</a></li><li><a href="#r_COPY_command_examples-load-venue-with-explicit-values-for-an-identity-column">載入 VENUE 時將明確值提供給 IDENTITY 欄</a></li><li><a href="#r_COPY_command_examples-load-time-from-a-pipe-delimited-gzip-file">從縱線分隔 GZIP 檔案載入 TIME</a></li><li><a href="#r_COPY_command_examples-load-a-time-datestamp">載入時間戳記或日期戳記</a></li><li><a href="#r_COPY_command_examples-load-data-from-a-file-with-default-values">從含有預設值的檔案載入資料</a></li><li><a href="#r_COPY_command_examples-copy-data-with-the-escape-option">搭配 ESCAPE 選項來 COPY 資料</a></li><li><a href="#r_COPY_command_examples-copy-from-json">從 JSON 複製的範例</a></li><li><a href="#r_COPY_command_examples-copy-from-avro">從 Avro 複製的範例</a></li><li><a href="#r_COPY_preparing_data">準備要搭配 ESCAPE 選項來 COPY 的檔案</a></li><li><a href="#copy-example-spatial-copy-shapefile">將 Shapefile 載入 Amazon Redshift</a></li><li><a href="#r_COPY_command_examples-load-noload-option">具有 NOLOAD 選項的 COPY 命令</a></li></ul></div>
         <h2 id="r_COPY_command_examples-load-favoritemovies-from-an-amazon-dynamodb-table">從 DynamoDB 資料表載入 FAVORITEMOVIES</h2>


         <p>AWS SDK 包括建立名為 <em>Movies</em> 之 DynamoDB 資料表的簡單範例。(關於此範例，請參閱 <a href="https://docs.aws.amazon.com/amazondynamodb/latest/developerguide/GettingStarted.html">DynamoDB 入門</a>。) 下列範例將 DynamoDB 資料表中的資料載入 Amazon Redshift MOVIES 資料表。Amazon Redshift 資料表必須已存在於資料庫中。</p>
         <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="複製"><awsui-icon name="copy"></awsui-icon></div></div><code class="">copy favoritemovies from 'dynamodb://Movies'
iam_role 'arn:aws:iam::0123456789012:role/MyRedshiftRole' 
readratio 50;</code></pre>
       
         <h2 id="r_COPY_command_examples-load-listing-from-an-amazon-s3-bucket">從 Amazon S3 儲存貯體載入 LISTING</h2>


         <p>以下範例從 Amazon S3 儲存貯體載入 LISTING。COPY 命令會載入 <code class="code">/data/listing/</code> 資料夾中的所有檔案。</p>
         <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="複製"><awsui-icon name="copy"></awsui-icon></div></div><code class="">copy listing
from 's3://mybucket/data/listing/' 
iam_role 'arn:aws:iam::0123456789012:role/MyRedshiftRole';</code></pre>
       
         <h2 id="copy-command-examples-emr">從 Amazon EMR 叢集載入 LISTING</h2>

         <p>下列範例從 Amazon EMR 叢集的 lzop 壓縮檔案中，將 Tab 字元分隔資料載入 SALES 資料表。COPY 會載入 <code class="code">myoutput/</code> 資料夾中開頭為 <code class="code">part-</code> 的每個檔案。</p>
         <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="複製"><awsui-icon name="copy"></awsui-icon></div></div><code class="">copy sales
from 'emr://j-SAMPLE2B500FC/myoutput/part-*' 
iam_role 'arn:aws:iam::0123456789012:role/MyRedshiftRole'
delimiter '\t' lzop;</code></pre>
         <p>下列範例將 Amazon EMR 叢集上的 JSON 格式資料載入 SALES 資料表。COPY 會載入 <code class="code">myoutput/json/</code> 資料夾中的每個檔案。</p>
         <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="複製"><awsui-icon name="copy"></awsui-icon></div></div><code class="">copy sales
from 'emr://j-SAMPLE2B500FC/myoutput/json/' 
iam_role 'arn:aws:iam::0123456789012:role/MyRedshiftRole'
JSON 's3://mybucket/jsonpaths.txt';</code></pre>
       
         <h2 id="copy-command-examples-manifest">使用資訊清單指定資料檔案</h2>

         <p>您可以使用清單檔案來確保 COPY 命令從 Amazon S3 載入所有必要檔案 (且只有必要檔案)。需要從不同儲存貯體載入多個檔案，或載入不共用相同字首的檔案時，您也可以使用資訊清單。</p>
         <p>例如，假設您需要載入下列三個檔案：<code class="code">custdata1.txt</code>、<code class="code">custdata2.txt</code> 和 <code class="code">custdata3.txt</code>。您可以使用下列命令指定字首，以載入 <code class="code">mybucket</code> 中開頭為 <code class="code">custdata</code> 的所有檔案：</p>
         <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="複製"><awsui-icon name="copy"></awsui-icon></div></div><code class="">copy category
from 's3://mybucket/custdata' 
iam_role 'arn:aws:iam::0123456789012:role/MyRedshiftRole';</code></pre>
         <p>如果因為錯誤而只有兩個檔案存在，則 COPY 只會載入那兩個檔案，然後就順利完成，導致資料載入不完整。如果儲存貯體中有一個不需要的檔案剛好也使用相同的字首，例如名為 <code class="code">custdata.backup</code> 的檔案，則 COPY 也會載入此檔案，導致載入不需要的資料。</p>
         <p>若要確保載入所有必要檔案並防止載入不需要的檔案，您可以使用資訊清單檔案。資訊清單是 JSON 格式的文字檔案，其中列出要由 COPY 命令處理的檔案。例如，下列資訊清單會載入上述範例中的三個檔案。</p>
         <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="複製"><awsui-icon name="copy"></awsui-icon></div></div><code class=""><span>{</span>  
   "entries":[  
      <span>{</span>  
         "url":"s3://mybucket/custdata.1",
         "mandatory":true
      },
      <span>{</span>  
         "url":"s3://mybucket/custdata.2",
         "mandatory":true
      },
      <span>{</span>  
         "url":"s3://mybucket/custdata.3",
         "mandatory":true
      }
   ]
}</code></pre>
         <p>選用的 <code class="code">mandatory</code> 旗標指出如果檔案不存在，則 COPY 是否應該終止。預設值為 <code class="code">false</code>。不考慮任何必要設定，只要找不到檔案，COPY 就會終止。在此範例中，如果找不到任何檔案，COPY 會傳回錯誤。如果您僅指定金鑰前綴 (例如 <code class="code">custdata.backup</code>)，則可能已挑選的不必要檔案會被忽略，因為這些檔案不在資訊清單上。</p>
         <p>載入格式為 ORC 或 Parquet 的資料檔案時，需要 <code class="code">meta</code> 欄位，如下列範例所示。</p>
         <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="複製"><awsui-icon name="copy"></awsui-icon></div></div><code class=""><span>{</span>  
   "entries":[  
      <span>{</span>  
         "url":"s3://mybucket-alpha/orc/2013-10-04-custdata",
         "mandatory":true,
         "meta":<span>{</span>  
            "content_length":99
         }
      },
      <span>{</span>  
         "url":"s3://mybucket-beta/orc/2013-10-05-custdata",
         "mandatory":true,
         "meta":<span>{</span>  
            "content_length":99
         }
      }
   ]
}</code></pre>
         <p>以下範例使用名為 <code class="code">cust.manifest</code> 的資訊清單。</p>
         <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="複製"><awsui-icon name="copy"></awsui-icon></div></div><code class="">copy customer
from 's3://mybucket/cust.manifest' 
iam_role 'arn:aws:iam::0123456789012:role/MyRedshiftRole'
format as orc
manifest;</code></pre>
         <p>您可以使用資訊清單從不同儲存貯體載入檔案，或載入不共用相同字首的檔案。下列範例示範的 JSON 會從名稱開頭為日期戳記的檔案載入資料。</p>
         <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="複製"><awsui-icon name="copy"></awsui-icon></div></div><code class=""><span>{</span>
  "entries": [
    <span>{</span>"url":"s3://mybucket/2013-10-04-custdata.txt","mandatory":true},
    <span>{</span>"url":"s3://mybucket/2013-10-05-custdata.txt","mandatory":true},
    <span>{</span>"url":"s3://mybucket/2013-10-06-custdata.txt","mandatory":true},
    <span>{</span>"url":"s3://mybucket/2013-10-07-custdata.txt","mandatory":true}
  ]
}</code></pre>
         <p>清單檔案可以列出不同儲存貯體中的檔案，前提是儲存貯體位於叢集所在的同一 AWS 區域。</p>
         <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="複製"><awsui-icon name="copy"></awsui-icon></div></div><code class=""><span>{</span>
  "entries": [
    <span>{</span>"url":"s3://mybucket-alpha/custdata1.txt","mandatory":false},
    <span>{</span>"url":"s3://mybucket-beta/custdata1.txt","mandatory":false},
    <span>{</span>"url":"s3://mybucket-beta/custdata2.txt","mandatory":false}
  ]
}</code></pre>
       
         <h2 id="r_COPY_command_examples-load-listing-from-a-pipe-delimited-file-default-delimiter">從縱線分隔檔案 (預設分隔符號) 載入 LISTING</h2>


         <p>下列範例是非常簡單的案例，其中沒有指定任何選項，且輸入檔案包含預設分隔符號，即縱線字元 ('|')。</p>
         <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="複製"><awsui-icon name="copy"></awsui-icon></div></div><code class="">copy listing 
from 's3://mybucket/data/listings_pipe.txt' 
iam_role 'arn:aws:iam::0123456789012:role/MyRedshiftRole';</code></pre>
       
         <h2 id="r_COPY_command_examples-load-listing-from-parquet">使用 Parquet 格式的單欄資料載入 LISTING</h2>
         <p>下列範例從 Amazon S3 上名為 parquet 的資料夾載入資料。</p>
         <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="複製"><awsui-icon name="copy"></awsui-icon></div></div><code class="">copy listing 
from 's3://mybucket/data/listings/parquet/' 
iam_role 'arn:aws:iam::0123456789012:role/MyRedshiftRole'
format as parquet;</code></pre>
       
         <h2 id="r_COPY_command_examples-load-listing-from-orc">使用 ORC 格式的單欄資料載入 LISTING</h2>
         <p>下列範例從 Amazon S3 上名為 <code class="code">orc</code> 的資料夾載入資料。</p>
         <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="複製"><awsui-icon name="copy"></awsui-icon></div></div><code class="">copy listing 
from 's3://mybucket/data/listings/orc/' 
iam_role 'arn:aws:iam::0123456789012:role/MyRedshiftRole'
format as orc;</code></pre>
       
         <h2 id="r_COPY_command_examples-load-event-with-options">使用選項載入 EVENT</h2>


         <p>下列範例將縱線分隔資料載入 EVENT 資料表，並套用下列規則：</p>
         <div class="itemizedlist">
             
             
             
             
         <ul class="itemizedlist"><li class="listitem">
               <p>如果使用成對的引號來括住任何字元字串，則會移除引號。</p>
            </li><li class="listitem">
               <p>都會將空字串和含有空白的字串載入為 NULL 值。</p>
            </li><li class="listitem">
               <p>如果傳回 5 個以上的錯誤，載入會失敗。</p>
            </li><li class="listitem">
               <p>時間戳記值必須符合指定的格式；例如，有效時間戳記為 <code class="code">2008-09-26 05:43:12</code>。</p>
            </li></ul></div>
         <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="複製"><awsui-icon name="copy"></awsui-icon></div></div><code class="">copy event
from 's3://mybucket/data/allevents_pipe.txt' 
iam_role 'arn:aws:iam::0123456789012:role/MyRedshiftRole' 
removequotes
emptyasnull
blanksasnull
maxerror 5
delimiter '|'
timeformat 'YYYY-MM-DD HH:MI:SS';</code></pre>
       
         <h2 id="r_COPY_command_examples-load-venue-from-a-fixed-width-data-file">從固定寬度資料檔案載入 VENUE</h2>


         <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="複製"><awsui-icon name="copy"></awsui-icon></div></div><code class="">copy venue
from 's3://mybucket/data/venue_fw.txt' 
iam_role 'arn:aws:iam::0123456789012:role/MyRedshiftRole'
fixedwidth 'venueid:3,venuename:25,venuecity:12,venuestate:2,venueseats:6';</code></pre>
         <p>上述範例假設資料檔案的格式與所顯示的樣本資料相同。在下列樣本中，空格充當預留位置，讓所有欄都是規格所指明的相同寬度：</p>
         <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="複製"><awsui-icon name="copy"></awsui-icon></div></div><code class="">1  Toyota Park              Bridgeview  IL0
2  Columbus Crew Stadium    Columbus    OH0
3  RFK Stadium              Washington  DC0
4  CommunityAmerica BallparkKansas City KS0
5  Gillette Stadium         Foxborough  MA68756</code></pre>
       
         <h2 id="load-from-csv">從 CSV 檔案載入 CATEGORY</h2>

         <p>假設您想要將下表所示的值載入 CATEGORY。</p>
         <div class="table-container"><div class="table-contents"><table id="w320aac47b9c67c31c25b5"><thead>
                  <tr>
                     <th>catid</th>
                     <th>catgroup</th>
                     <th>catname</th>
                     <th>catdesc </th>
                  </tr>
               </thead>
                  <tr>
                     <td tabindex="-1">12</td>
                     <td tabindex="-1">Shows </td>
                     <td tabindex="-1">Musicals</td>
                     <td tabindex="-1">Musical theatre</td>
                  </tr>
                  <tr>
                     <td tabindex="-1">13</td>
                     <td tabindex="-1">Shows</td>
                     <td tabindex="-1">Plays</td>
                     <td tabindex="-1">All "non-musical" theatre</td>
                  </tr>
                  <tr>
                     <td tabindex="-1">14</td>
                     <td tabindex="-1">Shows</td>
                     <td tabindex="-1">Opera</td>
                     <td tabindex="-1">All opera, light, and "rock" opera</td>
                  </tr>
                  <tr>
                     <td tabindex="-1">15</td>
                     <td tabindex="-1">Concerts</td>
                     <td tabindex="-1">Classical </td>
                     <td tabindex="-1">All symphony, concerto, and choir concerts</td>
                  </tr>

               </table></div></div>
         <p>下列範例顯示文字檔案的內容，欄位值以逗號分隔。</p>
         <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="複製"><awsui-icon name="copy"></awsui-icon></div></div><code class="">12,Shows,Musicals,Musical theatre
13,Shows,Plays,All "non-musical" theatre  
14,Shows,Opera,All opera, light, and "rock" opera
15,Concerts,Classical,All symphony, concerto, and choir concerts</code></pre>
         <p>如果您載入此檔案時使用 DELIMITER 參數來指定逗號分隔輸入，COPY 命令會失敗，因為有些輸入欄位包含逗號。您可以使用 CSV 參數，並以引號字元括住含有逗號的欄位，即可避免此問題。如果引號括住的字串內出現引號字元，則需要多加一個引號字元才能將其逸出。預設引號字元是雙引號，所以您需要多加一個雙引號來逸出每一個雙引號。新的輸入檔案如下所示。</p>
         <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="複製"><awsui-icon name="copy"></awsui-icon></div></div><code class="">12,Shows,Musicals,Musical theatre
13,Shows,Plays,"All ""non-musical"" theatre"
14,Shows,Opera,"All opera, light, and ""rock"" opera"
15,Concerts,Classical,"All symphony, concerto, and choir concerts"</code></pre>
         <p>假設檔案名稱為 <code class="code">category_csv.txt</code>，您可以使用下列 COPY 命令來載入檔案：</p>
         <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="複製"><awsui-icon name="copy"></awsui-icon></div></div><code class="">copy category
from 's3://mybucket/data/category_csv.txt' 
iam_role 'arn:aws:iam::0123456789012:role/MyRedshiftRole' 
csv;</code></pre>
         <p>或者，若要避免需要逸出輸入中的雙引號，您可以使用 QUOTE AS 參數來指定不同的引號字元。例如，下列的 <code class="code">category_csv.txt</code> 版本使用 '<code class="code">%</code>' 做為引號字元。</p>
         <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="複製"><awsui-icon name="copy"></awsui-icon></div></div><code class="">12,Shows,Musicals,Musical theatre
13,Shows,Plays,%All "non-musical" theatre%
14,Shows,Opera,%All opera, light, and "rock" opera%
15,Concerts,Classical,%All symphony, concerto, and choir concerts%</code></pre>
         <p>下列 COPY 命令使用 QUOTE AS 來載入 <code class="code">category_csv.txt</code>：</p>
         <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="複製"><awsui-icon name="copy"></awsui-icon></div></div><code class="">copy category
from 's3://mybucket/data/category_csv.txt' 
iam_role 'arn:aws:iam::0123456789012:role/MyRedshiftRole' 
csv quote as '%';</code></pre>
       
         <h2 id="r_COPY_command_examples-load-venue-with-explicit-values-for-an-identity-column">載入 VENUE 時將明確值提供給 IDENTITY 欄</h2>


         <p>下列範例假設建立 VENUE 資料表時，至少有一欄 (例如 <code class="code">venueid</code> 欄) 指定為 IDENTITY 欄。此命令覆寫 IDENTITY 預設行為，亦即自動產生 IDENTITY 欄的值，而改以從 venue.txt 檔案載入明確值。使用 EXLICIT_IDS 選項時，Amazon Redshift 不會檢查是否將重複的 IDENTITY 值載入到資料表中。</p>
         <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="複製"><awsui-icon name="copy"></awsui-icon></div></div><code class="">copy venue
from 's3://mybucket/data/venue.txt' 
iam_role 'arn:aws:iam::0123456789012:role/MyRedshiftRole'
explicit_ids;</code></pre>
       
         <h2 id="r_COPY_command_examples-load-time-from-a-pipe-delimited-gzip-file">從縱線分隔 GZIP 檔案載入 TIME</h2>


         <p>下列範例從縱線分隔 GZIP 檔案載入 TIME 資料表：</p>
         <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="複製"><awsui-icon name="copy"></awsui-icon></div></div><code class="">copy time
from 's3://mybucket/data/timerows.gz' 
iam_role 'arn:aws:iam::0123456789012:role/MyRedshiftRole'
gzip
delimiter '|';</code></pre>
       
         <h2 id="r_COPY_command_examples-load-a-time-datestamp">載入時間戳記或日期戳記</h2>


         <p>下列範例載入含有格式化時間戳記的資料。</p>
         <div class="awsdocs-note"><div class="awsdocs-note-title"><awsui-icon name="status-info" variant="link"></awsui-icon><h6>注意</h6></div><div class="awsdocs-note-text"><p><code class="code">HH:MI:SS</code> 的 TIMEFORMAT 也可以支援超過 <code class="code">SS</code> 的小數秒，精細程度可達到微秒。此範例中使用的檔案 <code class="code">time.txt</code> 包含一列，即 <code class="code">2009-01-12
               14:15:57.119568</code>。</p></div></div>
         <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="複製"><awsui-icon name="copy"></awsui-icon></div></div><code class="">copy timestamp1 
from 's3://mybucket/data/time.txt' 
iam_role 'arn:aws:iam::0123456789012:role/MyRedshiftRole'
timeformat 'YYYY-MM-DD HH:MI:SS';</code></pre>
         <p>此複製的結果如下所示：</p>
         <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="複製"><awsui-icon name="copy"></awsui-icon></div></div><code class="">select * from timestamp1;
c1
----------------------------
2009-01-12 14:15:57.119568
(1 row)</code></pre>
       
         <h2 id="r_COPY_command_examples-load-data-from-a-file-with-default-values">從含有預設值的檔案載入資料</h2>


         <p>下列範例使用一個從 TICKIT 資料庫中的 VENUE 資料表變化而來的版本。假設 VENUE_NEW 資料表是使用下列陳述式來定義：</p>
         <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="複製"><awsui-icon name="copy"></awsui-icon></div></div><code class="">create table venue_new(
venueid smallint not null,
venuename varchar(100) not null,
venuecity varchar(30),
venuestate char(2),
venueseats integer not null default '1000');</code></pre>
         <p>假設 venue_noseats.txt 資料檔案的 VENUESEATS 欄沒有值，如下列範例所示：</p>
         <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="複製"><awsui-icon name="copy"></awsui-icon></div></div><code class="">1|Toyota Park|Bridgeview|IL|
2|Columbus Crew Stadium|Columbus|OH|
3|RFK Stadium|Washington|DC|
4|CommunityAmerica Ballpark|Kansas City|KS|
5|Gillette Stadium|Foxborough|MA|
6|New York Giants Stadium|East Rutherford|NJ|
7|BMO Field|Toronto|ON|
8|The Home Depot Center|Carson|CA|
9|Dick's Sporting Goods Park|Commerce City|CO|
10|Pizza Hut Park|Frisco|TX|</code></pre>
         <p>下列 COPY 陳述式可成功從檔案載入資料表，並將 DEFAULT 值 ('1000') 套用至省略的欄：</p>
         <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="複製"><awsui-icon name="copy"></awsui-icon></div></div><code class="">copy venue_new(venueid, venuename, venuecity, venuestate) 
from 's3://mybucket/data/venue_noseats.txt' 
iam_role 'arn:aws:iam::0123456789012:role/MyRedshiftRole'
delimiter '|';</code></pre>
         <p>現在檢視已載入的資料表：</p>
         <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="複製"><awsui-icon name="copy"></awsui-icon></div></div><code class="">select * from venue_new order by venueid;
venueid |         venuename          |    venuecity    | venuestate | venueseats
---------+----------------------------+-----------------+------------+------------
1 | Toyota Park                | Bridgeview      | IL         |       1000
2 | Columbus Crew Stadium      | Columbus        | OH         |       1000
3 | RFK Stadium                | Washington      | DC         |       1000
4 | CommunityAmerica Ballpark  | Kansas City     | KS         |       1000
5 | Gillette Stadium           | Foxborough      | MA         |       1000
6 | New York Giants Stadium    | East Rutherford | NJ         |       1000
7 | BMO Field                  | Toronto         | ON         |       1000
8 | The Home Depot Center      | Carson          | CA         |       1000
9 | Dick's Sporting Goods Park | Commerce City   | CO         |       1000
10 | Pizza Hut Park             | Frisco          | TX         |       1000
(10 rows)</code></pre>
         <p>在下列範例中，除了假設檔案不含 VENUESEATS 資料，也假設不含 VENUENAME 資料：</p>
         <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="複製"><awsui-icon name="copy"></awsui-icon></div></div><code class="">1||Bridgeview|IL|
2||Columbus|OH|
3||Washington|DC|
4||Kansas City|KS|
5||Foxborough|MA|
6||East Rutherford|NJ|
7||Toronto|ON|
8||Carson|CA|
9||Commerce City|CO|
10||Frisco|TX|</code></pre>
         <p> 使用同樣的資料表定義，下列 COPY 陳述式會失敗，因為未指定 VENUENAME 的 DEFAULT 值，且 VENUENAME 是 NOT NULL 欄：</p>
         <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="複製"><awsui-icon name="copy"></awsui-icon></div></div><code class="">copy venue(venueid, venuecity, venuestate) 
from 's3://mybucket/data/venue_pipe.txt' 
iam_role 'arn:aws:iam::0123456789012:role/MyRedshiftRole'
delimiter '|';</code></pre>
         <p>現在假設一個使用 IDENTITY 欄的變化版 VENUE 資料表：</p>
         <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="複製"><awsui-icon name="copy"></awsui-icon></div></div><code class="">create table venue_identity(
venueid int identity(1,1),
venuename varchar(100) not null,
venuecity varchar(30),
venuestate char(2),
venueseats integer not null default '1000');</code></pre>
         <p>如同上述範例，假設 VENUESEATS 欄在來源檔案中沒有對應的值。下列 COPY 陳述式可成功載入資料表，包括預先定義的 IDENTITY 資料值，而不是自動產生那些值：</p>
         <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="複製"><awsui-icon name="copy"></awsui-icon></div></div><code class="">copy venue(venueid, venuename, venuecity, venuestate) 
from 's3://mybucket/data/venue_pipe.txt' 
iam_role 'arn:aws:iam::0123456789012:role/MyRedshiftRole'
delimiter '|' explicit_ids;</code></pre>
         <p>此陳述式會失敗，因為不含 IDENTITY 欄 (欄清單中缺少 VENUEID)，卻包含 EXPLICIT_IDS 參數：</p>
         <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="複製"><awsui-icon name="copy"></awsui-icon></div></div><code class="">copy venue(venuename, venuecity, venuestate) 
from 's3://mybucket/data/venue_pipe.txt' 
iam_role 'arn:aws:iam::0123456789012:role/MyRedshiftRole'
delimiter '|' explicit_ids;</code></pre>
         <p>此陳述式會失敗，因為不含 EXPLICIT_IDS 參數：</p>
         <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="複製"><awsui-icon name="copy"></awsui-icon></div></div><code class="">copy venue(venueid, venuename, venuecity, venuestate)
from 's3://mybucket/data/venue_pipe.txt' 
iam_role 'arn:aws:iam::0123456789012:role/MyRedshiftRole'
delimiter '|';</code></pre>
       
         <h2 id="r_COPY_command_examples-copy-data-with-the-escape-option">搭配 ESCAPE 選項來 COPY 資料</h2>


         <p>下列範例示範如何載入符合分隔符號字元 (在此例子中是縱線字元) 的字元。在輸入檔案中，請確定您要載入的所有縱線字元 (|) 都以反斜線字元 (\) 逸出。載入以 ESCAPE 參數載入檔案。</p>
         <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="複製"><awsui-icon name="copy"></awsui-icon></div></div><code class="">$ more redshiftinfo.txt
1|public\|event\|dwuser
2|public\|sales\|dwuser

create table redshiftinfo(infoid int,tableinfo varchar(50));

copy redshiftinfo from 's3://mybucket/data/redshiftinfo.txt' 
iam_role 'arn:aws:iam::0123456789012:role/MyRedshiftRole' 
delimiter '|' escape;

select * from redshiftinfo order by 1;
infoid |       tableinfo
-------+--------------------
1      | public|event|dwuser
2      | public|sales|dwuser
(2 rows)</code></pre>
         <p>如果不指定 ESCAPE 參數，此 COPY 命令會失敗並傳回 <code class="code">Extra column(s)
               found</code> 錯誤。</p>
         <div class="awsdocs-note awsdocs-important"><div class="awsdocs-note-title"><awsui-icon name="status-warning" variant="error"></awsui-icon><h6>重要</h6></div><div class="awsdocs-note-text"><p>如果您使用 COPY 搭配 ESCAPE 參數來載入資料，則在 UNLOAD 命令中也必須指定 ESCAPE 參數，以產生對等的輸出檔案。同樣地，如果使用 ESCAPE 參數來 UNLOAD，則在 COPY 相同的資料時需要使用 ESCAPE。</p></div></div>
       
         <h2 id="r_COPY_command_examples-copy-from-json">從 JSON 複製的範例</h2>

         <p>在下列範例中，您會將下列資料載入 CATEGORY 資料表。</p>
         <div class="table-container"><div class="table-contents"><table id="w320aac47b9c67c31c37b5"><thead>
                  <tr>
                     <th>CATID</th>
                     <th>CATGROUP</th>
                     <th>CATNAME</th>
                     <th>CATDESC</th>
                  </tr>
               </thead>
                  <tr>
                     <td tabindex="-1">1</td>
                     <td tabindex="-1">運動</td>
                     <td tabindex="-1">MLB</td>
                     <td tabindex="-1"> 美國職棒大聯盟</td>
                  </tr>
                  <tr>
                     <td tabindex="-1">2</td>
                     <td tabindex="-1">運動</td>
                     <td tabindex="-1">NHL</td>
                     <td tabindex="-1">National Hockey League</td>
                  </tr>
                  <tr>
                     <td tabindex="-1">3</td>
                     <td tabindex="-1">運動</td>
                     <td tabindex="-1">NFL</td>
                     <td tabindex="-1">National Football League</td>
                  </tr>
                  <tr>
                     <td tabindex="-1">4</td>
                     <td tabindex="-1">運動</td>
                     <td tabindex="-1">NBA</td>
                     <td tabindex="-1">National Basketball Association</td>
                  </tr>
                  <tr>
                     <td tabindex="-1">5</td>
                     <td tabindex="-1">Concerts</td>
                     <td tabindex="-1">Classical</td>
                     <td tabindex="-1">All symphony, concerto, and choir concerts</td>
                  </tr>
               </table></div></div>
         <div class="highlights" id="inline-topiclist"><h6>主題</h6><ul><li><a href="#copy-from-json-examples-using-auto">使用 'auto' 選項從 JSON 資料載入</a></li><li><a href="#copy-from-json-examples-using-auto-ignorecase">使用 'auto ignorecase' 選項從 JSON 資料載入</a></li><li><a href="#copy-from-json-examples-using-jsonpaths">使用 JSONPaths 檔案從 JSON 資料載入</a></li><li><a href="#copy-from-json-examples-using-jsonpaths-arrays">使用 JSONPaths 檔案從 JSON 陣列載入</a></li></ul></div>

          
            <h3 id="copy-from-json-examples-using-auto">使用 'auto' 選項從 JSON 資料載入</h3>

            <p>若要使用 <code class="code">'auto'</code> 選項從 JSON 資料載入，JSON 資料必須包含一組物件。金鑰名稱必須符合欄名稱，但順序並不重要。以下顯示一個名為 <code class="code">category_object_auto.json</code> 之檔案的內容。</p>
            <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="複製"><awsui-icon name="copy"></awsui-icon></div></div><code class=""><span>{</span>
    "catdesc": "Major League Baseball",
    "catid": 1,
    "catgroup": "Sports",
    "catname": "MLB"
}
<span>{</span>
    "catgroup": "Sports",
    "catid": 2,
    "catname": "NHL",
    "catdesc": "National Hockey League"
}<span>{</span>
    "catid": 3,
    "catname": "NFL",
    "catgroup": "Sports",
    "catdesc": "National Football League"
}
<span>{</span>
    "bogus": "Bogus Sports LLC",
    "catid": 4,
    "catgroup": "Sports",
    "catname": "NBA",
    "catdesc": "National Basketball Association"
}
<span>{</span>
    "catid": 5,
    "catgroup": "Shows",
    "catname": "Musicals",
    "catdesc": "All symphony, concerto, and choir concerts"
}</code></pre>
            <p>若要從上述範例的 JSON 資料檔案載入，請執行下列 COPY 命令。</p>
            <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="複製"><awsui-icon name="copy"></awsui-icon></div></div><code class="">copy category
from 's3://mybucket/category_object_auto.json'
iam_role 'arn:aws:iam::0123456789012:role/MyRedshiftRole' 
json 'auto';</code></pre>
          
         
          
            <h3 id="copy-from-json-examples-using-auto-ignorecase">使用 'auto ignorecase' 選項從 JSON 資料載入</h3>
            
            <p>若要使用 <code class="code">'auto ignorecase'</code> 選項從 JSON 資料載入，JSON 資料必須包含一組物件。索引鍵名稱的大小寫不必符合欄名稱，順序也不重要。以下顯示一個名為 <code class="code">category_object_auto-ignorecase.json</code> 之檔案的內容。</p>
            <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="複製"><awsui-icon name="copy"></awsui-icon></div></div><code class=""><span>{</span>
    "CatDesc": "Major League Baseball",
    "CatID": 1,
    "CatGroup": "Sports",
    "CatName": "MLB"
}
<span>{</span>
    "CatGroup": "Sports",
    "CatID": 2,
    "CatName": "NHL",
    "CatDesc": "National Hockey League"
}<span>{</span>
    "CatID": 3,
    "CatName": "NFL",
    "CatGroup": "Sports",
    "CatDesc": "National Football League"
}
<span>{</span>
    "bogus": "Bogus Sports LLC",
    "CatID": 4,
    "CatGroup": "Sports",
    "CatName": "NBA",
    "CatDesc": "National Basketball Association"
}
<span>{</span>
    "CatID": 5,
    "CatGroup": "Shows",
    "CatName": "Musicals",
    "CatDesc": "All symphony, concerto, and choir concerts"
}</code></pre>
            <p>若要從上述範例的 JSON 資料檔案載入，請執行下列 COPY 命令。</p>
            <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="複製"><awsui-icon name="copy"></awsui-icon></div></div><code class="">copy category
from 's3://mybucket/category_object_auto ignorecase.json'
iam_role 'arn:aws:iam::0123456789012:role/MyRedshiftRole' 
json 'auto ignorecase';</code></pre>
          
          
            <h3 id="copy-from-json-examples-using-jsonpaths">使用 JSONPaths 檔案從 JSON 資料載入</h3>
            
            <p>如果 JSON 資料物件沒有直接對應至欄名稱，您可以使用 JSONPaths 檔案將 JSON 元素映射至欄。JSON 來源資料中的順序並不重要，但 JSONPaths 檔案運算式的順序必須符合欄順序。假設您有下列資料檔案，名稱為 <code class="code">category_object_paths.json</code>。</p>
            <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="複製"><awsui-icon name="copy"></awsui-icon></div></div><code class=""><span>{</span>
    "one": 1,
    "two": "Sports",
    "three": "MLB",
    "four": "Major League Baseball"
}
<span>{</span>
    "three": "NHL",
    "four": "National Hockey League",
    "one": 2,
    "two": "Sports"
}
<span>{</span>
    "two": "Sports",
    "three": "NFL",
    "one": 3,
    "four": "National Football League"
}
<span>{</span>
    "one": 4,
    "two": "Sports",
    "three": "NBA",
    "four": "National Basketball Association"
}
<span>{</span>
    "one": 6,
    "two": "Shows",
    "three": "Musicals",
    "four": "All symphony, concerto, and choir concerts"
}</code></pre>
            <p>下列 JSONPaths 檔案 (名為 <code class="code">category_jsonpath.json</code>) 將來源資料映射至資料表欄。</p>
            <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="複製"><awsui-icon name="copy"></awsui-icon></div></div><code class=""><span>{</span>
    "jsonpaths": [
        "$['one']",
        "$['two']",
        "$['three']",
        "$['four']"
    ]
}</code></pre>
            <p>若要從上述範例的 JSON 資料檔案載入，請執行下列 COPY 命令。</p>
            <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="複製"><awsui-icon name="copy"></awsui-icon></div></div><code class="">copy category
from 's3://mybucket/category_object_paths.json'
iam_role 'arn:aws:iam::0123456789012:role/MyRedshiftRole' 
json 's3://mybucket/category_jsonpath.json';</code></pre>
          
         
         
          
            <h3 id="copy-from-json-examples-using-jsonpaths-arrays">使用 JSONPaths 檔案從 JSON 陣列載入</h3>

            <p>若要從包含一組陣列的 JSON 資料載入，您必須使用 JSONPaths 檔案將陣列元素映射至欄。假設您有下列資料檔案，名稱為 <code class="code">category_array_data.json</code>。</p>
            <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="複製"><awsui-icon name="copy"></awsui-icon></div></div><code class="">[1,"Sports","MLB","Major League Baseball"]
[2,"Sports","NHL","National Hockey League"]
[3,"Sports","NFL","National Football League"]
[4,"Sports","NBA","National Basketball Association"]
[5,"Concerts","Classical","All symphony, concerto, and choir concerts"]</code></pre>
            <p>下列 JSONPaths 檔案 (名為 <code class="code">category_array_jsonpath.json</code>) 將來源資料映射至資料表欄。</p>
            <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="複製"><awsui-icon name="copy"></awsui-icon></div></div><code class=""><span>{</span>
    "jsonpaths": [
        "$[0]",
        "$[1]",
        "$[2]",
        "$[3]"
    ]
}</code></pre>
            <p>若要從上述範例的 JSON 資料檔案載入，請執行下列 COPY 命令。</p>
            <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="複製"><awsui-icon name="copy"></awsui-icon></div></div><code class="">copy category
from 's3://mybucket/category_array_data.json'
iam_role 'arn:aws:iam::0123456789012:role/MyRedshiftRole' 
json 's3://mybucket/category_array_jsonpath.json';</code></pre>
          
             
         <h2 id="r_COPY_command_examples-copy-from-avro">從 Avro 複製的範例</h2>

         <p>在下列範例中，您會將下列資料載入 CATEGORY 資料表。</p>
         <div class="table-container"><div class="table-contents"><table id="w320aac47b9c67c31c39b5"><thead>
                  <tr>
                     <th>CATID</th>
                     <th>CATGROUP</th>
                     <th>CATNAME</th>
                     <th>CATDESC</th>
                  </tr>
               </thead>
                  <tr>
                     <td tabindex="-1">1</td>
                     <td tabindex="-1">運動</td>
                     <td tabindex="-1">MLB</td>
                     <td tabindex="-1"> 美國職棒大聯盟</td>
                  </tr>
                  <tr>
                     <td tabindex="-1">2</td>
                     <td tabindex="-1">運動</td>
                     <td tabindex="-1">NHL</td>
                     <td tabindex="-1">National Hockey League</td>
                  </tr>
                  <tr>
                     <td tabindex="-1">3</td>
                     <td tabindex="-1">運動</td>
                     <td tabindex="-1">NFL</td>
                     <td tabindex="-1">National Football League</td>
                  </tr>
                  <tr>
                     <td tabindex="-1">4</td>
                     <td tabindex="-1">運動</td>
                     <td tabindex="-1">NBA</td>
                     <td tabindex="-1">National Basketball Association</td>
                  </tr>
                  <tr>
                     <td tabindex="-1">5</td>
                     <td tabindex="-1">Concerts</td>
                     <td tabindex="-1">Classical</td>
                     <td tabindex="-1">All symphony, concerto, and choir concerts</td>
                  </tr>
               </table></div></div>
         <div class="highlights" id="inline-topiclist"><h6>主題</h6><ul><li><a href="#copy-from-avro-examples-using-auto">使用 'auto' 選項從 Avro 資料載入</a></li><li><a href="#copy-from-avro-examples-using-auto-ignorecase">使用 'auto ignorecase' 選項從 Avro 資料載入</a></li><li><a href="#copy-from-avro-examples-using-avropaths">使用 JSONPaths 檔案從 Avro 資料載入</a></li></ul></div>
          
            <h3 id="copy-from-avro-examples-using-auto">使用 'auto' 選項從 Avro 資料載入</h3>

            <p>若要使用 <code class="code">'auto'</code> 引數從 Avro 資料載入，Avro 結構描述中的欄位名稱必須符合欄名稱。使用 <code class="code">'auto'</code> 引數時，順序並不重要。以下顯示一個名為 <code class="code">category_auto.avro</code> 之檔案的結構描述。</p>
            <pre class="screen"><span>{</span>
    "name": "category",
    "type": "record",
    "fields": [
        <span>{</span>"name": "catid", "type": "int"},
        <span>{</span>"name": "catdesc", "type": "string"},
        <span>{</span>"name": "catname", "type": "string"},
        <span>{</span>"name": "catgroup", "type": "string"},
}</pre>
            <p>Avro 檔案中的資料是二進位格式，無法直接閱讀。以下顯示 <code class="code">category_auto.avro</code> 檔案中之資料的 JSON 表示法。</p>
            <pre class="screen"><span>{</span>
   "catid": 1,
   "catdesc": "Major League Baseball",
   "catname": "MLB",
   "catgroup": "Sports"
}
<span>{</span>
   "catid": 2,
   "catdesc": "National Hockey League",
   "catname": "NHL",
   "catgroup": "Sports"
}
<span>{</span>
   "catid": 3,
   "catdesc": "National Basketball Association",
   "catname": "NBA",
   "catgroup": "Sports"
}
<span>{</span>
   "catid": 4,
   "catdesc": "All symphony, concerto, and choir concerts",
   "catname": "Classical",
   "catgroup": "Concerts"
}</pre>
            <p>若要從上述範例的 Avro 資料檔案載入，請執行下列 COPY 命令。</p>
            <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="複製"><awsui-icon name="copy"></awsui-icon></div></div><code class="">copy category
from 's3://mybucket/category_auto.avro'
iam_role 'arn:aws:iam::0123456789012:role/MyRedshiftRole'
format as avro 'auto';</code></pre>
          
         
          
            <h3 id="copy-from-avro-examples-using-auto-ignorecase">使用 'auto ignorecase' 選項從 Avro 資料載入</h3>
            
            <p>若要使用 <code class="code">'auto ignorecase'</code> 引數從 Avro 資料載入，Avro 結構描述中欄位名稱的大小寫不必符合欄名稱的大小寫。使用 <code class="code">'auto ignorecase'</code> 引數時，順序並不重要。以下顯示一個名為 <code class="code">category_auto-ignorecase.avro</code> 之檔案的結構描述。</p>
            <pre class="screen"><span>{</span>
    "name": "category",
    "type": "record",
    "fields": [
        <span>{</span>"name": "CatID", "type": "int"},
        <span>{</span>"name": "CatDesc", "type": "string"},
        <span>{</span>"name": "CatName", "type": "string"},
        <span>{</span>"name": "CatGroup", "type": "string"},
}</pre>
            <p>Avro 檔案中的資料是二進位格式，無法直接閱讀。以下顯示 <code class="code">category_auto-ignorecase.avro</code> 檔案中之資料的 JSON 表示法。</p>
            <pre class="screen"><span>{</span>
   "CatID": 1,
   "CatDesc": "Major League Baseball",
   "CatName": "MLB",
   "CatGroup": "Sports"
}
<span>{</span>
   "CatID": 2,
   "CatDesc": "National Hockey League",
   "CatName": "NHL",
   "CatGroup": "Sports"
}
<span>{</span>
   "CatID": 3,
   "CatDesc": "National Basketball Association",
   "CatName": "NBA",
   "CatGroup": "Sports"
}
<span>{</span>
   "CatID": 4,
   "CatDesc": "All symphony, concerto, and choir concerts",
   "CatName": "Classical",
   "CatGroup": "Concerts"
}</pre>
            <p>若要從上述範例的 Avro 資料檔案載入，請執行下列 COPY 命令。</p>
            <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="複製"><awsui-icon name="copy"></awsui-icon></div></div><code class="">copy category
from 's3://mybucket/category_auto-ignorecase.avro'
iam_role 'arn:aws:iam::0123456789012:role/MyRedshiftRole'
format as avro 'auto ignorecase';</code></pre>
          
         
          
            <h3 id="copy-from-avro-examples-using-avropaths">使用 JSONPaths 檔案從 Avro 資料載入</h3>

            <p>如果 Avro 結構描述中的欄位名稱沒有直接對應至欄名稱，您可以使用 JSONPaths 檔案將結構描述元素映射至欄。JSONPaths 檔案表達式的順序必須符合欄順序。</p>
            <p>假設您有一個名為 <code class="code">category_paths.avro</code> 的資料檔案，其中包含的資料與上述範例相同，但使用下列結構描述。</p>
            <pre class="screen"><span>{</span>
    "name": "category",
    "type": "record",
    "fields": [
        <span>{</span>"name": "id", "type": "int"},
        <span>{</span>"name": "desc", "type": "string"},
        <span>{</span>"name": "name", "type": "string"},
        <span>{</span>"name": "group", "type": "string"},
        <span>{</span>"name": "region", "type": "string"} 
     ]
}</pre>
            <p>下列 JSONPaths 檔案 (名為 <code class="code">category_path.avropath</code>) 將來源資料映射至資料表欄。</p>
            <pre class="screen"><span>{</span>
    "jsonpaths": [
        "$['id']",
        "$['group']",
        "$['name']",
        "$['desc']"
    ]
}</pre>
            <p>若要從上述範例的 Avro 資料檔案載入，請執行下列 COPY 命令。</p>
            <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="複製"><awsui-icon name="copy"></awsui-icon></div></div><code class="">copy category
from 's3://mybucket/category_object_paths.avro'
iam_role 'arn:aws:iam::0123456789012:role/MyRedshiftRole' 
format avro 's3://mybucket/category_path.avropath ';</code></pre>
          

       
         <h2 id="r_COPY_preparing_data">準備要搭配 ESCAPE 選項來 COPY 的檔案</h2>


         <p>下列範例描述在使用 COPY 命令搭配 ESCAPE 參數，將資料匯入 Amazon Redshift 資料表之前，如何準備資料來「逸出」換行字元。如果不準備資料來分隔換行字元，當您執行 COPY 命令時，Amazon Redshift 會傳回載入錯誤，因為換行字元通常做為記錄分隔符號。</p>
         <p>例如，假設您想要將一個檔案或外部資料表中的一欄複製到 Amazon Redshift 資料表。如果此檔案或欄包含 XML 格式的內容或類似資料，您必須確定內容中的所有換行字元 (\n) 都以反斜線字元 (\) 逸出。</p>
         <p>包含內嵌換行字元的檔案或資料表可提供相當簡單的比對模式。每一個內嵌的換行字元很可能都接在 <code class="code">&gt;</code> 字元後面，且之間可能有幾個空格字元 (<code class="code">' '</code> 或 Tab 字元)，如下列範例所示 (在名為 <code>nlTest1.txt</code> 的文字檔案中)。</p>
         <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="複製"><awsui-icon name="copy"></awsui-icon></div></div><code class="">$ cat nlTest1.txt
&lt;xml start&gt;
&lt;newline characters provide&gt;
&lt;line breaks at the end of each&gt;
&lt;line in content&gt;
&lt;/xml&gt;|1000
&lt;xml&gt;
&lt;/xml&gt;|2000</code></pre>
         <p>在下列範例中，您可以執行文字處理公用程式來預先處理來源檔案，並在需要的地方插入逸出字元。(當欄資料複製到 Amazon Redshift 資料表時，會將 <code class="code">|</code> 字元主要做為分隔符號來分隔欄資料。) </p>
         <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="複製"><awsui-icon name="copy"></awsui-icon></div></div><code class="">$ sed -e ':a;N;$!ba;s/&gt;[[:space:]]*\n/&gt;\\\n/g' nlTest1.txt &gt; nlTest2.txt</code></pre>
         <p>同樣地，您可以使用 Perl 來執行類似的操作：</p>
         <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="複製"><awsui-icon name="copy"></awsui-icon></div></div><code class="">cat nlTest1.txt | perl -p -e 's/&gt;\s*\n/&gt;\\\n/g' &gt; nlTest2.txt</code></pre>
         <p>為了方便將 <code>nlTest2.txt</code> 檔案中的資料載入 Amazon Redshift，我們在 Amazon Redshift 中建立一個兩欄資料表。第一欄 c1 是字元欄，將存放來自 <code>nlTest2.txt</code> 檔案的 XML 格式內容。第二欄 c2 存放從同一個檔案載入的整數值。</p>
         <p>執行 <code class="code">sed</code> 命令之後，您就可以使用 ESCAPE 參數，將 <code>nlTest2.txt</code> 檔案中的資料正確載入 Amazon Redshift 資料表。</p>
         <div class="awsdocs-note"><div class="awsdocs-note-title"><awsui-icon name="status-info" variant="link"></awsui-icon><h6>注意</h6></div><div class="awsdocs-note-text"><p>在 COPY 命令中包含 ESCAPE 參數時，可逸出一些含有反斜線字元的特殊字元 (包括換行字元)。</p></div></div>
         <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="複製"><awsui-icon name="copy"></awsui-icon></div></div><code class="">copy t2 from 's3://mybucket/data/nlTest2.txt' 
iam_role 'arn:aws:iam::0123456789012:role/MyRedshiftRole'  
escape
delimiter as '|';

select * from t2 order by 2;

c1           |  c2
-------------+------
&lt;xml start&gt;
&lt;newline characters provide&gt;
&lt;line breaks at the end of each&gt;
&lt;line in content&gt;
&lt;/xml&gt;
| 1000
&lt;xml&gt;
&lt;/xml&gt;       | 2000
(2 rows)</code></pre>
         <p>您可以用類似的方法來準備從外部資料庫匯出的資料檔案。例如，假設是 Oracle 資料庫，在您要複製到 Amazon Redshift 的資料表中，您可以對每個受影響的欄使用 REPLACE 函數。</p>
         <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="複製"><awsui-icon name="copy"></awsui-icon></div></div><code class="">SELECT c1, REPLACE(c2, \n',\\n' ) as c2 from my_table_with_xml</code></pre>
         <p>此外，許多資料庫匯出及擷取、轉換、載入 (ETL) 的工具 (經常處理大量資料)，都提供選項來指定逸出和分隔符號字元。</p>
       
         
         
         <h2 id="copy-example-spatial-copy-shapefile">將 Shapefile 載入 Amazon Redshift</h2>
         
         <p>下列範例示範如何使用 COPY 來載入 Esri Shapefile。如需有關載入 Shapefile 的詳細資訊，請參閱<a href="./spatial-copy-shapefile.html">將 Shapefile 載入 Amazon Redshift</a>。</p>        

         
         
          
            <h3 id="copy-example-spatial-copy-shapefile-loading-copy">載入 Shapefile</h3>
            
            
            <p>下列步驟說明如何使用 COPY 命令從 Amazon S3 擷取 OpenStreetMap 資料。此範例假設<a href="https://download.geofabrik.de/europe.html" rel="noopener noreferrer" target="_blank"><span>來自 Geofabrik 下載網站</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a>的挪威 Shapefile 存檔已上傳到您 AWS 區域中的私有 Amazon S3 儲存貯體。<code>.shp</code>、<code>.shx</code> 和 <code>.dbf</code> 檔案必須共用相同的 Amazon S3 字首和檔案名稱。</p>
            
             
               <h4 id="spatial-copy-shapefile-loading-copy-fits">不使用簡化擷取資料</h4>
               <p>以下命令會建立資料表並擷取資料，這些資料無需任何簡化即可符合最大幾何大小。在您偏好的 GIS 軟體中開啟 <code>gis_osm_natural_free_1.shp</code>，並檢查此圖層中的欄。依預設，IDENTITY 或 GEOMETRY 欄都是第一個。當 GEOMETRY 欄是第一個，你可以建立資料表，如下所示。</p>
               <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="複製"><awsui-icon name="copy"></awsui-icon></div></div><code class="sql ">CREATE TABLE norway_natural (
   wkb_geometry GEOMETRY,
   osm_id BIGINT,
   code INT,
   fclass VARCHAR,
   name VARCHAR);            
</code></pre>
               
               <p>或者，當 IDENTITY 欄是第一個，你可以建立資料表，如下所示。</p>
               
               <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="複製"><awsui-icon name="copy"></awsui-icon></div></div><code class="sql ">CREATE TABLE norway_natural_with_id (
   fid INT IDENTITY(1,1),
   wkb_geometry GEOMETRY,
   osm_id BIGINT,
   code INT,
   fclass VARCHAR,
   name VARCHAR);            
</code></pre>
               
               <p>現在，您可以使用 COPY 擷取資料。</p>
               <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="複製"><awsui-icon name="copy"></awsui-icon></div></div><code class="sql ">COPY norway_natural FROM 's3://<code class="replaceable">bucket_name</code>/shapefiles/norway/gis_osm_natural_free_1.shp'
FORMAT SHAPEFILE
CREDENTIALS 'aws_iam_role=arn:aws:iam::123456789012:role/MyRoleName';
INFO: Load into table 'norway_natural' completed, 83891 record(s) loaded successfully
</code></pre>
               
               <p>或者，您可以如下所示擷取資料。</p>
               
               <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="複製"><awsui-icon name="copy"></awsui-icon></div></div><code class="sql ">COPY norway_natural_with_id FROM 's3://<code class="replaceable">bucket_name</code>/shapefiles/norway/gis_osm_natural_free_1.shp'
FORMAT SHAPEFILE
CREDENTIALS 'aws_iam_role=arn:aws:iam::123456789012:role/MyRoleName';
INFO: Load into table 'norway_natural_with_id' completed, 83891 record(s) loaded successfully.
</code></pre>         
             
            
             
               <h4 id="spatial-copy-shapefile-loading-copy-no-fit">使用簡化擷取資料</h4>
               <p>下列命令會建立資料表並嘗試擷取資料，這些資料若不經簡化就無法符合最大幾何大小。檢查 <code>gis_osm_water_a_free_1.shp</code> Shapefile 並建立適當資料表，如下所示。</p>             
               <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="複製"><awsui-icon name="copy"></awsui-icon></div></div><code class="sql ">CREATE TABLE norway_water (
   wkb_geometry GEOMETRY,
   osm_id BIGINT,
   code INT,
   fclass VARCHAR,
   name VARCHAR);
</code></pre>
               
               <p>COPY 命令執行時，會導致錯誤。</p>
               
               <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="複製"><awsui-icon name="copy"></awsui-icon></div></div><code class="sql ">COPY norway_water FROM 's3://<code class="replaceable">bucket_name</code>/shapefiles/norway/gis_osm_water_a_free_1.shp'
FORMAT SHAPEFILE
CREDENTIALS 'aws_iam_role=arn:aws:iam::123456789012:role/MyRoleName';
ERROR:  Load into table 'norway_water' failed.  Check 'stl_load_errors' system table for details.              
</code></pre>
               
               <p>查詢 <code class="code">STL_LOAD_ERRORS</code> 顯示幾何太大。</p>
               
               <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="複製"><awsui-icon name="copy"></awsui-icon></div></div><code class="nohighlight">SELECT line_number, btrim(colname), btrim(err_reason) FROM stl_load_errors WHERE query = pg_last_copy_id();
 line_number |    btrim     |                                 btrim
-------------+--------------+-----------------------------------------------------------------------
     1184705 | wkb_geometry | Geometry size: 1513736 is larger than maximum supported size: 1048447              
</code></pre>
               
               <p>為了解決這個問題，請將 <code class="code">SIMPLIFY AUTO</code> 參數加入 COPY 命令以簡化幾何。</p>
               
               <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="複製"><awsui-icon name="copy"></awsui-icon></div></div><code class="sql ">COPY norway_water FROM 's3://<code class="replaceable">bucket_name</code>/shapefiles/norway/gis_osm_water_a_free_1.shp'
FORMAT SHAPEFILE
SIMPLIFY AUTO
CREDENTIALS 'aws_iam_role=arn:aws:iam::123456789012:role/MyRoleName';

INFO:  Load into table 'norway_water' completed, 1989196 record(s) loaded successfully.              
</code></pre>
               
               <p>若要檢視已簡化的列和幾何，請查詢 <code class="code">SVL_SPATIAL_SIMPLIFY</code>。</p>
               
               <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="複製"><awsui-icon name="copy"></awsui-icon></div></div><code class="nohighlight">SELECT * FROM svl_spatial_simplify WHERE query = pg_last_copy_id();
 query | line_number | maximum_tolerance | initial_size | simplified | final_size |   final_tolerance
-------+-------------+-------------------+--------------+------------+------------+----------------------
    20 |     1184704 |                -1 |      1513736 | t          |    1008808 |   1.276386653895e-05
    20 |     1664115 |                -1 |      1233456 | t          |    1023584 | 6.11707814796635e-06               
</code></pre>
               
               <p>使用 SIMPLIFY AUTO <em>max_tolerance</em> 且公差低於自動計算的公差，可能會導致擷取錯誤。在這種情況下，請使用 MAXERROR 忽略錯誤。</p>
               
               <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="複製"><awsui-icon name="copy"></awsui-icon></div></div><code class="sql ">COPY norway_water FROM 's3://<code class="replaceable">bucket_name</code>/shapefiles/norway/gis_osm_water_a_free_1.shp'
FORMAT SHAPEFILE
SIMPLIFY AUTO 1.1E-05
MAXERROR 2
CREDENTIALS 'aws_iam_role=arn:aws:iam::123456789012:role/MyRoleName';

INFO:  Load into table 'norway_water' completed, 1989195 record(s) loaded successfully.
INFO:  Load into table 'norway_water' completed, 1 record(s) could not be loaded.  Check 'stl_load_errors' system table for details.               
</code></pre>
               
               <p>再次查詢 <code class="code">SVL_SPATIAL_SIMPLIFY</code> 以識別 COPY 未能載入的記錄。</p>
               <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="複製"><awsui-icon name="copy"></awsui-icon></div></div><code class="nohighlight">SELECT * FROM svl_spatial_simplify WHERE query = pg_last_copy_id();
 query | line_number | maximum_tolerance | initial_size | simplified | final_size | final_tolerance
-------+-------------+-------------------+--------------+------------+------------+-----------------
    29 |     1184704 |           1.1e-05 |      1513736 | f          |          0 |               0
    29 |     1664115 |           1.1e-05 |      1233456 | t          |     794432 |         1.1e-05             
</code></pre>
               
               <p>在這個範例中，第一筆記錄無法容納，因此 <code class="code">simplified</code> 欄顯示為 false。第二筆記錄在給定的公差範圍內載入。但是，最終大小大於使用自動計算的公差而不指定最大公差。</p>             
                       
             
                       
          
         
          
            <h3 id="copy-example-spatial-copy-shapefile-compressed">從壓縮的 Shapefile 載入</h3>
            <p>Amazon Redshift COPY 支援從壓縮的 Shapefile 中擷取資料。所有 Shapefile 元件必須具有相同的 Amazon S3 字首和相同的壓縮字尾。例如，假設您想要從上述範例中載入資料。在此情況下，<code>gis_osm_water_a_free_1.shp.gz</code>、<code>gis_osm_water_a_free_1.dbf.gz</code> 和 <code>gis_osm_water_a_free_1.shx.gz</code> 檔案必須共用相同的 Amazon S3 目錄。COPY 命令需要 GZIP 選項，並且 FROM 子句必須指定正確的壓縮檔案，如下所示。</p>
            
            <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="複製"><awsui-icon name="copy"></awsui-icon></div></div><code class="sql ">COPY norway_natural FROM 's3://<code class="replaceable">bucket_name</code>/shapefiles/norway/compressed/gis_osm_natural_free_1.shp.gz'
FORMAT SHAPEFILE
GZIP
CREDENTIALS 'aws_iam_role=arn:aws:iam::123456789012:role/MyRoleName';
INFO:  Load into table 'norway_natural' completed, 83891 record(s) loaded successfully.          
</code></pre>
          
         
          
            <h3 id="copy-example-spatial-copy-shapefile-column-order">以不同的欄順序將資料載入到資料表中</h3>
            <p>如果您的資料表沒有將 <code class="code">GEOMETRY</code> 作為第一欄，則可以使用欄映射將欄映射到目標資料表。例如，建立一個將 <code class="code">osm_id</code> 指定為第一欄的資料表。</p>
            
            <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="複製"><awsui-icon name="copy"></awsui-icon></div></div><code class="sql ">CREATE TABLE norway_natural_order (
   osm_id BIGINT,
   wkb_geometry GEOMETRY,
   code INT,
   fclass VARCHAR,
   name VARCHAR);         
</code></pre>
            <p>然後使用欄映射擷取 Shapefile。</p>
            <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="複製"><awsui-icon name="copy"></awsui-icon></div></div><code class="sql ">COPY norway_natural_order(wkb_geometry, osm_id, code, fclass, name) 
FROM 's3://<code class="replaceable">bucket_name</code>/shapefiles/norway/gis_osm_natural_free_1.shp'
FORMAT SHAPEFILE
CREDENTIALS 'aws_iam_role=arn:aws:iam::123456789012:role/MyRoleName';
INFO:  Load into table 'norway_natural_order' completed, 83891 record(s) loaded successfully.         
</code></pre>
            
          
         
          
            
            <h3 id="copy-example-spatial-copy-shapefile-geography">將資料載入至具有地理欄的資料表</h3>
            <p>如果您有一個包含 <code class="code">GEOGRAPHY</code> 欄的資料表，則首先擷取至 <code class="code">GEOMETRY</code> 欄中，然後將物件轉換為 <code class="code">GEOGRAPHY</code> 物件。例如，將 Shapefile 複製到 <code class="code">GEOMETRY</code> 欄之後，請更改資料表以新增 <code class="code">GEOGRAPHY</code> 資料類型的欄。</p>           
            <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="複製"><awsui-icon name="copy"></awsui-icon></div></div><code class="sql ">ALTER TABLE norway_natural ADD COLUMN wkb_geography GEOGRAPHY;</code></pre>
            
            <p>然後將幾何轉換為地理。</p>
            <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="複製"><awsui-icon name="copy"></awsui-icon></div></div><code class="sql ">UPDATE norway_natural SET wkb_geography = wkb_geometry::geography;</code></pre>
            
            <p>您也可以選擇捨棄 <code class="code">GEOMETRY</code> 欄。</p>
            <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="複製"><awsui-icon name="copy"></awsui-icon></div></div><code class="sql ">ALTER TABLE norway_natural DROP COLUMN wkb_geometry;</code></pre>
            
          
         
       
         
         <h2 id="r_COPY_command_examples-load-noload-option">具有 NOLOAD 選項的 COPY 命令</h2>
              
         <p>若要在實際載入資料之前先驗證資料檔案，請使用 NOLOAD 選項搭配 COPY 命令。Amazon Redshift 會剖析輸入檔案，並顯示發生的任何錯誤。下列範例使用 NOLOAD 選項，而且沒有列實際載入資料表中。</p>
         <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="複製"><awsui-icon name="copy"></awsui-icon></div></div><code class="sql "><code class="userinput">COPY public.zipcode1
FROM 's3://mybucket/mydata/zipcode.csv' 
DELIMITER ';' 
IGNOREHEADER 1 REGION 'us-east-1'
NOLOAD
CREDENTIALS 'aws_iam_role=arn:aws:iam::123456789012:role/myRedshiftRole'</code>;
<code class="computeroutput" copy="false">
Warnings:
Load into table 'zipcode1' completed, 0 record(s) loaded successfully.  
</code>       
         
         </code></pre>
      <awsdocs-copyright class="copyright-print"></awsdocs-copyright><awsdocs-thumb-feedback right-edge="{{$ctrl.thumbFeedbackRightEdge}}"></awsdocs-thumb-feedback></div><noscript><div><div><div><div id="js_error_message"><p><img src="https://d1ge0kk1l5kms0.cloudfront.net/images/G/01/webservices/console/warning.png" alt="警告" /> <strong>您的瀏覽器已停用或無法使用 Javascript。</strong></p><p>您必須啟用 Javascript，才能使用 AWS 文件。請參閱您的瀏覽器說明頁以取得說明。</p></div></div></div></div></noscript><div id="main-col-footer" class="awsui-util-font-size-0"><div id="doc-conventions"><a target="_top" href="/general/latest/gr/docconventions.html">文件慣用形式</a></div><div class="prev-next"><div id="previous" class="prev-link" accesskey="p" href="./automatic-recognition.html">對 DATEFORMAT 和 TIMEFORMAT 使用自動辨識</div><div id="next" class="next-link" accesskey="n" href="./r_CREATE_DATABASE.html">CREATE DATABASE</div></div></div><awsdocs-page-utilities></awsdocs-page-utilities></div><div id="quick-feedback-yes" style="display: none;"><div class="title">此頁面是否有幫助？ - 是</div><div class="content"><p>感謝您，讓我們知道我們做得很好！</p><p>若您有空，歡迎您告知我們值得讚許的地方，這樣才能保持良好服務。</p><p><awsui-button id="fblink" rel="noopener noreferrer" target="_blank" text="意見回饋" click="linkClick($event)" href="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=Redshift&amp;topic_url=https://docs.aws.amazon.com/zh_tw/redshift/latest/dg/r_COPY_command_examples.html"></awsui-button></p></div></div><div id="quick-feedback-no" style="display: none;"><div class="title">此頁面是否有幫助？ - 否</div><div class="content"><p>感謝讓我們知道此頁面仍須改善。很抱歉，讓您失望。</p><p>若您有空，歡迎您提供改善文件的方式。</p><p><awsui-button id="fblink" rel="noopener noreferrer" target="_blank" text="意見回饋" click="linkClick($event)" href="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=Redshift&amp;topic_url=https://docs.aws.amazon.com/zh_tw/redshift/latest/dg/r_COPY_command_examples.html"></awsui-button></p></div></div></div></body></div></awsdocs-view><div class="page-loading-indicator" id="page-loading-indicator"><awsui-spinner size="large"></awsui-spinner></div></div><div id="tools-panel" dom-region="tools"><awsdocs-tools-panel id="awsdocs-tools-panel"></awsdocs-tools-panel></div></awsui-app-layout><awsdocs-cookie-banner class="doc-cookie-banner"></awsdocs-cookie-banner></div></body></html>