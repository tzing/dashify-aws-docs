<!DOCTYPE html>
    <html xmlns="http://www.w3.org/1999/xhtml" lang="ko-KR"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>연습: Amazon 머신 이미지 ID 조회 - AWS CloudFormation</title><meta name="viewport" content="width=device-width,initial-scale=1" /><meta name="assets_root" content="/assets" /><meta name="target_state" content="walkthrough-custom-resources-lambda-lookup-amiids" /><meta name="default_state" content="walkthrough-custom-resources-lambda-lookup-amiids" /><link rel="icon" type="image/ico" href="/assets/images/favicon.ico" /><link rel="shortcut icon" type="image/ico" href="/assets/images/favicon.ico" /><link rel="canonical" href="https://docs.aws.amazon.com/ko_kr/AWSCloudFormation/latest/UserGuide/walkthrough-custom-resources-lambda-lookup-amiids.html" /><meta name="description" content="AWS Lambda 및 사용자 지정 리소스를 사용하여 AMI ID를 동적으로 조회합니다." /><meta name="deployment_region" content="IAD" /><meta name="product" content="AWS CloudFormation" /><meta name="guide" content="사용자 가이드" /><meta name="abstract" content="이 사용 설명서와 AWS CloudFormation을 사용하여 AWS 인프라 배포를 예상한 대로 반복해서 생성 및 관리합니다." /><meta name="guide-locale" content="ko_kr" /><meta name="tocs" content="toc-contents.json" /><link rel="canonical" href="https://docs.aws.amazon.com/ko_kr/AWSCloudFormation/latest/UserGuide/walkthrough-custom-resources-lambda-lookup-amiids.html" /><link rel="alternative" href="https://docs.aws.amazon.com/id_id/AWSCloudFormation/latest/UserGuide/walkthrough-custom-resources-lambda-lookup-amiids.html" hreflang="id-id" /><link rel="alternative" href="https://docs.aws.amazon.com/id_id/AWSCloudFormation/latest/UserGuide/walkthrough-custom-resources-lambda-lookup-amiids.html" hreflang="id" /><link rel="alternative" href="https://docs.aws.amazon.com/de_de/AWSCloudFormation/latest/UserGuide/walkthrough-custom-resources-lambda-lookup-amiids.html" hreflang="de-de" /><link rel="alternative" href="https://docs.aws.amazon.com/de_de/AWSCloudFormation/latest/UserGuide/walkthrough-custom-resources-lambda-lookup-amiids.html" hreflang="de" /><link rel="alternative" href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/walkthrough-custom-resources-lambda-lookup-amiids.html" hreflang="en-us" /><link rel="alternative" href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/walkthrough-custom-resources-lambda-lookup-amiids.html" hreflang="en" /><link rel="alternative" href="https://docs.aws.amazon.com/es_es/AWSCloudFormation/latest/UserGuide/walkthrough-custom-resources-lambda-lookup-amiids.html" hreflang="es-es" /><link rel="alternative" href="https://docs.aws.amazon.com/es_es/AWSCloudFormation/latest/UserGuide/walkthrough-custom-resources-lambda-lookup-amiids.html" hreflang="es" /><link rel="alternative" href="https://docs.aws.amazon.com/fr_fr/AWSCloudFormation/latest/UserGuide/walkthrough-custom-resources-lambda-lookup-amiids.html" hreflang="fr-fr" /><link rel="alternative" href="https://docs.aws.amazon.com/fr_fr/AWSCloudFormation/latest/UserGuide/walkthrough-custom-resources-lambda-lookup-amiids.html" hreflang="fr" /><link rel="alternative" href="https://docs.aws.amazon.com/it_it/AWSCloudFormation/latest/UserGuide/walkthrough-custom-resources-lambda-lookup-amiids.html" hreflang="it-it" /><link rel="alternative" href="https://docs.aws.amazon.com/it_it/AWSCloudFormation/latest/UserGuide/walkthrough-custom-resources-lambda-lookup-amiids.html" hreflang="it" /><link rel="alternative" href="https://docs.aws.amazon.com/ja_jp/AWSCloudFormation/latest/UserGuide/walkthrough-custom-resources-lambda-lookup-amiids.html" hreflang="ja-jp" /><link rel="alternative" href="https://docs.aws.amazon.com/ja_jp/AWSCloudFormation/latest/UserGuide/walkthrough-custom-resources-lambda-lookup-amiids.html" hreflang="ja" /><link rel="alternative" href="https://docs.aws.amazon.com/ko_kr/AWSCloudFormation/latest/UserGuide/walkthrough-custom-resources-lambda-lookup-amiids.html" hreflang="ko-kr" /><link rel="alternative" href="https://docs.aws.amazon.com/ko_kr/AWSCloudFormation/latest/UserGuide/walkthrough-custom-resources-lambda-lookup-amiids.html" hreflang="ko" /><link rel="alternative" href="https://docs.aws.amazon.com/pt_br/AWSCloudFormation/latest/UserGuide/walkthrough-custom-resources-lambda-lookup-amiids.html" hreflang="pt-br" /><link rel="alternative" href="https://docs.aws.amazon.com/pt_br/AWSCloudFormation/latest/UserGuide/walkthrough-custom-resources-lambda-lookup-amiids.html" hreflang="pt" /><link rel="alternative" href="https://docs.aws.amazon.com/zh_cn/AWSCloudFormation/latest/UserGuide/walkthrough-custom-resources-lambda-lookup-amiids.html" hreflang="zh-cn" /><link rel="alternative" href="https://docs.aws.amazon.com/zh_tw/AWSCloudFormation/latest/UserGuide/walkthrough-custom-resources-lambda-lookup-amiids.html" hreflang="zh-tw" /><link rel="alternative" href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/walkthrough-custom-resources-lambda-lookup-amiids.html" hreflang="x-default" /><meta name="feedback-item" content="CloudFormation" /><meta name="this_doc_product" content="AWS CloudFormation" /><meta name="this_doc_guide" content="사용자 가이드" /><script defer="" src="/assets/r/vendor4.js?version=2021.12.02"></script><script defer="" src="/assets/r/vendor3.js?version=2021.12.02"></script><script defer="" src="/assets/r/vendor1.js?version=2021.12.02"></script><script defer="" src="/assets/r/awsdocs-common.js?version=2021.12.02"></script><script defer="" src="/assets/r/awsdocs-doc-page.js?version=2021.12.02"></script><link href="/assets/r/vendor4.css?version=2021.12.02" rel="stylesheet" /><link href="/assets/r/awsdocs-common.css?version=2021.12.02" rel="stylesheet" /><link href="/assets/r/awsdocs-doc-page.css?version=2021.12.02" rel="stylesheet" /><script async="" id="awsc-panorama-bundle" type="text/javascript" src="https://prod.pa.cdn.uis.awsstatic.com/panorama-nav-init.js" data-config="{'appEntity':'aws-documentation','region':'us-east-1','service':'cloudformation'}"></script><meta id="panorama-serviceSubSection" value="사용자 가이드" /><meta id="panorama-serviceConsolePage" value="연습: Amazon 머신 이미지 ID 조회" /></head><body class="awsdocs awsui"><div class="awsdocs-container"><awsdocs-header></awsdocs-header><awsui-app-layout id="app-layout" class="awsui-util-no-gutters" ng-controller="ContentController as $ctrl" header-selector="awsdocs-header" navigation-hide="false" navigation-width="$ctrl.navWidth" navigation-open="$ctrl.navOpen" navigation-change="$ctrl.onNavChange($event)" tools-hide="$ctrl.hideTools" tools-width="$ctrl.toolsWidth" tools-open="$ctrl.toolsOpen" tools-change="$ctrl.onToolsChange($event)"><div id="guide-toc" dom-region="navigation"><awsdocs-toc></awsdocs-toc></div><div id="main-column" dom-region="content" tabindex="-1"><awsdocs-view class="awsdocs-view"><div id="awsdocs-content"><head><title>연습: Amazon 머신 이미지 ID 조회 - AWS CloudFormation</title><meta name="rss" content="aws-cloudformation-release-notes.rss" /><meta name="forums" content="http://forums.aws.amazon.com/forum.jspa?forumID=92" /><meta name="feedback" content="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=CloudFormation&amp;topic_url=https://docs.aws.amazon.com/ko_kr/AWSCloudFormation/latest/UserGuide/walkthrough-custom-resources-lambda-lookup-amiids.html" /><meta name="feedback-yes" content="feedbackyes.html?topic_url=https://docs.aws.amazon.com/ko_kr/AWSCloudFormation/latest/UserGuide/walkthrough-custom-resources-lambda-lookup-amiids.html" /><meta name="feedback-no" content="feedbackno.html?topic_url=https://docs.aws.amazon.com/ko_kr/AWSCloudFormation/latest/UserGuide/walkthrough-custom-resources-lambda-lookup-amiids.html" /><meta name="keywords" content="CloudFormation,AWSCloudFormation,리소스 프로비저닝,리소스 구성,인프라 관리,CloudFormer,CloudFormation 스택,CloudFormation stackset,CloudFormation 템플릿,변경 세트" /><script type="application/ld+json">
{
    "@context" : "https://schema.org",
    "@type" : "BreadcrumbList",
    "itemListElement" : [
      {
        "@type" : "ListItem",
        "position" : 1,
        "name" : "AWS",
        "item" : "https://aws.amazon.com"
      },
      {
        "@type" : "ListItem",
        "position" : 2,
        "name" : "AWS CloudFormation",
        "item" : "https://docs.aws.amazon.com/cloudformation/index.html"
      },
      {
        "@type" : "ListItem",
        "position" : 3,
        "name" : "사용자 가이드",
        "item" : "https://docs.aws.amazon.com/ko_kr/AWSCloudFormation/latest/UserGuide"
      },
      {
        "@type" : "ListItem",
        "position" : 4,
        "name" : "AWS CloudFormation 템플릿 사용",
        "item" : "https://docs.aws.amazon.com/ko_kr/AWSCloudFormation/latest/UserGuide/template-guide.html"
      },
      {
        "@type" : "ListItem",
        "position" : 5,
        "name" : "사용자 정의 리소스",
        "item" : "https://docs.aws.amazon.com/ko_kr/AWSCloudFormation/latest/UserGuide/template-custom-resources.html"
      },
      {
        "@type" : "ListItem",
        "position" : 6,
        "name" : "AWS Lambda 지원 사용자 지정 리소스",
        "item" : "https://docs.aws.amazon.com/ko_kr/AWSCloudFormation/latest/UserGuide/template-custom-resources-lambda.html"
      },
      {
        "@type" : "ListItem",
        "position" : 7,
        "name" : "연습: Amazon 머신 이미지 ID 조회",
        "item" : "https://docs.aws.amazon.com/ko_kr/AWSCloudFormation/latest/UserGuide/template-custom-resources-lambda.html"
      }
    ]
}
</script></head><body><div id="main"><div style="display: none"></div><div id="breadcrumbs" class="breadcrumb"><a href="https://aws.amazon.com">AWS</a><a href="/index.html">aws-documentation</a><a href="/cloudformation/index.html">AWS CloudFormation</a><a href="Welcome.html">사용자 가이드</a></div><div id="page-toc-src"><a href="#walkthrough-custom-resources-lambda-lookup-amiids-savesample">1단계: Amazon S3에서 샘플 패키지 다운로드 및 저장</a><a href="#walkthrough-custom-resources-lambda-lookup-amiids-createfunction-createstack">2단계: 스택 생성</a><a href="#walkthrough-custom-resources-lambda-lookup-amiids-createfunction-cleanup">3단계: 리소스 정리</a><a href="#w9aac23c26c16b7c29">관련 정보</a></div><div id="main-content" class="awsui-util-container"><div id="main-col-body"><awsdocs-language-banner data-service="$ctrl.pageService"></awsdocs-language-banner><h1 class="topictitle" id="walkthrough-custom-resources-lambda-lookup-amiids">연습: Amazon 머신 이미지 ID 조회</h1><div class="awsdocs-page-header-container"><awsdocs-page-header></awsdocs-page-header><awsdocs-filter-selector id="awsdocs-filter-selector"></awsdocs-filter-selector></div><p>Amazon Elastic Compute Cloud(Amazon EC2) 인스턴스를 선언하는 AWS CloudFormation 템플릿은 인스턴스를 시작하는 데 사용되는 운영 체제와 기타 소프트웨어 및 구성 정보가 포함된 Amazon Machine Image(AMI) ID도 지정해야 합니다. 올바른 AMI ID는 스택을 시작하는 리전 및 인스턴스 유형에 따라 달라집니다. ID는 정기적으로 변경할 수 있습니다(예: 소프트웨어 업데이트로 AMI가 업데이트되는 경우).</p><p>일반적으로, AMI ID는 특정 인스턴스 유형 및 리전으로 매핑할 수 있습니다. ID를 업데이트하려면 각 템플릿에서 ID를 수동으로 변경합니다. 사용자 지정 리소스 및 AWS Lambda(Lambda)를 사용하여 리전의 최신 AMI ID와 사용 중인 인스턴스 유형을 가져오는 함수를 생성할 수 있습니다. 따라서 매핑을 유지할 필요가 없습니다.</p><p>이 연습에서는 사용자 지정 리소스를 생성하고 AMI ID를 조회하기 위해 이러한 리소스와 Lambda 함수를 연결하는 방법을 보여줍니다. 연습에서는 사용자 지정 리소스 및 Lambda 사용 방법을 알고 있다고 가정합니다. 자세한 내용을 알아보려면 <a href="./template-custom-resources.html">사용자 정의 리소스</a> 또는 <a href="https://docs.aws.amazon.com/lambda/latest/dg/">AWS Lambda 개발자 안내서</a>를 참조하세요.</p><p>연습 개요</p><p>이 연습에서 사용하기 위해 사용자 지정 리소스, Lambda 함수 및 EC2 인스턴스로 스택을 생성합니다. 이 연습에서는 스택을 생성하는 데 사용할 샘플 코드 및 샘플 템플릿을 제공합니다.</p><p>샘플 템플릿은 사용자 지정 리소스 유형을 사용하여 입력 값을 호출해 Lambda 함수로 전송합니다. 템플릿을 사용하는 경우 AWS CloudFormation에서는 함수를 호출하고 정보(예: 요청 유형, 입력 데이터 및 미리 서명된 Amazon Simple Storage Service(Amazon S3) URL)를 이러한 함수에 전송합니다. 이 함수는 이러한 정보를 사용하여 AMI ID를 조회한 다음 미리 서명된 URL로 응답을 전송합니다.</p><p>AWS CloudFormation이 미리 서명된 URL 위치에서 응답을 받으면 계속해서 스택 생성을 진행합니다. AWS CloudFormation에서 인스턴스를 생성할 때 Lambda 함수의 응답을 사용하여 인스턴스의 AMI ID를 지정합니다.</p><p>다음 목록에는 프로세스가 요약되어 있습니다. 해당하는 서비스(예: Lambda, Amazon EC2 및 AWS CloudFormation)를 모두 사용하려면 AWS Identity and Access Management(IAM) 권한이 필요합니다.</p><div class="awsdocs-note"><div class="awsdocs-note-title"><awsui-icon name="status-info" variant="link"></awsui-icon><h6>참고</h6></div><div class="awsdocs-note-text"><p>AWS CloudFormation은 무료 서비스이지만 스택에 포함한 AWS 리소스(예: Lambda 함수 및 EC2 인스턴스)에 대해 각각 현재 환율로 비용이 청구됩니다. AWS 요금에 대한 자세한 내용을 알아보려면 <a href="https://aws.amazon.com/" rel="noopener noreferrer" target="_blank"><span>http://aws.amazon.com</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a>의 제품별 세부 정보 페이지를 참조하세요.</p></div></div><div class="orderedlist">
     
     
     
  <ol><li>
      <p><a href="#walkthrough-custom-resources-lambda-lookup-amiids-savesample">Amazon Simple Storage Service(Amazon S3) 버킷에 샘플 Lambda 패키지를 저장합니다.</a></p>
      <p>샘플 패키지에는 Lambda 함수를 생성하는 데 필요한 모든 것이 포함되어 있습니다. 패키지는 스택을 생성할 리전과 동일한 리전에 있는 버킷에 저장해야 합니다.</p>
    </li><li>
      <p><a href="#walkthrough-custom-resources-lambda-lookup-amiids-createfunction-createstack">샘플 템플릿을 사용하여 스택을 생성합니다.</a></p>
      <p>스택은 Lambda 함수를 사용자 지정 리소스와 연결하는 방법과 함수의 결과를 사용해 AMI ID를 지정하는 방법을 보여줍니다. 또한 스택은 Lambda에서 Amazon EC2를 호출하는 데 사용하는 IAM 역할(실행 역할)을 생성합니다.</p>
    </li><li>
      <p><a href="#walkthrough-custom-resources-lambda-lookup-amiids-createfunction-cleanup">스택을 삭제합니다.</a></p>
      <p>스택을 삭제해 생성한 스택 리소스를 모두 정리하면 불필요한 리소스에 대해 비용이 청구되지 않습니다.</p>
    </li></ol></div><h2 id="walkthrough-custom-resources-lambda-lookup-amiids-savesample">1단계: Amazon S3에서 샘플 패키지 다운로드 및 저장</h2>
    
    <p>Lambda 함수를 사용해 스택을 생성하면 이 함수의 소스 코드가 포함된 Amazon S3 버킷의 위치를 지정해야 합니다. 버킷은 스택을 생성할 리전과 동일한 리전에 위치해야 합니다.</p>
    <p>이 연습에서는 Lambda 함수를 생성하는 데 필요한 샘플 패키지(<code>.zip</code> 파일)를 제공합니다. Lambda 패키지에는 함수 및 필수 라이브러리에 대한 소스 코드가 포함되어 있습니다. 이 연습의 경우 함수에 추가 라이브러리가 필요하지 않습니다.</p>
    <p>이 함수는 AWS CloudFormation 사용자 지정 리소스 요청의 입력으로 인스턴스의 아키텍처 및 리전을 가져와 미리 서명된 Amazon S3 URL에 최신 AMI ID를 반환합니다.</p>
    <div class="procedure"><h6>Amazon S3에서 패키지를 다운로드해 저장하려면</h6><ol><li>
        <p>Amazon S3에서 샘플 패키지를 다운로드합니다. 이 파일을 저장할 때 샘플 <code>amilookup.zip</code> 또는 <code>amilookup-win.zip</code>과 동일한 파일 이름을 사용합니다.</p>
        <div class="variablelist">
           
           
        <dl>
            <dt><b><span class="term">Linux AMI ID 조회</span></b></dt>
            <dd>
              <p><a href="https://s3.amazonaws.com/cloudformation-examples/lambda/amilookup.zip" rel="noopener noreferrer" target="_blank"><span>https://s3.amazonaws.com/cloudformation-examples/lambda/amilookup.zip</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a></p>
            </dd>
          
            <dt><b><span class="term">Windows AMI ID 조회</span></b></dt>
            <dd>
              <p><a href="https://s3.amazonaws.com/cloudformation-examples/lambda/amilookup-win.zip" rel="noopener noreferrer" target="_blank"><span>https://s3.amazonaws.com/cloudformation-examples/lambda/amilookup-win.zip</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a></p>
            </dd>
          </dl></div>
      </li><li>
        <p><a href="https://console.aws.amazon.com/s3/home" rel="noopener noreferrer" target="_blank"><span>https://console.aws.amazon.com/s3/home</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a>에서 Amazon S3 콘솔을 엽니다.</p>
      </li><li>
        <p>AWS CloudFormation 스택을 생성할 리전과 동일한 리전에 있는 버킷을 선택하거나 생성합니다. 버킷 이름을 기록합니다.</p>
        <p>이 버킷에 샘플 패키지를 저장합니다. 버킷 생성에 대한 자세한 내용을 알아보려면 <em>Amazon Simple Storage Service 사용 설명서</em>의 <a href="https://docs.aws.amazon.com/AmazonS3/latest/user-guide/CreatingaBucket.html">버킷 생성</a>을 참조하세요.</p>
      </li><li>
        <p>선택하거나 생성한 버킷에 샘플 패키지를 업로드합니다.</p>
        <p>객체 업로드에 대한 자세한 내용을 알아보려면 <em>Amazon Simple Storage Service 사용 설명서</em>의 <a href="https://docs.aws.amazon.com/AmazonS3/latest/user-guide/UploadingObjectsintoAmazonS3.html">객체 업로드</a>를 참조하세요.</p>
      </li></ol></div>
    <p>Amazon S3의 패키지를 사용하면 AWS CloudFormation 템플릿의 Lambda 리소스 선언에서 이 패키지의 위치를 지정할 수 있습니다. 다음 단계에서는 사용자 지정 리소스를 사용하여 함수를 선언하고 호출하는 방법을 보여줍니다. 이러한 함수의 결과를 사용해 EC2 인스턴스의 AMI ID를 지정하는 방법도 알아봅니다.</p>
   
   <h2 id="walkthrough-custom-resources-lambda-lookup-amiids-createfunction-createstack">2단계: 스택 생성</h2>
    
    <p>Amazon EC2 스택을 생성하려면 Lambda 함수, IAM 실행 역할, 이 함수를 호출하는 사용자 지정 리소스 및 해당 함수의 결과를 사용하는 EC2 인스턴스를 포함하는 샘플 템플릿을 사용합니다.</p>
    <p>스택 생성 중 사용자 지정 리소스는 Lambda 함수를 호출해 이 함수가 미리 서명된 Amazon S3 URL로 응답을 전송할 때까지 대기합니다. 호출된 함수는 응답 시 인스턴스를 생성한 EC2 인스턴스 유형 및 리전에 해당하는 최신 AMI의 ID를 반환합니다. 함수 응답의 데이터는 EC2 인스턴스의 AMI ID를 지정하는 데 사용되는 사용자 지정 리소스의 속성으로 저장됩니다.</p>
    <p>다음 코드 조각은 샘플 템플릿의 관련 부분을 설명하여 Lambda 함수를 사용자 지정 리소스와 연결하는 방법과 이러한 함수의 응답을 사용하는 방법을 이해하도록 돕습니다.</p>
    <p>전체 샘플 템플릿을 보려면 다음 템플릿을 참조하십시오.</p>
    <div class="variablelist">
       
       
    <dl>
        <dt><b><span class="term">Linux 템플릿</span></b></dt>
        <dd>
          <p><a href="https://s3.amazonaws.com/cloudformation-examples/lambda/LambdaAMILookupSample.template" rel="noopener noreferrer" target="_blank"><span>https://s3.amazonaws.com/cloudformation-examples/lambda/LambdaAMILookupSample.template</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a></p>
        </dd>
      
        <dt><b><span class="term">Windows 템플릿</span></b></dt>
        <dd>
          <p><a href="https://s3.amazonaws.com/cloudformation-examples/lambda/LambdaAMILookupSample-win.template" rel="noopener noreferrer" target="_blank"><span>https://s3.amazonaws.com/cloudformation-examples/lambda/LambdaAMILookupSample-win.template</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a></p>
        </dd>
      </dl></div>
    <p>스택 템플릿 코드 조각</p>
    <p>Lambda 함수를 생성하려면 함수의 소스 코드, 핸들러 이름, 실행 시간 환경 및 실행 역할 ARN을 필요로 하는 <code class="code">AWS::Lambda::Function</code> 리소스를 선언합니다.</p>
    <div class="example"><h6>예 JSON 구문:</h6><div class="example-contents"><pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="json ">"AMIInfoFunction": <span>{</span>
  "Type": "AWS::Lambda::Function",
  "Properties": <span>{</span>
    "Code": <span>{</span>
      "S3Bucket": <span>{</span> "Ref": "S3Bucket" },
      "S3Key": <span>{</span> "Ref": "S3Key" }
    },
    "Handler": <span>{</span> "Fn::Join" : [ "", [<span>{</span> "Ref": "ModuleName" },".handler"] ] },
    "Runtime": "nodejs18.x",
    "Timeout": "30",
    "Role": <span>{</span> "Fn::GetAtt" : ["LambdaExecutionRole", "Arn"] }
  }
}</code></pre></div></div>
    <div class="example"><h6>예 YAML 구문</h6><div class="example-contents"><pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="yaml ">AMIInfoFunction:
  Type: AWS::Lambda::Function
  Properties:
    Code:
      S3Bucket: !Ref S3Bucket
      S3Key: !Ref S3Key
    Handler: !Sub "$<span>{</span>ModuleName}.handler"
    Runtime: nodejs18.x
    Timeout: 30
    Role: !GetAtt LambdaExecutionRole.Arn</code></pre></div></div>
    <p><code class="code">Code</code> 속성은 샘플 패키지를 업로드한 Amazon S3 위치(버킷 이름 및 파일 이름)를 지정합니다. 샘플 템플릿은 입력 파라미터(<code class="code">"Ref":
        "S3Bucket"</code> 및 <code class="code">"Ref": "S3Key"</code>)를 사용하여 버킷 및 파일 이름을 설정하므로 스택을 생성할 때 이름을 지정할 수 있습니다. 마찬가지로, <code>.zip</code> 패키지의 소스 파일(JavaScript 파일)의 이름에 해당하는 핸들러 이름 역시 입력 파라미터(<code class="code">"Ref":
        "ModuleName"</code>)를 사용합니다. 소스 파일이 JavaScript 코드이므로 실행 시간이 <code class="code">nodejs18.x</code>으로 지정됩니다.</p>
    <p>이 연습의 경우 함수 실행 시간이 기본값인 <code class="code">3</code>초를 초과하므로 시간 제한이 <code class="code">30</code>초로 설정됩니다. 시간 제한을 충분히 길게 지정하지 않으면 Lambda에서는 함수를 완료하기 전에 시간 제한이 발생할 수 있습니다. 그러면 스택 생성에 실패합니다.</p>
    <p>템플릿의 다른 곳에서 선언된 실행 역할은 <code class="code">Fn::GetAtt</code> 속성의 <code class="code">Role</code> 내장 함수를 사용하여 지정됩니다. 실행 역할은 로그를 AWS로 전송하고 EC2 <code class="code">DescribeImages</code> API를 호출하는 Lambda 함수 권한을 부여합니다. 다음 코드 조각은 적절한 권한을 부여하는 역할 및 정책을 보여줍니다.</p>
    <div class="example"><h6>예 JSON 구문:</h6><div class="example-contents"><pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="json ">"LambdaExecutionRole": <span>{</span>
  "Type": "AWS::IAM::Role",
  "Properties": <span>{</span>
    "AssumeRolePolicyDocument": <span>{</span>
      "Version": "2012-10-17",
      "Statement": [<span>{</span>
        "Effect": "Allow",
        "Principal": <span>{</span>"Service": ["lambda.amazonaws.com"]},
        "Action": ["sts:AssumeRole"]
      }]
    },
    "Path": "/",
    "Policies": [<span>{</span>
      "PolicyName": "root",
      "PolicyDocument": <span>{</span>
        "Version": "2012-10-17",
        "Statement": [<span>{</span>
          "Effect": "Allow",
          "Action": ["logs:CreateLogGroup","logs:CreateLogStream","logs:PutLogEvents"],
          "Resource": "arn:aws:logs:*:*:*"
        },
        <span>{</span>
          "Effect": "Allow",
          "Action": ["ec2:DescribeImages"],
          "Resource": "*"
        }]
      }
    }]
  }
}</code></pre></div></div>
    <div class="example"><h6>예 YAML 구문</h6><div class="example-contents"><pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="yaml ">LambdaExecutionRole:
  Type: AWS::IAM::Role
  Properties:
    AssumeRolePolicyDocument:
      Version: '2012-10-17'
      Statement:
      - Effect: Allow
        Principal:
          Service:
          - lambda.amazonaws.com
        Action:
        - sts:AssumeRole
    Path: "/"
    Policies:
    - PolicyName: root
      PolicyDocument:
        Version: '2012-10-17'
        Statement:
        - Effect: Allow
          Action:
          - logs:CreateLogGroup
          - logs:CreateLogStream
          - logs:PutLogEvents
          Resource: arn:aws:logs:*:*:*
        - Effect: Allow
          Action:
          - ec2:DescribeImages
          Resource: "*"</code></pre></div></div>
    <p>Linux 및 Windows 템플릿 둘 다의 경우 사용자 지정 리소스는 자신과 연결된 Lambda 함수를 호출합니다. 함수를 사용자 지정 리소스와 연결하려면 <code class="code">Fn::GetAtt</code> 내장 함수를 사용하여 <code class="code">ServiceToken</code> 속성에 대해 함수의 Amazon 리소스 이름(ARN)을 지정합니다. AWS CloudFormation에서는 사용자 지정 리소스 선언에 포함된 추가 속성(예: <code class="code">Region</code> 및 <code class="code">Architecture</code>)을 Lambda 함수에 입력으로 전송합니다. Lambda 함수는 이러한 입력 속성에 대해 올바른 이름 및 값을 확인합니다.</p>
    <div class="example"><h6>예 JSON 구문:</h6><div class="example-contents"><pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="json ">"AMIInfo": <span>{</span>
  "Type": "Custom::AMIInfo",
  "Properties": <span>{</span>
    "ServiceToken": <span>{</span> "Fn::GetAtt" : ["AMIInfoFunction", "Arn"] },
    "Region": <span>{</span> "Ref": "AWS::Region" },
    "Architecture": <span>{</span> "Fn::FindInMap" : [ "AWSInstanceType2Arch", <span>{</span> "Ref" : "InstanceType" }, "Arch" ] }
  }
}</code></pre></div></div>
    <div class="example"><h6>예 YAML 구문</h6><div class="example-contents"><pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="yaml ">AMIInfo:
  Type: Custom::AMIInfo
  Properties:
    ServiceToken: !GetAtt AMIInfoFunction.Arn
    Region: !Ref "AWS::Region"
    Architecture:
      Fn::FindInMap:
      - AWSInstanceType2Arch
      - !Ref InstanceType
      - Arch</code></pre></div></div>
    <p>Windows의 경우 사용자 지정 리소스는 Lambda 함수에 인스턴스의 아키텍처 대신 Windows 버전을 제공합니다.</p>
    <div class="example"><h6>예 JSON 구문:</h6><div class="example-contents"><pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="json ">"AMIInfo": <span>{</span>
  "Type": "Custom::AMIInfo",
  "Properties": <span>{</span>
    "ServiceToken": <span>{</span> "Fn::GetAtt" : ["AMIInfoFunction", "Arn"] },
    "Region": <span>{</span> "Ref": "AWS::Region" },
    "OSName": <span>{</span> "Ref": "WindowsVersion" }
  }
}</code></pre></div></div>
    <div class="example"><h6>예 YAML 구문</h6><div class="example-contents"><pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="yaml ">AMIInfo:
  Type: Custom::AMIInfo
  Properties:
    ServiceToken: !GetAtt AMIInfoFunction.Arn
    Region: !Ref "AWS::Region"
    OSName: !Ref "WindowsVersion"</code></pre></div></div>
    <p>AWS CloudFormation이 Lambda 함수를 호출하면 이 함수는 리전 및 인스턴스 아키텍처 또는 OS 이름을 사용하여 이미지 목록을 필터링하는 EC2 <code class="code">DescribeImages</code> API를 호출합니다. 그런 다음 이 함수는 날짜별로 이미지 목록을 정렬하고 최신 AMI ID를 반환합니다.</p>
    <p>최신 AMI ID 반환 시 이 함수는 <a href="./crpg-ref-responses.html">응답 객체</a>의 <code class="code">Data</code> 속성에 있는 미리 서명된 URL로 반환된 ID를 전송합니다. 다음 예에 표시된 것처럼 데이터는 이름-값 페어로 구성됩니다.</p>
    <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="json ">"Data": <span>{</span> 
  "Id": "ami-43795473"
}</code></pre>
    <p>다음 코드 조각은 Lambda 함수에서 데이터를 가져오는 방법을 보여줍니다. 이 함수는 <code class="code">Fn::GetAtt</code> 내장 함수를 사용하여 사용자 지정 리소스의 이름 및 가져오려는 값의 속성 이름을 제공합니다. 이 연습에서 사용자 지정 리소스의 이름은 <code class="code">AMIInfo</code>이고 속성 이름은 <code class="code">Id</code>입니다.</p>
    <div class="example"><h6>예 JSON 구문:</h6><div class="example-contents"><pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="json ">"SampleInstance": <span>{</span>  
  "Type": "AWS::EC2::Instance",
  "Properties": <span>{</span>
    "InstanceType"   : <span>{</span> "Ref" : "InstanceType" },
    "ImageId": <span>{</span> "Fn::GetAtt": [ "AMIInfo", "Id" ] }
  }
}</code></pre></div></div>
    <div class="example"><h6>예 YAML 구문</h6><div class="example-contents"><pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="yaml ">SampleInstance:
  Type: AWS::EC2::Instance
  Properties:
    InstanceType: !Ref InstanceType
    ImageId: !GetAtt AMIInfo.Id</code></pre></div></div>
    <p>이제 템플릿이 수행하는 작업과 샘플 템플릿을 사용하여 스택을 생성하는 방법을 이해하게 되었습니다.</p>
    <div class="procedure"><h6> 스택을 생성하는 방법</h6><ol><li>
        <p>AWS CloudFormation 콘솔(<a href="https://console.aws.amazon.com/cloudformation/" rel="noopener noreferrer" target="_blank"><span>https://console.aws.amazon.com/cloudformation/</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a>)을 엽니다.</p>
      </li><li>
        <p><b>스택 생성</b>을 선택합니다.</p>
      </li><li>
        <p><b>템플릿 섹션</b>에서 <b>Amazon S3 임시 URL 지정</b>을 선택하고 다음 URL을 복사해 텍스트 상자에 붙여 넣습니다.</p>
        <div class="variablelist">
           
           
        <dl>
            <dt><b><span class="term">Linux 템플릿</span></b></dt>
            <dd>
              <p><code class="code"><a href="https://s3.amazonaws.com/cloudformation-examples/lambda/LambdaAMILookupSample.template" rel="noopener noreferrer" target="_blank"><span>https://s3.amazonaws.com/cloudformation-examples/lambda/LambdaAMILookupSample.template</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a></code></p>
            </dd>
          
            <dt><b><span class="term">Windows 템플릿</span></b></dt>
            <dd>
              <p><code class="code"><a href="https://s3.amazonaws.com/cloudformation-examples/lambda/LambdaAMILookupSample-win.template" rel="noopener noreferrer" target="_blank"><span>https://s3.amazonaws.com/cloudformation-examples/lambda/LambdaAMILookupSample-win.template</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a></code></p>
            </dd>
          </dl></div>
      </li><li>
        <p><b>다음</b>을 선택합니다.</p>
      </li><li>
        <p><b>스택 이름</b> 필드에 <code class="userinput">SampleEC2Instance</code>을 입력합니다.</p>
      </li><li>
        <p><b>파라미터</b> 섹션에서 자신이 생성한 Amazon S3 버킷의 이름을 지정하고 <b>다음</b>을 선택합니다.</p>
        <p>기타 파라미터의 기본값은 <code>.zip</code> 패키지에서 사용되는 동일한 이름입니다.</p>
      </li><li>
        <p>이 연습에서는 태그를 추가하거나 고급 설정을 지정할 필요가 없으므로 <b>다음</b>을 선택합니다.</p>
      </li><li>
        <p>스택 이름과 템플릿 URL이 올바른지 확인한 다음 <b>생성</b>을 선택합니다.</p>
      </li></ol></div>
    <p>AWS CloudFormation에서 스택을 생성하는 데 몇 분 정도 걸릴 수 있습니다. 진행 상황을 모니터링하려면 스택 이벤트를 확인합니다. 자세한 내용은 <a href="./cfn-console-view-stack-data-resources.html">AWS Management Console에서 AWS CloudFormation 스택 데이터 및 리소스 보기</a> 단원을 참조하십시오.</p>
    <p>스택 생성에 성공하면 스택의 모든 리소스(예: Lambda 함수, 사용자 지정 리소스 및 EC2 인스턴스)가 생성된 것입니다. Lambda 함수 및 사용자 지정 리소스를 성공적으로 사용해 EC2 인스턴스의 AMI ID를 지정했습니다. 이 템플릿에서는 AMI ID의 매핑을 생성해 유지할 필요가 없습니다.</p>
    <p>EC2 인스턴스를 생성하는 데 사용한 AMI ID AWS CloudFormation을 확인하려면 스택 출력을 살펴봅니다.</p>
   <p>Lambda 함수가 오류를 반환하면 Amazon CloudWatch Logs <a href="https://console.aws.amazon.com/cloudwatch/home#logs:" rel="noopener noreferrer" target="_blank"><span>콘솔</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a>에서 함수 로그를 확인합니다. 로그 스트림의 이름은 사용자 지정 리소스의 물리적 ID로, 스택의 리소스를 보면 확인할 수 있습니다. 자세한 내용을 알아보려면 <em>Amazon CloudWatch 사용 설명서</em>의 <a href="https://docs.aws.amazon.com/AmazonCloudWatch/latest/logs/Working-with-log-groups-and-streams.html#ViewingLogData">로그 데이터 보기</a>를 참조하세요.</p>
   
   <h2 id="walkthrough-custom-resources-lambda-lookup-amiids-createfunction-cleanup">3단계: 리소스 정리</h2>
    
    <p>원치 않는 서비스에 대해 요금이 청구되지 않도록 하려면 스택을 삭제합니다.</p>
    <div class="procedure"><h6>스택을 삭제하려면</h6><ol><li>
        <p>AWS CloudFormation 콘솔에서 <b>SampleEC2Instance</b> 스택을 선택합니다.</p>
      </li><li>
        <p><b>작업</b>을 선택한 다음 <b>스택 삭제</b>를 선택합니다.</p>
      </li><li>
        <p>확인 메시지에서 <b>예, 삭제</b>를 선택합니다.</p>
      </li></ol></div>
    <p>생성한 리소스가 모두 삭제됩니다.</p>
    <p>이제 AWS CloudFormation에서 Lambda 함수를 생성해 사용하는 방법을 이해했으므로 이 연습의 샘플 템플릿과 코드를 사용하여 기타 스택 및 함수를 빌드할 수 있습니다.</p>
  <h2 id="w9aac23c26c16b7c29">관련 정보</h2>
    
    <div class="itemizedlist">
       
    <ul class="itemizedlist"><li class="listitem">
        <p><a href="./crpg-ref.html">AWS CloudFormation 사용자 정의 리소스 참조</a></p>
      </li></ul></div>
  <awsdocs-copyright class="copyright-print"></awsdocs-copyright><awsdocs-thumb-feedback right-edge="{{$ctrl.thumbFeedbackRightEdge}}"></awsdocs-thumb-feedback></div><noscript><div><div><div><div id="js_error_message"><p><img src="https://d1ge0kk1l5kms0.cloudfront.net/images/G/01/webservices/console/warning.png" alt="주의" /> <strong>javascript가 브라우저에서 비활성화되거나 사용이 불가합니다.</strong></p><p>AWS 설명서를 사용하려면 Javascript가 활성화되어야 합니다. 지침을 보려면 브라우저의 도움말 페이지를 참조하십시오.</p></div></div></div></div></noscript><div id="main-col-footer" class="awsui-util-font-size-0"><div id="doc-conventions"><a target="_top" href="/general/latest/gr/docconventions.html">문서 규칙</a></div><div class="prev-next"><div id="previous" class="prev-link" accesskey="p" href="./template-custom-resources-lambda.html">AWS Lambda 지원 사용자 지정 리소스</div><div id="next" class="next-link" accesskey="n" href="./cfn-lambda-function-code-cfnresponsemodule.html">cfn-response 모듈</div></div></div><awsdocs-page-utilities></awsdocs-page-utilities></div><div id="quick-feedback-yes" style="display: none;"><div class="title">이 페이지의 내용이 도움이 되었습니까? - 예</div><div class="content"><p>칭찬해 주셔서 감사합니다!</p><p>잠깐 시간을 내어 좋았던 부분을 알려 주시면 더 열심히 만들어 보겠습니다.</p><p><awsui-button id="fblink" rel="noopener noreferrer" target="_blank" text="feedback-tell-us" click="linkClick($event)" href="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=CloudFormation&amp;topic_url=https://docs.aws.amazon.com/ko_kr/AWSCloudFormation/latest/UserGuide/walkthrough-custom-resources-lambda-lookup-amiids.html"></awsui-button></p></div></div><div id="quick-feedback-no" style="display: none;"><div class="title">이 페이지의 내용이 도움이 되었습니까? - 아니요</div><div class="content"><p>이 페이지에 작업이 필요하다는 점을 알려 주셔서 감사합니다. 실망시켜 드려 죄송합니다.</p><p>잠깐 시간을 내어 설명서를 향상시킬 수 있는 방법에 대해 말씀해 주십시오.</p><p><awsui-button id="fblink" rel="noopener noreferrer" target="_blank" text="feedback-tell-us" click="linkClick($event)" href="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=CloudFormation&amp;topic_url=https://docs.aws.amazon.com/ko_kr/AWSCloudFormation/latest/UserGuide/walkthrough-custom-resources-lambda-lookup-amiids.html"></awsui-button></p></div></div></div></body></div></awsdocs-view><div class="page-loading-indicator" id="page-loading-indicator"><awsui-spinner size="large"></awsui-spinner></div></div><div id="tools-panel" dom-region="tools"><awsdocs-tools-panel id="awsdocs-tools-panel"></awsdocs-tools-panel></div></awsui-app-layout><awsdocs-cookie-banner class="doc-cookie-banner"></awsdocs-cookie-banner></div></body></html>