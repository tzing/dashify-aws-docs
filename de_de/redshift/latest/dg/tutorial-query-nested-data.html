<!DOCTYPE html>
    <html xmlns="http://www.w3.org/1999/xhtml" lang="de-DE"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Tutorial: Abfragen verschachtelter Daten mit Amazon Redshift Spectrum - Amazon Redshift</title><meta name="viewport" content="width=device-width,initial-scale=1" /><meta name="assets_root" content="/assets" /><meta name="target_state" content="tutorial-query-nested-data" /><meta name="default_state" content="tutorial-query-nested-data" /><link rel="icon" type="image/ico" href="/assets/images/favicon.ico" /><link rel="shortcut icon" type="image/ico" href="/assets/images/favicon.ico" /><link rel="canonical" href="https://docs.aws.amazon.com/de_de/redshift/latest/dg/tutorial-query-nested-data.html" /><meta name="description" content="Fragen Sie verschachtelte Daten mit Amazon Redshift Spectrum ab." /><meta name="deployment_region" content="IAD" /><meta name="product" content="Amazon Redshift" /><meta name="guide" content="Datenbankentwicklerhandbuch" /><meta name="abstract" content="Erstellen und verwalten Sie ein Data Warehouse mit Amazon Redshift, einem vollständig verwalteten Petabyte-Data-Warehousing-Service auf Unternehmensniveau." /><meta name="guide-locale" content="de_de" /><meta name="tocs" content="toc-contents.json" /><link rel="canonical" href="https://docs.aws.amazon.com/de_de/redshift/latest/dg/tutorial-query-nested-data.html" /><link rel="alternative" href="https://docs.aws.amazon.com/id_id/redshift/latest/dg/tutorial-query-nested-data.html" hreflang="id-id" /><link rel="alternative" href="https://docs.aws.amazon.com/id_id/redshift/latest/dg/tutorial-query-nested-data.html" hreflang="id" /><link rel="alternative" href="https://docs.aws.amazon.com/de_de/redshift/latest/dg/tutorial-query-nested-data.html" hreflang="de-de" /><link rel="alternative" href="https://docs.aws.amazon.com/de_de/redshift/latest/dg/tutorial-query-nested-data.html" hreflang="de" /><link rel="alternative" href="https://docs.aws.amazon.com/redshift/latest/dg/tutorial-query-nested-data.html" hreflang="en-us" /><link rel="alternative" href="https://docs.aws.amazon.com/redshift/latest/dg/tutorial-query-nested-data.html" hreflang="en" /><link rel="alternative" href="https://docs.aws.amazon.com/es_es/redshift/latest/dg/tutorial-query-nested-data.html" hreflang="es-es" /><link rel="alternative" href="https://docs.aws.amazon.com/es_es/redshift/latest/dg/tutorial-query-nested-data.html" hreflang="es" /><link rel="alternative" href="https://docs.aws.amazon.com/fr_fr/redshift/latest/dg/tutorial-query-nested-data.html" hreflang="fr-fr" /><link rel="alternative" href="https://docs.aws.amazon.com/fr_fr/redshift/latest/dg/tutorial-query-nested-data.html" hreflang="fr" /><link rel="alternative" href="https://docs.aws.amazon.com/it_it/redshift/latest/dg/tutorial-query-nested-data.html" hreflang="it-it" /><link rel="alternative" href="https://docs.aws.amazon.com/it_it/redshift/latest/dg/tutorial-query-nested-data.html" hreflang="it" /><link rel="alternative" href="https://docs.aws.amazon.com/ja_jp/redshift/latest/dg/tutorial-query-nested-data.html" hreflang="ja-jp" /><link rel="alternative" href="https://docs.aws.amazon.com/ja_jp/redshift/latest/dg/tutorial-query-nested-data.html" hreflang="ja" /><link rel="alternative" href="https://docs.aws.amazon.com/ko_kr/redshift/latest/dg/tutorial-query-nested-data.html" hreflang="ko-kr" /><link rel="alternative" href="https://docs.aws.amazon.com/ko_kr/redshift/latest/dg/tutorial-query-nested-data.html" hreflang="ko" /><link rel="alternative" href="https://docs.aws.amazon.com/pt_br/redshift/latest/dg/tutorial-query-nested-data.html" hreflang="pt-br" /><link rel="alternative" href="https://docs.aws.amazon.com/pt_br/redshift/latest/dg/tutorial-query-nested-data.html" hreflang="pt" /><link rel="alternative" href="https://docs.aws.amazon.com/zh_cn/redshift/latest/dg/tutorial-query-nested-data.html" hreflang="zh-cn" /><link rel="alternative" href="https://docs.aws.amazon.com/zh_tw/redshift/latest/dg/tutorial-query-nested-data.html" hreflang="zh-tw" /><link rel="alternative" href="https://docs.aws.amazon.com/redshift/latest/dg/tutorial-query-nested-data.html" hreflang="x-default" /><meta name="feedback-item" content="Redshift" /><meta name="this_doc_product" content="Amazon Redshift" /><meta name="this_doc_guide" content="Datenbankentwicklerhandbuch" /><script defer="" src="/assets/r/vendor4.js?version=2021.12.02"></script><script defer="" src="/assets/r/vendor3.js?version=2021.12.02"></script><script defer="" src="/assets/r/vendor1.js?version=2021.12.02"></script><script defer="" src="/assets/r/awsdocs-common.js?version=2021.12.02"></script><script defer="" src="/assets/r/awsdocs-doc-page.js?version=2021.12.02"></script><link href="/assets/r/vendor4.css?version=2021.12.02" rel="stylesheet" /><link href="/assets/r/awsdocs-common.css?version=2021.12.02" rel="stylesheet" /><link href="/assets/r/awsdocs-doc-page.css?version=2021.12.02" rel="stylesheet" /><script async="" id="awsc-panorama-bundle" type="text/javascript" src="https://prod.pa.cdn.uis.awsstatic.com/panorama-nav-init.js" data-config="{'appEntity':'aws-documentation','region':'us-east-1','service':'redshift'}"></script><meta id="panorama-serviceSubSection" value="Datenbankentwicklerhandbuch" /><meta id="panorama-serviceConsolePage" value="Tutorial: Abfragen verschachtelter Daten mit Amazon Redshift Spectrum" /></head><body class="awsdocs awsui"><div class="awsdocs-container"><awsdocs-header></awsdocs-header><awsui-app-layout id="app-layout" class="awsui-util-no-gutters" ng-controller="ContentController as $ctrl" header-selector="awsdocs-header" navigation-hide="false" navigation-width="$ctrl.navWidth" navigation-open="$ctrl.navOpen" navigation-change="$ctrl.onNavChange($event)" tools-hide="$ctrl.hideTools" tools-width="$ctrl.toolsWidth" tools-open="$ctrl.toolsOpen" tools-change="$ctrl.onToolsChange($event)"><div id="guide-toc" dom-region="navigation"><awsdocs-toc></awsdocs-toc></div><div id="main-column" dom-region="content" tabindex="-1"><awsdocs-view class="awsdocs-view"><div id="awsdocs-content"><head><title>Tutorial: Abfragen verschachtelter Daten mit Amazon Redshift Spectrum - Amazon Redshift</title><meta name="pdf" content="redshift-dg.pdf#tutorial-query-nested-data" /><meta name="rss" content="Dochistory.rss" /><meta name="forums" content="http://forums.aws.amazon.com/forum.jspa?forumID=155" /><meta name="feedback" content="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=Redshift&amp;topic_url=https://docs.aws.amazon.com/de_de/redshift/latest/dg/tutorial-query-nested-data.html" /><meta name="feedback-yes" content="feedbackyes.html?topic_url=https://docs.aws.amazon.com/de_de/redshift/latest/dg/tutorial-query-nested-data.html" /><meta name="feedback-no" content="feedbackno.html?topic_url=https://docs.aws.amazon.com/de_de/redshift/latest/dg/tutorial-query-nested-data.html" /><meta name="keywords" content="Amazon Redshift,AWS Redshift,Redshift,Redshift Spectrum,Cluster,Data Warehouse,Developer,Musterdaten,Datenbank,Database Developer,HLL" /><script type="application/ld+json">
{
    "@context" : "https://schema.org",
    "@type" : "BreadcrumbList",
    "itemListElement" : [
      {
        "@type" : "ListItem",
        "position" : 1,
        "name" : "AWS",
        "item" : "https://aws.amazon.com"
      },
      {
        "@type" : "ListItem",
        "position" : 2,
        "name" : "Amazon Redshift",
        "item" : "https://docs.aws.amazon.com/redshift/index.html"
      },
      {
        "@type" : "ListItem",
        "position" : 3,
        "name" : "Datenbankentwicklerhandbuch",
        "item" : "https://docs.aws.amazon.com/de_de/redshift/latest/dg"
      },
      {
        "@type" : "ListItem",
        "position" : 4,
        "name" : "Abfrage externer Daten mit Amazon Redshift Spectrum",
        "item" : "https://docs.aws.amazon.com/de_de/redshift/latest/dg/c-using-spectrum.html"
      },
      {
        "@type" : "ListItem",
        "position" : 5,
        "name" : "Tutorial: Abfragen verschachtelter Daten mit Amazon Redshift Spectrum",
        "item" : "https://docs.aws.amazon.com/de_de/redshift/latest/dg/c-using-spectrum.html"
      }
    ]
}
</script></head><body><div id="main"><div style="display: none"><a href="redshift-dg.pdf#tutorial-query-nested-data" target="_blank" rel="noopener noreferrer" title="PDF öffnen"></a></div><div id="breadcrumbs" class="breadcrumb"><a href="https://aws.amazon.com">AWS</a><a href="/index.html">Dokumentation</a><a href="/redshift/index.html">Amazon Redshift</a><a href="welcome.html">Datenbankentwicklerhandbuch</a></div><div id="page-toc-src"><a href="#tutorial-nested-data-overview">Übersicht</a><a href="#tutorial-nested-data-create-table">Schritt 1: Erstellen einer externen Tabelle mit verschachtelten Daten</a><a href="#tutorial-query-nested-data-sqlextensions">Schritt 2: Abfragen Ihrer verschachtelten Daten in Amazon S3 mit SQL-Erweiterungen</a></div><div id="main-content" class="awsui-util-container"><div id="main-col-body"><awsdocs-language-banner data-service="$ctrl.pageService"></awsdocs-language-banner><awsui-alert class="awsdocs-page-banner awsui-util-mb-l"><p>Die vorliegende Übersetzung wurde maschinell erstellt. Im Falle eines Konflikts oder eines Widerspruchs zwischen dieser übersetzten Fassung und der englischen Fassung (einschließlich infolge von Verzögerungen bei der Übersetzung) ist die englische Fassung maßgeblich.</p></awsui-alert><h1 class="topictitle" id="tutorial-query-nested-data">Tutorial: Abfragen verschachtelter Daten mit Amazon Redshift Spectrum</h1><div class="awsdocs-page-header-container"><awsdocs-page-header></awsdocs-page-header><awsdocs-filter-selector id="awsdocs-filter-selector"></awsdocs-filter-selector></div>
        <h2 id="tutorial-nested-data-overview">Übersicht</h2>
                
        <p>Amazon Redshift Spectrum unterstützt das Abfragen verschachtelter Daten in den Dateiformaten ORC, JSON und Ion. Redshift Spectrum greift mittels externer Tabellen auf die Daten zu. Sie können externe Tabellen erstellen, die die komplexen Datentypen <code class="code">struct</code>, <code class="code">array</code> und <code class="code">map</code> verwenden.</p>
        <p>Angenommen, Ihre Datendatei enthält die folgenden Daten in Amazon S3 in einem Ordner mit dem Namen <code class="code">customers</code>. Obwohl kein einziges Stammelement vorhanden ist, stellt jedes JSON-Objekt in diesen Stichprobendaten eine Zeile in einer Tabelle dar. </p>
<pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Kopieren"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>"id": 1,
 "name": <span>{</span>"given": "John", "family": "Smith"},
 "phones": ["123-457789"],
 "orders": [<span>{</span>"shipdate": "2018-03-01T11:59:59.000Z", "price": 100.50},
            <span>{</span>"shipdate": "2018-03-01T09:10:00.000Z", "price": 99.12}]
}
<span>{</span>"id": 2,
 "name": <span>{</span>"given": "Jenny", "family": "Doe"},
 "phones": ["858-8675309", "415-9876543"],
 "orders": []
}
<span>{</span>"id": 3,
 "name": <span>{</span>"given": "Andy", "family": "Jones"},
 "phones": [],
 "orders": [<span>{</span>"shipdate": "2018-03-02T08:02:15.000Z", "price": 13.50}]
}  </code></pre>        
   
        
        <p>Sie können mithilfe von Amazon Redshift Spectrum verschachtelte Daten in Dateien abfragen. Das folgende Tutorial veranschaulicht die Vorgehensweise hierfür mit Apache-Parquet-Daten.</p> 
        <p>Voraussetzungen für das Tutorial, Verfahrensschritte und Anwendungsfälle verschachtelter Daten finden Sie in den folgenden Themen:</p>
        <div class="itemizedlist">
             
             
             
             
             
             
        <ul class="itemizedlist"><li class="listitem">
                <p><a href="#tutorial-nested-data-prereq">Voraussetzungen</a></p>
            </li><li class="listitem">
                <p><a href="#tutorial-nested-data-create-table">Schritt 1: Erstellen einer externen Tabelle mit verschachtelten Daten</a></p>
            </li><li class="listitem">
                <p><a href="#tutorial-query-nested-data-sqlextensions">Schritt 2: Abfragen Ihrer verschachtelten Daten in Amazon S3 mit SQL-Erweiterungen</a></p>
            </li><li class="listitem">
                <p><a href="./nested-data-use-cases.html">Anwendungsfälle für verschachtelte Daten </a></p>
            </li><li class="listitem">
                <p><a href="./nested-data-restrictions.html">Einschränkungen bei verschachtelten Daten (Vorschau)</a></p>
            </li><li class="listitem">
                <p><a href="./serializing-complex-JSON.html">Serialisieren komplexer verschachtelter JSON-Datentypen</a></p>
            </li></ul></div>
        
        


         
            <h3 id="tutorial-nested-data-prereq">Voraussetzungen</h3>
            
            <p>Wenn Sie noch nicht mit Redshift Spectrum vertraut sind, befolgen Sie die Schritte unter <a href="./c-getting-started-using-spectrum.html">Erste Schritte mit Amazon Redshift Spectrum</a>, bevor Sie fortfahren.</p>
            
            <p>Um ein externes Schema zu erstellen, ersetzen Sie den ARN der IAM-Rolle im folgenden Befehl durch den Rollen-ARN, den Sie im Abschnitt <a href="./c-getting-started-using-spectrum-create-role.html">Erstellen einer IAM-Rolle</a> festgelegt haben. Führen Sie dann den Befehl in Ihrem SQL-Client aus.</p>
            <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Kopieren"><awsui-icon name="copy"></awsui-icon></div></div><code class="">create external schema spectrum 
from data catalog 
database 'myspectrum_db' 
iam_role 'arn:aws:iam::123456789012:role/myspectrum_role'
create external database if not exists;</code></pre>
         

     
        <h2 id="tutorial-nested-data-create-table">Schritt 1: Erstellen einer externen Tabelle mit verschachtelten Daten</h2>
        <p>Sie können die <a href="https://s3.amazonaws.com/redshift-downloads/tickit/spectrum/customers/customer_file1" rel="noopener noreferrer" target="_blank"><span>Quelldaten</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a> anzeigen, indem Sie sie von Amazon S3 herunterladen. </p>

        <p>Um die externe Tabelle für dieses Tutorial zu erstellen, führen Sie den folgenden Befehl aus. </p>
        <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Kopieren"><awsui-icon name="copy"></awsui-icon></div></div><code class="">CREATE EXTERNAL TABLE spectrum.customers (
  id     int,
  name   struct&lt;given:varchar(20), family:varchar(20)&gt;,
  phones array&lt;varchar(20)&gt;,
  orders array&lt;struct&lt;shipdate:timestamp, price:double precision&gt;&gt;
)
STORED AS PARQUET
LOCATION 's3://redshift-downloads/tickit/spectrum/customers/';     </code></pre>
        
        <p>Im voranstehenden Beispiel verwendet die externe Tabelle <code class="code">spectrum.customers</code> die Datentypen <code class="code">struct</code> und <code class="code">array</code>, um Spalten mit verschachtelten Daten zu definieren. Amazon Redshift Spectrum unterstützt das Abfragen verschachtelter Daten in den Dateiformaten ORC, JSON und Ion. Der Parameter <code class="code">STORED AS</code> für Apache-Parquet-Dateien lautet <code class="code">PARQUET</code>. Der Parameter <code class="code">LOCATION</code> muss auf den Amazon S3-Ordner verweisen, der die verschachtelten Daten oder Dateien enthält. Weitere Informationen finden Sie unter <a href="./r_CREATE_EXTERNAL_TABLE.html">CREATE EXTERNAL TABLE</a>.</p>
        
        
        <p>Sie können die Typen <code class="code">array</code> und <code class="code">struct</code> auf jeder beliebigen Ebene verschachteln. So können Sie z. B. eine Spalte mit dem Namen <code class="code">toparray</code> definieren; siehe folgendes Beispiel.</p>
        <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Kopieren"><awsui-icon name="copy"></awsui-icon></div></div><code class="">toparray array&lt;struct&lt;nestedarray:
         array&lt;struct&lt;morenestedarray: 
         array&lt;string&gt;&gt;&gt;&gt;&gt;</code></pre>
        <p>Außerdem können Sie wie für Spalte <code class="code">struct</code> im folgenden Beispiel veranschaulicht auch <code class="code">x</code>-Typen verschachteln.</p>
        <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Kopieren"><awsui-icon name="copy"></awsui-icon></div></div><code class="">x struct&lt;a: string,
         b: struct&lt;c: integer,
                   d: struct&lt;e: string&gt;
                  &gt;
        &gt;</code></pre>
   
     
                <h2 id="tutorial-query-nested-data-sqlextensions">Schritt 2: Abfragen Ihrer verschachtelten Daten in Amazon S3 mit SQL-Erweiterungen</h2>
                <p>Redshift Spectrum unterstützt das Abfragen komplexer <code class="code">array</code>-, <code class="code">map</code>- und <code class="code">struct</code>-Typen durch Erweiterungen der Amazon-Redshift-SQL-Syntax. </p>
                 
                    <h3 id="nested-data-sqlextension1">Erweiterung 1: Zugriff auf Structs-Spalten</h3>
                    <p>Sie können Daten aus <code class="code">struct</code>-Spalten extrahieren. Dazu verwenden Sie eine punktierte Schreibweise, die Feldnamen in Pfade verkettet. Die folgende Abfrage gibt z. B. Vor- und Nachnamen von Kunden zurück. Auf den Vornamen wird über den langen Pfad <code class="code">c.name.given</code> zugegriffen. Auf den Nachnamen wird über den langen Pfad <code class="code">c.name.family</code> zugegriffen. </p>    
                    <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Kopieren"><awsui-icon name="copy"></awsui-icon></div></div><code class="">SELECT c.id, c.name.given, c.name.family
FROM   spectrum.customers c;</code></pre>
                    <p>Die vorhergehende Abfrage gibt die folgenden Daten zurück.</p>
                    <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Kopieren"><awsui-icon name="copy"></awsui-icon></div></div><code class="">id | given | family
---|-------|-------
1  | John  | Smith
2  | Jenny | Doe
3  | Andy  | Jones
(3 rows)</code></pre>
                    <p>Ein <code class="code">struct</code>-Element kann eine Spalte eines anderen <code class="code">struct</code>-Elements sein, das wiederum auf einer beliebigen anderen Ebene eine Spalte eines anderen <code class="code">struct</code>-Elements sein kann. Die Pfade, die auf Spalten in solchen tief verschachtelten <code class="code">struct</code>-Elementen zugreifen können willkürlich lang sein. Betrachten Sie sich z. B. die Definition der Spalte <code class="code">x</code> im folgenden Beispiel.</p>     
<pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Kopieren"><awsui-icon name="copy"></awsui-icon></div></div><code class="">x struct&lt;a: string,
         b: struct&lt;c: integer, 
                      d: struct&lt;e: string&gt;
                  &gt;
        &gt;</code></pre>        
        <p>Sie können auf die Daten in <code class="code">e</code> als <code class="code">x.b.d.e</code> zugreifen.</p>
    
                    
                    
                   
                 
                    <h3 id="nested-data-sqlextension2">Erweiterung 2: Übergreifende Arrays in einer FROM-Klausel</h3>
                    <p>Sie können Daten aus <code class="code">array</code>-Spalten (und damit auch aus <code class="code">map</code>-Spalten) extrahieren, indem Sie die <code class="code">array</code>-Spalten in einer <code class="code">FROM</code>-Klausel anstelle von Tabellennamen angeben. Die Erweiterung gilt für die <code class="code">FROM</code>-Klausel der Hauptabfrage sowie auch für die <code class="code">FROM</code>-Klauseln von Unterabfragen.</p>
                        
                <p>Sie können auf <code class="code">array</code>-Elemente nach Position verweisen, also beispielsweise <code class="code">c.orders[0]</code> angeben (Vorschau).</p>
                    <p>Durch das Kombinieren von übergreifenden <code class="code">arrays</code> mit Joins können Sie die Verschachtelung auf verschiedene Weise aufheben, wie in den folgenden Anwendungsfällen beschrieben. </p>
                     
                        <h4 id="unnest-inner-joins">Aufheben der Verschachtelung mit Inner Joins</h4>
                        <p>Die folgende Abfrage wählt Kunden-IDs und Auftragslieferdaten für Kunden aus, für die Aufträgen vorhanden sind. Die SQL-Erweiterung in der FROM-Klausel <code class="code">c.orders
                        o</code> ist vom Alias <code class="code">c</code> abhängig.</p>
                    <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Kopieren"><awsui-icon name="copy"></awsui-icon></div></div><code class="">SELECT c.id, o.shipdate
FROM   spectrum.customers c, c.orders o </code></pre> 
                        <p>Für jeden Kunden <code class="code">c</code>, für den Aufträge vorhanden sind, gibt die <code class="code">FROM</code>-Klausel für jeden Auftrag <code class="code">o</code> des Kunden <code class="code">c</code> eine Zeile zurück. Diese Zeile kombiniert die Kundenzeile <code class="code">c</code> und die Auftragszeile <code class="code">o</code>. Die <code class="code">SELECT</code>-Klausel behält dann nur <code class="code">c.id</code> und <code class="code">o.shipdate</code> bei. Dies führt zu folgendem Ergebnis.</p>
                         <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Kopieren"><awsui-icon name="copy"></awsui-icon></div></div><code class="">id|      shipdate
--|----------------------
1 |2018-03-01  11:59:59
1 |2018-03-01  09:10:00
3 |2018-03-02  08:02:15
(3 rows) </code></pre>   
                        <p>Der Alias <code class="code">c</code> bietet Zugriff auf die Kundenfelder, und der Alias <code class="code">o</code> bietet Zugriff auf die Auftragsfelder. </p>
                        <p>Die Semantik ist mit Standard-SQL vergleichbar. Sie können sich die <code class="code">FROM</code>-Klausel so vorstellen, als würde die folgende verschachtelte Schleife ausgeführt werden, gefolgt von <code class="code">SELECT</code> zur Auswahl der auszugebenden Felder. </p>
                        <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Kopieren"><awsui-icon name="copy"></awsui-icon></div></div><code class="">for each customer c in spectrum.customers
  for each order o in c.orders
     output c.id and o.shipdate </code></pre>
                        <p>Daher erscheinen Kunden, für die keine Aufträge vorhanden sind, nicht im Ergebnis.</p>
                        <p>Sie können sich das auch so vorstellen, als ob die <code class="code">FROM</code>-Klausel einen <code class="code">JOIN</code> mit der <code class="code">customers</code>-Tabelle und dem <code class="code">orders</code>-Array durchführen wurde. Sie können die Abfrage daher auch wie im folgenden Beispiel veranschaulicht schreiben.</p>
                        <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Kopieren"><awsui-icon name="copy"></awsui-icon></div></div><code class="">SELECT c.id, o.shipdate
FROM   spectrum.customers c INNER JOIN c.orders o ON true </code></pre>
                        <div class="awsdocs-note"><div class="awsdocs-note-title"><awsui-icon name="status-info" variant="link"></awsui-icon><h6>Anmerkung</h6></div><div class="awsdocs-note-text"><p>Wenn ein Schema mit dem Namen <code class="code">c</code> mit einer Tabelle mit dem Namen <code class="code">orders</code> vorhanden ist, dann bezieht sich <code class="code">c.orders</code> auf die Tabelle <code class="code">orders</code> und nicht auf die Array-Spalte von <code class="code">customers</code>.</p></div></div>
                 
                 
                    <h4 id="unnest-left-joins">Aufheben der Verschachtelung mit Left Joins</h4>
                    <p>Die folgende Abfrage gibt alle Kundennamen und deren Aufträge aus. Für Kunden, die keinen Auftrag erteilt haben, wird dennoch der Kundenname zurückgegeben. In diesem Fall ist der Wert der Auftragsspalten jedoch NULL, wie im folgenden Beispiel für Jenny Doe veranschaulicht.</p>
                    <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Kopieren"><awsui-icon name="copy"></awsui-icon></div></div><code class="">SELECT c.id, c.name.given, c.name.family, o.shipdate, o.price
FROM   spectrum.customers c LEFT JOIN c.orders o ON true</code></pre>
                    
                    <p>Die vorhergehende Abfrage gibt die folgenden Daten zurück.</p>
                    <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Kopieren"><awsui-icon name="copy"></awsui-icon></div></div><code class="">id  |  given  | family  |    shipdate          | price
----|---------|---------|----------------------|--------
 1  |  John   | Smith   | 2018-03-01  11:59:59 | 100.5
 1  |  John   | Smith   | 2018-03-01  09:10:00 |  99.12
 2  |  Jenny  | Doe     |                      |
 3  |  Andy   | Jones   | 2018-03-02  08:02:15 |  13.5
 (4 rows)</code></pre>
                 
                
                 
                    <h3 id="nested-data-sqlextension3">Erweiterung 3: Direkter Zugriff auf ein Array von Skalaren über einen Alias </h3>
                    <p>Wenn sich der Alias <code class="code">p</code> in einer <code class="code">FROM</code>-Klausel über ein Array von Skalaren erstreckt, bezeichnet die Abfrage die <code class="code">p</code>-Werte als <code class="code">p</code>. Die folgende Abfrage ergibt z. B. Paare aus Kundennamen und Telefonnummern.</p>
                    <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Kopieren"><awsui-icon name="copy"></awsui-icon></div></div><code class="">SELECT c.name.given, c.name.family, p AS phone
FROM   spectrum.customers c LEFT JOIN c.phones p ON true  </code></pre>
                    <p>Die vorhergehende Abfrage gibt die folgenden Daten zurück.</p>
                    <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Kopieren"><awsui-icon name="copy"></awsui-icon></div></div><code class="">given  |  family  |  phone
-------|----------|-----------
John   | Smith    | 123-4577891
Jenny  | Doe      | 858-8675309
Jenny  | Doe      | 415-9876543
Andy   | Jones    | 
(4 rows) </code></pre>
                     
                 
                    <h3 id="nested-data-sqlextension4">Erweiterung 4: Zugriff auf Zuordnungselemente </h3>
                    <p>Redshift Spectrum verarbeitet den <code class="code">map</code>-Datentyp als einen <code class="code">array</code>-Typ, der <code class="code">struct</code>-Typen mit einer <code class="code">key</code>-Spalte und einer <code class="code">value</code>-Spalte enthält. <code class="code">key</code> muss vom Typ <code class="code">scalar</code> sein; der Wert kann ein beliebiger Datentyp sein. </p>
                    <p>Der folgende Code erstellt z. B. eine externe Tabelle mit einem <code class="code">map</code>-Element zum Speichern von Telefonnummern.</p>
                    <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Kopieren"><awsui-icon name="copy"></awsui-icon></div></div><code class="">CREATE EXTERNAL TABLE spectrum.customers2 (
  id     int,
  name   struct&lt;given:varchar(20), family:varchar(20)&gt;,
  phones map&lt;varchar(20), varchar(20)&gt;,
  orders array&lt;struct&lt;shipdate:timestamp, price:double precision&gt;&gt;
)
STORED AS PARQUET
LOCATION 's3://redshift-downloads/tickit/spectrum/customers/';</code></pre>
                    <p>Da sich ein <code class="code">map</code>-Typ wie ein <code class="code">array</code>-Typ mit den Spalten <code class="code">key</code> und <code class="code">value</code> verhält, können Sie sich die vorhergehenden Schemen so vorstellen, als wären sie die folgenden Schemen.</p>
                    <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Kopieren"><awsui-icon name="copy"></awsui-icon></div></div><code class="">CREATE EXTERNAL TABLE spectrum.customers3 (
  id     int,
  name   struct&lt;given:varchar(20), family:varchar(20)&gt;,
  phones array&lt;struct&lt;key:varchar(20), value:varchar(20)&gt;&gt;,
  orders array&lt;struct&lt;shipdate:timestamp, price:double precision&gt;&gt;
)
STORED AS PARQUET
LOCATION 's3://redshift-downloads/tickit/spectrum/customers/';   </code></pre>
                    
                    <p>Die folgende Abfrage gibt die Namen von Kunden mit Mobiltelefonnummer und die Nummer für jeden Namen zurück. Die Zuordnungsabfrage wird genauso wie die Abfrage eines verschachtelten <code class="code">array</code> aus <code class="code">struct</code>-Typen verarbeitet. Die folgende Abfrage gibt nur Daten zurück, wenn Sie die externe Tabelle wie zuvor beschrieben erstellt haben. </p>   
                     <pre class="programlisting"><div class="code-btn-container"></div><code class="">SELECT c.name.given, c.name.family, p.value 
FROM   spectrum.customers c, c.phones p 
WHERE  p.key = 'mobile';  </code></pre>   
                  <div class="awsdocs-note"><div class="awsdocs-note-title"><awsui-icon name="status-info" variant="link"></awsui-icon><h6>Anmerkung</h6></div><div class="awsdocs-note-text"><p>Der <code class="code">key</code>-Wert für ein <code class="code">map</code>-Element ist bei den Dateitypen Ion und JSON vom Typ <code class="code">string</code>.</p></div></div>      
                    
                    
                     
                <awsdocs-copyright class="copyright-print"></awsdocs-copyright><awsdocs-thumb-feedback right-edge="{{$ctrl.thumbFeedbackRightEdge}}"></awsdocs-thumb-feedback></div><noscript><div><div><div><div id="js_error_message"><p><img src="https://d1ge0kk1l5kms0.cloudfront.net/images/G/01/webservices/console/warning.png" alt="Warnung" /> <strong>JavaScript ist in Ihrem Browser nicht verfügbar oder deaktiviert.</strong></p><p>Zur Nutzung der AWS-Dokumentation muss JavaScript aktiviert sein. Weitere Informationen finden auf den Hilfe-Seiten Ihres Browsers.</p></div></div></div></div></noscript><div id="main-col-footer" class="awsui-util-font-size-0"><div id="doc-conventions"><a target="_top" href="/general/latest/gr/docconventions.html">Dokumentkonventionen</a></div><div class="prev-next"><div id="previous" class="prev-link" accesskey="p" href="./c-spectrum-troubleshooting.html">Fehlerbehebung bei Abfragen</div><div id="next" class="next-link" accesskey="n" href="./nested-data-use-cases.html">Anwendungsfälle für verschachtelte Daten </div></div></div><awsdocs-page-utilities></awsdocs-page-utilities></div><div id="quick-feedback-yes" style="display: none;"><div class="title">Hat Ihnen diese Seite geholfen? – Ja</div><div class="content"><p>Vielen Dank, dass Sie uns mitgeteilt haben, dass wir gute Arbeit geleistet haben!</p><p>Würden Sie sich einen Moment Zeit nehmen, um uns mitzuteilen, was wir richtig gemacht haben, damit wir noch besser werden?</p><p><awsui-button id="fblink" rel="noopener noreferrer" target="_blank" text="Feedback" click="linkClick($event)" href="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=Redshift&amp;topic_url=https://docs.aws.amazon.com/de_de/redshift/latest/dg/tutorial-query-nested-data.html"></awsui-button></p></div></div><div id="quick-feedback-no" style="display: none;"><div class="title">Hat Ihnen diese Seite geholfen? – Nein</div><div class="content"><p>Vielen Dank, dass Sie uns mitgeteilt haben, dass diese Seite überarbeitet werden muss. Es tut uns Leid, dass wir Ihnen nicht weiterhelfen konnten.</p><p>Würden Sie sich einen Moment Zeit nehmen, um uns mitzuteilen, wie wir die Dokumentation verbessern können?</p><p><awsui-button id="fblink" rel="noopener noreferrer" target="_blank" text="Feedback" click="linkClick($event)" href="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=Redshift&amp;topic_url=https://docs.aws.amazon.com/de_de/redshift/latest/dg/tutorial-query-nested-data.html"></awsui-button></p></div></div></div></body></div></awsdocs-view><div class="page-loading-indicator" id="page-loading-indicator"><awsui-spinner size="large"></awsui-spinner></div></div><div id="tools-panel" dom-region="tools"><awsdocs-tools-panel id="awsdocs-tools-panel"></awsdocs-tools-panel></div></awsui-app-layout><awsdocs-cookie-banner class="doc-cookie-banner"></awsdocs-cookie-banner></div></body></html>