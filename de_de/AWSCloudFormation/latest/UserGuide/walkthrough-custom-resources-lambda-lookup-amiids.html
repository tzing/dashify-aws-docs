<!DOCTYPE html>
    <html xmlns="http://www.w3.org/1999/xhtml" lang="de-DE"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Walkthrough: Nachschlagen von Amazon Machine Image-IDs - AWS CloudFormation</title><meta name="viewport" content="width=device-width,initial-scale=1" /><meta name="assets_root" content="/assets" /><meta name="target_state" content="walkthrough-custom-resources-lambda-lookup-amiids" /><meta name="default_state" content="walkthrough-custom-resources-lambda-lookup-amiids" /><link rel="icon" type="image/ico" href="/assets/images/favicon.ico" /><link rel="shortcut icon" type="image/ico" href="/assets/images/favicon.ico" /><link rel="canonical" href="https://docs.aws.amazon.com/de_de/AWSCloudFormation/latest/UserGuide/walkthrough-custom-resources-lambda-lookup-amiids.html" /><meta name="description" content="Verwenden Sie AWS Lambda und eine benutzerdefinierte Ressourcen zum Dynamischen Nachschlagen von AMI-IDs." /><meta name="deployment_region" content="IAD" /><meta name="product" content="AWS CloudFormation" /><meta name="guide" content="Leitfaden" /><meta name="abstract" content="Erstellen und verwalten Sie AWS Infrastrukturbereitstellungen vorhersehbar und wiederholt mithilfe von AWS CloudFormation mit diesem Benutzerhandbuch." /><meta name="guide-locale" content="de_de" /><meta name="tocs" content="toc-contents.json" /><link rel="canonical" href="https://docs.aws.amazon.com/de_de/AWSCloudFormation/latest/UserGuide/walkthrough-custom-resources-lambda-lookup-amiids.html" /><link rel="alternative" href="https://docs.aws.amazon.com/id_id/AWSCloudFormation/latest/UserGuide/walkthrough-custom-resources-lambda-lookup-amiids.html" hreflang="id-id" /><link rel="alternative" href="https://docs.aws.amazon.com/id_id/AWSCloudFormation/latest/UserGuide/walkthrough-custom-resources-lambda-lookup-amiids.html" hreflang="id" /><link rel="alternative" href="https://docs.aws.amazon.com/de_de/AWSCloudFormation/latest/UserGuide/walkthrough-custom-resources-lambda-lookup-amiids.html" hreflang="de-de" /><link rel="alternative" href="https://docs.aws.amazon.com/de_de/AWSCloudFormation/latest/UserGuide/walkthrough-custom-resources-lambda-lookup-amiids.html" hreflang="de" /><link rel="alternative" href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/walkthrough-custom-resources-lambda-lookup-amiids.html" hreflang="en-us" /><link rel="alternative" href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/walkthrough-custom-resources-lambda-lookup-amiids.html" hreflang="en" /><link rel="alternative" href="https://docs.aws.amazon.com/es_es/AWSCloudFormation/latest/UserGuide/walkthrough-custom-resources-lambda-lookup-amiids.html" hreflang="es-es" /><link rel="alternative" href="https://docs.aws.amazon.com/es_es/AWSCloudFormation/latest/UserGuide/walkthrough-custom-resources-lambda-lookup-amiids.html" hreflang="es" /><link rel="alternative" href="https://docs.aws.amazon.com/fr_fr/AWSCloudFormation/latest/UserGuide/walkthrough-custom-resources-lambda-lookup-amiids.html" hreflang="fr-fr" /><link rel="alternative" href="https://docs.aws.amazon.com/fr_fr/AWSCloudFormation/latest/UserGuide/walkthrough-custom-resources-lambda-lookup-amiids.html" hreflang="fr" /><link rel="alternative" href="https://docs.aws.amazon.com/it_it/AWSCloudFormation/latest/UserGuide/walkthrough-custom-resources-lambda-lookup-amiids.html" hreflang="it-it" /><link rel="alternative" href="https://docs.aws.amazon.com/it_it/AWSCloudFormation/latest/UserGuide/walkthrough-custom-resources-lambda-lookup-amiids.html" hreflang="it" /><link rel="alternative" href="https://docs.aws.amazon.com/ja_jp/AWSCloudFormation/latest/UserGuide/walkthrough-custom-resources-lambda-lookup-amiids.html" hreflang="ja-jp" /><link rel="alternative" href="https://docs.aws.amazon.com/ja_jp/AWSCloudFormation/latest/UserGuide/walkthrough-custom-resources-lambda-lookup-amiids.html" hreflang="ja" /><link rel="alternative" href="https://docs.aws.amazon.com/ko_kr/AWSCloudFormation/latest/UserGuide/walkthrough-custom-resources-lambda-lookup-amiids.html" hreflang="ko-kr" /><link rel="alternative" href="https://docs.aws.amazon.com/ko_kr/AWSCloudFormation/latest/UserGuide/walkthrough-custom-resources-lambda-lookup-amiids.html" hreflang="ko" /><link rel="alternative" href="https://docs.aws.amazon.com/pt_br/AWSCloudFormation/latest/UserGuide/walkthrough-custom-resources-lambda-lookup-amiids.html" hreflang="pt-br" /><link rel="alternative" href="https://docs.aws.amazon.com/pt_br/AWSCloudFormation/latest/UserGuide/walkthrough-custom-resources-lambda-lookup-amiids.html" hreflang="pt" /><link rel="alternative" href="https://docs.aws.amazon.com/zh_cn/AWSCloudFormation/latest/UserGuide/walkthrough-custom-resources-lambda-lookup-amiids.html" hreflang="zh-cn" /><link rel="alternative" href="https://docs.aws.amazon.com/zh_tw/AWSCloudFormation/latest/UserGuide/walkthrough-custom-resources-lambda-lookup-amiids.html" hreflang="zh-tw" /><link rel="alternative" href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/walkthrough-custom-resources-lambda-lookup-amiids.html" hreflang="x-default" /><meta name="feedback-item" content="CloudFormation" /><meta name="this_doc_product" content="AWS CloudFormation" /><meta name="this_doc_guide" content="Leitfaden" /><script defer="" src="/assets/r/vendor4.js?version=2021.12.02"></script><script defer="" src="/assets/r/vendor3.js?version=2021.12.02"></script><script defer="" src="/assets/r/vendor1.js?version=2021.12.02"></script><script defer="" src="/assets/r/awsdocs-common.js?version=2021.12.02"></script><script defer="" src="/assets/r/awsdocs-doc-page.js?version=2021.12.02"></script><link href="/assets/r/vendor4.css?version=2021.12.02" rel="stylesheet" /><link href="/assets/r/awsdocs-common.css?version=2021.12.02" rel="stylesheet" /><link href="/assets/r/awsdocs-doc-page.css?version=2021.12.02" rel="stylesheet" /><script async="" id="awsc-panorama-bundle" type="text/javascript" src="https://prod.pa.cdn.uis.awsstatic.com/panorama-nav-init.js" data-config="{'appEntity':'aws-documentation','region':'us-east-1','service':'cloudformation'}"></script><meta id="panorama-serviceSubSection" value="Leitfaden" /><meta id="panorama-serviceConsolePage" value="Walkthrough: Nachschlagen von Amazon Machine Image-IDs" /></head><body class="awsdocs awsui"><div class="awsdocs-container"><awsdocs-header></awsdocs-header><awsui-app-layout id="app-layout" class="awsui-util-no-gutters" ng-controller="ContentController as $ctrl" header-selector="awsdocs-header" navigation-hide="false" navigation-width="$ctrl.navWidth" navigation-open="$ctrl.navOpen" navigation-change="$ctrl.onNavChange($event)" tools-hide="$ctrl.hideTools" tools-width="$ctrl.toolsWidth" tools-open="$ctrl.toolsOpen" tools-change="$ctrl.onToolsChange($event)"><div id="guide-toc" dom-region="navigation"><awsdocs-toc></awsdocs-toc></div><div id="main-column" dom-region="content" tabindex="-1"><awsdocs-view class="awsdocs-view"><div id="awsdocs-content"><head><title>Walkthrough: Nachschlagen von Amazon Machine Image-IDs - AWS CloudFormation</title><meta name="rss" content="aws-cloudformation-release-notes.rss" /><meta name="forums" content="http://forums.aws.amazon.com/forum.jspa?forumID=92" /><meta name="feedback" content="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=CloudFormation&amp;topic_url=https://docs.aws.amazon.com/de_de/AWSCloudFormation/latest/UserGuide/walkthrough-custom-resources-lambda-lookup-amiids.html" /><meta name="feedback-yes" content="feedbackyes.html?topic_url=https://docs.aws.amazon.com/de_de/AWSCloudFormation/latest/UserGuide/walkthrough-custom-resources-lambda-lookup-amiids.html" /><meta name="feedback-no" content="feedbackno.html?topic_url=https://docs.aws.amazon.com/de_de/AWSCloudFormation/latest/UserGuide/walkthrough-custom-resources-lambda-lookup-amiids.html" /><meta name="keywords" content="CloudFormation,AWSCloudFormation,Ressourcenbereitstellung,Ressourcenkonfiguration,Infrastrukturverwaltung,CloudFormer,CloudFormation -Stack,CloudFormation Stackset,CloudFormation -Vorlage,Änderungssatz" /><script type="application/ld+json">
{
    "@context" : "https://schema.org",
    "@type" : "BreadcrumbList",
    "itemListElement" : [
      {
        "@type" : "ListItem",
        "position" : 1,
        "name" : "AWS",
        "item" : "https://aws.amazon.com"
      },
      {
        "@type" : "ListItem",
        "position" : 2,
        "name" : "AWS CloudFormation",
        "item" : "https://docs.aws.amazon.com/cloudformation/index.html"
      },
      {
        "@type" : "ListItem",
        "position" : 3,
        "name" : "Leitfaden",
        "item" : "https://docs.aws.amazon.com/de_de/AWSCloudFormation/latest/UserGuide"
      },
      {
        "@type" : "ListItem",
        "position" : 4,
        "name" : "Arbeiten mit AWS CloudFormation-Vorlagen",
        "item" : "https://docs.aws.amazon.com/de_de/AWSCloudFormation/latest/UserGuide/template-guide.html"
      },
      {
        "@type" : "ListItem",
        "position" : 5,
        "name" : "Benutzerdefinierte Ressourcen",
        "item" : "https://docs.aws.amazon.com/de_de/AWSCloudFormation/latest/UserGuide/template-custom-resources.html"
      },
      {
        "@type" : "ListItem",
        "position" : 6,
        "name" : "AWS Lambda-gestützte, benutzerdefinierte Ressourcen",
        "item" : "https://docs.aws.amazon.com/de_de/AWSCloudFormation/latest/UserGuide/template-custom-resources-lambda.html"
      },
      {
        "@type" : "ListItem",
        "position" : 7,
        "name" : "Walkthrough: Nachschlagen von Amazon Machine Image-IDs",
        "item" : "https://docs.aws.amazon.com/de_de/AWSCloudFormation/latest/UserGuide/template-custom-resources-lambda.html"
      }
    ]
}
</script></head><body><div id="main"><div style="display: none"></div><div id="breadcrumbs" class="breadcrumb"><a href="https://aws.amazon.com">AWS</a><a href="/index.html">Dokumentation</a><a href="/cloudformation/index.html">AWS CloudFormation</a><a href="Welcome.html">Leitfaden</a></div><div id="page-toc-src"><a href="#walkthrough-custom-resources-lambda-lookup-amiids-savesample">Schritt 1: Herunterladen und Speichern des Beispielpakets in Amazon S3</a><a href="#walkthrough-custom-resources-lambda-lookup-amiids-createfunction-createstack">Schritt 2: Erstellen des Stacks</a><a href="#walkthrough-custom-resources-lambda-lookup-amiids-createfunction-cleanup">Schritt 3: Bereinigen von Ressourcen</a><a href="#w9aac23c26c16b7c29">Ähnliche Informationen</a></div><div id="main-content" class="awsui-util-container"><div id="main-col-body"><awsdocs-language-banner data-service="$ctrl.pageService"></awsdocs-language-banner><awsui-alert class="awsdocs-page-banner awsui-util-mb-l"><p>Die vorliegende Übersetzung wurde maschinell erstellt. Im Falle eines Konflikts oder eines Widerspruchs zwischen dieser übersetzten Fassung und der englischen Fassung (einschließlich infolge von Verzögerungen bei der Übersetzung) ist die englische Fassung maßgeblich.</p></awsui-alert><h1 class="topictitle" id="walkthrough-custom-resources-lambda-lookup-amiids">Walkthrough: Nachschlagen von Amazon Machine Image-IDs</h1><div class="awsdocs-page-header-container"><awsdocs-page-header></awsdocs-page-header><awsdocs-filter-selector id="awsdocs-filter-selector"></awsdocs-filter-selector></div><p>AWS CloudFormation-Vorlagen, die eine Amazon Elastic Compute Cloud (Amazon EC2)-Instance deklarieren, müssen außerdem eine Amazon Machine Image (AMI)-ID angeben, die ein Betriebssystem und andere Software- und Konfigurationsinformationen enthält, die zum Launchen der Instance verwendet werden. Die korrekte AMI-ID ist vom Instance-Typ und dem Bereich abhängig, in dem Sie den Stack starten. IDs können sich außerdem regelmäßig ändern, z. B. wenn ein AMI mit Softwareupdates aktualisiert wird.</p><p>Normalerweise werden AMI-IDs bestimmten Instance-Typen und Bereichen zugeordnet. Um die IDs zu aktualisieren, ändern Sie sie manuell in den einzelnen Vorlagen. Durch Verwendung von benutzerdefinierten Ressourcen und AWS Lambda (Lambda) können Sie eine Funktion erstellen, die die IDs der neuesten AMIs für den Bereich und den verwendeten Instance-Typ abruft, damit Sie nicht Zuweisungen verwalten müssen.</p><p>In dieser Anleitung erfahren Sie, wie Sie eine benutzerdefinierte Ressource erstellen und eine Lambda-Funktion damit verknüpfen, um AMI-IDs nachzuschlagen. Beachten Sie, dass in der Anleitung davon ausgegangen wird, dass Sie mit der Verwendung von benutzerdefinierten Ressourcen und Lambda vertraut sind. Weitere Informationen zu <a href="./template-custom-resources.html">Benutzerdefinierte Ressourcen</a> finden Sie im <a href="https://docs.aws.amazon.com/lambda/latest/dg/">Entwicklerhandbuch für AWS Lambda</a>.</p><p>Walkthrough-Übersicht</p><p>In dieser Anleitung erstellen Sie einen Stack mit einer benutzerdefinierten Ressource, eine Lambda-Funktion und eine EC2-Instance. Die schrittweise Anleitung enthält Beispielcode und eine Beispielvorlage, mit denen Sie den Stack erstellen können.</p><p>Die Beispielvorlage verwendet den benutzerdefinierten Ressourcentyp, um Eingabewerte aufzurufen und an die Lambda-Funktion zu senden. Wenn Sie die Vorlage verwenden, ruft AWS CloudFormation die Funktion auf und sendet Information an sie, z. B. den Anforderungstyp, Eingabedaten sowie eine vorsignierte Amazon Simple Storage Service (Amazon S3)-URL. Die Funktion verwendet diese Informationen, um die AMI-ID nachzuschlagen, und sendet eine Antwort an die vorsignierte URL.</p><p>Nachdem AWS CloudFormation eine Antwort am Speicherort der vorsignierten URL abruft, wird das Erstellen des Stacks fortgesetzt. Wenn AWS CloudFormation die Instance erstellt, wird die Antwort der Lambda-Funktion verwendet, um die AMI-ID der Instance anzugeben.</p><p>Der Prozess ist in der folgenden Liste zusammengefasst. Sie benötigen AWS Identity and Access Management (IAM)-Berechtigungen, um alle entsprechenden Services, z. B. Lambda, Amazon EC2 und AWS CloudFormation zu verwenden.</p><div class="awsdocs-note"><div class="awsdocs-note-title"><awsui-icon name="status-info" variant="link"></awsui-icon><h6>Anmerkung</h6></div><div class="awsdocs-note-text"><p>AWS CloudFormation ist ein kostenloser Service; es entstehen jedoch Kosten für die AWS-Ressourcen, z. B. die Lambda-Funktion und die EC2-Instance, die Sie in Ihre Stacks einschließen, zu den jeweiligen aktuellen Gebühren. Weitere Informationen über AWS-Preise finden Sie auf der Detailseite für jedes Produkt unter <a href="https://aws.amazon.com/" rel="noopener noreferrer" target="_blank"><span>http://aws.amazon.com</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a>.</p></div></div><div class="orderedlist">
     
     
     
  <ol><li>
      <p><a href="#walkthrough-custom-resources-lambda-lookup-amiids-savesample">Speichern Sie das Beispiel-Lambda-Paket in einem Amazon Simple Storage Service (Amazon S3)-Bucket.</a></p>
      <p>Das Beispielpaket enthalten alles, was zum Erstellen der Lambda-Funktion erforderlich ist. Sie müssen das Paket in einem Bucket speichern, der sich in demselben Bereich befindet, in dem Sie den Stack erstellen.</p>
    </li><li>
      <p><a href="#walkthrough-custom-resources-lambda-lookup-amiids-createfunction-createstack">Verwenden Sie die Beispielvorlage zum Erstellen eines Stacks.</a></p>
      <p>Der Stack veranschaulicht, wie Sie die Lambda-Funktion mit einer benutzerdefinierten Ressource verknüpfen und wie Sie die Ergebnisse aus der Funktion zum Angeben einer AMI-ID verwenden. Der Stack erstellt auch eine IAM-Rolle (Ausführungsrolle), die Lambda verwendet, um Amazon EC2-Aufrufe vorzunehmen.</p>
    </li><li>
      <p><a href="#walkthrough-custom-resources-lambda-lookup-amiids-createfunction-cleanup">Löschen Sie den Stack.</a></p>
      <p>Löschen Sie den Stack, um alle Stack-Ressourcen zu bereinigen, die Sie erstellt haben, damit Ihnen keine unnötigen Ressourcen in Rechnung gestellt werden.</p>
    </li></ol></div><h2 id="walkthrough-custom-resources-lambda-lookup-amiids-savesample">Schritt 1: Herunterladen und Speichern des Beispielpakets in Amazon S3</h2>
    
    <p>Wenn Sie einen Stack mit einer Lambda-Funktion erstellen, müssen Sie den Speicherort des Amazon S3-Buckets angeben, der den Quellcode der Funktion enthält. Der Bucket muss sich in derselben Region befinden, in der Sie später den Stack erstellen.</p>
    <p>Diese Anleitung enthält ein Beispielpaket (eine <code>.zip</code>-Datei), das zum Erstellen der Lambda-Funktion erforderlich ist. Ein Lambda-Paket enthält den Quellcode für die Funktion sowie die erforderlichen Bibliotheken. In dieser Anleitung sind für die Funktion keine zusätzlichen Bibliotheken erforderlich.</p>
    <p>Die Funktion verwendet die Architektur und Region einer Instance als Eingaben von einer AWS CloudFormation-Anforderung für eine benutzerdefinierte Ressource und gibt die neueste AMI-ID an eine vorsignierten Amazon-S3-URL zurück.</p>
    <div class="procedure"><h6>So laden Sie das Paket herunter und speichern es in Amazon S3</h6><ol><li>
        <p>Laden Sie das Beispielpaket von Amazon S3 herunter. Wenn Sie die Datei speichern, verwenden Sie den gleichen Dateinamen wie im Beispiel: <code>amilookup.zip</code> oder <code>amilookup-win.zip</code>.</p>
        <div class="variablelist">
           
           
        <dl>
            <dt><b><span class="term">Suchen nach Linux-AMI-IDs</span></b></dt>
            <dd>
              <p><a href="https://s3.amazonaws.com/cloudformation-examples/lambda/amilookup.zip" rel="noopener noreferrer" target="_blank"><span>https://s3.amazonaws.com/cloudformation-examples/lambda/amilookup.zip</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a></p>
            </dd>
          
            <dt><b><span class="term">Suchen nach Windows-AMI-IDs</span></b></dt>
            <dd>
              <p><a href="https://s3.amazonaws.com/cloudformation-examples/lambda/amilookup-win.zip" rel="noopener noreferrer" target="_blank"><span>https://s3.amazonaws.com/cloudformation-examples/lambda/amilookup-win.zip</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a></p>
            </dd>
          </dl></div>
      </li><li>
        <p>Öffnen Sie die Amazon S3-Konsole unter <a href="https://console.aws.amazon.com/s3/home" rel="noopener noreferrer" target="_blank"><span>https://console.aws.amazon.com/s3/home</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a>.</p>
      </li><li>
        <p>Wählen Sie einen Bucket aus, oder erstellen Sie einen, der sich in derselben Region befindet, in der Sie den AWS CloudFormation-Stack erstellen. Notieren Sie den Bucket-Namen.</p>
        <p>Das Beispielpaket wird in diesem Bucket gespeichert. Weitere Informationen zum Erstellen eines Buckets finden Sie unter <a href="https://docs.aws.amazon.com/AmazonS3/latest/user-guide/CreatingaBucket.html">Erstellen von Buckets</a> im <em>Benutzerhandbuch für Amazon Simple Storage Service</em>.</p>
      </li><li>
        <p>Laden Sie das Beispielpaket in den Bucket hoch, den Sie ausgewählt oder erstellt haben.</p>
        <p>Weitere Informationen zum Hochladen von Objekten finden Sie unter <a href="https://docs.aws.amazon.com/AmazonS3/latest/user-guide/UploadingObjectsintoAmazonS3.html">Hochladen von Objekten</a> im <em>Benutzerhandbuch für Amazon Simple Storage Service</em>.</p>
      </li></ol></div>
    <p>Mit dem Paket in Amazon S3 können Sie nun den Speicherort in der Lambda-Ressourcen-Deklaration der AWS CloudFormation-Vorlage angeben. Im nächsten Schritt wird veranschaulicht, wie Sie die Funktion deklarieren und sie mithilfe einer benutzerdefinierten Ressource aufrufen. Sie erfahren auch, wie die Ergebnisse der Funktion verwendet werden, um die AMI-ID einer EC2-Instance anzugeben.</p>
   
   <h2 id="walkthrough-custom-resources-lambda-lookup-amiids-createfunction-createstack">Schritt 2: Erstellen des Stacks</h2>
    
    <p>Zum Erstellen des Beispiel-Amazon EC2-Stacks verwenden Sie eine Beispielvorlage, die eine Lambda-Funktion, eine IAM-Ausführungsrolle, eine benutzerdefinierte Ressource, die die Funktion aufruft, und eine EC2-Instance umfasst, die die Ergebnisse der Funktion verwendet.</p>
    <p>Während der Stack-Erstellung ruft die benutzerdefinierte Ressource die Lambda-Funktion auf und wartet, bis die Funktion eine Antwort an die vorsignierte Amazon S3-URL sendet. In der Antwort gibt die Funktion die ID des neuesten AMI zurück, das dem EC2-Instance-Typ und der Region entspricht, in der Sie die Instance erstellen. Die Daten aus der Antwort der Funktion werden als Attribut der benutzerdefinierten Ressource gespeichert, die zum Angeben der AMI-ID der EC2-Instance verwendet wird.</p>
    <p>In den folgenden Codeausschnitten werden relevante Teile der Beispielvorlage erläutert, anhand der Sie sehen können, wie eine Lambda-Funktion mit einer benutzerdefinierten Ressource verknüpft und wie die Antwort der Funktion verwendet wird.</p>
    <p>Sehen Sie sich folgendes an, um die gesamte Beispielvorlage anzuzeigen:</p>
    <div class="variablelist">
       
       
    <dl>
        <dt><b><span class="term">Linux-Vorlage</span></b></dt>
        <dd>
          <p><a href="https://s3.amazonaws.com/cloudformation-examples/lambda/LambdaAMILookupSample.template" rel="noopener noreferrer" target="_blank"><span>https://s3.amazonaws.com/cloudformation-examples/lambda/LambdaAMILookupSample.template</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a></p>
        </dd>
      
        <dt><b><span class="term">Windows-Vorlage</span></b></dt>
        <dd>
          <p><a href="https://s3.amazonaws.com/cloudformation-examples/lambda/LambdaAMILookupSample-win.template" rel="noopener noreferrer" target="_blank"><span>https://s3.amazonaws.com/cloudformation-examples/lambda/LambdaAMILookupSample-win.template</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a></p>
        </dd>
      </dl></div>
    <p>Codeausschnitte von Stack-Vorlagen</p>
    <p>Zum Erstellen der Lambda-Funktion deklarieren Sie die <code class="code">AWS::Lambda::Function</code>-Ressource, für die der Quellcode der Funktion, der Handler-Name, die Laufzeitumgebung sowie der ARN der Ausführungsrolle erforderlich ist.</p>
    <div class="example"><h6>Beispiel JSON-Syntax</h6><div class="example-contents"><pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Kopieren"><awsui-icon name="copy"></awsui-icon></div></div><code class="json ">"AMIInfoFunction": <span>{</span>
  "Type": "AWS::Lambda::Function",
  "Properties": <span>{</span>
    "Code": <span>{</span>
      "S3Bucket": <span>{</span> "Ref": "S3Bucket" },
      "S3Key": <span>{</span> "Ref": "S3Key" }
    },
    "Handler": <span>{</span> "Fn::Join" : [ "", [<span>{</span> "Ref": "ModuleName" },".handler"] ] },
    "Runtime": "nodejs18.x",
    "Timeout": "30",
    "Role": <span>{</span> "Fn::GetAtt" : ["LambdaExecutionRole", "Arn"] }
  }
}</code></pre></div></div>
    <div class="example"><h6>Beispiel YAML-Syntax</h6><div class="example-contents"><pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Kopieren"><awsui-icon name="copy"></awsui-icon></div></div><code class="yaml ">AMIInfoFunction:
  Type: AWS::Lambda::Function
  Properties:
    Code:
      S3Bucket: !Ref S3Bucket
      S3Key: !Ref S3Key
    Handler: !Sub "$<span>{</span>ModuleName}.handler"
    Runtime: nodejs18.x
    Timeout: 30
    Role: !GetAtt LambdaExecutionRole.Arn</code></pre></div></div>
    <p>Die <code class="code">Code</code>-Eigenschaft gibt den Amazon S3-Speicherort (Bucket-Name und Dateiname) an, an den Sie das Beispielpaket hochgeladen haben. Die Beispielvorlage verwendet Eingabeparameter (<code class="code">"Ref":
        "S3Bucket"</code> und <code class="code">"Ref": "S3Key"</code>), um den Bucket- und Dateinamen anzugeben, damit Sie die Namen beim Erstellen des Stacks angeben können. Ebenso verwendet der Handler-Name, der dem Namen der Quelldatei (der  JavaScript Datei) im <code>.zip</code> Paket entspricht, auch einen Eingabeparameter (<code class="code">"Ref":         "ModuleName"</code>). Da es sich bei der Quelldatei um  JavaScript Code handelt, wird die Laufzeit als angegeben<code class="code">nodejs18.x</code>.</p>
    <p>In dieser Anleitung überschreitet die Ausführungszeit der Funktion den Standardwert von <code class="code">3</code> Sekunden, die Zeitüberschreitung wird daher auf <code class="code">30</code> Sekunden festgelegt. Wenn Sie keine ausreichend lange Zeitüberschreitung angeben, verursacht Lambda möglicherweise eine Zeitüberschreitung, bevor die Funktion abgeschlossen werden kann, sodass die Stack-Erstellung fehlschlägt.</p>
    <p>Die Ausführungsrolle, die an einer anderen Stelle in der Vorlage deklariert wird, wird mithilfe der intrinsischen <code class="code">Fn::GetAtt</code>-Funktion in der <code class="code">Role</code>-Eigenschaft angegeben. Die Ausführungsrolle gewährt der Lambda-Funktion die Berechtigung zum Senden von Protokollen an AWS und zum Aufrufen der EC2-<code class="code">DescribeImages</code>-API. Im folgenden Codeausschnitt sind die Rolle und die Richtlinie dargestellt, die die entsprechende Berechtigung gewähren:</p>
    <div class="example"><h6>Beispiel JSON-Syntax</h6><div class="example-contents"><pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Kopieren"><awsui-icon name="copy"></awsui-icon></div></div><code class="json ">"LambdaExecutionRole": <span>{</span>
  "Type": "AWS::IAM::Role",
  "Properties": <span>{</span>
    "AssumeRolePolicyDocument": <span>{</span>
      "Version": "2012-10-17",
      "Statement": [<span>{</span>
        "Effect": "Allow",
        "Principal": <span>{</span>"Service": ["lambda.amazonaws.com"]},
        "Action": ["sts:AssumeRole"]
      }]
    },
    "Path": "/",
    "Policies": [<span>{</span>
      "PolicyName": "root",
      "PolicyDocument": <span>{</span>
        "Version": "2012-10-17",
        "Statement": [<span>{</span>
          "Effect": "Allow",
          "Action": ["logs:CreateLogGroup","logs:CreateLogStream","logs:PutLogEvents"],
          "Resource": "arn:aws:logs:*:*:*"
        },
        <span>{</span>
          "Effect": "Allow",
          "Action": ["ec2:DescribeImages"],
          "Resource": "*"
        }]
      }
    }]
  }
}</code></pre></div></div>
    <div class="example"><h6>Beispiel YAML-Syntax</h6><div class="example-contents"><pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Kopieren"><awsui-icon name="copy"></awsui-icon></div></div><code class="yaml ">LambdaExecutionRole:
  Type: AWS::IAM::Role
  Properties:
    AssumeRolePolicyDocument:
      Version: '2012-10-17'
      Statement:
      - Effect: Allow
        Principal:
          Service:
          - lambda.amazonaws.com
        Action:
        - sts:AssumeRole
    Path: "/"
    Policies:
    - PolicyName: root
      PolicyDocument:
        Version: '2012-10-17'
        Statement:
        - Effect: Allow
          Action:
          - logs:CreateLogGroup
          - logs:CreateLogStream
          - logs:PutLogEvents
          Resource: arn:aws:logs:*:*:*
        - Effect: Allow
          Action:
          - ec2:DescribeImages
          Resource: "*"</code></pre></div></div>
    <p>Sowohl für die Linux- als auch für die Windows-Vorlage ruft die benutzerdefinierte Ressource die damit verknüpfte Lambda-Funktion auf. Um eine Funktion einer benutzerdefinierten Ressource zuzuordnen, geben Sie den Amazon-Ressourcennamen (ARN) der Funktion für die <code class="code">ServiceToken</code>-Eigenschaft mit der intrinsischen <code class="code">Fn::GetAtt</code>-Funktion an. AWS CloudFormation sendet die zusätzlichen Eigenschaften, die in der benutzerdefinierten Ressourcen-Deklaration enthalten sind, wie <code class="code">Region</code> und <code class="code">Architecture</code>, an die Lambda-Funktion als Eingaben. Die Lambda-Funktion bestimmt die korrekten Namen und Werte für diese Eingabeeigenschaften.</p>
    <div class="example"><h6>Beispiel JSON-Syntax</h6><div class="example-contents"><pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Kopieren"><awsui-icon name="copy"></awsui-icon></div></div><code class="json ">"AMIInfo": <span>{</span>
  "Type": "Custom::AMIInfo",
  "Properties": <span>{</span>
    "ServiceToken": <span>{</span> "Fn::GetAtt" : ["AMIInfoFunction", "Arn"] },
    "Region": <span>{</span> "Ref": "AWS::Region" },
    "Architecture": <span>{</span> "Fn::FindInMap" : [ "AWSInstanceType2Arch", <span>{</span> "Ref" : "InstanceType" }, "Arch" ] }
  }
}</code></pre></div></div>
    <div class="example"><h6>Beispiel YAML-Syntax</h6><div class="example-contents"><pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Kopieren"><awsui-icon name="copy"></awsui-icon></div></div><code class="yaml ">AMIInfo:
  Type: Custom::AMIInfo
  Properties:
    ServiceToken: !GetAtt AMIInfoFunction.Arn
    Region: !Ref "AWS::Region"
    Architecture:
      Fn::FindInMap:
      - AWSInstanceType2Arch
      - !Ref InstanceType
      - Arch</code></pre></div></div>
    <p>Bei Windows stellt die benutzerdefinierte Ressource der Lambda-Funktion die Windows-Version anstelle der Architektur der Instance bereit.</p>
    <div class="example"><h6>Beispiel JSON-Syntax</h6><div class="example-contents"><pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Kopieren"><awsui-icon name="copy"></awsui-icon></div></div><code class="json ">"AMIInfo": <span>{</span>
  "Type": "Custom::AMIInfo",
  "Properties": <span>{</span>
    "ServiceToken": <span>{</span> "Fn::GetAtt" : ["AMIInfoFunction", "Arn"] },
    "Region": <span>{</span> "Ref": "AWS::Region" },
    "OSName": <span>{</span> "Ref": "WindowsVersion" }
  }
}</code></pre></div></div>
    <div class="example"><h6>Beispiel YAML-Syntax</h6><div class="example-contents"><pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Kopieren"><awsui-icon name="copy"></awsui-icon></div></div><code class="yaml ">AMIInfo:
  Type: Custom::AMIInfo
  Properties:
    ServiceToken: !GetAtt AMIInfoFunction.Arn
    Region: !Ref "AWS::Region"
    OSName: !Ref "WindowsVersion"</code></pre></div></div>
    <p>Wenn AWS CloudFormation die Lambda-Funktion aufruft, ruft die Funktion die EC2-<code class="code">DescribeImages</code>-API mithilfe der Bereichs- und Instance-Architektur oder des Betriebssystem-Namens zum Filtern der Liste von Images auf. Die Funktion sortiert dann die Liste von Images nach Datum und gibt die ID des aktuellen AMI zurück.</p>
    <p>Beim Zurückgeben der ID des aktuellen AMI sendet die Funktion die ID an eine vorsignierte URL in der <code class="code">Data</code>-Eigenschaft des <a href="./crpg-ref-responses.html">Antwortobjekts</a>. Die Daten sind als Name-Wert-Paar strukturiert, wie im folgenden Beispiel dargestellt:</p>
    <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Kopieren"><awsui-icon name="copy"></awsui-icon></div></div><code class="json ">"Data": <span>{</span> 
  "Id": "ami-43795473"
}</code></pre>
    <p>Der folgende Codeausschnitt zeigt, wie die Daten von der Lambda-Funktion abgerufen werden. Sie verwendet die intrinsische <code class="code">Fn::GetAtt</code>-Funktion, die den Namen der benutzerdefinierten Ressource und den Attributnamen des Werts bereitstellen, den Sie abrufen möchten. In dieser Anleitung lautet der benutzerdefinierte Ressourcenname <code class="code">AMIInfo</code> und der Attributname <code class="code">Id</code>.</p>
    <div class="example"><h6>Beispiel JSON-Syntax</h6><div class="example-contents"><pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Kopieren"><awsui-icon name="copy"></awsui-icon></div></div><code class="json ">"SampleInstance": <span>{</span>  
  "Type": "AWS::EC2::Instance",
  "Properties": <span>{</span>
    "InstanceType"   : <span>{</span> "Ref" : "InstanceType" },
    "ImageId": <span>{</span> "Fn::GetAtt": [ "AMIInfo", "Id" ] }
  }
}</code></pre></div></div>
    <div class="example"><h6>Beispiel YAML-Syntax</h6><div class="example-contents"><pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Kopieren"><awsui-icon name="copy"></awsui-icon></div></div><code class="yaml ">SampleInstance:
  Type: AWS::EC2::Instance
  Properties:
    InstanceType: !Ref InstanceType
    ImageId: !GetAtt AMIInfo.Id</code></pre></div></div>
    <p>Da Sie sich nun einen Überblick über die Vorlage verschafft haben, verwenden Sie die Beispielvorlage, um einen Stack zu erstellen.</p>
    <div class="procedure"><h6>So erstellen Sie den Stack</h6><ol><li>
        <p>Öffnen Sie die -AWS CloudFormationKonsole unter <a href="https://console.aws.amazon.com/cloudformation/" rel="noopener noreferrer" target="_blank"><span>https://console.aws.amazon.com/cloudformation/</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a>.</p>
      </li><li>
        <p>Wählen Sie <b>Stapel erstellen</b> aus.</p>
      </li><li>
        <p>Wählen Sie im Abschnitt <b>Template</b> die Option <b>Specify an Amazon S3 template URL</b> aus und kopieren Sie dann die folgende URL, und fügen Sie sie in das Textfeld ein:</p>
        <div class="variablelist">
           
           
        <dl>
            <dt><b><span class="term">Linux-Vorlage</span></b></dt>
            <dd>
              <p><code class="code"><a href="https://s3.amazonaws.com/cloudformation-examples/lambda/LambdaAMILookupSample.template" rel="noopener noreferrer" target="_blank"><span>https://s3.amazonaws.com/cloudformation-examples/lambda/LambdaAMILookupSample.template</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a></code></p>
            </dd>
          
            <dt><b><span class="term">Windows-Vorlage</span></b></dt>
            <dd>
              <p><code class="code"><a href="https://s3.amazonaws.com/cloudformation-examples/lambda/LambdaAMILookupSample-win.template" rel="noopener noreferrer" target="_blank"><span>https://s3.amazonaws.com/cloudformation-examples/lambda/LambdaAMILookupSample-win.template</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a></code></p>
            </dd>
          </dl></div>
      </li><li>
        <p>Wählen Sie <b>Weiter</b> aus.</p>
      </li><li>
        <p>Geben Sie im Namensfeld <b>Stack</b> <code class="userinput">SampleEC2Instance</code> ein.</p>
      </li><li>
        <p>Geben Sie im Abschnitt <b>Parameters</b> den Namen des Amazon-S3-Buckets an, den Sie erstellt haben, und wählen Sie dann <b>Next</b> aus.</p>
        <p>Die Standardwerte für die anderen Parameter sind die gleichen Namen, die im Beispiel-<code>.zip</code>-Paket verwendet werden.</p>
      </li><li>
        <p>Für diese Anleitung müssen Sie keine Tags hinzufügen oder erweiterte Einstellungen angeben, wählen Sie daher <b>Weiter</b> aus.</p>
      </li><li>
        <p>Stellen Sie sicher, dass der Stack-Name und die Vorlagen-URL richtig sind, und wählen Sie <b>Create</b>.</p>
      </li></ol></div>
    <p>Möglicherweise dauert es ein paar Minuten, bis AWS CloudFormation den Stack erstellt. Betrachten Sie die Stack-Ereignisse, um den Fortschritt zu überwachen. Weitere Informationen finden Sie unter <a href="./cfn-console-view-stack-data-resources.html">Anzeigen von AWS CloudFormation Stack-Daten und -Ressourcen auf der AWS Management Console</a>.</p>
    <p>Wenn die Stack-Erstellung erfolgreich ist, wurden alle Ressourcen in dem Stack, z. B. die Lambda-Funktion, die benutzerdefinierte Ressource und die EC2-Instance, erstellt. Sie haben eine Lambda-Funktion und eine benutzerdefinierte Ressource erfolgreich verwendet, um die AMI-ID einer EC2-Instance anzugeben. In dieser Vorlage müssen Sie keine Zuordnung von AMI-ID erstellen und verwalten.</p>
    <p>Um zu sehen, welche AMI-ID von AWS CloudFormation zum Erstellen der EC2-Instance verwendet wurde, zeigen Sie die Stack-Ausgaben an.</p>
   <p>Wenn die Lambda-Funktion einen Fehler zurückgibt, zeigen Sie die Protokolle der Funktion in der Amazon- CloudWatch Logs<a href="https://console.aws.amazon.com/cloudwatch/home#logs:" rel="noopener noreferrer" target="_blank"><span>-Konsole</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a> an. Der Name des Protokollstreams ist die physische ID der benutzerdefinierten Ressource, die Sie durch Anzeigen der Ressourcen des Stacks finden können. Weitere Informationen finden Sie unter <a href="https://docs.aws.amazon.com/AmazonCloudWatch/latest/logs/Working-with-log-groups-and-streams.html#ViewingLogData">Anzeigen von Protokolldaten</a> im <em>Amazon- CloudWatch Benutzerhandbuch</em>.</p>
   
   <h2 id="walkthrough-custom-resources-lambda-lookup-amiids-createfunction-cleanup">Schritt 3: Bereinigen von Ressourcen</h2>
    
    <p>Um sicherzustellen, dass Ihnen keine unerwünschten Services berechnet werden, löschen Sie den Stack.</p>
    <div class="procedure"><h6>So löschen Sie den Stack</h6><ol><li>
        <p>Wählen Sie auf der AWS CloudFormation-Konsole den Stack <b>SampleEC2Instance</b>.</p>
      </li><li>
        <p>Wählen Sie die Option <b>Actions</b> und anschließend <b>Delete Stack</b> aus.</p>
      </li><li>
        <p>Wählen Sie im Bestätigungsdialogfeld <b>Yes, Delete</b> aus.</p>
      </li></ol></div>
    <p>Alle erstellten Ressourcen werden gelöscht.</p>
    <p>Da Sie nun wissen, wie Sie die Lambda-Funktionen mit AWS CloudFormation erstellen und verwenden, können Sie die Beispielvorlage und den Code aus dieser Anleitung verwenden, um weitere Stacks und Funktionen zu erstellen.</p>
  <h2 id="w9aac23c26c16b7c29">Ähnliche Informationen</h2>
    
    <div class="itemizedlist">
       
    <ul class="itemizedlist"><li class="listitem">
        <p><a href="./crpg-ref.html">AWS CloudFormation Referenz für benutzerdefinierte Ressourcen</a></p>
      </li></ul></div>
  <awsdocs-copyright class="copyright-print"></awsdocs-copyright><awsdocs-thumb-feedback right-edge="{{$ctrl.thumbFeedbackRightEdge}}"></awsdocs-thumb-feedback></div><noscript><div><div><div><div id="js_error_message"><p><img src="https://d1ge0kk1l5kms0.cloudfront.net/images/G/01/webservices/console/warning.png" alt="Warnung" /> <strong>JavaScript ist in Ihrem Browser nicht verfügbar oder deaktiviert.</strong></p><p>Zur Nutzung der AWS-Dokumentation muss JavaScript aktiviert sein. Weitere Informationen finden auf den Hilfe-Seiten Ihres Browsers.</p></div></div></div></div></noscript><div id="main-col-footer" class="awsui-util-font-size-0"><div id="doc-conventions"><a target="_top" href="/general/latest/gr/docconventions.html">Dokumentkonventionen</a></div><div class="prev-next"><div id="previous" class="prev-link" accesskey="p" href="./template-custom-resources-lambda.html">AWS Lambda-gestützte, benutzerdefinierte Ressourcen</div><div id="next" class="next-link" accesskey="n" href="./cfn-lambda-function-code-cfnresponsemodule.html">cfn-response-Modul</div></div></div><awsdocs-page-utilities></awsdocs-page-utilities></div><div id="quick-feedback-yes" style="display: none;"><div class="title">Hat Ihnen diese Seite geholfen? – Ja</div><div class="content"><p>Vielen Dank, dass Sie uns mitgeteilt haben, dass wir gute Arbeit geleistet haben!</p><p>Würden Sie sich einen Moment Zeit nehmen, um uns mitzuteilen, was wir richtig gemacht haben, damit wir noch besser werden?</p><p><awsui-button id="fblink" rel="noopener noreferrer" target="_blank" text="Feedback" click="linkClick($event)" href="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=CloudFormation&amp;topic_url=https://docs.aws.amazon.com/de_de/AWSCloudFormation/latest/UserGuide/walkthrough-custom-resources-lambda-lookup-amiids.html"></awsui-button></p></div></div><div id="quick-feedback-no" style="display: none;"><div class="title">Hat Ihnen diese Seite geholfen? – Nein</div><div class="content"><p>Vielen Dank, dass Sie uns mitgeteilt haben, dass diese Seite überarbeitet werden muss. Es tut uns Leid, dass wir Ihnen nicht weiterhelfen konnten.</p><p>Würden Sie sich einen Moment Zeit nehmen, um uns mitzuteilen, wie wir die Dokumentation verbessern können?</p><p><awsui-button id="fblink" rel="noopener noreferrer" target="_blank" text="Feedback" click="linkClick($event)" href="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=CloudFormation&amp;topic_url=https://docs.aws.amazon.com/de_de/AWSCloudFormation/latest/UserGuide/walkthrough-custom-resources-lambda-lookup-amiids.html"></awsui-button></p></div></div></div></body></div></awsdocs-view><div class="page-loading-indicator" id="page-loading-indicator"><awsui-spinner size="large"></awsui-spinner></div></div><div id="tools-panel" dom-region="tools"><awsdocs-tools-panel id="awsdocs-tools-panel"></awsdocs-tools-panel></div></awsui-app-layout><awsdocs-cookie-banner class="doc-cookie-banner"></awsdocs-cookie-banner></div></body></html>