<!DOCTYPE html>
    <html xmlns="http://www.w3.org/1999/xhtml" lang="en-US"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>AWS::ECS::ClusterCapacityProviderAssociations - AWS CloudFormation</title><meta name="viewport" content="width=device-width,initial-scale=1" /><meta name="assets_root" content="/assets" /><meta name="target_state" content="aws-resource-ecs-clustercapacityproviderassociations" /><meta name="default_state" content="aws-resource-ecs-clustercapacityproviderassociations" /><link rel="icon" type="image/ico" href="/assets/images/favicon.ico" /><link rel="shortcut icon" type="image/ico" href="/assets/images/favicon.ico" /><link rel="canonical" href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-resource-ecs-clustercapacityproviderassociations.html" /><meta name="description" content="Use the AWS CloudFormation AWS::ECS::ClusterCapacityProviderAssociations resource for ECS." /><meta name="deployment_region" content="IAD" /><meta name="product" content="AWS CloudFormation" /><meta name="guide" content="User Guide" /><meta name="abstract" content="Create and manage AWS infrastructure deployments predictably and repeatedly using AWS CloudFormation with this User Guide." /><meta name="guide-locale" content="en_us" /><meta name="tocs" content="toc-contents.json;toc-AWS_ECS.json" /><link rel="canonical" href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-resource-ecs-clustercapacityproviderassociations.html" /><link rel="alternative" href="https://docs.aws.amazon.com/id_id/AWSCloudFormation/latest/UserGuide/aws-resource-ecs-clustercapacityproviderassociations.html" hreflang="id-id" /><link rel="alternative" href="https://docs.aws.amazon.com/id_id/AWSCloudFormation/latest/UserGuide/aws-resource-ecs-clustercapacityproviderassociations.html" hreflang="id" /><link rel="alternative" href="https://docs.aws.amazon.com/de_de/AWSCloudFormation/latest/UserGuide/aws-resource-ecs-clustercapacityproviderassociations.html" hreflang="de-de" /><link rel="alternative" href="https://docs.aws.amazon.com/de_de/AWSCloudFormation/latest/UserGuide/aws-resource-ecs-clustercapacityproviderassociations.html" hreflang="de" /><link rel="alternative" href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-resource-ecs-clustercapacityproviderassociations.html" hreflang="en-us" /><link rel="alternative" href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-resource-ecs-clustercapacityproviderassociations.html" hreflang="en" /><link rel="alternative" href="https://docs.aws.amazon.com/es_es/AWSCloudFormation/latest/UserGuide/aws-resource-ecs-clustercapacityproviderassociations.html" hreflang="es-es" /><link rel="alternative" href="https://docs.aws.amazon.com/es_es/AWSCloudFormation/latest/UserGuide/aws-resource-ecs-clustercapacityproviderassociations.html" hreflang="es" /><link rel="alternative" href="https://docs.aws.amazon.com/fr_fr/AWSCloudFormation/latest/UserGuide/aws-resource-ecs-clustercapacityproviderassociations.html" hreflang="fr-fr" /><link rel="alternative" href="https://docs.aws.amazon.com/fr_fr/AWSCloudFormation/latest/UserGuide/aws-resource-ecs-clustercapacityproviderassociations.html" hreflang="fr" /><link rel="alternative" href="https://docs.aws.amazon.com/it_it/AWSCloudFormation/latest/UserGuide/aws-resource-ecs-clustercapacityproviderassociations.html" hreflang="it-it" /><link rel="alternative" href="https://docs.aws.amazon.com/it_it/AWSCloudFormation/latest/UserGuide/aws-resource-ecs-clustercapacityproviderassociations.html" hreflang="it" /><link rel="alternative" href="https://docs.aws.amazon.com/ja_jp/AWSCloudFormation/latest/UserGuide/aws-resource-ecs-clustercapacityproviderassociations.html" hreflang="ja-jp" /><link rel="alternative" href="https://docs.aws.amazon.com/ja_jp/AWSCloudFormation/latest/UserGuide/aws-resource-ecs-clustercapacityproviderassociations.html" hreflang="ja" /><link rel="alternative" href="https://docs.aws.amazon.com/ko_kr/AWSCloudFormation/latest/UserGuide/aws-resource-ecs-clustercapacityproviderassociations.html" hreflang="ko-kr" /><link rel="alternative" href="https://docs.aws.amazon.com/ko_kr/AWSCloudFormation/latest/UserGuide/aws-resource-ecs-clustercapacityproviderassociations.html" hreflang="ko" /><link rel="alternative" href="https://docs.aws.amazon.com/pt_br/AWSCloudFormation/latest/UserGuide/aws-resource-ecs-clustercapacityproviderassociations.html" hreflang="pt-br" /><link rel="alternative" href="https://docs.aws.amazon.com/pt_br/AWSCloudFormation/latest/UserGuide/aws-resource-ecs-clustercapacityproviderassociations.html" hreflang="pt" /><link rel="alternative" href="https://docs.aws.amazon.com/zh_cn/AWSCloudFormation/latest/UserGuide/aws-resource-ecs-clustercapacityproviderassociations.html" hreflang="zh-cn" /><link rel="alternative" href="https://docs.aws.amazon.com/zh_tw/AWSCloudFormation/latest/UserGuide/aws-resource-ecs-clustercapacityproviderassociations.html" hreflang="zh-tw" /><link rel="alternative" href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-resource-ecs-clustercapacityproviderassociations.html" hreflang="x-default" /><meta name="feedback-item" content="ECS" /><meta name="this_doc_product" content="AWS CloudFormation" /><meta name="this_doc_guide" content="User Guide" /><script defer="" src="/assets/r/vendor4.js?version=2021.12.02"></script><script defer="" src="/assets/r/vendor3.js?version=2021.12.02"></script><script defer="" src="/assets/r/vendor1.js?version=2021.12.02"></script><script defer="" src="/assets/r/awsdocs-common.js?version=2021.12.02"></script><script defer="" src="/assets/r/awsdocs-doc-page.js?version=2021.12.02"></script><link href="/assets/r/vendor4.css?version=2021.12.02" rel="stylesheet" /><link href="/assets/r/awsdocs-common.css?version=2021.12.02" rel="stylesheet" /><link href="/assets/r/awsdocs-doc-page.css?version=2021.12.02" rel="stylesheet" /><script async="" id="awsc-panorama-bundle" type="text/javascript" src="https://prod.pa.cdn.uis.awsstatic.com/panorama-nav-init.js" data-config="{'appEntity':'aws-documentation','region':'us-east-1','service':'cloudformation'}"></script><meta id="panorama-serviceSubSection" value="User Guide" /><meta id="panorama-serviceConsolePage" value="AWS::ECS::ClusterCapacityProviderAssociations" /></head><body class="awsdocs awsui"><div class="awsdocs-container"><awsdocs-header></awsdocs-header><awsui-app-layout id="app-layout" class="awsui-util-no-gutters" ng-controller="ContentController as $ctrl" header-selector="awsdocs-header" navigation-hide="false" navigation-width="$ctrl.navWidth" navigation-open="$ctrl.navOpen" navigation-change="$ctrl.onNavChange($event)" tools-hide="$ctrl.hideTools" tools-width="$ctrl.toolsWidth" tools-open="$ctrl.toolsOpen" tools-change="$ctrl.onToolsChange($event)"><div id="guide-toc" dom-region="navigation"><awsdocs-toc></awsdocs-toc></div><div id="main-column" dom-region="content" tabindex="-1"><awsdocs-view class="awsdocs-view"><div id="awsdocs-content"><head><title>AWS::ECS::ClusterCapacityProviderAssociations - AWS CloudFormation</title><meta name="rss" content="aws-cloudformation-release-notes.rss" /><meta name="forums" content="http://forums.aws.amazon.com/forum.jspa?forumID=92" /><meta name="feedback" content="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=ECS&amp;topic_url=https://docs.aws.amazon.com/en_us/AWSCloudFormation/latest/UserGuide/aws-resource-ecs-clustercapacityproviderassociations.html" /><meta name="feedback-yes" content="feedbackyes.html?topic_url=https://docs.aws.amazon.com/en_us/AWSCloudFormation/latest/UserGuide/aws-resource-ecs-clustercapacityproviderassociations.html" /><meta name="feedback-no" content="feedbackno.html?topic_url=https://docs.aws.amazon.com/en_us/AWSCloudFormation/latest/UserGuide/aws-resource-ecs-clustercapacityproviderassociations.html" /><meta name="keywords" content="CloudFormation,AWSCloudFormation,resource provisioning,resource configuration,infrastructure management,CloudFormer,CloudFormation stack,CloudFormation stackset,CloudFormation template,change set" /><script type="application/ld+json">
{
    "@context" : "https://schema.org",
    "@type" : "BreadcrumbList",
    "itemListElement" : [
      {
        "@type" : "ListItem",
        "position" : 1,
        "name" : "AWS",
        "item" : "https://aws.amazon.com"
      },
      {
        "@type" : "ListItem",
        "position" : 2,
        "name" : "AWS CloudFormation",
        "item" : "https://docs.aws.amazon.com/cloudformation/index.html"
      },
      {
        "@type" : "ListItem",
        "position" : 3,
        "name" : "User Guide",
        "item" : "https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide"
      },
      {
        "@type" : "ListItem",
        "position" : 4,
        "name" : "Amazon ECS resource type reference",
        "item" : "https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/AWS_ECS.html"
      },
      {
        "@type" : "ListItem",
        "position" : 5,
        "name" : "AWS::ECS::ClusterCapacityProviderAssociations",
        "item" : "https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/AWS_ECS.html"
      }
    ]
}
</script></head><body><div id="main"><div style="display: none"></div><div id="breadcrumbs" class="breadcrumb"><a href="https://aws.amazon.com">AWS</a><a href="/index.html">Documentation</a><a href="/cloudformation/index.html">AWS CloudFormation</a><a href="AWS_ECS.html">User Guide</a></div><div id="page-toc-src"><a href="#aws-resource-ecs-clustercapacityproviderassociations-syntax">Syntax</a><a href="#aws-resource-ecs-clustercapacityproviderassociations-properties">Properties</a><a href="#aws-resource-ecs-clustercapacityproviderassociations-return-values">Return values</a><a href="#aws-resource-ecs-clustercapacityproviderassociations--examples">Examples</a></div><div id="page-filters" style="display:none"><filter label="All" id="All"></filter><filter label="JSON" id="JSON"></filter><filter label="YAML" id="YAML"></filter></div><div id="main-content" class="awsui-util-container"><div id="main-col-body"><awsdocs-language-banner data-service="$ctrl.pageService"></awsdocs-language-banner><h1 class="topictitle" id="aws-resource-ecs-clustercapacityproviderassociations">AWS::ECS::ClusterCapacityProviderAssociations</h1><div class="awsdocs-page-header-container"><awsdocs-page-header></awsdocs-page-header><awsdocs-filter-selector id="awsdocs-filter-selector"></awsdocs-filter-selector></div><p>The <code class="code">AWS::ECS::ClusterCapacityProviderAssociations</code> resource associates one or more capacity
   providers and a default capacity provider strategy with a cluster.</p><h2 id="aws-resource-ecs-clustercapacityproviderassociations-syntax">Syntax</h2><p>To declare this entity in your AWS CloudFormation template, use the following syntax:</p><div id="JSON" name="JSON" class="section langfilter"><h3 id="aws-resource-ecs-clustercapacityproviderassociations-syntax.json">JSON</h3><pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
  "Type" : "AWS::ECS::ClusterCapacityProviderAssociations",
  "Properties" : <span>{</span>
      "<a href="#cfn-ecs-clustercapacityproviderassociations-capacityproviders">CapacityProviders</a>" : <code class="replaceable">[ String, ... ]</code>,
      "<a href="#cfn-ecs-clustercapacityproviderassociations-cluster">Cluster</a>" : <code class="replaceable">String</code>,
      "<a href="#cfn-ecs-clustercapacityproviderassociations-defaultcapacityproviderstrategy">DefaultCapacityProviderStrategy</a>" : <code class="replaceable">[ <a href="./aws-properties-ecs-clustercapacityproviderassociations-capacityproviderstrategy.html">CapacityProviderStrategy</a>, ... ]</code>
    }
}
</code></pre></div><div id="YAML" name="YAML" class="section langfilter"><h3 id="aws-resource-ecs-clustercapacityproviderassociations-syntax.yaml">YAML</h3><pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="yaml ">Type: AWS::ECS::ClusterCapacityProviderAssociations
Properties:
  <a href="#cfn-ecs-clustercapacityproviderassociations-capacityproviders">CapacityProviders</a>: <code class="replaceable">
    - String</code>
  <a href="#cfn-ecs-clustercapacityproviderassociations-cluster">Cluster</a>: <code class="replaceable">String</code>
  <a href="#cfn-ecs-clustercapacityproviderassociations-defaultcapacityproviderstrategy">DefaultCapacityProviderStrategy</a>: <code class="replaceable">
    - <a href="./aws-properties-ecs-clustercapacityproviderassociations-capacityproviderstrategy.html">CapacityProviderStrategy</a></code>
</code></pre></div><h2 id="aws-resource-ecs-clustercapacityproviderassociations-properties">Properties</h2><div class="variablelist"><dl><dt id="cfn-ecs-clustercapacityproviderassociations-capacityproviders"><span class="term"><code class="code">CapacityProviders</code></span></dt><dd>
  <p>The capacity providers to associate with the cluster.</p>
 <p><em>Required</em>: Yes</p><p><em>Type</em>: Array of String</p><p><em>Update requires</em>: <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/using-cfn-updating-stacks-update-behaviors.html#update-no-interrupt">No interruption</a></p></dd><dt id="cfn-ecs-clustercapacityproviderassociations-cluster"><span class="term"><code class="code">Cluster</code></span></dt><dd>
  <p>The cluster the capacity provider association is the target of.</p>
 <p><em>Required</em>: Yes</p><p><em>Type</em>: String</p><p><em>Minimum</em>: <code class="code">1</code></p><p><em>Maximum</em>: <code class="code">2048</code></p><p><em>Update requires</em>: <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/using-cfn-updating-stacks-update-behaviors.html#update-replacement">Replacement</a></p></dd><dt id="cfn-ecs-clustercapacityproviderassociations-defaultcapacityproviderstrategy"><span class="term"><code class="code">DefaultCapacityProviderStrategy</code></span></dt><dd>
  <p>The default capacity provider strategy to associate with the cluster.</p>
 <p><em>Required</em>: Yes</p><p><em>Type</em>: Array of <a href="./aws-properties-ecs-clustercapacityproviderassociations-capacityproviderstrategy.html">CapacityProviderStrategy</a></p><p><em>Update requires</em>: <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/using-cfn-updating-stacks-update-behaviors.html#update-no-interrupt">No interruption</a></p></dd></dl></div><h2 id="aws-resource-ecs-clustercapacityproviderassociations-return-values">Return values</h2><h3 id="aws-resource-ecs-clustercapacityproviderassociations-return-values-ref">Ref</h3><p>When you pass the logical ID of this resource to the intrinsic <code class="code">Ref</code> function, <code class="code">Ref</code> returns the cluster name.</p><h2 id="aws-resource-ecs-clustercapacityproviderassociations--examples">Examples</h2><div class="highlights" id="inline-topiclist"><h6> </h6><ul><li><a href="#aws-resource-ecs-clustercapacityproviderassociations--examples--Creating_a_cluster_capacity_provider_association_using_an_Auto_Scaling_group_capacity_provider">Creating a cluster capacity provider association using an Auto Scaling group capacity provider</a></li><li><a href="#aws-resource-ecs-clustercapacityproviderassociations--examples--Creating_a_cluster_capacity_provider_association_using_an_capacity_provider.">Creating a cluster capacity provider association using an AWS Fargate capacity provider.</a></li><li><a href="#aws-resource-ecs-clustercapacityproviderassociations--examples--Creating_a_cluster_capacity_provider_association_and_Auto_Scaling_group_capacity_provider.">Creating a cluster capacity provider association and Auto Scaling group capacity provider.</a></li></ul></div><h3 id="aws-resource-ecs-clustercapacityproviderassociations--examples--Creating_a_cluster_capacity_provider_association_using_an_Auto_Scaling_group_capacity_provider">Creating a cluster capacity provider association using an Auto Scaling group capacity provider</h3><p>The following example creates a cluster, two Auto Scaling group capacity providers, and the cluster capacity
     provider association that facilitates the association between them. The Auto Scaling groups the capacity providers
     use must already be created and the Amazon Resource Name (ARN) of each Auto Scaling group must be specified as
     parameters.</p><div id="JSON" name="JSON" class="section langfilter"><h4 id="aws-resource-ecs-clustercapacityproviderassociations--examples--Creating_a_cluster_capacity_provider_association_using_an_Auto_Scaling_group_capacity_provider--json">JSON</h4><pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
    "AWSTemplateFormatVersion": "2010-09-09",
    "Parameters": <span>{</span>
        "AutoScalingGroupArn1": <span>{</span>
            "Type": "String"
        },
        "AutoScalingGroupArn2": <span>{</span>
            "Type": "String"
        }
    },
    "Resources": <span>{</span>
        "CapacityProvider1": <span>{</span>
            "Type": "AWS::ECS::CapacityProvider",
            "Properties": <span>{</span>
                "AutoScalingGroupProvider": <span>{</span>
                    "AutoScalingGroupArn": <span>{</span>
                        "Ref": "AutoScalingGroupArn1"
                    },
                    "ManagedScaling": <span>{</span>
                        "Status": "ENABLED"
                    },
                    "ManagedTerminationProtection": "DISABLED"
                }
            }
        },
        "CapacityProvider2": <span>{</span>
            "Type": "AWS::ECS::CapacityProvider",
            "Properties": <span>{</span>
                "AutoScalingGroupProvider": <span>{</span>
                    "AutoScalingGroupArn": <span>{</span>
                        "Ref": "AutoScalingGroupArn2"
                    },
                    "ManagedScaling": <span>{</span>
                        "Status": "ENABLED"
                    },
                    "ManagedTerminationProtection": "DISABLED"
                }
            }
        },
        "Cluster": <span>{</span>
            "Type": "AWS::ECS::Cluster"
        },
        "ClusterCPAssociation": <span>{</span>
            "Type": "AWS::ECS::ClusterCapacityProviderAssociations",
            "Properties": <span>{</span>
                "Cluster": <span>{</span>
                    "Ref": "Cluster"
                },
                "CapacityProviders": [
                    <span>{</span>
                        "Ref": "CapacityProvider1"
                    },
                    <span>{</span>
                        "Ref": "CapacityProvider2"
                    }
                ],
                "DefaultCapacityProviderStrategy": [
                    <span>{</span>
                        "Base": 2,
                        "Weight": 6,
                        "CapacityProvider": <span>{</span>
                            "Ref": "CapacityProvider1"
                        }
                    },
                    <span>{</span>
                        "Base": 0,
                        "Weight": 10,
                        "CapacityProvider": <span>{</span>
                            "Ref": "CapacityProvider2"
                        }
                    }
                ]
            }
        }
    }
}</code></pre></div><div id="YAML" name="YAML" class="section langfilter"><h4 id="aws-resource-ecs-clustercapacityproviderassociations--examples--Creating_a_cluster_capacity_provider_association_using_an_Auto_Scaling_group_capacity_provider--yaml">YAML</h4><pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="yaml ">AWSTemplateFormatVersion: 2010-09-09
Parameters:
  AutoScalingGroupArn1:  
    Type: String
  AutoScalingGroupArn2:  
    Type: String
Resources:
  CapacityProvider1:
    Type: "AWS::ECS::CapacityProvider"
    Properties:
      AutoScalingGroupProvider:
        AutoScalingGroupArn: !Ref AutoScalingGroupArn1
        ManagedScaling:
          Status: ENABLED
        ManagedTerminationProtection: DISABLED
  CapacityProvider2:
    Type: "AWS::ECS::CapacityProvider"
    Properties:
      AutoScalingGroupProvider:
        AutoScalingGroupArn: !Ref AutoScalingGroupArn2
        ManagedScaling:
          Status: ENABLED
        ManagedTerminationProtection: DISABLED
  Cluster:
    Type: 'AWS::ECS::Cluster'
  ClusterCPAssociation:
    Type: "AWS::ECS::ClusterCapacityProviderAssociations"
    Properties:
      Cluster: !Ref Cluster
      CapacityProviders:
        - !Ref CapacityProvider1
        - !Ref CapacityProvider2
      DefaultCapacityProviderStrategy:
        - Base: 2
          Weight: 6
          CapacityProvider: !Ref CapacityProvider1
        - Base: 0
          Weight: 10
          CapacityProvider: !Ref CapacityProvider2</code></pre></div><h3 id="aws-resource-ecs-clustercapacityproviderassociations--examples--Creating_a_cluster_capacity_provider_association_using_an_capacity_provider.">Creating a cluster capacity provider association using an AWS Fargate capacity provider.</h3><p>The following example associates the <code class="code">FARGATE</code> and <code class="code">FARGATE_SPOT</code> capacity providers to
     an existing cluster. The cluster name must be specified as a parameter.</p><div id="JSON" name="JSON" class="section langfilter"><h4 id="aws-resource-ecs-clustercapacityproviderassociations--examples--Creating_a_cluster_capacity_provider_association_using_an_capacity_provider.--json">JSON</h4><pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
    "AWSTemplateFormatVersion": "2010-09-09",
    "Parameters": <span>{</span>
        "ClusterName": <span>{</span>
            "Type": "String"
        }
    },
    "Resources": <span>{</span>
        "ClusterCPAssociation": <span>{</span>
            "Type": "AWS::ECS::ClusterCapacityProviderAssociations",
            "Properties": <span>{</span>
                "Cluster": <span>{</span>
                    "Ref": "ClusterName"
                },
                "CapacityProviders": [
                    "FARGATE",
                    "FARGATE_SPOT"
                ],
                "DefaultCapacityProviderStrategy": [
                    <span>{</span>
                        "Base": 2,
                        "Weight": 1,
                        "CapacityProvider": "FARGATE"
                    },
                    <span>{</span>
                        "Base": 0,
                        "Weight": 1,
                        "CapacityProvider": "FARGATE_SPOT"
                    }
                ]
            }
        }
    }
}</code></pre></div><div id="YAML" name="YAML" class="section langfilter"><h4 id="aws-resource-ecs-clustercapacityproviderassociations--examples--Creating_a_cluster_capacity_provider_association_using_an_capacity_provider.--yaml">YAML</h4><pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="yaml ">AWSTemplateFormatVersion: 2010-09-09
Parameters:
  ClusterName:  
    Type: String
Resources:
  ClusterCPAssociation:
    Type: "AWS::ECS::ClusterCapacityProviderAssociations"
    Properties:
      Cluster: !Ref ClusterName
      CapacityProviders:
        - "FARGATE"
        - "FARGATE_SPOT"
      DefaultCapacityProviderStrategy:
        - Base: 2
          Weight: 1
          CapacityProvider: "FARGATE"
        - Base: 0
          Weight: 1
          CapacityProvider: "FARGATE_SPOT"</code></pre></div><h3 id="aws-resource-ecs-clustercapacityproviderassociations--examples--Creating_a_cluster_capacity_provider_association_and_Auto_Scaling_group_capacity_provider.">Creating a cluster capacity provider association and Auto Scaling group capacity provider.</h3><p>The following is an example of how you could use a Lambda function to create an Auto Scaling group, retrieve
     the Amazon Resource Name (ARN) of the Auto Scaling group, and then use the ARN to create an Auto Scaling group
     capacity provider, cluster, and the capacity provider association that facilitates the association between
     them.</p><div id="JSON" name="JSON" class="section langfilter"><h4 id="aws-resource-ecs-clustercapacityproviderassociations--examples--Creating_a_cluster_capacity_provider_association_and_Auto_Scaling_group_capacity_provider.--json">JSON</h4><pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
    "AWSTemplateFormatVersion": "2010-09-09",
    "Parameters": <span>{</span>
        "LatestAmiId": <span>{</span>
            "Type": "AWS::SSM::Parameter::Value&lt;AWS::EC2::Image::Id&gt;",
            "Default": "/aws/service/ecs/optimized-ami/amazon-linux-2/recommended/image_id"
        }
    },
    "Resources": <span>{</span>
        "AutoScalingReadAccessForLambdaRole": <span>{</span>
            "Type": "AWS::IAM::Role",
            "Properties": <span>{</span>
                "AssumeRolePolicyDocument": <span>{</span>
                    "Version": "2012-10-17",
                    "Statement": [
                        <span>{</span>
                            "Effect": "Allow",
                            "Principal": <span>{</span>
                                "Service": [
                                    "lambda.amazonaws.com"
                                ]
                            },
                            "Action": [
                                "sts:AssumeRole"
                            ]
                        }
                    ]
                },
                "Policies": [
                    <span>{</span>
                        "PolicyName": "LambdaReadAsgPolicy",
                        "PolicyDocument": <span>{</span>
                            "Version": "2012-10-17",
                            "Statement": [
                                <span>{</span>
                                    "Effect": "Allow",
                                    "Action": "autoscaling:DescribeAutoScalingGroups",
                                    "Resource": "*"
                                }
                            ]
                        }
                    }
                ]
            }
        },
        "AsgArnLambda": <span>{</span>
            "Type": "AWS::Lambda::Function",
            "Properties": <span>{</span>
                "Runtime": "python2.7",
                "Handler": "index.handler",
                "Role": <span>{</span>
                    "Fn::GetAtt": [
                        "AutoScalingReadAccessForLambdaRole",
                        "Arn"
                    ]
                },
                "Timeout": 50,
                "Code": <span>{</span>
                    "ZipFile": "import cfnresponse\nimport json\nimport boto3\nclient = boto3.client('autoscaling')\ndef handler(event, context):\n  response_data = <span>{</span>}\n  try:\n    autoScalingGroupName = event['ResourceProperties']['AsgName']\n    asg_arn = client.describe_auto_scaling_groups(AutoScalingGroupNames=[autoScalingGroupName])['AutoScalingGroups'][0]['AutoScalingGroupARN']\n    response_data['arn'] = asg_arn\n    cfnresponse.send(event, context, cfnresponse.SUCCESS, response_data, 'AsgArnString')\n  except Exception as e:\n    response_data['exception'] = e\n    cfnresponse.send(event, context, cfnresponse.FAILED, response_data, 'AsgArnString')\n"
                }
            }
        },
        "LaunchConfig": <span>{</span>
            "Type": "AWS::AutoScaling::LaunchConfiguration",
            "Properties": <span>{</span>
                "ImageId": <span>{</span>
                    "Ref": "LatestAmiId"
                },
                "InstanceType": "t3.micro",
                "UserData": <span>{</span>
                    "Fn::Base64": <span>{</span>
                        "Fn::Sub": "#!/bin/bash -xe\necho ECS_CLUSTER=$<span>{</span>Cluster} &gt;&gt; /etc/ecs/ecs.config\n"
                    }
                }
            }
        },
        "AutoScalingGroup": <span>{</span>
            "Type": "AWS::AutoScaling::AutoScalingGroup",
            "Properties": <span>{</span>
                "AvailabilityZones": <span>{</span>
                    "Fn::GetAZs": <span>{</span>
                        "Ref": "AWS::Region"
                    }
                },
                "HealthCheckGracePeriod": 60,
                "LaunchConfigurationName": <span>{</span>
                    "Ref": "LaunchConfig"
                },
                "MaxSize": "0",
                "MinSize": "0"
            }
        },
        "AsgArn": <span>{</span>
            "Type": "AWS::CloudFormation::CustomResource",
            "Properties": <span>{</span>
                "ServiceToken": <span>{</span>
                    "Fn::GetAtt": [
                        "AsgArnLambda",
                        "Arn"
                    ]
                },
                "AsgName": <span>{</span>
                    "Ref": "AutoScalingGroup"
                }
            }
        },
        "CapacityProvider": <span>{</span>
            "Type": "AWS::ECS::CapacityProvider",
            "Properties": <span>{</span>
                "AutoScalingGroupProvider": <span>{</span>
                    "AutoScalingGroupArn": <span>{</span>
                        "Fn::GetAtt": [
                            "AsgArn",
                            "arn"
                        ]
                    },
                    "ManagedScaling": <span>{</span>
                        "Status": "ENABLED"
                    },
                    "ManagedTerminationProtection": "DISABLED"
                }
            }
        },
        "Cluster": <span>{</span>
            "Type": "AWS::ECS::Cluster"
        },
        "ClusterCPAssoc": <span>{</span>
            "Type": "AWS::ECS::ClusterCapacityProviderAssociations",
            "Properties": <span>{</span>
                "Cluster": <span>{</span>
                    "Ref": "Cluster"
                },
                "CapacityProviders": [
                    <span>{</span>
                        "Ref": "CapacityProvider"
                    }
                ],
                "DefaultCapacityProviderStrategy": [
                    <span>{</span>
                        "Base": 0,
                        "Weight": 1,
                        "CapacityProvider": <span>{</span>
                            "Ref": "CapacityProvider"
                        }
                    }
                ]
            }
        }
    },
    "Outputs": <span>{</span>
        "ClusterArn": <span>{</span>
            "Value": <span>{</span>
                "Fn::GetAtt": [
                    "Cluster",
                    "Arn"
                ]
            }
        },
        "ClusterName": <span>{</span>
            "Value": <span>{</span>
                "Ref": "Cluster"
            }
        },
        "CapacityProviderName": <span>{</span>
            "Value": <span>{</span>
                "Ref": "CapacityProvider"
            }
        },
        "AsgArn": <span>{</span>
            "Value": <span>{</span>
                "Fn::GetAtt": [
                    "AsgArn",
                    "arn"
                ]
            }
        }
    }
}</code></pre></div><div id="YAML" name="YAML" class="section langfilter"><h4 id="aws-resource-ecs-clustercapacityproviderassociations--examples--Creating_a_cluster_capacity_provider_association_and_Auto_Scaling_group_capacity_provider.--yaml">YAML</h4><pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="yaml ">AWSTemplateFormatVersion: 2010-09-09
Parameters:  
  LatestAmiId:
    Type: 'AWS::SSM::Parameter::Value&lt;AWS::EC2::Image::Id&gt;'
    Default: '/aws/service/ecs/optimized-ami/amazon-linux-2/recommended/image_id'
Resources:
  # Custom resources to retrieve the Auto Scaling group ARN
  AutoScalingReadAccessForLambdaRole:
    Type: "AWS::IAM::Role"
    Properties:
      AssumeRolePolicyDocument:
        Version: "2012-10-17"
        Statement:
          - Effect: Allow
            Principal:
              Service:
                - "lambda.amazonaws.com"
            Action:
              - "sts:AssumeRole"
      Policies:
        - PolicyName: LambdaReadAsgPolicy
          PolicyDocument:
            Version: "2012-10-17"
            Statement:
              - Effect: Allow
                Action: "autoscaling:DescribeAutoScalingGroups"
                Resource: "*"
  AsgArnLambda:
    Type: "AWS::Lambda::Function"
    Properties:
      Runtime: "python2.7"
      Handler: "index.handler"
      Role:
        !GetAtt [ AutoScalingReadAccessForLambdaRole, Arn ]
      Timeout: 50
      Code:
        ZipFile: |
          import cfnresponse
          import json
          import boto3
          client = boto3.client('autoscaling')
          def handler(event, context):
            response_data = <span>{</span>}
            try:
              autoScalingGroupName = event['ResourceProperties']['AsgName']
              asg_arn = client.describe_auto_scaling_groups(AutoScalingGroupNames=[autoScalingGroupName])['AutoScalingGroups'][0]['AutoScalingGroupARN']
              response_data['arn'] = asg_arn
              cfnresponse.send(event, context, cfnresponse.SUCCESS, response_data, 'AsgArnString')
            except Exception as e:
              response_data['exception'] = e
              cfnresponse.send(event, context, cfnresponse.FAILED, response_data, 'AsgArnString')
  # Main resources
  LaunchConfig:
    Type: AWS::AutoScaling::LaunchConfiguration
    Properties:
      ImageId: !Ref LatestAmiId
      InstanceType: "t3.micro"
      UserData:
        Fn::Base64: !Sub |
          #!/bin/bash -xe
          echo ECS_CLUSTER=$<span>{</span>Cluster} &gt;&gt; /etc/ecs/ecs.config
  AutoScalingGroup:
    Type: "AWS::AutoScaling::AutoScalingGroup"
    Properties:
      AvailabilityZones:
        Fn::GetAZs: !Ref "AWS::Region"
      HealthCheckGracePeriod: 60
      LaunchConfigurationName: !Ref LaunchConfig
      MaxSize: "0"
      MinSize: "0"
  AsgArn:
    Type: "AWS::CloudFormation::CustomResource"
    Properties:
      ServiceToken: !GetAtt [ AsgArnLambda, Arn ]
      AsgName: !Ref AutoScalingGroup
  CapacityProvider:
    Type: "AWS::ECS::CapacityProvider"
    Properties:
      AutoScalingGroupProvider:
        AutoScalingGroupArn: !GetAtt [ AsgArn, arn ]
        ManagedScaling:
          Status: ENABLED
        ManagedTerminationProtection: DISABLED
  Cluster:
    Type: 'AWS::ECS::Cluster'
  ClusterCPAssoc:
    Type: "AWS::ECS::ClusterCapacityProviderAssociations"
    Properties:
      Cluster: !Ref Cluster
      CapacityProviders:
        - !Ref CapacityProvider
      DefaultCapacityProviderStrategy:
        - Base: 0
          Weight: 1
          CapacityProvider: !Ref CapacityProvider
Outputs:
  ClusterArn:
    Value: !GetAtt
      - Cluster
      - Arn
  ClusterName:
    Value: !Ref Cluster
  CapacityProviderName:
    Value: !Ref CapacityProvider
  AsgArn:
    Value: !GetAtt [ AsgArn, arn ]</code></pre></div><awsdocs-copyright class="copyright-print"></awsdocs-copyright><awsdocs-thumb-feedback right-edge="{{$ctrl.thumbFeedbackRightEdge}}"></awsdocs-thumb-feedback></div><noscript><div><div><div><div id="js_error_message"><p><img src="https://d1ge0kk1l5kms0.cloudfront.net/images/G/01/webservices/console/warning.png" alt="Warning" /> <strong>Javascript is disabled or is unavailable in your browser.</strong></p><p>To use the Amazon Web Services Documentation, Javascript must be enabled. Please refer to your browser's Help pages for instructions.</p></div></div></div></div></noscript><div id="main-col-footer" class="awsui-util-font-size-0"><div id="doc-conventions"><a target="_top" href="/general/latest/gr/docconventions.html">Document Conventions</a></div><div class="prev-next"><div id="previous" class="prev-link" accesskey="p" href="./aws-properties-ecs-cluster-tag.html">Tag</div><div id="next" class="next-link" accesskey="n" href="./aws-properties-ecs-clustercapacityproviderassociations-capacityproviderstrategy.html">CapacityProviderStrategy</div></div></div><awsdocs-page-utilities></awsdocs-page-utilities></div><div id="quick-feedback-yes" style="display: none;"><div class="title">Did this page help you? - Yes</div><div class="content"><p>Thanks for letting us know we're doing a good job!</p><p>If you've got a moment, please tell us what we did right so we can do more of it.</p><p><awsui-button id="fblink" rel="noopener noreferrer" target="_blank" text="Feedback" click="linkClick($event)" href="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=ECS&amp;topic_url=https://docs.aws.amazon.com/en_us/AWSCloudFormation/latest/UserGuide/aws-resource-ecs-clustercapacityproviderassociations.html"></awsui-button></p></div></div><div id="quick-feedback-no" style="display: none;"><div class="title">Did this page help you? - No</div><div class="content"><p>Thanks for letting us know this page needs work. We're sorry we let you down.</p><p>If you've got a moment, please tell us how we can make the documentation better.</p><p><awsui-button id="fblink" rel="noopener noreferrer" target="_blank" text="Feedback" click="linkClick($event)" href="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=ECS&amp;topic_url=https://docs.aws.amazon.com/en_us/AWSCloudFormation/latest/UserGuide/aws-resource-ecs-clustercapacityproviderassociations.html"></awsui-button></p></div></div></div></body></div></awsdocs-view><div class="page-loading-indicator" id="page-loading-indicator"><awsui-spinner size="large"></awsui-spinner></div></div><div id="tools-panel" dom-region="tools"><awsdocs-tools-panel id="awsdocs-tools-panel"></awsdocs-tools-panel></div></awsui-app-layout><awsdocs-cookie-banner class="doc-cookie-banner"></awsdocs-cookie-banner></div></body></html>