<!DOCTYPE html>
    <html xmlns="http://www.w3.org/1999/xhtml" lang="en-US"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>AWS::WAFv2::WebACL RateBasedStatement - AWS CloudFormation</title><meta name="viewport" content="width=device-width,initial-scale=1" /><meta name="assets_root" content="/assets" /><meta name="target_state" content="aws-properties-wafv2-webacl-ratebasedstatement" /><meta name="default_state" content="aws-properties-wafv2-webacl-ratebasedstatement" /><link rel="icon" type="image/ico" href="/assets/images/favicon.ico" /><link rel="shortcut icon" type="image/ico" href="/assets/images/favicon.ico" /><link rel="canonical" href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-properties-wafv2-webacl-ratebasedstatement.html" /><meta name="description" content="A rate-based rule counts incoming requests and rate limits requests when they are coming at too fast a rate. The rule categorizes requests according to your aggregation criteria, collects them into aggregation instances, and counts and rate limits the requests for each instance." /><meta name="deployment_region" content="IAD" /><meta name="product" content="AWS CloudFormation" /><meta name="guide" content="User Guide" /><meta name="abstract" content="Create and manage AWS infrastructure deployments predictably and repeatedly using AWS CloudFormation with this User Guide." /><meta name="guide-locale" content="en_us" /><meta name="tocs" content="toc-contents.json;toc-AWS_WAFv2.json" /><link rel="canonical" href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-properties-wafv2-webacl-ratebasedstatement.html" /><link rel="alternative" href="https://docs.aws.amazon.com/id_id/AWSCloudFormation/latest/UserGuide/aws-properties-wafv2-webacl-ratebasedstatement.html" hreflang="id-id" /><link rel="alternative" href="https://docs.aws.amazon.com/id_id/AWSCloudFormation/latest/UserGuide/aws-properties-wafv2-webacl-ratebasedstatement.html" hreflang="id" /><link rel="alternative" href="https://docs.aws.amazon.com/de_de/AWSCloudFormation/latest/UserGuide/aws-properties-wafv2-webacl-ratebasedstatement.html" hreflang="de-de" /><link rel="alternative" href="https://docs.aws.amazon.com/de_de/AWSCloudFormation/latest/UserGuide/aws-properties-wafv2-webacl-ratebasedstatement.html" hreflang="de" /><link rel="alternative" href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-properties-wafv2-webacl-ratebasedstatement.html" hreflang="en-us" /><link rel="alternative" href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-properties-wafv2-webacl-ratebasedstatement.html" hreflang="en" /><link rel="alternative" href="https://docs.aws.amazon.com/es_es/AWSCloudFormation/latest/UserGuide/aws-properties-wafv2-webacl-ratebasedstatement.html" hreflang="es-es" /><link rel="alternative" href="https://docs.aws.amazon.com/es_es/AWSCloudFormation/latest/UserGuide/aws-properties-wafv2-webacl-ratebasedstatement.html" hreflang="es" /><link rel="alternative" href="https://docs.aws.amazon.com/fr_fr/AWSCloudFormation/latest/UserGuide/aws-properties-wafv2-webacl-ratebasedstatement.html" hreflang="fr-fr" /><link rel="alternative" href="https://docs.aws.amazon.com/fr_fr/AWSCloudFormation/latest/UserGuide/aws-properties-wafv2-webacl-ratebasedstatement.html" hreflang="fr" /><link rel="alternative" href="https://docs.aws.amazon.com/it_it/AWSCloudFormation/latest/UserGuide/aws-properties-wafv2-webacl-ratebasedstatement.html" hreflang="it-it" /><link rel="alternative" href="https://docs.aws.amazon.com/it_it/AWSCloudFormation/latest/UserGuide/aws-properties-wafv2-webacl-ratebasedstatement.html" hreflang="it" /><link rel="alternative" href="https://docs.aws.amazon.com/ja_jp/AWSCloudFormation/latest/UserGuide/aws-properties-wafv2-webacl-ratebasedstatement.html" hreflang="ja-jp" /><link rel="alternative" href="https://docs.aws.amazon.com/ja_jp/AWSCloudFormation/latest/UserGuide/aws-properties-wafv2-webacl-ratebasedstatement.html" hreflang="ja" /><link rel="alternative" href="https://docs.aws.amazon.com/ko_kr/AWSCloudFormation/latest/UserGuide/aws-properties-wafv2-webacl-ratebasedstatement.html" hreflang="ko-kr" /><link rel="alternative" href="https://docs.aws.amazon.com/ko_kr/AWSCloudFormation/latest/UserGuide/aws-properties-wafv2-webacl-ratebasedstatement.html" hreflang="ko" /><link rel="alternative" href="https://docs.aws.amazon.com/pt_br/AWSCloudFormation/latest/UserGuide/aws-properties-wafv2-webacl-ratebasedstatement.html" hreflang="pt-br" /><link rel="alternative" href="https://docs.aws.amazon.com/pt_br/AWSCloudFormation/latest/UserGuide/aws-properties-wafv2-webacl-ratebasedstatement.html" hreflang="pt" /><link rel="alternative" href="https://docs.aws.amazon.com/zh_cn/AWSCloudFormation/latest/UserGuide/aws-properties-wafv2-webacl-ratebasedstatement.html" hreflang="zh-cn" /><link rel="alternative" href="https://docs.aws.amazon.com/zh_tw/AWSCloudFormation/latest/UserGuide/aws-properties-wafv2-webacl-ratebasedstatement.html" hreflang="zh-tw" /><link rel="alternative" href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-properties-wafv2-webacl-ratebasedstatement.html" hreflang="x-default" /><meta name="feedback-item" content="AWS WAF" /><meta name="this_doc_product" content="AWS CloudFormation" /><meta name="this_doc_guide" content="User Guide" /><script defer="" src="/assets/r/vendor4.js?version=2021.12.02"></script><script defer="" src="/assets/r/vendor3.js?version=2021.12.02"></script><script defer="" src="/assets/r/vendor1.js?version=2021.12.02"></script><script defer="" src="/assets/r/awsdocs-common.js?version=2021.12.02"></script><script defer="" src="/assets/r/awsdocs-doc-page.js?version=2021.12.02"></script><link href="/assets/r/vendor4.css?version=2021.12.02" rel="stylesheet" /><link href="/assets/r/awsdocs-common.css?version=2021.12.02" rel="stylesheet" /><link href="/assets/r/awsdocs-doc-page.css?version=2021.12.02" rel="stylesheet" /><script async="" id="awsc-panorama-bundle" type="text/javascript" src="https://prod.pa.cdn.uis.awsstatic.com/panorama-nav-init.js" data-config="{'appEntity':'aws-documentation','region':'us-east-1','service':'cloudformation'}"></script><meta id="panorama-serviceSubSection" value="User Guide" /><meta id="panorama-serviceConsolePage" value="AWS::WAFv2::WebACL RateBasedStatement" /></head><body class="awsdocs awsui"><div class="awsdocs-container"><awsdocs-header></awsdocs-header><awsui-app-layout id="app-layout" class="awsui-util-no-gutters" ng-controller="ContentController as $ctrl" header-selector="awsdocs-header" navigation-hide="false" navigation-width="$ctrl.navWidth" navigation-open="$ctrl.navOpen" navigation-change="$ctrl.onNavChange($event)" tools-hide="$ctrl.hideTools" tools-width="$ctrl.toolsWidth" tools-open="$ctrl.toolsOpen" tools-change="$ctrl.onToolsChange($event)"><div id="guide-toc" dom-region="navigation"><awsdocs-toc></awsdocs-toc></div><div id="main-column" dom-region="content" tabindex="-1"><awsdocs-view class="awsdocs-view"><div id="awsdocs-content"><head><title>AWS::WAFv2::WebACL RateBasedStatement - AWS CloudFormation</title><meta name="rss" content="aws-cloudformation-release-notes.rss" /><meta name="forums" content="http://forums.aws.amazon.com/forum.jspa?forumID=92" /><meta name="feedback" content="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=AWS%20WAF&amp;topic_url=https://docs.aws.amazon.com/en_us/AWSCloudFormation/latest/UserGuide/aws-properties-wafv2-webacl-ratebasedstatement.html" /><meta name="feedback-yes" content="feedbackyes.html?topic_url=https://docs.aws.amazon.com/en_us/AWSCloudFormation/latest/UserGuide/aws-properties-wafv2-webacl-ratebasedstatement.html" /><meta name="feedback-no" content="feedbackno.html?topic_url=https://docs.aws.amazon.com/en_us/AWSCloudFormation/latest/UserGuide/aws-properties-wafv2-webacl-ratebasedstatement.html" /><meta name="keywords" content="CloudFormation,AWSCloudFormation,resource provisioning,resource configuration,infrastructure management,CloudFormer,CloudFormation stack,CloudFormation stackset,CloudFormation template,change set" /><script type="application/ld+json">
{
    "@context" : "https://schema.org",
    "@type" : "BreadcrumbList",
    "itemListElement" : [
      {
        "@type" : "ListItem",
        "position" : 1,
        "name" : "AWS",
        "item" : "https://aws.amazon.com"
      },
      {
        "@type" : "ListItem",
        "position" : 2,
        "name" : "AWS CloudFormation",
        "item" : "https://docs.aws.amazon.com/cloudformation/index.html"
      },
      {
        "@type" : "ListItem",
        "position" : 3,
        "name" : "User Guide",
        "item" : "https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide"
      },
      {
        "@type" : "ListItem",
        "position" : 4,
        "name" : "AWS WAF V2 resource type reference",
        "item" : "https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/AWS_WAFv2.html"
      },
      {
        "@type" : "ListItem",
        "position" : 5,
        "name" : "AWS::WAFv2::WebACL",
        "item" : "https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-resource-wafv2-webacl.html"
      },
      {
        "@type" : "ListItem",
        "position" : 6,
        "name" : "AWS::WAFv2::WebACL RateBasedStatement",
        "item" : "https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-resource-wafv2-webacl.html"
      }
    ]
}
</script></head><body><div id="main"><div style="display: none"></div><div id="breadcrumbs" class="breadcrumb"><a href="https://aws.amazon.com">AWS</a><a href="/index.html">Documentation</a><a href="/cloudformation/index.html">AWS CloudFormation</a><a href="AWS_WAFv2.html">User Guide</a></div><div id="page-toc-src"><a href="#aws-properties-wafv2-webacl-ratebasedstatement-syntax">Syntax</a><a href="#aws-properties-wafv2-webacl-ratebasedstatement-properties">Properties</a><a href="#aws-properties-wafv2-webacl-ratebasedstatement--examples">Examples</a></div><div id="page-filters" style="display:none"><filter label="All" id="All"></filter><filter label="JSON" id="JSON"></filter><filter label="YAML" id="YAML"></filter></div><div id="main-content" class="awsui-util-container"><div id="main-col-body"><awsdocs-language-banner data-service="$ctrl.pageService"></awsdocs-language-banner><h1 class="topictitle" id="aws-properties-wafv2-webacl-ratebasedstatement">AWS::WAFv2::WebACL RateBasedStatement</h1><div class="awsdocs-page-header-container"><awsdocs-page-header></awsdocs-page-header><awsdocs-filter-selector id="awsdocs-filter-selector"></awsdocs-filter-selector></div><p>A rate-based rule counts incoming requests and rate limits requests when they are coming at too fast a rate. The rule categorizes requests according to your aggregation criteria, collects them into aggregation instances, and counts and rate limits the requests for each instance. </p><div class="awsdocs-note"><div class="awsdocs-note-title"><awsui-icon name="status-info" variant="link"></awsui-icon><h6>Note</h6></div><div class="awsdocs-note-text"><p>If you change any of these settings in a rule that's currently in use, the change resets the rule's rate limiting counts. This can pause the rule's rate limiting activities for up to a minute. </p></div></div><p>You can specify individual aggregation keys, like IP address or HTTP method. You can also specify aggregation key combinations, like IP address and HTTP method, or HTTP method, query argument, and cookie. </p><p>Each unique set of values for the aggregation keys that you specify is a separate aggregation instance, with the value from each key contributing to the aggregation instance definition. </p><p>For example, assume the rule evaluates web requests with the following IP address and HTTP method values: </p><div class="itemizedlist">
             
             
             
             
         <ul class="itemizedlist"><li class="listitem">
               <p>IP address 10.1.1.1, HTTP method POST</p>
            </li><li class="listitem">
               <p>IP address 10.1.1.1, HTTP method GET</p>
            </li><li class="listitem">
               <p>IP address 127.0.0.0, HTTP method POST</p>
            </li><li class="listitem">
               <p>IP address 10.1.1.1, HTTP method GET</p>
            </li></ul></div><p>The rule would create different aggregation instances according to your aggregation criteria, for example: </p><div class="itemizedlist">
             
             
             
         <ul class="itemizedlist"><li class="listitem">
               <p>If the aggregation criteria is just the IP address, then each individual address is an aggregation instance, and AWS WAF counts requests separately for each. The aggregation instances and request counts for our example would be the following: </p>
               <div class="itemizedlist">
                   
                   
               <ul class="itemizedlist"><li class="listitem">
                     <p>IP address 10.1.1.1: count 3</p>
                  </li><li class="listitem">
                     <p>IP address 127.0.0.0: count 1</p>
                  </li></ul></div>
            </li><li class="listitem">
               <p>If the aggregation criteria is HTTP method, then each individual HTTP method is an aggregation instance. The aggregation instances and request counts for our example would be the following: </p>
               <div class="itemizedlist">
                   
                   
               <ul class="itemizedlist"><li class="listitem">
                     <p>HTTP method POST: count 2</p>
                  </li><li class="listitem">
                     <p>HTTP method GET: count 2</p>
                  </li></ul></div>
            </li><li class="listitem">
               <p>If the aggregation criteria is IP address and HTTP method, then each IP address and each HTTP method would contribute to the combined aggregation instance. The aggregation instances and request counts for our example would be the following: </p>
               <div class="itemizedlist">
                   
                   
                   
               <ul class="itemizedlist"><li class="listitem">
                     <p>IP address 10.1.1.1, HTTP method POST: count 1</p>
                  </li><li class="listitem">
                     <p>IP address 10.1.1.1, HTTP method GET: count 2</p>
                  </li><li class="listitem">
                     <p>IP address 127.0.0.0, HTTP method POST: count 1</p>
                  </li></ul></div>
            </li></ul></div><p>For any n-tuple of aggregation keys, each unique combination of values for the keys defines a separate aggregation instance, which AWS WAF counts and rate-limits individually. </p><p>You can optionally nest another statement inside the rate-based statement, to narrow the scope of the rule so that it only counts and rate limits requests that match the nested statement. You can use this nested scope-down statement in conjunction with your aggregation key specifications or you can just count and rate limit all requests that match the scope-down statement, without additional aggregation. When you choose to just manage all requests that match a scope-down statement, the aggregation instance is singular for the rule. </p><p>You cannot nest a <code class="code">RateBasedStatement</code> inside another statement, for example inside a <code class="code">NotStatement</code> or <code class="code">OrStatement</code>. You can define a <code class="code">RateBasedStatement</code> inside a web ACL and inside a rule group. </p><p>For additional information about the options, see <a href="https://docs.aws.amazon.com/waf/latest/developerguide/waf-rate-based-rules.html">Rate limiting web requests using rate-based rules</a> 
    in the <em>
               AWS WAF Developer Guide</em>. </p><p>If you only aggregate on the individual IP address or forwarded IP address, you can retrieve the list of IP addresses that AWS WAF 
          is currently rate limiting for a rule through the API call <code class="code">GetRateBasedStatementManagedKeys</code>. This option is not available
      for other aggregation configurations.</p><p>
            AWS WAF tracks and manages web requests separately for each instance of a rate-based rule that you use. For example, if you provide the same rate-based rule settings in two web ACLs, each of the two rule statements represents a separate instance of the rate-based rule and gets its own tracking and management by AWS WAF. If you define a rate-based rule inside a rule group, and then use that rule group in multiple places, each use creates a separate instance of the rate-based rule that gets its own tracking and management by AWS WAF. </p><h2 id="aws-properties-wafv2-webacl-ratebasedstatement-syntax">Syntax</h2><p>To declare this entity in your AWS CloudFormation template, use the following syntax:</p><div id="JSON" name="JSON" class="section langfilter"><h3 id="aws-properties-wafv2-webacl-ratebasedstatement-syntax.json">JSON</h3><pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
  "<a href="#cfn-wafv2-webacl-ratebasedstatement-aggregatekeytype">AggregateKeyType</a>" : <code class="replaceable">String</code>,
  "<a href="#cfn-wafv2-webacl-ratebasedstatement-customkeys">CustomKeys</a>" : <code class="replaceable">[ <a href="./aws-properties-wafv2-webacl-ratebasedstatementcustomkey.html">RateBasedStatementCustomKey</a>, ... ]</code>,
  "<a href="#cfn-wafv2-webacl-ratebasedstatement-evaluationwindowsec">EvaluationWindowSec</a>" : <code class="replaceable">Integer</code>,
  "<a href="#cfn-wafv2-webacl-ratebasedstatement-forwardedipconfig">ForwardedIPConfig</a>" : <code class="replaceable"><a href="./aws-properties-wafv2-webacl-forwardedipconfiguration.html">ForwardedIPConfiguration</a></code>,
  "<a href="#cfn-wafv2-webacl-ratebasedstatement-limit">Limit</a>" : <code class="replaceable">Integer</code>,
  "<a href="#cfn-wafv2-webacl-ratebasedstatement-scopedownstatement">ScopeDownStatement</a>" : <code class="replaceable"><a href="./aws-properties-wafv2-webacl-statement.html">Statement</a></code>
}
</code></pre></div><div id="YAML" name="YAML" class="section langfilter"><h3 id="aws-properties-wafv2-webacl-ratebasedstatement-syntax.yaml">YAML</h3><pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="yaml ">  <a href="#cfn-wafv2-webacl-ratebasedstatement-aggregatekeytype">AggregateKeyType</a>: <code class="replaceable">String</code>
  <a href="#cfn-wafv2-webacl-ratebasedstatement-customkeys">CustomKeys</a>: <code class="replaceable">
    - <a href="./aws-properties-wafv2-webacl-ratebasedstatementcustomkey.html">RateBasedStatementCustomKey</a></code>
  <a href="#cfn-wafv2-webacl-ratebasedstatement-evaluationwindowsec">EvaluationWindowSec</a>: <code class="replaceable">Integer</code>
  <a href="#cfn-wafv2-webacl-ratebasedstatement-forwardedipconfig">ForwardedIPConfig</a>: <code class="replaceable">
    <a href="./aws-properties-wafv2-webacl-forwardedipconfiguration.html">ForwardedIPConfiguration</a></code>
  <a href="#cfn-wafv2-webacl-ratebasedstatement-limit">Limit</a>: <code class="replaceable">Integer</code>
  <a href="#cfn-wafv2-webacl-ratebasedstatement-scopedownstatement">ScopeDownStatement</a>: <code class="replaceable">
    <a href="./aws-properties-wafv2-webacl-statement.html">Statement</a></code>
</code></pre></div><h2 id="aws-properties-wafv2-webacl-ratebasedstatement-properties">Properties</h2><div class="variablelist"><dl><dt id="cfn-wafv2-webacl-ratebasedstatement-aggregatekeytype"><span class="term"><code class="code">AggregateKeyType</code></span></dt><dd>
         <p>Setting that indicates how to aggregate the request counts. </p>
         <div class="awsdocs-note"><div class="awsdocs-note-title"><awsui-icon name="status-info" variant="link"></awsui-icon><h6>Note</h6></div><div class="awsdocs-note-text"><p>Web requests that are missing any of the components specified in the aggregation keys
                are omitted from the rate-based rule evaluation and handling. </p></div></div>
         <div class="itemizedlist">
             
             
             
             
         <ul class="itemizedlist"><li class="listitem">
               <p>
                  <code class="code">CONSTANT</code> - Count and limit the requests that match the rate-based rule's scope-down 
             statement. With this option, the counted requests aren't further aggregated. The scope-down statement 
                 is the only specification used. When the count of all requests that satisfy the scope-down statement
                 goes over the limit, AWS WAF applies the rule action to all requests that satisfy the scope-down statement. </p>
               <p>With this option, you must configure the <code class="code">ScopeDownStatement</code> property. </p>
            </li><li class="listitem">
               <p>
                  <code class="code">CUSTOM_KEYS</code> - Aggregate the request counts using one or more web request components as the aggregate keys.</p>
               <p>With this option, you must specify the aggregate keys in the <code class="code">CustomKeys</code> property. </p>
               <p>To aggregate on only the IP address or only the forwarded IP address, don't use custom keys. Instead, set the aggregate
                 key type to <code class="code">IP</code> or <code class="code">FORWARDED_IP</code>.</p>
            </li><li class="listitem">
               <p>
                  <code class="code">FORWARDED_IP</code> - Aggregate the request counts on the first IP address in an HTTP header. </p>
               <p>With this option, you must specify the header to use in the <code class="code">ForwardedIPConfig</code> property. </p>
               <p>To aggregate on a combination of the forwarded IP address with other aggregate keys, use <code class="code">CUSTOM_KEYS</code>. </p>
            </li><li class="listitem">
               <p>
                  <code class="code">IP</code> - Aggregate the request counts on the IP address from the web request
               origin.</p>
               <p>To aggregate on a combination of the IP address with other aggregate keys, use <code class="code">CUSTOM_KEYS</code>. </p>
            </li></ul></div>
      <p><em>Required</em>: Yes</p><p><em>Type</em>: String</p><p><em>Allowed values</em>: <code class="code">CONSTANT | IP | FORWARDED_IP | CUSTOM_KEYS</code></p><p><em>Update requires</em>: <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/using-cfn-updating-stacks-update-behaviors.html#update-no-interrupt">No interruption</a></p></dd><dt id="cfn-wafv2-webacl-ratebasedstatement-customkeys"><span class="term"><code class="code">CustomKeys</code></span></dt><dd>
         <p>Specifies the aggregate keys to use in a rate-base rule. </p>
      <p><em>Required</em>: No</p><p><em>Type</em>: Array of <a href="./aws-properties-wafv2-webacl-ratebasedstatementcustomkey.html">RateBasedStatementCustomKey</a></p><p><em>Maximum</em>: <code class="code">5</code></p><p><em>Update requires</em>: <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/using-cfn-updating-stacks-update-behaviors.html#update-no-interrupt">No interruption</a></p></dd><dt id="cfn-wafv2-webacl-ratebasedstatement-evaluationwindowsec"><span class="term"><code class="code">EvaluationWindowSec</code></span></dt><dd>
         <p>The amount of time, in seconds, that AWS WAF
            should include in its request counts, looking back from the current time. For example, 
            for a setting of 120, when AWS WAF checks the rate, it counts the requests for the 2 minutes immediately preceding 
            the current time. Valid settings are 60, 120, 300, and 600. </p>
         <p>This setting doesn't determine how often AWS WAF checks the rate, but how far back it looks each 
            time it checks. AWS WAF checks the rate about every 10 seconds.</p>
         <p>Default: <code class="code">300</code> (5 minutes)</p>
      <p><em>Required</em>: No</p><p><em>Type</em>: Integer</p><p><em>Allowed values</em>: <code class="code">60 | 120 | 300 | 600</code></p><p><em>Update requires</em>: <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/using-cfn-updating-stacks-update-behaviors.html#update-no-interrupt">No interruption</a></p></dd><dt id="cfn-wafv2-webacl-ratebasedstatement-forwardedipconfig"><span class="term"><code class="code">ForwardedIPConfig</code></span></dt><dd>
         <p>The configuration for inspecting IP addresses in an HTTP header that you specify, instead of using the IP address that's reported by the web request origin. Commonly, this is the X-Forwarded-For (XFF) header, but you can specify any header name. </p>
         <div class="awsdocs-note"><div class="awsdocs-note-title"><awsui-icon name="status-info" variant="link"></awsui-icon><h6>Note</h6></div><div class="awsdocs-note-text"><p>If the specified header isn't present in the request, AWS WAF doesn't apply the rule to the web request at all.</p></div></div>
         <p>This is required if you specify a forwarded IP in the rule's aggregate key settings. </p>
      <p><em>Required</em>: No</p><p><em>Type</em>: <a href="./aws-properties-wafv2-webacl-forwardedipconfiguration.html">ForwardedIPConfiguration</a></p><p><em>Update requires</em>: <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/using-cfn-updating-stacks-update-behaviors.html#update-no-interrupt">No interruption</a></p></dd><dt id="cfn-wafv2-webacl-ratebasedstatement-limit"><span class="term"><code class="code">Limit</code></span></dt><dd>
         <p>The limit on requests per 5-minute period for a single aggregation instance for the rate-based rule. 
       If the rate-based statement includes a <code class="code">ScopeDownStatement</code>, this limit is applied only to the
         requests that match the statement.</p>
         <p>Examples: </p>
         <div class="itemizedlist">
             
             
         <ul class="itemizedlist"><li class="listitem">
               <p>If you aggregate on just the IP address, this is the limit on requests from any single IP address. </p>
            </li><li class="listitem">
               <p>If you aggregate on the HTTP method and the query argument name "city", then this is the limit on
             requests for any single method, city pair. </p>
            </li></ul></div>
      <p><em>Required</em>: Yes</p><p><em>Type</em>: Integer</p><p><em>Minimum</em>: <code class="code">100</code></p><p><em>Maximum</em>: <code class="code">2000000000</code></p><p><em>Update requires</em>: <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/using-cfn-updating-stacks-update-behaviors.html#update-no-interrupt">No interruption</a></p></dd><dt id="cfn-wafv2-webacl-ratebasedstatement-scopedownstatement"><span class="term"><code class="code">ScopeDownStatement</code></span></dt><dd>
         <p>An optional nested statement that narrows the scope of the web requests that are
      evaluated and managed by the rate-based statement. When you use a scope-down statement, 
      the rate-based rule only tracks and rate limits 
      requests that match the scope-down statement. You can use any nestable <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-properties-wafv2-webacl-notstatement.html#cfn-wafv2-webacl-notstatement-statement">Statement</a> in the scope-down statement, and you can nest statements at any
         level, the same as you can for a rule statement. </p>
      <p><em>Required</em>: No</p><p><em>Type</em>: <a href="./aws-properties-wafv2-webacl-statement.html">Statement</a></p><p><em>Update requires</em>: <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/using-cfn-updating-stacks-update-behaviors.html#update-no-interrupt">No interruption</a></p></dd></dl></div><h2 id="aws-properties-wafv2-webacl-ratebasedstatement--examples">Examples</h2><p>The following rate-based rule examples are also listed in a web ACL example, under <code class="code">AWS::WAFv2::WebACL</code>. </p><div class="highlights" id="inline-topiclist"><h6> </h6><ul><li><a href="#aws-properties-wafv2-webacl-ratebasedstatement--examples--Rate_limit_all_requests_that_match_a_scope-down_statement">Rate limit all requests that match a scope-down statement</a></li><li><a href="#aws-properties-wafv2-webacl-ratebasedstatement--examples--Rate_limit_requests_based_on_an_IP_address">Rate limit requests based on an IP address</a></li><li><a href="#aws-properties-wafv2-webacl-ratebasedstatement--examples--Rate_limit_requests_based_on_an_IP_address_and_a_header">Rate limit requests based on an IP address and a header </a></li><li><a href="#aws-properties-wafv2-webacl-ratebasedstatement--examples--Rate_limit_requests_based_on_three_custom_aggregate_keys">Rate limit requests based on three custom aggregate keys </a></li><li><a href="#aws-properties-wafv2-webacl-ratebasedstatement--examples--Rate_limit_requests_from_individual_states_in_a_country">Rate limit requests from individual states in a country </a></li></ul></div><h3 id="aws-properties-wafv2-webacl-ratebasedstatement--examples--Rate_limit_all_requests_that_match_a_scope-down_statement">Rate limit all requests that match a scope-down statement</h3><p>The following example listing shows a rate-based rule statement that counts and rate limits all requests that match  
                    a scope-down statement. Rate-based rules that count all requests together are required to include a scope-down statement. In 
            this example, the rule counts all requests coming from a specific country, and limits those requests to 100,000 for any five minute period.</p><div id="YAML" name="YAML" class="section langfilter"><h4 id="aws-properties-wafv2-webacl-ratebasedstatement--examples--Rate_limit_all_requests_that_match_a_scope-down_statement--yaml">YAML</h4><pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="yaml ">Rules:
- Name: rbrCountAll
  Priority: 0
  Statement:
    RateBasedStatement:
      Limit: 100000
      AggregateKeyType: CONSTANT
      ScopeDownStatement:
        GeoMatchStatement:
          CountryCodes:
          - GB
          ForwardedIPConfig:
            HeaderName: X-Forwarded-For
            FallbackBehavior: MATCH
  Action:
    Block: <span>{</span>}
  VisibilityConfig:
    SampledRequestsEnabled: true
    CloudWatchMetricsEnabled: true
    MetricName: rbrCountAll </code></pre></div><div id="JSON" name="JSON" class="section langfilter"><h4 id="aws-properties-wafv2-webacl-ratebasedstatement--examples--Rate_limit_all_requests_that_match_a_scope-down_statement--json">JSON</h4><pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "> "Rules": [
    <span>{</span>
      "Name": "rbrCountAll",
      "Priority": 0,
      "Statement": <span>{</span>
        "RateBasedStatement": <span>{</span>
          "Limit": 100000,
          "AggregateKeyType": "CONSTANT",
          "ScopeDownStatement": <span>{</span>
            "GeoMatchStatement": <span>{</span>
              "CountryCodes": [
                "GB"
              ],
              "ForwardedIPConfig": <span>{</span>
                "HeaderName": "X-Forwarded-For",
                "FallbackBehavior": "MATCH"
              }
            }
          }
        }
      },
      "Action": <span>{</span>
        "Block": <span>{</span>}
      },
      "VisibilityConfig": <span>{</span>
        "SampledRequestsEnabled": true,
        "CloudWatchMetricsEnabled": true,
        "MetricName": "rbrCountAll"
      }
    }
 ]
 </code></pre></div><h3 id="aws-properties-wafv2-webacl-ratebasedstatement--examples--Rate_limit_requests_based_on_an_IP_address">Rate limit requests based on an IP address</h3><p>The following example listing shows a rate-based rule statement that uses the value in a forwarded IP address to aggregate and 
                    rate limit requests. The forwarded IP address used in this example is the one in the header <code class="code">X-Forwarded-For</code>.</p><p>When you rate limit on only the IP address or only a forwarded IP address, you specify the aggregation in the aggregate key 
                type and you don't use custom aggregation keys. </p><div id="YAML" name="YAML" class="section langfilter"><h4 id="aws-properties-wafv2-webacl-ratebasedstatement--examples--Rate_limit_requests_based_on_an_IP_address--yaml">YAML</h4><pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="yaml ">Rules:
- Name: rbrNoCustomKeys
  Priority: 1
  Statement:
    RateBasedStatement:
      Limit: 1000
      AggregateKeyType: FORWARDED_IP
      ForwardedIPConfig:
        HeaderName: X-Forwarded-For
        FallbackBehavior: MATCH
  Action:
    Block: <span>{</span>}
  VisibilityConfig:
    SampledRequestsEnabled: true
    CloudWatchMetricsEnabled: true
    MetricName: rbrNoCustomKeys
    </code></pre></div><div id="JSON" name="JSON" class="section langfilter"><h4 id="aws-properties-wafv2-webacl-ratebasedstatement--examples--Rate_limit_requests_based_on_an_IP_address--json">JSON</h4><pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "> "Rules": [
    <span>{</span>
      "Name": "rbrNoCustomKeys",
      "Priority": 1,
      "Statement": <span>{</span>
        "RateBasedStatement": <span>{</span>
          "Limit": 1000,
          "AggregateKeyType": "FORWARDED_IP",
          "ForwardedIPConfig": <span>{</span>
            "HeaderName": "X-Forwarded-For",
            "FallbackBehavior": "MATCH"
          }
        }
      },
      "Action": <span>{</span>
        "Block": <span>{</span>}
      },
      "VisibilityConfig": <span>{</span>
        "SampledRequestsEnabled": true,
        "CloudWatchMetricsEnabled": true,
        "MetricName": "rbrNoCustomKeys"
      }
    }
 ]
 </code></pre></div><h3 id="aws-properties-wafv2-webacl-ratebasedstatement--examples--Rate_limit_requests_based_on_an_IP_address_and_a_header">Rate limit requests based on an IP address and a header </h3><p>The following example listing shows a rate-based rule statement that aggregates and rate limits requests based on the 
                    paired values of a forwarded IP address and a header. The IP address used is the one in the header <code class="code">X-Forwarded-For</code> 
                        and the header value used is in the header <code class="code">Content-Type</code>.</p><p>To rate limit using a combination of an IP address with one or more other keys, you provide all key specifications 
                        in the custom aggregation key settings. Anytime you use a forwarded IP address, you specify the header name 
                        of the address in the rate-based statement's <code class="code">ForwardedIPConfig</code> setting. </p><div id="YAML" name="YAML" class="section langfilter"><h4 id="aws-properties-wafv2-webacl-ratebasedstatement--examples--Rate_limit_requests_based_on_an_IP_address_and_a_header--yaml">YAML</h4><pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="yaml ">Rules:
- Name: rbrCustomKeysA
  Priority: 2
  Statement:
    RateBasedStatement:
      Limit: 2000
      AggregateKeyType: CUSTOM_KEYS
      ForwardedIPConfig:
        HeaderName: X-Forwarded-For
        FallbackBehavior: MATCH
      CustomKeys:
      - Header:
          Name: Content-Type
          TextTransformations:
          - Priority: 0
            Type: NONE
      - ForwardedIP: <span>{</span>}
  Action:
    Block: <span>{</span>}
  VisibilityConfig:
    SampledRequestsEnabled: true
    CloudWatchMetricsEnabled: true
    MetricName: rbrCustomKeysA
    </code></pre></div><div id="JSON" name="JSON" class="section langfilter"><h4 id="aws-properties-wafv2-webacl-ratebasedstatement--examples--Rate_limit_requests_based_on_an_IP_address_and_a_header--json">JSON</h4><pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "> "Rules": [
    <span>{</span>
      "Name": "rbrCustomKeysA",
      "Priority": 2,
      "Statement": <span>{</span>
        "RateBasedStatement": <span>{</span>
          "Limit": 2000,
          "AggregateKeyType": "CUSTOM_KEYS",
          "ForwardedIPConfig": <span>{</span>
            "HeaderName": "X-Forwarded-For",
            "FallbackBehavior": "MATCH"
          },
          "CustomKeys": [
            <span>{</span>
              "Header": <span>{</span>
                "Name": "Content-Type",
                "TextTransformations": [
                  <span>{</span>
                    "Priority": 0,
                    "Type": "NONE"
                  }
                ]
              }
            },
            <span>{</span>
              "ForwardedIP": <span>{</span>}
            }
          ]
        }
      },
      "Action": <span>{</span>
        "Block": <span>{</span>}
      },
      "VisibilityConfig": <span>{</span>
        "SampledRequestsEnabled": true,
        "CloudWatchMetricsEnabled": true,
        "MetricName": "rbrCustomKeysA"
      }
    }
 ]
 </code></pre></div><h3 id="aws-properties-wafv2-webacl-ratebasedstatement--examples--Rate_limit_requests_based_on_three_custom_aggregate_keys">Rate limit requests based on three custom aggregate keys </h3><p>The following example listing shows a rate-based rule statement that aggregates and rate limits requests based on the 
                    trio of values from the query string, the HTTP method, and the URI path. </p><div id="YAML" name="YAML" class="section langfilter"><h4 id="aws-properties-wafv2-webacl-ratebasedstatement--examples--Rate_limit_requests_based_on_three_custom_aggregate_keys--yaml">YAML</h4><pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="yaml ">Rules:
- Name: rbrCustomKeysB
  Priority: 3
  Statement:
    RateBasedStatement:
      Limit: 3000
      AggregateKeyType: CUSTOM_KEYS
      CustomKeys:
      - QueryString:
          TextTransformations:
          - Priority: 0
            Type: NONE
      - HTTPMethod: <span>{</span>}
      - UriPath:
          TextTransformations:
          - Priority: 0
            Type: NONE
  Action:
    Block: <span>{</span>}
  VisibilityConfig:
    SampledRequestsEnabled: true
    CloudWatchMetricsEnabled: true
    MetricName: rbrCustomKeysB
    </code></pre></div><div id="JSON" name="JSON" class="section langfilter"><h4 id="aws-properties-wafv2-webacl-ratebasedstatement--examples--Rate_limit_requests_based_on_three_custom_aggregate_keys--json">JSON</h4><pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "> "Rules": [
    <span>{</span>
      "Name": "rbrCustomKeysB",
      "Priority": 3,
      "Statement": <span>{</span>
        "RateBasedStatement": <span>{</span>
          "Limit": 3000,
          "AggregateKeyType": "CUSTOM_KEYS",
          "CustomKeys": [
            <span>{</span>
              "QueryString": <span>{</span>
                "TextTransformations": [
                  <span>{</span>
                    "Priority": 0,
                    "Type": "NONE"
                  }
                ]
              }
            },
            <span>{</span>
              "HTTPMethod": <span>{</span>}
            },
            <span>{</span>
              "UriPath": <span>{</span>
                "TextTransformations": [
                  <span>{</span>
                    "Priority": 0,
                    "Type": "NONE"
                  }
                ]
              }
            }
          ]
        }
      },
      "Action": <span>{</span>
        "Block": <span>{</span>}
      },
      "VisibilityConfig": <span>{</span>
        "SampledRequestsEnabled": true,
        "CloudWatchMetricsEnabled": true,
        "MetricName": "rbrCustomKeysB"
      }
    }
 ]
 </code></pre></div><h3 id="aws-properties-wafv2-webacl-ratebasedstatement--examples--Rate_limit_requests_from_individual_states_in_a_country">Rate limit requests from individual states in a country </h3><p>The following example listing combines a geo match statement with a rate based rule, to limit 
                the number of requests coming from any individual U.S. state. </p><p>The geo match statement matches on all requests coming from the U.S. and it has its rule action set to Count. 
                For all matching requets, the geo match statement adds a country label and a region label, so after being evaluated by this rule, 
                requests from the U.S. are labeled by state. For more information, see the <code class="code">AWS::WAFv2::WebACL</code> <code class="code">GeoMatchStatement</code> property. </p><p>Following the geo match statement, the rate-based rule uses a scope-down statement to also only match on requests
            from the U.S.. The rate-based rule aggregates on values for the geo match region label namespace, so the requests from each state are counted in their own 
            aggregation instance. The rate-based rule limits each state to 500 requests in any five minute period. </p><div id="YAML" name="YAML" class="section langfilter"><h4 id="aws-properties-wafv2-webacl-ratebasedstatement--examples--Rate_limit_requests_from_individual_states_in_a_country--yaml">YAML</h4><pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="yaml ">Rules:
- Name: labelUSStates
  Priority: 4
  Statement:
    GeoMatchStatement:
      CountryCodes:
      - US
  Action:
    Count: <span>{</span>}
  VisibilityConfig:
    SampledRequestsEnabled: true
    CloudWatchMetricsEnabled: true
    MetricName: labelUSStates
- Name: rbrRequestsFromUSStates
  Priority: 5
  Statement:
    RateBasedStatement:
      Limit: 500
      AggregateKeyType: CUSTOM_KEYS
      ScopeDownStatement:
        GeoMatchStatement:
          CountryCodes:
          - US
      CustomKeys:
      - LabelNamespace:
          Namespace: 'awswaf:clientip:geo:region:'
  Action:
    Block: <span>{</span>}
  VisibilityConfig:
    SampledRequestsEnabled: true
    CloudWatchMetricsEnabled: true
    MetricName: rbrRequestsFromUSStates
    </code></pre></div><div id="JSON" name="JSON" class="section langfilter"><h4 id="aws-properties-wafv2-webacl-ratebasedstatement--examples--Rate_limit_requests_from_individual_states_in_a_country--json">JSON</h4><pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "> "Rules": [
    <span>{</span>
      "Name": "labelUSStates",
      "Priority": 4,
      "Statement": <span>{</span>
        "GeoMatchStatement": <span>{</span>
          "CountryCodes": [
            "US"
          ]
        }
      },
      "Action": <span>{</span>
        "Count": <span>{</span>}
      },
      "VisibilityConfig": <span>{</span>
        "SampledRequestsEnabled": true,
        "CloudWatchMetricsEnabled": true,
        "MetricName": "labelUSStates"
      }
    },
    <span>{</span>
      "Name": "rbrRequestsFromUSStates",
      "Priority": 5,
      "Statement": <span>{</span>
        "RateBasedStatement": <span>{</span>
          "Limit": 500,
          "AggregateKeyType": "CUSTOM_KEYS",
          "ScopeDownStatement": <span>{</span>
            "GeoMatchStatement": <span>{</span>
              "CountryCodes": [
                "US"
              ]
            }
          },
          "CustomKeys": [
            <span>{</span>
              "LabelNamespace": <span>{</span>
                "Namespace": "awswaf:clientip:geo:region:"
              }
            }
          ]
        }
      },
      "Action": <span>{</span>
        "Block": <span>{</span>}
      },
      "VisibilityConfig": <span>{</span>
        "SampledRequestsEnabled": true,
        "CloudWatchMetricsEnabled": true,
        "MetricName": "rbrRequestsFromUSStates"
      }
    }
 ]
 </code></pre></div><awsdocs-copyright class="copyright-print"></awsdocs-copyright><awsdocs-thumb-feedback right-edge="{{$ctrl.thumbFeedbackRightEdge}}"></awsdocs-thumb-feedback></div><noscript><div><div><div><div id="js_error_message"><p><img src="https://d1ge0kk1l5kms0.cloudfront.net/images/G/01/webservices/console/warning.png" alt="Warning" /> <strong>Javascript is disabled or is unavailable in your browser.</strong></p><p>To use the Amazon Web Services Documentation, Javascript must be enabled. Please refer to your browser's Help pages for instructions.</p></div></div></div></div></noscript><div id="main-col-footer" class="awsui-util-font-size-0"><div id="doc-conventions"><a target="_top" href="/general/latest/gr/docconventions.html">Document Conventions</a></div><div class="prev-next"><div id="previous" class="prev-link" accesskey="p" href="./aws-properties-wafv2-webacl-overrideaction.html">OverrideAction</div><div id="next" class="next-link" accesskey="n" href="./aws-properties-wafv2-webacl-ratebasedstatementcustomkey.html">RateBasedStatementCustomKey</div></div></div><awsdocs-page-utilities></awsdocs-page-utilities></div><div id="quick-feedback-yes" style="display: none;"><div class="title">Did this page help you? - Yes</div><div class="content"><p>Thanks for letting us know we're doing a good job!</p><p>If you've got a moment, please tell us what we did right so we can do more of it.</p><p><awsui-button id="fblink" rel="noopener noreferrer" target="_blank" text="Feedback" click="linkClick($event)" href="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=AWS WAF&amp;topic_url=https://docs.aws.amazon.com/en_us/AWSCloudFormation/latest/UserGuide/aws-properties-wafv2-webacl-ratebasedstatement.html"></awsui-button></p></div></div><div id="quick-feedback-no" style="display: none;"><div class="title">Did this page help you? - No</div><div class="content"><p>Thanks for letting us know this page needs work. We're sorry we let you down.</p><p>If you've got a moment, please tell us how we can make the documentation better.</p><p><awsui-button id="fblink" rel="noopener noreferrer" target="_blank" text="Feedback" click="linkClick($event)" href="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=AWS WAF&amp;topic_url=https://docs.aws.amazon.com/en_us/AWSCloudFormation/latest/UserGuide/aws-properties-wafv2-webacl-ratebasedstatement.html"></awsui-button></p></div></div></div></body></div></awsdocs-view><div class="page-loading-indicator" id="page-loading-indicator"><awsui-spinner size="large"></awsui-spinner></div></div><div id="tools-panel" dom-region="tools"><awsdocs-tools-panel id="awsdocs-tools-panel"></awsdocs-tools-panel></div></awsui-app-layout><awsdocs-cookie-banner class="doc-cookie-banner"></awsdocs-cookie-banner></div></body></html>