<!DOCTYPE html>
    <html xmlns="http://www.w3.org/1999/xhtml" lang="zh-CN"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>使用模块封装及重复使用资源配置 - AWS CloudFormation</title><meta name="viewport" content="width=device-width,initial-scale=1" /><meta name="assets_root" content="/assets" /><meta name="target_state" content="modules" /><meta name="default_state" content="modules" /><link rel="icon" type="image/ico" href="/assets/images/favicon.ico" /><link rel="shortcut icon" type="image/ico" href="/assets/images/favicon.ico" /><link rel="canonical" href="https://docs.aws.amazon.com/zh_cn/AWSCloudFormation/latest/UserGuide/modules.html" /><meta name="description" content="了解如何使用模块将包含最佳实践、专家领域知识和可接受的指南在内的资源配置纳入模板中，而无需深入了解资源实施的复杂性。" /><meta name="deployment_region" content="IAD" /><meta name="product" content="AWS CloudFormation" /><meta name="guide" content="用户指南" /><meta name="abstract" content="根据此用户指南，使用 AWS CloudFormation 以可预见方式反复创建和管理 AWS 基础设施部署。" /><meta name="guide-locale" content="zh_cn" /><meta name="tocs" content="toc-contents.json" /><link rel="canonical" href="https://docs.aws.amazon.com/zh_cn/AWSCloudFormation/latest/UserGuide/modules.html" /><link rel="alternative" href="https://docs.aws.amazon.com/id_id/AWSCloudFormation/latest/UserGuide/modules.html" hreflang="id-id" /><link rel="alternative" href="https://docs.aws.amazon.com/id_id/AWSCloudFormation/latest/UserGuide/modules.html" hreflang="id" /><link rel="alternative" href="https://docs.aws.amazon.com/de_de/AWSCloudFormation/latest/UserGuide/modules.html" hreflang="de-de" /><link rel="alternative" href="https://docs.aws.amazon.com/de_de/AWSCloudFormation/latest/UserGuide/modules.html" hreflang="de" /><link rel="alternative" href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/modules.html" hreflang="en-us" /><link rel="alternative" href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/modules.html" hreflang="en" /><link rel="alternative" href="https://docs.aws.amazon.com/es_es/AWSCloudFormation/latest/UserGuide/modules.html" hreflang="es-es" /><link rel="alternative" href="https://docs.aws.amazon.com/es_es/AWSCloudFormation/latest/UserGuide/modules.html" hreflang="es" /><link rel="alternative" href="https://docs.aws.amazon.com/fr_fr/AWSCloudFormation/latest/UserGuide/modules.html" hreflang="fr-fr" /><link rel="alternative" href="https://docs.aws.amazon.com/fr_fr/AWSCloudFormation/latest/UserGuide/modules.html" hreflang="fr" /><link rel="alternative" href="https://docs.aws.amazon.com/it_it/AWSCloudFormation/latest/UserGuide/modules.html" hreflang="it-it" /><link rel="alternative" href="https://docs.aws.amazon.com/it_it/AWSCloudFormation/latest/UserGuide/modules.html" hreflang="it" /><link rel="alternative" href="https://docs.aws.amazon.com/ja_jp/AWSCloudFormation/latest/UserGuide/modules.html" hreflang="ja-jp" /><link rel="alternative" href="https://docs.aws.amazon.com/ja_jp/AWSCloudFormation/latest/UserGuide/modules.html" hreflang="ja" /><link rel="alternative" href="https://docs.aws.amazon.com/ko_kr/AWSCloudFormation/latest/UserGuide/modules.html" hreflang="ko-kr" /><link rel="alternative" href="https://docs.aws.amazon.com/ko_kr/AWSCloudFormation/latest/UserGuide/modules.html" hreflang="ko" /><link rel="alternative" href="https://docs.aws.amazon.com/pt_br/AWSCloudFormation/latest/UserGuide/modules.html" hreflang="pt-br" /><link rel="alternative" href="https://docs.aws.amazon.com/pt_br/AWSCloudFormation/latest/UserGuide/modules.html" hreflang="pt" /><link rel="alternative" href="https://docs.aws.amazon.com/zh_cn/AWSCloudFormation/latest/UserGuide/modules.html" hreflang="zh-cn" /><link rel="alternative" href="https://docs.aws.amazon.com/zh_tw/AWSCloudFormation/latest/UserGuide/modules.html" hreflang="zh-tw" /><link rel="alternative" href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/modules.html" hreflang="x-default" /><meta name="feedback-item" content="CloudFormation" /><meta name="this_doc_product" content="AWS CloudFormation" /><meta name="this_doc_guide" content="用户指南" /><script defer="" src="/assets/r/vendor4.js?version=2021.12.02"></script><script defer="" src="/assets/r/vendor3.js?version=2021.12.02"></script><script defer="" src="/assets/r/vendor1.js?version=2021.12.02"></script><script defer="" src="/assets/r/awsdocs-common.js?version=2021.12.02"></script><script defer="" src="/assets/r/awsdocs-doc-page.js?version=2021.12.02"></script><link href="/assets/r/vendor4.css?version=2021.12.02" rel="stylesheet" /><link href="/assets/r/awsdocs-common.css?version=2021.12.02" rel="stylesheet" /><link href="/assets/r/awsdocs-doc-page.css?version=2021.12.02" rel="stylesheet" /><script async="" id="awsc-panorama-bundle" type="text/javascript" src="https://prod.pa.cdn.uis.awsstatic.com/panorama-nav-init.js" data-config="{'appEntity':'aws-documentation','region':'us-east-1','service':'cloudformation'}"></script><meta id="panorama-serviceSubSection" value="用户指南" /><meta id="panorama-serviceConsolePage" value="使用模块封装及重复使用资源配置" /></head><body class="awsdocs awsui"><div class="awsdocs-container"><awsdocs-header></awsdocs-header><awsui-app-layout id="app-layout" class="awsui-util-no-gutters" ng-controller="ContentController as $ctrl" header-selector="awsdocs-header" navigation-hide="false" navigation-width="$ctrl.navWidth" navigation-open="$ctrl.navOpen" navigation-change="$ctrl.onNavChange($event)" tools-hide="$ctrl.hideTools" tools-width="$ctrl.toolsWidth" tools-open="$ctrl.toolsOpen" tools-change="$ctrl.onToolsChange($event)"><div id="guide-toc" dom-region="navigation"><awsdocs-toc></awsdocs-toc></div><div id="main-column" dom-region="content" tabindex="-1"><awsdocs-view class="awsdocs-view"><div id="awsdocs-content"><head><title>使用模块封装及重复使用资源配置 - AWS CloudFormation</title><meta name="rss" content="aws-cloudformation-release-notes.rss" /><meta name="forums" content="http://forums.aws.amazon.com/forum.jspa?forumID=92" /><meta name="feedback" content="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=CloudFormation&amp;topic_url=https://docs.aws.amazon.com/zh_cn/AWSCloudFormation/latest/UserGuide/modules.html" /><meta name="feedback-yes" content="feedbackyes.html?topic_url=https://docs.aws.amazon.com/zh_cn/AWSCloudFormation/latest/UserGuide/modules.html" /><meta name="feedback-no" content="feedbackno.html?topic_url=https://docs.aws.amazon.com/zh_cn/AWSCloudFormation/latest/UserGuide/modules.html" /><meta name="keywords" content="CloudFormation,AWSCloudFormation,资源预置,资源配置,基础设施管理,CloudFormer,CloudFormation 堆栈,CloudFormation 堆栈集,CloudFormation 模板,更改集" /><script type="application/ld+json">
{
    "@context" : "https://schema.org",
    "@type" : "BreadcrumbList",
    "itemListElement" : [
      {
        "@type" : "ListItem",
        "position" : 1,
        "name" : "AWS",
        "item" : "https://aws.amazon.com"
      },
      {
        "@type" : "ListItem",
        "position" : 2,
        "name" : "AWS CloudFormation",
        "item" : "https://docs.aws.amazon.com/cloudformation/index.html"
      },
      {
        "@type" : "ListItem",
        "position" : 3,
        "name" : "用户指南",
        "item" : "https://docs.aws.amazon.com/zh_cn/AWSCloudFormation/latest/UserGuide"
      },
      {
        "@type" : "ListItem",
        "position" : 4,
        "name" : "使用 AWS CloudFormation 模板",
        "item" : "https://docs.aws.amazon.com/zh_cn/AWSCloudFormation/latest/UserGuide/template-guide.html"
      },
      {
        "@type" : "ListItem",
        "position" : 5,
        "name" : "使用模块封装及重复使用资源配置",
        "item" : "https://docs.aws.amazon.com/zh_cn/AWSCloudFormation/latest/UserGuide/template-guide.html"
      }
    ]
}
</script></head><body><div id="main"><div style="display: none"></div><div id="breadcrumbs" class="breadcrumb"><a href="https://aws.amazon.com">AWS</a><a href="/index.html">文档</a><a href="/cloudformation/index.html">AWS CloudFormation</a><a href="Welcome.html">用户指南</a></div><div id="page-toc-src"><a href="#modules-using">在模板中使用模块</a><a href="#module-using-params">使用参数指定模块值</a><a href="#module-ref-resources">引用模块中的资源</a><a href="#module-considerations">使用模块时的注意事项</a><a href="#module-versioning">模块注册和版本控制</a><a href="#module-enabling">激活公共模块</a></div><div id="main-content" class="awsui-util-container"><div id="main-col-body"><awsdocs-language-banner data-service="$ctrl.pageService"></awsdocs-language-banner><h1 class="topictitle" id="modules">使用模块封装及重复使用资源配置</h1><div class="awsdocs-page-header-container"><awsdocs-page-header></awsdocs-page-header><awsdocs-filter-selector id="awsdocs-filter-selector"></awsdocs-filter-selector></div><p><em>模块</em>是一种供您以透明、易管理和可重复的方式打包资源配置以便跨堆栈模板实现包含的方法。模块可以将常见服务配置和最佳实践封装为模块化、可自定义的构建基块，供您包含在堆栈模板中。模块使您能够将包含最佳实践、专家领域知识和可接受的指南（例如安全性、合规性、治理和行业法规）在内的资源配置纳入模板中，而无需深入了解资源实施的复杂性。</p><p>例如，网络领域专家可以创建一个包含遵守安全准则的内置安全组和入口/出口规则的模块。然后，您可以将该模块纳入到模板中，以便在堆栈中预配置安全的网络基础架构，而无需花费时间弄清楚 VPC、子网、安全组和网关的工作方式。此外，由于模块具有版本控制，因此如果安全指南随时间而发生变化，模块作者可以创建包含这些更改的新版本模块。</p><p>在模板中使用模块的特点包括：</p><div class="itemizedlist">
   
   
   
   
 <ul class="itemizedlist"><li class="listitem">
   <p><em>可预测性</em>：模块必须遵守其在 CloudFormation 注册表中注册的架构，这样在您将模块纳入到模板中后，您就知道该模块可以解析到哪些资源。</p>
  </li><li class="listitem">
   <p><em>可重用性</em>：您可以在多个模板和账户中使用同一模块。</p>
  </li><li class="listitem">
   <p><em>可追溯性</em>：CloudFormation 可以保留堆栈中的哪些资源是从模块预配置的知识，使您能够轻松了解资源变化的来源。</p>
  </li><li class="listitem">
   <p><em>可管理性</em>：注册模块后，您可以通过 CloudFormation 注册表对其进行管理，包括版本控制以及账户和区域可用性。</p>
  </li></ul></div><p>模块可以包含：</p><div class="itemizedlist">
   
   
 <ul class="itemizedlist"><li class="listitem">
   <p>要从模块配置的一个或多个资源以及任何关联的数据，例如输出数据或条件。</p>
  </li><li class="listitem">
   <p>使您能够在使用模块时指定自定义值的任何<em>模块参数</em>。</p>
  </li></ul></div><p>有关开发模块类型的信息，请参阅《CloudFormation 命令行界面用户指南》中的<a href="https://docs.aws.amazon.com/cloudformation-cli/latest/userguide/modules-develop.html">开发模块类型</a>。</p>
  <h2 id="modules-using">在模板中使用模块</h2>
  <p>要使用模块，请确保该模块已在要在其中使用它的账户和区域中注册。有关更多信息，请参阅<a href="./registry.html#registry-public-private">公有和私有扩展</a>。您在 CloudFormation 注册表中将模块注册为私有扩展。然后，将其作为单个资源进行处理：</p>
  <div class="itemizedlist">
    
    
  <ul class="itemizedlist"><li class="listitem">
    <p>将其纳入到模板的 <code class="code"><a href="./resources-section-structure.html">资源</a></code> 部分中。</p>
   </li><li class="listitem">
    <p>为模块指定任何必要的属性。</p>
   </li></ul></div>
  <p>当您启动堆栈操作时，CloudFormation 会生成一个已处理的模板，该模板将所有包含的模块解析为适当的资源。在实际执行堆栈操作之前，使用更改集预览要添加或更新的资源。有关更多信息，请参阅<a href="./using-cfn-updating-stacks-changesets.html">使用更改集更新堆栈</a>。</p>
  <p>参阅以下示例：您有一个包含资源和模块的模板。模板包含一个单独的资源 <b>ResourceA</b> 和一个模块 <b>ModuleParent</b>。而模块包含两个资源（<b>ResourceB</b> 和 <b>ResourceC</b>），以及一个嵌套模块 <b>ModuleChild</b>。<b>ModuleChild</b> 包含一个资源，即 <b>ResourceD</b>。如果您使用此模板创建堆栈，CloudFormation 会处理模板并将模块解析为适当的资源。最终创建的堆栈具有四个资源：<b>ResourceA</b>、<b>ResourceB</b>、<b>ResourceC</b> 和 <b>ResourceD</b>。</p>
  <div class="mediaobject">
    
    <img src="images/modules-resource-inclusion.png" class="aws-docs-img-whiteBg aws-docs-img-padding" alt="&#xA;    在堆栈操作期间，CloudFormation 会将堆栈模板中包含的两个模块解析为适当的四个资源。&#xA;   " style="max-width:100%" />
    
    
  </div>
  <p>CloudFormation 会跟踪堆栈中的哪些资源是从模块创建而成的。您可以在给定堆栈的 <b>Events</b>（事件）、<b>Resources</b>（资源）和 <b>Drifts</b>（偏差）选项卡上查看此信息，更改集预览中也包含此信息。</p>
  <p>模块与模板中的资源可以区别开来，因为它们遵循以下四部分命名约定，而不是资源所用的典型的三部分命名约定：</p>
  <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="复制"><awsui-icon name="copy"></awsui-icon></div></div><code class="text "><code class="replaceable">organization</code>::<code class="replaceable">service</code>::<code class="replaceable">use-case</code>::MODULE</code></pre>
  
  <h2 id="module-using-params">使用参数指定模块值</h2>
  <p>模块可以包含模块参数。与模板参数非常相似，模块参数使您能够将自定义值从包含自定义值的模板（或模块）输入到模块中。然后，模块可以使用这些值来设置其所包含的资源的属性。</p>
  <p>您还可以定义模板参数，这些参数反过来会设置模块属性，以便用户可以输入在堆栈操作时传递给模块的值。有关定义模板参数的更多信息，请参阅 <a href="./parameters-section-structure.html">参数</a>。</p>
  <p>同样，如果模块含有包含模块参数的嵌套模块，则您可以：</p>
  <div class="itemizedlist">
    
    
  <ul class="itemizedlist"><li class="listitem">
    <p>直接在父模块中为嵌套模块的参数指定值。</p>
   </li><li class="listitem">
    <p>在父模块中定义相应的模块参数，使嵌套模块的参数能够由包含父模块的模板（或模块）来设置。</p>
   </li></ul></div>
   
   <h3 id="module-using-params-example-1">使用模板参数指定模块参数值</h3>
   <p>以下示例展示了如何定义将值传递给模块的模板参数。</p>
   <p>此处，包含 <code class="code">My::S3::SampleBucket::MODULE</code> 的模板定义了模板参数 <code class="code">BucketName</code>，该参数使用户能够在堆栈操作期间指定 S3 存储桶名称。</p>
   <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="复制"><awsui-icon name="copy"></awsui-icon></div></div><code class="json ">// Template containing My::S3::SampleBucket::MODULE
<span>{</span>
  "Parameters": <span>{</span>
    "<b>BucketName</b>": <span>{</span>
      "Description": "Name for your sample bucket",
      "Type": "String"
    }
  },
  "Resources": <span>{</span>
    "MyBucket": <span>{</span>
      "Type": "<b>My::S3::SampleBucket::MODULE</b>",
      "Properties": <span>{</span>
        "<b>BucketName</b>": <span>{</span>
          "Ref": "BucketName"
        }
      }
    }
  }
}</code></pre>
   
   
   <h3 id="module-using-params-example-2">在父模块中指定子模块中资源的属性</h3>
   <p>以下示例展示了如何在嵌套在另一个模块中的模块中指定参数值。</p>
   <p>第一个模块 <code class="code">My::S3::SampleBucketPrivate::MODULE</code> 将是子模块。该模块定义了两个参数：<code class="code">BucketName</code> 和 <code class="code">AccessControl</code>。为这些参数指定的值用于指定模块所包含的 <code class="code">AWS::S3::Bucket</code> 资源的 <code class="code">BucketName</code> 和 <code class="code">AccessControl</code> 属性。以下为 <code class="code">My::S3::SampleBucketPrivate::MODULE</code> 的模板片段。</p>
   <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="复制"><awsui-icon name="copy"></awsui-icon></div></div><code class="yaml ">// My::S3::SampleBucketPrivate::MODULE
<span>{</span>
    "AWSTemplateFormatVersion": "2010-09-09",
    "Description": "A sample S3 Bucket with Versioning and DeletionPolicy.",
    "Parameters": <span>{</span>
        "<b>BucketName</b>": <span>{</span>
            "Description": "Name for the bucket",
            "Type": "String"
        },
        "<b>AccessControl</b>": <span>{</span>
            "Description": "AccessControl for the bucket",
            "Type": "String"
        }
    },
    "Resources": <span>{</span>
        "S3Bucket": <span>{</span>
            "Type": "AWS::S3::Bucket",
            "Properties": <span>{</span>
                "<b>BucketName</b>": <span>{</span>
                    "Ref": "BucketName"
                },
                "<b>AccessControl</b>": <span>{</span>
                    "Ref": "AccessControl"
                },
                "DeletionPolicy": "Retain",
                "VersioningConfiguration": <span>{</span>
                    "Status": "Enabled"
                }
            }
        }
    }
}</code></pre>
   <p>接下来，上一个模块嵌套在父模块 <code class="code">My::S3::SampleBucket::MODULE</code> 中。父模块 <code class="code">My::S3::SampleBucket::MODULE</code> 通过以下方式设置子模块参数：</p>
   <div class="itemizedlist">
     
     
   <ul class="itemizedlist"><li class="listitem">
     <p>其将 <code class="code">My::S3::SampleBucketPrivate::MODULE</code> 的 <code class="code">AccessControl</code> 参数设置为 <code class="code">Private</code>。</p>
    </li><li class="listitem">
     <p>对于 <code class="code">BucketName</code>，其定义了一个模块参数，该参数将允许存储桶名称在包含 <code class="code">My::S3::SampleBucket::MODULE</code> 的模板（或模块）中进行指定。</p>
    </li></ul></div>
   <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="复制"><awsui-icon name="copy"></awsui-icon></div></div><code class="json ">// My::S3::SampleBucket::MODULE
<span>{</span>
  "AWSTemplateFormatVersion": "2010-09-09",
  "Description": "A sample S3 Bucket. With Private AccessControl.",
  "Parameters": <span>{</span>
    "<b>BucketName</b>": <span>{</span>
      "Description": "Name for your sample bucket",
      "Type": "String"
    }
  },
  "Resources": <span>{</span>
    "MyBucket": <span>{</span>
      "Type": "<b>My::S3::SampleBucketPrivate::MODULE</b>",
      "Properties": <span>{</span>
        "<b>BucketName</b>": <span>{</span>
          "Ref": "BucketName"
        },
        "<b>AccessControl</b>" : "Private"
      }
    }
  }
}</code></pre>
   
   
   <h3 id="modules-using-parameters-constraints">为模块参数指定约束</h3>
   <p>模块参数不支持约束强制执行。有关更多信息，请参阅<a href="./parameters-section-structure.html#parameters-section-structure-properties">属性</a>。要对模块参数执行约束检查，请创建具有所需约束的模板参数，然后在模块参数中引用该模板参数。</p>
   
  
  <h2 id="module-ref-resources">引用模块中的资源</h2>
  <p>模块中的资源可以通过逻辑名称进行引用。模块中包含的资源的完全限定逻辑名称可以通过将以下名称相结合来构成：</p>
  <div class="itemizedlist">
    
    
  <ul class="itemizedlist"><li class="listitem">
    <p>在包含模板（或包含模块）中为模块指定的逻辑名称。</p>
   </li><li class="listitem">
    <p>模块中指定的资源的逻辑名称。</p>
   </li></ul></div>
  <p>可以使用或不使用句点作为分隔符来指定资源的完全限定逻辑名称。例如，以下两个逻辑名称都是有效的，且功能等同：</p>
  <div class="itemizedlist">
    
    
  <ul class="itemizedlist"><li class="listitem">
    <p><code class="code"><code class="replaceable">ModuleLogicalName</code>.<code class="replaceable">ResourceLogicalName</code></code></p>
   </li><li class="listitem">
    <p><code class="code"><code class="replaceable">ModuleLogicalNameResourceLogicalName</code></code></p>
   </li></ul></div>
  <p>通过这种方式，您可以使用 <code class="code">GetAtt</code> 和 <code class="code">Ref</code> 内部函数来访问模块资源上的属性值。</p>
  <p>在以下示例中，模板引用模块中的属性来为模板本身的资源设置相应属性。</p>
  <p>假设 <code class="code">My::S3::SampleBucket::MODULE</code> 模块包含逻辑名称为 <code class="code">S3Bucket</code> 的资源 <code class="code">AWS::S3::Bucket</code>。要使用 <code class="code">Ref</code> 内部函数引用此资源的存储桶名称，将模板中给定模块的逻辑名称 <code class="code">MyBucket</code> 与模块中资源的逻辑名称 <code class="code">S3Bucket</code> 相结合，从而获得资源的完全限定逻辑名称：<code class="code">MyBucket.S3Bucket</code> 或 <code class="code">MyBucketS3Bucket</code>。</p>
  <p>模块中包含的资源的逻辑名称在模块的架构中指定。您可以通过以下方式访问该架构：</p>
  <div class="itemizedlist">
    
    
  <ul class="itemizedlist"><li class="listitem">
    <p>在 CloudFormation 注册表中查找模块。<b>架构</b>选项卡显示了模块架构。</p>
   </li><li class="listitem">
    <p>使用 <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/APIReference/API_DescribeType.html"><code class="code">DescribeType</code></a> 操作返回模块详细信息，其中包括架构。</p>
   </li></ul></div>

  <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="复制"><awsui-icon name="copy"></awsui-icon></div></div><code class="json ">// Template that uses My::S3::SampleBucket::MODULE
<span>{</span>
  "Parameters": <span>{</span>
    "BucketName": <span>{</span>
      "Description": "Name for your sample bucket",
      "Type": "String"
   }
 },
  "Resources": <span>{</span>
    "MyBucket": <span>{</span>
      "Type": "My::S3::SampleBucket::MODULE",
      "Properties": <span>{</span>
          "BucketName": <span>{</span>
            "Ref": "BucketName"
         }
      }
    },
    "exampleQueue": <span>{</span>
      "Type": "AWS::SQS::Queue",
      "Properties": <span>{</span>
          "QueueName": <span>{</span>
            "Ref": "<b>MyBucket.S3Bucket</b>"
          }
      }
    }
},
"Outputs": <span>{</span>
  "BucketArn": <span>{</span>
      "Value": <span>{</span>
          "Fn::GetAtt": [
             "<b>MyBucket</b>",
             "<b>S3Bucket.Arn</b>"
          ]
      }
    }
  }
}</code></pre>
  <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="复制"><awsui-icon name="copy"></awsui-icon></div></div><code class="yaml ">Parameters:
  BucketName:
    Description: Name for your sample bucket
    Type: String
Resources:
  MyBucket:
    Type: My::S3::SampleBucket::MODULE
    Properties:
      BucketName: !Ref BucketName
  exampleQueue:
    Type: AWS::SQS::Queue
    Properties:
      QueueName: !Ref <b>MyBucket.S3Bucket</b>
Outputs:
  BucketArn:
    Value: !<b>GetAtt MyBucket.S3Bucket.Arn</b></code></pre>
  
  <h2 id="module-considerations">使用模块时的注意事项</h2>
  <div class="itemizedlist">
    
    
    
    
    
    
  <ul class="itemizedlist"><li class="listitem">
    <p>使用模块不收取任何额外费用。您只需为模块解析到堆栈中的资源付费。</p>
   </li><li class="listitem">
    <p>CloudFormation 配额（例如堆栈中允许的最大资源数或模板正文的最大大小）适用于处理过的模板，无论该模板中包含的资源是否来自模块。有关更多信息，请参阅<a href="./cloudformation-limits.html">AWS CloudFormation 限额</a>。</p>
   </li><li class="listitem">
    <p>您在<em>堆栈</em>级别指定的标签将分配给派生自模块的各个资源。</p>
   </li><li class="listitem">
    <p>CloudFormation 处理模板时，在模块级别指定的帮助程序脚本不会传播到模块中包含的各个资源。</p>
   </li><li class="listitem">
    <p>模块中指定的输出将在模板级别传播到输出。</p>
    <p>将为每个输出分配一个逻辑 ID，该 ID 是模块逻辑名称和模块中定义的输出名称的拼接。有关输出的详细信息，请参阅 <a href="./outputs-section-structure.html">输出</a>。</p>
   </li><li class="listitem">
    <p>模块中指定的参数不会传播到模板级别的参数。</p>
    <p>但是，您可以创建引用模块级参数的模板级参数。有关更多信息，请参阅<a href="#module-using-params">使用参数指定模块值</a>。</p>
   </li></ul></div>
  
  <h2 id="module-versioning">模块注册和版本控制</h2>
  <p>您可以使用 CloudFormation 注册表注册及管理账户和区域中的模块。有关更多信息，请参阅<a href="./registry.html">使用 AWS CloudFormation 注册表</a>。</p>
  <p>您可以在给定账户和区域注册同一模块的多个版本。请注意以下事项：</p>
  <div class="itemizedlist">
    
    
    
    
    
    
  <ul class="itemizedlist"><li class="listitem">
    <p>必须在要在其中使用模块的账户和区域中注册模块。</p>
   </li><li class="listitem">
    <p>在堆栈操作期间，CloudFormation 会使用当前<em>在执行堆栈操作的账户和区域中</em>注册为默认版本的模块版本。包括嵌套在其他模块中的模块。</p>
    <p>因此，请注意，如果您在不同账户或区域中将同一模块的不同版本注册为默认版本，则使用同一个模板可能会导致不同的结果。</p>
    <p>有关更多信息，请参阅<a href="./registry-private.html#registry-set-version">使用 AWS CLI 指定要使用的私有扩展版本</a>。</p>
   </li><li class="listitem">
    <p>在堆栈操作期间，CloudFormation 会使用当前在执行堆栈操作的账户和区域中注册为默认版本的<em>资源</em>版本。这包括通过纳入模块生成的资源。</p>
   </li><li class="listitem">
    <p>更改模块的默认版本不会启动任何堆栈更新操作。但是，在您下次使用包含该模块的任何模板执行堆栈操作（例如堆栈更新）时，CloudFormation 将在操作中使用新的默认版本。</p>
    <p>但在指定了<b>使用以前的模板</b>选项的情况下执行堆栈更新时例外，如下所述。</p>
   </li><li class="listitem">
    <p>对于堆栈更新操作，如果您指定<b>使用以前的模板</b>选项，则 CloudFormation 会使用先前处理过的模板进行堆栈更新，不会针对您可能对模块作出的任何更改重新处理模块。</p>
   </li><li class="listitem">
    <p>为了保证结果统一，如果要在堆栈模板中纳入模块以用于堆栈集，则应确保在计划部署堆栈实例的所有账户和区域中将相同版本的模块设置为默认版本。这包括嵌套在其他模块中的模块。有关堆栈集的更多信息，请参阅 <a href="./what-is-cfnstacksets.html">使用 AWS CloudFormation StackSets</a>。</p>
   </li></ul></div>
  <p>有关注册新版本模块或更改模块的默认版本的更多信息，请参阅 <a href="./registry.html">使用 AWS CloudFormation 注册表</a>。</p>
  
  <h2 id="module-enabling">激活公共模块以在您的账户中使用</h2>
  <p>为了在您的账户和区域中成功激活公共模块，模块中包含的每个第三方公共扩展（资源或模块）必须满足以下条件：</p>
  <div class="itemizedlist">
    
    
  <ul class="itemizedlist"><li class="listitem">
    <p>该扩展必须已在您的账户和区域中激活。</p>
    <p>如果模块中的扩展使用类型名称别名，则该扩展必须使用相同的类型名称别名在您的账户和区域中注册。有关更多信息，请参阅<a href="./registry-public.html#registry-public-enable-alias">指定别名以引用扩展</a>。</p>
   </li><li class="listitem">
    <p>当前激活的扩展版本必须是模块中指定的该扩展支持的主要版本之一。有关更多信息，请参阅《CloudFormation CLI 用户指南》中的<a href="https://docs.aws.amazon.com/cloudformation-cli/latest/userguide/modules-structure.html#modules-structure-publishing-prereqs">发布公共模块的模块要求</a>。</p>
   </li></ul></div>
  <p>如果您没有激活正确的第三方公有扩展和扩展版本，CloudFormation 将使操作失败，并显示一条错误消息，其中列出在成功激活该模块之前需要激活的扩展和/或版本。</p>
 <awsdocs-copyright class="copyright-print"></awsdocs-copyright><awsdocs-thumb-feedback right-edge="{{$ctrl.thumbFeedbackRightEdge}}"></awsdocs-thumb-feedback></div><noscript><div><div><div><div id="js_error_message"><p><img src="https://d1ge0kk1l5kms0.cloudfront.net/images/G/01/webservices/console/warning.png" alt="警告" /> <strong>Javascript 在您的浏览器中被禁用或不可用。</strong></p><p>要使用 Amazon Web Services 文档，必须启用 Javascript。请参阅浏览器的帮助页面以了解相关说明。</p></div></div></div></div></noscript><div id="main-col-footer" class="awsui-util-font-size-0"><div id="doc-conventions"><a target="_top" href="/general/latest/gr/docconventions.html">文档惯例</a></div><div class="prev-next"><div id="previous" class="prev-link" accesskey="p" href="./macros-example.html">宏示例：创建和使用宏</div><div id="next" class="next-link" accesskey="n" href="./blue-green.html">执行 ECS 蓝/绿部署</div></div></div><awsdocs-page-utilities></awsdocs-page-utilities></div><div id="quick-feedback-yes" style="display: none;"><div class="title">此页面对您有帮助吗？- 是</div><div class="content"><p>感谢您对我们工作的肯定！</p><p>如果不耽误您的时间，请告诉我们做得好的地方，让我们做得更好。</p><p><awsui-button id="fblink" rel="noopener noreferrer" target="_blank" text="反馈" click="linkClick($event)" href="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=CloudFormation&amp;topic_url=https://docs.aws.amazon.com/zh_cn/AWSCloudFormation/latest/UserGuide/modules.html"></awsui-button></p></div></div><div id="quick-feedback-no" style="display: none;"><div class="title">此页面对您有帮助吗？- 否</div><div class="content"><p>感谢您告诉我们本页内容还需要完善。很抱歉让您失望了。</p><p>如果不耽误您的时间，请告诉我们如何改进文档。</p><p><awsui-button id="fblink" rel="noopener noreferrer" target="_blank" text="反馈" click="linkClick($event)" href="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=CloudFormation&amp;topic_url=https://docs.aws.amazon.com/zh_cn/AWSCloudFormation/latest/UserGuide/modules.html"></awsui-button></p></div></div></div></body></div></awsdocs-view><div class="page-loading-indicator" id="page-loading-indicator"><awsui-spinner size="large"></awsui-spinner></div></div><div id="tools-panel" dom-region="tools"><awsdocs-tools-panel id="awsdocs-tools-panel"></awsdocs-tools-panel></div></awsui-app-layout><awsdocs-cookie-banner class="doc-cookie-banner"></awsdocs-cookie-banner></div></body></html>