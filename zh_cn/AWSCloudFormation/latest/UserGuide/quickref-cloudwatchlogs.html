<!DOCTYPE html>
    <html xmlns="http://www.w3.org/1999/xhtml" lang="zh-CN"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Amazon CloudWatch Logs 模板代码段 - AWS CloudFormation</title><meta name="viewport" content="width=device-width,initial-scale=1" /><meta name="assets_root" content="/assets" /><meta name="target_state" content="quickref-cloudwatchlogs" /><meta name="default_state" content="quickref-cloudwatchlogs" /><link rel="icon" type="image/ico" href="/assets/images/favicon.ico" /><link rel="shortcut icon" type="image/ico" href="/assets/images/favicon.ico" /><link rel="canonical" href="https://docs.aws.amazon.com/zh_cn/AWSCloudFormation/latest/UserGuide/quickref-cloudwatchlogs.html" /><meta name="description" content="可以使用 Amazon CloudWatch Logs 模板代码段帮助您在 AWS CloudFormation 模板中描述 CloudWatch Logs 资源。" /><meta name="deployment_region" content="IAD" /><meta name="product" content="AWS CloudFormation" /><meta name="guide" content="用户指南" /><meta name="abstract" content="根据此用户指南，使用 AWS CloudFormation 以可预见方式反复创建和管理 AWS 基础设施部署。" /><meta name="guide-locale" content="zh_cn" /><meta name="tocs" content="toc-contents.json" /><link rel="canonical" href="https://docs.aws.amazon.com/zh_cn/AWSCloudFormation/latest/UserGuide/quickref-cloudwatchlogs.html" /><link rel="alternative" href="https://docs.aws.amazon.com/id_id/AWSCloudFormation/latest/UserGuide/quickref-cloudwatchlogs.html" hreflang="id-id" /><link rel="alternative" href="https://docs.aws.amazon.com/id_id/AWSCloudFormation/latest/UserGuide/quickref-cloudwatchlogs.html" hreflang="id" /><link rel="alternative" href="https://docs.aws.amazon.com/de_de/AWSCloudFormation/latest/UserGuide/quickref-cloudwatchlogs.html" hreflang="de-de" /><link rel="alternative" href="https://docs.aws.amazon.com/de_de/AWSCloudFormation/latest/UserGuide/quickref-cloudwatchlogs.html" hreflang="de" /><link rel="alternative" href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/quickref-cloudwatchlogs.html" hreflang="en-us" /><link rel="alternative" href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/quickref-cloudwatchlogs.html" hreflang="en" /><link rel="alternative" href="https://docs.aws.amazon.com/es_es/AWSCloudFormation/latest/UserGuide/quickref-cloudwatchlogs.html" hreflang="es-es" /><link rel="alternative" href="https://docs.aws.amazon.com/es_es/AWSCloudFormation/latest/UserGuide/quickref-cloudwatchlogs.html" hreflang="es" /><link rel="alternative" href="https://docs.aws.amazon.com/fr_fr/AWSCloudFormation/latest/UserGuide/quickref-cloudwatchlogs.html" hreflang="fr-fr" /><link rel="alternative" href="https://docs.aws.amazon.com/fr_fr/AWSCloudFormation/latest/UserGuide/quickref-cloudwatchlogs.html" hreflang="fr" /><link rel="alternative" href="https://docs.aws.amazon.com/it_it/AWSCloudFormation/latest/UserGuide/quickref-cloudwatchlogs.html" hreflang="it-it" /><link rel="alternative" href="https://docs.aws.amazon.com/it_it/AWSCloudFormation/latest/UserGuide/quickref-cloudwatchlogs.html" hreflang="it" /><link rel="alternative" href="https://docs.aws.amazon.com/ja_jp/AWSCloudFormation/latest/UserGuide/quickref-cloudwatchlogs.html" hreflang="ja-jp" /><link rel="alternative" href="https://docs.aws.amazon.com/ja_jp/AWSCloudFormation/latest/UserGuide/quickref-cloudwatchlogs.html" hreflang="ja" /><link rel="alternative" href="https://docs.aws.amazon.com/ko_kr/AWSCloudFormation/latest/UserGuide/quickref-cloudwatchlogs.html" hreflang="ko-kr" /><link rel="alternative" href="https://docs.aws.amazon.com/ko_kr/AWSCloudFormation/latest/UserGuide/quickref-cloudwatchlogs.html" hreflang="ko" /><link rel="alternative" href="https://docs.aws.amazon.com/pt_br/AWSCloudFormation/latest/UserGuide/quickref-cloudwatchlogs.html" hreflang="pt-br" /><link rel="alternative" href="https://docs.aws.amazon.com/pt_br/AWSCloudFormation/latest/UserGuide/quickref-cloudwatchlogs.html" hreflang="pt" /><link rel="alternative" href="https://docs.aws.amazon.com/zh_cn/AWSCloudFormation/latest/UserGuide/quickref-cloudwatchlogs.html" hreflang="zh-cn" /><link rel="alternative" href="https://docs.aws.amazon.com/zh_tw/AWSCloudFormation/latest/UserGuide/quickref-cloudwatchlogs.html" hreflang="zh-tw" /><link rel="alternative" href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/quickref-cloudwatchlogs.html" hreflang="x-default" /><meta name="feedback-item" content="CloudFormation" /><meta name="this_doc_product" content="AWS CloudFormation" /><meta name="this_doc_guide" content="用户指南" /><script defer="" src="/assets/r/vendor4.js?version=2021.12.02"></script><script defer="" src="/assets/r/vendor3.js?version=2021.12.02"></script><script defer="" src="/assets/r/vendor1.js?version=2021.12.02"></script><script defer="" src="/assets/r/awsdocs-common.js?version=2021.12.02"></script><script defer="" src="/assets/r/awsdocs-doc-page.js?version=2021.12.02"></script><link href="/assets/r/vendor4.css?version=2021.12.02" rel="stylesheet" /><link href="/assets/r/awsdocs-common.css?version=2021.12.02" rel="stylesheet" /><link href="/assets/r/awsdocs-doc-page.css?version=2021.12.02" rel="stylesheet" /><script async="" id="awsc-panorama-bundle" type="text/javascript" src="https://prod.pa.cdn.uis.awsstatic.com/panorama-nav-init.js" data-config="{'appEntity':'aws-documentation','region':'us-east-1','service':'cloudformation'}"></script><meta id="panorama-serviceSubSection" value="用户指南" /><meta id="panorama-serviceConsolePage" value="Amazon CloudWatch Logs 模板代码段" /></head><body class="awsdocs awsui"><div class="awsdocs-container"><awsdocs-header></awsdocs-header><awsui-app-layout id="app-layout" class="awsui-util-no-gutters" ng-controller="ContentController as $ctrl" header-selector="awsdocs-header" navigation-hide="false" navigation-width="$ctrl.navWidth" navigation-open="$ctrl.navOpen" navigation-change="$ctrl.onNavChange($event)" tools-hide="$ctrl.hideTools" tools-width="$ctrl.toolsWidth" tools-open="$ctrl.toolsOpen" tools-change="$ctrl.onToolsChange($event)"><div id="guide-toc" dom-region="navigation"><awsdocs-toc></awsdocs-toc></div><div id="main-column" dom-region="content" tabindex="-1"><awsdocs-view class="awsdocs-view"><div id="awsdocs-content"><head><title>Amazon CloudWatch Logs 模板代码段 - AWS CloudFormation</title><meta name="rss" content="aws-cloudformation-release-notes.rss" /><meta name="forums" content="http://forums.aws.amazon.com/forum.jspa?forumID=92" /><meta name="feedback" content="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=CloudFormation&amp;topic_url=https://docs.aws.amazon.com/zh_cn/AWSCloudFormation/latest/UserGuide/quickref-cloudwatchlogs.html" /><meta name="feedback-yes" content="feedbackyes.html?topic_url=https://docs.aws.amazon.com/zh_cn/AWSCloudFormation/latest/UserGuide/quickref-cloudwatchlogs.html" /><meta name="feedback-no" content="feedbackno.html?topic_url=https://docs.aws.amazon.com/zh_cn/AWSCloudFormation/latest/UserGuide/quickref-cloudwatchlogs.html" /><meta name="keywords" content="CloudFormation,AWSCloudFormation,资源预置,资源配置,基础设施管理,CloudFormer,CloudFormation 堆栈,CloudFormation 堆栈集,CloudFormation 模板,更改集" /><script type="application/ld+json">
{
    "@context" : "https://schema.org",
    "@type" : "BreadcrumbList",
    "itemListElement" : [
      {
        "@type" : "ListItem",
        "position" : 1,
        "name" : "AWS",
        "item" : "https://aws.amazon.com"
      },
      {
        "@type" : "ListItem",
        "position" : 2,
        "name" : "AWS CloudFormation",
        "item" : "https://docs.aws.amazon.com/cloudformation/index.html"
      },
      {
        "@type" : "ListItem",
        "position" : 3,
        "name" : "用户指南",
        "item" : "https://docs.aws.amazon.com/zh_cn/AWSCloudFormation/latest/UserGuide"
      },
      {
        "@type" : "ListItem",
        "position" : 4,
        "name" : "使用 AWS CloudFormation 模板",
        "item" : "https://docs.aws.amazon.com/zh_cn/AWSCloudFormation/latest/UserGuide/template-guide.html"
      },
      {
        "@type" : "ListItem",
        "position" : 5,
        "name" : "模板代码段",
        "item" : "https://docs.aws.amazon.com/zh_cn/AWSCloudFormation/latest/UserGuide/CHAP_TemplateQuickRef.html"
      },
      {
        "@type" : "ListItem",
        "position" : 6,
        "name" : "Amazon CloudWatch Logs 模板代码段",
        "item" : "https://docs.aws.amazon.com/zh_cn/AWSCloudFormation/latest/UserGuide/CHAP_TemplateQuickRef.html"
      }
    ]
}
</script></head><body><div id="main"><div style="display: none"></div><div id="breadcrumbs" class="breadcrumb"><a href="https://aws.amazon.com">AWS</a><a href="/index.html">文档</a><a href="/cloudformation/index.html">AWS CloudFormation</a><a href="Welcome.html">用户指南</a></div><div id="page-toc-src"><a href="#quickref-cloudwatchlogs-example1">从 Linux 实例将日志发送到 CloudWatch Logs</a><a href="#quickref-cloudwatchlogs-example2">从 Windows 实例将日志发送到 CloudWatch Logs</a><a href="#w9aac23c21c35c11">另请参阅</a></div><div id="page-filters" style="display:none"><filter label="All" id="All"></filter><filter label="JSON" id="JSON"></filter><filter label="YAML" id="YAML"></filter></div><div id="main-content" class="awsui-util-container"><div id="main-col-body"><awsdocs-language-banner data-service="$ctrl.pageService"></awsdocs-language-banner><h1 class="topictitle" id="quickref-cloudwatchlogs">Amazon CloudWatch Logs 模板代码段</h1><div class="awsdocs-page-header-container"><awsdocs-page-header></awsdocs-page-header><awsdocs-filter-selector id="awsdocs-filter-selector"></awsdocs-filter-selector></div><p>Amazon CloudWatch Logs 能够监控系统、应用程序和来自 Amazon EC2 实例或其他源的自定义日志文件。您可以使用 AWS CloudFormation 配置和管理日志组和指标筛选条件。有关 Amazon CloudWatch Logs 入门的更多信息，请参阅《Amazon CloudWatch 用户指南》中的<a href="https://docs.aws.amazon.com/AmazonCloudWatch/latest/DeveloperGuide/WhatIsCloudWatchLogs.html">监控系统、应用程序和自定义日志文件</a>。</p><div class="highlights" id="inline-topiclist"><h6>主题</h6><ul><li><a href="#quickref-cloudwatchlogs-example1">从 Linux 实例将日志发送到 CloudWatch Logs</a></li><li><a href="#quickref-cloudwatchlogs-example2">从 Windows 实例将日志发送到 CloudWatch Logs</a></li><li><a href="#w9aac23c21c35c11">另请参阅</a></li></ul></div>
        <h2 id="quickref-cloudwatchlogs-example1">从 Linux 实例将日志发送到 CloudWatch Logs</h2>

        <p>下面的模板描述了一个 Web 服务器及其自定义指标。来自该 Web 服务器日志的日志事件为自定义指标提供了数据。为了将日志事件发送到自定义指标，<code class="code">UserData</code> 字段在 Amazon EC2 实例上安装一个 CloudWatch Logs 代理。该代理的配置信息 (如服务器日志文件的位置、日志组名称和日志流名称) 在 <code>/tmp/cwlogs/apacheaccess.conf</code> 文件中定义。在 Web 服务器向 <code>/var/log/httpd/access_log</code> 文件发送日志事件后，将创建日志流。</p>
        <div class="awsdocs-note"><div class="awsdocs-note-title"><awsui-icon name="status-info" variant="link"></awsui-icon><h6>注意</h6></div><div class="awsdocs-note-text"><p>有关权限的说明：<code class="code">WebServerHost</code> 实例引用 <code class="code">LogRoleInstanceProfile</code> 实例配置文件，后者又引用 <code class="code">LogRole</code> 角色。<code class="code">LogRole</code> 为 <em>arn:aws:s3:::*</em> 指定 <code class="code">s3:GetObject</code> 权限。</p><p>该权限是必需的，因为 <code class="code">WebServerHost</code> 从 <code class="code">UserData</code> 部分中的 Amazon S3 下载 CloudWatch Logs 代理 (<code>awslogs-agent-setup.py</code>)。</p></div></div>
        <p>两个指标筛选条件描述了将日志信息转换成 CloudWatch 指标的方法。404 指标用于统计出现 404 错误的次数。大小指标用于跟踪请求的大小。如果两分钟内出现两次以上的 404 错误，或平均请求大小在高于 3500 KB 的情况下持续 10 分钟，这两个 CloudWatch 警报将发送通知。</p>
        <div id="JSON" name="JSON" class="section langfilter">
            <h3 id="quickref-cloudwatchlogs-example.json">JSON</h3>

            <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="复制"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>&#xD;
    "AWSTemplateFormatVersion": "2010-09-09",&#xD;
    "Description": "AWS CloudFormation Sample Template for CloudWatch Logs.",&#xD;
    "Parameters": <span>{</span>&#xD;
        "KeyName": <span>{</span>&#xD;
            "Description": "Name of an existing EC2 KeyPair to enable SSH access to the instances",&#xD;
            "Type": "AWS::EC2::KeyPair::KeyName",&#xD;
            "ConstraintDescription": "must be the name of an existing EC2 KeyPair."&#xD;
        },&#xD;
        "SSHLocation": <span>{</span>&#xD;
            "Description": "The IP address range that can be used to SSH to the EC2 instances",&#xD;
            "Type": "String",&#xD;
            "MinLength": "9",&#xD;
            "MaxLength": "18",&#xD;
            "Default": "0.0.0.0/0",&#xD;
            "AllowedPattern": "(\\d<span>{</span>1,3})\\.(\\d<span>{</span>1,3})\\.(\\d<span>{</span>1,3})\\.(\\d<span>{</span>1,3})/(\\d<span>{</span>1,2})",&#xD;
            "ConstraintDescription": "must be a valid IP CIDR range of the form x.x.x.x/x."&#xD;
        },&#xD;
        "OperatorEmail": <span>{</span>&#xD;
            "Description": "Email address to notify if there are any scaling operations",&#xD;
            "Type": "String"&#xD;
        }&#xD;
    },&#xD;
    "Mappings": <span>{</span>&#xD;
        "RegionMap": <span>{</span>&#xD;
            "us-east-1": <span>{</span>&#xD;
                "AMI": "ami-0ff8a91507f77f867"&#xD;
            },&#xD;
            "us-west-1": <span>{</span>&#xD;
                "AMI": "ami-0bdb828fd58c52235"&#xD;
            },&#xD;
            "us-west-2": <span>{</span>&#xD;
                "AMI": "ami-a0cfeed8"&#xD;
            },&#xD;
            "eu-west-1": <span>{</span>&#xD;
                "AMI": "ami-047bb4163c506cd98"&#xD;
            },&#xD;
            "ap-southeast-1": <span>{</span>&#xD;
                "AMI": "ami-08569b978cc4dfa10"&#xD;
            },&#xD;
            "ap-southeast-2": <span>{</span>&#xD;
                "AMI": "ami-09b42976632b27e9b"&#xD;
            },&#xD;
            "ap-northeast-1": <span>{</span>&#xD;
                "AMI": "ami-06cd52961ce9f0d85"&#xD;
            },&#xD;
            "sa-east-1": <span>{</span>&#xD;
                "AMI": "ami-07b14488da8ea02a0"&#xD;
            },&#xD;
            "eu-central-1": <span>{</span>&#xD;
                "AMI": "ami-0233214e13e500f77"&#xD;
            }&#xD;
        }&#xD;
    },&#xD;
    "Resources": <span>{</span>&#xD;
        "LogRole": <span>{</span>&#xD;
            "Type": "AWS::IAM::Role",&#xD;
            "Properties": <span>{</span>&#xD;
                "AssumeRolePolicyDocument": <span>{</span>&#xD;
                    "Version": "2012-10-17",&#xD;
                    "Statement": [&#xD;
                        <span>{</span>&#xD;
                            "Effect": "Allow",&#xD;
                            "Principal": <span>{</span>&#xD;
                                "Service": [&#xD;
                                    "ec2.amazonaws.com"&#xD;
                                ]&#xD;
                            },&#xD;
                            "Action": [&#xD;
                                "sts:AssumeRole"&#xD;
                            ]&#xD;
                        }&#xD;
                    ]&#xD;
                },&#xD;
                "Path": "/",&#xD;
                "Policies": [&#xD;
                    <span>{</span>&#xD;
                        "PolicyName": "LogRolePolicy",&#xD;
                        "PolicyDocument": <span>{</span>&#xD;
                            "Version": "2012-10-17",&#xD;
                            "Statement": [&#xD;
                                <span>{</span>&#xD;
                                    "Effect": "Allow",&#xD;
                                    "Action": [&#xD;
                                        "logs:Create*",&#xD;
                                        "logs:PutLogEvents",&#xD;
                                        "s3:GetObject"&#xD;
                                    ],&#xD;
                                    "Resource": [&#xD;
                                        "arn:aws:logs:*:*:*",&#xD;
                                        "arn:aws:s3:::*"&#xD;
                                    ]&#xD;
                                }&#xD;
                            ]&#xD;
                        }&#xD;
                    }&#xD;
                ]&#xD;
            }&#xD;
        },&#xD;
        "LogRoleInstanceProfile": <span>{</span>&#xD;
            "Type": "AWS::IAM::InstanceProfile",&#xD;
            "Properties": <span>{</span>&#xD;
                "Path": "/",&#xD;
                "Roles": [&#xD;
                    <span>{</span>&#xD;
                        "Ref": "LogRole"&#xD;
                    }&#xD;
                ]&#xD;
            }&#xD;
        },&#xD;
        "WebServerSecurityGroup": <span>{</span>&#xD;
            "Type": "AWS::EC2::SecurityGroup",&#xD;
            "Properties": <span>{</span>&#xD;
                "GroupDescription": "Enable HTTP access via port 80 and SSH access via port 22",&#xD;
                "SecurityGroupIngress": [&#xD;
                    <span>{</span>&#xD;
                        "IpProtocol": "tcp",&#xD;
                        "FromPort": 80,&#xD;
                        "ToPort": 80,&#xD;
                        "CidrIp": "0.0.0.0/0"&#xD;
                    },&#xD;
                    <span>{</span>&#xD;
                        "IpProtocol": "tcp",&#xD;
                        "FromPort": 22,&#xD;
                        "ToPort": 22,&#xD;
                        "CidrIp": <span>{</span>&#xD;
                            "Ref": "SSHLocation"&#xD;
                        }&#xD;
                    }&#xD;
                ]&#xD;
            }&#xD;
        },&#xD;
        "WebServerHost": <span>{</span>&#xD;
            "Type": "AWS::EC2::Instance",&#xD;
            "Metadata": <span>{</span>&#xD;
                "Comment": "Install a simple PHP application",&#xD;
                "AWS::CloudFormation::Init": <span>{</span>&#xD;
                    "config": <span>{</span>&#xD;
                        "packages": <span>{</span>&#xD;
                            "yum": <span>{</span>&#xD;
                                "httpd": [],&#xD;
                                "php": []&#xD;
                            }&#xD;
                        },&#xD;
                        "files": <span>{</span>&#xD;
                            "/tmp/cwlogs/apacheaccess.conf": <span>{</span>&#xD;
                                "content": <span>{</span>&#xD;
                                    "Fn::Join": [&#xD;
                                        "",&#xD;
                                        [&#xD;
                                            "[general]\n",&#xD;
                                            "state_file= /var/awslogs/agent-state\n",&#xD;
                                            "[/var/log/httpd/access_log]\n",&#xD;
                                            "file = /var/log/httpd/access_log\n",&#xD;
                                            "log_group_name = ",&#xD;
                                            <span>{</span>&#xD;
                                                "Ref": "WebServerLogGroup"&#xD;
                                            },&#xD;
                                            "\n",&#xD;
                                            "log_stream_name = <span>{</span>instance_id}/apache.log\n",&#xD;
                                            "datetime_format = %d/%b/%Y:%H:%M:%S"&#xD;
                                        ]&#xD;
                                    ]&#xD;
                                },&#xD;
                                "mode": "000400",&#xD;
                                "owner": "apache",&#xD;
                                "group": "apache"&#xD;
                            },&#xD;
                            "/var/www/html/index.php": <span>{</span>&#xD;
                                "content": <span>{</span>&#xD;
                                    "Fn::Join": [&#xD;
                                        "",&#xD;
                                        [&#xD;
                                            "&lt;?php\n",&#xD;
                                            "echo '&lt;h1&gt;AWS CloudFormation sample PHP application&lt;/h1&gt;';\n",&#xD;
                                            "?&gt;\n"&#xD;
                                        ]&#xD;
                                    ]&#xD;
                                },&#xD;
                                "mode": "000644",&#xD;
                                "owner": "apache",&#xD;
                                "group": "apache"&#xD;
                            },&#xD;
                            "/etc/cfn/cfn-hup.conf": <span>{</span>&#xD;
                                "content": <span>{</span>&#xD;
                                    "Fn::Join": [&#xD;
                                        "",&#xD;
                                        [&#xD;
                                            "[main]\n",&#xD;
                                            "stack=",&#xD;
                                            <span>{</span>&#xD;
                                                "Ref": "AWS::StackId"&#xD;
                                            },&#xD;
                                            "\n",&#xD;
                                            "region=",&#xD;
                                            <span>{</span>&#xD;
                                                "Ref": "AWS::Region"&#xD;
                                            },&#xD;
                                            "\n"&#xD;
                                        ]&#xD;
                                    ]&#xD;
                                },&#xD;
                                "mode": "000400",&#xD;
                                "owner": "root",&#xD;
                                "group": "root"&#xD;
                            },&#xD;
                            "/etc/cfn/hooks.d/cfn-auto-reloader.conf": <span>{</span>&#xD;
                                "content": <span>{</span>&#xD;
                                    "Fn::Join": [&#xD;
                                        "",&#xD;
                                        [&#xD;
                                            "[cfn-auto-reloader-hook]\n",&#xD;
                                            "triggers=post.update\n",&#xD;
                                            "path=Resources.WebServerHost.Metadata.AWS::CloudFormation::Init\n",&#xD;
                                            "action=/opt/aws/bin/cfn-init -s ",&#xD;
                                            <span>{</span>&#xD;
                                                "Ref": "AWS::StackId"&#xD;
                                            },&#xD;
                                            " -r WebServerHost ",&#xD;
                                            " --region     ",&#xD;
                                            <span>{</span>&#xD;
                                                "Ref": "AWS::Region"&#xD;
                                            },&#xD;
                                            "\n",&#xD;
                                            "runas=root\n"&#xD;
                                        ]&#xD;
                                    ]&#xD;
                                }&#xD;
                            }&#xD;
                        },&#xD;
                        "services": <span>{</span>&#xD;
                            "sysvinit": <span>{</span>&#xD;
                                "httpd": <span>{</span>&#xD;
                                    "enabled": "true",&#xD;
                                    "ensureRunning": "true"&#xD;
                                },&#xD;
                                "sendmail": <span>{</span>&#xD;
                                    "enabled": "false",&#xD;
                                    "ensureRunning": "false"&#xD;
                                }&#xD;
                            }&#xD;
                        }&#xD;
                    }&#xD;
                }&#xD;
            },&#xD;
            "CreationPolicy": <span>{</span>&#xD;
                "ResourceSignal": <span>{</span>&#xD;
                    "Timeout": "PT5M"&#xD;
                }&#xD;
            },&#xD;
            "Properties": <span>{</span>&#xD;
                "ImageId": <span>{</span>&#xD;
                    "Fn::FindInMap": [&#xD;
                        "RegionMap",&#xD;
                        <span>{</span>&#xD;
                            "Ref": "AWS::Region"&#xD;
                        },&#xD;
                        "AMI"&#xD;
                    ]&#xD;
                },&#xD;
                "KeyName": <span>{</span>&#xD;
                    "Ref": "KeyName"&#xD;
                },&#xD;
                "InstanceType": "t1.micro",&#xD;
                "SecurityGroups": [&#xD;
                    <span>{</span>&#xD;
                        "Ref": "WebServerSecurityGroup"&#xD;
                    }&#xD;
                ],&#xD;
                "IamInstanceProfile": <span>{</span>&#xD;
                    "Ref": "LogRoleInstanceProfile"&#xD;
                },&#xD;
                "UserData": <span>{</span>&#xD;
                    "Fn::Base64": <span>{</span>&#xD;
                        "Fn::Join": [&#xD;
                            "",&#xD;
                            [&#xD;
                                "#!/bin/bash -xe\n",&#xD;
                                "# Get the latest CloudFormation package\n",&#xD;
                                "yum install -y aws-cfn-bootstrap\n",&#xD;
                                "# Start cfn-init\n",&#xD;
                                "/opt/aws/bin/cfn-init -s ",&#xD;
                                <span>{</span>&#xD;
                                    "Ref": "AWS::StackId"&#xD;
                                },&#xD;
                                " -r WebServerHost ",&#xD;
                                " --region ",&#xD;
                                <span>{</span>&#xD;
                                    "Ref": "AWS::Region"&#xD;
                                },&#xD;
                                " || error_exit 'Failed to run cfn-init'\n",&#xD;
                                "# Start up the cfn-hup daemon to listen for changes to the EC2 instance metadata\n",&#xD;
                                "/opt/aws/bin/cfn-hup || error_exit 'Failed to start cfn-hup'\n",&#xD;
                                "# Get the CloudWatch Logs agent\n",&#xD;
                                "wget https://s3.amazonaws.com/aws-cloudwatch/downloads/latest/awslogs-agent-setup.py\n",&#xD;
                                "# Install the CloudWatch Logs agent\n",&#xD;
                                "python awslogs-agent-setup.py -n -r ",&#xD;
                                <span>{</span>&#xD;
                                    "Ref": "AWS::Region"&#xD;
                                },&#xD;
                                " -c /tmp/cwlogs/apacheaccess.conf || error_exit 'Failed to run CloudWatch Logs agent setup'\n",&#xD;
                                "# All done so signal success\n",&#xD;
                                "/opt/aws/bin/cfn-signal -e $? ",&#xD;
                                "         --stack ",&#xD;
                                <span>{</span>&#xD;
                                    "Ref": "AWS::StackName"&#xD;
                                },&#xD;
                                "         --resource WebServerHost ",&#xD;
                                "         --region ",&#xD;
                                <span>{</span>&#xD;
                                    "Ref": "AWS::Region"&#xD;
                                },&#xD;
                                "\n"&#xD;
                            ]&#xD;
                        ]&#xD;
                    }&#xD;
                }&#xD;
            }&#xD;
        },&#xD;
        "WebServerLogGroup": <span>{</span>&#xD;
            "Type": "AWS::Logs::LogGroup",&#xD;
            "Properties": <span>{</span>&#xD;
                "RetentionInDays": 7&#xD;
            }&#xD;
        },&#xD;
        "404MetricFilter": <span>{</span>&#xD;
            "Type": "AWS::Logs::MetricFilter",&#xD;
            "Properties": <span>{</span>&#xD;
                "LogGroupName": <span>{</span>&#xD;
                    "Ref": "WebServerLogGroup"&#xD;
                },&#xD;
                "FilterPattern": "[ip, identity, user_id, timestamp, request, status_code = 404, size, ...]",&#xD;
                "MetricTransformations": [&#xD;
                    <span>{</span>&#xD;
                        "MetricValue": "1",&#xD;
                        "MetricNamespace": "test/404s",&#xD;
                        "MetricName": "test404Count"&#xD;
                    }&#xD;
                ]&#xD;
            }&#xD;
        },&#xD;
        "BytesTransferredMetricFilter": <span>{</span>&#xD;
            "Type": "AWS::Logs::MetricFilter",&#xD;
            "Properties": <span>{</span>&#xD;
                "LogGroupName": <span>{</span>&#xD;
                    "Ref": "WebServerLogGroup"&#xD;
                },&#xD;
                "FilterPattern": "[ip, identity, user_id, timestamp, request, status_code, size, ...]",&#xD;
                "MetricTransformations": [&#xD;
                    <span>{</span>&#xD;
                        "MetricValue": "$size",&#xD;
                        "MetricNamespace": "test/BytesTransferred",&#xD;
                        "MetricName": "testBytesTransferred"&#xD;
                    }&#xD;
                ]&#xD;
            }&#xD;
        },&#xD;
        "404Alarm": <span>{</span>&#xD;
            "Type": "AWS::CloudWatch::Alarm",&#xD;
            "Properties": <span>{</span>&#xD;
                "AlarmDescription": "The number of 404s is greater than 2 over 2 minutes",&#xD;
                "MetricName": "test404Count",&#xD;
                "Namespace": "test/404s",&#xD;
                "Statistic": "Sum",&#xD;
                "Period": "60",&#xD;
                "EvaluationPeriods": "2",&#xD;
                "Threshold": "2",&#xD;
                "AlarmActions": [&#xD;
                    <span>{</span>&#xD;
                        "Ref": "AlarmNotificationTopic"&#xD;
                    }&#xD;
                ],&#xD;
                "ComparisonOperator": "GreaterThanThreshold"&#xD;
            }&#xD;
        },&#xD;
        "BandwidthAlarm": <span>{</span>&#xD;
            "Type": "AWS::CloudWatch::Alarm",&#xD;
            "Properties": <span>{</span>&#xD;
                "AlarmDescription": "The average volume of traffic is greater 3500 KB over 10 minutes",&#xD;
                "MetricName": "testBytesTransferred",&#xD;
                "Namespace": "test/BytesTransferred",&#xD;
                "Statistic": "Average",&#xD;
                "Period": "300",&#xD;
                "EvaluationPeriods": "2",&#xD;
                "Threshold": "3500",&#xD;
                "AlarmActions": [&#xD;
                    <span>{</span>&#xD;
                        "Ref": "AlarmNotificationTopic"&#xD;
                    }&#xD;
                ],&#xD;
                "ComparisonOperator": "GreaterThanThreshold"&#xD;
            }&#xD;
        },&#xD;
        "AlarmNotificationTopic": <span>{</span>&#xD;
            "Type": "AWS::SNS::Topic",&#xD;
            "Properties": <span>{</span>&#xD;
                "Subscription": [&#xD;
                    <span>{</span>&#xD;
                        "Endpoint": <span>{</span>&#xD;
                            "Ref": "OperatorEmail"&#xD;
                        },&#xD;
                        "Protocol": "email"&#xD;
                    }&#xD;
                ]&#xD;
            }&#xD;
        }&#xD;
    },&#xD;
    "Outputs": <span>{</span>&#xD;
        "InstanceId": <span>{</span>&#xD;
            "Description": "The instance ID of the web server",&#xD;
            "Value": <span>{</span>&#xD;
                "Ref": "WebServerHost"&#xD;
            }&#xD;
        },&#xD;
        "WebsiteURL": <span>{</span>&#xD;
            "Value": <span>{</span>&#xD;
                "Fn::Join": [&#xD;
                    "",&#xD;
                    [&#xD;
                        "http://",&#xD;
                        <span>{</span>&#xD;
                            "Fn::GetAtt": [&#xD;
                                "WebServerHost",&#xD;
                                "PublicDnsName"&#xD;
                            ]&#xD;
                        }&#xD;
                    ]&#xD;
                ]&#xD;
            },&#xD;
            "Description": "URL for newly created LAMP stack"&#xD;
        },&#xD;
        "PublicIP": <span>{</span>&#xD;
            "Description": "Public IP address of the web server",&#xD;
            "Value": <span>{</span>&#xD;
                "Fn::GetAtt": [&#xD;
                    "WebServerHost",&#xD;
                    "PublicIp"&#xD;
                ]&#xD;
            }&#xD;
        },&#xD;
        "CloudWatchLogGroupName": <span>{</span>&#xD;
            "Description": "The name of the CloudWatch log group",&#xD;
            "Value": <span>{</span>&#xD;
                "Ref": "WebServerLogGroup"&#xD;
            }&#xD;
        }&#xD;
    }&#xD;
}</code></pre>
        </div>
        <div id="YAML" name="YAML" class="section langfilter">
            <h3 id="quickref-cloudwatchlogs-example.yaml">YAML</h3>

            <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="复制"><awsui-icon name="copy"></awsui-icon></div></div><code class="yaml ">AWSTemplateFormatVersion: 2010-09-09&#xD;
Description: AWS CloudFormation Sample Template for CloudWatch Logs.&#xD;
Parameters:&#xD;
  KeyName:&#xD;
    Description: Name of an existing EC2 KeyPair to enable SSH access to the instances&#xD;
    Type: 'AWS::EC2::KeyPair::KeyName'&#xD;
    ConstraintDescription: must be the name of an existing EC2 KeyPair.&#xD;
  SSHLocation:&#xD;
    Description: The IP address range that can be used to SSH to the EC2 instances&#xD;
    Type: String&#xD;
    MinLength: '9'&#xD;
    MaxLength: '18'&#xD;
    Default: 0.0.0.0/0&#xD;
    AllowedPattern: '(\d<span>{</span>1,3})\.(\d<span>{</span>1,3})\.(\d<span>{</span>1,3})\.(\d<span>{</span>1,3})/(\d<span>{</span>1,2})'&#xD;
    ConstraintDescription: must be a valid IP CIDR range of the form x.x.x.x/x.&#xD;
  OperatorEmail:&#xD;
    Description: Email address to notify if there are any scaling operations&#xD;
    Type: String&#xD;
Mappings:&#xD;
  RegionMap:&#xD;
    us-east-1:&#xD;
      AMI: ami-0ff8a91507f77f867&#xD;
    us-west-1:&#xD;
      AMI: ami-0bdb828fd58c52235&#xD;
    us-west-2:&#xD;
      AMI: ami-a0cfeed8&#xD;
    eu-west-1:&#xD;
      AMI: ami-047bb4163c506cd98&#xD;
    ap-southeast-1:&#xD;
      AMI: ami-08569b978cc4dfa10&#xD;
    ap-southeast-2:&#xD;
      AMI: ami-09b42976632b27e9b&#xD;
    ap-northeast-1:&#xD;
      AMI: ami-06cd52961ce9f0d85&#xD;
    sa-east-1:&#xD;
      AMI: ami-07b14488da8ea02a0&#xD;
    eu-central-1:&#xD;
      AMI: ami-0233214e13e500f77&#xD;
Resources:&#xD;
  LogRole:&#xD;
    Type: 'AWS::IAM::Role'&#xD;
    Properties:&#xD;
      AssumeRolePolicyDocument:&#xD;
        Version: 2012-10-17&#xD;
        Statement:&#xD;
          - Effect: Allow&#xD;
            Principal:&#xD;
              Service:&#xD;
                - ec2.amazonaws.com&#xD;
            Action:&#xD;
              - 'sts:AssumeRole'&#xD;
      Path: /&#xD;
      Policies:&#xD;
        - PolicyName: LogRolePolicy&#xD;
          PolicyDocument:&#xD;
            Version: 2012-10-17&#xD;
            Statement:&#xD;
              - Effect: Allow&#xD;
                Action:&#xD;
                  - 'logs:Create*'&#xD;
                  - 'logs:PutLogEvents'&#xD;
                  - 's3:GetObject'&#xD;
                Resource:&#xD;
                  - 'arn:aws:logs:*:*:*'&#xD;
                  - 'arn:aws:s3:::*'&#xD;
  LogRoleInstanceProfile:&#xD;
    Type: 'AWS::IAM::InstanceProfile'&#xD;
    Properties:&#xD;
      Path: /&#xD;
      Roles:&#xD;
        - !Ref LogRole&#xD;
  WebServerSecurityGroup:&#xD;
    Type: 'AWS::EC2::SecurityGroup'&#xD;
    Properties:&#xD;
      GroupDescription: Enable HTTP access via port 80 and SSH access via port 22&#xD;
      SecurityGroupIngress:&#xD;
        - IpProtocol: tcp&#xD;
          FromPort: 80&#xD;
          ToPort: 80&#xD;
          CidrIp: 0.0.0.0/0&#xD;
        - IpProtocol: tcp&#xD;
          FromPort: 22&#xD;
          ToPort: 22&#xD;
          CidrIp: !Ref SSHLocation&#xD;
  WebServerHost:&#xD;
    Type: 'AWS::EC2::Instance'&#xD;
    Metadata:&#xD;
      Comment: Install a simple PHP application&#xD;
      'AWS::CloudFormation::Init':&#xD;
        config:&#xD;
          packages:&#xD;
            yum:&#xD;
              httpd: []&#xD;
              php: []&#xD;
          files:&#xD;
            /tmp/cwlogs/apacheaccess.conf:&#xD;
              content: !Join &#xD;
                - ''&#xD;
                - - |&#xD;
                    [general]&#xD;
                  - |&#xD;
                    state_file= /var/awslogs/agent-state&#xD;
                  - |&#xD;
                    [/var/log/httpd/access_log]&#xD;
                  - |&#xD;
                    file = /var/log/httpd/access_log&#xD;
                  - 'log_group_name = '&#xD;
                  - !Ref WebServerLogGroup&#xD;
                  - |+&#xD;
&#xD;
                  - |&#xD;
                    log_stream_name = <span>{</span>instance_id}/apache.log&#xD;
                  - 'datetime_format = %d/%b/%Y:%H:%M:%S'&#xD;
              mode: '000400'&#xD;
              owner: apache&#xD;
              group: apache&#xD;
            /var/www/html/index.php:&#xD;
              content: !Join &#xD;
                - ''&#xD;
                - - |&#xD;
                    &lt;?php&#xD;
                  - |&#xD;
                    echo '&lt;h1&gt;AWS CloudFormation sample PHP application&lt;/h1&gt;';&#xD;
                  - |&#xD;
                    ?&gt;&#xD;
              mode: '000644'&#xD;
              owner: apache&#xD;
              group: apache&#xD;
            /etc/cfn/cfn-hup.conf:&#xD;
              content: !Join &#xD;
                - ''&#xD;
                - - |&#xD;
                    [main]&#xD;
                  - stack=&#xD;
                  - !Ref 'AWS::StackId'&#xD;
                  - |+&#xD;
&#xD;
                  - region=&#xD;
                  - !Ref 'AWS::Region'&#xD;
                  - |+&#xD;
&#xD;
              mode: '000400'&#xD;
              owner: root&#xD;
              group: root&#xD;
            /etc/cfn/hooks.d/cfn-auto-reloader.conf:&#xD;
              content: !Join &#xD;
                - ''&#xD;
                - - |&#xD;
                    [cfn-auto-reloader-hook]&#xD;
                  - |&#xD;
                    triggers=post.update&#xD;
                  - &gt;&#xD;
                    path=Resources.WebServerHost.Metadata.AWS::CloudFormation::Init&#xD;
                  - 'action=/opt/aws/bin/cfn-init -s '&#xD;
                  - !Ref 'AWS::StackId'&#xD;
                  - ' -r WebServerHost '&#xD;
                  - ' --region     '&#xD;
                  - !Ref 'AWS::Region'&#xD;
                  - |+&#xD;
&#xD;
                  - |&#xD;
                    runas=root&#xD;
          services:&#xD;
            sysvinit:&#xD;
              httpd:&#xD;
                enabled: 'true'&#xD;
                ensureRunning: 'true'&#xD;
              sendmail:&#xD;
                enabled: 'false'&#xD;
                ensureRunning: 'false'&#xD;
    CreationPolicy:&#xD;
      ResourceSignal:&#xD;
        Timeout: PT5M&#xD;
    Properties:&#xD;
      ImageId: !FindInMap &#xD;
        - RegionMap&#xD;
        - !Ref 'AWS::Region'&#xD;
        - AMI&#xD;
      KeyName: !Ref KeyName&#xD;
      InstanceType: t1.micro&#xD;
      SecurityGroups:&#xD;
        - !Ref WebServerSecurityGroup&#xD;
      IamInstanceProfile: !Ref LogRoleInstanceProfile&#xD;
      UserData: !Base64 &#xD;
        'Fn::Join':&#xD;
          - ''&#xD;
          - - |&#xD;
              #!/bin/bash -xe&#xD;
            - |&#xD;
              # Get the latest CloudFormation package&#xD;
            - |&#xD;
              yum install -y aws-cfn-bootstrap&#xD;
            - |&#xD;
              # Start cfn-init&#xD;
            - '/opt/aws/bin/cfn-init -s '&#xD;
            - !Ref 'AWS::StackId'&#xD;
            - ' -r WebServerHost '&#xD;
            - ' --region '&#xD;
            - !Ref 'AWS::Region'&#xD;
            - |2&#xD;
               || error_exit 'Failed to run cfn-init'&#xD;
            - &gt;&#xD;
              # Start up the cfn-hup daemon to listen for changes to the EC2&#xD;
              instance metadata&#xD;
            - |&#xD;
              /opt/aws/bin/cfn-hup || error_exit 'Failed to start cfn-hup'&#xD;
            - |&#xD;
              # Get the CloudWatch Logs agent&#xD;
            - &gt;&#xD;
              wget&#xD;
              https://s3.amazonaws.com/aws-cloudwatch/downloads/latest/awslogs-agent-setup.py&#xD;
            - |&#xD;
              # Install the CloudWatch Logs agent&#xD;
            - 'python awslogs-agent-setup.py -n -r '&#xD;
            - !Ref 'AWS::Region'&#xD;
            - |2&#xD;
               -c /tmp/cwlogs/apacheaccess.conf || error_exit 'Failed to run CloudWatch Logs agent setup'&#xD;
            - |&#xD;
              # All done so signal success&#xD;
            - '/opt/aws/bin/cfn-signal -e $? '&#xD;
            - '         --stack '&#xD;
            - !Ref 'AWS::StackName'&#xD;
            - '         --resource WebServerHost '&#xD;
            - '         --region '&#xD;
            - !Ref 'AWS::Region'&#xD;
            - |+&#xD;
&#xD;
  WebServerLogGroup:&#xD;
    Type: 'AWS::Logs::LogGroup'&#xD;
    Properties:&#xD;
      RetentionInDays: 7&#xD;
  404MetricFilter:&#xD;
    Type: 'AWS::Logs::MetricFilter'&#xD;
    Properties:&#xD;
      LogGroupName: !Ref WebServerLogGroup&#xD;
      FilterPattern: &gt;-&#xD;
        [ip, identity, user_id, timestamp, request, status_code = 404, size,&#xD;
        ...]&#xD;
      MetricTransformations:&#xD;
        - MetricValue: '1'&#xD;
          MetricNamespace: test/404s&#xD;
          MetricName: test404Count&#xD;
  BytesTransferredMetricFilter:&#xD;
    Type: 'AWS::Logs::MetricFilter'&#xD;
    Properties:&#xD;
      LogGroupName: !Ref WebServerLogGroup&#xD;
      FilterPattern: '[ip, identity, user_id, timestamp, request, status_code, size, ...]'&#xD;
      MetricTransformations:&#xD;
        - MetricValue: $size&#xD;
          MetricNamespace: test/BytesTransferred&#xD;
          MetricName: testBytesTransferred&#xD;
  404Alarm:&#xD;
    Type: 'AWS::CloudWatch::Alarm'&#xD;
    Properties:&#xD;
      AlarmDescription: The number of 404s is greater than 2 over 2 minutes&#xD;
      MetricName: test404Count&#xD;
      Namespace: test/404s&#xD;
      Statistic: Sum&#xD;
      Period: '60'&#xD;
      EvaluationPeriods: '2'&#xD;
      Threshold: '2'&#xD;
      AlarmActions:&#xD;
        - !Ref AlarmNotificationTopic&#xD;
      ComparisonOperator: GreaterThanThreshold&#xD;
  BandwidthAlarm:&#xD;
    Type: 'AWS::CloudWatch::Alarm'&#xD;
    Properties:&#xD;
      AlarmDescription: The average volume of traffic is greater 3500 KB over 10 minutes&#xD;
      MetricName: testBytesTransferred&#xD;
      Namespace: test/BytesTransferred&#xD;
      Statistic: Average&#xD;
      Period: '300'&#xD;
      EvaluationPeriods: '2'&#xD;
      Threshold: '3500'&#xD;
      AlarmActions:&#xD;
        - !Ref AlarmNotificationTopic&#xD;
      ComparisonOperator: GreaterThanThreshold&#xD;
  AlarmNotificationTopic:&#xD;
    Type: 'AWS::SNS::Topic'&#xD;
    Properties:&#xD;
      Subscription:&#xD;
        - Endpoint: !Ref OperatorEmail&#xD;
          Protocol: email&#xD;
Outputs:&#xD;
  InstanceId:&#xD;
    Description: The instance ID of the web server&#xD;
    Value: !Ref WebServerHost&#xD;
  WebsiteURL:&#xD;
    Value: !Join &#xD;
      - ''&#xD;
      - - 'http://'&#xD;
        - !GetAtt &#xD;
          - WebServerHost&#xD;
          - PublicDnsName&#xD;
    Description: URL for newly created LAMP stack&#xD;
  PublicIP:&#xD;
    Description: Public IP address of the web server&#xD;
    Value: !GetAtt &#xD;
      - WebServerHost&#xD;
      - PublicIp&#xD;
  CloudWatchLogGroupName:&#xD;
    Description: The name of the CloudWatch log group&#xD;
    Value: !Ref WebServerLogGroup&#xD;
</code></pre>
        </div>
     
        <h2 id="quickref-cloudwatchlogs-example2">从 Windows 实例将日志发送到 CloudWatch Logs</h2>

        <p>以下模板为 Windows 2012R2 实例配置 CloudWatch Logs。</p>
        <p>Windows 上的 CloudWatch Logs 代理（Windows 2012R2 和 Windows 2016 AMI 上的 SSM 代理）仅在启动之后才会发送日志，因此不会发送启动之前生成的任何日志。针对此问题，该模板帮助确保在任何日志写入之前启动代理，方法为：</p>
        <div class="itemizedlist">
             
             
        <ul class="itemizedlist"><li class="listitem">
                <p>将代理安装程序配置为 cfn-init <code class="code">config</code> 中的第一个 <code class="code">configSets</code> 项。</p>
            </li><li class="listitem">
                <p>使用 <code class="code">waitAfterCompletion</code> 在启动代理的命令之后插入一个暂停。</p>
            </li></ul></div>
        <div id="JSON" name="JSON" class="section langfilter">
            <h3 id="quickref-cloudwatchlogs-example2.json">JSON</h3>
            <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="复制"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
    "AWSTemplateFormatVersion": "2010-09-09",
    "Description": "Sample template that sets up and configures CloudWatch logs on Windows 2012R2 instance instance.",
    "Parameters": <span>{</span>
        "KeyPair": <span>{</span>
            "Description": "Name of an existing EC2 KeyPair to enable RDP access to the instances",
            "Type": "AWS::EC2::KeyPair::KeyName",
            "ConstraintDescription": "must be the name of an existing EC2 KeyPair."
        },
        "RDPLocation": <span>{</span>
            "Description": "The IP address range that can be used to RDP to the EC2 instances",
            "Type": "String",
            "MinLength": "9",
            "MaxLength": "18",
            "Default": "0.0.0.0/0",
            "AllowedPattern": "(\\d<span>{</span>1,3})\\.(\\d<span>{</span>1,3})\\.(\\d<span>{</span>1,3})\\.(\\d<span>{</span>1,3})/(\\d<span>{</span>1,2})",
            "ConstraintDescription": "must be a valid IP CIDR range of the form x.x.x.x/x."
        },
        "OperatorEmail": <span>{</span>
            "Description": "Email address to notify if there are any scaling operations",
            "Type": "String"
        }
    },
    "Mappings": <span>{</span>
        "AWSAMIRegionMap": <span>{</span>
            "ap-northeast-1": <span>{</span>
                "WS2012R2": "ami-09e7006451ad8bf4d"
            },
            "ap-northeast-2": <span>{</span>
                "WS2012R2": "ami-0754980e4d02153f9"
            },
            "ap-south-1": <span>{</span>
                "WS2012R2": "ami-00ad91b37d56c1d08"
            },
            "ap-southeast-1": <span>{</span>
                "WS2012R2": "ami-09e7006451ad8bf4d"
            },
            "ap-southeast-2": <span>{</span>
                "WS2012R2": "ami-000d23d3067008aea"
            },
            "ca-central-1": <span>{</span>
                "WS2012R2": "ami-0d8e70862465b9da0"
            },
            "eu-central-1": <span>{</span>
                "WS2012R2": "ami-0c0f322f5676ba254"
            },
            "eu-west-1": <span>{</span>
                "WS2012R2": "ami-0a46adf18f8875ad6"
            },
            "eu-west-2": <span>{</span>
                "WS2012R2": "ami-0651428174d9438e9"
            },
            "sa-east-1": <span>{</span>
                "WS2012R2": "ami-08ebd138109a6c223"
            },
            "us-east-1": <span>{</span>
                "WS2012R2": "ami-0ef6fb504535468b2"
            },
            "us-east-2": <span>{</span>
                "WS2012R2": "ami-0f466c6044f510bd3"
            },
            "us-west-1": <span>{</span>
                "WS2012R2": "ami-026f68ef6465e6c09"
            },
            "us-west-2": <span>{</span>
                "WS2012R2": "ami-0274ca53943a86543"
            }
        }
    },
    "Resources": <span>{</span>
        "WebServerSecurityGroup": <span>{</span>
            "Type": "AWS::EC2::SecurityGroup",
            "Properties": <span>{</span>
                "GroupDescription": "Enable HTTP access via port 80 and RDP access via port 3389",
                "SecurityGroupIngress": [
                    <span>{</span>
                        "IpProtocol": "tcp",
                        "FromPort": "80",
                        "ToPort": "80",
                        "CidrIp": "0.0.0.0/0"
                    },
                    <span>{</span>
                        "IpProtocol": "tcp",
                        "FromPort": "3389",
                        "ToPort": "3389",
                        "CidrIp": <span>{</span>
                            "Ref": "RDPLocation"
                        }
                    }
                ]
            }
        },
        "LogRole": <span>{</span>
            "Type": "AWS::IAM::Role",
            "Properties": <span>{</span>
                "AssumeRolePolicyDocument": <span>{</span>
                    "Version": "2012-10-17",
                    "Statement": [
                        <span>{</span>
                            "Effect": "Allow",
                            "Principal": <span>{</span>
                                "Service": [
                                    "ec2.amazonaws.com"
                                ]
                            },
                            "Action": [
                                "sts:AssumeRole"
                            ]
                        }
                    ]
                },
                "ManagedPolicyArns": [
                    "arn:aws:iam::aws:policy/AmazonSSMManagedInstanceCore"
                ],
                "Path": "/",
                "Policies": [
                    <span>{</span>
                        "PolicyName": "LogRolePolicy",
                        "PolicyDocument": <span>{</span>
                            "Version": "2012-10-17",
                            "Statement": [
                                <span>{</span>
                                    "Effect": "Allow",
                                    "Action": [
                                        "logs:Create*",
                                        "logs:PutLogEvents",
                                        "s3:GetObject"
                                    ],
                                    "Resource": [
                                        "arn:aws:logs:*:*:*",
                                        "arn:aws:s3:::*"
                                    ]
                                }
                            ]
                        }
                    }
                ]
            }
        },
        "LogRoleInstanceProfile": <span>{</span>
            "Type": "AWS::IAM::InstanceProfile",
            "Properties": <span>{</span>
                "Path": "/",
                "Roles": [
                    <span>{</span>
                        "Ref": "LogRole"
                    }
                ]
            }
        },
        "WebServerHost": <span>{</span>
            "Type": "AWS::EC2::Instance",
            "CreationPolicy": <span>{</span>
                "ResourceSignal": <span>{</span>
                    "Timeout": "PT15M"
                }
            },
            "Metadata": <span>{</span>
                "AWS::CloudFormation::Init": <span>{</span>
                    "configSets": <span>{</span>
                        "config": [
                            "00-ConfigureCWLogs",
                            "01-InstallWebServer",
                            "02-ConfigureApplication",
                            "03-Finalize"
                        ]
                    },
                    "00-ConfigureCWLogs": <span>{</span>
                        "files": <span>{</span>
                            "C:\\Program Files\\Amazon\\SSM\\Plugins\\awsCloudWatch\\AWS.EC2.Windows.CloudWatch.json": <span>{</span>
                                "content": <span>{</span>
                                    "Fn::Sub": "<span>{</span>\n  \"EngineConfiguration\": <span>{</span>\n      \"Components\": [\n          <span>{</span>\n              \"FullName\": \"AWS.EC2.Windows.CloudWatch.EventLog.EventLogInputComponent,AWS.EC2.Windows.CloudWatch\",\n              \"Id\": \"ApplicationEventLog\",\n              \"Parameters\": <span>{</span>\n                  \"Levels\": \"7\",\n                  \"LogName\": \"Application\"\n              }\n          },\n          <span>{</span>\n              \"FullName\": \"AWS.EC2.Windows.CloudWatch.EventLog.EventLogInputComponent,AWS.EC2.Windows.CloudWatch\",\n              \"Id\": \"SystemEventLog\",\n              \"Parameters\": <span>{</span>\n                  \"Levels\": \"7\",\n                  \"LogName\": \"System\"\n              }\n          },\n          <span>{</span>\n              \"FullName\": \"AWS.EC2.Windows.CloudWatch.EventLog.EventLogInputComponent,AWS.EC2.Windows.CloudWatch\",\n              \"Id\": \"SecurityEventLog\",\n              \"Parameters\": <span>{</span>\n                  \"Levels\": \"7\",\n                  \"LogName\": \"Security\"\n              }\n          },\n          <span>{</span>\n              \"FullName\": \"AWS.EC2.Windows.CloudWatch.CustomLog.CustomLogInputComponent,AWS.EC2.Windows.CloudWatch\",\n              \"Id\": \"EC2ConfigLog\",\n              \"Parameters\": <span>{</span>\n                  \"CultureName\": \"en-US\",\n                  \"Encoding\": \"ASCII\",\n                  \"Filter\": \"EC2ConfigLog.txt\",\n                  \"LogDirectoryPath\": \"C:\\\\Program Files\\\\Amazon\\\\Ec2ConfigService\\\\Logs\",\n                  \"TimeZoneKind\": \"UTC\",\n                  \"TimestampFormat\": \"yyyy-MM-ddTHH:mm:ss.fffZ:\"\n              }\n          },\n          <span>{</span>\n              \"FullName\": \"AWS.EC2.Windows.CloudWatch.CustomLog.CustomLogInputComponent,AWS.EC2.Windows.CloudWatch\",\n              \"Id\": \"CfnInitLog\",\n              \"Parameters\": <span>{</span>\n                  \"CultureName\": \"en-US\",\n                  \"Encoding\": \"ASCII\",\n                  \"Filter\": \"cfn-init.log\",\n                  \"LogDirectoryPath\": \"C:\\\\cfn\\\\log\",\n                  \"TimeZoneKind\": \"Local\",\n                  \"TimestampFormat\": \"yyyy-MM-dd HH:mm:ss,fff\"\n              }\n          },\n          <span>{</span>\n              \"FullName\": \"AWS.EC2.Windows.CloudWatch.CustomLog.CustomLogInputComponent,AWS.EC2.Windows.CloudWatch\",\n              \"Id\": \"IISLogs\",\n              \"Parameters\": <span>{</span>\n                  \"CultureName\": \"en-US\",\n                  \"Encoding\": \"UTF-8\",\n                  \"Filter\": \"\",\n                  \"LineCount\": \"3\",\n                  \"LogDirectoryPath\": \"C:\\\\inetpub\\\\logs\\\\LogFiles\\\\W3SVC1\",\n                  \"TimeZoneKind\": \"UTC\",\n                  \"TimestampFormat\": \"yyyy-MM-dd HH:mm:ss\"\n              }\n          },\n          <span>{</span>\n              \"FullName\": \"AWS.EC2.Windows.CloudWatch.PerformanceCounterComponent.PerformanceCounterInputComponent,AWS.EC2.Windows.CloudWatch\",\n              \"Id\": \"MemoryPerformanceCounter\",\n              \"Parameters\": <span>{</span>\n                  \"CategoryName\": \"Memory\",\n                  \"CounterName\": \"Available MBytes\",\n                  \"DimensionName\": \"\",\n                  \"DimensionValue\": \"\",\n                  \"InstanceName\": \"\",\n                  \"MetricName\": \"Memory\",\n                  \"Unit\": \"Megabytes\"\n              }\n          },\n          <span>{</span>\n              \"FullName\": \"AWS.EC2.Windows.CloudWatch.CloudWatchLogsOutput,AWS.EC2.Windows.CloudWatch\",\n              \"Id\": \"CloudWatchApplicationEventLog\",\n              \"Parameters\": <span>{</span>\n                  \"AccessKey\": \"\",\n                  \"LogGroup\": \"$<span>{</span>LogGroup}\",\n                  \"LogStream\": \"<span>{</span>instance_id}/ApplicationEventLog\",\n                  \"Region\": \"$<span>{</span>AWS::Region}\",\n                  \"SecretKey\": \"\"\n              }\n          },\n          <span>{</span>\n              \"FullName\": \"AWS.EC2.Windows.CloudWatch.CloudWatchLogsOutput,AWS.EC2.Windows.CloudWatch\",\n              \"Id\": \"CloudWatchSystemEventLog\",\n              \"Parameters\": <span>{</span>\n                  \"AccessKey\": \"\",\n                  \"LogGroup\": \"$<span>{</span>LogGroup}\",\n                  \"LogStream\": \"<span>{</span>instance_id}/SystemEventLog\",\n                  \"Region\": \"$<span>{</span>AWS::Region}\",\n                  \"SecretKey\": \"\"\n              }\n          },\n          <span>{</span>\n              \"FullName\": \"AWS.EC2.Windows.CloudWatch.CloudWatchLogsOutput,AWS.EC2.Windows.CloudWatch\",\n              \"Id\": \"CloudWatchSecurityEventLog\",\n              \"Parameters\": <span>{</span>\n                  \"AccessKey\": \"\",\n                  \"LogGroup\": \"$<span>{</span>LogGroup}\",\n                  \"LogStream\": \"<span>{</span>instance_id}/SecurityEventLog\",\n                  \"Region\": \"$<span>{</span>AWS::Region}\",\n                  \"SecretKey\": \"\"\n              }\n          },\n          <span>{</span>\n              \"FullName\": \"AWS.EC2.Windows.CloudWatch.CloudWatchLogsOutput,AWS.EC2.Windows.CloudWatch\",\n              \"Id\": \"CloudWatchEC2ConfigLog\",\n              \"Parameters\": <span>{</span>\n                  \"AccessKey\": \"\",\n                  \"LogGroup\": \"$<span>{</span>LogGroup}\",\n                  \"LogStream\": \"<span>{</span>instance_id}/EC2ConfigLog\",\n                  \"Region\": \"$<span>{</span>AWS::Region}\",\n                  \"SecretKey\": \"\"\n              }\n          },\n          <span>{</span>\n              \"FullName\": \"AWS.EC2.Windows.CloudWatch.CloudWatchLogsOutput,AWS.EC2.Windows.CloudWatch\",\n              \"Id\": \"CloudWatchCfnInitLog\",\n              \"Parameters\": <span>{</span>\n                  \"AccessKey\": \"\",\n                  \"LogGroup\": \"$<span>{</span>LogGroup}\",\n                  \"LogStream\": \"<span>{</span>instance_id}/CfnInitLog\",\n                  \"Region\": \"$<span>{</span>AWS::Region}\",\n                  \"SecretKey\": \"\"\n              }\n          },\n          <span>{</span>\n              \"FullName\": \"AWS.EC2.Windows.CloudWatch.CloudWatchLogsOutput,AWS.EC2.Windows.CloudWatch\",\n              \"Id\": \"CloudWatchIISLogs\",\n              \"Parameters\": <span>{</span>\n                  \"AccessKey\": \"\",\n                  \"LogGroup\": \"$<span>{</span>LogGroup}\",\n                  \"LogStream\": \"<span>{</span>instance_id}/IISLogs\",\n                  \"Region\": \"$<span>{</span>AWS::Region}\",\n                  \"SecretKey\": \"\"\n              }\n          },\n          <span>{</span>\n              \"FullName\": \"AWS.EC2.Windows.CloudWatch.CloudWatch.CloudWatchOutputComponent,AWS.EC2.Windows.CloudWatch\",\n              \"Id\": \"CloudWatch\",\n              \"Parameters\": <span>{</span>\n                  \"AccessKey\": \"\",\n                  \"NameSpace\": \"Windows/Default\",\n                  \"Region\": \"$<span>{</span>AWS::Region}\",\n                  \"SecretKey\": \"\"\n              }\n          }\n      ],\n      \"Flows\": <span>{</span>\n          \"Flows\": [\n              \"ApplicationEventLog,CloudWatchApplicationEventLog\",\n              \"SystemEventLog,CloudWatchSystemEventLog\",\n              \"SecurityEventLog,CloudWatchSecurityEventLog\",\n              \"EC2ConfigLog,CloudWatchEC2ConfigLog\",\n              \"CfnInitLog,CloudWatchCfnInitLog\",\n              \"IISLogs,CloudWatchIISLogs\",\n              \"MemoryPerformanceCounter,CloudWatch\"\n          ]\n      },\n      \"PollInterval\": \"00:00:05\"\n  },\n  \"IsEnabled\": true\n}\n"
                                }
                            }
                        },
                        "commands": <span>{</span>
                            "0-enableSSM": <span>{</span>
                                "command": "powershell.exe -Command \"Set-Service -Name AmazonSSMAgent -StartupType Automatic\" ",
                                "waitAfterCompletion": "0"
                            },
                            "1-restartSSM": <span>{</span>
                                "command": "powershell.exe -Command \"Restart-Service AmazonSSMAgent \"",
                                "waitAfterCompletion": "30"
                            }
                        }
                    },
                    "01-InstallWebServer": <span>{</span>
                        "commands": <span>{</span>
                            "01_install_webserver": <span>{</span>
                                "command": "powershell.exe -Command \"Install-WindowsFeature Web-Server  -IncludeAllSubFeature\"",
                                "waitAfterCompletion": "0"
                            }
                        }
                    },
                    "02-ConfigureApplication": <span>{</span>
                        "files": <span>{</span>
                            "c:\\Inetpub\\wwwroot\\index.htm": <span>{</span>
                                "content": "&lt;html&gt; &lt;head&gt; &lt;title&gt;Test Application Page&lt;/title&gt; &lt;/head&gt; &lt;body&gt; &lt;h1&gt;Congratulations !! Your IIS server is configured.&lt;/h1&gt; &lt;/body&gt; &lt;/html&gt;"
                            }
                        }
                    },
                    "03-Finalize": <span>{</span>
                        "commands": <span>{</span>
                            "00_signal_success": <span>{</span>
                                "command": <span>{</span>
                                    "Fn::Sub": "cfn-signal.exe -e 0 --resource WebServerHost --stack $<span>{</span>AWS::StackName} --region $<span>{</span>AWS::Region}"
                                },
                                "waitAfterCompletion": "0"
                            }
                        }
                    }
                }
            },
            "Properties": <span>{</span>
                "KeyName": <span>{</span>
                    "Ref": "KeyPair"
                },
                "ImageId": <span>{</span>
                    "Fn::FindInMap": [
                        "AWSAMIRegionMap",
                        <span>{</span>
                            "Ref": "AWS::Region"
                        },
                        "WS2012R2"
                    ]
                },
                "InstanceType": "t2.xlarge",
                "SecurityGroupIds": [
                    <span>{</span>
                        "Ref": "WebServerSecurityGroup"
                    }
                ],
                "IamInstanceProfile": <span>{</span>
                    "Ref": "LogRoleInstanceProfile"
                },
                "UserData": <span>{</span>
                    "Fn::Base64": <span>{</span>
                        "Fn::Sub": "&lt;script&gt;\nwmic product where \"description='Amazon SSM Agent' \" uninstall\nwmic product where \"description='aws-cfn-bootstrap' \" uninstall \nstart /wait c:\\\\Windows\\\\system32\\\\msiexec /passive /qn /i https://s3.amazonaws.com/cloudformation-examples/aws-cfn-bootstrap-win64-latest.msi\npowershell.exe -Command \"iwr https://s3.amazonaws.com/ec2-downloads-windows/SSMAgent/latest/windows_amd64/AmazonSSMAgentSetup.exe  -UseBasicParsing -OutFile C:\\\\AmazonSSMAgentSetup.exe\"\nstart /wait C:\\\\AmazonSSMAgentSetup.exe /install /quiet\ncfn-init.exe -v -c config -s $<span>{</span>AWS::StackName} --resource WebServerHost --region $<span>{</span>AWS::Region} \n&lt;/script&gt;\n"
                    }
                }
            }
        },
        "LogGroup": <span>{</span>
            "Type": "AWS::Logs::LogGroup",
            "Properties": <span>{</span>
                "RetentionInDays": 7
            }
        },
        "404MetricFilter": <span>{</span>
            "Type": "AWS::Logs::MetricFilter",
            "Properties": <span>{</span>
                "LogGroupName": <span>{</span>
                    "Ref": "LogGroup"
                },
                "FilterPattern": "[timestamps, serverip, method, uri, query, port, dash, clientip, useragent, status_code = 404, ...]",
                "MetricTransformations": [
                    <span>{</span>
                        "MetricValue": "1",
                        "MetricNamespace": "test/404s",
                        "MetricName": "test404Count"
                    }
                ]
            }
        },
        "404Alarm": <span>{</span>
            "Type": "AWS::CloudWatch::Alarm",
            "Properties": <span>{</span>
                "AlarmDescription": "The number of 404s is greater than 2 over 2 minutes",
                "MetricName": "test404Count",
                "Namespace": "test/404s",
                "Statistic": "Sum",
                "Period": "60",
                "EvaluationPeriods": "2",
                "Threshold": "2",
                "AlarmActions": [
                    <span>{</span>
                        "Ref": "AlarmNotificationTopic"
                    }
                ],
                "ComparisonOperator": "GreaterThanThreshold"
            }
        },
        "AlarmNotificationTopic": <span>{</span>
            "Type": "AWS::SNS::Topic",
            "Properties": <span>{</span>
                "Subscription": [
                    <span>{</span>
                        "Endpoint": <span>{</span>
                            "Ref": "OperatorEmail"
                        },
                        "Protocol": "email"
                    }
                ]
            }
        }
    },
    "Outputs": <span>{</span>
        "InstanceId": <span>{</span>
            "Description": "The instance ID of the web server",
            "Value": <span>{</span>
                "Ref": "WebServerHost"
            }
        },
        "WebsiteURL": <span>{</span>
            "Value": <span>{</span>
                "Fn::Sub": "http://$<span>{</span>WebServerHost.PublicDnsName}"
            },
            "Description": "URL for newly created IIS web server"
        },
        "PublicIP": <span>{</span>
            "Description": "Public IP address of the web server",
            "Value": <span>{</span>
                "Fn::GetAtt": [
                    "WebServerHost",
                    "PublicIp"
                ]
            }
        },
        "CloudWatchLogGroupName": <span>{</span>
            "Description": "The name of the CloudWatch log group",
            "Value": <span>{</span>
                "Ref": "LogGroup"
            }
        }
    }
}</code></pre>
        </div>
        <div id="YAML" name="YAML" class="section langfilter">
            <h3 id="quickref-cloudwatchlogs-example2.yaml">YAML</h3>
            <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="复制"><awsui-icon name="copy"></awsui-icon></div></div><code class="yaml ">AWSTemplateFormatVersion: 2010-09-09
Description: &gt;-
  Sample template that sets up and configures CloudWatch logs on Windows 2012R2
  instance instance.
Parameters:
  KeyPair:
    Description: Name of an existing EC2 KeyPair to enable RDP access to the instances
    Type: 'AWS::EC2::KeyPair::KeyName'
    ConstraintDescription: must be the name of an existing EC2 KeyPair.
  RDPLocation:
    Description: The IP address range that can be used to RDP to the EC2 instances
    Type: String
    MinLength: '9'
    MaxLength: '18'
    Default: 0.0.0.0/0
    AllowedPattern: '(\d<span>{</span>1,3})\.(\d<span>{</span>1,3})\.(\d<span>{</span>1,3})\.(\d<span>{</span>1,3})/(\d<span>{</span>1,2})'
    ConstraintDescription: must be a valid IP CIDR range of the form x.x.x.x/x.
  OperatorEmail:
    Description: Email address to notify if there are any scaling operations
    Type: String
Mappings:
  AWSAMIRegionMap:
    ap-northeast-1:
      WS2012R2: ami-09e7006451ad8bf4d
    ap-northeast-2:
      WS2012R2: ami-0754980e4d02153f9
    ap-south-1:
      WS2012R2: ami-00ad91b37d56c1d08
    ap-southeast-1:
      WS2012R2: ami-09e7006451ad8bf4d
    ap-southeast-2:
      WS2012R2: ami-000d23d3067008aea
    ca-central-1:
      WS2012R2: ami-0d8e70862465b9da0
    eu-central-1:
      WS2012R2: ami-0c0f322f5676ba254
    eu-west-1:
      WS2012R2: ami-0a46adf18f8875ad6
    eu-west-2:
      WS2012R2: ami-0651428174d9438e9
    sa-east-1:
      WS2012R2: ami-08ebd138109a6c223
    us-east-1:
      WS2012R2: ami-0ef6fb504535468b2
    us-east-2:
      WS2012R2: ami-0f466c6044f510bd3
    us-west-1:
      WS2012R2: ami-026f68ef6465e6c09
    us-west-2:
      WS2012R2: ami-0274ca53943a86543
Resources:
  WebServerSecurityGroup:
    Type: 'AWS::EC2::SecurityGroup'
    Properties:
      GroupDescription: Enable HTTP access via port 80 and RDP access via port 3389
      SecurityGroupIngress:
        - IpProtocol: tcp
          FromPort: '80'
          ToPort: '80'
          CidrIp: 0.0.0.0/0
        - IpProtocol: tcp
          FromPort: '3389'
          ToPort: '3389'
          CidrIp: !Ref RDPLocation
  LogRole:
    Type: 'AWS::IAM::Role'
    Properties:
      AssumeRolePolicyDocument:
        Version: 2012-10-17
        Statement:
          - Effect: Allow
            Principal:
              Service:
                - ec2.amazonaws.com
            Action:
              - 'sts:AssumeRole'
      ManagedPolicyArns:
        - 'arn:aws:iam::aws:policy/AmazonSSMManagedInstanceCore'
      Path: /
      Policies:
        - PolicyName: LogRolePolicy
          PolicyDocument:
            Version: 2012-10-17
            Statement:
              - Effect: Allow
                Action:
                  - 'logs:Create*'
                  - 'logs:PutLogEvents'
                  - 's3:GetObject'
                Resource:
                  - 'arn:aws:logs:*:*:*'
                  - 'arn:aws:s3:::*'
  LogRoleInstanceProfile:
    Type: 'AWS::IAM::InstanceProfile'
    Properties:
      Path: /
      Roles:
        - !Ref LogRole
  WebServerHost:
    Type: 'AWS::EC2::Instance'
    CreationPolicy:
      ResourceSignal:
        Timeout: PT15M
    Metadata:
      'AWS::CloudFormation::Init':
        configSets:
          config:
            - 00-ConfigureCWLogs
            - 01-InstallWebServer
            - 02-ConfigureApplication
            - 03-Finalize
        00-ConfigureCWLogs:
          files:
            'C:\Program Files\Amazon\SSM\Plugins\awsCloudWatch\AWS.EC2.Windows.CloudWatch.json':
              content: !Sub |
                <span>{</span>
                  "EngineConfiguration": <span>{</span>
                      "Components": [
                          <span>{</span>
                              "FullName": "AWS.EC2.Windows.CloudWatch.EventLog.EventLogInputComponent,AWS.EC2.Windows.CloudWatch",
                              "Id": "ApplicationEventLog",
                              "Parameters": <span>{</span>
                                  "Levels": "7",
                                  "LogName": "Application"
                              }
                          },
                          <span>{</span>
                              "FullName": "AWS.EC2.Windows.CloudWatch.EventLog.EventLogInputComponent,AWS.EC2.Windows.CloudWatch",
                              "Id": "SystemEventLog",
                              "Parameters": <span>{</span>
                                  "Levels": "7",
                                  "LogName": "System"
                              }
                          },
                          <span>{</span>
                              "FullName": "AWS.EC2.Windows.CloudWatch.EventLog.EventLogInputComponent,AWS.EC2.Windows.CloudWatch",
                              "Id": "SecurityEventLog",
                              "Parameters": <span>{</span>
                                  "Levels": "7",
                                  "LogName": "Security"
                              }
                          },
                          <span>{</span>
                              "FullName": "AWS.EC2.Windows.CloudWatch.CustomLog.CustomLogInputComponent,AWS.EC2.Windows.CloudWatch",
                              "Id": "EC2ConfigLog",
                              "Parameters": <span>{</span>
                                  "CultureName": "en-US",
                                  "Encoding": "ASCII",
                                  "Filter": "EC2ConfigLog.txt",
                                  "LogDirectoryPath": "C:\\Program Files\\Amazon\\Ec2ConfigService\\Logs",
                                  "TimeZoneKind": "UTC",
                                  "TimestampFormat": "yyyy-MM-ddTHH:mm:ss.fffZ:"
                              }
                          },
                          <span>{</span>
                              "FullName": "AWS.EC2.Windows.CloudWatch.CustomLog.CustomLogInputComponent,AWS.EC2.Windows.CloudWatch",
                              "Id": "CfnInitLog",
                              "Parameters": <span>{</span>
                                  "CultureName": "en-US",
                                  "Encoding": "ASCII",
                                  "Filter": "cfn-init.log",
                                  "LogDirectoryPath": "C:\\cfn\\log",
                                  "TimeZoneKind": "Local",
                                  "TimestampFormat": "yyyy-MM-dd HH:mm:ss,fff"
                              }
                          },
                          <span>{</span>
                              "FullName": "AWS.EC2.Windows.CloudWatch.CustomLog.CustomLogInputComponent,AWS.EC2.Windows.CloudWatch",
                              "Id": "IISLogs",
                              "Parameters": <span>{</span>
                                  "CultureName": "en-US",
                                  "Encoding": "UTF-8",
                                  "Filter": "",
                                  "LineCount": "3",
                                  "LogDirectoryPath": "C:\\inetpub\\logs\\LogFiles\\W3SVC1",
                                  "TimeZoneKind": "UTC",
                                  "TimestampFormat": "yyyy-MM-dd HH:mm:ss"
                              }
                          },
                          <span>{</span>
                              "FullName": "AWS.EC2.Windows.CloudWatch.PerformanceCounterComponent.PerformanceCounterInputComponent,AWS.EC2.Windows.CloudWatch",
                              "Id": "MemoryPerformanceCounter",
                              "Parameters": <span>{</span>
                                  "CategoryName": "Memory",
                                  "CounterName": "Available MBytes",
                                  "DimensionName": "",
                                  "DimensionValue": "",
                                  "InstanceName": "",
                                  "MetricName": "Memory",
                                  "Unit": "Megabytes"
                              }
                          },
                          <span>{</span>
                              "FullName": "AWS.EC2.Windows.CloudWatch.CloudWatchLogsOutput,AWS.EC2.Windows.CloudWatch",
                              "Id": "CloudWatchApplicationEventLog",
                              "Parameters": <span>{</span>
                                  "AccessKey": "",
                                  "LogGroup": "$<span>{</span>LogGroup}",
                                  "LogStream": "<span>{</span>instance_id}/ApplicationEventLog",
                                  "Region": "$<span>{</span>AWS::Region}",
                                  "SecretKey": ""
                              }
                          },
                          <span>{</span>
                              "FullName": "AWS.EC2.Windows.CloudWatch.CloudWatchLogsOutput,AWS.EC2.Windows.CloudWatch",
                              "Id": "CloudWatchSystemEventLog",
                              "Parameters": <span>{</span>
                                  "AccessKey": "",
                                  "LogGroup": "$<span>{</span>LogGroup}",
                                  "LogStream": "<span>{</span>instance_id}/SystemEventLog",
                                  "Region": "$<span>{</span>AWS::Region}",
                                  "SecretKey": ""
                              }
                          },
                          <span>{</span>
                              "FullName": "AWS.EC2.Windows.CloudWatch.CloudWatchLogsOutput,AWS.EC2.Windows.CloudWatch",
                              "Id": "CloudWatchSecurityEventLog",
                              "Parameters": <span>{</span>
                                  "AccessKey": "",
                                  "LogGroup": "$<span>{</span>LogGroup}",
                                  "LogStream": "<span>{</span>instance_id}/SecurityEventLog",
                                  "Region": "$<span>{</span>AWS::Region}",
                                  "SecretKey": ""
                              }
                          },
                          <span>{</span>
                              "FullName": "AWS.EC2.Windows.CloudWatch.CloudWatchLogsOutput,AWS.EC2.Windows.CloudWatch",
                              "Id": "CloudWatchEC2ConfigLog",
                              "Parameters": <span>{</span>
                                  "AccessKey": "",
                                  "LogGroup": "$<span>{</span>LogGroup}",
                                  "LogStream": "<span>{</span>instance_id}/EC2ConfigLog",
                                  "Region": "$<span>{</span>AWS::Region}",
                                  "SecretKey": ""
                              }
                          },
                          <span>{</span>
                              "FullName": "AWS.EC2.Windows.CloudWatch.CloudWatchLogsOutput,AWS.EC2.Windows.CloudWatch",
                              "Id": "CloudWatchCfnInitLog",
                              "Parameters": <span>{</span>
                                  "AccessKey": "",
                                  "LogGroup": "$<span>{</span>LogGroup}",
                                  "LogStream": "<span>{</span>instance_id}/CfnInitLog",
                                  "Region": "$<span>{</span>AWS::Region}",
                                  "SecretKey": ""
                              }
                          },
                          <span>{</span>
                              "FullName": "AWS.EC2.Windows.CloudWatch.CloudWatchLogsOutput,AWS.EC2.Windows.CloudWatch",
                              "Id": "CloudWatchIISLogs",
                              "Parameters": <span>{</span>
                                  "AccessKey": "",
                                  "LogGroup": "$<span>{</span>LogGroup}",
                                  "LogStream": "<span>{</span>instance_id}/IISLogs",
                                  "Region": "$<span>{</span>AWS::Region}",
                                  "SecretKey": ""
                              }
                          },
                          <span>{</span>
                              "FullName": "AWS.EC2.Windows.CloudWatch.CloudWatch.CloudWatchOutputComponent,AWS.EC2.Windows.CloudWatch",
                              "Id": "CloudWatch",
                              "Parameters": <span>{</span>
                                  "AccessKey": "",
                                  "NameSpace": "Windows/Default",
                                  "Region": "$<span>{</span>AWS::Region}",
                                  "SecretKey": ""
                              }
                          }
                      ],
                      "Flows": <span>{</span>
                          "Flows": [
                              "ApplicationEventLog,CloudWatchApplicationEventLog",
                              "SystemEventLog,CloudWatchSystemEventLog",
                              "SecurityEventLog,CloudWatchSecurityEventLog",
                              "EC2ConfigLog,CloudWatchEC2ConfigLog",
                              "CfnInitLog,CloudWatchCfnInitLog",
                              "IISLogs,CloudWatchIISLogs",
                              "MemoryPerformanceCounter,CloudWatch"
                          ]
                      },
                      "PollInterval": "00:00:05"
                  },
                  "IsEnabled": true
                }
          commands:
            0-enableSSM:
              command: &gt;-
                powershell.exe -Command "Set-Service -Name AmazonSSMAgent
                -StartupType Automatic" 
              waitAfterCompletion: '0'
            1-restartSSM:
              command: powershell.exe -Command "Restart-Service AmazonSSMAgent "
              waitAfterCompletion: '30'
        01-InstallWebServer:
          commands:
            01_install_webserver:
              command: &gt;-
                powershell.exe -Command "Install-WindowsFeature Web-Server 
                -IncludeAllSubFeature"
              waitAfterCompletion: '0'
        02-ConfigureApplication:
          files:
            'c:\Inetpub\wwwroot\index.htm':
              content: &gt;-
                &lt;html&gt; &lt;head&gt; &lt;title&gt;Test Application Page&lt;/title&gt; &lt;/head&gt;
                &lt;body&gt; &lt;h1&gt;Congratulations !! Your IIS server is
                configured.&lt;/h1&gt; &lt;/body&gt; &lt;/html&gt;
        03-Finalize:
          commands:
            00_signal_success:
              command: !Sub &gt;-
                cfn-signal.exe -e 0 --resource WebServerHost --stack
                $<span>{</span>AWS::StackName} --region $<span>{</span>AWS::Region}
              waitAfterCompletion: '0'
    Properties:
      KeyName: !Ref KeyPair
      ImageId: !FindInMap 
        - AWSAMIRegionMap
        - !Ref 'AWS::Region'
        - WS2012R2
      InstanceType: t2.xlarge
      SecurityGroupIds:
        - !Ref WebServerSecurityGroup
      IamInstanceProfile: !Ref LogRoleInstanceProfile
      UserData: !Base64 
        'Fn::Sub': &gt;
          &lt;script&gt;

          wmic product where "description='Amazon SSM Agent' " uninstall

          wmic product where "description='aws-cfn-bootstrap' " uninstall 

          start /wait c:\\Windows\\system32\\msiexec /passive /qn /i
          https://s3.amazonaws.com/cloudformation-examples/aws-cfn-bootstrap-win64-latest.msi

          powershell.exe -Command "iwr
          https://s3.amazonaws.com/ec2-downloads-windows/SSMAgent/latest/windows_amd64/AmazonSSMAgentSetup.exe 
          -UseBasicParsing -OutFile C:\\AmazonSSMAgentSetup.exe"

          start /wait C:\\AmazonSSMAgentSetup.exe /install /quiet

          cfn-init.exe -v -c config -s $<span>{</span>AWS::StackName} --resource
          WebServerHost --region $<span>{</span>AWS::Region} 

          &lt;/script&gt;
  LogGroup:
    Type: 'AWS::Logs::LogGroup'
    Properties:
      RetentionInDays: 7
  404MetricFilter:
    Type: 'AWS::Logs::MetricFilter'
    Properties:
      LogGroupName: !Ref LogGroup
      FilterPattern: &gt;-
        [timestamps, serverip, method, uri, query, port, dash, clientip,
        useragent, status_code = 404, ...]
      MetricTransformations:
        - MetricValue: '1'
          MetricNamespace: test/404s
          MetricName: test404Count
  404Alarm:
    Type: 'AWS::CloudWatch::Alarm'
    Properties:
      AlarmDescription: The number of 404s is greater than 2 over 2 minutes
      MetricName: test404Count
      Namespace: test/404s
      Statistic: Sum
      Period: '60'
      EvaluationPeriods: '2'
      Threshold: '2'
      AlarmActions:
        - !Ref AlarmNotificationTopic
      ComparisonOperator: GreaterThanThreshold
  AlarmNotificationTopic:
    Type: 'AWS::SNS::Topic'
    Properties:
      Subscription:
        - Endpoint: !Ref OperatorEmail
          Protocol: email
Outputs:
  InstanceId:
    Description: The instance ID of the web server
    Value: !Ref WebServerHost
  WebsiteURL:
    Value: !Sub 'http://$<span>{</span>WebServerHost.PublicDnsName}'
    Description: URL for newly created IIS web server
  PublicIP:
    Description: Public IP address of the web server
    Value: !GetAtt 
      - WebServerHost
      - PublicIp
  CloudWatchLogGroupName:
    Description: The name of the CloudWatch log group
    Value: !Ref LogGroup
</code></pre>
        </div>
     
        <h2 id="w9aac23c21c35c11">另请参阅</h2>

        <p>有关 CloudWatch Logs 资源的更多信息，请参阅 <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-resource-logs-loggroup.html">AWS::Logs::LogGroup</a> 或 <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-resource-logs-metricfilter.html">AWs::Logs::MetricFilter</a>。</p>
    <awsdocs-copyright class="copyright-print"></awsdocs-copyright><awsdocs-thumb-feedback right-edge="{{$ctrl.thumbFeedbackRightEdge}}"></awsdocs-thumb-feedback></div><noscript><div><div><div><div id="js_error_message"><p><img src="https://d1ge0kk1l5kms0.cloudfront.net/images/G/01/webservices/console/warning.png" alt="警告" /> <strong>Javascript 在您的浏览器中被禁用或不可用。</strong></p><p>要使用 Amazon Web Services 文档，必须启用 Javascript。请参阅浏览器的帮助页面以了解相关说明。</p></div></div></div></div></noscript><div id="main-col-footer" class="awsui-util-font-size-0"><div id="doc-conventions"><a target="_top" href="/general/latest/gr/docconventions.html">文档惯例</a></div><div class="prev-next"><div id="previous" class="prev-link" accesskey="p" href="./quickref-cloudwatch.html">CloudWatch</div><div id="next" class="next-link" accesskey="n" href="./quickref-dynamodb.html">DynamoDB</div></div></div><awsdocs-page-utilities></awsdocs-page-utilities></div><div id="quick-feedback-yes" style="display: none;"><div class="title">此页面对您有帮助吗？- 是</div><div class="content"><p>感谢您对我们工作的肯定！</p><p>如果不耽误您的时间，请告诉我们做得好的地方，让我们做得更好。</p><p><awsui-button id="fblink" rel="noopener noreferrer" target="_blank" text="反馈" click="linkClick($event)" href="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=CloudFormation&amp;topic_url=https://docs.aws.amazon.com/zh_cn/AWSCloudFormation/latest/UserGuide/quickref-cloudwatchlogs.html"></awsui-button></p></div></div><div id="quick-feedback-no" style="display: none;"><div class="title">此页面对您有帮助吗？- 否</div><div class="content"><p>感谢您告诉我们本页内容还需要完善。很抱歉让您失望了。</p><p>如果不耽误您的时间，请告诉我们如何改进文档。</p><p><awsui-button id="fblink" rel="noopener noreferrer" target="_blank" text="反馈" click="linkClick($event)" href="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=CloudFormation&amp;topic_url=https://docs.aws.amazon.com/zh_cn/AWSCloudFormation/latest/UserGuide/quickref-cloudwatchlogs.html"></awsui-button></p></div></div></div></body></div></awsdocs-view><div class="page-loading-indicator" id="page-loading-indicator"><awsui-spinner size="large"></awsui-spinner></div></div><div id="tools-panel" dom-region="tools"><awsdocs-tools-panel id="awsdocs-tools-panel"></awsdocs-tools-panel></div></awsui-app-layout><awsdocs-cookie-banner class="doc-cookie-banner"></awsdocs-cookie-banner></div></body></html>