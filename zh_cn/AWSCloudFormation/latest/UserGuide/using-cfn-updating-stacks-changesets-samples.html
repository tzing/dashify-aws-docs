<!DOCTYPE html>
    <html xmlns="http://www.w3.org/1999/xhtml" lang="zh-CN"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>示例更改集 - AWS CloudFormation</title><meta name="viewport" content="width=device-width,initial-scale=1" /><meta name="assets_root" content="/assets" /><meta name="target_state" content="using-cfn-updating-stacks-changesets-samples" /><meta name="default_state" content="using-cfn-updating-stacks-changesets-samples" /><link rel="icon" type="image/ico" href="/assets/images/favicon.ico" /><link rel="shortcut icon" type="image/ico" href="/assets/images/favicon.ico" /><link rel="canonical" href="https://docs.aws.amazon.com/zh_cn/AWSCloudFormation/latest/UserGuide/using-cfn-updating-stacks-changesets-samples.html" /><meta name="description" content="通过示例 AWS CloudFormation 更改集进行学习。" /><meta name="deployment_region" content="IAD" /><meta name="product" content="AWS CloudFormation" /><meta name="guide" content="用户指南" /><meta name="abstract" content="根据此用户指南，使用 AWS CloudFormation 以可预见方式反复创建和管理 AWS 基础设施部署。" /><meta name="guide-locale" content="zh_cn" /><meta name="tocs" content="toc-contents.json" /><link rel="canonical" href="https://docs.aws.amazon.com/zh_cn/AWSCloudFormation/latest/UserGuide/using-cfn-updating-stacks-changesets-samples.html" /><link rel="alternative" href="https://docs.aws.amazon.com/id_id/AWSCloudFormation/latest/UserGuide/using-cfn-updating-stacks-changesets-samples.html" hreflang="id-id" /><link rel="alternative" href="https://docs.aws.amazon.com/id_id/AWSCloudFormation/latest/UserGuide/using-cfn-updating-stacks-changesets-samples.html" hreflang="id" /><link rel="alternative" href="https://docs.aws.amazon.com/de_de/AWSCloudFormation/latest/UserGuide/using-cfn-updating-stacks-changesets-samples.html" hreflang="de-de" /><link rel="alternative" href="https://docs.aws.amazon.com/de_de/AWSCloudFormation/latest/UserGuide/using-cfn-updating-stacks-changesets-samples.html" hreflang="de" /><link rel="alternative" href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/using-cfn-updating-stacks-changesets-samples.html" hreflang="en-us" /><link rel="alternative" href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/using-cfn-updating-stacks-changesets-samples.html" hreflang="en" /><link rel="alternative" href="https://docs.aws.amazon.com/es_es/AWSCloudFormation/latest/UserGuide/using-cfn-updating-stacks-changesets-samples.html" hreflang="es-es" /><link rel="alternative" href="https://docs.aws.amazon.com/es_es/AWSCloudFormation/latest/UserGuide/using-cfn-updating-stacks-changesets-samples.html" hreflang="es" /><link rel="alternative" href="https://docs.aws.amazon.com/fr_fr/AWSCloudFormation/latest/UserGuide/using-cfn-updating-stacks-changesets-samples.html" hreflang="fr-fr" /><link rel="alternative" href="https://docs.aws.amazon.com/fr_fr/AWSCloudFormation/latest/UserGuide/using-cfn-updating-stacks-changesets-samples.html" hreflang="fr" /><link rel="alternative" href="https://docs.aws.amazon.com/it_it/AWSCloudFormation/latest/UserGuide/using-cfn-updating-stacks-changesets-samples.html" hreflang="it-it" /><link rel="alternative" href="https://docs.aws.amazon.com/it_it/AWSCloudFormation/latest/UserGuide/using-cfn-updating-stacks-changesets-samples.html" hreflang="it" /><link rel="alternative" href="https://docs.aws.amazon.com/ja_jp/AWSCloudFormation/latest/UserGuide/using-cfn-updating-stacks-changesets-samples.html" hreflang="ja-jp" /><link rel="alternative" href="https://docs.aws.amazon.com/ja_jp/AWSCloudFormation/latest/UserGuide/using-cfn-updating-stacks-changesets-samples.html" hreflang="ja" /><link rel="alternative" href="https://docs.aws.amazon.com/ko_kr/AWSCloudFormation/latest/UserGuide/using-cfn-updating-stacks-changesets-samples.html" hreflang="ko-kr" /><link rel="alternative" href="https://docs.aws.amazon.com/ko_kr/AWSCloudFormation/latest/UserGuide/using-cfn-updating-stacks-changesets-samples.html" hreflang="ko" /><link rel="alternative" href="https://docs.aws.amazon.com/pt_br/AWSCloudFormation/latest/UserGuide/using-cfn-updating-stacks-changesets-samples.html" hreflang="pt-br" /><link rel="alternative" href="https://docs.aws.amazon.com/pt_br/AWSCloudFormation/latest/UserGuide/using-cfn-updating-stacks-changesets-samples.html" hreflang="pt" /><link rel="alternative" href="https://docs.aws.amazon.com/zh_cn/AWSCloudFormation/latest/UserGuide/using-cfn-updating-stacks-changesets-samples.html" hreflang="zh-cn" /><link rel="alternative" href="https://docs.aws.amazon.com/zh_tw/AWSCloudFormation/latest/UserGuide/using-cfn-updating-stacks-changesets-samples.html" hreflang="zh-tw" /><link rel="alternative" href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/using-cfn-updating-stacks-changesets-samples.html" hreflang="x-default" /><meta name="feedback-item" content="CloudFormation" /><meta name="this_doc_product" content="AWS CloudFormation" /><meta name="this_doc_guide" content="用户指南" /><script defer="" src="/assets/r/vendor4.js?version=2021.12.02"></script><script defer="" src="/assets/r/vendor3.js?version=2021.12.02"></script><script defer="" src="/assets/r/vendor1.js?version=2021.12.02"></script><script defer="" src="/assets/r/awsdocs-common.js?version=2021.12.02"></script><script defer="" src="/assets/r/awsdocs-doc-page.js?version=2021.12.02"></script><link href="/assets/r/vendor4.css?version=2021.12.02" rel="stylesheet" /><link href="/assets/r/awsdocs-common.css?version=2021.12.02" rel="stylesheet" /><link href="/assets/r/awsdocs-doc-page.css?version=2021.12.02" rel="stylesheet" /><script async="" id="awsc-panorama-bundle" type="text/javascript" src="https://prod.pa.cdn.uis.awsstatic.com/panorama-nav-init.js" data-config="{'appEntity':'aws-documentation','region':'us-east-1','service':'cloudformation'}"></script><meta id="panorama-serviceSubSection" value="用户指南" /><meta id="panorama-serviceConsolePage" value="示例更改集" /></head><body class="awsdocs awsui"><div class="awsdocs-container"><awsdocs-header></awsdocs-header><awsui-app-layout id="app-layout" class="awsui-util-no-gutters" ng-controller="ContentController as $ctrl" header-selector="awsdocs-header" navigation-hide="false" navigation-width="$ctrl.navWidth" navigation-open="$ctrl.navOpen" navigation-change="$ctrl.onNavChange($event)" tools-hide="$ctrl.hideTools" tools-width="$ctrl.toolsWidth" tools-open="$ctrl.toolsOpen" tools-change="$ctrl.onToolsChange($event)"><div id="guide-toc" dom-region="navigation"><awsdocs-toc></awsdocs-toc></div><div id="main-column" dom-region="content" tabindex="-1"><awsdocs-view class="awsdocs-view"><div id="awsdocs-content"><head><title>示例更改集 - AWS CloudFormation</title><meta name="rss" content="aws-cloudformation-release-notes.rss" /><meta name="forums" content="http://forums.aws.amazon.com/forum.jspa?forumID=92" /><meta name="feedback" content="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=CloudFormation&amp;topic_url=https://docs.aws.amazon.com/zh_cn/AWSCloudFormation/latest/UserGuide/using-cfn-updating-stacks-changesets-samples.html" /><meta name="feedback-yes" content="feedbackyes.html?topic_url=https://docs.aws.amazon.com/zh_cn/AWSCloudFormation/latest/UserGuide/using-cfn-updating-stacks-changesets-samples.html" /><meta name="feedback-no" content="feedbackno.html?topic_url=https://docs.aws.amazon.com/zh_cn/AWSCloudFormation/latest/UserGuide/using-cfn-updating-stacks-changesets-samples.html" /><meta name="keywords" content="CloudFormation,AWSCloudFormation,资源预置,资源配置,基础设施管理,CloudFormer,CloudFormation 堆栈,CloudFormation 堆栈集,CloudFormation 模板,更改集" /><script type="application/ld+json">
{
    "@context" : "https://schema.org",
    "@type" : "BreadcrumbList",
    "itemListElement" : [
      {
        "@type" : "ListItem",
        "position" : 1,
        "name" : "AWS",
        "item" : "https://aws.amazon.com"
      },
      {
        "@type" : "ListItem",
        "position" : 2,
        "name" : "AWS CloudFormation",
        "item" : "https://docs.aws.amazon.com/cloudformation/index.html"
      },
      {
        "@type" : "ListItem",
        "position" : 3,
        "name" : "用户指南",
        "item" : "https://docs.aws.amazon.com/zh_cn/AWSCloudFormation/latest/UserGuide"
      },
      {
        "@type" : "ListItem",
        "position" : 4,
        "name" : "使用 堆栈",
        "item" : "https://docs.aws.amazon.com/zh_cn/AWSCloudFormation/latest/UserGuide/stacks.html"
      },
      {
        "@type" : "ListItem",
        "position" : 5,
        "name" : "AWS CloudFormation 堆栈更新",
        "item" : "https://docs.aws.amazon.com/zh_cn/AWSCloudFormation/latest/UserGuide/using-cfn-updating-stacks.html"
      },
      {
        "@type" : "ListItem",
        "position" : 6,
        "name" : "使用更改集更新堆栈",
        "item" : "https://docs.aws.amazon.com/zh_cn/AWSCloudFormation/latest/UserGuide/using-cfn-updating-stacks-changesets.html"
      },
      {
        "@type" : "ListItem",
        "position" : 7,
        "name" : "示例更改集",
        "item" : "https://docs.aws.amazon.com/zh_cn/AWSCloudFormation/latest/UserGuide/using-cfn-updating-stacks-changesets.html"
      }
    ]
}
</script></head><body><div id="main"><div style="display: none"></div><div id="breadcrumbs" class="breadcrumb"><a href="https://aws.amazon.com">AWS</a><a href="/index.html">文档</a><a href="/cloudformation/index.html">AWS CloudFormation</a><a href="Welcome.html">用户指南</a></div><div id="page-toc-src"><a href="#using-cfn-updating-stacks-changesets-samples-directly-editing-a-template">直接编辑模板</a><a href="#using-cfn-updating-stacks-changesets-samples-modifying-a-single-input-parameter-value">修改输入参数值</a><a href="#using-cfn-updating-stacks-changesets-samples-determining-the-value-of-the-replacement-field">确定“Replacement”字段中的值</a><a href="#using-cfn-updating-stacks-changesets-samples-adding-and-removing-resources">添加和删除资源</a></div><div id="main-content" class="awsui-util-container"><div id="main-col-body"><awsdocs-language-banner data-service="$ctrl.pageService"></awsdocs-language-banner><h1 class="topictitle" id="using-cfn-updating-stacks-changesets-samples">示例更改集</h1><div class="awsdocs-page-header-container"><awsdocs-page-header></awsdocs-page-header><awsdocs-filter-selector id="awsdocs-filter-selector"></awsdocs-filter-selector></div><p>此部分提供 CloudFormation 将为通用堆栈更改创建的更改集示例。它们显示如何直接编辑模板；修改单个输入参数；计划资源重新创建 (替换)，这可防止您丢失未备份的数据或者中断正在堆栈中运行的应用程序；以及添加和删除资源。为了说明更改集的工作原理，我们将演练提交的更改，并说明生成的更改集。由于每个示例在之前的示例基础上构建并且假定您已了解之前的示例，我们建议您按顺序阅读。有关更改集中各个字段的说明，请参阅《AWS CloudFormation API 参考》中的<a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/APIReference/API_Change.html">更改</a>数据类型。</p><p>您可以使用<a href="./using-cfn-updating-stacks-changesets-view.html">控制台</a>、AWS CLI 或 CloudFormation <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/APIReference/API_DescribeChangeSet.html"><code class="code">DescribeChangeSet</code></a> API 操作来查看更改集详细信息。</p><p>我们使用以下<a href="https://s3.amazonaws.com/cloudformation-examples/user-guide/changesets/ec2-instance.txt" rel="noopener noreferrer" target="_blank"><span>示例模板</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a>从堆栈生成以下各个更改集：</p><pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="复制"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
  "AWSTemplateFormatVersion" : "2010-09-09",
  "Description" : "A sample EC2 instance template for testing change sets.",
  "Parameters" : <span>{</span>
    "Purpose" : <span>{</span>
      "Type" : "String",
      "Default" : "testing",
      "AllowedValues" : ["testing", "production"],
      "Description" : "The purpose of this instance."
    },
    "KeyPairName" : <span>{</span>
      "Type": "AWS::EC2::KeyPair::KeyName",
      "Description" : "Name of an existing EC2 KeyPair to enable SSH access to the instance"
    },
    "InstanceType" : <span>{</span>
      "Type" : "String",
      "Default" : "t2.micro",
      "AllowedValues" : ["t2.micro", "t2.small", "t2.medium"],
      "Description" : "The EC2 instance type."
    }
  },
  "Resources" : <span>{</span>
    "MyEC2Instance" : <span>{</span>
      "Type" : "AWS::EC2::Instance",
      "Properties" : <span>{</span>
        "KeyName" : <span>{</span> "Ref" : "KeyPairName" },
        "InstanceType" : <span>{</span> "Ref" : "InstanceType" },
        "ImageId" : "ami-8fcee4e5",
        "Tags" : [
          <span>{</span>
            "Key" : "Purpose",
            "Value" : <span>{</span> "Ref" : "Purpose" }
          }
        ]
      }
    }
  }
}</code></pre>
      <h2 id="using-cfn-updating-stacks-changesets-samples-directly-editing-a-template">直接编辑模板</h2>

      <p>当您在堆栈模板中直接修改资源以生成更改集时，CloudFormation 将更改分为直接修改类，这与由更新后的参数值启动的更改相对。以下更改集添加新标签到 <code class="code">i-1abc23d4</code> 实例，是直接修改的示例。所有其他输入值，例如参数值和功能均不变，因此我们将侧重于 <code class="code">Changes</code> 结构。</p>
      <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="复制"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
    "StackId": "arn:aws:cloudformation:us-east-1:123456789012:stack/SampleStack/1a2345b6-0000-00a0-a123-00abc0abc000",
    "Status": "CREATE_COMPLETE",
    "ChangeSetName": "SampleChangeSet-direct",
    "Parameters": [
        <span>{</span>
            "ParameterValue": "testing",
            "ParameterKey": "Purpose"
        },
        <span>{</span>
            "ParameterValue": "MyKeyName",
            "ParameterKey": "KeyPairName"
        },
        <span>{</span>
            "ParameterValue": "t2.micro",
            "ParameterKey": "InstanceType"
        }
    ],
    "Changes": [
        <span>{</span>
            "ResourceChange": <span>{</span>
                "ResourceType": "AWS::EC2::Instance",
                "PhysicalResourceId": "i-1abc23d4",
                "Details": [
                    <span>{</span>
                        "ChangeSource": "DirectModification",
                        "Evaluation": "Static",
                        "Target": <span>{</span>
                            "Attribute": "Tags",
                            "RequiresRecreation": "Never"
                        }
                    }
                ],
                "Action": "Modify",
                "Scope": [
                    "Tags"
                ],
                "LogicalResourceId": "MyEC2Instance",
                "Replacement": "False"
            },
            "Type": "Resource"
        }
    ],
    "CreationTime": "2020-11-18T23:35:25.813Z",
    "Capabilities": [],
    "StackName": "SampleStack",
    "NotificationARNs": [],
    "ChangeSetId": "arn:aws:cloudformation:us-east-1:123456789012:changeSet/SampleChangeSet-direct/1a2345b6-0000-00a0-a123-00abc0abc000"
}</code></pre>
      <p>在 <code class="code">Changes</code> 结构中，只有一个 <code class="code">ResourceChange</code> 结构。此结构描述一些信息，诸如 CloudFormation 将更改的资源类型、CloudFormation 将采取的操作、资源的 ID、更改的范围，以及更改是否需要替换（此时 CloudFormation 将创建新资源，然后删除旧资源）。在示例中，更改集指示 CloudFormation 将修改 <code class="code">i-1abc23d4</code> EC2 实例的 <code class="code">Tags</code> 属性，无需替换实例。</p>
      <p>在 <code class="code">Details</code> 结构中，CloudFormation 将此更改标记为直接修改，永远无需重新创建实例（替换）。您可以充满信心地执行此更改，知道 CloudFormation 不会替换实例。</p>
      <p>CloudFormation 将此更改显示为 <code class="code">Static</code> 评估。静态评估意味着 CloudFormation 可以在执行更改集之前确定标签的值。在一些情况下，CloudFormation 只有在执行更改集之后才可以确定值。CloudFormation 将这些更改标记为 <code class="code">Dynamic</code> 评估。例如，如果您引用有条件替换的更新后资源，CloudFormation 无法确定是否会更改对更新后资源的引用。</p>
     
      <h2 id="using-cfn-updating-stacks-changesets-samples-modifying-a-single-input-parameter-value">修改输入参数值</h2>

      <p>在您修改输入参数值时，CloudFormation 为使用更新后参数值的每个资源生成两个更改。在本示例中，我们希望突出显示这些更改的样子以及您应该关注哪些信息。以下示例通过仅更改 <code class="code">Purpose</code> 输入参数的值生成。</p>
      <p><code class="code">Purpose</code> 参数指定 EC2 实例的标签键值。在示例中，参数值从 <code class="code">testing</code> 更改为 <code class="code">production</code>。新值显示在 <code class="code">Parameters</code> 结构中。</p>
      <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="复制"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
    "StackId": "arn:aws:cloudformation:us-east-1:123456789012:stack/SampleStack/1a2345b6-0000-00a0-a123-00abc0abc000",
    "Status": "CREATE_COMPLETE",
    "ChangeSetName": "SampleChangeSet",
    "Parameters": [
        <span>{</span>
            "ParameterValue": "production",
            "ParameterKey": "Purpose"
        },
        <span>{</span>
            "ParameterValue": "MyKeyName",
            "ParameterKey": "KeyPairName"
        },
        <span>{</span>
            "ParameterValue": "t2.micro",
            "ParameterKey": "InstanceType"
        }
    ],
    "Changes": [
        <span>{</span>
            "ResourceChange": <span>{</span>
                "ResourceType": "AWS::EC2::Instance",
                "PhysicalResourceId": "i-1abc23d4",
                "Details": [
                    <span>{</span>
                        "ChangeSource": "DirectModification",
                        "Evaluation": "Dynamic",
                        "Target": <span>{</span>
                            "Attribute": "Tags",
                            "RequiresRecreation": "Never"
                        }
                    },
                    <span>{</span>
                        "CausingEntity": "Purpose",
                        "ChangeSource": "ParameterReference",
                        "Evaluation": "Static",
                        "Target": <span>{</span>
                            "Attribute": "Tags",
                            "RequiresRecreation": "Never"
                        }
                    }
                ],
                "Action": "Modify",
                "Scope": [
                    "Tags"
                ],
                "LogicalResourceId": "MyEC2Instance",
                "Replacement": "False"
            },
            "Type": "Resource"
        }
    ],
    "CreationTime": "2020-11-18T23:59:18.447Z",
    "Capabilities": [],
    "StackName": "SampleStack",
    "NotificationARNs": [],
    "ChangeSetId": "arn:aws:cloudformation:us-east-1:123456789012:changeSet/SampleChangeSet/1a2345b6-0000-00a0-a123-00abc0abc000"
}</code></pre>
      <p><code class="code">Changes</code> 结构函数发挥作用的方式与在<a href="#using-cfn-updating-stacks-changesets-samples-directly-editing-a-template">直接编辑模板</a>示例中类似。只有一个 <code class="code">ResourceChange</code> 结构；它描述了对 <code class="code">Tags</code> EC2 实例的 <code class="code">i-1abc23d4</code> 属性的更改。</p>
      <p>但是，在 <code class="code">Details</code> 结构中，更改集显示了 <code class="code">Tags</code> 属性的两个更改，即使只更改了一个参数值。引用更改后参数值的资源 (使用 <code class="code">Ref</code> 内部函数) 始终会导致两个更改：一个为 <code class="code">Dynamic</code> 评估，另一个为 <code class="code">Static</code> 评估。您可以通过查看以下字段查看这些更改类型：</p>
      <div class="itemizedlist">
         
         
      <ul class="itemizedlist"><li class="listitem">
          <p>对于 <code class="code">Static</code> 评估更改，请查看 <code class="code">ChangeSource</code> 字段。在此示例中，<code class="code">ChangeSource</code> 字段等于 <code class="code">ParameterReference</code>，意味着此更改是更新参数引用值的结果。更改集必须包含类似的 <code class="code">Dynamic</code> 评估更改。</p>
        </li><li class="listitem">
          <p>您可以通过比较所有更改的 <code class="code">Dynamic</code> 结构来查找匹配的 <code class="code">Target</code> 评估更改，这会包含同样的信息。在此示例中，所有更改的 <code class="code">Target</code> 结构包含 <code class="code">Attribute</code> 和 <code class="code">RequireRecreation</code> 字段的相同值。</p>
        </li></ul></div>
      <p>对于这些类型的更改，重点在于静态评估，这向您提供了有关更改最详细的信息。在此示例中，静态评估显示更改是对参数引用值 (<code class="code">ParameterReference</code>) 进行更改的结果。进行更改的确切参数由 <code class="code">CauseEntity</code> 字段 (<code class="code">Purpose</code> 参数) 指定。</p>
     
      <h2 id="using-cfn-updating-stacks-changesets-samples-determining-the-value-of-the-replacement-field">确定“Replacement”字段中的值</h2>

      <p><code class="code">ResourceChange</code> 结构中的 <code class="code">Replacement</code> 字段指示 CloudFormation 是否重新创建资源。计划重新创建资源 (替换) 可防止您丢失未备份的数据或者中断正在堆栈中运行的应用程序。</p>
      <p><code class="code">Replacement</code> 字段中的值取决于更改是否需要替换，这由更改的 <code class="code">RequiresRecreation</code> 结构中的 <code class="code">Target</code> 字段指示。例如，如果 <code class="code">RequiresRecreation</code> 字段为 <code class="code">Never</code>，则 <code class="code">Replacement</code> 字段为 <code class="code">False</code>。但是，如果单个资源上有多个更改，并且每个更改有不同的 <code class="code">RequiresRecreation</code> 字段值，CloudFormation 将使用最具侵入性的行为更新资源。换而言之，即使多个更改中只有一个需要替换，CloudFormation 必须替换资源，因此，将 <code class="code">Replacement</code> 字段设置为 <code class="code">True</code>。</p>
      <p>以下更改集通过更改每个参数 (<code class="code">Purpose</code>、<code class="code">InstanceType</code> 和 <code class="code">KeyPairName</code>) 的值生成，这些参数均由 EC2 实例使用。通过这些更改，CloudFormation 需要替换实例，因为 <code class="code">Replacement</code> 字段等于 <code class="code">True</code>。</p>
      <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="复制"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
    "StackId": "arn:aws:cloudformation:us-east-1:123456789012:stack/SampleStack/1a2345b6-0000-00a0-a123-00abc0abc000",
    "Status": "CREATE_COMPLETE",
    "ChangeSetName": "SampleChangeSet-multiple",
    "Parameters": [
        <span>{</span>
            "ParameterValue": "production",
            "ParameterKey": "Purpose"
        },
        <span>{</span>
            "ParameterValue": "MyNewKeyName",
            "ParameterKey": "KeyPairName"
        },
        <span>{</span>
            "ParameterValue": "t2.small",
            "ParameterKey": "InstanceType"
        }
    ],
    "Changes": [
        <span>{</span>
            "ResourceChange": <span>{</span>
                "ResourceType": "AWS::EC2::Instance",
                "PhysicalResourceId": "i-7bef86f8",
                "Details": [
                    <span>{</span>
                        "ChangeSource": "DirectModification",
                        "Evaluation": "Dynamic",
                        "Target": <span>{</span>
                            "Attribute": "Properties",
                            "Name": "KeyName",
                            "RequiresRecreation": "Always"
                        }
                    },
                    <span>{</span>
                        "ChangeSource": "DirectModification",
                        "Evaluation": "Dynamic",
                        "Target": <span>{</span>
                            "Attribute": "Properties",
                            "Name": "InstanceType",
                            "RequiresRecreation": "Conditionally"
                        }
                    },
                    <span>{</span>
                        "ChangeSource": "DirectModification",
                        "Evaluation": "Dynamic",
                        "Target": <span>{</span>
                            "Attribute": "Tags",
                            "RequiresRecreation": "Never"
                        }
                    },
                    <span>{</span>
                        "CausingEntity": "KeyPairName",
                        "ChangeSource": "ParameterReference",
                        "Evaluation": "Static",
                        "Target": <span>{</span>
                            "Attribute": "Properties",
                            "Name": "KeyName",
                            "RequiresRecreation": "Always"
                        }
                    },
                    <span>{</span>
                        "CausingEntity": "InstanceType",
                        "ChangeSource": "ParameterReference",
                        "Evaluation": "Static",
                        "Target": <span>{</span>
                            "Attribute": "Properties",
                            "Name": "InstanceType",
                            "RequiresRecreation": "Conditionally"
                        }
                    },
                    <span>{</span>
                        "CausingEntity": "Purpose",
                        "ChangeSource": "ParameterReference",
                        "Evaluation": "Static",
                        "Target": <span>{</span>
                            "Attribute": "Tags",
                            "RequiresRecreation": "Never"
                        }
                    }
                ],
                "Action": "Modify",
                "Scope": [
                    "Tags",
                    "Properties"
                ],
                "LogicalResourceId": "MyEC2Instance",
                "Replacement": "True"
            },
            "Type": "Resource"
        }
    ],
    "CreationTime": "2020-11-18T00:39:35.974Z",
    "Capabilities": [],
    "StackName": "SampleStack",
    "NotificationARNs": [],
    "ChangeSetId": "arn:aws:cloudformation:us-east-1:123456789012:changeSet/SampleChangeSet-multiple/1a2345b6-0000-00a0-a123-00abc0abc000"
}</code></pre>
      <p>通过查看各个更改 (<code class="code">Details</code> 结构中的静态评估) 确定需要替换资源的更改。在此示例中，各个更改具有不同的 <code class="code">RequireRecreation</code> 字段值，但对 <code class="code">KeyName</code> 属性的更改是最具侵入性的更新行为，始终需要重新创建。CloudFormation 将替换实例，因为其键名称已更改。</p>
      <p>如果键名称未更改，则对 <code class="code">InstanceType</code> 属性的更改将为最具侵入性的更新行为 (<code class="code">Conditionally</code>)，因此 <code class="code">Replacement</code> 字段将为 <code class="code">Conditionally</code>。要查找 CloudFormation 替换实例的条件，请查看 <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-properties-ec2-instance.html#cfn-ec2-instance-instancetype"><code class="code">InstanceType</code></a> 属性的更新行为。</p>
     
      <h2 id="using-cfn-updating-stacks-changesets-samples-adding-and-removing-resources">添加和删除资源</h2>

      <p>以下示例通过提交修改后的模板生成，此修改删除了 EC2 实例，并添加了自动扩缩组和启动配置。</p>
      <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="复制"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
    "StackId": "arn:aws:cloudformation:us-east-1:123456789012:stack/SampleStack/1a2345b6-0000-00a0-a123-00abc0abc000",
    "Status": "CREATE_COMPLETE",
    "ChangeSetName": "SampleChangeSet-addremove",
    "Parameters": [
        <span>{</span>
            "ParameterValue": "testing",
            "ParameterKey": "Purpose"
        },
        <span>{</span>
            "ParameterValue": "MyKeyName",
            "ParameterKey": "KeyPairName"
        },
        <span>{</span>
            "ParameterValue": "t2.micro",
            "ParameterKey": "InstanceType"
        }
    ],
    "Changes": [
        <span>{</span>
            "ResourceChange": <span>{</span>
                "Action": "Add",
                "ResourceType": "AWS::AutoScaling::AutoScalingGroup",
                "Scope": [],
                "Details": [],
                "LogicalResourceId": "AutoScalingGroup"
            },
            "Type": "Resource"
        },
        <span>{</span>
            "ResourceChange": <span>{</span>
                "Action": "Add",
                "ResourceType": "AWS::AutoScaling::LaunchConfiguration",
                "Scope": [],
                "Details": [],
                "LogicalResourceId": "LaunchConfig"
            },
            "Type": "Resource"
        },
        <span>{</span>
            "ResourceChange": <span>{</span>
                "ResourceType": "AWS::EC2::Instance",
                "PhysicalResourceId": "i-1abc23d4",
                "Details": [],
                "Action": "Remove",
                "Scope": [],
                "LogicalResourceId": "MyEC2Instance"
            },
            "Type": "Resource"
        }
    ],
    "CreationTime": "2020-11-18T01:44:08.444Z",
    "Capabilities": [],
    "StackName": "SampleStack",
    "NotificationARNs": [],
    "ChangeSetId": "arn:aws:cloudformation:us-east-1:123456789012:changeSet/SampleChangeSet-addremove/1a2345b6-0000-00a0-a123-00abc0abc000"
}</code></pre>
      <p>在 <code class="code">Changes</code> 结构中，有三个 <code class="code">ResourceChange</code> 结构，每个资源一个。对于每个资源，<code class="code">Action</code> 字段指示 CloudFormation 添加还是删除资源。<code class="code">Scope</code> 和 <code class="code">Details</code> 字段为空，因为它们仅适用于修改后的资源。</p>
      <p>对于新资源，CloudFormation 无法确定一些字段的值，直至您执行更改集。例如，CloudFormation 不提供自动扩缩组的物理 ID 和启动配置，因为它们尚不存在。在您执行更改集时，CloudFormation 创建新资源。</p>
    <awsdocs-copyright class="copyright-print"></awsdocs-copyright><awsdocs-thumb-feedback right-edge="{{$ctrl.thumbFeedbackRightEdge}}"></awsdocs-thumb-feedback></div><noscript><div><div><div><div id="js_error_message"><p><img src="https://d1ge0kk1l5kms0.cloudfront.net/images/G/01/webservices/console/warning.png" alt="警告" /> <strong>Javascript 在您的浏览器中被禁用或不可用。</strong></p><p>要使用 Amazon Web Services 文档，必须启用 Javascript。请参阅浏览器的帮助页面以了解相关说明。</p></div></div></div></div></noscript><div id="main-col-footer" class="awsui-util-font-size-0"><div id="doc-conventions"><a target="_top" href="/general/latest/gr/docconventions.html">文档惯例</a></div><div class="prev-next"><div id="previous" class="prev-link" accesskey="p" href="./using-cfn-updating-stacks-changesets-delete.html">删除更改集</div><div id="next" class="next-link" accesskey="n" href="./using-cfn-updating-stacks-direct.html">直接更新堆栈</div></div></div><awsdocs-page-utilities></awsdocs-page-utilities></div><div id="quick-feedback-yes" style="display: none;"><div class="title">此页面对您有帮助吗？- 是</div><div class="content"><p>感谢您对我们工作的肯定！</p><p>如果不耽误您的时间，请告诉我们做得好的地方，让我们做得更好。</p><p><awsui-button id="fblink" rel="noopener noreferrer" target="_blank" text="反馈" click="linkClick($event)" href="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=CloudFormation&amp;topic_url=https://docs.aws.amazon.com/zh_cn/AWSCloudFormation/latest/UserGuide/using-cfn-updating-stacks-changesets-samples.html"></awsui-button></p></div></div><div id="quick-feedback-no" style="display: none;"><div class="title">此页面对您有帮助吗？- 否</div><div class="content"><p>感谢您告诉我们本页内容还需要完善。很抱歉让您失望了。</p><p>如果不耽误您的时间，请告诉我们如何改进文档。</p><p><awsui-button id="fblink" rel="noopener noreferrer" target="_blank" text="反馈" click="linkClick($event)" href="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=CloudFormation&amp;topic_url=https://docs.aws.amazon.com/zh_cn/AWSCloudFormation/latest/UserGuide/using-cfn-updating-stacks-changesets-samples.html"></awsui-button></p></div></div></div></body></div></awsdocs-view><div class="page-loading-indicator" id="page-loading-indicator"><awsui-spinner size="large"></awsui-spinner></div></div><div id="tools-panel" dom-region="tools"><awsdocs-tools-panel id="awsdocs-tools-panel"></awsdocs-tools-panel></div></awsui-app-layout><awsdocs-cookie-banner class="doc-cookie-banner"></awsdocs-cookie-banner></div></body></html>