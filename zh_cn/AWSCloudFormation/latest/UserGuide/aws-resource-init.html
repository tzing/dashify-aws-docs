<!DOCTYPE html>
    <html xmlns="http://www.w3.org/1999/xhtml" lang="zh-CN"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>AWS::CloudFormation::Init - AWS CloudFormation</title><meta name="viewport" content="width=device-width,initial-scale=1" /><meta name="assets_root" content="/assets" /><meta name="target_state" content="aws-resource-init" /><meta name="default_state" content="aws-resource-init" /><link rel="icon" type="image/ico" href="/assets/images/favicon.ico" /><link rel="shortcut icon" type="image/ico" href="/assets/images/favicon.ico" /><link rel="canonical" href="https://docs.aws.amazon.com/zh_cn/AWSCloudFormation/latest/UserGuide/aws-resource-init.html" /><meta name="description" content="使用 AWS::CloudFormation::Init 资源类型将 Amazon EC2 实例上的元数据置入 cfn-init 帮助程序脚本。" /><meta name="deployment_region" content="IAD" /><meta name="product" content="AWS CloudFormation" /><meta name="guide" content="用户指南" /><meta name="abstract" content="根据此用户指南，使用 AWS CloudFormation 以可预见方式反复创建和管理 AWS 基础设施部署。" /><meta name="guide-locale" content="zh_cn" /><meta name="tocs" content="toc-contents.json" /><link rel="canonical" href="https://docs.aws.amazon.com/zh_cn/AWSCloudFormation/latest/UserGuide/aws-resource-init.html" /><link rel="alternative" href="https://docs.aws.amazon.com/id_id/AWSCloudFormation/latest/UserGuide/aws-resource-init.html" hreflang="id-id" /><link rel="alternative" href="https://docs.aws.amazon.com/id_id/AWSCloudFormation/latest/UserGuide/aws-resource-init.html" hreflang="id" /><link rel="alternative" href="https://docs.aws.amazon.com/de_de/AWSCloudFormation/latest/UserGuide/aws-resource-init.html" hreflang="de-de" /><link rel="alternative" href="https://docs.aws.amazon.com/de_de/AWSCloudFormation/latest/UserGuide/aws-resource-init.html" hreflang="de" /><link rel="alternative" href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-resource-init.html" hreflang="en-us" /><link rel="alternative" href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-resource-init.html" hreflang="en" /><link rel="alternative" href="https://docs.aws.amazon.com/es_es/AWSCloudFormation/latest/UserGuide/aws-resource-init.html" hreflang="es-es" /><link rel="alternative" href="https://docs.aws.amazon.com/es_es/AWSCloudFormation/latest/UserGuide/aws-resource-init.html" hreflang="es" /><link rel="alternative" href="https://docs.aws.amazon.com/fr_fr/AWSCloudFormation/latest/UserGuide/aws-resource-init.html" hreflang="fr-fr" /><link rel="alternative" href="https://docs.aws.amazon.com/fr_fr/AWSCloudFormation/latest/UserGuide/aws-resource-init.html" hreflang="fr" /><link rel="alternative" href="https://docs.aws.amazon.com/it_it/AWSCloudFormation/latest/UserGuide/aws-resource-init.html" hreflang="it-it" /><link rel="alternative" href="https://docs.aws.amazon.com/it_it/AWSCloudFormation/latest/UserGuide/aws-resource-init.html" hreflang="it" /><link rel="alternative" href="https://docs.aws.amazon.com/ja_jp/AWSCloudFormation/latest/UserGuide/aws-resource-init.html" hreflang="ja-jp" /><link rel="alternative" href="https://docs.aws.amazon.com/ja_jp/AWSCloudFormation/latest/UserGuide/aws-resource-init.html" hreflang="ja" /><link rel="alternative" href="https://docs.aws.amazon.com/ko_kr/AWSCloudFormation/latest/UserGuide/aws-resource-init.html" hreflang="ko-kr" /><link rel="alternative" href="https://docs.aws.amazon.com/ko_kr/AWSCloudFormation/latest/UserGuide/aws-resource-init.html" hreflang="ko" /><link rel="alternative" href="https://docs.aws.amazon.com/pt_br/AWSCloudFormation/latest/UserGuide/aws-resource-init.html" hreflang="pt-br" /><link rel="alternative" href="https://docs.aws.amazon.com/pt_br/AWSCloudFormation/latest/UserGuide/aws-resource-init.html" hreflang="pt" /><link rel="alternative" href="https://docs.aws.amazon.com/zh_cn/AWSCloudFormation/latest/UserGuide/aws-resource-init.html" hreflang="zh-cn" /><link rel="alternative" href="https://docs.aws.amazon.com/zh_tw/AWSCloudFormation/latest/UserGuide/aws-resource-init.html" hreflang="zh-tw" /><link rel="alternative" href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-resource-init.html" hreflang="x-default" /><meta name="feedback-item" content="CloudFormation" /><meta name="this_doc_product" content="AWS CloudFormation" /><meta name="this_doc_guide" content="用户指南" /><script defer="" src="/assets/r/vendor4.js?version=2021.12.02"></script><script defer="" src="/assets/r/vendor3.js?version=2021.12.02"></script><script defer="" src="/assets/r/vendor1.js?version=2021.12.02"></script><script defer="" src="/assets/r/awsdocs-common.js?version=2021.12.02"></script><script defer="" src="/assets/r/awsdocs-doc-page.js?version=2021.12.02"></script><link href="/assets/r/vendor4.css?version=2021.12.02" rel="stylesheet" /><link href="/assets/r/awsdocs-common.css?version=2021.12.02" rel="stylesheet" /><link href="/assets/r/awsdocs-doc-page.css?version=2021.12.02" rel="stylesheet" /><script async="" id="awsc-panorama-bundle" type="text/javascript" src="https://prod.pa.cdn.uis.awsstatic.com/panorama-nav-init.js" data-config="{'appEntity':'aws-documentation','region':'us-east-1','service':'cloudformation'}"></script><meta id="panorama-serviceSubSection" value="用户指南" /><meta id="panorama-serviceConsolePage" value="AWS::CloudFormation::Init" /></head><body class="awsdocs awsui"><div class="awsdocs-container"><awsdocs-header></awsdocs-header><awsui-app-layout id="app-layout" class="awsui-util-no-gutters" ng-controller="ContentController as $ctrl" header-selector="awsdocs-header" navigation-hide="false" navigation-width="$ctrl.navWidth" navigation-open="$ctrl.navOpen" navigation-change="$ctrl.onNavChange($event)" tools-hide="$ctrl.hideTools" tools-width="$ctrl.toolsWidth" tools-open="$ctrl.toolsOpen" tools-change="$ctrl.onToolsChange($event)"><div id="guide-toc" dom-region="navigation"><awsdocs-toc></awsdocs-toc></div><div id="main-column" dom-region="content" tabindex="-1"><awsdocs-view class="awsdocs-view"><div id="awsdocs-content"><head><title>AWS::CloudFormation::Init - AWS CloudFormation</title><meta name="rss" content="aws-cloudformation-release-notes.rss" /><meta name="forums" content="http://forums.aws.amazon.com/forum.jspa?forumID=92" /><meta name="feedback" content="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=CloudFormation&amp;topic_url=https://docs.aws.amazon.com/zh_cn/AWSCloudFormation/latest/UserGuide/aws-resource-init.html" /><meta name="feedback-yes" content="feedbackyes.html?topic_url=https://docs.aws.amazon.com/zh_cn/AWSCloudFormation/latest/UserGuide/aws-resource-init.html" /><meta name="feedback-no" content="feedbackno.html?topic_url=https://docs.aws.amazon.com/zh_cn/AWSCloudFormation/latest/UserGuide/aws-resource-init.html" /><meta name="keywords" content="CloudFormation,AWSCloudFormation,资源预置,资源配置,基础设施管理,CloudFormer,CloudFormation 堆栈,CloudFormation 堆栈集,CloudFormation 模板,更改集" /><script type="application/ld+json">
{
    "@context" : "https://schema.org",
    "@type" : "BreadcrumbList",
    "itemListElement" : [
      {
        "@type" : "ListItem",
        "position" : 1,
        "name" : "AWS",
        "item" : "https://aws.amazon.com"
      },
      {
        "@type" : "ListItem",
        "position" : 2,
        "name" : "AWS CloudFormation",
        "item" : "https://docs.aws.amazon.com/cloudformation/index.html"
      },
      {
        "@type" : "ListItem",
        "position" : 3,
        "name" : "用户指南",
        "item" : "https://docs.aws.amazon.com/zh_cn/AWSCloudFormation/latest/UserGuide"
      },
      {
        "@type" : "ListItem",
        "position" : 4,
        "name" : "使用 AWS CloudFormation 模板",
        "item" : "https://docs.aws.amazon.com/zh_cn/AWSCloudFormation/latest/UserGuide/template-guide.html"
      },
      {
        "@type" : "ListItem",
        "position" : 5,
        "name" : "模板剖析",
        "item" : "https://docs.aws.amazon.com/zh_cn/AWSCloudFormation/latest/UserGuide/template-anatomy.html"
      },
      {
        "@type" : "ListItem",
        "position" : 6,
        "name" : "元数据",
        "item" : "https://docs.aws.amazon.com/zh_cn/AWSCloudFormation/latest/UserGuide/metadata-section-structure.html"
      },
      {
        "@type" : "ListItem",
        "position" : 7,
        "name" : "AWS::CloudFormation::Init",
        "item" : "https://docs.aws.amazon.com/zh_cn/AWSCloudFormation/latest/UserGuide/metadata-section-structure.html"
      }
    ]
}
</script></head><body><div id="main"><div style="display: none"></div><div id="breadcrumbs" class="breadcrumb"><a href="https://aws.amazon.com">AWS</a><a href="/index.html">文档</a><a href="/cloudformation/index.html">AWS CloudFormation</a><a href="Welcome.html">用户指南</a></div><div id="page-toc-src"><a href="#aws-resource-cloudformation-init-syntax">语法</a><a href="#aws-resource-init-configsets">配置集</a><a href="#aws-resource-init-commands">命令</a><a href="#aws-resource-init-files">文件</a><a href="#aws-resource-init-groups">组</a><a href="#aws-resource-init-packages">软件包</a><a href="#aws-resource-init-services">服务</a><a href="#aws-resource-init-sources">源</a><a href="#aws-resource-init-users">用户</a></div><div id="page-filters" style="display:none"><filter label="All" id="All"></filter><filter label="JSON" id="JSON"></filter><filter label="YAML" id="YAML"></filter></div><div id="main-content" class="awsui-util-container"><div id="main-col-body"><awsdocs-language-banner data-service="$ctrl.pageService"></awsdocs-language-banner><h1 class="topictitle" id="aws-resource-init"><code class="code">AWS::CloudFormation::Init</code></h1><div class="awsdocs-page-header-container"><awsdocs-page-header></awsdocs-page-header><awsdocs-filter-selector id="awsdocs-filter-selector"></awsdocs-filter-selector></div><p>使用类型 <code class="code">AWS::CloudFormation::Init</code> 来将 Amazon EC2 实例上的元数据置入 cfn-init 帮助程序脚本。如果您的模板调用 cfn-init 脚本，该脚本会查找来源于 <code class="code">AWS::CloudFormation::Init</code> 元数据键内的资源元数据。有关 cfn-init 的详细信息，请参阅 <a href="./cfn-init.html">cfn-init</a>。</p><p>cfn-init 支持 Linux 系统的所有元数据类型。在满足下面部分中说明的条件时，它还支持 Windows 的元数据类型。</p><p>有关使用 <code class="code">AWS::CloudFormation::Init</code> 和 cfn-init 帮助程序脚本的示例，请参阅 <a href="./deploying.applications.html">使用 AWS CloudFormation 在 Amazon EC2 上部署应用程序</a>。</p><p>有关说明如何使用 cfn-init 创建 Windows 堆栈的示例，请参阅<a href="./cfn-windows-stacks-bootstrapping.html">引导 AWS CloudFormation Windows 堆栈</a>。</p>
      <h2 id="aws-resource-cloudformation-init-syntax">语法</h2>

      <p>配置过程分为几个部分。以下模板代码段演示如何在模板内将 cfn-init 的元数据附加到 EC2 实例资源。</p>
      <p>元数据分成数个配置键，您可以将它们分成几个配置集。当您在模板中调用 cfn-init 时，可以指定配置集。如果未指定配置集，cfn-init 将查找名为 <em>config</em> 的单个配置键。</p>
      <div class="awsdocs-note"><div class="awsdocs-note-title"><awsui-icon name="status-info" variant="link"></awsui-icon><h6>注意</h6></div><div class="awsdocs-note-text"><p>该 cfn-init 帮助程序脚本以下列顺序处理这些配置节：packages、groups、users、sources、files、commands，然后是 services。如果您需要以不同顺序处理，请将各节分为不同的配置键，然后使用配置集指定处理这些配置键应采用的顺序。</p></div></div>

      <div id="JSON" name="JSON" class="section langfilter">
         <h3 id="aws-resource-cloudformation-init-syntax.json">JSON</h3>

         <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="复制"><awsui-icon name="copy"></awsui-icon></div></div><code class="json ">"Resources": <span>{</span>
  "MyInstance": <span>{</span>
    "Type": "AWS::EC2::Instance",
    "Metadata" : <span>{</span>
      "AWS::CloudFormation::Init" : <span>{</span>
        "config" : <span>{</span>
          "packages" : <span>{</span>
            :
          },
          "groups" : <span>{</span>
            :
          },
          "users" : <span>{</span>
            :
          },
          "sources" : <span>{</span>
            :
          },
          "files" : <span>{</span>
            :
          },
          "commands" : <span>{</span>
            :
          },
          "services" : <span>{</span>
            :
          }
        }
      }
    },
    "Properties": <span>{</span>
      :
    }
  }
}</code></pre>
      </div>
      <div id="YAML" name="YAML" class="section langfilter">
         <h3 id="aws-resource-cloudformation-init-syntax.yaml">YAML</h3>

         <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="复制"><awsui-icon name="copy"></awsui-icon></div></div><code class="yaml ">Resources: 
  MyInstance: 
    Type: AWS::EC2::Instance
    Metadata: 
      AWS::CloudFormation::Init: 
        config: 
          packages: 
            :
          groups: 
            :
          users: 
            :
          sources: 
            :
          files: 
            :
          commands: 
            :
          services: 
            :
    Properties: 
      :</code></pre>
         <div class="awsdocs-note"><div class="awsdocs-note-title"><awsui-icon name="status-info" variant="link"></awsui-icon><h6>注意</h6></div><div class="awsdocs-note-text"><p>要为 Amazon EC2 实例指定 <code class="code">AWS::CloudFormation::Init</code> 属性，请参阅 <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/cfn-init.html#cfn-init-Examples">Amazon Linux 示例</a>。</p></div></div>
      </div>
    
      <h2 id="aws-resource-init-configsets">配置集</h2>

      <p>如果您创建多个配置键并使 cfn-init 以特定的顺序处理这些键，则可创建一个配置集，其中包含以特定顺序排列的多个配置键。</p>
       
         <h3 id="w9aac23c15c15c23c13b5">单个配置集</h3>

         <p>以下模板代码段创建名为 <code class="code">ascending</code> 和 <code class="code">descending</code> 的两个配置集，每个各包含 2 个配置键。</p>
         <div id="JSON" name="JSON" class="section langfilter">
            <h4 id="aws-resource-cloudformation-init-configset-example1.json">JSON</h4>

            <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="复制"><awsui-icon name="copy"></awsui-icon></div></div><code class="json ">"AWS::CloudFormation::Init" : <span>{</span>
    "configSets" : <span>{</span>
        "ascending" : [ "config1" , "config2" ],
        "descending" : [ "config2" , "config1" ]
    },
    "config1" : <span>{</span>
        "commands" : <span>{</span>
            "test" : <span>{</span>
                "command" : "echo \"$CFNTEST\" &gt; test.txt",
                "env" : <span>{</span> "CFNTEST" : "I come from config1." },
                "cwd" : "~"
            }
        }
    },
    "config2" : <span>{</span>
        "commands" : <span>{</span>
            "test" : <span>{</span>
                "command" : "echo \"$CFNTEST\" &gt; test.txt",
                "env" : <span>{</span> "CFNTEST" : "I come from config2" },
                "cwd" : "~"
            }
        }
    }
}     </code></pre>
         </div>
         <div id="YAML" name="YAML" class="section langfilter">
            <h4 id="aws-resource-cloudformation-init-configset-example1.yaml">YAML</h4>

            <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="复制"><awsui-icon name="copy"></awsui-icon></div></div><code class="yaml ">AWS::CloudFormation::Init: 
  configSets: 
    ascending: 
      - "config1"
      - "config2"
    descending: 
      - "config2"
      - "config1"
  config1: 
    commands: 
      test: 
        command: "echo \"$CFNTEST\" &gt; test.txt"
        env: 
          CFNTEST: "I come from config1."
        cwd: "~"
  config2: 
    commands: 
      test: 
        command: "echo \"$CFNTEST\" &gt; test.txt"
        env: 
          CFNTEST: "I come from config2"
        cwd: "~"</code></pre>
         </div>
          
            <h4 id="w9aac23c15c15c23c13b5b9">相关的 cfn-init 调用</h4>

            <p>以下示例 cfn-init 调用适用于前述示例配置集。为清晰起见，示例调用采用的是缩写形式，请参阅 <a href="./cfn-init.html">cfn-init</a> 了解完整语法。</p>
            <div class="itemizedlist">
                
                
            <ul class="itemizedlist"><li class="listitem">
                  <p>如果对 cfn-init 调用指定了 <code class="code">ascending</code> 配置集：</p>
                  <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="复制"><awsui-icon name="copy"></awsui-icon></div></div><code class="sh "><code class="userinput">cfn-init -c ascending</code></code></pre>
                  <p>脚本会先处理 <code class="code">config1</code>，然后再处理 <code class="code">config2</code>，而 test.txt 文件将包含文本 <code class="code">I
                        come from config2</code>。</p>
               </li><li class="listitem">
                  <p>如果对 cfn-init 调用指定了 <code class="code">descending</code> 配置集：</p>
                  <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="复制"><awsui-icon name="copy"></awsui-icon></div></div><code class="sh "><code class="userinput">cfn-init -c descending</code></code></pre>
                  <p>脚本会先处理 <code class="code">config2</code>，然后再处理 <code class="code">config1</code>，而 test.txt 文件将包含文本 <code class="code">I
                        come from config1</code>。</p>
               </li></ul></div>
          
       
       
         <h3 id="w9aac23c15c15c23c13b7">多个配置集</h3>

         <p>您可以创建多个配置集，并使用 cfn-init 脚本对它们进行一连串调用。每个配置集都包含配置键列表或对其他配置集的引用的列表。例如，以下模板代码段可创建三个配置集。第一个配置集<code class="code">test1</code> 包含一个名为 <code class="code">1</code> 的配置键。第二个配置集<code class="code">test2</code> 包含对 <code class="code">test1</code>配置集的引用和一个名为 <code class="code">2</code> 的配置键。在默认情况下，第三个配置集包含对配置集<code class="code">test2</code> 的引用。</p>
         <div id="JSON" name="JSON" class="section langfilter">
            <h4 id="aws-resource-cloudformation-init-configset-example2.json">JSON</h4>

            <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="复制"><awsui-icon name="copy"></awsui-icon></div></div><code class="json ">"AWS::CloudFormation::Init" : <span>{</span>
    "configSets" : <span>{</span>
        "test1" : [ "1" ],
        "test2" : [ <span>{</span> "ConfigSet" : "test1" }, "2" ],
        "default" : [ <span>{</span> "ConfigSet" : "test2" } ]
    },
    "1" : <span>{</span>
        "commands" : <span>{</span>
            "test" : <span>{</span>
                "command" : "echo \"$MAGIC\" &gt; test.txt",
                "env" : <span>{</span> "MAGIC" : "I come from the environment!" },
                "cwd" : "~"
            }
        }
    },
    "2" : <span>{</span>
        "commands" : <span>{</span>
            "test" : <span>{</span>
                "command" : "echo \"$MAGIC\" &gt;&gt; test.txt",
                "env" : <span>{</span> "MAGIC" : "I am test 2!" },
                "cwd" : "~"
            }
        }
    }
}</code></pre>
         </div>
         <div id="YAML" name="YAML" class="section langfilter">
            <h4 id="aws-resource-cloudformation-init-configset-example2.yaml">YAML</h4>

            <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="复制"><awsui-icon name="copy"></awsui-icon></div></div><code class="yaml ">AWS::CloudFormation::Init:
  1:
    commands:
      test:
        command: "echo \"$MAGIC\" &gt; test.txt"
        env:
          MAGIC: "I come from the environment!"
        cwd: "~"
  2:
    commands:
      test:
        command: "echo \"$MAGIC\" &gt;&gt; test.txt"
        env:
          MAGIC: "I am test 2!"
        cwd: "~"
  configSets: 
    test1:
      - "1"
    test2:
      -
        ConfigSet: "test1"
      - "2"
    default:
      -
        ConfigSet: "test2"</code></pre>
         </div>
          
            <h4 id="w9aac23c15c15c23c13b7b9">相关的 cfn-init 调用</h4>

            <p>以下 cfn-init 调用适用于前述模板代码段中声明的配置集。为清晰起见，示例调用采用的是缩写形式，请参阅 <a href="./cfn-init.html">cfn-init</a> 了解完整语法。</p>
            <div class="itemizedlist">
                
                
                
            <ul class="itemizedlist"><li class="listitem">
                  <p>如果您仅指定 <code class="code">test1</code>：</p>
                  <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="复制"><awsui-icon name="copy"></awsui-icon></div></div><code class="sh "><code class="userinput">cfn-init -c test1</code></code></pre>
                  <p>cfn-init 仅处理配置键 <code class="code">1</code>。</p>
               </li><li class="listitem">
                  <p>如果您仅指定 <code class="code">test2</code>：</p>
                  <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="复制"><awsui-icon name="copy"></awsui-icon></div></div><code class="sh "><code class="userinput">cfn-init -c test2</code></code></pre>
                  <p>cfn-init 会先处理配置键 <code class="code">1</code>，然后再处理配置键 <code class="code">2</code>。</p>
               </li><li class="listitem">
                  <p>如果您指定 <code class="code">default</code>配置集(或根本没有配置集)：</p>
                  <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="复制"><awsui-icon name="copy"></awsui-icon></div></div><code class="sh "><code class="userinput">cfn-init -c default</code></code></pre>
                  <p>如果您指定 configset <code class="code">test2</code>，则将获得相同的特性。</p>
               </li></ul></div>
          
       
    
      <h2 id="aws-resource-init-commands">命令</h2>

      <p>您可以使用命令键在 EC2 实例上执行命令。其执行顺序即为命令名称的字母顺序。</p>
      <div class="table-container"><div class="table-contents"><table id="w1348aac17c17c17c19c17b5"><thead>
               <tr>
                  <th>键</th>
                  <th>必需</th>
                  <th>描述</th>
               </tr>
            </thead>
               <tr>
                  <td tabindex="-1">
                     <p>命令</p>
                  </td>
                  <td tabindex="-1">必需</td>
                  <td tabindex="-1">
                     <p>指定要运行的命令的数组或字符串。如果您使用了数组，则不需要对空格字符进行转义或用引号将命令参数引起来。请勿使用数组指定多个命令。</p>
                  </td>
               </tr>
               <tr>
                  <td tabindex="-1">
                     <p>env</p>
                  </td>
                  <td tabindex="-1">可选</td>
                  <td tabindex="-1">
                     <p>设置该命令的环境变量。这个属性会覆盖而不是追加到现有的环境。</p>
                  </td>
               </tr>
               <tr>
                  <td tabindex="-1">
                     <p>cwd</p>
                  </td>
                  <td tabindex="-1">可选</td>
                  <td tabindex="-1">
                     <p>工作目录。</p>
                  </td>
               </tr>
               <tr>
                  <td tabindex="-1">
                     <p>测试</p>
                  </td>
                  <td tabindex="-1">可选</td>
                  <td tabindex="-1">
                     <p>用于确定 cfn-init 是否运行在命令键中指定的命令的测试命令。如果测试通过，则 cfn-init 将运行命令。cfn-init 脚本在命令解释器（如 Bash 或 <code>cmd.exe</code>）中运行测试。测试能否通过取决于解释器返回的退出代码。</p>
                     <p>对于 Linux，测试命令必须返回退出代码 <code class="code">0</code>，才表示测试通过。对于 Windows，测试命令必须返回 %ERRORLEVEL% <code class="code">0</code>。</p>
                  </td>
               </tr>
               <tr>
                  <td tabindex="-1">
                     <p>ignoreErrors</p>
                  </td>
                  <td tabindex="-1">可选</td>
                  <td tabindex="-1">
                     <p>一个布尔值，用于确定在命令键中包含的命令失败时（返回非零值）cfn-init 是否继续运行。如果您希望即使命令失败 cfn-init 也能继续运行，则请设置为 <code class="code">true</code>。如果您希望命令失败时 cfn-init 停止运行，则请设置为 <code class="code">false</code>。默认值为 <code class="code">false</code>。</p>
                  </td>
               </tr>
               <tr>
                  <td tabindex="-1">
                     <p>waitAfterCompletion</p>
                  </td>
                  <td tabindex="-1">可选</td>
                  <td tabindex="-1">
                     <p>仅限于 Windows 系统。指定命令执行结束后，在该命令引起重启的情况下需要等待的时间长短 (以秒为单位)。默认值为 60 秒，而值“forever”会使 cfn-init 退出，并且仅在重启完成后继续。如果您不想等待每条命令，请将该值设置为 <code class="code">0</code>。</p>
                  </td>
               </tr>
            </table></div></div>
       
         <h3 id="w9aac23c15c15c23c15b7">示例</h3>

         <p>以下示例代码段在 <code class="code">~/test.txt</code> 文件不存在时调用 echo 命令。</p>
         <div id="JSON" name="JSON" class="section langfilter">
            <h4 id="aws-resource-init-commands-example.json">JSON</h4>

            <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="复制"><awsui-icon name="copy"></awsui-icon></div></div><code class="json ">"commands" : <span>{</span>
    "test" : <span>{</span>
        "command" : "echo \"$MAGIC\" &gt; test.txt",
        "env" : <span>{</span> "MAGIC" : "I come from the environment!" },
        "cwd" : "~",
        "test" : "test ! -e ~/test.txt",
        "ignoreErrors" : "false"
    },
    "test2" : <span>{</span>
        "command" : "echo \"$MAGIC2\" &gt; test2.txt",
        "env" : <span>{</span> "MAGIC2" : "I come from the environment!" },
        "cwd" : "~",
        "test" : "test ! -e ~/test2.txt",
        "ignoreErrors" : "false"
    }
}</code></pre>
         </div>
         <div id="YAML" name="YAML" class="section langfilter">
            <h4 id="aws-resource-init-commands-example.yaml">YAML</h4>

            <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="复制"><awsui-icon name="copy"></awsui-icon></div></div><code class="yaml ">commands:
  test:
    command: "echo \"$MAGIC\" &gt; test.txt"
    env:
      MAGIC: "I come from the environment!"
    cwd: "~"
    test: "test ! -e ~/test.txt"
    ignoreErrors: "false"
  test2:
    command: "echo \"$MAGIC2\" &gt; test2.txt"
    env:
      MAGIC2: "I come from the environment!"
    cwd: "~"
    test: "test ! -e ~/test2.txt"
    ignoreErrors: "false"</code></pre>
         </div>
       
    
      <h2 id="aws-resource-init-files">文件</h2>

      <p>您可以使用 <code class="code">files</code> 密钥在 EC2 实例上创建文件。其内容既可以来自模板，也可以从 URL 抽取。这些文件会按词典顺序写入磁盘。下表列出了支持的键。</p>
      <div class="table-container"><div class="table-contents"><table id="w1348aac17c17c17c19c19b5"><thead>
               <tr>
                  <th>键</th>
                  <th>描述</th>
               </tr>
            </thead>
               <tr>
                  <td tabindex="-1">
                     <p>content</p>
                  </td>
                  <td tabindex="-1">
                     <p>字符串或格式正确的 JSON 对象。如果您将 JSON 对象用作内容，则 JSON 将被写到磁盘上的文件中。在 JSON 对象写入磁盘之前，对所有内置函数（例如 <code class="code">Fn::GetAtt</code> 或 <code class="code">Ref</code>）进行评估。在创建符号链接时，将符号链接目标指定为内容。</p>
                     <div class="awsdocs-note"><div class="awsdocs-note-title"><awsui-icon name="status-info" variant="link"></awsui-icon><h6>注意</h6></div><div class="awsdocs-note-text"><p>如果创建符号链接，帮助程序脚本会修改目标文件的权限。目前，您无法在不修改目标文件的权限的情况下创建符号链接。</p></div></div>
                  </td>
               </tr>
               <tr>
                  <td tabindex="-1">
                     <p>源</p>
                  </td>
                  <td tabindex="-1">
                     <p>用于加载文件的 URL。不能使用内容键指定该选项。</p>
                  </td>
               </tr>
               <tr>
                  <td tabindex="-1">
                     <p>encoding</p>
                  </td>
                  <td tabindex="-1">
                     <p>编码格式。仅限在内容为字符串时使用。如果使用的是源，则不会应用编码。</p>
                     <p>有效值：<code class="code">plain</code> | <code class="code">base64</code></p>
                  </td>
               </tr>
               <tr>
                  <td tabindex="-1">
                     <p>组</p>
                  </td>
                  <td tabindex="-1">
                     <p>拥有这个文件的组的名称。在 Windows 系统中不受支持。</p>
                  </td>
               </tr>
               <tr>
                  <td tabindex="-1">
                     <p>owner</p>
                  </td>
                  <td tabindex="-1">
                     <p>拥有这个文件的用户的名称。在 Windows 系统中不受支持。</p>
                  </td>
               </tr>
               <tr>
                  <td tabindex="-1">
                     <p>mode</p>
                  </td>
                  <td tabindex="-1">
                     <p>是一个六位数的八进制值，表示这个文件的模式。在 Windows 系统中不受支持。将前三位数用于符号链接，将后三位数用于设置权限。要创建符号链接，请指定 <code class="userinput">120<code class="replaceable">xxx</code></code>，其中 <code class="code">xxx</code> 定义目标文件的权限。要指定文件的权限，请使用最后三位，例如 <code class="userinput">000644</code>。</p>
                  </td>
               </tr>
               <tr>
                  <td tabindex="-1">
                     <p>身份验证</p>
                  </td>
                  <td tabindex="-1">
                     <p>要使用的身份验证方法的名称。这会覆盖任何默认的身份验证。您可以使用该属性选择通过 <a href="./aws-resource-authentication.html">AWS::CloudFormation::Authentication</a> 资源定义的身份验证方法。</p>
                  </td>
               </tr>
               <tr>
                  <td tabindex="-1">
                     <p>context</p>
                  </td>
                  <td tabindex="-1">
                     <p>指定需要作为 <a href="http://mustache.github.io/mustache.5.html" rel="noopener noreferrer" target="_blank"><span>Mustache 模板</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a>处理的文件的上下文。若要使用此键，必须已安装 <code class="code">aws-cfn-bootstrap</code> 1.3-11 或更高版本以及 <a href="https://github.com/defunkt/pystache" rel="noopener noreferrer" target="_blank"><span>pystache</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a>。</p>
                  </td>
               </tr>
            </table></div></div>
       
         <h3 id="w9aac23c15c15c23c17b7">示例</h3>

         <p>以下示例代码段将文件 setup.mysql 创建为大型安装的一部分。</p>
         <div id="JSON" name="JSON" class="section langfilter">
            <h4 id="aws-resource-init-setup-mysql.json">JSON</h4>
            <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="复制"><awsui-icon name="copy"></awsui-icon></div></div><code class="json ">"files" : <span>{</span>
  "/tmp/setup.mysql" : <span>{</span>
    "content" : <span>{</span> "Fn::Join" : ["", [
      "CREATE DATABASE ", <span>{</span> "Ref" : "DBName" }, ";\n",
      "CREATE USER '", <span>{</span> "Ref" : "DBUsername" }, "'@'localhost' IDENTIFIED BY '",
                       <span>{</span> "Ref" : "DBPassword" }, "';\n",
      "GRANT ALL ON ", <span>{</span> "Ref" : "DBName" }, ".* TO '", <span>{</span> "Ref" : "DBUsername" },
                       "'@'localhost';\n",
      "FLUSH PRIVILEGES;\n"
      ]]},
    "mode"  : "000644",
    "owner" : "root",
    "group" : "root"
  }
}</code></pre>
         </div>
         <div id="YAML" name="YAML" class="section langfilter">
            <h4 id="aws-resource-init-setup-mysql.yaml">YAML</h4>
            <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="复制"><awsui-icon name="copy"></awsui-icon></div></div><code class="yaml ">files: 
  /tmp/setup.mysql: 
    content: !Sub |
      CREATE DATABASE $<span>{</span>DBName};
      CREATE USER '$<span>{</span>DBUsername}'@'localhost' IDENTIFIED BY '$<span>{</span>DBPassword}';
      GRANT ALL ON $<span>{</span>DBName}.* TO '$<span>{</span>DBUsername}'@'localhost';
      FLUSH PRIVILEGES;
    mode: "000644"
    owner: "root"
    group: "root"</code></pre>
         </div>
         <p>您可在以下网址获取完整的模板：<a href="https://s3.amazonaws.com/cloudformation-templates-us-east-1/Drupal_Single_Instance.template" rel="noopener noreferrer" target="_blank"><span>https://s3.amazonaws.com/cloudformation-templates-us-east-1/Drupal_Single_Instance.template</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a></p>
         <p>下面的示例代码段创建指向现有文件 <code class="code">/tmp/myfile2.txt</code> 的符号链接 <code class="code">/tmp/myfile1.txt</code>。目标文件 <code class="code">/tmp/myfile1.txt</code> 的权限由模式值 <code class="code">644</code> 定义。</p>
         <div id="JSON" name="JSON" class="section langfilter">
            <h4 id="aws-resource-init-symlink.json">JSON</h4>
            <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="复制"><awsui-icon name="copy"></awsui-icon></div></div><code class="json ">"files" : <span>{</span>
  "/tmp/myfile2.txt" : <span>{</span>
    "content" : "/tmp/myfile1.txt",
    "mode" : "120644"
  }
}</code></pre>
         </div>
         <div id="YAML" name="YAML" class="section langfilter">
            <h4 id="aws-resource-init-symlink.yaml">YAML</h4>
            <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="复制"><awsui-icon name="copy"></awsui-icon></div></div><code class="yaml ">files:
  /tmp/myfile2.txt:
    content: "/tmp/myfile1.txt"
    mode: "120644"</code></pre>
         </div>
         <p>Mustache 模板主要用于创建配置文件。例如，您可以将配置文件存储在一个 S3 存储桶中，并从模板插入 Refs 和 GetAtts，而不是使用 <a href="./intrinsic-function-reference-join.html">Fn::Join</a>。以下示例代码段将“Content for test9”输出到 <code>/tmp/test9.txt</code>。</p>
         <div id="JSON" name="JSON" class="section langfilter">
            <h4 id="aws-resource-init-test9.json">JSON</h4>
            <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="复制"><awsui-icon name="copy"></awsui-icon></div></div><code class="json ">
"files" : <span>{</span>
    "/tmp/test9.txt" : <span>{</span>
        "content" : "Content for <span>{</span><span>{</span>name}}",
        "context" : <span>{</span> "name" : "test9" }
    }
} </code></pre>
         </div>
         <div id="YAML" name="YAML" class="section langfilter">
            <h4 id="aws-resource-init-test9.yaml">YAML</h4>
            <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="复制"><awsui-icon name="copy"></awsui-icon></div></div><code class="yaml ">files:
  /tmp/test9.txt:
    content: "Content for <span>{</span><span>{</span>name}}"
    context:
      name: "test9"</code></pre>
         </div>
         <p>在使用 Mustache 模板时，请注意以下几点：</p>
         <div class="itemizedlist">
             
             
             
             
         <ul class="itemizedlist"><li class="listitem">
               <p>必须存在用于要处理的文件的上下文键。</p>
            </li><li class="listitem">
               <p>上下文键必须是键值映射，但可以嵌套。</p>
            </li><li class="listitem">
               <p>您可以使用内容键来处理含有内联内容的文件，并使用源键来处理远程文件。</p>
            </li><li class="listitem">
               <p>Mustache 支持取决于 pystache 版本。版本 0.5.2 支持 <a href="https://github.com/mustache/spec/tree/v1.1.2" rel="noopener noreferrer" target="_blank"><span>Mustache 1.1.2 规范</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a>。</p>
            </li></ul></div>
       
    
      <h2 id="aws-resource-init-groups">组</h2>

      <p>您可以使用组键创建 Linux/UNIX 组，并分配组 ID。该组键在 Windows 系统中不受支持。</p>
      <p>要创建组，请添加新的密钥值对，将新的组名映射到可选组 ID。组键可以包含一个或多个组名。下表列出了可用的密钥。</p>
      <div class="table-container"><div class="table-contents"><table id="w1348aac17c17c17c19c21b7"><thead>
               <tr>
                  <th>键</th>
                  <th>描述</th>
               </tr>
            </thead>
               <tr>
                  <td tabindex="-1">
                     <p>
                        <code class="code">gid</code></p>
                  </td>
                  <td tabindex="-1">
                     <p>组 ID 编号。</p>
                     <p>如果指定了组 ID，且存在该名称的组，那么创建组将失败。如果其他组已使用指定的 ID，则操作系统可能会拒绝创建该组。</p>
                     <p>例如：<code class="code"><span>{</span> "gid" : "23" }</code></p>
                  </td>
               </tr>
            </table></div></div>
      
       
         <h3 id="aws-resource-init-groups-snippet">示例代码段</h3>

         <p>以下代码段指定两个组，其中一个名为 <code class="code">groupOne</code> 但没有分配组 ID，另一个组名为 <code class="code">groupTwo</code>，指定的相应组 ID 值为 <code class="code">45</code>。</p>
         <div id="JSON" name="JSON" class="section langfilter">
            <h4 id="aws-resource-init-groups-snippet.json">JSON</h4>

            <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="复制"><awsui-icon name="copy"></awsui-icon></div></div><code class="json ">"groups" : <span>{</span>
    "groupOne" : <span>{</span>},
    "groupTwo" : <span>{</span> "gid" : "45" }
}</code></pre>
         </div>
         
         <div id="YAML" name="YAML" class="section langfilter">
            <h4 id="aws-resource-init-groups-snippet.yaml">YAML</h4>

            <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="复制"><awsui-icon name="copy"></awsui-icon></div></div><code class="yaml ">groups:
  groupOne: <span>{</span>}
  groupTwo:
    gid: "45"</code></pre>
         </div>
       
    
      <h2 id="aws-resource-init-packages">软件包</h2>

      <p>您可以使用包键下载和安装各种预包装的应用程序和组件。在 Windows 系统上，软件包键仅支持 MSI 安装程序。</p>
       
         <h3 id="aws-resource-init-packages-formats">支持的软件包格式</h3>

         <p>cfn-init 脚本目前支持以下软件包格式：apt、msi、python、rpm、rubygems、yum 和 Zypper。软件包的处理顺序如下：先是 rpm、yum/apt/zypper，然后是 rubygems 和 python。rubygems 和 python 之间没有处理顺序，且不保证以任何顺序安装每个包管理器内的包。</p>
       
       
         <h3 id="aws-resource-init-packages-versions">指定版本</h3>

         <p>在每个包管理器内，会使用包名和一系列版本对每个包进行指定。版本可以是字符串、一系列版本、空字符串或者空列表。空字符串或者空列表表示您需要最新的版本。对于 rpm 管理器，版本是以磁盘或 URL 上的文件的路径的方式指定的。</p>
         <p>如果您指定软件包的版本，cfn-init 将尝试安装该版本，即使已在实例上安装该软件包的更新版本。一些包管理器支持多个版本，但其他的包管理器可能不支持。有关更多信息，请查看相关的包管理器文档。如果您不指定版本且已安装某版本的软件包，则 cfn-init 脚本将不安装新版本 —，因为它假定您要沿用现有版本。</p>
       
       
         <h3 id="aws-resource-init-packages-snippet">示例代码段</h3>

          
            <h4 id="w9aac23c15c15c23c21b9b3">RPM、yum、Rubygems 和 Zypper</h4>

            <p>下面的代码段为 rpm 指定版本 URL，从 yum 和 Zypper 请求最新版本并从 rubygems 请求 chef 的版本 0.10.2：</p>
            <div id="JSON" name="JSON" class="section langfilter">
               <h5 id="aws-resource-init-packages-example1.json">JSON</h5>

               <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="复制"><awsui-icon name="copy"></awsui-icon></div></div><code class="json ">"rpm" : <span>{</span>
  "epel" : "http://download.fedoraproject.org/pub/epel/5/i386/epel-release-5-4.noarch.rpm"
},
"yum" : <span>{</span>
  "httpd" : [],
  "php" : [],
  "wordpress" : []
},
"rubygems" : <span>{</span>
  "chef" : [ "0.10.2" ]
},
"zypper" : <span>{</span>
  "git" : []
}</code></pre>
            </div>
            <div id="YAML" name="YAML" class="section langfilter">
               <h5 id="aws-resource-init-packages-example1.yaml">YAML</h5>

               <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="复制"><awsui-icon name="copy"></awsui-icon></div></div><code class="yaml ">rpm:
  epel: "http://download.fedoraproject.org/pub/epel/5/i386/epel-release-5-4.noarch.rpm"
yum:
  httpd: []
  php: []
  wordpress: []
rubygems:
  chef:
    - "0.10.2"
zypper:
  git: []</code></pre>
            </div>
          
          
            <h4 id="w9aac23c15c15c23c21b9b5">MSI 包</h4>

            <p>下面的代码段为 MSI 包指定 URL：</p>
            <div id="JSON" name="JSON" class="section langfilter">
               <h5 id="aws-resource-init-packages-example2.json">JSON</h5>

               <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="复制"><awsui-icon name="copy"></awsui-icon></div></div><code class="json ">"msi" : <span>{</span>
  "awscli" : "https://s3.amazonaws.com/aws-cli/AWSCLI64.msi"
}</code></pre>
            </div>
            <div id="YAML" name="YAML" class="section langfilter">
               <h5 id="aws-resource-init-packages-example2.yaml">YAML</h5>

               <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="复制"><awsui-icon name="copy"></awsui-icon></div></div><code class="yaml ">msi:
  awscli: "https://s3.amazonaws.com/aws-cli/AWSCLI64.msi"</code></pre>
            </div>
          
       
    
      <h2 id="aws-resource-init-services">服务</h2>

      <p>您可以使用此服务键来定义实例启动后应启用或禁用哪些服务。在 Linux 系统上，将通过使用 sysvinit 或 systemd 来支持此键。在 Windows 系统上，将通过使用 Windows 服务管理器来支持此键。</p>
      <p>服务键还支持您指定源、软件包和文件之间的相关性，这样如果由于安装文件导致重启时，cfn-init 会处理服务重启部分。例如，如果您下载 Apache HTTP Server 软件包，则在堆栈创建过程中，软件包安装将自动启动 Apache HTTP Server。然而，如果 Apache HTTP Server 配置在堆栈创建过程的后期被更新，则要等到重启 Apache 服务器之后，更新才会生效。您可以使用服务键来确保 Apache HTTP 服务启动。</p>
      <p>下表列出了支持的键。</p>
      <div class="table-container"><div class="table-contents"><table id="w1348aac17c17c17c19c25b9"><thead>
               <tr>
                  <th>键</th>
                  <th>描述</th>
               </tr>
            </thead>
               <tr>
                  <td tabindex="-1">
                     <p>ensureRunning</p>
                  </td>
                  <td tabindex="-1">
                     <p>设置为 true 可确保 cfn-init 结束后服务仍保持运行。</p>
                     <p>设置为 false 可确保 cfn-init 结束后服务不再运行。</p>
                     <p>忽略该键，将不更改服务状态。</p>
                  </td>
               </tr>
               <tr>
                  <td tabindex="-1">
                     <p>已启用</p>
                  </td>
                  <td tabindex="-1">
                     <p>设置为 true 可确保启动时自动启动服务。</p>
                     <p>设置为 false 可确保启动时不会自动启动服务。</p>
                     <p>忽略该键，将不更改这个属性。</p>
                  </td>
               </tr>
               <tr>
                  <td tabindex="-1">
                     <p>文件</p>
                  </td>
                  <td tabindex="-1">
                     <p>一系列文件。如果 cfn-init 直接通过文件块更改其中一个文件，则该服务将重新启动。</p>
                  </td>
               </tr>
               <tr>
                  <td tabindex="-1">
                     <p>来源</p>
                  </td>
                  <td tabindex="-1">
                     <p>一系列目录。如果 cfn-init 将存档扩展到这些目录之一，则此服务将重启。</p>
                  </td>
               </tr>
               <tr>
                  <td tabindex="-1">
                     <p>软件包</p>
                  </td>
                  <td tabindex="-1">
                     <p>软件包管理器映射至软件包名称列表。如果 cfn-init 安装或更新其中一个软件包，则此服务将重启。</p>
                  </td>
               </tr>
               <tr>
                  <td tabindex="-1">
                     <p>命令</p>
                  </td>
                  <td tabindex="-1">
                     <p>一系列命令名称。如果 cfn-init 运行指定的命令，则此服务将重启。</p>
                  </td>
               </tr>
            </table></div></div>
       
         <h3 id="w9aac23c15c15c23c23c11">示例</h3>

          
            <h4 id="w9aac23c15c15c23c23c11b3">Linux</h4>

            <p>下面的 Linux 代码段配置服务如下：</p>
            <div class="itemizedlist">
                
                
                
            <ul class="itemizedlist"><li class="listitem">
                  <p>如果 cfn-init 修改了 <code class="code">/etc/nginx/nginx.conf</code> 或 <code class="code">/var/www/html</code>，则 nginx 服务会重启。</p>
               </li><li class="listitem">
                  <p>如果使用 yum 安装或更新 php 或 spawn-fcgi，则 php-fastcgi 服务将重启。</p>
               </li><li class="listitem">
                  <p>sendmail 服务将使用 systemd 停止和禁用。</p>
               </li></ul></div>
            <div id="JSON" name="JSON" class="section langfilter">
               <h5 id="aws-resource-init-services-example1.json">JSON</h5>

               <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="复制"><awsui-icon name="copy"></awsui-icon></div></div><code class="json ">"services" : <span>{</span>
  "sysvinit" : <span>{</span>
    "nginx" : <span>{</span>
      "enabled" : "true",
      "ensureRunning" : "true",
      "files" : ["/etc/nginx/nginx.conf"],
      "sources" : ["/var/www/html"]
    },
    "php-fastcgi" : <span>{</span>
      "enabled" : "true",
      "ensureRunning" : "true",
      "packages" : <span>{</span> "yum" : ["php", "spawn-fcgi"] }
    }
  },
  "systemd": <span>{</span>
    "sendmail" : <span>{</span>
      "enabled" : "false",
      "ensureRunning" : "false"
    }
  }
}</code></pre>
            </div>
            <div id="YAML" name="YAML" class="section langfilter">
               <h5 id="aws-resource-init-services-example1.yaml">YAML</h5>

               <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="复制"><awsui-icon name="copy"></awsui-icon></div></div><code class="yaml ">services:
  sysvinit:
    nginx:
      enabled: "true"
      ensureRunning: "true"
      files:
        - "/etc/nginx/nginx.conf"
      sources:
        - "/var/www/html"
    php-fastcgi:
      enabled: "true"
      ensureRunning: "true"
      packages:
        yum:
          - "php"
          - "spawn-fcgi"
  systemd:
    sendmail:
      enabled: "false"
      ensureRunning: "false"</code></pre>
               <p>要将 systemd 与服务一起使用，该服务必须配置一个 systemd 单元文件。以下单元文件允许 systemd 启动和停止多用户服务目标中的 <a href="./cfn-hup.html">cfn-hup</a> 进程守护程序：</p>
                  
                  <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="复制"><awsui-icon name="copy"></awsui-icon></div></div><code class="conf ">[Unit]
Description=cfn-hup daemon
[Service]
ExecStart=/usr/bin/cfn-hup -v
PIDFile=/var/run/cfn-hup.pid
[Install]
WantedBy=multi-user.target</code></pre>
               <p>此配置假设 cfn-hup 安装在 <em>/usr/bin</em> 目录下。但是，安装 cfn-hup 的实际位置可能因平台而不同。您可以通过在 <em>/etc/systemd/system/cfn-hup.service.d/override.conf</em> 中创建覆盖文件来覆盖此配置，如下所示：</p>
                  
                  <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="复制"><awsui-icon name="copy"></awsui-icon></div></div><code class="conf "># In this example, cfn-hup executable is available under /usr/local/bin
[Service]
ExecStart=
ExecStart=/usr/local/bin/cfn-hup -v</code></pre>
            </div>
          
          
            <h4 id="aws-resource-init-windows-example">Windows</h4>

            <p>下面的 Windows 代码段启动 <a href="./cfn-hup.html">cfn-hup</a> 服务，将其设置为自动，并在 <code class="code">cfn-init</code> 修改指定配置文件的情况下重新启动该服务：</p>
            <div id="JSON" name="JSON" class="section langfilter">
               <h5 id="aws-resource-init-services-example2.json">JSON</h5>

               <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="复制"><awsui-icon name="copy"></awsui-icon></div></div><code class="json ">"services" : <span>{</span>
  "windows" : <span>{</span>
    "cfn-hup" : <span>{</span>
      "enabled" : "true",
      "ensureRunning" : "true",
      "files" : ["c:\\cfn\\cfn-hup.conf", "c:\\cfn\\hooks.d\\cfn-auto-reloader.conf"]
    }
  }
}</code></pre>
            </div>
            <div id="YAML" name="YAML" class="section langfilter">
               <h5 id="aws-resource-init-services-example2.yaml">YAML</h5>

               <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="复制"><awsui-icon name="copy"></awsui-icon></div></div><code class="yaml ">services:
  windows:
    cfn-hup:
      enabled: "true"
      ensureRunning: "true"
      files:
        - "c:\\cfn\\cfn-hup.conf"
        - "c:\\cfn\\hooks.d\\cfn-auto-reloader.conf"</code></pre>
            </div>
          
       
    
      <h2 id="aws-resource-init-sources">源</h2>

      <p>您可以使用该资源键来下载存档文件并在 EC2 实例上的目标目录中取出文件。此键在 Linux 和 Windows 系统中完全受支持。</p>
       
         <h6>支持的格式</h6>
         <p>支持的格式为：</p>
       
      <div class="itemizedlist">
          
          
          
          
      <ul class="itemizedlist"><li class="listitem">
            <p><code class="code">tar</code></p>
         </li><li class="listitem">
            <p><code class="code">tar+gzip</code></p>
         </li><li class="listitem">
            <p><code class="code">tar+bz2</code></p>
         </li><li class="listitem">
            <p><code class="code">zip</code></p>
         </li></ul></div>
     
         <h3 id="aws-resource-init-sources-examples">示例</h3>
      
            <h4 id="aws-resource-init-sources-examples-github">GitHub</h4>
            <p>如果您将 GitHub 用作源控制系统，则可以使用 cfn-init 和源打包机制来提取特定的应用程序版本。GitHub 允许您通过 URL 从特定版本创建 .zip 或 .tar，如下所示：</p>
            <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="复制"><awsui-icon name="copy"></awsui-icon></div></div><code class="text ">https://github.com/&lt;your directory&gt;/(zipball|tarball)/&lt;version&gt;</code></pre>
            <p>例如，下面的代码段会将版本 <em>main</em> 作为一个 <code>.tar</code> 文件拉取。</p>
            <div id="JSON" name="JSON" class="section langfilter">
               <h5 id="aws-resource-init-sources-example1.json">JSON</h5>

               <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="复制"><awsui-icon name="copy"></awsui-icon></div></div><code class="json ">"sources" : <span>{</span>
  "/etc/puppet" : "https://github.com/user1/cfn-demo/tarball/main"
  }</code></pre>
            </div>
            <div id="YAML" name="YAML" class="section langfilter">
               <h5 id="aws-resource-init-sources-example1.yaml">YAML</h5>

               <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="复制"><awsui-icon name="copy"></awsui-icon></div></div><code class="yaml ">sources:
  /etc/puppet: "https://github.com/user1/cfn-demo/tarball/main"</code></pre>
            </div>
          
      
            <h4 id="aws-resource-init-sources-examples-s3">S3Bucket</h4>
            <p>以下示例从 S3 桶下载一个 tarball 并将其解压到 <code class="code">/etc/myapp</code>：</p>
            <div class="awsdocs-note"><div class="awsdocs-note-title"><awsui-icon name="status-info" variant="link"></awsui-icon><h6>注意</h6></div><div class="awsdocs-note-text"><p>您可以对来源使用身份验证凭证，但不能将身份验证键放在源数据块中。相反，您可以将存储桶密钥包含在 <code class="code">S3AccessCreds</code> 数据块中。有关 Amazon S3 身份验证凭证的更多信息，请参阅 <a href="./aws-resource-authentication.html">AWS::CloudFormation::Authentication</a>。</p><p><span>有关示例，请参阅<a href="https://s3.amazonaws.com/cloudformation-templates-us-east-1/S3Bucket_SourceAuth.template" rel="noopener noreferrer" target="_blank"><span>示例模板</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a>。</span></p></div></div>
            <div id="JSON" name="JSON" class="section langfilter">
               <h5 id="aws-resource-init-sources-example2.json">JSON</h5>

               <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="复制"><awsui-icon name="copy"></awsui-icon></div></div><code class="json ">"sources" : <span>{</span>
  "/etc/myapp" : "https://s3.amazonaws.com/mybucket/myapp.tar.gz"
  }</code></pre>
               
               
               

            </div>
            <div id="YAML" name="YAML" class="section langfilter">
               <h5 id="aws-resource-init-sources-example2.yaml">YAML</h5>

               <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="复制"><awsui-icon name="copy"></awsui-icon></div></div><code class="yaml ">sources:
  /etc/myapp: "https://s3.amazonaws.com/mybucket/myapp.tar.gz"</code></pre>
               
               
               


            </div>
          
       
    
      <h2 id="aws-resource-init-users">用户</h2>

      <p>您可以使用用户键在 EC2 实例上创建 Linux/UNIX 用户。该用户键在 Windows 系统中不受支持。</p>
      <p>下表列出了支持的键。</p>
      <div class="table-container"><div class="table-contents"><table id="w1348aac17c17c17c19c29b7"><thead>
               <tr>
                  <th>键</th>
                  <th>描述</th>
               </tr>
            </thead>
               <tr>
                  <td tabindex="-1">
                     <p>uid</p>
                  </td>
                  <td tabindex="-1">
                     <p>用户 ID。如果用户名还有另一个用户 ID，那么此创建过程会失败。如果该用户 ID 已分配给现有用户，则操作系统可能会拒绝创建请求。</p>
                  </td>
               </tr>
               <tr>
                  <td tabindex="-1">
                     <p>groups</p>
                  </td>
                  <td tabindex="-1">
                     <p>一系列组名。该用户将被添加到列表的每个组中。</p>
                  </td>
               </tr>
               <tr>
                  <td tabindex="-1">
                     <p>homeDir</p>
                  </td>
                  <td tabindex="-1">
                     <p>用户的主目录。</p>
                  </td>
               </tr>
            </table></div></div>
       
         <h3 id="aws-resource-init-users-example">示例</h3>

         <p>创建的用户属于非交互式系统用户，带有 <code class="code">/sbin/nologin</code> Shell。这是特意设计的，无法修改。</p>
         <div id="JSON" name="JSON" class="section langfilter">
            <h4 id="aws-resource-init-users-example.json">JSON</h4>
            <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="复制"><awsui-icon name="copy"></awsui-icon></div></div><code class="json ">"users" : <span>{</span>
    "myUser" : <span>{</span>
        "groups" : ["groupOne", "groupTwo"],
        "uid" : "50",
        "homeDir" : "/tmp"
    }
}</code></pre>
         </div>
         <div id="YAML" name="YAML" class="section langfilter">
            <h4 id="aws-resource-init-users-example.yaml">YAML</h4>
            <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="复制"><awsui-icon name="copy"></awsui-icon></div></div><code class="yaml ">users:
  myUser:
    groups:
      - "groupOne"
      - "groupTwo"
    uid: "50"
    homeDir: "/tmp"</code></pre>
         </div>
       
   <awsdocs-copyright class="copyright-print"></awsdocs-copyright><awsdocs-thumb-feedback right-edge="{{$ctrl.thumbFeedbackRightEdge}}"></awsdocs-thumb-feedback></div><noscript><div><div><div><div id="js_error_message"><p><img src="https://d1ge0kk1l5kms0.cloudfront.net/images/G/01/webservices/console/warning.png" alt="警告" /> <strong>Javascript 在您的浏览器中被禁用或不可用。</strong></p><p>要使用 Amazon Web Services 文档，必须启用 Javascript。请参阅浏览器的帮助页面以了解相关说明。</p></div></div></div></div></noscript><div id="main-col-footer" class="awsui-util-font-size-0"><div id="doc-conventions"><a target="_top" href="/general/latest/gr/docconventions.html">文档惯例</a></div><div class="prev-next"><div id="previous" class="prev-link" accesskey="p" href="./aws-resource-authentication.html">AWS::CloudFormation::Authentication</div><div id="next" class="next-link" accesskey="n" href="./aws-resource-cloudformation-interface.html">AWS::CloudFormation::Interface</div></div></div><awsdocs-page-utilities></awsdocs-page-utilities></div><div id="quick-feedback-yes" style="display: none;"><div class="title">此页面对您有帮助吗？- 是</div><div class="content"><p>感谢您对我们工作的肯定！</p><p>如果不耽误您的时间，请告诉我们做得好的地方，让我们做得更好。</p><p><awsui-button id="fblink" rel="noopener noreferrer" target="_blank" text="反馈" click="linkClick($event)" href="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=CloudFormation&amp;topic_url=https://docs.aws.amazon.com/zh_cn/AWSCloudFormation/latest/UserGuide/aws-resource-init.html"></awsui-button></p></div></div><div id="quick-feedback-no" style="display: none;"><div class="title">此页面对您有帮助吗？- 否</div><div class="content"><p>感谢您告诉我们本页内容还需要完善。很抱歉让您失望了。</p><p>如果不耽误您的时间，请告诉我们如何改进文档。</p><p><awsui-button id="fblink" rel="noopener noreferrer" target="_blank" text="反馈" click="linkClick($event)" href="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=CloudFormation&amp;topic_url=https://docs.aws.amazon.com/zh_cn/AWSCloudFormation/latest/UserGuide/aws-resource-init.html"></awsui-button></p></div></div></div></body></div></awsdocs-view><div class="page-loading-indicator" id="page-loading-indicator"><awsui-spinner size="large"></awsui-spinner></div></div><div id="tools-panel" dom-region="tools"><awsdocs-tools-panel id="awsdocs-tools-panel"></awsdocs-tools-panel></div></awsui-app-layout><awsdocs-cookie-banner class="doc-cookie-banner"></awsdocs-cookie-banner></div></body></html>