<!DOCTYPE html>
    <html xmlns="http://www.w3.org/1999/xhtml" lang="zh-CN"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>AWS CloudFormation 最佳实践 - AWS CloudFormation</title><meta name="viewport" content="width=device-width,initial-scale=1" /><meta name="assets_root" content="/assets" /><meta name="target_state" content="best-practices" /><meta name="default_state" content="best-practices" /><link rel="icon" type="image/ico" href="/assets/images/favicon.ico" /><link rel="shortcut icon" type="image/ico" href="/assets/images/favicon.ico" /><link rel="canonical" href="https://docs.aws.amazon.com/zh_cn/AWSCloudFormation/latest/UserGuide/best-practices.html" /><meta name="description" content="使用最佳实践来帮助您更高效、更安全地使用 AWS CloudFormation。" /><meta name="deployment_region" content="IAD" /><meta name="product" content="AWS CloudFormation" /><meta name="guide" content="用户指南" /><meta name="abstract" content="根据此用户指南，使用 AWS CloudFormation 以可预见方式反复创建和管理 AWS 基础设施部署。" /><meta name="guide-locale" content="zh_cn" /><meta name="tocs" content="toc-contents.json" /><link rel="canonical" href="https://docs.aws.amazon.com/zh_cn/AWSCloudFormation/latest/UserGuide/best-practices.html" /><link rel="alternative" href="https://docs.aws.amazon.com/id_id/AWSCloudFormation/latest/UserGuide/best-practices.html" hreflang="id-id" /><link rel="alternative" href="https://docs.aws.amazon.com/id_id/AWSCloudFormation/latest/UserGuide/best-practices.html" hreflang="id" /><link rel="alternative" href="https://docs.aws.amazon.com/de_de/AWSCloudFormation/latest/UserGuide/best-practices.html" hreflang="de-de" /><link rel="alternative" href="https://docs.aws.amazon.com/de_de/AWSCloudFormation/latest/UserGuide/best-practices.html" hreflang="de" /><link rel="alternative" href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/best-practices.html" hreflang="en-us" /><link rel="alternative" href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/best-practices.html" hreflang="en" /><link rel="alternative" href="https://docs.aws.amazon.com/es_es/AWSCloudFormation/latest/UserGuide/best-practices.html" hreflang="es-es" /><link rel="alternative" href="https://docs.aws.amazon.com/es_es/AWSCloudFormation/latest/UserGuide/best-practices.html" hreflang="es" /><link rel="alternative" href="https://docs.aws.amazon.com/fr_fr/AWSCloudFormation/latest/UserGuide/best-practices.html" hreflang="fr-fr" /><link rel="alternative" href="https://docs.aws.amazon.com/fr_fr/AWSCloudFormation/latest/UserGuide/best-practices.html" hreflang="fr" /><link rel="alternative" href="https://docs.aws.amazon.com/it_it/AWSCloudFormation/latest/UserGuide/best-practices.html" hreflang="it-it" /><link rel="alternative" href="https://docs.aws.amazon.com/it_it/AWSCloudFormation/latest/UserGuide/best-practices.html" hreflang="it" /><link rel="alternative" href="https://docs.aws.amazon.com/ja_jp/AWSCloudFormation/latest/UserGuide/best-practices.html" hreflang="ja-jp" /><link rel="alternative" href="https://docs.aws.amazon.com/ja_jp/AWSCloudFormation/latest/UserGuide/best-practices.html" hreflang="ja" /><link rel="alternative" href="https://docs.aws.amazon.com/ko_kr/AWSCloudFormation/latest/UserGuide/best-practices.html" hreflang="ko-kr" /><link rel="alternative" href="https://docs.aws.amazon.com/ko_kr/AWSCloudFormation/latest/UserGuide/best-practices.html" hreflang="ko" /><link rel="alternative" href="https://docs.aws.amazon.com/pt_br/AWSCloudFormation/latest/UserGuide/best-practices.html" hreflang="pt-br" /><link rel="alternative" href="https://docs.aws.amazon.com/pt_br/AWSCloudFormation/latest/UserGuide/best-practices.html" hreflang="pt" /><link rel="alternative" href="https://docs.aws.amazon.com/zh_cn/AWSCloudFormation/latest/UserGuide/best-practices.html" hreflang="zh-cn" /><link rel="alternative" href="https://docs.aws.amazon.com/zh_tw/AWSCloudFormation/latest/UserGuide/best-practices.html" hreflang="zh-tw" /><link rel="alternative" href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/best-practices.html" hreflang="x-default" /><meta name="feedback-item" content="CloudFormation" /><meta name="this_doc_product" content="AWS CloudFormation" /><meta name="this_doc_guide" content="用户指南" /><script defer="" src="/assets/r/vendor4.js?version=2021.12.02"></script><script defer="" src="/assets/r/vendor3.js?version=2021.12.02"></script><script defer="" src="/assets/r/vendor1.js?version=2021.12.02"></script><script defer="" src="/assets/r/awsdocs-common.js?version=2021.12.02"></script><script defer="" src="/assets/r/awsdocs-doc-page.js?version=2021.12.02"></script><link href="/assets/r/vendor4.css?version=2021.12.02" rel="stylesheet" /><link href="/assets/r/awsdocs-common.css?version=2021.12.02" rel="stylesheet" /><link href="/assets/r/awsdocs-doc-page.css?version=2021.12.02" rel="stylesheet" /><script async="" id="awsc-panorama-bundle" type="text/javascript" src="https://prod.pa.cdn.uis.awsstatic.com/panorama-nav-init.js" data-config="{'appEntity':'aws-documentation','region':'us-east-1','service':'cloudformation'}"></script><meta id="panorama-serviceSubSection" value="用户指南" /><meta id="panorama-serviceConsolePage" value="AWS CloudFormation 最佳实践" /></head><body class="awsdocs awsui"><div class="awsdocs-container"><awsdocs-header></awsdocs-header><awsui-app-layout id="app-layout" class="awsui-util-no-gutters" ng-controller="ContentController as $ctrl" header-selector="awsdocs-header" navigation-hide="false" navigation-width="$ctrl.navWidth" navigation-open="$ctrl.navOpen" navigation-change="$ctrl.onNavChange($event)" tools-hide="$ctrl.hideTools" tools-width="$ctrl.toolsWidth" tools-open="$ctrl.toolsOpen" tools-change="$ctrl.onToolsChange($event)"><div id="guide-toc" dom-region="navigation"><awsdocs-toc></awsdocs-toc></div><div id="main-column" dom-region="content" tabindex="-1"><awsdocs-view class="awsdocs-view"><div id="awsdocs-content"><head><title>AWS CloudFormation 最佳实践 - AWS CloudFormation</title><meta name="rss" content="aws-cloudformation-release-notes.rss" /><meta name="forums" content="http://forums.aws.amazon.com/forum.jspa?forumID=92" /><meta name="feedback" content="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=CloudFormation&amp;topic_url=https://docs.aws.amazon.com/zh_cn/AWSCloudFormation/latest/UserGuide/best-practices.html" /><meta name="feedback-yes" content="feedbackyes.html?topic_url=https://docs.aws.amazon.com/zh_cn/AWSCloudFormation/latest/UserGuide/best-practices.html" /><meta name="feedback-no" content="feedbackno.html?topic_url=https://docs.aws.amazon.com/zh_cn/AWSCloudFormation/latest/UserGuide/best-practices.html" /><meta name="keywords" content="CloudFormation,AWSCloudFormation,资源预置,资源配置,基础设施管理,CloudFormer,CloudFormation 堆栈,CloudFormation 堆栈集,CloudFormation 模板,更改集" /><script type="application/ld+json">
{
    "@context" : "https://schema.org",
    "@type" : "BreadcrumbList",
    "itemListElement" : [
      {
        "@type" : "ListItem",
        "position" : 1,
        "name" : "AWS",
        "item" : "https://aws.amazon.com"
      },
      {
        "@type" : "ListItem",
        "position" : 2,
        "name" : "AWS CloudFormation",
        "item" : "https://docs.aws.amazon.com/cloudformation/index.html"
      },
      {
        "@type" : "ListItem",
        "position" : 3,
        "name" : "用户指南",
        "item" : "https://docs.aws.amazon.com/zh_cn/AWSCloudFormation/latest/UserGuide"
      },
      {
        "@type" : "ListItem",
        "position" : 4,
        "name" : "AWS CloudFormation 最佳实践",
        "item" : "https://docs.aws.amazon.com/zh_cn/AWSCloudFormation/latest/UserGuide/best-practices.html"
      }
    ]
}
</script></head><body><div id="main"><div style="display: none"></div><div id="breadcrumbs" class="breadcrumb"><a href="https://aws.amazon.com">AWS</a><a href="/index.html">文档</a><a href="/cloudformation/index.html">AWS CloudFormation</a><a href="Welcome.html">用户指南</a></div><div id="page-toc-src"><a href="#shortenfeedbackloop">缩短反馈循环以提高传输速度</a><a href="#organizingstacks">按生命周期和所有权组织您的堆栈</a><a href="#cross-stack">使用跨堆栈引用来导出共享资源</a><a href="#limits">验证所有资源类型的配额</a><a href="#reuse">重复使用模板以在多个环境中复制堆栈</a><a href="#modules-reuse">使用模块重复使用资源配置</a><a href="#parmtypes">使用 AWS 特定的参数类型</a><a href="#parmconstraints">使用参数约束</a><a href="#pseudoparameters">使用伪参数来提高可移植性</a><a href="#cfninit">使用 AWS::CloudFormation::Init 在 Amazon EC2 实例上部署软件应用程序</a><a href="#helper-scripts">使用最新的帮助程序脚本</a><a href="#validate">在使用模板前先验证模板</a><a href="#donttouch">通过 AWS CloudFormation 管理所有堆栈资源</a><a href="#cfn-best-practices-changesets">更新堆栈之前创建更改集</a><a href="#stackpolicy">使用堆栈策略</a><a href="#code">使用代码审查和修订控制来管理您的模板</a><a href="#update-ec2-linux">定期更新您的 Amazon EC2 实例</a></div><div id="main-content" class="awsui-util-container"><div id="main-col-body"><awsdocs-language-banner data-service="$ctrl.pageService"></awsdocs-language-banner><h1 class="topictitle" id="best-practices">AWS CloudFormation 最佳实践</h1><div class="awsdocs-page-header-container"><awsdocs-page-header></awsdocs-page-header><awsdocs-filter-selector id="awsdocs-filter-selector"></awsdocs-filter-selector></div><p>最佳实践是一些建议，可帮助您在整个工作流程中更高效、更安全地使用 AWS CloudFormation。了解如何执行以下操作：计划和组织您的堆栈，创建描述您的资源以及在这些资源上运行的软件应用程序的模板，以及管理您的堆栈及其资源。以下最佳实践基于来自当前 CloudFormation 客户的实际经验。</p><div class="variablelist">
     
     
     
  <dl>
      <dt><b><span class="term">计划和组织</span></b></dt>
      <dd>
        <div class="itemizedlist">
           
           
           
           
           
           
           
        <ul class="itemizedlist"><li class="listitem">
            <p><a href="#shortenfeedbackloop">缩短反馈循环以提高传输速度</a></p>
          </li><li class="listitem">
            <p><a href="#organizingstacks">按生命周期和所有权组织您的堆栈</a></p>
          </li><li class="listitem">
            <p><a href="#cross-stack">使用跨堆栈引用来导出共享资源</a></p>
          </li><li class="listitem">
            <p><a href="./security-best-practices.html#use-iam-to-control-access">使用 IAM 控制访问</a></p>
          </li><li class="listitem">
            <p><a href="#reuse">重复使用模板以在多个环境中复制堆栈</a></p>
          </li><li class="listitem">
            <p><a href="#limits">验证所有资源类型的配额</a>
            </p>
          </li><li class="listitem">
            <p><a href="#modules-reuse">使用模块重复使用资源配置</a></p>
          </li></ul></div>
      </dd>
    
      <dt><b><span class="term">创建模板</span></b></dt>
      <dd>
        <div class="itemizedlist">
           
           
           
           
           
           
           
        <ul class="itemizedlist"><li class="listitem">
            <p><a href="./security-best-practices.html#creds">请勿将凭证嵌入您的模板</a></p>
          </li><li class="listitem">
            <p><a href="#parmtypes">使用 AWS 特定的参数类型</a></p>
          </li><li class="listitem">
            <p><a href="#parmconstraints">使用参数约束</a></p>
          </li><li class="listitem">
            <p><a href="#pseudoparameters">使用伪参数来提高可移植性</a></p>
          </li><li class="listitem">
            <p><a href="#cfninit">使用 AWS::CloudFormation::Init 在 Amazon EC2 实例上部署软件应用程序</a></p>
          </li><li class="listitem">
            <p><a href="#helper-scripts">使用最新的帮助程序脚本</a></p>
          </li><li class="listitem">
            <p><a href="#validate">在使用模板前先验证模板</a></p>
          </li></ul></div>
      </dd>
    
      <dt><b><span class="term">管理堆栈</span></b></dt>
      <dd>
        <div class="itemizedlist">
           
           
           
           
           
           
        <ul class="itemizedlist"><li class="listitem">
            <p><a href="#donttouch">通过 AWS CloudFormation 管理所有堆栈资源</a></p>
          </li><li class="listitem">
            <p><a href="#cfn-best-practices-changesets">更新堆栈之前创建更改集</a></p>
          </li><li class="listitem">
            <p><a href="#stackpolicy">使用堆栈策略</a></p>
          </li><li class="listitem">
            <p><a href="./security-best-practices.html#cloudtrail">使用 AWS CloudTrail 记录 AWS CloudFormation 调用</a></p>
          </li><li class="listitem">
            <p><a href="#code">使用代码审查和修订控制来管理您的模板</a></p>
          </li><li class="listitem">
            <p><a href="#update-ec2-linux">定期更新您的 Amazon EC2 实例</a></p>
          </li></ul></div>
      </dd>
    </dl></div>
    <h2 id="shortenfeedbackloop">缩短反馈循环以提高传输速度</h2>

    <p>采用实践和工具，以帮助您缩短使用 CloudFormation 模板描述的基础架构的反馈循环。这包括在工作站中对模板执行早期检查和测试；执行此操作时，甚至在向源代码存储库提交贡献之前，您就有机会发现潜在的语法和配置问题。及早发现此类问题有助于防止这些问题进入正式的生命周期环境，例如开发、质量保证和生产。这种早期测试、快速失效机制方法的好处是减少返工等待时间、减少潜在影响区域，并提高您对成功进行配置操作的信心。</p>
    <p>帮助您进行快速失效机制实践的工具选择包括 <a href="https://github.com/aws-cloudformation/cfn-lint" rel="noopener noreferrer" target="_blank"><span>AWS CloudFormation Linter</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a>（cfn-lint）和 <a href="https://github.com/aws-ia/taskcat" rel="noopener noreferrer" target="_blank"><span>TaskCat</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a> 命令行工具。cfn-lint 工具让您能够根据 <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/cfn-resource-specification.html">AWS CloudFormation 资源规范</a>验证 CloudFormation 模板。这包括检查资源属性的有效值以及最佳实践。cfn-lint 的插件<a href="https://github.com/aws-cloudformation/cfn-lint#editor-plugins" rel="noopener noreferrer" target="_blank"><span>可用于许多代码编辑器</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a>；这让您能够在编辑器中可视化问题并获得直接的 linter 反馈。您也可以选择将 cfn-lint 集成到源代码存储库的配置中，以便您可以在提交贡献时执行模板验证。有关更多信息，请参阅 <a href="https://aws.amazon.com/blogs/mt/git-pre-commit-validation-of-aws-cloudformation-templates-with-cfn-lint/" rel="noopener noreferrer" target="_blank"><span>Git pre-commit validation of AWS CloudFormation templates with cfn-lint</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a>。执行初始检查并修复了 cfn-lint 可能出现的任何问题后，您就可以使用 TaskCat 在您选择的 AWS 区域以编程方式创建堆栈来测试模板。TaskCat 还会生成报告，其中包含您选择的每个区域的通过/未通过等级。</p>
    <p>有关如何使用这两种工具缩短反馈循环的分步实作演练，请参阅 <a href="https://catalog.workshops.aws/cfn101/en-US" rel="noopener noreferrer" target="_blank"><span>AWS CloudFormation Workshop</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a> 中的 <a href="https://catalog.workshops.aws/cfn101/en-US/basics/templates/linting-and-testing" rel="noopener noreferrer" target="_blank"><span>Linting and Testing lab</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a>。</p>
   
    <h2 id="organizingstacks">按生命周期和所有权组织您的堆栈</h2>

    <p>使用 AWS 资源的生命周期和所有权帮助您决定每个堆栈应包含的资源。最初，您可将所有资源置于一个堆栈中，但当您堆栈的规模增大和范围扩大时，管理一个堆栈将是一项麻烦且耗时的工作。通过使用常见的生命周期和所有权对资源进行分组，所有者可使用自己的流程和计划来更改其资源集而不会影响其他资源。</p>
    <p>例如，假设开发人员和工程师团队拥有一个托管于负载均衡器后面的自动缩放实例的网站。由于该网站具有自己的生命周期并由网站团队维护，因此您可以为网站及其资源创建一个堆栈。现在假设该网站还使用后端数据库，其中数据库位于由数据库管理员所有和维护的单独堆栈中。当网站团队或数据库团队需要更新其资源时，他们可以这样做而不会影响彼此的堆栈。如果所有资源位于一个堆栈中，则协调和传达更新会很难。</p>
    <p>有关组织堆栈的其他指导，您可以使用两个常见框架：多层架构和面向服务的架构 (SOA)。</p>
    <p>分层架构将堆栈组织到相互堆放的多个水平层上，其中每个层都依赖于其正下方的层。每个层可包含一个或多个堆栈，但在每个层中，您的堆栈应包含具有类似生命周期和所有权的 AWS 资源。</p>
    <p>利用面向服务的架构，可以将大型业务问题组织到可管理的部分中。每个部分均为一个服务，该服务具有清楚定义的用途并代表一个独立的功能单元。您可以将这些服务映射到一个堆栈，其中每个堆栈均拥有自己的生命周期和所有者。可将这些服务（堆栈）关联在一起，使其能够互相交互。</p>
   
    <h2 id="cross-stack">使用跨堆栈引用来导出共享资源</h2>

    <p>在根据生命周期和所有权安排您的 AWS 资源时，建议您构建堆栈来使用其他堆栈中的资源。您可以对值进行硬编码，或者使用输入参数传递资源名称和 ID。但是，这些方法使得模板难以重复使用，或者会增加堆栈的运行开销。相反，使用跨堆栈引用则可以从堆栈导出资源，这样其他堆栈可以使用它们。通过使用 <code class="code">Fn::ImportValue</code> 函数调用导出的资源，堆栈可以使用这些资源。</p>
    <p>例如，您可能拥有一个网络堆栈，它包含一个 VPC、一个安全组和一个子网。建议所有公有 Web 应用程序都能使用这些资源。通过导出资源，可以允许带公有 Web 应用程序的所有堆栈使用这些资源。有关更多信息，请参阅<a href="./walkthrough-crossstackref.html">演练：引用另一个 AWS CloudFormation 堆栈中的资源输出</a>。</p>
   
    <h2 id="limits">验证所有资源类型的配额</h2>

    <p>在启动堆栈前，请确保您能创建所需的所有资源而不会达到 AWS 账户限制。如果您达到限制，则 CloudFormation 将无法成功创建堆栈，直到您增加配额或删除超额资源。每项服务均可具有不同的限制，您在启动堆栈前应了解这些限制。例如，默认情况下，您只能在 AWS 账户 中为每个区域启动 2000 个 CloudFormation 堆栈。有关限制以及如何增加默认限制的更多信息，请参阅 <em>AWS 一般参考</em> 中的 <a href="https://docs.aws.amazon.com/general/latest/gr/aws_service_limits.html">AWS service quotas</a>。</p>
   
    <h2 id="reuse">重复使用模板以在多个环境中复制堆栈</h2>

    <p>在设置您的堆栈和资源后，您可以重复使用您的模板以便在多个环境中复制您的基础结构。例如，您可以创建用于开发、测试和生产的环境，以便在应用更改前先对其进行测试。要使模板可重用，可使用参数、映射和条件部分，以便能在创建堆栈时对其进行自定义。例如，对于您的开发环境，您可以指定相对于生产环境来说成本更低的实例类型，但所有其他配置和设置保持不变。有关参数、映射和条件的更多信息，请参阅<a href="./template-anatomy.html">模板剖析</a>。</p>
   
    <h2 id="modules-reuse">使用模块重复使用资源配置</h2>

    <p>随着您的基础设施的发展，常见模式可合并以便声明每个模板中的相同组件。<em>模块</em>是一种供您以透明、易管理和可重复的方式打包资源配置以便跨堆栈模板实现包含的方法。模块可以将常见服务配置和最佳实践封装为模块化、可自定义的构建基块，供您包含在堆栈模板中。</p>
    <p>这些构建块可以用于单个资源，例如定义 Amazon Elastic Compute Cloud (Amazon EC2) 实例的最佳实践，也可以用于多个资源，以定义应用程序架构的通用模式。这些构建块可以嵌套到其他模块中，因此您可以将最佳实践堆叠到更高级别的构建块中。CloudFormation 模块在 <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/registry.html">CloudFormation 注册表</a>中可用，因此您可以像使用本机资源一样使用它们。使用 CloudFormation 模块时，模块模板会扩展到使用模板中，这样您就可以使用 <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/intrinsic-function-reference-ref.html">Ref</a> 或 <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/intrinsic-function-reference-getatt.html">Fn::GetAtt</a> 来访问模块内的资源。有关更多信息，请参阅<a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/modules.html">模块</a>。</p>
   
    <h2 id="parmtypes">使用 AWS 特定的参数类型</h2>

    <p>如果您的模板需要输入现有的 AWS 特定的值（例如，现有的 Amazon Virtual Private Cloud ID 或 Amazon EC2 密钥对名称），请使用 AWS 特定的参数类型。例如，您可以将参数指定为 <code class="code">AWS::EC2::KeyPair::KeyName</code> 类型，这会使用位于您的 AWS 账户以及创建堆栈时所在区域中的现有密钥对名称。在创建堆栈之前，AWS CloudFormation 可以快速验证 AWS 特定的参数类型的值。此外，如果您使用 CloudFormation 控制台，则 CloudFormation 会显示有效值的下拉列表，因此您无需查找或记住正确的 VPC ID 或密钥对名称。有关更多信息，请参阅<a href="./parameters-section-structure.html">参数</a>。</p>
   
    <h2 id="parmconstraints">使用参数约束</h2>

    <p>利用约束，您可以描述允许的输入值，以便 CloudFormation 在创建堆栈之前捕获任何无效值。可以设置约束，例如最小长度、最大长度和允许的模式。例如，您可以对数据库用户名值设置约束，使其最小长度必须为 8 个字符且仅包含字母数字字符。有关更多信息，请参阅<a href="./parameters-section-structure.html">参数</a>。</p>
   
    <h2 id="pseudoparameters">使用伪参数来提高可移植性</h2>

    <p>您可以在模板中使用<a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/pseudo-parameter-reference.html">伪参数</a>作为<a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/intrinsic-function-reference.html">内部函数</a>的参数，例如 <code class="code">Ref</code> 和 <code class="code">Fn::Sub</code>。伪参数是 CloudFormation 预定义的参数。请您不要在您的模板中声明它们。在内部函数中使用伪参数会提高堆栈模板在区域和账户之间的可移植性。</p>
    <p>例如，假设您想要创建一个模板，在该模板中，您需要为给定的资源属性指定另一个现有资源的 <a href="https://docs.aws.amazon.com/general/latest/gr/aws-arns-and-namespaces.html">Amazon 资源名称</a>（ARN）。在这种情况下，现有资源是具有以下 ARN 的 <a href="https://docs.aws.amazon.com/systems-manager/latest/userguide/systems-manager-parameter-store.html">AWS Systems Manager Parameter Store</a> 资源：<code class="code">arn:aws:ssm:us-east-1:111122223333:parameter/MySampleParameter</code>。您将需要根据您的目标 AWS 分区、区域和账户 ID 调整 <a href="https://docs.aws.amazon.com/general/latest/gr/aws-arns-and-namespaces.html#arns-syntax">ARN 格式</a>。您可以使用 <code class="code">AWS::Partition</code>、<code class="code">AWS::Region</code> 和 <code class="code">AWS::AccountId</code> 伪参数来提高模板的可移植性，而不用对这些值进行硬编码。在这种情况下，以下示例向您展示如何将 ARN 中的元素与 CloudFormation 连接：<code class="code">!Sub
        'arn:$<span>{</span>AWS::Partition}:ssm:$<span>{</span>AWS::Region}:$<span>{</span>AWS::AccountId}:parameter/MySampleParameter</code>。</p>
    <p>另举一例，假设您想要使用 <a href="./walkthrough-crossstackref.html">演练：引用另一个 AWS CloudFormation 堆栈中的资源输出</a> 来引用另一个 CloudFormation 堆栈中的资源输出。在此示例中，假设您已为您的 VPC 创建一个<a href="https://docs.aws.amazon.com/vpc/latest/userguide/configure-subnets.html">子网</a>，然后<a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/outputs-section-structure.html">导出</a>其 ID 以便与相同账户和区域中的其他堆栈一起使用。在另一个堆栈中，您在描述 Amazon EC2 实例时引用子网 ID 的导出值。</p>
    <p>对于每个账户和区域，堆栈导出必须是唯一的。因此，在这种情况下，您可以使用 <code class="code">AWS::StackName</code> 伪参数为您的导出创建前缀。由于每个账户和区域的堆栈名称也必须是唯一的，因此使用此伪参数作为前缀可以提高具有唯一导出名称的可能性，同时还推广了在导出值的堆栈之间采用可重复使用的方法。或者，您可以使用您自己选择的前缀。</p>
    <p>有关使用 <code class="code">Export</code> 输出字段和 <code class="code">Fn::ImportValue</code> 内置函数的详细示例，请参阅 <a href="./walkthrough-crossstackref.html">演练：引用另一个 AWS CloudFormation 堆栈中的资源输出</a>。</p>
   
    <h2 id="cfninit">使用 <code class="code">AWS::CloudFormation::Init</code> 在 Amazon EC2 实例上部署软件应用程序</h2>

    <p>在启动堆栈时，您可以在 Amazon EC2 实例上安装和配置软件应用程序，方式是使用 cfn-init 帮助程序脚本和 <code class="code">AWS::CloudFormation::Init</code> 资源。通过使用 <code class="code">AWS::CloudFormation::Init</code>，您可以描述所需的配置而不是为程序步骤编写脚本。您还可以更新配置，而无需重新创建实例。如果您的配置出现问题，CloudFormation 会生成可用于调查问题的日志。</p>
    <p>在您的模板中，在 <code class="code">AWS::CloudFormation::Init</code> 资源中指定安装和配置状态。有关说明如何使用 cfn-init 和 <code class="code">AWS::CloudFormation::Init</code> 的演练，请参阅 <a href="./deploying.applications.html">使用 AWS CloudFormation 在 Amazon EC2 上部署应用程序</a>。</p>
   
    <h2 id="helper-scripts">使用最新的帮助程序脚本</h2>

    <p><a href="./cfn-helper-scripts-reference.html">帮助程序脚本</a>将定期进行更新。在调用帮助程序脚本之前，请务必在您的模板的 <code class="code">UserData</code> 属性中包括以下命令，以确保您的启动实例获得最新的帮助程序脚本：</p>
    <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="复制"><awsui-icon name="copy"></awsui-icon></div></div><code class="sh "><code class="userinput">yum install -y aws-cfn-bootstrap</code></code></pre>
    <p>有关获取最新的帮助程序脚本的更多信息，请参阅<a href="./cfn-helper-scripts-reference.html">CloudFormation 帮助程序脚本参考</a>。</p>
   
    <h2 id="validate">在使用模板前先验证模板</h2>

    <p>在使用模板创建或更新堆栈之前，可以先使用 CloudFormation 验证模板。在 CloudFormation 创建任何资源之前，验证模板可帮助您捕获语法错误和一些语义错误，例如循环依赖性。如果您使用 CloudFormation 控制台，该控制台会在您指定输入参数后自动验证模板。对于 AWS CLI 或 CloudFormation API，请使用 <a href="https://docs.aws.amazon.com/cli/latest/reference/cloudformation/validate-template.html"><code class="code">aws cloudformation validate-template</code></a> 命令或 <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/APIReference/API_ValidateTemplate.html"><code class="code">ValidateTemplate</code></a> API 操作。</p>
    <p>在验证期间，CloudFormation 首先检查模板是否是有效的 JSON。如果不是，CloudFormation 会检查模板是否是有效的 YAML。如果两种检查都失败，CloudFormation 会返回模板验证错误。</p>
     
      <h3 id="validate-compliance">验证模板的组织策略合规性</h3>
      <p>您还可以验证模板是否符合组织策略准则。AWS CloudFormation Guard（<code class="code">cfn-guard</code>）是一种开源命令行界面（CLI）工具，它提供了策略即代码语言来定义规则，可以检查必需和禁止的资源配置。然后，您可以根据这些规则验证模板。例如，管理员可以创建规则以确保用户始终创建加密的 Amazon S3 存储桶。</p>
      <p>您可以在编辑模板时本地使用 <code class="code">cfn-guard</code>，也可以自动将其用作 CI/CD 管道的一部分，以停止非合规资源的部署。</p>
      <p>此外，<code class="code">cfn-guard</code> 还包括功能 <code class="code">rulegen</code>，使您能够从现有兼容的 CloudFormation 模板中提取规则。</p>
      <p>有关更多信息，请参阅 GitHub 上的 <a href="https://github.com/aws-cloudformation/cloudformation-guard" rel="noopener noreferrer" target="_blank"><span>cfn-guard</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a> 存储库。</p>
     
   
    <h2 id="donttouch">通过 AWS CloudFormation 管理所有堆栈资源</h2>

    <p>在启动堆栈后，使用 CloudFormation <a href="https://console.aws.amazon.com/cloudformation/home" rel="noopener noreferrer" target="_blank"><span>控制台</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a>、<a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/APIReference/">API</a> 或 <a href="https://docs.aws.amazon.com/cli/latest/reference/cloudformation/index.html">AWS CLI</a> 更新您堆栈中的资源。请勿在 CloudFormation 外部更改堆栈资源。这样做会使您的堆栈模板和堆栈资源的当前状态不匹配，从而在您更新或删除堆栈时导致出现错误。有关更多信息，请参阅<a href="./updating.stacks.walkthrough.html">演练：更新堆栈</a>。</p>
   
    <h2 id="cfn-best-practices-changesets">更新堆栈之前创建更改集</h2>

    <p>更改集允许您在实施之前查看对堆栈提议的更改可能会如何影响正在运行的资源。在您运行更改集之前，CloudFormation 不会对您的堆栈进行任何更改，从而允许您决定是继续进行提议的更改还是创建另一个更改集。</p>
    <p>使用更改集来检查更改可能对您正在运行的资源造成的影响，特别是关键资源。例如，如果您更改 Amazon RDS 数据库实例的名称，CloudFormation 将创建新的数据库并删除旧数据库；除非您已进行备份，否则，将会丢失旧数据库中的数据。如果您生成更改集，就可以看到更改将替换您的数据库。这可以帮助您在更新堆栈之前进行规划。有关更多信息，请参阅<a href="./using-cfn-updating-stacks-changesets.html">使用更改集更新堆栈</a>。</p>
   
    <h2 id="stackpolicy">使用堆栈策略</h2>

    <p>堆栈策略可帮助避免关键堆栈资源进行可能导致资源中断甚至被替换的非有意更新。堆栈策略是一个 JSON 文档，该文档描述可对指定资源执行哪些更新操作。只要创建具有重要资源的堆栈，就要指定堆栈策略。</p>
    <p>在堆栈更新过程中，您必须显式指定要更新的受保护的资源；否则，不会更改受保护的资源。有关更多信息，请参阅<a href="./protect-stack-resources.html">防止更新堆栈资源</a>。</p>
   
    <h2 id="code">使用代码审查和修订控制来管理您的模板</h2>

    <p>您的堆栈模板描述您的 AWS 资源的配置，例如它们的属性值。要查看更改并保留资源的准确历史记录，请使用代码审查和修订控制。这些方法可帮助您跟踪不同版本的模板之间的更改，以帮助您跟踪对您的堆栈资源所做的更改。此外，通过保留历史记录，您始终能将堆栈恢复为特定版本的模板。</p>
   
    <h2 id="update-ec2-linux">定期更新您的 Amazon EC2 实例</h2>

    <p>在使用 CloudFormation 创建的所有 Amazon EC2 Windows 实例和 Amazon EC2 Linux 实例上，可以定期运行 <code class="code">yum update</code> 命令以更新 RPM 程序包。这可确保您获得最新的修复和安全更新。</p>
  <awsdocs-copyright class="copyright-print"></awsdocs-copyright><awsdocs-thumb-feedback right-edge="{{$ctrl.thumbFeedbackRightEdge}}"></awsdocs-thumb-feedback></div><noscript><div><div><div><div id="js_error_message"><p><img src="https://d1ge0kk1l5kms0.cloudfront.net/images/G/01/webservices/console/warning.png" alt="警告" /> <strong>Javascript 在您的浏览器中被禁用或不可用。</strong></p><p>要使用 Amazon Web Services 文档，必须启用 Javascript。请参阅浏览器的帮助页面以了解相关说明。</p></div></div></div></div></noscript><div id="main-col-footer" class="awsui-util-font-size-0"><div id="doc-conventions"><a target="_top" href="/general/latest/gr/docconventions.html">文档惯例</a></div><div class="prev-next"><div id="previous" class="prev-link" accesskey="p" href="./vpc-interface-endpoints.html">VPC 端点 (AWS PrivateLink)</div><div id="next" class="next-link" accesskey="n" href="./continuous-delivery-codepipeline.html">持续交付</div></div></div><awsdocs-page-utilities></awsdocs-page-utilities></div><div id="quick-feedback-yes" style="display: none;"><div class="title">此页面对您有帮助吗？- 是</div><div class="content"><p>感谢您对我们工作的肯定！</p><p>如果不耽误您的时间，请告诉我们做得好的地方，让我们做得更好。</p><p><awsui-button id="fblink" rel="noopener noreferrer" target="_blank" text="反馈" click="linkClick($event)" href="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=CloudFormation&amp;topic_url=https://docs.aws.amazon.com/zh_cn/AWSCloudFormation/latest/UserGuide/best-practices.html"></awsui-button></p></div></div><div id="quick-feedback-no" style="display: none;"><div class="title">此页面对您有帮助吗？- 否</div><div class="content"><p>感谢您告诉我们本页内容还需要完善。很抱歉让您失望了。</p><p>如果不耽误您的时间，请告诉我们如何改进文档。</p><p><awsui-button id="fblink" rel="noopener noreferrer" target="_blank" text="反馈" click="linkClick($event)" href="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=CloudFormation&amp;topic_url=https://docs.aws.amazon.com/zh_cn/AWSCloudFormation/latest/UserGuide/best-practices.html"></awsui-button></p></div></div></div></body></div></awsdocs-view><div class="page-loading-indicator" id="page-loading-indicator"><awsui-spinner size="large"></awsui-spinner></div></div><div id="tools-panel" dom-region="tools"><awsdocs-tools-panel id="awsdocs-tools-panel"></awsdocs-tools-panel></div></awsui-app-layout><awsdocs-cookie-banner class="doc-cookie-banner"></awsdocs-cookie-banner></div></body></html>