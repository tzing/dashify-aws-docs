<!DOCTYPE html>
    <html xmlns="http://www.w3.org/1999/xhtml" lang="zh-CN"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>演练：使用 AWS CloudFormation Designer 修改堆栈的模板 - AWS CloudFormation</title><meta name="viewport" content="width=device-width,initial-scale=1" /><meta name="assets_root" content="/assets" /><meta name="target_state" content="working-with-templates-cfn-designer-walkthrough-updatebasicwebserver" /><meta name="default_state" content="working-with-templates-cfn-designer-walkthrough-updatebasicwebserver" /><link rel="icon" type="image/ico" href="/assets/images/favicon.ico" /><link rel="shortcut icon" type="image/ico" href="/assets/images/favicon.ico" /><link rel="canonical" href="https://docs.aws.amazon.com/zh_cn/AWSCloudFormation/latest/UserGuide/working-with-templates-cfn-designer-walkthrough-updatebasicwebserver.html" /><meta name="description" content="使用 AWS CloudFormation Designer 更新基本 Web 服务器。" /><meta name="deployment_region" content="IAD" /><meta name="product" content="AWS CloudFormation" /><meta name="guide" content="用户指南" /><meta name="abstract" content="根据此用户指南，使用 AWS CloudFormation 以可预见方式反复创建和管理 AWS 基础设施部署。" /><meta name="guide-locale" content="zh_cn" /><meta name="tocs" content="toc-contents.json" /><link rel="canonical" href="https://docs.aws.amazon.com/zh_cn/AWSCloudFormation/latest/UserGuide/working-with-templates-cfn-designer-walkthrough-updatebasicwebserver.html" /><link rel="alternative" href="https://docs.aws.amazon.com/id_id/AWSCloudFormation/latest/UserGuide/working-with-templates-cfn-designer-walkthrough-updatebasicwebserver.html" hreflang="id-id" /><link rel="alternative" href="https://docs.aws.amazon.com/id_id/AWSCloudFormation/latest/UserGuide/working-with-templates-cfn-designer-walkthrough-updatebasicwebserver.html" hreflang="id" /><link rel="alternative" href="https://docs.aws.amazon.com/de_de/AWSCloudFormation/latest/UserGuide/working-with-templates-cfn-designer-walkthrough-updatebasicwebserver.html" hreflang="de-de" /><link rel="alternative" href="https://docs.aws.amazon.com/de_de/AWSCloudFormation/latest/UserGuide/working-with-templates-cfn-designer-walkthrough-updatebasicwebserver.html" hreflang="de" /><link rel="alternative" href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/working-with-templates-cfn-designer-walkthrough-updatebasicwebserver.html" hreflang="en-us" /><link rel="alternative" href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/working-with-templates-cfn-designer-walkthrough-updatebasicwebserver.html" hreflang="en" /><link rel="alternative" href="https://docs.aws.amazon.com/es_es/AWSCloudFormation/latest/UserGuide/working-with-templates-cfn-designer-walkthrough-updatebasicwebserver.html" hreflang="es-es" /><link rel="alternative" href="https://docs.aws.amazon.com/es_es/AWSCloudFormation/latest/UserGuide/working-with-templates-cfn-designer-walkthrough-updatebasicwebserver.html" hreflang="es" /><link rel="alternative" href="https://docs.aws.amazon.com/fr_fr/AWSCloudFormation/latest/UserGuide/working-with-templates-cfn-designer-walkthrough-updatebasicwebserver.html" hreflang="fr-fr" /><link rel="alternative" href="https://docs.aws.amazon.com/fr_fr/AWSCloudFormation/latest/UserGuide/working-with-templates-cfn-designer-walkthrough-updatebasicwebserver.html" hreflang="fr" /><link rel="alternative" href="https://docs.aws.amazon.com/it_it/AWSCloudFormation/latest/UserGuide/working-with-templates-cfn-designer-walkthrough-updatebasicwebserver.html" hreflang="it-it" /><link rel="alternative" href="https://docs.aws.amazon.com/it_it/AWSCloudFormation/latest/UserGuide/working-with-templates-cfn-designer-walkthrough-updatebasicwebserver.html" hreflang="it" /><link rel="alternative" href="https://docs.aws.amazon.com/ja_jp/AWSCloudFormation/latest/UserGuide/working-with-templates-cfn-designer-walkthrough-updatebasicwebserver.html" hreflang="ja-jp" /><link rel="alternative" href="https://docs.aws.amazon.com/ja_jp/AWSCloudFormation/latest/UserGuide/working-with-templates-cfn-designer-walkthrough-updatebasicwebserver.html" hreflang="ja" /><link rel="alternative" href="https://docs.aws.amazon.com/ko_kr/AWSCloudFormation/latest/UserGuide/working-with-templates-cfn-designer-walkthrough-updatebasicwebserver.html" hreflang="ko-kr" /><link rel="alternative" href="https://docs.aws.amazon.com/ko_kr/AWSCloudFormation/latest/UserGuide/working-with-templates-cfn-designer-walkthrough-updatebasicwebserver.html" hreflang="ko" /><link rel="alternative" href="https://docs.aws.amazon.com/pt_br/AWSCloudFormation/latest/UserGuide/working-with-templates-cfn-designer-walkthrough-updatebasicwebserver.html" hreflang="pt-br" /><link rel="alternative" href="https://docs.aws.amazon.com/pt_br/AWSCloudFormation/latest/UserGuide/working-with-templates-cfn-designer-walkthrough-updatebasicwebserver.html" hreflang="pt" /><link rel="alternative" href="https://docs.aws.amazon.com/zh_cn/AWSCloudFormation/latest/UserGuide/working-with-templates-cfn-designer-walkthrough-updatebasicwebserver.html" hreflang="zh-cn" /><link rel="alternative" href="https://docs.aws.amazon.com/zh_tw/AWSCloudFormation/latest/UserGuide/working-with-templates-cfn-designer-walkthrough-updatebasicwebserver.html" hreflang="zh-tw" /><link rel="alternative" href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/working-with-templates-cfn-designer-walkthrough-updatebasicwebserver.html" hreflang="x-default" /><meta name="feedback-item" content="CloudFormation" /><meta name="this_doc_product" content="AWS CloudFormation" /><meta name="this_doc_guide" content="用户指南" /><script defer="" src="/assets/r/vendor4.js?version=2021.12.02"></script><script defer="" src="/assets/r/vendor3.js?version=2021.12.02"></script><script defer="" src="/assets/r/vendor1.js?version=2021.12.02"></script><script defer="" src="/assets/r/awsdocs-common.js?version=2021.12.02"></script><script defer="" src="/assets/r/awsdocs-doc-page.js?version=2021.12.02"></script><link href="/assets/r/vendor4.css?version=2021.12.02" rel="stylesheet" /><link href="/assets/r/awsdocs-common.css?version=2021.12.02" rel="stylesheet" /><link href="/assets/r/awsdocs-doc-page.css?version=2021.12.02" rel="stylesheet" /><script async="" id="awsc-panorama-bundle" type="text/javascript" src="https://prod.pa.cdn.uis.awsstatic.com/panorama-nav-init.js" data-config="{'appEntity':'aws-documentation','region':'us-east-1','service':'cloudformation'}"></script><meta id="panorama-serviceSubSection" value="用户指南" /><meta id="panorama-serviceConsolePage" value="演练：使用 AWS CloudFormation Designer 修改堆栈的模板" /></head><body class="awsdocs awsui"><div class="awsdocs-container"><awsdocs-header></awsdocs-header><awsui-app-layout id="app-layout" class="awsui-util-no-gutters" ng-controller="ContentController as $ctrl" header-selector="awsdocs-header" navigation-hide="false" navigation-width="$ctrl.navWidth" navigation-open="$ctrl.navOpen" navigation-change="$ctrl.onNavChange($event)" tools-hide="$ctrl.hideTools" tools-width="$ctrl.toolsWidth" tools-open="$ctrl.toolsOpen" tools-change="$ctrl.onToolsChange($event)"><div id="guide-toc" dom-region="navigation"><awsdocs-toc></awsdocs-toc></div><div id="main-column" dom-region="content" tabindex="-1"><awsdocs-view class="awsdocs-view"><div id="awsdocs-content"><head><title>演练：使用 AWS CloudFormation Designer 修改堆栈的模板 - AWS CloudFormation</title><meta name="rss" content="aws-cloudformation-release-notes.rss" /><meta name="forums" content="http://forums.aws.amazon.com/forum.jspa?forumID=92" /><meta name="feedback" content="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=CloudFormation&amp;topic_url=https://docs.aws.amazon.com/zh_cn/AWSCloudFormation/latest/UserGuide/working-with-templates-cfn-designer-walkthrough-updatebasicwebserver.html" /><meta name="feedback-yes" content="feedbackyes.html?topic_url=https://docs.aws.amazon.com/zh_cn/AWSCloudFormation/latest/UserGuide/working-with-templates-cfn-designer-walkthrough-updatebasicwebserver.html" /><meta name="feedback-no" content="feedbackno.html?topic_url=https://docs.aws.amazon.com/zh_cn/AWSCloudFormation/latest/UserGuide/working-with-templates-cfn-designer-walkthrough-updatebasicwebserver.html" /><meta name="keywords" content="CloudFormation,AWSCloudFormation,资源预置,资源配置,基础设施管理,CloudFormer,CloudFormation 堆栈,CloudFormation 堆栈集,CloudFormation 模板,更改集" /><script type="application/ld+json">
{
    "@context" : "https://schema.org",
    "@type" : "BreadcrumbList",
    "itemListElement" : [
      {
        "@type" : "ListItem",
        "position" : 1,
        "name" : "AWS",
        "item" : "https://aws.amazon.com"
      },
      {
        "@type" : "ListItem",
        "position" : 2,
        "name" : "AWS CloudFormation",
        "item" : "https://docs.aws.amazon.com/cloudformation/index.html"
      },
      {
        "@type" : "ListItem",
        "position" : 3,
        "name" : "用户指南",
        "item" : "https://docs.aws.amazon.com/zh_cn/AWSCloudFormation/latest/UserGuide"
      },
      {
        "@type" : "ListItem",
        "position" : 4,
        "name" : "使用 AWS CloudFormation 模板",
        "item" : "https://docs.aws.amazon.com/zh_cn/AWSCloudFormation/latest/UserGuide/template-guide.html"
      },
      {
        "@type" : "ListItem",
        "position" : 5,
        "name" : "演练",
        "item" : "https://docs.aws.amazon.com/zh_cn/AWSCloudFormation/latest/UserGuide/CHAP_Using.html"
      },
      {
        "@type" : "ListItem",
        "position" : 6,
        "name" : "演练：使用 AWS CloudFormation Designer 修改堆栈的模板",
        "item" : "https://docs.aws.amazon.com/zh_cn/AWSCloudFormation/latest/UserGuide/CHAP_Using.html"
      }
    ]
}
</script></head><body><div id="main"><div style="display: none"></div><div id="breadcrumbs" class="breadcrumb"><a href="https://aws.amazon.com">AWS</a><a href="/index.html">文档</a><a href="/cloudformation/index.html">AWS CloudFormation</a><a href="Welcome.html">用户指南</a></div><div id="page-toc-src"><a href="#working-with-templates-cfn-designer-walkthrough-updatebasicwebserver-get-template">步骤 1：获取堆栈模板</a><a href="#working-with-templates-cfn-designer-walkthrough-updatebasicwebserver-modify-template">步骤 2：修改模板</a><a href="#working-with-templates-cfn-designer-walkthrough-updatebasicwebserver-update-stack">步骤 3：更新堆栈</a><a href="#working-with-templates-cfn-designer-walkthrough-updatebasicwebserver-delete-stack">步骤 4：清理资源</a></div><div id="main-content" class="awsui-util-container"><div id="main-col-body"><awsdocs-language-banner data-service="$ctrl.pageService"></awsdocs-language-banner><h1 class="topictitle" id="working-with-templates-cfn-designer-walkthrough-updatebasicwebserver">演练：使用 AWS CloudFormation Designer 修改堆栈的模板</h1><div class="awsdocs-page-header-container"><awsdocs-page-header></awsdocs-page-header><awsdocs-filter-selector id="awsdocs-filter-selector"></awsdocs-filter-selector></div><p>您可以使用 AWS CloudFormation Designer 轻松修改堆栈模板，然后将其提交到 AWS CloudFormation 以更新堆栈。通常，在修改堆栈时，您需要获取其模板的副本，在文本编辑器中修改模板，然后使用 CloudFormation 更新堆栈。借助 AWS CloudFormation Designer，您可以快速获取任何正在运行的堆栈的模板副本，修改该模板，然后更新堆栈，而不必离开控制台。</p><p>在此演练中，我们从一个<a href="./working-with-templates-cfn-designer-walkthrough-createbasicwebserver.html">基本 Web 服务器</a>堆栈开始，然后修改它，以使该 Web 服务器可扩展且持久。</p><p>在此演练中，我们将完成以下步骤：</p><div class="orderedlist">
     
     
     
     
  <ol><li>
      <p><a href="#working-with-templates-cfn-designer-walkthrough-updatebasicwebserver-get-template">获取堆栈的模板。</a></p>
      <p>我们将获取正在运行的堆栈的模板副本 - 与以下演练中的基本 Web 服务器堆栈相同：<a href="./working-with-templates-cfn-designer-walkthrough-createbasicwebserver.html">演练：使用 AWS CloudFormation Designer 创建基本 Web 服务器</a>。</p>
    </li><li>
      <p><a href="#working-with-templates-cfn-designer-walkthrough-updatebasicwebserver-modify-template">修改模板。</a></p>
      <p>我们将使用 AWS CloudFormation Designer 修改此堆栈的模板（用自动扩缩组和 Elastic Load Balancing 负载均衡器替换 EC2 实例），以使您的网站可扩展且持久。</p>
    </li><li>
      <p><a href="#working-with-templates-cfn-designer-walkthrough-updatebasicwebserver-update-stack">更新堆栈。</a></p>
      <p>保存修改后，我们将用修改的模板更新此基本 Web 服务器堆栈。</p>
      <div class="awsdocs-note"><div class="awsdocs-note-title"><awsui-icon name="status-info" variant="link"></awsui-icon><h6>注意</h6></div><div class="awsdocs-note-text"><p>CloudFormation 是一种免费服务；但是，您需要为您在堆栈使用的 AWS 资源付费，费用按每种资源的现价收取。有关 AWS 定价的详细信息，请参阅 <a href="https://aws.amazon.com/" rel="noopener noreferrer" target="_blank"><span>http://aws.amazon.com</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a> 上每种产品的详细信息页。</p></div></div>
    </li><li>
      <p><a href="#working-with-templates-cfn-designer-walkthrough-updatebasicwebserver-delete-stack">删除堆栈。</a></p>
      <p>我们将删除堆栈，以清理所有资源。</p>
    </li></ol></div><p>先决条件</p><p>本演练假定您具有 Amazon Virtual Private Cloud (Amazon VPC)、Auto Scaling、Elastic Load Balancing 和 CloudFormation 方面的工作经验。为了解上下文，每个过程提供了有关每项资源的一些基本信息。</p><p>此外，本演练还假定您已完成下面的演练：<a href="./working-with-templates-cfn-designer-walkthrough-createbasicwebserver.html">演练：使用 AWS CloudFormation Designer 创建基本 Web 服务器</a>。在上述演练中，您应该获得了一个名为 <code class="code">BasicWebServerStack</code> 的正在运行的堆栈。</p><h2 id="working-with-templates-cfn-designer-walkthrough-updatebasicwebserver-get-template">步骤 1：获取堆栈模板</h2>
    
    <p>在此步骤中，我们将使用 AWS CloudFormation Designer 获取正在运行的堆栈的模板副本并将其打开。</p>
    <div class="procedure"><h6>获取正在运行的堆栈的模板副本</h6><ol><li>
        <p>通过以下网址打开 CloudFormation 控制台：<a href="https://console.aws.amazon.com/cloudformation/" rel="noopener noreferrer" target="_blank"><span>https://console.aws.amazon.com/cloudformation/</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a>。</p>
      </li><li>
        <p>从堆栈列表中，选择 <code class="code">BasicWebServerStack</code>。</p>
      </li><li>
        <p>依次选择 <b>Actions</b>、<b>View/Edit template in Designer</b>。</p>
      </li></ol></div>
    <p>CloudFormation 获取 <code class="code">BasicWebServerStack</code> 堆栈的模板副本并在 AWS CloudFormation Designer 中显示它，您可以在其中看到该模板的资源及其关系。在下一步中，我们将使用 AWS CloudFormation Designer 修改该模板。</p>
  <h2 id="working-with-templates-cfn-designer-walkthrough-updatebasicwebserver-modify-template">步骤 2：修改模板</h2>
    
    <p>我们将使用 AWS CloudFormation Designer 的拖放界面和集成的 JSON 和 YAML 编辑器修改基本 Web 服务器模板，即，将单个 Amazon EC2 实例替换为自动扩缩组和负载均衡器以使网站可扩展。如果网站的流量突然增多，则使用 Auto Scaling 可快速增加 Web 服务器的数量。负载均衡器会将流量均匀地分配到多个实例上。</p>
    <div class="procedure"><h6>修改堆栈模板</h6><ol><li>
        <p>删除 <code class="code">WebServerInstance</code> 资源。</p>
        <ol><li>
            <p>右键单击 <code class="code">WebServerInstance</code> 资源。</p>
          </li><li>
            <p>从资源菜单中选择<b>删除</b> (<span class="inlinemediaobject">
                 
                  <img src="images/designer-resourcemenu-delete.png" class="aws-docs-img-whiteBg aws-docs-img-xs-padding" />
                 
              </span>)。</p>
          </li><li>
            <p>选择 <b>OK</b> 确认。</p>
          </li></ol>
      </li><li>
        <p>从 <b>Resource types</b> 窗格中，将以下资源添加到 <code class="code">PublicSubnet</code> 资源中：<b>AutoScalingGroup</b>、<b>LaunchConfiguration</b> 和 <b>LoadBalancer</b>。添加资源前，您可能需要扩展子网以包含所有资源。</p>
        <p>资源按资源类别组织。自动扩缩组和启动配置位于 <b>AutoScaling</b> 类别中，负载均衡器位于 <b>ElasticLoadBalancing</b> 类别中。</p>
        <div class="awsdocs-note"><div class="awsdocs-note-title"><awsui-icon name="status-info" variant="link"></awsui-icon><h6>注意</h6></div><div class="awsdocs-note-text"><p>这些资源不遵守容器模型，因此，AWS CloudFormation Designer 不会将它们自动关联到子网。我们会在此步骤的稍后部分创建连接。</p></div></div>
      </li><li>
        <p>从 <b>EC2</b> 类别的 <b>Resource types</b> 窗格，将 <b>SecurityGroup</b> 资源添加到 VPC 中的任意位置，但不要加入到子网中。</p>
        <p>此安全组将负责控制负载均衡器的入站和出站通信。</p>
      </li><li>
        <p>重命名资源以使其更易识别：</p>
        <div class="itemizedlist">
           
           
           
           
        <ul class="itemizedlist"><li class="listitem">
            <p>将 <b>AutoScalingGroup</b> 重命名为 <code class="code">WebServerFleet</code></p>
          </li><li class="listitem">
            <p>将 <b>LaunchConfiguration</b> 重命名为 <code class="code">WebServerLaunchConfig</code></p>
          </li><li class="listitem">
            <p>将 <b>LoadBalancer</b> 重命名为 <code class="code">PublicElasticLoadBalancer</code></p>
          </li><li class="listitem">
            <p>将 <b>SecurityGroup</b> 重命名为 <code class="code">PublicLoadBalancerSecurityGroup</code></p>
          </li></ul></div>
      </li><li>
        <p>为添加的资源创建关联。</p>
        <ol><li>
            <p>将负载均衡器和自动扩缩组资源关联到公有子网：</p>
            <div class="itemizedlist">
               
               
            <ul class="itemizedlist"><li class="listitem">
                <p>从 <code class="code">PublicElasticLoadBalancer</code> 资源拖动到 <code class="code">AWS::EC2::Subnet (Property: Subnets)</code> 资源的 <code class="code">PublicSubnet</code> 连接。</p>
              </li><li class="listitem">
                <p>从 <code class="code">WebServerFleet</code> 资源拖动到 <code class="code">AWS::EC2::Subnet (Property: VPCZoneIdentifier)</code> 资源的 <code class="code">PublicSubnet</code> 连接。</p>
              </li></ul></div>
          </li><li>
            <p>将负载均衡器关联到其安全组：</p>
            <div class="itemizedlist">
               
            <ul class="itemizedlist"><li class="listitem">
                <p>从 <code class="code">PublicElasticLoadBalancer</code> 资源拖动到 <code class="code">AWS::EC2::SecurityGroup (Property:
                    SecurityGroups)</code> 资源的 <code class="code">PublicLoadBalancerSecurityGroup</code> 连接。</p>
              </li></ul></div>
          </li><li>
            <p>将自动扩缩组关联到负载均衡器和启动配置：</p>
            <div class="itemizedlist">
               
               
            <ul class="itemizedlist"><li class="listitem">
                <p>从 <code class="code">WebServerFleet</code> 资源拖动到 <code class="code">AWS::ElasticLoadBalancing::LoadBalancer (Property:
                    LoadBalancerNames)</code> 资源的 <code class="code">PublicElasticLoadBalancer</code> 连接。</p>
              </li><li class="listitem">
                <p>从 <code class="code">WebServerFleet</code> 资源拖动到 <code class="code">AWS::ElasticLoadBalancing::LaunchConfiguration
                    (Property: LaunchConfigurationName)</code> 资源的 <code class="code">WebServerLaunchConfig</code> 连接。</p>
              </li></ul></div>
          </li><li>
            <p>将启动配置关联到安全组：</p>
            <div class="itemizedlist">
               
            <ul class="itemizedlist"><li class="listitem">
                <p>从 <code class="code">WebServerLaunchConfig</code> 资源拖动到 <code class="code">AWS::EC2::SecurityGroup (Property:
                    SecurityGroups)</code> 资源的 <code class="code">WebServerSecurityGroup</code> 连接。</p>
              </li></ul></div>
          </li><li>
            <p>为自动扩缩组定义对公有路由的依赖关系：</p>
            <div class="itemizedlist">
               
            <ul class="itemizedlist"><li class="listitem">
                <p>从 <code class="code">WebServerFleet</code> 资源拖动到 <code class="code">DependsOn</code> 资源的 <code class="code">PublicRoute</code> 连接。</p>
              </li></ul></div>
            <p>该依赖关系意味着，在公有路由完成之前，CloudFormation 不会创建 <code class="code">WebServerFleet</code> 资源。否则，如果公有路由在 Web 服务器实例启动时不可用，这些实例将无法在配置和应用程序部署完成时发送信号 (使用 cfn-signal 帮助程序脚本) 通知 CloudFormation。</p>
          </li></ol>
      </li><li>
        <p>为添加的资源指定属性。</p>
        <ol><li>
            <p>在 AWS CloudFormation Designer 画布上，选择 <code class="code">PublicElasticLoadBalancer</code> 资源。</p>
          </li><li>
            <p>在集成编辑器窗格中，选择<b>属性</b>选项卡，然后复制以下代码段并将其粘贴到<b>属性</b> 大括号 (<code class="code"><span>{</span>}</code>) 之间。</p>
            <p>AWS CloudFormation Designer 会自动添加安全组和子网关联，因此，您只需要添加 <code class="code">Listeners</code> 和 <code class="code">HealthCheck</code> 属性。<code class="code">Listeners</code> 属性指定侦听位置及侦听何种类型的流量，<code class="code">HealthCheck</code> 属性描述确定负载均衡器运行状况的设置。</p>
            <p>JSON</p>
            <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="复制"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><b>          "Listeners": [
          <span>{</span>
            "LoadBalancerPort": "80",
            "InstancePort": "80",
            "Protocol": "HTTP"
          }
        ],
        "HealthCheck": <span>{</span>
          "Target": "HTTP:80/",
          "HealthyThreshold": "3",
          "UnhealthyThreshold": "5",
          "Interval": "90",
          "Timeout": "60"
        },</b>
        "SecurityGroups": [
          <span>{</span>
            "Ref": "PublicLoadBalancerSecurityGroup"
          }
        ],
        "Subnets": [
          <span>{</span>
            "Ref": "PublicSubnet"
          }
        ]</code></pre>

            <p>YAML</p>
            <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="复制"><awsui-icon name="copy"></awsui-icon></div></div><code class="yaml "><b>      Listeners:
        - LoadBalancerPort: '80'
          InstancePort: '80'
          Protocol: HTTP
      HealthCheck:
        Target: 'HTTP:80/'
        HealthyThreshold: '3'
        UnhealthyThreshold: '5'
        Interval: '90'
        Timeout: '60'</b>
      SecurityGroups:
        - !Ref PublicLoadBalancerSecurityGroup
      Subnets:
        - !Ref PublicSubnet</code></pre>
          </li><li>
            <p>为以下资源重复这一过程：</p>
            <div class="variablelist">
               
               
               
               
            <dl>
                <dt><span class="term"><code class="code">WebServerFleet</code></span></dt>
                <dd>
                  <p>添加 <code class="code">MaxSize</code>、<code class="code">MinSize</code> 和 <code class="code">DesiredCapacity</code> 属性。这些属性指定您可在自动扩缩组中启动的最大、最小实例数及初始启动的实例数。所需容量值通过一个新的参数指定，我们将在此过程的稍后部分添加该参数。</p>
                  <p>JSON</p>
                  <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="复制"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><b>        "MinSize": "1",
        "MaxSize": "10",
        "DesiredCapacity": <span>{</span>
          "Ref": "WebServerCount"
        },</b>
        "VPCZoneIdentifier": [
          <span>{</span>
            "Ref": "PublicSubnet"
          }
        ],
        "LaunchConfigurationName": <span>{</span>
          "Ref": "WebServerLaunchConfig"
        },
        "LoadBalancerNames": [
          <span>{</span>
            "Ref": "PublicElasticLoadBalancer"
          }
        ]</code></pre>
                  <p>YAML</p>
                  <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="复制"><awsui-icon name="copy"></awsui-icon></div></div><code class="yaml "><b>      MinSize: '1'
      MaxSize: '10'
      DesiredCapacity: !Ref WebServerCount</b>
      VPCZoneIdentifier:
        - !Ref PublicSubnet
      LaunchConfigurationName: !Ref WebServerLaunchConfig
      LoadBalancerNames:
        - !Ref PublicElasticLoadBalancer</code></pre>
                </dd>
               
                <dt><span class="term"><code class="code">PublicLoadBalancerSecurityGroup</code></span></dt>
                <dd>
                  <p>添加以下入站和出站规则，用以确定可到达和离开负载均衡器的流量。这些规则允许所有 HTTP 流量到达和离开负载均衡器。</p>
                  <p>JSON</p>
                  <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="复制"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><b>        "GroupDescription": "Public Elastic Load Balancing security group with HTTP access on port 80 from the Internet",
        "SecurityGroupIngress": [
          <span>{</span>
            "IpProtocol": "tcp",
            "FromPort": 80,
            "ToPort": 80,
            "CidrIp": "0.0.0.0/0"
          }
        ],
        "SecurityGroupEgress": [
          <span>{</span>
            "IpProtocol": "tcp",
            "FromPort": 80,
            "ToPort": 80,
            "CidrIp": "0.0.0.0/0"
          }
        ],</b>
        "VpcId": <span>{</span>
          "Ref": "VPC"
        }</code></pre>

                  <p>YAML</p>
                  <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="复制"><awsui-icon name="copy"></awsui-icon></div></div><code class="yaml "><b>      GroupDescription: &gt;-
        Public Elastic Load Balancing security group with HTTP access on port 80
        from the Internet
      SecurityGroupIngress:
        - IpProtocol: tcp
          FromPort: 80
          ToPort: 80
          CidrIp: 0.0.0.0/0
      SecurityGroupEgress:
        - IpProtocol: tcp
          FromPort: 80
          ToPort: 80
          CidrIp: 0.0.0.0/0</b>
      VpcId: !Ref VPC</code></pre>
                </dd>
               
                <dt><span class="term"><code class="code">WebServerSecurityGroup</code></span></dt>
                <dd>
                  <p>修改 HTTP 入站规则，仅允许来自负载均衡器的流量。</p>
                  <p>JSON</p>
                  <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="复制"><awsui-icon name="copy"></awsui-icon></div></div><code class="json ">        "GroupDescription": "Allow access from load balancer and SSH traffic",
        "SecurityGroupIngress": [
          <span>{</span>
            "IpProtocol": "tcp",
            "FromPort": 80,
            "ToPort": 80,
<b>            "SourceSecurityGroupId": <span>{</span>
              "Ref": "PublicLoadBalancerSecurityGroup"
            }</b>
          },
          <span>{</span>
            "IpProtocol": "tcp",
            "FromPort": 22,
            "ToPort": 22,
            "CidrIp": <span>{</span>
              "Ref": "SSHLocation"
            }
          }
        ],
        "VpcId": <span>{</span>
          "Ref": "VPC"
        }</code></pre>
                  <p>YAML</p>
                  <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="复制"><awsui-icon name="copy"></awsui-icon></div></div><code class="yaml ">      VpcId: !Ref VPC
      GroupDescription: Allow access from load balancer and SSH traffic
      SecurityGroupIngress:
        - IpProtocol: tcp
          FromPort: 80
          ToPort: 80
          <b>SourceSecurityGroupId: !Ref PublicLoadBalancerSecurityGroup</b>
        - IpProtocol: tcp
          FromPort: 22
          ToPort: 22
          CidrIp: !Ref SSHLocation</code></pre>
                </dd>
               
                <dt><span class="term"><code class="code">WebServerLaunchConfig</code></span></dt>
                <dd>
                  <p>启动配置有很多需要指定的不同属性，我们只重点介绍其中几个属性。<code class="code">InstanceType</code> 和 <code class="code">ImageId</code> 属性使用已在模板中指定的参数和映射值。创建堆栈时，需要以参数值的形式指定实例类型。<code class="code">ImageId</code> 值是基于堆栈区域和指定的实例类型的映射。</p>
                  <p>在 <code class="code">UserData</code> 属性中，我们指定在实例启动并运行后运行的配置脚本。配置信息均在实例的元数据中定义 (我们将在下一步中添加)。</p>
                  <p>JSON</p>
                  <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="复制"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><b>        "InstanceType": <span>{</span>
          "Ref": "InstanceType"
        },
        "ImageId": <span>{</span>
          "Fn::FindInMap": [
            "AWSRegionArch2AMI",
            <span>{</span>
              "Ref": "AWS::Region"
            },
            <span>{</span>
              "Fn::FindInMap": [
                "AWSInstanceType2Arch",
                <span>{</span>
                  "Ref": "InstanceType"
                },
                "Arch"
              ]
            }
          ]
        },
        "KeyName": <span>{</span>
          "Ref": "KeyName"
        },
        "AssociatePublicIpAddress": "true",
        "UserData": <span>{</span>
          "Fn::Base64": <span>{</span>
            "Fn::Join": [
              "",
              [
                "#!/bin/bash -xe\n",
                "yum install -y aws-cfn-bootstrap\n",
                "# Install the files and packages from the metadata\n",
                "/opt/aws/bin/cfn-init -v ",
                "         --stack ",
                <span>{</span>
                  "Ref": "AWS::StackName"
                },
                "         --resource WebServerLaunchConfig ",
                "         --configsets All ",
                "         --region ",
                <span>{</span>
                  "Ref": "AWS::Region"
                },
                "\n",
                "# Signal the status from cfn-init\n",
                "/opt/aws/bin/cfn-signal -e $? ",
                "         --stack ",
                <span>{</span>
                  "Ref": "AWS::StackName"
                },
                "         --resource WebServerFleet ",
                "         --region ",
                <span>{</span>
                  "Ref": "AWS::Region"
                },
                "\n"
              ]
            ]
          }
        },</b>
        "SecurityGroups": [
          <span>{</span>
            "Ref": "WebServerSecurityGroup"
          }
        ]</code></pre>
                  <p>YAML</p>
                  <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="复制"><awsui-icon name="copy"></awsui-icon></div></div><code class="yaml "><b>      InstanceType: !Ref InstanceType
      ImageId: !FindInMap 
        - AWSRegionArch2AMI
        - !Ref 'AWS::Region'
        - !FindInMap 
          - AWSInstanceType2Arch
          - !Ref InstanceType
          - Arch
      KeyName: !Ref KeyName
      AssociatePublicIpAddress: 'true'
      UserData: !Base64 
        'Fn::Join':
          - ''
          - - |
              #!/bin/bash -xe
            - |
              yum install -y aws-cfn-bootstrap
            - |
              # Install the files and packages from the metadata
            - '/opt/aws/bin/cfn-init -v '
            - '         --stack '
            - !Ref 'AWS::StackName'
            - '         --resource WebServerLaunchConfig '
            - '         --configsets All '
            - '         --region '
            - !Ref 'AWS::Region'
            - |+

            - |
              # Signal the status from cfn-init
            - '/opt/aws/bin/cfn-signal -e $? '
            - '         --stack '
            - !Ref 'AWS::StackName'
            - '         --resource WebServerFleet '
            - '         --region '
            - !Ref 'AWS::Region'
            - |+</b>

      SecurityGroups:
        - !Ref WebServerSecurityGroup</code></pre>
                </dd>
              </dl></div>
          </li></ol>
      </li><li>
        <p>将启动配置元数据添加到 <code class="code">WebServerLaunchConfig</code> 资源，指示 cfn-init 帮助程序脚本启动 Web 服务器并创建基本网页。</p>
        <ol><li>
            <p>选择 <code class="code">WebServerLaunchConfig</code> 资源，然后在集成编辑器中选择<b>元数据</b>选项卡。</p>
          </li><li>
            <p><em>如果以 JSON 格式编写模板</em>：在 <code class="code">Metadata</code> 括号 (<code class="code"><span>{</span>}</code>) 内、<code class="code">AWS::CloudFormation::Designer</code> 右括号后面添加一个逗号 (<code class="code">,</code>)。</p>
          </li><li>
            <p>在 <code class="code">AWS::CloudFormation::Designer</code> 属性后添加下面的代码段，指示 cfn-init 帮助程序脚本启动 Web 服务器并创建基本网页。</p>
            <p>JSON</p>
            <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="复制"><awsui-icon name="copy"></awsui-icon></div></div><code class="json ">        "AWS::CloudFormation::Init" : <span>{</span>
          "configSets" : <span>{</span>
            "All" : [ "ConfigureSampleApp" ]
          },
          "ConfigureSampleApp" : <span>{</span>
            "packages" : <span>{</span>
              "yum" : <span>{</span>
                "httpd" : []
              }
            },
            "files" : <span>{</span>
              "/var/www/html/index.html" : <span>{</span>
                "content" : <span>{</span> "Fn::Join" : ["\n", [
                  "&lt;h1&gt;Congratulations, you have successfully launched the AWS CloudFormation sample.&lt;/h1&gt;"
                ]]},
                "mode"    : "000644",
                "owner"   : "root",
                "group"   : "root"
              }
            },
            "services" : <span>{</span>
              "sysvinit" : <span>{</span>
                "httpd"    : <span>{</span> "enabled" : "true", "ensureRunning" : "true" }
              }
            }
          }
        }</code></pre>
            <p>YAML</p>
            <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="复制"><awsui-icon name="copy"></awsui-icon></div></div><code class="yaml ">      'AWS::CloudFormation::Init':
        configSets:
          All:
            - ConfigureSampleApp
        ConfigureSampleApp:
          packages:
            yum:
              httpd: []
          files:
            /var/www/html/index.html:
              content: !Join 
                - |+

                - - &gt;-
                    &lt;h1&gt;Congratulations, you have successfully launched the AWS
                    CloudFormation sample.&lt;/h1&gt;
              mode: '000644'
              owner: root
              group: root
          services:
            sysvinit:
              httpd:
                enabled: 'true'
                ensureRunning: 'true'</code></pre>
          </li></ol>
      </li><li>
        <p>添加 <code class="code">WebServerCount</code> 参数。该参数指定在 CloudFormation 创建自动扩缩组时要创建多少个实例。</p>
        <ol><li>
            <p>选择 AWS CloudFormation Designer 画布上的空白区域。</p>
          </li><li>
            <p>在集成编辑器窗格中，选择<b>参数</b>选项卡。</p>
          </li><li>
            <p>在 集成编辑器 中添加以下参数。如果以 JSON 格式编写模板，请根据需要添加逗号。</p>
            <p>JSON</p>
            <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="复制"><awsui-icon name="copy"></awsui-icon></div></div><code class="json ">    "WebServerCount": <span>{</span>
      "Description": "Number of Amazon EC2 instances to launch for the WebServer server",
      "Type": "Number",
      "Default": "1"
    }</code></pre>
            <p>YAML</p>
            <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="复制"><awsui-icon name="copy"></awsui-icon></div></div><code class="yaml ">  WebServerCount:
    Description: Number of Amazon EC2 instances to launch for the WebServer server
    Type: Number
    Default: '1'</code></pre>
          </li></ol>
      </li><li>
        <p>修改模板输出以显示负载均衡器的 DNS 名称。</p>
        <ol><li>
            <p>在集成编辑器窗格中，选择<b>输出</b>选项卡。</p>
          </li><li>
            <p>修改 JSON 以使用负载均衡器 DNS 名称，如下面的代码段所示。</p>
            <p>JSON</p>
            <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="复制"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
  "Outputs": <span>{</span>
    "URL": <span>{</span>
      "Value": <span>{</span>
<b>        "Fn::GetAtt": [
          "PublicElasticLoadBalancer",
          "DNSName"
        ]</b>
      },
      "Description": "Newly created application URL"
    }
  }
}</code></pre>
            <p>如果以 YAML 格式编写模板，请使用下面的代码段。</p>
            <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="复制"><awsui-icon name="copy"></awsui-icon></div></div><code class="yaml ">Outputs:
  URL:
    Value: !GetAtt 
      - PublicElasticLoadBalancer
      - DNSName
    Description: Newly created application URL</code></pre>
          </li></ol>
      </li><li>
        <p>在 AWS CloudFormation Designer 工具栏上，选择 <b>Validate template</b>（验证模板）（<span class="inlinemediaobject">
             
              <img src="images/designer-validate-icon.png" class="aws-docs-img-whiteBg aws-docs-img-xs-padding" />
             
          </span>）以检查模板中的语法错误。</p>
        <p>查看并修复 <b>Messages</b> 窗格中的错误，然后再次验证模板。如果未看到错误，则说明您的模板语法上是有效的。</p>
      </li><li>
        <p>从 AWS CloudFormation Designer 工具栏中，选择 <b>File</b>（文件）（<span class="inlinemediaobject">
             
              <img src="images/designer-file-menu.png" class="aws-docs-img-whiteBg aws-docs-img-xs-padding" />
             
          </span>），然后选择 <b>Save</b>（保存）以在本地保存模板。</p>
      </li></ol></div>
    <p>现在，您已获得一个可用于更新基本 Web 服务器堆栈的修改的 CloudFormation 模板。在下一步中，我们将使用此模板更新基本 Web 服务器堆栈。</p>
   
   <h2 id="working-with-templates-cfn-designer-walkthrough-updatebasicwebserver-update-stack">步骤 3：更新堆栈</h2>
    <p>要实施模板更改，我们需要更新基本 Web 服务器堆栈。您可以从 AWS CloudFormation Designer 中直接启动 CloudFormation 更新堆栈向导。</p>
    <div class="procedure"><h6>更新堆栈</h6><ol><li>
        <p>在 AWS CloudFormation Designer 工具栏上，选择 <b>Create Stack</b>（创建堆栈）（<span class="inlinemediaobject">
             
              <img src="images/designer-create-stack-icon.png" class="aws-docs-img-whiteBg aws-docs-img-xs-padding" />
             
          </span>）。</p>
        <p>AWS CloudFormation Designer 将打开的模板保存到 S3 桶中，然后启动 CloudFormation 更新堆栈向导。由于我们修改了 <code class="code">BasicWebServerStack</code> 堆栈的模板，因此，CloudFormation 会为此堆栈启动更新堆栈向导。</p>
      </li><li>
        <p>CloudFormation 会自动填充模板 URL；选择 <b>Next</b>。</p>
      </li><li>
        <p>在 <b>Stack</b> 部分的 <b>Name</b> 字段中，确认堆栈名称为 <code class="code">BasicWebServerStack</code>。</p>
      </li><li>
        <p>在 <b>Parameters</b> 部分中，使用现有的值；选择 <b>Next</b>。</p>
      </li><li>
        <p>在本演练中，您无需添加标记或指定高级设置，因此请选择 <b>Next</b>。</p>
      </li><li>
        <p>确保堆栈名称正确，然后选择 <b>Update</b>。</p>
      </li></ol></div>
    <p>CloudFormation 可能需要几分钟时间更新堆栈。要监控进度，可查看堆栈事件。有关更多信息，请参阅<a href="./cfn-console-view-stack-data-resources.html">在 AWS Management Console上查看 AWS CloudFormation 堆栈数据和资源</a>。堆栈更新后，查看堆栈输出并前往网站 URL，确认网站正在运行。有关更多信息，请参阅<a href="./cfn-console-view-stack-data-resources.html">在 AWS Management Console上查看 AWS CloudFormation 堆栈数据和资源</a>。您使用 AWS CloudFormation Designer 成功地更新了模板和堆栈。</p>
    <p>要确保不因任何不必要的服务而产生费用，您可以删除此堆栈。</p>
   
   <h2 id="working-with-templates-cfn-designer-walkthrough-updatebasicwebserver-delete-stack">步骤 4：清理资源</h2>
    
    <p>要确保不因不必要的服务而产生费用，请删除您的堆栈及其资源。</p>
    <div class="procedure"><h6>删除堆栈</h6><ol><li>
        <p>从 CloudFormation 控制台，选择 <b>BasicWebServerStack</b> 堆栈。</p>
      </li><li>
        <p>选择 <b>Delete Stack</b>。</p>
      </li><li>
        <p>在确认消息中，选择 <b>Yes, Delete</b>。</p>
      </li></ol></div>
    <p>CloudFormation 可能需要几分钟时间删除堆栈。要监控进度，可查看堆栈事件。堆栈删除后，您创建的所有资源都被删除。现在，您已明白如何使用 AWS CloudFormation Designer，您可以使用它构建和修改自己的模板了。</p>
  <awsdocs-copyright class="copyright-print"></awsdocs-copyright><awsdocs-thumb-feedback right-edge="{{$ctrl.thumbFeedbackRightEdge}}"></awsdocs-thumb-feedback></div><noscript><div><div><div><div id="js_error_message"><p><img src="https://d1ge0kk1l5kms0.cloudfront.net/images/G/01/webservices/console/warning.png" alt="警告" /> <strong>Javascript 在您的浏览器中被禁用或不可用。</strong></p><p>要使用 Amazon Web Services 文档，必须启用 Javascript。请参阅浏览器的帮助页面以了解相关说明。</p></div></div></div></div></noscript><div id="main-col-footer" class="awsui-util-font-size-0"><div id="doc-conventions"><a target="_top" href="/general/latest/gr/docconventions.html">文档惯例</a></div><div class="prev-next"><div id="previous" class="prev-link" accesskey="p" href="./working-with-templates-cfn-designer-walkthrough-createbasicwebserver.html">演练：使用 AWS CloudFormation Designer 创建基本 Web 服务器</div><div id="next" class="next-link" accesskey="n" href="./peer-with-vpc-in-another-account.html">与另一个账户中的 VPC 对等</div></div></div><awsdocs-page-utilities></awsdocs-page-utilities></div><div id="quick-feedback-yes" style="display: none;"><div class="title">此页面对您有帮助吗？- 是</div><div class="content"><p>感谢您对我们工作的肯定！</p><p>如果不耽误您的时间，请告诉我们做得好的地方，让我们做得更好。</p><p><awsui-button id="fblink" rel="noopener noreferrer" target="_blank" text="反馈" click="linkClick($event)" href="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=CloudFormation&amp;topic_url=https://docs.aws.amazon.com/zh_cn/AWSCloudFormation/latest/UserGuide/working-with-templates-cfn-designer-walkthrough-updatebasicwebserver.html"></awsui-button></p></div></div><div id="quick-feedback-no" style="display: none;"><div class="title">此页面对您有帮助吗？- 否</div><div class="content"><p>感谢您告诉我们本页内容还需要完善。很抱歉让您失望了。</p><p>如果不耽误您的时间，请告诉我们如何改进文档。</p><p><awsui-button id="fblink" rel="noopener noreferrer" target="_blank" text="反馈" click="linkClick($event)" href="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=CloudFormation&amp;topic_url=https://docs.aws.amazon.com/zh_cn/AWSCloudFormation/latest/UserGuide/working-with-templates-cfn-designer-walkthrough-updatebasicwebserver.html"></awsui-button></p></div></div></div></body></div></awsdocs-view><div class="page-loading-indicator" id="page-loading-indicator"><awsui-spinner size="large"></awsui-spinner></div></div><div id="tools-panel" dom-region="tools"><awsdocs-tools-panel id="awsdocs-tools-panel"></awsdocs-tools-panel></div></awsui-app-layout><awsdocs-cookie-banner class="doc-cookie-banner"></awsdocs-cookie-banner></div></body></html>