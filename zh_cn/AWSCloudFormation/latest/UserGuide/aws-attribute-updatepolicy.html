<!DOCTYPE html>
    <html xmlns="http://www.w3.org/1999/xhtml" lang="zh-CN"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>UpdatePolicy 属性 - AWS CloudFormation</title><meta name="viewport" content="width=device-width,initial-scale=1" /><meta name="assets_root" content="/assets" /><meta name="target_state" content="aws-attribute-updatepolicy" /><meta name="default_state" content="aws-attribute-updatepolicy" /><link rel="icon" type="image/ico" href="/assets/images/favicon.ico" /><link rel="shortcut icon" type="image/ico" href="/assets/images/favicon.ico" /><link rel="canonical" href="https://docs.aws.amazon.com/zh_cn/AWSCloudFormation/latest/UserGuide/aws-attribute-updatepolicy.html" /><meta name="description" content="指定如何使用 UpdatePolicy 属性处理以下资源的更新： AWS::AutoScaling::AutoScalingGroup、AWS::AutoScaling::AutoScalingGroup、AWS::ElastiCache::ReplicationGroup、AWS::OpenSearchService::Domain、AWS::Elasticsearch::Domain 或 AWS::Lambda::Alias。" /><meta name="deployment_region" content="IAD" /><meta name="product" content="AWS CloudFormation" /><meta name="guide" content="用户指南" /><meta name="abstract" content="根据此用户指南，使用 AWS CloudFormation 以可预见方式反复创建和管理 AWS 基础设施部署。" /><meta name="guide-locale" content="zh_cn" /><meta name="tocs" content="toc-contents.json" /><link rel="canonical" href="https://docs.aws.amazon.com/zh_cn/AWSCloudFormation/latest/UserGuide/aws-attribute-updatepolicy.html" /><link rel="alternative" href="https://docs.aws.amazon.com/id_id/AWSCloudFormation/latest/UserGuide/aws-attribute-updatepolicy.html" hreflang="id-id" /><link rel="alternative" href="https://docs.aws.amazon.com/id_id/AWSCloudFormation/latest/UserGuide/aws-attribute-updatepolicy.html" hreflang="id" /><link rel="alternative" href="https://docs.aws.amazon.com/de_de/AWSCloudFormation/latest/UserGuide/aws-attribute-updatepolicy.html" hreflang="de-de" /><link rel="alternative" href="https://docs.aws.amazon.com/de_de/AWSCloudFormation/latest/UserGuide/aws-attribute-updatepolicy.html" hreflang="de" /><link rel="alternative" href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-attribute-updatepolicy.html" hreflang="en-us" /><link rel="alternative" href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-attribute-updatepolicy.html" hreflang="en" /><link rel="alternative" href="https://docs.aws.amazon.com/es_es/AWSCloudFormation/latest/UserGuide/aws-attribute-updatepolicy.html" hreflang="es-es" /><link rel="alternative" href="https://docs.aws.amazon.com/es_es/AWSCloudFormation/latest/UserGuide/aws-attribute-updatepolicy.html" hreflang="es" /><link rel="alternative" href="https://docs.aws.amazon.com/fr_fr/AWSCloudFormation/latest/UserGuide/aws-attribute-updatepolicy.html" hreflang="fr-fr" /><link rel="alternative" href="https://docs.aws.amazon.com/fr_fr/AWSCloudFormation/latest/UserGuide/aws-attribute-updatepolicy.html" hreflang="fr" /><link rel="alternative" href="https://docs.aws.amazon.com/it_it/AWSCloudFormation/latest/UserGuide/aws-attribute-updatepolicy.html" hreflang="it-it" /><link rel="alternative" href="https://docs.aws.amazon.com/it_it/AWSCloudFormation/latest/UserGuide/aws-attribute-updatepolicy.html" hreflang="it" /><link rel="alternative" href="https://docs.aws.amazon.com/ja_jp/AWSCloudFormation/latest/UserGuide/aws-attribute-updatepolicy.html" hreflang="ja-jp" /><link rel="alternative" href="https://docs.aws.amazon.com/ja_jp/AWSCloudFormation/latest/UserGuide/aws-attribute-updatepolicy.html" hreflang="ja" /><link rel="alternative" href="https://docs.aws.amazon.com/ko_kr/AWSCloudFormation/latest/UserGuide/aws-attribute-updatepolicy.html" hreflang="ko-kr" /><link rel="alternative" href="https://docs.aws.amazon.com/ko_kr/AWSCloudFormation/latest/UserGuide/aws-attribute-updatepolicy.html" hreflang="ko" /><link rel="alternative" href="https://docs.aws.amazon.com/pt_br/AWSCloudFormation/latest/UserGuide/aws-attribute-updatepolicy.html" hreflang="pt-br" /><link rel="alternative" href="https://docs.aws.amazon.com/pt_br/AWSCloudFormation/latest/UserGuide/aws-attribute-updatepolicy.html" hreflang="pt" /><link rel="alternative" href="https://docs.aws.amazon.com/zh_cn/AWSCloudFormation/latest/UserGuide/aws-attribute-updatepolicy.html" hreflang="zh-cn" /><link rel="alternative" href="https://docs.aws.amazon.com/zh_tw/AWSCloudFormation/latest/UserGuide/aws-attribute-updatepolicy.html" hreflang="zh-tw" /><link rel="alternative" href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-attribute-updatepolicy.html" hreflang="x-default" /><meta name="feedback-item" content="CloudFormation" /><meta name="this_doc_product" content="AWS CloudFormation" /><meta name="this_doc_guide" content="用户指南" /><script defer="" src="/assets/r/vendor4.js?version=2021.12.02"></script><script defer="" src="/assets/r/vendor3.js?version=2021.12.02"></script><script defer="" src="/assets/r/vendor1.js?version=2021.12.02"></script><script defer="" src="/assets/r/awsdocs-common.js?version=2021.12.02"></script><script defer="" src="/assets/r/awsdocs-doc-page.js?version=2021.12.02"></script><link href="/assets/r/vendor4.css?version=2021.12.02" rel="stylesheet" /><link href="/assets/r/awsdocs-common.css?version=2021.12.02" rel="stylesheet" /><link href="/assets/r/awsdocs-doc-page.css?version=2021.12.02" rel="stylesheet" /><script async="" id="awsc-panorama-bundle" type="text/javascript" src="https://prod.pa.cdn.uis.awsstatic.com/panorama-nav-init.js" data-config="{'appEntity':'aws-documentation','region':'us-east-1','service':'cloudformation'}"></script><meta id="panorama-serviceSubSection" value="用户指南" /><meta id="panorama-serviceConsolePage" value="UpdatePolicy 属性" /></head><body class="awsdocs awsui"><div class="awsdocs-container"><awsdocs-header></awsdocs-header><awsui-app-layout id="app-layout" class="awsui-util-no-gutters" ng-controller="ContentController as $ctrl" header-selector="awsdocs-header" navigation-hide="false" navigation-width="$ctrl.navWidth" navigation-open="$ctrl.navOpen" navigation-change="$ctrl.onNavChange($event)" tools-hide="$ctrl.hideTools" tools-width="$ctrl.toolsWidth" tools-open="$ctrl.toolsOpen" tools-change="$ctrl.onToolsChange($event)"><div id="guide-toc" dom-region="navigation"><awsdocs-toc></awsdocs-toc></div><div id="main-column" dom-region="content" tabindex="-1"><awsdocs-view class="awsdocs-view"><div id="awsdocs-content"><head><title>UpdatePolicy 属性 - AWS CloudFormation</title><meta name="rss" content="aws-cloudformation-release-notes.rss" /><meta name="forums" content="http://forums.aws.amazon.com/forum.jspa?forumID=92" /><meta name="feedback" content="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=CloudFormation&amp;topic_url=https://docs.aws.amazon.com/zh_cn/AWSCloudFormation/latest/UserGuide/aws-attribute-updatepolicy.html" /><meta name="feedback-yes" content="feedbackyes.html?topic_url=https://docs.aws.amazon.com/zh_cn/AWSCloudFormation/latest/UserGuide/aws-attribute-updatepolicy.html" /><meta name="feedback-no" content="feedbackno.html?topic_url=https://docs.aws.amazon.com/zh_cn/AWSCloudFormation/latest/UserGuide/aws-attribute-updatepolicy.html" /><meta name="keywords" content="CloudFormation,AWSCloudFormation,资源预置,资源配置,基础设施管理,CloudFormer,CloudFormation 堆栈,CloudFormation 堆栈集,CloudFormation 模板,更改集" /><script type="application/ld+json">
{
    "@context" : "https://schema.org",
    "@type" : "BreadcrumbList",
    "itemListElement" : [
      {
        "@type" : "ListItem",
        "position" : 1,
        "name" : "AWS",
        "item" : "https://aws.amazon.com"
      },
      {
        "@type" : "ListItem",
        "position" : 2,
        "name" : "AWS CloudFormation",
        "item" : "https://docs.aws.amazon.com/cloudformation/index.html"
      },
      {
        "@type" : "ListItem",
        "position" : 3,
        "name" : "用户指南",
        "item" : "https://docs.aws.amazon.com/zh_cn/AWSCloudFormation/latest/UserGuide"
      },
      {
        "@type" : "ListItem",
        "position" : 4,
        "name" : "模板参考",
        "item" : "https://docs.aws.amazon.com/zh_cn/AWSCloudFormation/latest/UserGuide/template-reference.html"
      },
      {
        "@type" : "ListItem",
        "position" : 5,
        "name" : "资源属性引用",
        "item" : "https://docs.aws.amazon.com/zh_cn/AWSCloudFormation/latest/UserGuide/aws-product-attribute-reference.html"
      },
      {
        "@type" : "ListItem",
        "position" : 6,
        "name" : "UpdatePolicy 属性",
        "item" : "https://docs.aws.amazon.com/zh_cn/AWSCloudFormation/latest/UserGuide/aws-product-attribute-reference.html"
      }
    ]
}
</script></head><body><div id="main"><div style="display: none"></div><div id="breadcrumbs" class="breadcrumb"><a href="https://aws.amazon.com">AWS</a><a href="/index.html">文档</a><a href="/cloudformation/index.html">AWS CloudFormation</a><a href="Welcome.html">用户指南</a></div><div id="page-toc-src"><a href="#aws-resource-update-policies">资源更新策略</a><a href="#aws-attribute-update-policy-app-stream-fleet">AppStream 2.0 更新策略</a><a href="#cfn-attributes-updatepolicy-replacingupdate">AutoScalingReplacingUpdate 策略</a><a href="#cfn-attributes-updatepolicy-rollingupdate">AutoScalingRollingUpdate 策略</a><a href="#cfn-attributes-updatepolicy-scheduledactions">AutoScalingScheduledAction 策略</a><a href="#cfn-attributes-updatepolicy-useonlineresharding">UseOnlineResharding 策略</a><a href="#cfn-attributes-updatepolicy-upgradeopensearchdomain">EnableVersionUpgrade 策略</a><a href="#cfn-attributes-updatepolicy-codedeploylambdaaliasupdate">CodeDeployLambdaAlias 更新策略</a><a href="#aws-attribute-updatepolicy-examples">示例</a></div><div id="page-filters" style="display:none"><filter label="All" id="All"></filter><filter label="JSON" id="JSON"></filter><filter label="YAML" id="YAML"></filter></div><div id="main-content" class="awsui-util-container"><div id="main-col-body"><awsdocs-language-banner data-service="$ctrl.pageService"></awsdocs-language-banner><h1 class="topictitle" id="aws-attribute-updatepolicy"><code class="code">UpdatePolicy</code> 属性</h1><div class="awsdocs-page-header-container"><awsdocs-page-header></awsdocs-page-header><awsdocs-filter-selector id="awsdocs-filter-selector"></awsdocs-filter-selector></div><p>使用 <code class="code">UpdatePolicy</code> 属性指定 AWS CloudFormation 如何处理以下资源的更新：</p><div class="itemizedlist">
     
     
     
     
     
     
  <ul class="itemizedlist"><li class="listitem">
      <p><a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-resource-appstream-fleet.html"><code class="code">AWS::AppStream::Fleet</code></a></p>
    </li><li class="listitem">
      <p><a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-properties-as-group.html"><code class="code">AWS::AutoScaling::AutoScalingGroup</code></a></p>
    </li><li class="listitem">
      <p><a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-resource-elasticache-replicationgroup.html"><code class="code">AWS::ElastiCache::ReplicationGroup</code></a></p>
    </li><li class="listitem">
      <p><a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-resource-opensearchservice-domain.html"><code class="code">AWS::OpenSearchService::Domain</code></a></p>
    </li><li class="listitem">
      <p><a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-resource-elasticsearch-domain.html"><code class="code">AWS::Elasticsearch::Domain</code></a></p>
    </li><li class="listitem">
      <p><a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-resource-lambda-alias.html"><code class="code">AWS::Lambda::Alias</code></a></p>
    </li></ul></div>
  <h2 id="aws-resource-update-policies">资源更新策略</h2>

  <div class="itemizedlist">
     

     

     

     

     
  <ul class="itemizedlist"><li class="listitem">
      <p>对于 <code class="code">AWS::AppStream::Fleet</code> 资源，CloudFormation 可以使用较新的 AppStream 2.0 代理软件更新映像生成器。有关更多信息，请参阅<a href="https://docs.aws.amazon.com/appstream2/latest/developerguide/base-images-agent.html">管理 AppStream 2.0 版本</a>。</p>
    </li><li class="listitem">
      <p>对于 <code class="code">AWS::AutoScaling::AutoScalingGroup</code> 资源，CloudFormation 调用三种更新策略之一，具体取决于所做更改的类型或计划的操作是否与自动扩缩组关联。</p>
      <div class="itemizedlist">
         
         
      <ul class="itemizedlist"><li class="listitem">
          <p><code class="code">AutoScalingReplacingUpdate</code> 和 <code class="code">AutoScalingRollingUpdate</code> 策略<em>仅</em>在您完成下列一项或多项操作时适用：</p>
          <div class="itemizedlist">
             
             
             
             
          <ul class="itemizedlist"><li class="listitem">
              <p>更改自动扩缩组的 <code class="code"><a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-properties-as-launchconfig.html">AWS::AutoScaling::LaunchConfiguration</a></code>。</p>
            </li><li class="listitem">
              <p>更改自动扩缩组的 <code class="code">VPCZoneIdentifier</code> 属性。</p>
            </li><li class="listitem">
              <p>更改自动扩缩组的 <code class="code">LaunchTemplate</code> 属性。</p>
            </li><li class="listitem">
              <p>更新包含与当前 <code class="code">LaunchConfiguration</code> 不匹配的实例的自动扩缩组。</p>
            </li></ul></div>
          <p>如果同时指定 <code class="code">AutoScalingReplacingUpdate</code> 和 <code class="code">AutoScalingRollingUpdate</code> 策略，则将 <code class="code">WillReplace</code> 属性设置为 <code class="code">true</code> 将使 <code class="code">AutoScalingReplacingUpdate</code> 优先。</p>
        </li><li class="listitem">
          <p>如果更新的堆栈，包含具有关联的计划操作的自动扩缩组，则将应用 <code class="code">AutoScalingScheduledAction</code> 策略。</p>
        </li></ul></div>
    </li><li class="listitem">
      <p>对于 <code class="code">AWS::ElastiCache::ReplicationGroup</code> 资源，CloudFormation 可以添加或删除分片，以修改复制组的分片，而不是替换整个资源。有关更多信息，请参阅<a href="#cfn-attributes-updatepolicy-useonlineresharding">UseOnlineResharding 策略</a>。</p>
    </li><li class="listitem">
      <p>对于 <code class="code">AWS::OpenSearchService::Domain</code> 和旧式 <code class="code">AWS::Elasticsearch::Domain</code> 资源，CloudFormation 可以将 OpenSearch Service 域升级到新版本的 OpenSearch 或 Elasticsearch，而无需替换整个资源。有关更多信息，请参阅<a href="#cfn-attributes-updatepolicy-upgradeopensearchdomain">EnableVersionUpgrade 策略</a>。</p>
    </li><li class="listitem">
      <p>对于 <code class="code">AWS::Lambda::Alias</code> 资源，在别名上的版本发生变化时，CloudFormation 将执行 CodeDeploy 部署。有关更多信息，请参阅<a href="#cfn-attributes-updatepolicy-codedeploylambdaaliasupdate">CodeDeployLambdaAlias 更新策略</a>。</p>
    </li></ul></div>
 
    <h2 id="aws-attribute-update-policy-app-stream-fleet">AppStream 2.0 更新策略</h2>
    <p>更新策略的 AppStream 2.0 配置。</p>
     
      <h3 id="aws-attribute-update-policy-app-stream-fleet-syntax">语法</h3>
      <div id="JSON" name="JSON" class="section langfilter">
        <h4 id="aws-attribute-update-policy-app-stream-fleet-syntax-json">JSON</h4>
        <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="复制"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
    "UpdatePolicy": <span>{</span>
        "<a href="#cfn-attributes-updatepolicy-replacingupdate-StopBeforeUpdate">StopBeforeUpdate</a>": <span>{</span>
            "Type": "<code class="replaceable">Boolean</code>"
        },
        "<a href="#cfn-attributes-updatepolicy-replacingupdate-StartAfterUpdate">StartAfterUpdate</a>": <span>{</span>
            "Type": "<code class="replaceable">Boolean</code>"
        }
    }
}</code></pre>
      </div>
      <div id="YAML" name="YAML" class="section langfilter">
        <h4 id="aws-attribute-update-policy-app-stream-fleet-syntax-yaml">YAML</h4>
        <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="复制"><awsui-icon name="copy"></awsui-icon></div></div><code class="yaml ">UpdatePolicy:
  <a href="#cfn-attributes-updatepolicy-replacingupdate-StopBeforeUpdate">StopBeforeUpdate</a>:
    Type: <code class="replaceable">Boolean</code>
  <a href="#cfn-attributes-updatepolicy-replacingupdate-StartAfterUpdate">StartAfterUpdate</a>:
    Type: <code class="replaceable">Boolean</code></code></pre>
      </div>
      <div class="variablelist">
         
         
      <dl>
          <dt id="cfn-attributes-updatepolicy-replacingupdate-StopBeforeUpdate"><span class="term"><code class="code">StopBeforeUpdate</code></span></dt>
          <dd>
            <p>更新前停止指定的实例集。</p>
            <p><em>必需</em>：否</p>
          </dd>
         
          <dt id="cfn-attributes-updatepolicy-replacingupdate-StartAfterUpdate"><span class="term"><code class="code">StartAfterUpdate</code></span></dt>
          <dd>
            <p>更新后启动指定的实例集。</p>
            <p><em>必需</em>：否</p>
          </dd>

        </dl></div>
     
   
    <h2 id="cfn-attributes-updatepolicy-replacingupdate">AutoScalingReplacingUpdate 策略</h2>

    <p>要指定 AWS CloudFormation 如何处理自动扩缩组的替换更新，请使用 <code class="code">AutoScalingReplacingUpdate</code> 策略。对于该策略，您可以指定 AWS CloudFormation 是将自动扩缩组替换为新组，还是仅替换自动扩缩组中的实例。</p>
    <div class="awsdocs-note awsdocs-important"><div class="awsdocs-note-title"><awsui-icon name="status-warning" variant="error"></awsui-icon><h6>重要</h6></div><div class="awsdocs-note-text"><p>在尝试更新之前，请确保您具有足够的 Amazon EC2 容量来容纳旧的和新的自动扩缩组。</p></div></div>


     
      <h3 id="cfn-attributes-updatepolicy-replacingupdate-syntax">语法</h3>

      <div id="JSON" name="JSON" class="section langfilter">
        <h4 id="aws-attribute-updatepolicy-replacingupdate-syntax.json">JSON</h4>

        <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="复制"><awsui-icon name="copy"></awsui-icon></div></div><code class="json ">"UpdatePolicy" : <span>{</span>
  "<a href="#cfn-attributes-updatepolicy-replacingupdate">AutoScalingReplacingUpdate</a>" : <span>{</span>
    "<a href="#cfn-attributes-updatepolicy-replacingupdate-willreplace">WillReplace</a>" : <code class="replaceable">Boolean</code>
  }
}</code></pre>
      </div>
      <div id="YAML" name="YAML" class="section langfilter">
        <h4 id="aws-attribute-updatepolicy-replacingupdate-syntax.yaml">YAML</h4>

        <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="复制"><awsui-icon name="copy"></awsui-icon></div></div><code class="yaml ">UpdatePolicy:
  <a href="#cfn-attributes-updatepolicy-replacingupdate">AutoScalingReplacingUpdate</a>:
    <a href="#cfn-attributes-updatepolicy-replacingupdate-willreplace">WillReplace</a>: <code class="replaceable">Boolean</code></code></pre>
      </div>
     
     
      <h3 id="cfn-attributes-updatepolicy-replacingupdate-properties">属性</h3>

      <div class="variablelist">
         
      <dl>
          <dt id="cfn-attributes-updatepolicy-replacingupdate-willreplace"><span class="term"><code class="code">WillReplace</code></span></dt>
          <dd>
            <p>指定在更新期间是否替换自动扩缩组及其包含的实例。在替换期间，CloudFormation 将保留旧组，直至完成创建新组。如果更新失败，CloudFormation 可以回滚到旧的自动扩缩组，并删除新的自动扩缩组。</p>
            <p>当 CloudFormation 创建新组时，不会分离或附加任何实例。在成功创建新的自动扩缩组后，CloudFormation 在清除过程中，删除旧的自动扩缩组。</p>
            <p>在设置 <code class="code">WillReplace</code> 参数时，请记住指定匹配的 <code class="code"><a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-attribute-creationpolicy.html">CreationPolicy</a></code>。如果在 <code class="code">Timeout</code> 期间（在 <code class="code">CreationPolicy</code> 策略中指定）发出成功信号的实例未达到最小实例数（由 <code class="code">MinSuccessfulInstancesPercent</code> 属性指定），替换更新将失败，并且 AWS CloudFormation 回滚到旧的自动扩缩组。</p>
            <p><em>类型</em>：布尔值</p>
            <p><em>必需</em>：否</p>
          </dd>
        </dl></div>
     
   
    <h2 id="cfn-attributes-updatepolicy-rollingupdate">AutoScalingRollingUpdate 策略</h2>

    <p>要指定 CloudFormation 处理自动扩缩组的滚动更新方式，请使用 <code class="code">AutoScalingRollingUpdate</code> 策略。对于滚动更新，您可以指定 AWS CloudFormation 是批量更新自动扩缩组中的实例，还是一次性更新所有实例。</p>
    <div class="awsdocs-note awsdocs-important"><div class="awsdocs-note-title"><awsui-icon name="status-warning" variant="error"></awsui-icon><h6>重要</h6></div><div class="awsdocs-note-text"><p>在滚动更新期间，某些 Auto Scaling 进程可能会在 CloudFormation 完成滚动更新之前，对自动扩缩组进行更改。这些更改可能导致滚动更新失败。要禁止 Auto Scaling 在滚动更新期间运行进程，请使用 <code class="code">SuspendProcesses</code> 属性。有关更多信息，请参阅<a href="https://aws.amazon.com/premiumsupport/knowledge-center/auto-scaling-group-rolling-updates/" rel="noopener noreferrer" target="_blank"><span>执行自动扩缩组滚动更新的最佳实践建议</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a>。</p></div></div>

    <p>请注意，在堆栈更新回滚操作期间，CloudFormation 使用在当前堆栈更新操作之前在模板中指定的 <code class="code">UpdatePolicy</code> 配置。例如，假设您将堆栈模板的 <code class="code">UpdatePolicy</code> 中的 <code class="code">MaxBatchSize</code> 从 1 更新为 10。然后，您执行堆栈更新，该更新失败并且 CloudFormation 启动更新回滚操作。在这种情况下，CloudFormation 将 1 作为最大批次大小，而不是 10。因此，在堆栈更新中对 <code class="code">UpdatePolicy</code> 配置进行更改时，我们建议您将该更新与可能启动滚动更新的任何 <code class="code">AWS::AutoScaling::AutoScalingGroup</code> 资源更新分开，并在这些资源更新之前进行。</p>

    
      <h3 id="cfn-attributes-updatepolicy-rollingupdate-syntax">语法</h3>

      <div id="JSON" name="JSON" class="section langfilter">
        <h4 id="aws-attribute-updatepolicy-rollingupdate-syntax.json">JSON</h4>

        <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="复制"><awsui-icon name="copy"></awsui-icon></div></div><code class="json ">"UpdatePolicy" : <span>{</span>
  "<a href="#cfn-attributes-updatepolicy-rollingupdate">AutoScalingRollingUpdate</a>" : <span>{</span>
    "<a href="#cfn-attributes-updatepolicy-rollingupdate-maxbatchsize">MaxBatchSize</a>" : <code class="replaceable">Integer</code>,
    "<a href="#cfn-attributes-updatepolicy-rollingupdate-minactiveinstancespercent">MinActiveInstancesPercent</a>" : <code class="replaceable">Integer</code>,
    "<a href="#cfn-attributes-updatepolicy-rollingupdate-mininstancesinservice">MinInstancesInService</a>" : <code class="replaceable">Integer</code>,
    "<a href="#cfn-attributes-updatepolicy-rollingupdate-minsuccessfulinstancespercent">MinSuccessfulInstancesPercent</a>" : <code class="replaceable">Integer</code>,
    "<a href="#cfn-attributes-updatepolicy-rollingupdate-pausetime">PauseTime</a>" : <code class="replaceable">String</code>,
    "<a href="#cfn-attributes-updatepolicy-rollingupdate-suspendprocesses">SuspendProcesses</a>" : [ <code class="replaceable">List of processes</code> ],
    "<a href="#cfn-attributes-updatepolicy-rollingupdate-waitonresourcesignals">WaitOnResourceSignals</a>" : <code class="replaceable">Boolean</code>
  }
}</code></pre>
      </div>
      <div id="YAML" name="YAML" class="section langfilter">
        <h4 id="aws-attribute-updatepolicy-rollingupdate-syntax.yaml">YAML</h4>

        <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="复制"><awsui-icon name="copy"></awsui-icon></div></div><code class="yaml ">UpdatePolicy:
  <a href="#cfn-attributes-updatepolicy-rollingupdate">AutoScalingRollingUpdate</a>:
    <a href="#cfn-attributes-updatepolicy-rollingupdate-maxbatchsize">MaxBatchSize</a>: <code class="replaceable">Integer</code>
    <a href="#cfn-attributes-updatepolicy-rollingupdate-minactiveinstancespercent">MinActiveInstancesPercent</a>: <code class="replaceable">Integer</code>
    <a href="#cfn-attributes-updatepolicy-rollingupdate-mininstancesinservice">MinInstancesInService</a>: <code class="replaceable">Integer</code>
    <a href="#cfn-attributes-updatepolicy-rollingupdate-minsuccessfulinstancespercent">MinSuccessfulInstancesPercent</a>: <code class="replaceable">Integer</code>
    <a href="#cfn-attributes-updatepolicy-rollingupdate-pausetime">PauseTime</a>: <code class="replaceable">String</code>
    <a href="#cfn-attributes-updatepolicy-rollingupdate-suspendprocesses">SuspendProcesses</a>:
      - <code class="replaceable">List of processes</code>
    <a href="#cfn-attributes-updatepolicy-rollingupdate-waitonresourcesignals">WaitOnResourceSignals</a>: <code class="replaceable">Boolean</code></code></pre>
      </div>
     
     
      <h3 id="aws-attribute-updatepolicy-rollingupdate-properties">属性</h3>
      <div class="variablelist">
         
        
         
         
         
         
         
      <dl>
          <dt id="cfn-attributes-updatepolicy-rollingupdate-maxbatchsize"><span class="term"><code class="code">MaxBatchSize</code></span></dt>
          <dd>
            <p>指定可以同时替换的最大实例数量。</p>
            <p><em>默认值</em>：<code class="code">1</code></p>
            <p><em>最大值</em>：<code class="code">100</code></p>
            <p><em>类型</em>：整数</p>
            <p><em>必需</em>：否</p>
          </dd>
         
     <dt id="cfn-attributes-updatepolicy-rollingupdate-minactiveinstancespercent"><span class="term"><code class="code">MinActiveInstancesPercent</code></span></dt>
     <dd>
      <p>指定要取得更新成功，自动扩缩组中必须处于 <code class="code">InService</code> 状态的实例相对于滚动更新期间该组所需容量的百分比。可以指定从 0 到 100 的值。CloudFormation 取整到最接近的十分位值。例如，如果您更新五个实例，最小 <code class="code">InService</code> 百分比为 50，则至少有三个实例必须处于 <code class="code">InService</code> 状态。</p>
      <p>如果实例未在 1 小时的固定时间内转换为 <code class="code">InService</code> 状态，則 CloudFormation 会假定该实例未更新。</p>
      <p>如果您指定该属性，则还必须启用 <code class="code">PauseTime</code> 属性。</p>
      <p><code class="code">MinActiveInstancesPercent</code> 参数仅适用于只用于稳定目的的实例。要指定自动扩缩组中的实例数，请参阅 <code class="code">AWS::AutoScaling::AutoScalingGroup</code> 资源的 <code class="code">MinSize</code>、<a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-properties-as-group.html#cfn-as-group-maxsize"><code class="code">MaxSize</code></a> 和 <code class="code">DesiredCapacity</code> 属性。</p>
      <p>在 <code class="code">UpdatePolicy</code> 中设置 <code class="code">MinActiveInstancesPercent</code> 还会影响为响应 <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-properties-as-group.html"><code class="code">AWS::AutoScaling::AutoScalingGroup</code></a> 资源中的 <code class="code">DesiredCapacity</code> 属性高于该自动扩缩组当前所需容量而启动的实例。</p>
      <p><em>默认值</em>：<code class="code">100</code></p>
      <p><em>类型</em>：整数</p>
      <p><em>必需</em>：否</p>
     </dd>
     
          <dt id="cfn-attributes-updatepolicy-rollingupdate-mininstancesinservice"><span class="term"><code class="code">MinInstancesInService</code></span></dt>
          <dd>
            <p>指定当 Auto Scaling 更新旧实例时，CloudFormation 组中必须处于服务状态的实例的最小数目。该值必须小于自动扩缩组的 <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-properties-as-group.html#cfn-as-group-maxsize"><code class="code">MaxSize</code></a>。</p>
            <p><em>默认值</em>：<code class="code">0</code></p>
            <p><em>类型</em>：整数</p>
            <p><em>必需</em>：否</p>
          </dd>
         
          <dt id="cfn-attributes-updatepolicy-rollingupdate-minsuccessfulinstancespercent"><span class="term"><code class="code">MinSuccessfulInstancesPercent</code></span></dt>
          <dd>
            <p>指定 Auto Scaling 回滚更新中必须有多少实例 (百分比) 发送成功信号，才认为更新成功。可以指定从 <code class="code">0</code> 到 <code class="code">100</code> 的值。CloudFormation 取整到最接近的十分位值。例如，如果您更新五个实例，最小成功百分比为 <code class="code">50</code>，则必须有三个实例发送成功信号才行。</p>
            <p>如果实例未在 <code class="code">PauseTime</code> 属性中指定的时间内发出信号，则 CloudFormation 会假定实例未更新。</p>
            <p>如果您指定该属性，则还必须启用 <code class="code">WaitOnResourceSignals</code> 和 <code class="code">PauseTime</code> 属性。</p>
            <p><code class="code">MinSuccessfulInstancesPercent</code> 参数仅适用于只用于发信号的实例。要指定 Auto Scaling 组中的实例数，请参阅 <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-properties-as-group.html"><code class="code">AWS::AutoScaling::AutoScalingGroup</code></a> 资源的 <code class="code">MinSize</code>、<code class="code">MaxSize</code> 和 <code class="code">DesiredCapacity</code> 属性。</p>
            <p><em>默认值</em>：<code class="code">100</code></p>
            <p><em>类型</em>：整数</p>
            <p><em>必需</em>：否</p>

            <div class="awsdocs-note awsdocs-important"><div class="awsdocs-note-title"><awsui-icon name="status-warning" variant="error"></awsui-icon><h6>重要</h6></div><div class="awsdocs-note-text"><p>当您将 <code class="code">MinSuccessfulInstancesPercent</code> 属性将设定为 <code class="code">0</code> 时，CloudFormation 等待 0% 的容量实例进入 <code class="code">InService</code> 状态。<code class="code">MinSuccessfulInstancesPercent</code> 在将自动扩缩组的状态视为 <code class="code">Update
                  Complete</code> 之前立即返回，以继续进入堆栈模板中定义的后续资源。</p><p>如果在 CloudFormation 模板中定义了其他自动扩缩组，则它们将同时更新。当所有自动扩缩组在 0% 的容量实例处于 <code class="code">InService</code> 状态时同时部署时，您将遇到可用性问题，因为有 0 个实例提供客户流量。</p><p>CloudFormation 建议将 <code class="code">MinSuccessfulInstancesPercent</code> 设置为大于 0 的值，允许在考虑完成自动扩缩组更新之前验证合理的最小实例数。</p></div></div>

          </dd>

         
          <dt id="cfn-attributes-updatepolicy-rollingupdate-pausetime"><span class="term"><code class="code">PauseTime</code></span></dt>
          <dd>
            <p>在对一批实例进行更改以便为这些实例提供启动软件应用程序的时间后，CloudFormation 暂停的时间量。例如，在增加自动扩缩组中的实例数时，您可能需要指定 <code class="code">PauseTime</code>。</p>
            <p>如果您启用 <code class="code">WaitOnResourceSignals</code> 属性，则 <code class="code">PauseTime</code> 为 CloudFormation 等待自动扩缩组收到来自所添加或所替换实例的所需数目的有效信号的时间量。如果在自动扩缩组收到所需信号数之前超过 <code class="code">PauseTime</code>，更新将失败。要获得最佳结果，请指定一个时段，以便于您的应用程序有足够的时间启动。如果更新需要回滚，则较短的 <code class="code">PauseTime</code> 会导致回滚失败。</p>
            <p>使用 <a href="http://en.wikipedia.org/wiki/ISO_8601#Durations" rel="noopener noreferrer" target="_blank"><span>ISO8601 持续时间格式</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a>（在 <code class="code">PT<code class="replaceable">#</code>H<code class="replaceable">#</code>M<code class="replaceable">#</code>S</code> 格式中，每个 <code class="replaceable">#</code> 分别表示小时数、分钟数和秒数）指定 <code class="code">PauseTime</code>。最大 <code class="code">PauseTime</code> 为 1 小时 (<code class="code">PT1H</code>)。</p>
            <p><em>默认值</em>：<code class="code">PT1H</code>（1 小时），此时 <code class="code">WaitOnResourceSignals</code> 属性设置为 <code class="code">true</code>。</p>
            <p><em>类型</em>：字符串</p>
            <p><em>必需</em>：否</p>
          </dd>
         
          <dt id="cfn-attributes-updatepolicy-rollingupdate-suspendprocesses"><span class="term"><code class="code">SuspendProcesses</code></span></dt>
          <dd>
            <p>指定堆栈更新期间要暂停的 Auto Scaling 流程。暂停处理可防止 Auto Scaling 干扰堆栈更新。例如，您可以暂停警报，以便 Amazon EC2 Auto Scaling 不执行与警报关联的扩展策略。有关有效值，请参阅《Amazon EC2 Auto Scaling API 参考》中的 <a href="https://docs.aws.amazon.com/autoscaling/ec2/APIReference/API_SuspendProcesses.html">SuspendProcesses</a> 操作的 <code class="code">ScalingProcesses.member.N</code> 参数。</p>
            <p><em>默认值</em>：未指定</p>
            <p><em>类型</em>：Auto Scaling 流程列表</p>
            <p><em>必需</em>：否</p>
          </dd>
         
          <dt id="cfn-attributes-updatepolicy-rollingupdate-waitonresourcesignals"><span class="term"><code class="code">WaitOnResourceSignals</code></span></dt>
          <dd>
            <p>指定自动扩缩组在更新期间是否等待来自新实例的信号。可以使用该属性确保在自动扩缩组继续更新之前实例已完成应用程序安装和配置。在自动扩缩组中启动新的 EC2 实例后，AWS CloudFormation 将暂停更新该组。在继续更新之前，AWS CloudFormation 必须在指定的 <code class="code">PauseTime</code> 内，从每个新实例中收到信号。要将信号发送到自动扩缩组，请使用 <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/cfn-signal.html">cfn-signal</a> 帮助程序脚本或 <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/APIReference/API_SignalResource.html"><code class="code">SignalResource</code></a> API。</p>
            <p>要让实例在发送成功信号之前，等待 Elastic Load Balancing 运行状况检查，请使用 <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/cfn-init.html">cfn-init</a> 帮助程序脚本添加运行状况检查验证。有关示例，请参阅 <a href="https://github.com/awslabs/aws-cloudformation-templates/blob/master/aws/services/AutoScaling/AutoScalingRollingUpdates.yaml" rel="noopener noreferrer" target="_blank"><span>Auto Scaling 滚动更新</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a>示例模板中的 <code class="code">verify_instance_health</code> 命令。</p>
            <p><em>默认值</em>：<code class="code">true</code></p>
            <p><em>类型</em>：布尔值</p>
            <p><em>必填</em>：条件性。如果您指定 <code class="code">MinSuccessfulInstancesPercent</code> 属性，则还必须启用 <code class="code">WaitOnResourceSignals</code> 和 <code class="code">PauseTime</code> 属性。</p>
          </dd>
        </dl></div>
     
   
    <h2 id="cfn-attributes-updatepolicy-scheduledactions">AutoScalingScheduledAction 策略</h2>

    <p>要指定在 <code class="code">AWS::AutoScaling::AutoScalingGroup</code> 资源具有关联的计划操作时 AWS CloudFormation 如何处理 <code class="code">MinSize</code>、<code class="code">MaxSize</code> 和 <code class="code">DesiredCapacity</code> 属性的更新，请使用 <code class="code">AutoScalingScheduledAction</code> 策略。</p>
    <p>利用计划操作，自动扩缩组的组大小属性可随时更改。当您利用自动扩缩组和计划操作更新堆栈时， CloudFormation 始终将您的自动扩缩组的组大小属性值设置为模板的 <code class="code">AWS::AutoScaling::AutoScalingGroup</code> 资源中定义的值，即使计划操作已生效。</p>
    <p>如果您不希望 CloudFormation 在您具有生效的计划操作时，更改任何组大小属性值，请使用 <code class="code">AutoScalingScheduledAction</code> 更新策略并将 <code class="code">IgnoreUnmodifiedGroupSizeProperties</code> 设置为 <code class="code">true</code> 来阻止 CloudFormation 更改 <code class="code">MinSize</code>、<code class="code">MaxSize</code> 或 <code class="code">DesiredCapacity</code> 属性，除非您已在模板中修改这些值。</p>
     
      <h3 id="cfn-attributes-updatepolicy-scheduledactions-syntax">语法</h3>

      <div id="JSON" name="JSON" class="section langfilter">
        <h4 id="aws-attribute-updatepolicy-scheduledactions-syntax.json">JSON</h4>

        <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="复制"><awsui-icon name="copy"></awsui-icon></div></div><code class="json ">"UpdatePolicy" : <span>{</span>
  "<a href="#cfn-attributes-updatepolicy-scheduledactions">AutoScalingScheduledAction</a>" : <span>{</span>
    "<a href="#cfn-attributes-updatepolicy-scheduledactions-ignoreunmodifiedgroupsizeproperties">IgnoreUnmodifiedGroupSizeProperties</a>" : <code class="replaceable">Boolean</code>
  }
}</code></pre>
      </div>
      <div id="YAML" name="YAML" class="section langfilter">
        <h4 id="aws-attribute-updatepolicy-scheduledactions-syntax.yaml">YAML</h4>

        <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="复制"><awsui-icon name="copy"></awsui-icon></div></div><code class="yaml ">UpdatePolicy:
  <a href="#cfn-attributes-updatepolicy-scheduledactions">AutoScalingScheduledAction</a>:
    <a href="#cfn-attributes-updatepolicy-scheduledactions-ignoreunmodifiedgroupsizeproperties">IgnoreUnmodifiedGroupSizeProperties</a>: <code class="replaceable">Boolean</code></code></pre>
      </div>
     
     
      <h3 id="cfn-attributes-updatepolicy-scheduledactions-properties">属性</h3>

      <div class="variablelist">
         
      <dl>
          <dt id="cfn-attributes-updatepolicy-scheduledactions-ignoreunmodifiedgroupsizeproperties"><span class="term"><code class="code">IgnoreUnmodifiedGroupSizeProperties</code></span></dt>
          <dd>
            <p>如果为 <code class="code">true</code>，则 AWS CloudFormation 在堆栈更新期间，忽略当前自动扩缩组和模板的 <code class="code">AWS::AutoScaling::AutoScalingGroup</code> 资源中描述的自动扩缩组之间的组大小属性差异。如果在模板中修改任何组大小属性值，AWS CloudFormation 将使用修改的值并更新自动扩缩组。</p>
            <p><em>默认值</em>：<code class="code">false</code></p>
            <p><em>类型</em>：布尔值</p>
            <p><em>必需</em>：否</p>
          </dd>
        </dl></div>
     
   
    <h2 id="cfn-attributes-updatepolicy-useonlineresharding">UseOnlineResharding 策略</h2>
    <p>要通过添加或删除分片，而不是通过替换整个 <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-resource-elasticache-replicationgroup.html">AWS::ElastiCache::ReplicationGroup</a> 资源，来修改复制组的分片，请使用 <code class="code">UseOnlineResharding</code> 更新策略。</p>
    <p>如果 <code class="code">UseOnlineResharding</code> 设置为 <code class="code">true</code>，您可以更新 <code class="code">AWS::ElastiCache::ReplicationGroup</code> 资源的 <code class="code">NumNodeGroups</code> 和 <code class="code">NodeGroupConfiguration</code> 属性，CloudFormation 将在没有中断的情况下，更新这些属性。如果未指定 <code class="code">UseOnlineResharding</code> 或将其设置为 <code class="code">false</code>，更新 <code class="code">NumNodeGroups</code> 和 <code class="code">NodeGroupConfiguration</code> 属性，将导致 CloudFormation 替换整个 <code class="code">AWS::ElastiCache::ReplicationGroup</code> 资源。</p>
    <p><code class="code">UseOnlineResharding</code> 更新策略没有任何属性。</p>
    <p>在将 <code class="code">UseOnlineResharding</code> 更新策略设置为 <code class="code">true</code> 时考虑的事项：</p>
    <div class="itemizedlist">
       
       
       
    <ul class="itemizedlist"><li class="listitem">
        <p>我们强烈建议您将 <code class="code">NumNodeGroups</code> 和 <code class="code">NodeGroupConfiguration</code> 属性更新作为给定堆栈更新操作中的唯一更新执行。</p>
        <p>更新复制组的节点组配置是一个资源密集型操作。如果堆栈更新失败，CloudFormation 不会将更改回滚到复制组的节点组配置。不过，CloudFormation 会将回滚更新操作失败期间更改的任何其它属性。</p>
      </li><li class="listitem">
        <p>任何节点组更新需要指定所有节点组。</p>
        <p>如果指定 <code class="code">NodeGroupConfiguration</code> 属性，您还必须指定每个节点组配置的 NodeGroupId，以便 CloudFormation 在没有中断的情况下更新节点数。</p>
        <p>在创建复制组时，如果您没有指定每个节点组的 ID，则 ElastiCache 自动为每个节点组生成一个 ID。要在没有中断的情况下更新复制组，请使用 ElastiCache 控制台（<a href="https://console.aws.amazon.com/elasticache/" rel="noopener noreferrer" target="_blank"><span>https://console.aws.amazon.com/elasticache/</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a>）或 <a href="https://docs.aws.amazon.com/AmazonElastiCache/latest/APIReference/API_DescribeReplicationGroups.html">DescribeReplicationGroups</a> 检索复制组中的所有节点组的 ID。接下来，在堆栈模板中指定每个节点组的 ID，然后再尝试添加或删除分片。</p>
        <div class="awsdocs-note"><div class="awsdocs-note-title"><awsui-icon name="status-info" variant="link"></awsui-icon><h6>注意</h6></div><div class="awsdocs-note-text"><p>作为最佳实践，在堆栈模板中创建复制组时，请包括指定的每个节点组的 ID。</p></div></div>
        <p>此外，在没有中断的情况下，更新节点数还要求为每个 <code class="code">NodeGroupConfiguration</code> 准确地指定 <code class="code">PrimaryAvailabilityZone</code>、<code class="code">ReplicaAvailabilityZones</code> 和 <code class="code">ReplicaCount</code> 属性。同样，您使用 ElastiCache 控制台（<a href="https://console.aws.amazon.com/elasticache/" rel="noopener noreferrer" target="_blank"><span>https://console.aws.amazon.com/elasticache/</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a>）或 <a href="https://docs.aws.amazon.com/AmazonElastiCache/latest/APIReference/API_DescribeReplicationGroups.html">DescribeReplicationGroups</a> 检索每个节点组的实际值，并将其与堆栈模板中的值进行比较。您可以将节点组的属性值更新作为单独的堆栈更新，或作为更改节点组数的相同堆栈更新的一部分。</p>
        <p>如果使用 <code class="code">UseOnlineResharding</code> 更新策略在没有中断的情况下，更新节点组数，ElastiCache 将在指定数量的槽之间平均分配密钥空间。以后，无法对其进行更新。因此，在以这种方式更新节点组数后，应删除从堆栈模板中为每个 <code class="code">NodeGroupConfiguration</code> 的 <code class="code">Slots</code> 属性指定的值，因为它不再反映每个节点组中的实际值。</p>
      </li><li class="listitem">
        <p>实际节点组删除结果可能会有所不同。</p>
        <p>在指定的 <code class="code">NumNodeGroups</code> 值小于当前节点组数时，CloudFormation 指示 ElastiCache 删除所需数量的节点组以达到指定的节点数。不过，ElastiCache 可能并非始终能够删除所需数量的节点组。如果 ElastiCache 无法删除所需数量的节点组，CloudFormation 将生成一个堆栈事件，以提醒您该问题。如果 ElastiCache 无法删除<em>任何</em>节点组，CloudFormation 资源更新将失败。</p>
      </li></ul></div>
    <p>有关修改复制组的更多信息，请参阅《Amazon ElastiCache API 参考》中的 <a href="https://docs.aws.amazon.com/AmazonElastiCache/latest/APIReference/API_ModifyReplicationGroupShardConfiguration.html">ModifyReplicationGroupShardConfiguration</a>。</p>

     
      <h3 id="cfn-attributes-updatepolicy-useonlineresharding-syntax">语法</h3>
      <div id="JSON" name="JSON" class="section langfilter">
        <h4 id="cfn-attributes-updatepolicy-useonlineresharding-syntax.json">JSON</h4>
        <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="复制"><awsui-icon name="copy"></awsui-icon></div></div><code class="json ">"UpdatePolicy" : <span>{</span>
  "<a href="#cfn-attributes-updatepolicy-useonlineresharding">UseOnlineResharding</a>" : <code class="replaceable">Boolean</code>
}</code></pre>
      </div>
      <div id="YAML" name="YAML" class="section langfilter">
        <h4 id="cfn-attributes-updatepolicy-useonlineresharding-syntax.yaml">YAML</h4>
        <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="复制"><awsui-icon name="copy"></awsui-icon></div></div><code class="yaml ">UpdatePolicy:
  <a href="#cfn-attributes-updatepolicy-useonlineresharding">UseOnlineResharding</a>: <code class="replaceable">Boolean</code></code></pre>
      </div>
     
   
    <h2 id="cfn-attributes-updatepolicy-upgradeopensearchdomain">EnableVersionUpgrade 策略</h2>

    <p>将 OpenSearch Service 域升级到新版本的 OpenSearch 或 Elasticsearch 而不是替换整个 <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-resource-opensearchservice-domain.html">AWS::OpenSearchService::Domain</a> 或 <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-resource-elasticsearch-domain.html">AWS::Elasticsearch::Domain</a> 资源，请使用 <code class="code">EnableVersionUpgrade</code> 更新策略。</p>
    <p>如果 <code class="code">EnableVersionUpgrade</code> 设置为 <code class="code">true</code>，您可以更新 <code class="code">AWS::OpenSearchService::Domain</code> 资源的 <code class="code">EngineVersion</code> 属性（或旧式 <code class="code">AWS::Elasticsearch::Domain</code> 资源的 <code class="code">ElasticsearchVersion</code> 属性），CloudFormation 将更新该属性，而不会发生中断。如果 <code class="code">EnableVersionUpgrade</code> 被设置为 <code class="code">false</code>，或未指定，则更新 <code class="code">EngineVersion</code> 或 <code class="code">ElasticsearchVersion</code> 属性将导致 CloudFormation 替换整个 <code class="code">AWS::OpenSearchService::Domain</code>/<code class="code">AWS::Elasticsearch::Domain</code> 资源。</p>
    <p><code class="code">EnableVersionUpgrade</code> 更新策略没有任何属性。</p>
    <p>有关升级 OpenSearch Service 域的更多信息，请参阅《Amazon OpenSearch Service 开发人员指南》中的 <a href="https://docs.aws.amazon.com/opensearch-service/latest/developerguide/configuration-api.html#configuration-api-actions-upgrade-domain">UpgradeDomain</a>。</p>

     
      <h3 id="cfn-attributes-updatepolicy-upgradeopensearchdomain-syntax">语法</h3>

      <div id="JSON" name="JSON" class="section langfilter">
        <h4 id="cfn-attributes-updatepolicy-upgradeopensearchdomain-syntax.json">JSON</h4>
        <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="复制"><awsui-icon name="copy"></awsui-icon></div></div><code class="json ">"UpdatePolicy" : <span>{</span>
  "<a href="#cfn-attributes-updatepolicy-upgradeopensearchdomain">EnableVersionUpgrade</a>" : <code class="replaceable">Boolean</code>
}</code></pre>
      </div>

      <div id="YAML" name="YAML" class="section langfilter">
        <h4 id="cfn-attributes-updatepolicy-upgradeopensearchdomain-syntax.yaml">YAML</h4>
        <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="复制"><awsui-icon name="copy"></awsui-icon></div></div><code class="yaml ">UpdatePolicy:
  <a href="#cfn-attributes-updatepolicy-upgradeopensearchdomain">EnableVersionUpgrade</a>: <code class="replaceable">Boolean</code></code></pre>
      </div>

     

   
    <h2 id="cfn-attributes-updatepolicy-codedeploylambdaaliasupdate">CodeDeployLambdaAlias 更新策略</h2>

    <p>要在 <code class="code">AWS::Lambda::Alias</code> 资源上的版本发生变化时，执行 CodeDeploy 部署，请使用 <code class="code">CodeDeployLambdaAliasUpdate</code> 更新策略。</p>
     
      <h3 id="cfn-attributes-updatepolicy-codedeploylambdaaliasupdate-syntax">语法</h3>

      <div id="JSON" name="JSON" class="section langfilter">
        <h4 id="aws-attribute-updatepolicy-codedeploylambdaaliasupdate-syntax.json">JSON</h4>

        <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="复制"><awsui-icon name="copy"></awsui-icon></div></div><code class="json ">"UpdatePolicy" : <span>{</span>
  "<a href="#cfn-attributes-updatepolicy-codedeploylambdaaliasupdate">CodeDeployLambdaAliasUpdate</a>" : <span>{</span>
    "<a href="#cfn-attributes-updatepolicy-codedeploylambdaaliasupdate-afterallowtraffichook">AfterAllowTrafficHook</a>" : <code class="replaceable">String</code>,
    "<a href="#cfn-attributes-updatepolicy-codedeploylambdaaliasupdate-applicationname">ApplicationName</a>" : <code class="replaceable">String</code>,
    "<a href="#cfn-attributes-updatepolicy-codedeploylambdaaliasupdate-beforeallowtraffichook">BeforeAllowTrafficHook</a>" : <code class="replaceable">String</code>,
    "<a href="#cfn-attributes-updatepolicy-codedeploylambdaaliasupdate-deploymentgroupname">DeploymentGroupName</a>" : <code class="replaceable">String</code>
  }
}</code></pre>
      </div>
      <div id="YAML" name="YAML" class="section langfilter">
        <h4 id="aws-attribute-updatepolicy-codedeploylambdaaliasupdate-syntax.yaml">YAML</h4>

        <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="复制"><awsui-icon name="copy"></awsui-icon></div></div><code class="yaml ">UpdatePolicy:
  <a href="#cfn-attributes-updatepolicy-codedeploylambdaaliasupdate">CodeDeployLambdaAliasUpdate</a>:
    <a href="#cfn-attributes-updatepolicy-codedeploylambdaaliasupdate-afterallowtraffichook">AfterAllowTrafficHook</a>: <code class="replaceable">String</code>
    <a href="#cfn-attributes-updatepolicy-codedeploylambdaaliasupdate-applicationname">ApplicationName</a>: <code class="replaceable">String</code>
    <a href="#cfn-attributes-updatepolicy-codedeploylambdaaliasupdate-beforeallowtraffichook">BeforeAllowTrafficHook</a>: <code class="replaceable">String</code>
    <a href="#cfn-attributes-updatepolicy-codedeploylambdaaliasupdate-deploymentgroupname">DeploymentGroupName</a>: <code class="replaceable">String</code></code></pre>
      </div>
     
     
      <h3 id="aws-attribute-updatepolicy-codedeploylambdaaliasupdate-properties">属性</h3>

      <div class="variablelist">
         
         
         
         
      <dl>
          <dt id="cfn-attributes-updatepolicy-codedeploylambdaaliasupdate-afterallowtraffichook"><span class="term"><code class="code">AfterAllowTrafficHook</code></span></dt>
          <dd>
            <p>要在流量路由完成后运行的 Lambda 函数的名称。</p>
            <p><em>必需</em>：否</p>
            <p><em>类型</em>：字符串</p>
          </dd>
         
          <dt id="cfn-attributes-updatepolicy-codedeploylambdaaliasupdate-applicationname"><span class="term"><code class="code">ApplicationName</code></span></dt>
          <dd>
            <p>CodeDeploy 应用程序的名称。</p>
            <p><em>必需</em>：是</p>
            <p><em>类型</em>：字符串</p>
          </dd>
         
          <dt id="cfn-attributes-updatepolicy-codedeploylambdaaliasupdate-beforeallowtraffichook"><span class="term"><code class="code">BeforeAllowTrafficHook</code></span></dt>
          <dd>
            <p>要在流量路由开始前运行的 Lambda 函数的名称。</p>
            <p><em>必需</em>：否</p>
            <p><em>类型</em>：字符串</p>
          </dd>
         
          <dt id="cfn-attributes-updatepolicy-codedeploylambdaaliasupdate-deploymentgroupname"><span class="term"><code class="code">DeploymentGroupName</code></span></dt>
          <dd>
            <p>CodeDeploy 部署组的名称。这是设置流量转移策略的位置。</p>
            <p><em>必需</em>：是</p>
            <p><em>类型</em>：字符串</p>
          </dd>
        </dl></div>
      <p>有关为 <code class="code">AWS::Lambda::Alias</code> 资源指定 <code class="code">UpdatePolicy</code> 属性的示例，请参阅 <a href="#aws-resource-lambda-alias-example">Lambda 别名更新策略</a>。</p>
     
   
    <h2 id="aws-attribute-updatepolicy-examples">示例</h2>
    <p>以下示例说明如何将更新策略添加到自动扩缩组，以及如何在更新元数据时维护可用性。</p>
     
      <h3 id="w9aac34c23c23c23b5">将 <code class="code">UpdatePolicy</code> 添加到自动扩缩组中</h3>

      <p>以下示例说明如何添加更新策略。更新期间，自动扩缩组将更新两批实例并至少保留一个实例可用。由于设置了 <code class="code">WaitOnResourceSignals</code> 标记，自动扩缩组将等待添加到组中的新实例发送信号。新实例必须在其更新下一批实例之前，向自动扩缩组发送信号。</p>
      <div id="JSON" name="JSON" class="section langfilter">
        <h4 id="attribute-updatepolicy-example-1.json">JSON</h4>

        <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="复制"><awsui-icon name="copy"></awsui-icon></div></div><code class="json ">"ASG" : <span>{</span>
   "Type" : "AWS::AutoScaling::AutoScalingGroup",
   "Properties" : <span>{</span>
      "AvailabilityZones" : [
         "us-east-1a",
         "us-east-1b"
      ],
      "DesiredCapacity" : "1",
      "LaunchConfigurationName" : <span>{</span>
         "Ref" : "LaunchConfig"
      },
      "MaxSize" : "4",
      "MinSize" : "1"
   },
   "UpdatePolicy" : <span>{</span>
      "AutoScalingScheduledAction" : <span>{</span>
         "IgnoreUnmodifiedGroupSizeProperties" : "true"
      },
      "AutoScalingRollingUpdate" : <span>{</span>
         "MinInstancesInService" : "1",
         "MaxBatchSize" : "2",
         "WaitOnResourceSignals" : "true",
         "PauseTime" : "PT10M"
      }
   }
 },
"ScheduledAction" : <span>{</span>
   "Type" : "AWS::AutoScaling::ScheduledAction",
   "Properties" : <span>{</span>
      "AutoScalingGroupName" : <span>{</span>
         "Ref" : "ASG"
      },
      "DesiredCapacity" : "2",
      "StartTime" : "2017-06-02T20 : 00 : 00Z"
   }
}</code></pre>
      </div>
      <div id="YAML" name="YAML" class="section langfilter">
        <h4 id="attribute-updatepolicy-example-1.yaml">YAML</h4>

        <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="复制"><awsui-icon name="copy"></awsui-icon></div></div><code class="yaml ">ASG:
  Type: 'AWS::AutoScaling::AutoScalingGroup'
  Properties:
    AvailabilityZones:
    - us-east-1a
    - us-east-1b
    DesiredCapacity: '1'
    LaunchConfigurationName:
      Ref: LaunchConfig
    MaxSize: '4'
    MinSize: '1'
  UpdatePolicy:
    AutoScalingScheduledAction:
      IgnoreUnmodifiedGroupSizeProperties: 'true'
    AutoScalingRollingUpdate:
      MinInstancesInService: '1'
      MaxBatchSize: '2'
      WaitOnResourceSignals: 'true'
      PauseTime: PT10M
ScheduledAction:
  Type: 'AWS::AutoScaling::ScheduledAction'
  Properties:
    AutoScalingGroupName:
      Ref: ASG
    DesiredCapacity: '2'
    StartTime: '2017-06-02T20 : 00 : 00Z'</code></pre>
      </div>
     
     
      <h3 id="w9aac34c23c23c23b7">AutoScalingReplacingUpdate 策略</h3>

      <p>以下示例声明在更新期间强制替换关联的自动扩缩组的策略。要使更新成功，必须有一定百分比的实例 (由 <code class="code">MinSuccessfulPercentParameter</code> 参数指定) 在 <code class="code">Timeout</code> 时间内，发出成功信号。</p>
      <div id="JSON" name="JSON" class="section langfilter">
        <h4 id="attribute-updatepolicy-example-2.json">JSON</h4>

        <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="复制"><awsui-icon name="copy"></awsui-icon></div></div><code class="json ">"UpdatePolicy" : <span>{</span>
  "AutoScalingReplacingUpdate" : <span>{</span>
    "WillReplace" : "true"
  }
},
"CreationPolicy" : <span>{</span>
  "ResourceSignal" : <span>{</span>
    "Count" : <span>{</span> "Ref" : "ResourceSignalsOnCreate"},
    "Timeout" : "PT10M"
  },
  "AutoScalingCreationPolicy" : <span>{</span>
    "MinSuccessfulInstancesPercent" : <span>{</span> "Ref" : "MinSuccessfulPercentParameter" }
  }
}</code></pre>
      </div>
      <div id="YAML" name="YAML" class="section langfilter">
        <h4 id="attribute-updatepolicy-example-2.yaml">YAML</h4>

        <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="复制"><awsui-icon name="copy"></awsui-icon></div></div><code class="yaml ">UpdatePolicy:
  AutoScalingReplacingUpdate:
    WillReplace: 'true'
CreationPolicy:
  ResourceSignal:
    Count: !Ref 'ResourceSignalsOnCreate'
    Timeout: PT10M
  AutoScalingCreationPolicy:
    MinSuccessfulInstancesPercent: !Ref 'MinSuccessfulPercentParameter'</code></pre>
      </div>
     
     
      <h3 id="w9aac34c23c23c23b9">在更新 cfn-init 帮助程序脚本的元数据时维护可用性</h3>

      <p>在实例上安装软件应用程序时，您使用 <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-resource-init.html"><code class="code">AWS::CloudFormation::Init</code></a> 元数据键和 <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/cfn-init.html"><code>cfn-init</code></a> 帮助程序脚本来引导自动扩缩组中的实例。CloudFormation 安装软件包、运行命令并执行元数据中描述的其他引导操作。</p>
      <p>在仅更新元数据（例如：在将软件包更新为另一个版本时）时，您使用 <code><a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/cfn-hup.html">cfn-hup</a></code> 帮助程序守护进程检测和应用更新。不过，<code>cfn-hup</code> 守护进程会在每个实例上单独运行。如果守护进程同时在所有实例上运行，则您的应用程序或服务可能在更新期间不可用。要确保可用性，您可以强制滚动更新，以便 CloudFormation 一次更新一批实例。</p>
      <div class="awsdocs-note awsdocs-important"><div class="awsdocs-note-title"><awsui-icon name="status-warning" variant="error"></awsui-icon><h6>重要</h6></div><div class="awsdocs-note-text"><p>强制滚动更新要求 CloudFormation 创建新实例，然后删除旧实例。旧实例中存储的任何信息都将丢失。</p></div></div>
      <p>要强制滚动更新，请更改启动配置资源的逻辑 ID，然后更新堆栈和任何指向原始逻辑 ID 的引用（例如，关联的自动扩缩组）。CloudFormation 会触发自动扩缩组的滚动更新，以替换所有实例。</p>
     
     
      <h3 id="w9aac34c23c23c23c11">原始模板</h3>

      <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="复制"><awsui-icon name="copy"></awsui-icon></div></div><code class="json ">"LaunchConfig": <span>{</span>
  "Type" : "AWS::AutoScaling::LaunchConfiguration",
  "Metadata" : <span>{</span>
    "Comment" : "Install a simple PHP application",
    "AWS::CloudFormation::Init" : <span>{</span>
    ...
    }
  }
}</code></pre>
     
     
      <h3 id="w9aac34c23c23c23c13">更新后的逻辑 ID</h3>

      <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="复制"><awsui-icon name="copy"></awsui-icon></div></div><code class="json ">"<b>LaunchConfigUpdateRubygemsPkg</b>": <span>{</span>
  "Type" : "AWS::AutoScaling::LaunchConfiguration",
  "Metadata" : <span>{</span>
    "Comment" : "Install a simple PHP application",
    "AWS::CloudFormation::Init" : <span>{</span>
    ...
    }
  }
}</code></pre>
     
     
      <h3 id="aws-resource-lambda-alias-example">Lambda 别名更新策略</h3>
      <p>以下示例为 <code class="code">UpdatePolicy</code> 资源指定 <code class="code">AWS::Lambda::Alias</code> 属性。部署的所有详细信息，均由传入策略的应用程序和部署组定义。</p>
      <div id="JSON" name="JSON" class="section langfilter">
        <h4 id="aws-attribute-updatepolicy-codedeploylambda.json">JSON</h4>

        <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="复制"><awsui-icon name="copy"></awsui-icon></div></div><code class="json ">"Alias": <span>{</span>
  "Type": "AWS::Lambda::Alias",
  "Properties": <span>{</span>
    "FunctionName": <span>{</span>
      "Ref": "LambdaFunction"
    },
    "FunctionVersion": <span>{</span>
      "Fn::GetAtt": [
        "FunctionVersionTwo",
        "Version"
      ]
    },
    "Name": "MyAlias"
  },
  "UpdatePolicy": <span>{</span>
    "CodeDeployLambdaAliasUpdate": <span>{</span>
      "ApplicationName": <span>{</span>
        "Ref": "CodeDeployApplication"
      },
      "DeploymentGroupName": <span>{</span>
        "Ref": "CodeDeployDeploymentGroup"
      },
      "BeforeAllowTrafficHook": <span>{</span>
        "Ref": "PreHookLambdaFunction"
      },
      "AfterAllowTrafficHook": <span>{</span>
        "Ref": "PreHookLambdaFunction"
      }
    }
  }
}</code></pre>
      </div>
      <div id="YAML" name="YAML" class="section langfilter">
        <h4 id="aws-attribute-updatepolicy-codedeploylambda-example.yaml">YAML</h4>

        <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="复制"><awsui-icon name="copy"></awsui-icon></div></div><code class="yaml ">Alias:
  Type: 'AWS::Lambda::Alias'
  Properties:
    FunctionName: !Ref LambdaFunction
    FunctionVersion: !GetAtt FunctionVersionTwo.Version
    Name: MyAlias
  UpdatePolicy:
    CodeDeployLambdaAliasUpdate:
      ApplicationName: !Ref CodeDeployApplication
      DeploymentGroupName: !Ref CodeDeployDeploymentGroup
      BeforeAllowTrafficHook: !Ref PreHookLambdaFunction
      AfterAllowTrafficHook: !Ref PreHookLambdaFunction</code></pre>
      </div>
     
  <awsdocs-copyright class="copyright-print"></awsdocs-copyright><awsdocs-thumb-feedback right-edge="{{$ctrl.thumbFeedbackRightEdge}}"></awsdocs-thumb-feedback></div><noscript><div><div><div><div id="js_error_message"><p><img src="https://d1ge0kk1l5kms0.cloudfront.net/images/G/01/webservices/console/warning.png" alt="警告" /> <strong>Javascript 在您的浏览器中被禁用或不可用。</strong></p><p>要使用 Amazon Web Services 文档，必须启用 Javascript。请参阅浏览器的帮助页面以了解相关说明。</p></div></div></div></div></noscript><div id="main-col-footer" class="awsui-util-font-size-0"><div id="doc-conventions"><a target="_top" href="/general/latest/gr/docconventions.html">文档惯例</a></div><div class="prev-next"><div id="previous" class="prev-link" accesskey="p" href="./aws-attribute-metadata.html">Metadata</div><div id="next" class="next-link" accesskey="n" href="./aws-attribute-updatereplacepolicy.html">UpdateReplacePolicy</div></div></div><awsdocs-page-utilities></awsdocs-page-utilities></div><div id="quick-feedback-yes" style="display: none;"><div class="title">此页面对您有帮助吗？- 是</div><div class="content"><p>感谢您对我们工作的肯定！</p><p>如果不耽误您的时间，请告诉我们做得好的地方，让我们做得更好。</p><p><awsui-button id="fblink" rel="noopener noreferrer" target="_blank" text="反馈" click="linkClick($event)" href="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=CloudFormation&amp;topic_url=https://docs.aws.amazon.com/zh_cn/AWSCloudFormation/latest/UserGuide/aws-attribute-updatepolicy.html"></awsui-button></p></div></div><div id="quick-feedback-no" style="display: none;"><div class="title">此页面对您有帮助吗？- 否</div><div class="content"><p>感谢您告诉我们本页内容还需要完善。很抱歉让您失望了。</p><p>如果不耽误您的时间，请告诉我们如何改进文档。</p><p><awsui-button id="fblink" rel="noopener noreferrer" target="_blank" text="反馈" click="linkClick($event)" href="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=CloudFormation&amp;topic_url=https://docs.aws.amazon.com/zh_cn/AWSCloudFormation/latest/UserGuide/aws-attribute-updatepolicy.html"></awsui-button></p></div></div></div></body></div></awsdocs-view><div class="page-loading-indicator" id="page-loading-indicator"><awsui-spinner size="large"></awsui-spinner></div></div><div id="tools-panel" dom-region="tools"><awsdocs-tools-panel id="awsdocs-tools-panel"></awsdocs-tools-panel></div></awsui-app-layout><awsdocs-cookie-banner class="doc-cookie-banner"></awsdocs-cookie-banner></div></body></html>