<!DOCTYPE html>
    <html xmlns="http://www.w3.org/1999/xhtml" lang="zh-CN"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>数据格式参数 - Amazon Redshift</title><meta name="viewport" content="width=device-width,initial-scale=1" /><meta name="assets_root" content="/assets" /><meta name="target_state" content="copy-parameters-data-format" /><meta name="default_state" content="copy-parameters-data-format" /><link rel="icon" type="image/ico" href="/assets/images/favicon.ico" /><link rel="shortcut icon" type="image/ico" href="/assets/images/favicon.ico" /><link rel="canonical" href="https://docs.aws.amazon.com/zh_cn/redshift/latest/dg/copy-parameters-data-format.html" /><meta name="description" content="默认情况下，COPY 命令要求源数据是字符分隔的 UTF-8 文本。默认分隔符是竖线字符 (|)。如果源数据采用的是其他格式，请使用以下参数指定数据格式：" /><meta name="deployment_region" content="IAD" /><meta name="product" content="Amazon Redshift" /><meta name="guide" content="数据库开发人员指南" /><meta name="abstract" content="使用 Amazon Redshift – 一种完全托管的企业 PB 级数据仓库服务 – 创建和管理数据仓库。" /><meta name="guide-locale" content="zh_cn" /><meta name="tocs" content="toc-contents.json" /><link rel="canonical" href="https://docs.aws.amazon.com/zh_cn/redshift/latest/dg/copy-parameters-data-format.html" /><link rel="alternative" href="https://docs.aws.amazon.com/id_id/redshift/latest/dg/copy-parameters-data-format.html" hreflang="id-id" /><link rel="alternative" href="https://docs.aws.amazon.com/id_id/redshift/latest/dg/copy-parameters-data-format.html" hreflang="id" /><link rel="alternative" href="https://docs.aws.amazon.com/de_de/redshift/latest/dg/copy-parameters-data-format.html" hreflang="de-de" /><link rel="alternative" href="https://docs.aws.amazon.com/de_de/redshift/latest/dg/copy-parameters-data-format.html" hreflang="de" /><link rel="alternative" href="https://docs.aws.amazon.com/redshift/latest/dg/copy-parameters-data-format.html" hreflang="en-us" /><link rel="alternative" href="https://docs.aws.amazon.com/redshift/latest/dg/copy-parameters-data-format.html" hreflang="en" /><link rel="alternative" href="https://docs.aws.amazon.com/es_es/redshift/latest/dg/copy-parameters-data-format.html" hreflang="es-es" /><link rel="alternative" href="https://docs.aws.amazon.com/es_es/redshift/latest/dg/copy-parameters-data-format.html" hreflang="es" /><link rel="alternative" href="https://docs.aws.amazon.com/fr_fr/redshift/latest/dg/copy-parameters-data-format.html" hreflang="fr-fr" /><link rel="alternative" href="https://docs.aws.amazon.com/fr_fr/redshift/latest/dg/copy-parameters-data-format.html" hreflang="fr" /><link rel="alternative" href="https://docs.aws.amazon.com/it_it/redshift/latest/dg/copy-parameters-data-format.html" hreflang="it-it" /><link rel="alternative" href="https://docs.aws.amazon.com/it_it/redshift/latest/dg/copy-parameters-data-format.html" hreflang="it" /><link rel="alternative" href="https://docs.aws.amazon.com/ja_jp/redshift/latest/dg/copy-parameters-data-format.html" hreflang="ja-jp" /><link rel="alternative" href="https://docs.aws.amazon.com/ja_jp/redshift/latest/dg/copy-parameters-data-format.html" hreflang="ja" /><link rel="alternative" href="https://docs.aws.amazon.com/ko_kr/redshift/latest/dg/copy-parameters-data-format.html" hreflang="ko-kr" /><link rel="alternative" href="https://docs.aws.amazon.com/ko_kr/redshift/latest/dg/copy-parameters-data-format.html" hreflang="ko" /><link rel="alternative" href="https://docs.aws.amazon.com/pt_br/redshift/latest/dg/copy-parameters-data-format.html" hreflang="pt-br" /><link rel="alternative" href="https://docs.aws.amazon.com/pt_br/redshift/latest/dg/copy-parameters-data-format.html" hreflang="pt" /><link rel="alternative" href="https://docs.aws.amazon.com/zh_cn/redshift/latest/dg/copy-parameters-data-format.html" hreflang="zh-cn" /><link rel="alternative" href="https://docs.aws.amazon.com/zh_tw/redshift/latest/dg/copy-parameters-data-format.html" hreflang="zh-tw" /><link rel="alternative" href="https://docs.aws.amazon.com/redshift/latest/dg/copy-parameters-data-format.html" hreflang="x-default" /><meta name="feedback-item" content="Redshift" /><meta name="this_doc_product" content="Amazon Redshift" /><meta name="this_doc_guide" content="数据库开发人员指南" /><script defer="" src="/assets/r/vendor4.js?version=2021.12.02"></script><script defer="" src="/assets/r/vendor3.js?version=2021.12.02"></script><script defer="" src="/assets/r/vendor1.js?version=2021.12.02"></script><script defer="" src="/assets/r/awsdocs-common.js?version=2021.12.02"></script><script defer="" src="/assets/r/awsdocs-doc-page.js?version=2021.12.02"></script><link href="/assets/r/vendor4.css?version=2021.12.02" rel="stylesheet" /><link href="/assets/r/awsdocs-common.css?version=2021.12.02" rel="stylesheet" /><link href="/assets/r/awsdocs-doc-page.css?version=2021.12.02" rel="stylesheet" /><script async="" id="awsc-panorama-bundle" type="text/javascript" src="https://prod.pa.cdn.uis.awsstatic.com/panorama-nav-init.js" data-config="{'appEntity':'aws-documentation','region':'us-east-1','service':'redshift'}"></script><meta id="panorama-serviceSubSection" value="数据库开发人员指南" /><meta id="panorama-serviceConsolePage" value="数据格式参数" /></head><body class="awsdocs awsui"><div class="awsdocs-container"><awsdocs-header></awsdocs-header><awsui-app-layout id="app-layout" class="awsui-util-no-gutters" ng-controller="ContentController as $ctrl" header-selector="awsdocs-header" navigation-hide="false" navigation-width="$ctrl.navWidth" navigation-open="$ctrl.navOpen" navigation-change="$ctrl.onNavChange($event)" tools-hide="$ctrl.hideTools" tools-width="$ctrl.toolsWidth" tools-open="$ctrl.toolsOpen" tools-change="$ctrl.onToolsChange($event)"><div id="guide-toc" dom-region="navigation"><awsdocs-toc></awsdocs-toc></div><div id="main-column" dom-region="content" tabindex="-1"><awsdocs-view class="awsdocs-view"><div id="awsdocs-content"><head><title>数据格式参数 - Amazon Redshift</title><meta name="pdf" content="redshift-dg.pdf#copy-parameters-data-format" /><meta name="rss" content="Dochistory.rss" /><meta name="forums" content="http://forums.aws.amazon.com/forum.jspa?forumID=155" /><meta name="feedback" content="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=Redshift&amp;topic_url=https://docs.aws.amazon.com/zh_cn/redshift/latest/dg/copy-parameters-data-format.html" /><meta name="feedback-yes" content="feedbackyes.html?topic_url=https://docs.aws.amazon.com/zh_cn/redshift/latest/dg/copy-parameters-data-format.html" /><meta name="feedback-no" content="feedbackno.html?topic_url=https://docs.aws.amazon.com/zh_cn/redshift/latest/dg/copy-parameters-data-format.html" /><meta name="keywords" content="Amazon Redshift,AWS Redshift,Redshift,Redshift Spectrum,集群,数据仓库,开发人员,示例数据,数据库,数据库开发人员,HLL" /><script type="application/ld+json">
{
    "@context" : "https://schema.org",
    "@type" : "BreadcrumbList",
    "itemListElement" : [
      {
        "@type" : "ListItem",
        "position" : 1,
        "name" : "AWS",
        "item" : "https://aws.amazon.com"
      },
      {
        "@type" : "ListItem",
        "position" : 2,
        "name" : "Amazon Redshift",
        "item" : "https://docs.aws.amazon.com/redshift/index.html"
      },
      {
        "@type" : "ListItem",
        "position" : 3,
        "name" : "数据库开发人员指南",
        "item" : "https://docs.aws.amazon.com/zh_cn/redshift/latest/dg"
      },
      {
        "@type" : "ListItem",
        "position" : 4,
        "name" : "SQL 参考",
        "item" : "https://docs.aws.amazon.com/zh_cn/redshift/latest/dg/cm_chap_SQLCommandRef.html"
      },
      {
        "@type" : "ListItem",
        "position" : 5,
        "name" : "SQL 命令",
        "item" : "https://docs.aws.amazon.com/zh_cn/redshift/latest/dg/c_SQL_commands.html"
      },
      {
        "@type" : "ListItem",
        "position" : 6,
        "name" : "COPY",
        "item" : "https://docs.aws.amazon.com/zh_cn/redshift/latest/dg/r_COPY.html"
      },
      {
        "@type" : "ListItem",
        "position" : 7,
        "name" : "COPY 参数参考",
        "item" : "https://docs.aws.amazon.com/zh_cn/redshift/latest/dg/r_COPY-parameters.html"
      },
      {
        "@type" : "ListItem",
        "position" : 8,
        "name" : "数据格式参数",
        "item" : "https://docs.aws.amazon.com/zh_cn/redshift/latest/dg/r_COPY-parameters.html"
      }
    ]
}
</script></head><body><div id="main"><div style="display: none"><a href="redshift-dg.pdf#copy-parameters-data-format" target="_blank" rel="noopener noreferrer" title="打开 PDF"></a></div><div id="breadcrumbs" class="breadcrumb"><a href="https://aws.amazon.com">AWS</a><a href="/index.html">文档</a><a href="/redshift/index.html">Amazon Redshift</a><a href="welcome.html">数据库开发人员指南</a></div><div id="page-toc-src"><a href="#copy-json-data-file">JSON 数据文件</a><a href="#copy-json-jsonpaths">JSONPaths 文件</a><a href="#copy-json-jsonpath-expressions">JSONPath 表达式</a><a href="#using-jsonpath-with-avro">将 JSONPaths 与 Avro 数据一起使用</a><a href="#copy-parameters-columnar-data">列式数据格式参数</a></div><div id="main-content" class="awsui-util-container"><div id="main-col-body"><awsdocs-language-banner data-service="$ctrl.pageService"></awsdocs-language-banner><h1 class="topictitle" id="copy-parameters-data-format">数据格式参数</h1><div class="awsdocs-page-header-container"><awsdocs-page-header></awsdocs-page-header><awsdocs-filter-selector id="awsdocs-filter-selector"></awsdocs-filter-selector></div><p>默认情况下，COPY 命令要求源数据是字符分隔的 UTF-8 文本。默认分隔符是竖线字符 (|)。如果源数据采用的是其他格式，请使用以下参数指定数据格式：</p><div class="itemizedlist">
             
             
             

             
             
             
             
             
             
            
         <ul class="itemizedlist"><li class="listitem">
               <p><a href="#copy-format">FORMAT</a></p>
            </li><li class="listitem">
               <p><a href="#copy-csv">CSV</a></p>
            </li><li class="listitem">
               <p><a href="#copy-delimiter">DELIMITER</a>
               </p>
            </li><li class="listitem">
               <p><a href="#copy-fixedwidth">FIXEDWIDTH</a>
               </p>
            </li><li class="listitem">
               <p><a href="#copy-shapefile">SHAPEFILE</a>
               </p>
            </li><li class="listitem">
               <p><a href="#copy-avro">AVRO</a>
               </p>
            </li><li class="listitem">
               <p><a href="#copy-json">JSON</a>
               </p>
            </li><li class="listitem">
               <p><a href="#copy-parquet">PARQUET</a>
               </p>
            </li><li class="listitem">
               <p><a href="#copy-orc">ORC</a>
               </p>
            </li></ul></div><p>除标准数据格式以外，COPY 支持 Amazon S3 中有关 COPY 的以下列式数据格式：</p><div class="itemizedlist">
             
             
            
            
         <ul class="itemizedlist"><li class="listitem">
               <p><a href="#copy-orc">ORC</a>
               </p>
            </li><li class="listitem">
               <p><a href="#copy-parquet">PARQUET</a>
               </p>
            </li></ul></div><p>支持列式中的 COPY，其中带有特定限制。有关更多信息，请参阅<a href="./copy-usage_notes-copy-from-columnar.html">从列式数据格式中执行 COPY 操作</a>。</p><div class="variablelist">
            <h6>数据格式参数</h6>
             
              
             
             
            
             
            
             
            
             
         <dl>
               <dt id="copy-format"><span class="term">FORMAT [AS]</span></dt>
               <dd>
                  <p>（可选）标识数据格式关键字。FORMAT 参数如下所述。</p>
               </dd>
             
               <dt id="copy-csv"><span class="term">CSV [ QUOTE [AS] <em>'quote_character'</em> ]</span></dt>
               <dd>
                  <p>支持在输入数据中使用 CSV 格式。要自动对分隔符、换行符和回车符进行转义，可用 QUOTE 参数指定的字符将字段括起来。默认引号字符是双引号 ( " )。当在字段中使用了引号字符时，应使用另一个引号字符对其进行转义。例如，如果引号字符为双引号，那么要插入字符串 <code class="code">A
                        "quoted" word</code>，输入文件应包含字符串 <code class="code">"A
                        ""quoted"" word"</code>。当使用了 CSV 参数时，默认分隔符为逗号 (,)。您可使用 DELIMITER 参数指定一个不同的分隔符。</p>
                  <p>当某个字段用引号括起来时，分隔符和引号字符之间的空格将被忽略。如果分隔符为空格字符（如制表符），则分隔符不会被视为空格。</p>
                  <p>CSV 不能与 FIXEDWIDTH、REMOVEQUOTES 或 ESCAPE 一起使用。</p>
                  <div class="variablelist">
                      
                  <dl>
                        <dt id="copy-csv-quote"><span class="term">QUOTE [AS] <em>'quote_character'</em></span></dt>
                        <dd>
                           <p>可选。指定在使用 CSV 参数时要用作引号字符的字符。默认值为双引号 (")。如果您使用 QUOTE 参数定义双引号以外的引号字符，则不需要对字段中的双引号进行转义。QUOTE 参数只能与 CSV 参数一起使用。AS 关键字是可选的。</p>
                        </dd>
                     </dl></div>
               </dd>
             
               <dt id="copy-delimiter"><span class="term">DELIMITER [AS] ['<em>delimiter_char</em>'] </span></dt>
               <dd>
                  <p>指定用于在输入文件中分隔字段的单个 ASCII 字符，如竖线字符 (|)、逗号 (,) 或制表符 (\t)。支持非打印 ASCII 字符。ASCII 字符还可以用八进制形式表示，使用格式“\ddd”，其中“d”是八进制数字 (0–7)。默认分隔符是竖线字符 (|)，除非使用了 CSV 参数，在这种情况下，默认分隔符是逗号 (,)。AS 关键字是可选的。DELIMITER 不能与 FIXEDWIDTH 一起使用。</p>
               </dd>
             
               <dt id="copy-fixedwidth"><span class="term">FIXEDWIDTH '<em>fixedwidth_spec</em>'</span></dt>
               <dd>
                  <p>从一个文件中加载数据，该文件中的每个列是宽度固定的列，而不是由分隔符分隔的列。<em>fixedwidth_spec</em> 是用于指定用户定义的列标签和列宽度的字符串。列标签可以是文本字符串或整数，具体取决于用户的选择。列标签与列名称没有关联。标签/宽度对的顺序必须与表列的顺序完全一致。FIXEDWIDTH 不能与 CSV 或 DELIMITER 一起使用。在 Amazon Redshift 中，CHAR 和 VARCHAR 列的长度以字节表示，因此在准备要加载的文件时，请确保您指定的列宽度可容纳多字节字符的二进制长度。有关更多信息，请参阅<a href="./r_Character_types.html">字符类型</a>。</p>
                  <p><em>fixedwidth_spec</em> 的格式如下所示：</p>
                  <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="复制"><awsui-icon name="copy"></awsui-icon></div></div><code class="nohighlight">'<em>colLabel1:colWidth1,colLabel:colWidth2, ...</em>'</code></pre>
               </dd>
             
               <dt id="copy-shapefile"><span class="term">SHAPEFILE [ SIMPLIFY [AUTO] [<em>'tolerance'</em>] ]</span></dt>
               <dd>
                  <p>支持在输入数据中使用 SHAPEFILE 格式。预设情况下，shapefile 的第一列是 <code class="code">GEOMETRY</code> 或 <code class="code">IDENTITY</code> 列。所有后续列都遵循 shapefile 中指定的顺序。</p>
                  <p>您不能将 SHAPEFILE 与 FIXEDWIDTH、REMOVEQUOTES 或 ESCAPE 一起使用。</p>
                  <p>要将 <code class="code">GEOGRAPHY</code> 对象与 <code class="code">COPY FROM SHAPEFILE</code> 一起使用，请首先提取到 <code class="code">GEOMETRY</code> 列，然后将对象强制转换为 <code class="code">GEOGRAPHY</code> 对象。</p>
                  <div class="variablelist">
                      
                      
                  <dl>
                        <dt id="copy-shapefile-simplify"><span class="term">SIMPLIFY [<em>tolerance</em>]</span></dt>
                        <dd>
                           <p>（可选）使用 Ramer-Douglas-Peucker 算法和给定的容差简化摄入过程中的所有几何体。</p>
                        </dd>
                      
                        <dt id="copy-shapefile-simplify"><span class="term">SIMPLIFY AUTO [<em>tolerance</em>]</span></dt>
                        <dd>
                           <p>（可选）仅简化大于最大几何大小的几何体。这种简化使用 Ramer-Douglas-Peucker 算法和自动计算的容差（如果不超过指定容差）。此算法计算在指定容差范围内存储对象的大小。<em>公差</em>值是可选的。</p>
                        </dd>
                     </dl></div>
                  <p>有关加载 shapefile 的示例，请参阅<a href="./r_COPY_command_examples.html#copy-example-spatial-copy-shapefile">将 shapefile 加载到 Amazon Redshift</a>。</p>
               </dd>
             
               <dt id="copy-avro"><span class="term">AVRO [AS] '<em>avro_option</em>'</span></dt>
               <dd>
                  <p>指定源数据采用 Avro 格式。</p>
                  <p>从以下服务和协议执行 COPY 的操作支持 Avro 格式：</p>
                  <div class="itemizedlist">
                      
                      
                      
                  <ul class="itemizedlist"><li class="listitem">
                        <p>Amazon S3 </p>
                     </li><li class="listitem">
                        <p>Amazon EMR </p>
                     </li><li class="listitem">
                        <p>远程主机 (SSH) </p>
                     </li></ul></div>
                  <p>从 DynamoDB 执行 COPY 的操作不支持 Avro。</p>
                  <p>Avro 是一个数据序列化协议。Avro 源文件包含一个定义数据结构的 schema。Avro schema 类型必须为 <code class="code">record</code>。COPY 接受使用默认的非压缩编解码器及 <code class="code">deflate</code> 和 <code class="code">snappy</code> 压缩编解码器创建的 Avro 文件。有关 Avro 的更多信息，请转到 <a href="https://avro.apache.org/" rel="noopener noreferrer" target="_blank"><span>Apache Avro</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a>。</p>
                  
                  <p><em>avro_option</em> 的有效值如下：</p>
                  <div class="itemizedlist">
                      
                      
                      
                  <ul class="itemizedlist"><li class="listitem">
                        <p><code class="code">'auto'</code></p>
                     </li><li class="listitem">
                        <p><code class="code">'auto ignorecase'</code></p>
                     </li><li class="listitem">
                        <p><code class="code">'s3://<code class="replaceable">jsonpaths_file</code>'</code> </p>
                     </li></ul></div>
                  <p>默认为 <code class="code">'auto'</code>。</p>
                  <p>COPY 会将 Avro 源数据中的数据元素自动映射到目标表中的列。它的执行方式是通过将 Avro schema 中的字段名称与目标表中的列名称相匹配。<code class="code">'auto'</code> 的匹配区分大小写，<code class="code">'auto
                        ignorecase'</code> 的匹配不区分大小写。</p>
                  <p>Amazon Redshift 表中的列名称始终小写，因此，当您使用 <code class="code">'auto'</code> 选项时，匹配的字段名称也必须为小写。如果字段名称不是全部小写，则可以使用 <code class="code">'auto
                        ignorecase'</code> 选项。使用默认的 <code class="code">'auto'</code> 参数时，COPY 仅识别结构中的第一层字段，或<em>外部字段</em>。</p>
                  <p>要将列名称显式映射到 Avro 字段名称，您可以使用 <a href="#copy-json-jsonpaths">JSONPaths 文件</a>。</p>
                  <p>默认情况下，COPY 会尝试将目标表中的所有列与 Avro 字段名称匹配。要加载列的子集，您可以选择性地指定包含列的列表。如果列列表中省略了目标表中的列，则 COPY 将加载目标列的 <a href="./r_CREATE_TABLE_NEW.html#create-table-default">DEFAULT</a> 表达式。如果目标列没有默认值，则 COPY 将尝试加载 NULL。如果某个列包含在列列表中，并且 COPY 在 Avro 数据中找不到匹配的字段，则 COPY 会尝试将 NULL 加载到该列中。</p>
                  <p>如果 COPY 尝试将 NULL 分配到一个定义为 NOT NULL 的列，COPY 命令将失败。</p>
                  
                  <p><b>Avro Schema</b></p>
                  <p>Avro 源数据文件包含一个定义数据结构的 Schema。COPY 将读取作为 Avro 源数据文件的一部分的 schema 以将数据元素映射到目标表列。以下示例显示了一个 Avro schema。</p>
                  <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="复制"><awsui-icon name="copy"></awsui-icon></div></div><code class=""><span>{</span>
    "name": "person",
    "type": "record",
    "fields": [
        <span>{</span>"name": "id", "type": "int"},
        <span>{</span>"name": "guid", "type": "string"},
        <span>{</span>"name": "name", "type": "string"},
        <span>{</span>"name": "address", "type": "string"}]
}</code></pre>
                  <p>Avro schema 是使用 JSON 格式定义的。顶级 JSON 对象包含三个名称-值对，这三个名称（即<em>键</em>）分别为 <code class="code">"name"</code>、<code class="code">"type"</code> 和 <code class="code">"fields"</code>。</p>
                  <p><code class="code">"fields"</code> 键与定义数据结构中每个字段的名称和数据类型的对象数组配对。默认情况下，COPY 会自动将字段名称与列名称匹配。列名称始终为小写形式，因此匹配的字段名称也必须为小写形式，除非您指定了 <code class="code">‘auto ignorecase’</code> 选项。与列名称不匹配的任何字段名称都将被忽略。顺序无关紧要。在上述示例中，COPY 将映射到列名称 <code class="code">id</code>、<code class="code">guid</code>、<code class="code">name</code> 和 <code class="code">address</code>。</p>
                  <p>由于存在默认的 <code class="code">'auto'</code> 参数，COPY 只会将第一层对象映射到列。若要映射到 schema 中的更深层次，或者如果字段名称与列名称不匹配，请使用 JSONPaths 文件定义映射。有关更多信息，请参阅<a href="#copy-json-jsonpaths">JSONPaths 文件</a>。</p>
                  <p>如果与键关联的值是一个复杂的 Avro 数据类型（如字节、数组、记录、映射或链接），COPY 会将该值作为一个字符串加载。这里的字符串是数据的 JSON 表示形式。COPY 会将 Avro 枚举数据类型作为字符串加载，其中的内容是类型的名称。有关示例，请参阅 <a href="./copy-usage_notes-copy-from-json.html">从 JSON 格式数据执行的 COPY 操作</a>。</p>
                  <p>Avro 文件标头（包括 schema 和文件元数据）的最大大小为 1 MB。  </p>
                  <p>单个 Avro 数据块的最大大小为 4 MB。这与最大行大小不同。如果超过了单个 Avro 数据块的最大大小，则即使生成的行大小未达到 4 MB 的行大小限制，COPY 命令也会失败。</p>
                  <p>在计算行大小时，Amazon Redshift 在内部对竖线字符 ( | ) 计为两个字符。如果您的输入数据中包含大量竖线字符，则即使数据块小于 4 MB，行大小也可能超过 4 MB。</p>
               </dd>
             
               <dt id="copy-json"><span class="term">JSON [AS] '<em>json_option</em>'</span></dt>
               <dd>
                  <p>源数据采用 JSON 格式。</p>
                  <p>从以下服务和协议执行 COPY 的操作支持 JSON 格式：</p>
                  <div class="itemizedlist">
                      
                      
                      
                  <ul class="itemizedlist"><li class="listitem">
                        <p>Amazon S3</p>
                     </li><li class="listitem">
                        <p>从 Amazon EMR 执行 COPY 操作</p>
                     </li><li class="listitem">
                        <p>从 SSH 执行 COPY 的操作</p>
                     </li></ul></div>
                  <p>从 DynamoDB 执行 COPY 的操作不支持 JSON。</p>
                  <p><em>json_option</em> 的有效值如下：</p>
                     <div class="itemizedlist">
                         
                         
                         
                        
                         
                     <ul class="itemizedlist"><li class="listitem">
                           <p><code class="code">'auto'</code></p>
                        </li><li class="listitem">
                           <p><code class="code">'auto ignorecase'</code></p>
                        </li><li class="listitem">
                           <p><code class="code">'s3://<code class="replaceable">jsonpaths_file</code>'</code>
                           </p>
                        </li><li class="listitem">
                           <p><code class="code">'noshred'</code>
                           </p>
                        </li></ul></div>
                  
                  <p>默认为 <code class="code">'auto'</code>。在加载 JSON 文档时，Amazon Redshift 不会将 JSON 结构的属性分解为多个列。</p> 
                  <p>默认情况下，COPY 会尝试将目标表中的所有列与 JSON 字段名称键匹配。要加载列的子集，您可以选择性地指定包含列的列表。如果 JSON 字段名称键包含大写字符，则您可以使用 <code class="code">'auto ignorecase'</code> 选项或 <a href="#copy-json-jsonpaths">JSONPaths 文件</a> 将列名称显式地映射到 JSON 字段名称键。</p>
                  <p>如果列列表省略了目标表中的列，则 COPY 将加载目标列的 <a href="./r_CREATE_TABLE_NEW.html#create-table-default">DEFAULT</a> 表达式。如果目标列没有默认值，则 COPY 将尝试加载 NULL。如果某个列包含在列列表中，并且 COPY 在 JSON 数据中找不到匹配的字段，则 COPY 会尝试将 NULL 加载到该列。</p>
                  <p>如果 COPY 尝试将 NULL 分配到一个定义为 NOT NULL 的列，COPY 命令将失败。</p>
                  <p>COPY 会将 JSON 源数据中的数据元素映射到目标表中的列。它的操作方式是通过将源名称-值对中的<em>对象键</em>（即名称）与目标表中的列名称匹配。</p>
 
                  <p>请参阅以下有关每个 <em>json_option</em> 值的详细信息：</p>
                  <div class="variablelist">
                      
                     
                      
                     
                      
                     
                      
                     
                     
                     
                  <dl>
                        <dt id="copy-json-auto"><span class="term">'auto'</span></dt>
                        <dd>
                           <p>使用此选项时，匹配区分大小写。Amazon Redshift 表中的列名称始终小写，因此，当您使用 <code class="code">'auto'</code> 选项时，匹配的 JSON 字段名称也必须为小写。</p>
                          
                        </dd>
                      
                        <dt id="copy-json-auto-ignorecase"><span class="term">“auto ignorecase”</span></dt>
                        <dd>
                           <p>使用此选项时，匹配不区分大小写。Amazon Redshift 表中的列名称始终小写，因此，当您使用 <code class="code">'auto ignorecase'</code> 选项时，相应的 JSON 字段名称可以是小写、大写或大小写混合。</p>
                           
                        </dd>
                      
                        <dt id="copy-json-pathfile"><span class="term">'s3://<em>jsonpaths_file</em>'</span></dt>
                        <dd>
                           <p>通过此选项，COPY 使用命名的 JSONPaths 文件将 JSON 源数据中的数据元素映射到目标表中的列。<em><code class="code">s3://jsonpaths_file</code></em> 参数必须是显式引用单个文件的 Amazon S3 对象键。示例是 <code class="code">'s3://mybucket/jsonpaths.txt</code>'。参数不能为键前缀。有关使用 JSONPaths 文件的更多信息，请参阅 <a href="#copy-json-jsonpaths">JSONPaths 文件</a>。</p>
                         
                           <p>在某些情况下，由 <code class="code">jsonpaths_file</code> 指定的文件的前缀与由 <code class="code">copy_from_s3_objectpath</code> 为数据文件指定的路径的前缀相同。如果是这样，COPY 会将 JSONPaths 文件作为数据文件读取并返回错误。例如，假设您的数据文件使用对象路径 <code class="code">s3://mybucket/my_data.json</code>，并且您的 JSONPaths 文件是 <code class="code">s3://mybucket/my_data.jsonpaths</code>。在这种情况下，COPY 会尝试加载 <code class="code">my_data.jsonpaths</code> 作为数据文件。</p>
                           
                        </dd>
                      
                        <dt id="copy-json-noshred"><span class="term">“noshred”</span></dt>
                        <dd>
                           <p>使用此选项，Amazon Redshift 不会在加载 JSON 文档时将 JSON 结构的属性分解为多个列。</p>
                           
                        </dd>
                     </dl></div>

               </dd>
            </dl></div>
            <h2 id="copy-json-data-file">JSON 数据文件</h2>
            <p>JSON 数据文件包含一组对象或数组。COPY 会将每个 JSON 对象或数组加载到目标表中的一行中。与某个行对应的每个对象或数组都必须是独立的根级结构；即，它不能是另一个 JSON 结构的成员。</p>

            <p>JSON <em>对象</em> 以大括号 (<span>{</span> }) 开头和结尾，并包含名称-值对的无序集合。每个成对的名称和值由冒号分隔，而每个名称/值对由逗号分隔。预设情况下，名称-值对中的<em>对象键</em>（即名称）必须与表中的对应列的名称匹配。Amazon Redshift 表中的列名称始终小写，因此，匹配的 JSON 字段名称键也必须为小写。如果您的列名称与 JSON 键不匹配，请使用 <a href="#copy-json-jsonpaths">JSONPaths 文件</a> 将列显式映射到键。</p>
            <p>JSON 对象中的顺序不重要。与列名称不匹配的任何名称都将被忽略。下面显示了一个简单 JSON 对象的结构。</p>
            <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="复制"><awsui-icon name="copy"></awsui-icon></div></div><code class=""><span>{</span>
  "column1": "value1",
  "column2": value2,
  "notacolumn" : "ignore this value"
}</code></pre>
            <p>JSON <em>数组</em> 以中括号 ([]) 开头和结尾，并包含由逗号分隔的值的有序集合。如果您的数据文件使用了数组，则必须指定 JSONPaths 文件以将值与列匹配。下面显示了一个简单 JSON 数组的结构。</p>
            <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="复制"><awsui-icon name="copy"></awsui-icon></div></div><code class="">["value1", value2]</code></pre>
            <p>JSON 必须格式正确。例如，对象或数组不能用逗号或除空格以外的任何其他字符分隔。字符串必须括在双引号字符中。引号字符必须是简单引号 (0x22)，而不能是倾斜引号或“智能”引号。</p>
            <p>单个 JSON 对象或数组（包括大括号或中括号）的最大大小为 4 MB。这与最大行大小不同。如果超过了单个 JSON 对象或数组的最大大小，则即使生成的行大小未达到 4 MB 的行大小限制，COPY 命令也会失败。</p>
            <p>在计算行大小时，Amazon Redshift 在内部对竖线字符 ( | ) 计为两个字符。如果您的输入数据中包含大量竖线字符，则即使对象大小小于 4 MB，行大小也可能超过 4 MB。</p>
            <p>COPY 会将 <code class="code">\n</code> 作为换行符加载并且会将 <code class="code">\t</code> 作为制表符加载。要加载反斜杠，请使用反斜杠 ( <code class="code">\\</code> ) 对其进行转义。</p>
            <p>COPY 将在指定的 JSON 源中搜索格式正确且有效的 JSON 对象或数组。如果 COPY 在找到可用的 JSON 结构之前遇到任何非空格字符，或在有效的 JSON 对象或数组之间遇到此类字符，COPY 将为每个实例返回错误。这些错误将计入 MAXERROR 错误计数。当错误计数等于或超过 MAXERROR 时，COPY 将失败。</p>
            <p>对于每个错误，Amazon Redshift 都会在 STL_LOAD_ERRORS 系统表中记录一行。LINE_NUMBER 列将记录导致错误的 JSON 对象的最后一行。</p>
            <p>如果指定了 IGNOREHEADER，COPY 将忽略 JSON 数据中指定数量的行。JSON 数据中的换行符始终计入到 IGNOREHEADER 计算中。</p>
            <p>默认情况下，COPY 将空字符串作为空字段加载。如果指定了 EMPTYASNULL，COPY 会将 CHAR 和 VARCHAR 字段的空字符串作为 NULL 加载。其他数据类型（如 INT）的空字符串始终作为 NULL 加载。</p>
            <p>不支持将以下选项与 JSON 一起使用：</p>
            <div class="itemizedlist">
                
                
                
                
                
                
                
                
                
            <ul class="itemizedlist"><li class="listitem">
                  <p>CSV</p>
               </li><li class="listitem">
                  <p>DELIMITER </p>
               </li><li class="listitem">
                  <p>ESCAPE</p>
               </li><li class="listitem">
                  <p>FILLRECORD </p>
               </li><li class="listitem">
                  <p>FIXEDWIDTH</p>
               </li><li class="listitem">
                  <p>IGNOREBLANKLINES</p>
               </li><li class="listitem">
                  <p>NULL AS</p>
               </li><li class="listitem">
                  <p>READRATIO</p>
               </li><li class="listitem">
                  <p>REMOVEQUOTES </p>
               </li></ul></div>
            <p>有关更多信息，请参阅<a href="./copy-usage_notes-copy-from-json.html">从 JSON 格式数据执行的 COPY 操作</a>。有关 JSON 数据结构的更多信息，请转到 <a href="https://www.json.org/" rel="noopener noreferrer" target="_blank"><span>www.json.org</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a>。</p>
          
            <h2 id="copy-json-jsonpaths">JSONPaths 文件</h2>
            <p>如果您正在从 JSON 格式的源数据或 Avro 源数据加载，则在预设情况下，COPY 会将源数据中的第一层数据元素映射到目标表中的列。它的操作方式是通过将名称-值对中的每个名称（即对象键）与目标表中的列的名称匹配。</p>

            <p>如果您的列名称与对象键不匹配，或要映射到数据层次结构中的更深层次，则可以使用 JSONPaths 文件将 JSON 或 Avro 数据元素显式映射到列。JSONPaths 文件通过匹配目标表或列列表中的列顺序来将 JSON 数据元素映射到列。</p>
            <p>JSONPaths 文件只能包含一个 JSON 对象（非数组）。JSON 对象是一个名称-值对。<em>对象键</em>（即名称-值对的名称）必须为 <code class="code">"jsonpaths"</code>。名称-值对中的<em>值</em> 是一组 <em>JSONPath 表达式</em>。每个 JSONPath 表达式都引用 JSON 数据层次结构或 Avro schema 中的一个元素，这与 XPath 表达式引用 XML 文档中的元素相似。有关更多信息，请参阅<a href="#copy-json-jsonpath-expressions">JSONPath 表达式</a>。</p>
            <p>要使用 JSONPaths 文件，请将 JSON 或 AVRO 关键字添加到 COPY 命令。使用以下格式指定 JSONPath 文件的 S3 桶名称和对象路径。</p>
            <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="复制"><awsui-icon name="copy"></awsui-icon></div></div><code class="nohighlight">COPY tablename 
FROM 'data_source' 
CREDENTIALS '<code class="replaceable">credentials-args</code>' 
FORMAT AS <span>{</span> AVRO | JSON } 's3://<em>jsonpaths_file</em>';</code></pre>
            <p><code class="code"><code class="code">s3://jsonpaths_file</code></code> 参数必须是显式引用单个文件（如 <code class="code">'s3://mybucket/jsonpaths.txt'</code>）的 Amazon S3 对象键。它不能是键前缀。</p>
            <p>在某些情况下，如果您从 Amazon S3 加载，由 <code class="code">jsonpaths_file</code> 指定的文件的前缀与由 <code class="code">copy_from_s3_objectpath</code> 为数据文件指定的路径的前缀相同。如果是这样，COPY 会将 JSONPaths 文件作为数据文件读取并返回错误。例如，假设您的数据文件使用对象路径 <code class="code">s3://mybucket/my_data.json</code>，并且您的 JSONPaths 文件是 <code class="code">s3://mybucket/my_data.jsonpaths</code>。在这种情况下，COPY 会尝试加载 <code class="code">my_data.jsonpaths</code> 作为数据文件。</p>
            <p> 如果键名称是除 <code class="code">"jsonpaths"</code> 以外的任何字符串，则 COPY 命令不会返回错误，但会忽略 <em>jsonpaths_file</em> 并改为使用 <code class="code">'auto'</code> 参数。</p>
            <p>如果出现以下任一情况，COPY 命令将失败：</p>
            <div class="itemizedlist">
                
                
                
                
            <ul class="itemizedlist"><li class="listitem">
                  <p>JSON 格式不正确。</p>
               </li><li class="listitem">
                  <p>存在多个 JSON 对象。</p>
               </li><li class="listitem">
                  <p>对象外部存在除空格以外的任何字符。</p>
               </li><li class="listitem">
                  <p>数组元素是一个空字符串或者不是一个字符串。</p>
               </li></ul></div>
            <p>MAXERROR 不适用于 JSONPaths 文件。</p>
            <p>即使指定了 <a href="./copy-parameters-data-source-s3.html#copy-encrypted">ENCRYPTED</a> 选项，也不得加密 JSONPaths 文件。</p>
            <p>有关更多信息，请参阅<a href="./copy-usage_notes-copy-from-json.html">从 JSON 格式数据执行的 COPY 操作</a>。</p>
          
            <h2 id="copy-json-jsonpath-expressions">JSONPath 表达式</h2>
            <p>JSONPaths 文件使用 JSONPath 表达式将数据字段映射到目标列。每个 JSONPath 表达式对应于 Amazon Redshift 目标表中的一个列。JSONPath 数组元素的顺序必须与目标表或列列表（如果使用了列列表）中列的顺序一致。</p>

            <p>如上所示，字段名称和值均需要使用双引号字符。引号字符必须是简单引号 (0x22)，而不能是倾斜引号或“智能”引号。</p>
            <p>如果 JSONPath 表达式引用的对象元素在 JSON 数据中找不到，则 COPY 将尝试加载 NULL 值。如果引用的对象的格式不正确，则 COPY 将返回加载错误。</p>
            <p>如果 JSONPath 表达式引用的数组元素在 JSON 或 Avro 数据中找不到，则 COPY 将失败并返回以下错误：<code class="code">Invalid JSONPath format: Not
                  an array or index out of range.</code>请从 JSONPaths 中删除在源数据中不存在的所有数组元素，并确认源数据中数组的格式正确。  </p>
            <p>JSONPath 表达式可使用括号表示法或点表示法，但不能将两者结合使用。以下示例显示了使用括号表示法的 JSONPath 表达式。</p>
            <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="复制"><awsui-icon name="copy"></awsui-icon></div></div><code class=""><span>{</span>
    "jsonpaths": [
        "$['venuename']",
        "$['venuecity']",
        "$['venuestate']",
        "$['venueseats']"
    ]
}</code></pre>
            <p>以下示例显示了使用点表示法的 JSONPath 表达式。</p>
            <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="复制"><awsui-icon name="copy"></awsui-icon></div></div><code class=""><span>{</span>
    "jsonpaths": [
        "$.venuename",
        "$.venuecity",
        "$.venuestate",
        "$.venueseats"
    ]
}</code></pre>
            <p>在 Amazon Redshift COPY 语法的上下文中，JSONPath 表达式必须指定 JSON 或 Avro 分层数据结构中单个名称元素的显式路径。Amazon Redshift 不支持可能解析为不确定路径或多个名称元素的任何 JSONPath 元素（如通配符或筛选表达式）。</p>
            <p>有关更多信息，请参阅<a href="./copy-usage_notes-copy-from-json.html">从 JSON 格式数据执行的 COPY 操作</a>。</p>
            
          
            <h2 id="using-jsonpath-with-avro">将 JSONPaths 与 Avro 数据一起使用</h2>            
            <p>以下示例显示了具有多个层次 Avro schema。</p>
            <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="复制"><awsui-icon name="copy"></awsui-icon></div></div><code class=""><span>{</span>
    "name": "person",
    "type": "record",
    "fields": [
        <span>{</span>"name": "id", "type": "int"},
        <span>{</span>"name": "guid", "type": "string"},
        <span>{</span>"name": "isActive", "type": "boolean"},
        <span>{</span>"name": "age", "type": "int"},
        <span>{</span>"name": "name", "type": "string"},
        <span>{</span>"name": "address", "type": "string"},
        <span>{</span>"name": "latitude", "type": "double"},
        <span>{</span>"name": "longitude", "type": "double"},
        <span>{</span>
            "name": "tags",
            "type": <span>{</span>
                        "type" : "array",
                        "name" : "inner_tags",
                        "items" : "string"
                    }
        },
        <span>{</span>
            "name": "friends",
            "type": <span>{</span>
                        "type" : "array",
                        "name" : "inner_friends",
                        "items" : <span>{</span>
                                    "name" : "friends_record",
                                    "type" : "record",
                                    "fields" : [
                                                 <span>{</span>"name" : "id", "type" : "int"},
                                                 <span>{</span>"name" : "name", "type" : "string"}
                                               ]
                                  }
                    }
        },
        <span>{</span>"name": "randomArrayItem", "type": "string"}
    ]
}</code></pre>
            <p>以下示例显示了使用 AvroPath 表达式引用前面的 schema 的 JSONPaths 文件。</p>
            <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="复制"><awsui-icon name="copy"></awsui-icon></div></div><code class=""><span>{</span>
    "jsonpaths": [
        "$.id",
        "$.guid",
        "$.address",
        "$.friends[0].id"
    ]
}</code></pre>
            <p>JSONPaths 示例包含以下元素：</p>
            <div class="variablelist">
                
                
                
                
                
            <dl>
                  <dt><span class="term">jsonpaths</span></dt>
                  <dd>
                     <p>包含 AvroPath 表达式的 JSON 对象的名称。</p>
                  </dd>
                
                  <dt><span class="term">[ … ]</span></dt>
                  <dd>
                     <p>方括号将包含路径元素的 JSON 数组括起。</p>
                  </dd>
                
                  <dt><span class="term">$</span></dt>
                  <dd>
                     <p>美元符号表示 Avro schema 中的根元素，即 <code class="code">"fields"</code> 数组。</p>
                  </dd>
                
                  <dt><span class="term">"$.id",</span></dt>
                  <dd>
                     <p>AvroPath 表达式的目标。在此实例中，目标是 <code class="code">"fields"</code> 数组中名为 <code class="code">"id"</code> 的元素。表达式用逗号分隔。</p>
                  </dd>
                
                  <dt><span class="term">"$.friends[0].id"</span></dt>
                  <dd>
                     <p>方括号表示数组索引。JSONPath 表达式使用从零开始的索引，因此该表达式引用 <code class="code">"friends"</code> 数组中名为 <code class="code">"id"</code> 的第一个元素。</p>
                  </dd>
               </dl></div>
            <p>Avro schema 语法需要使用<em>内部字段</em> 来定义记录和数组数据类型的结构。AvroPath 表达式将会忽略内部字段。例如，字段 <code class="code">"friends"</code> 定义了一个名为 <code class="code">"inner_friends"</code> 的数组，该数组又定义了一个名为 <code class="code">"friends_record"</code> 的记录。要引用字段 <code class="code">"id"</code> 的 AvroPath 表达式可忽略额外字段以直接引用目标字段。以下 AvroPath 表达式引用了两个属于 <code class="code">"friends"</code> 数组的字段。</p>
            <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="复制"><awsui-icon name="copy"></awsui-icon></div></div><code class="">"$.friends[0].id"
"$.friends[0].name"</code></pre>
          
            <h2 id="copy-parameters-columnar-data">列式数据格式参数</h2>
            <p>除标准数据格式以外，COPY 支持 Amazon S3 中有关 COPY 的以下列式数据格式。支持列式中的 COPY，其中带有特定限制。有关更多信息，请参阅<a href="./copy-usage_notes-copy-from-columnar.html">从列式数据格式中执行 COPY 操作</a>。</p>
            <div class="variablelist">
                
                
               
               
            <dl>
                  <dt id="copy-orc"><span class="term">ORC</span></dt>
                  <dd>
                     <p>从使用优化的行列式 (ORC) 文件格式的文件中加载数据。</p>
                  </dd>
                
                  <dt id="copy-parquet"><span class="term">PARQUET</span></dt>
                  <dd>
                     <p>从使用 Parquet 文件格式的文件中加载数据。</p>
                  </dd>
               </dl></div>
         <awsdocs-copyright class="copyright-print"></awsdocs-copyright><awsdocs-thumb-feedback right-edge="{{$ctrl.thumbFeedbackRightEdge}}"></awsdocs-thumb-feedback></div><noscript><div><div><div><div id="js_error_message"><p><img src="https://d1ge0kk1l5kms0.cloudfront.net/images/G/01/webservices/console/warning.png" alt="警告" /> <strong>Javascript 在您的浏览器中被禁用或不可用。</strong></p><p>要使用 Amazon Web Services 文档，必须启用 Javascript。请参阅浏览器的帮助页面以了解相关说明。</p></div></div></div></div></noscript><div id="main-col-footer" class="awsui-util-font-size-0"><div id="doc-conventions"><a target="_top" href="/general/latest/gr/docconventions.html">文档惯例</a></div><div class="prev-next"><div id="previous" class="prev-link" accesskey="p" href="./copy-parameters-column-mapping.html">列映射选项</div><div id="next" class="next-link" accesskey="n" href="./copy-parameters-file-compression.html">文件压缩参数</div></div></div><awsdocs-page-utilities></awsdocs-page-utilities></div><div id="quick-feedback-yes" style="display: none;"><div class="title">此页面对您有帮助吗？- 是</div><div class="content"><p>感谢您对我们工作的肯定！</p><p>如果不耽误您的时间，请告诉我们做得好的地方，让我们做得更好。</p><p><awsui-button id="fblink" rel="noopener noreferrer" target="_blank" text="反馈" click="linkClick($event)" href="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=Redshift&amp;topic_url=https://docs.aws.amazon.com/zh_cn/redshift/latest/dg/copy-parameters-data-format.html"></awsui-button></p></div></div><div id="quick-feedback-no" style="display: none;"><div class="title">此页面对您有帮助吗？- 否</div><div class="content"><p>感谢您告诉我们本页内容还需要完善。很抱歉让您失望了。</p><p>如果不耽误您的时间，请告诉我们如何改进文档。</p><p><awsui-button id="fblink" rel="noopener noreferrer" target="_blank" text="反馈" click="linkClick($event)" href="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=Redshift&amp;topic_url=https://docs.aws.amazon.com/zh_cn/redshift/latest/dg/copy-parameters-data-format.html"></awsui-button></p></div></div></div></body></div></awsdocs-view><div class="page-loading-indicator" id="page-loading-indicator"><awsui-spinner size="large"></awsui-spinner></div></div><div id="tools-panel" dom-region="tools"><awsdocs-tools-panel id="awsdocs-tools-panel"></awsdocs-tools-panel></div></awsui-app-layout><awsdocs-cookie-banner class="doc-cookie-banner"></awsdocs-cookie-banner></div></body></html>