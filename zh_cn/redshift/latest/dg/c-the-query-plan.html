<!DOCTYPE html>
    <html xmlns="http://www.w3.org/1999/xhtml" lang="zh-CN"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>查询计划 - Amazon Redshift</title><meta name="viewport" content="width=device-width,initial-scale=1" /><meta name="assets_root" content="/assets" /><meta name="target_state" content="c-the-query-plan" /><meta name="default_state" content="c-the-query-plan" /><link rel="icon" type="image/ico" href="/assets/images/favicon.ico" /><link rel="shortcut icon" type="image/ico" href="/assets/images/favicon.ico" /><link rel="canonical" href="https://docs.aws.amazon.com/zh_cn/redshift/latest/dg/c-the-query-plan.html" /><meta name="description" content="描述如何解释查询计划。" /><meta name="deployment_region" content="IAD" /><meta name="product" content="Amazon Redshift" /><meta name="guide" content="数据库开发人员指南" /><meta name="abstract" content="使用 Amazon Redshift – 一种完全托管的企业 PB 级数据仓库服务 – 创建和管理数据仓库。" /><meta name="guide-locale" content="zh_cn" /><meta name="tocs" content="toc-contents.json" /><link rel="canonical" href="https://docs.aws.amazon.com/zh_cn/redshift/latest/dg/c-the-query-plan.html" /><link rel="alternative" href="https://docs.aws.amazon.com/id_id/redshift/latest/dg/c-the-query-plan.html" hreflang="id-id" /><link rel="alternative" href="https://docs.aws.amazon.com/id_id/redshift/latest/dg/c-the-query-plan.html" hreflang="id" /><link rel="alternative" href="https://docs.aws.amazon.com/de_de/redshift/latest/dg/c-the-query-plan.html" hreflang="de-de" /><link rel="alternative" href="https://docs.aws.amazon.com/de_de/redshift/latest/dg/c-the-query-plan.html" hreflang="de" /><link rel="alternative" href="https://docs.aws.amazon.com/redshift/latest/dg/c-the-query-plan.html" hreflang="en-us" /><link rel="alternative" href="https://docs.aws.amazon.com/redshift/latest/dg/c-the-query-plan.html" hreflang="en" /><link rel="alternative" href="https://docs.aws.amazon.com/es_es/redshift/latest/dg/c-the-query-plan.html" hreflang="es-es" /><link rel="alternative" href="https://docs.aws.amazon.com/es_es/redshift/latest/dg/c-the-query-plan.html" hreflang="es" /><link rel="alternative" href="https://docs.aws.amazon.com/fr_fr/redshift/latest/dg/c-the-query-plan.html" hreflang="fr-fr" /><link rel="alternative" href="https://docs.aws.amazon.com/fr_fr/redshift/latest/dg/c-the-query-plan.html" hreflang="fr" /><link rel="alternative" href="https://docs.aws.amazon.com/it_it/redshift/latest/dg/c-the-query-plan.html" hreflang="it-it" /><link rel="alternative" href="https://docs.aws.amazon.com/it_it/redshift/latest/dg/c-the-query-plan.html" hreflang="it" /><link rel="alternative" href="https://docs.aws.amazon.com/ja_jp/redshift/latest/dg/c-the-query-plan.html" hreflang="ja-jp" /><link rel="alternative" href="https://docs.aws.amazon.com/ja_jp/redshift/latest/dg/c-the-query-plan.html" hreflang="ja" /><link rel="alternative" href="https://docs.aws.amazon.com/ko_kr/redshift/latest/dg/c-the-query-plan.html" hreflang="ko-kr" /><link rel="alternative" href="https://docs.aws.amazon.com/ko_kr/redshift/latest/dg/c-the-query-plan.html" hreflang="ko" /><link rel="alternative" href="https://docs.aws.amazon.com/pt_br/redshift/latest/dg/c-the-query-plan.html" hreflang="pt-br" /><link rel="alternative" href="https://docs.aws.amazon.com/pt_br/redshift/latest/dg/c-the-query-plan.html" hreflang="pt" /><link rel="alternative" href="https://docs.aws.amazon.com/zh_cn/redshift/latest/dg/c-the-query-plan.html" hreflang="zh-cn" /><link rel="alternative" href="https://docs.aws.amazon.com/zh_tw/redshift/latest/dg/c-the-query-plan.html" hreflang="zh-tw" /><link rel="alternative" href="https://docs.aws.amazon.com/redshift/latest/dg/c-the-query-plan.html" hreflang="x-default" /><meta name="feedback-item" content="Redshift" /><meta name="this_doc_product" content="Amazon Redshift" /><meta name="this_doc_guide" content="数据库开发人员指南" /><script defer="" src="/assets/r/vendor4.js?version=2021.12.02"></script><script defer="" src="/assets/r/vendor3.js?version=2021.12.02"></script><script defer="" src="/assets/r/vendor1.js?version=2021.12.02"></script><script defer="" src="/assets/r/awsdocs-common.js?version=2021.12.02"></script><script defer="" src="/assets/r/awsdocs-doc-page.js?version=2021.12.02"></script><link href="/assets/r/vendor4.css?version=2021.12.02" rel="stylesheet" /><link href="/assets/r/awsdocs-common.css?version=2021.12.02" rel="stylesheet" /><link href="/assets/r/awsdocs-doc-page.css?version=2021.12.02" rel="stylesheet" /><script async="" id="awsc-panorama-bundle" type="text/javascript" src="https://prod.pa.cdn.uis.awsstatic.com/panorama-nav-init.js" data-config="{'appEntity':'aws-documentation','region':'us-east-1','service':'redshift'}"></script><meta id="panorama-serviceSubSection" value="数据库开发人员指南" /><meta id="panorama-serviceConsolePage" value="查询计划" /></head><body class="awsdocs awsui"><div class="awsdocs-container"><awsdocs-header></awsdocs-header><awsui-app-layout id="app-layout" class="awsui-util-no-gutters" ng-controller="ContentController as $ctrl" header-selector="awsdocs-header" navigation-hide="false" navigation-width="$ctrl.navWidth" navigation-open="$ctrl.navOpen" navigation-change="$ctrl.onNavChange($event)" tools-hide="$ctrl.hideTools" tools-width="$ctrl.toolsWidth" tools-open="$ctrl.toolsOpen" tools-change="$ctrl.onToolsChange($event)"><div id="guide-toc" dom-region="navigation"><awsdocs-toc></awsdocs-toc></div><div id="main-column" dom-region="content" tabindex="-1"><awsdocs-view class="awsdocs-view"><div id="awsdocs-content"><head><title>查询计划 - Amazon Redshift</title><meta name="pdf" content="redshift-dg.pdf#c-the-query-plan" /><meta name="rss" content="Dochistory.rss" /><meta name="forums" content="http://forums.aws.amazon.com/forum.jspa?forumID=155" /><meta name="feedback" content="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=Redshift&amp;topic_url=https://docs.aws.amazon.com/zh_cn/redshift/latest/dg/c-the-query-plan.html" /><meta name="feedback-yes" content="feedbackyes.html?topic_url=https://docs.aws.amazon.com/zh_cn/redshift/latest/dg/c-the-query-plan.html" /><meta name="feedback-no" content="feedbackno.html?topic_url=https://docs.aws.amazon.com/zh_cn/redshift/latest/dg/c-the-query-plan.html" /><meta name="keywords" content="Amazon Redshift,AWS Redshift,Redshift,Redshift Spectrum,集群,数据仓库,开发人员,示例数据,数据库,数据库开发人员,HLL" /><script type="application/ld+json">
{
    "@context" : "https://schema.org",
    "@type" : "BreadcrumbList",
    "itemListElement" : [
      {
        "@type" : "ListItem",
        "position" : 1,
        "name" : "AWS",
        "item" : "https://aws.amazon.com"
      },
      {
        "@type" : "ListItem",
        "position" : 2,
        "name" : "Amazon Redshift",
        "item" : "https://docs.aws.amazon.com/redshift/index.html"
      },
      {
        "@type" : "ListItem",
        "position" : 3,
        "name" : "数据库开发人员指南",
        "item" : "https://docs.aws.amazon.com/zh_cn/redshift/latest/dg"
      },
      {
        "@type" : "ListItem",
        "position" : 4,
        "name" : "优化查询性能",
        "item" : "https://docs.aws.amazon.com/zh_cn/redshift/latest/dg/c-optimizing-query-performance.html"
      },
      {
        "@type" : "ListItem",
        "position" : 5,
        "name" : "查询处理",
        "item" : "https://docs.aws.amazon.com/zh_cn/redshift/latest/dg/c-query-processing.html"
      },
      {
        "@type" : "ListItem",
        "position" : 6,
        "name" : "查询计划",
        "item" : "https://docs.aws.amazon.com/zh_cn/redshift/latest/dg/c-query-processing.html"
      }
    ]
}
</script></head><body><div id="main"><div style="display: none"><a href="redshift-dg.pdf#c-the-query-plan" target="_blank" rel="noopener noreferrer" title="打开 PDF"></a></div><div id="breadcrumbs" class="breadcrumb"><a href="https://aws.amazon.com">AWS</a><a href="/index.html">文档</a><a href="/redshift/index.html">Amazon Redshift</a><a href="welcome.html">数据库开发人员指南</a></div><div id="page-toc-src"><a href="#EXPLAIN-operators">EXPLAIN 运算符</a><a href="#joins-in-EXPLAIN">EXPLAIN 中的联接</a></div><div id="main-content" class="awsui-util-container"><div id="main-col-body"><awsdocs-language-banner data-service="$ctrl.pageService"></awsdocs-language-banner><h1 class="topictitle" id="c-the-query-plan">查询计划</h1><div class="awsdocs-page-header-container"><awsdocs-page-header></awsdocs-page-header><awsdocs-filter-selector id="awsdocs-filter-selector"></awsdocs-filter-selector></div><p>您可以借助查询计划获取有关运行查询所需的各个操作的信息。在处理查询计划前，建议您先了解 Amazon Redshift 如何处理查询和如何创建查询计划。有关更多信息，请参阅<a href="./c-query-planning.html">查询计划和执行工作流程</a>。</p><p>要创建查询计划，请运行 <a href="./r_EXPLAIN.html">EXPLAIN</a> 命令，后跟实际查询文本。查询计划提供以下信息：</p><div class="itemizedlist">
             
             
             
             
             
         <ul class="itemizedlist"><li class="listitem">
               <p>执行引擎将执行的操作，自下而上地阅读结果。</p>
            </li><li class="listitem">
               <p>每个操作执行的步骤的类型。</p>
            </li><li class="listitem">
               <p>每个操作中使用的表和列。</p>
            </li><li class="listitem">
               <p>每个操作中处理的数据量（以字节为单位），以行数和数据宽度计。</p>
            </li><li class="listitem">
               <p>操作的相对成本。<em>成本</em>是比较计划内的步骤的相对执行时间的度量。成本不提供有关实际执行时间或内存消耗的任何精确信息，也没有提供执行计划之间的有意义的比较。它可以指示查询中的哪些操作消耗最多的资源。</p>
            </li></ul></div><p>EXPLAIN 命令不实际运行查询。它只显示当查询在当前操作条件下运行时 Amazon Redshift 将执行的计划。如果您更改表的 schema 或数据后再次运行 <a href="./r_ANALYZE.html">ANALYZE</a> 以更新统计元数据，则查询计划可能会不同。</p><p>EXPLANE 的查询计划输出是查询执行的简化高级视图。它不描述并行查询处理的详细信息。要查看详细信息，请运行查询本身，然后从 SVL_QUERY_SUMMARY 或 SVL_QUERY_REPORT 视图获取查询摘要信息。有关使用这些视图的更多信息，请参阅<a href="./c-analyzing-the-query-summary.html">分析查询摘要</a>。</p><p>以下示例显示 EVENT 表上的简单 GROUP BY 查询的 EXPLAIN 输出：</p><pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="复制"><awsui-icon name="copy"></awsui-icon></div></div><code class="">explain select eventname, count(*) from event group by eventname;

                            QUERY PLAN
-------------------------------------------------------------------
XN HashAggregate  (cost=131.97..133.41 rows=576 width=17)
  -&gt;  XN Seq Scan on event  (cost=0.00..87.98 rows=8798 width=17)</code></pre><p>EXPLAIN 为每个操作返回以下指标：</p><div class="variablelist">
             
             
             
         <dl>
               <dt><b><span class="term">费用</span></b></dt>
               <dd>
                  <p>对于比较计划内的操作非常有用的相对值。成本由被两个圆点分隔的十进制值组成，例如 <code class="code">cost=131.97..133.41</code>。第一个值（在本例中为 131.97）提供返回此操作的第一行的相对成本。第二个值（在本例中为 133.41）提供完成操作的相对成本。查询计划的成本在读取计划时进行累积，因此本示例中的 HashAggregate 成本 (131.97..133.41) 包括其下面的序列扫描的成本 (0.00..87.98)。</p>
               </dd>
            
               <dt><b><span class="term">行数</span></b></dt>
               <dd>
                  <p>要返回的估计行数。在此示例中，扫描预计将返回 8798 行。HashAggregate 运算符本身应返回 576 行（在从结果集中丢弃重复的事件名称之后）。</p>
                  <div class="awsdocs-note"><div class="awsdocs-note-title"><awsui-icon name="status-info" variant="link"></awsui-icon><h6>注意</h6></div><div class="awsdocs-note-text"><p>行数估算基于 ANALYZE 命令生成的可用统计数据。如果最近未运行过 ANALYZE，则估算的可靠性会降低。</p></div></div>
               </dd>
            
               <dt><b><span class="term">宽度</span></b></dt>
               <dd>
                  <p>平均行的估计宽度（以字节为单位）。在此示例中，平均行的宽度应为 17 个字节。</p>
               </dd>
            </dl></div><h2 id="EXPLAIN-operators">EXPLAIN 运算符</h2>
            
            <p>本节简要介绍了在 EXPLAIN 输出中最常见的运算符。有关运算符的完整列表，请参阅 SQL 命令部分中的<a href="./r_EXPLAIN.html">EXPLAIN</a>。</p>
            <h3 id="scan-operator">顺序扫描运算符</h3>
               
               <p>顺序扫描运算符 (Seq Scan) 指示表扫描。Seq Scan 扫描从开始到结束按顺序扫描表中的每一列，并计算每一行的查询约束（在 WHERE 子句中）。</p>
             
            <h3 id="join-operators">联接运算符</h3>
               
               <p>Amazon Redshift 根据要联接的表的物理设计、联接所需的数据的位置以及查询本身的特定要求来选择联接运算符。</p>
               <div class="itemizedlist">
                   
                   
                   
                   
               <ul class="itemizedlist"><li class="listitem">
                     <p><span class="topcom">嵌套循环</span></p>
                     <p>最优化程度最差的联接，即嵌套循环，主要用于交叉联接（笛卡尔积）和一些不等式联接。</p>
                  </li><li class="listitem">
                     <p><span class="topcom">哈希联接和哈希</span></p>
                     <p>哈希联接和哈希的运行速度通常比签到循环快，可用于内部联接以及左和右外部联接。这些运算符在联接列不是分配键<em>和</em>排序键的情况下用于联接表。哈希运算符为联接中的内部表创建哈希表；哈希联接运算符读取外部表，对联接列进行哈希处理，然后在内部哈希表中查找匹配项。</p>
                  </li><li class="listitem">
                     <p><span class="topcom">合并联接</span></p>
                     <p>合并联接通常是最快的连接，用于内联接和外联接。合并联接不用于完全联接。此运算符在联接列都是分配键<em>和</em>排序键的情况下，以及未排序的联接表少于 20% 时用于联接表。它按顺序读取两个排序表并查找匹配的行。要查看未排序行的百分比，请查询 <a href="./r_SVV_TABLE_INFO.html">SVV_TABLE_INFO</a> 系统表。</p>
                  </li><li class="listitem"> 
                     <p><span class="topcom">空间联接</span></p>
                     <p>通常是基于空间数据邻近度的快速联接，用于 <code class="code">GEOMETRY</code> 和 <code class="code">GEOGRAPHY</code> 数据类型。</p>
                  </li></ul></div>
             
            <h3 id="aggregate-operators">聚合运算符</h3>
               
               <p>查询计划在涉及聚合函数和 GROUP BY 操作的查询中使用以下运算符。</p>
               <div class="itemizedlist">
                   
                   
                   
               <ul class="itemizedlist"><li class="listitem">
                     <p><span class="topcom">聚合</span></p>
                     <p>标量聚合函数（如 AVG 和 SUM）的运算符。</p>
                  </li><li class="listitem">
                     <p><span class="topcom">HashAggregate</span></p>
                     <p>未排序分组聚合函数的运算符。</p>
                  </li><li class="listitem">
                     <p><span class="topcom">GroupAggregate</span></p>
                     <p>已排序分组聚合函数的运算符。</p>
                  </li></ul></div>
             
            <h3 id="sort-operators">排序运算符</h3>
               
               <p>当查询必须对结果集进行排序或合并时，查询计划使用以下运算符。</p>
               <div class="itemizedlist">
                   
                   
               <ul class="itemizedlist"><li class="listitem">
                     <p><span class="topcom">排序</span></p>
                     <p>评估 ORDER BY 子句和其他排序操作，例如 UNION 查询和联接所需的排序、SELECT DISTINCT 查询和窗口函数。</p>
                  </li><li class="listitem">
                     <p><span class="topcom">合并</span> </p>
                     <p>根据从并行操作得到的临时排序结果，来生成最终排序结果。</p>
                  </li></ul></div>
             
            <h3 id="UNION-INTERSECT-and-EXCEPT-operators">UNION、INTERSECT 和 EXCEPT 运算符</h3>
               
               <p>查询计划将以下运算符用于涉及使用 UNION、INTERSECT 和 EXCEPT 进行集合操作的查询。</p>
               <div class="itemizedlist">
                   
                   
                   
               <ul class="itemizedlist"><li class="listitem">
                     <p><span class="topcom">Subquery</span></p>
                     <p>用于运行 UNION 查询。</p>
                  </li><li class="listitem">
                     <p><span class="topcom">Hash Intersect Distinct</span></p>
                     <p>用于运行 INTERSECT 查询。</p>
                  </li><li class="listitem">
                     <p><span class="topcom">SetOp Except</span></p>
                     <p>用于运行 EXCEPT（或 MINUS）查询。</p>
                  </li></ul></div>
             
            <h3 id="other-operators">其他运算符</h3>
               
               <p>以下运算符也经常出现在例行查询的 EXPLAIN 输出中。</p>
               <div class="itemizedlist">
                   
                   
                   
                   
                   
                   
                   
               <ul class="itemizedlist"><li class="listitem">
                     <p><span class="topcom">唯一</span></p>
                     <p>消除 SELECT DISTINCT 查询和 UNION 查询的重复项。</p>
                  </li><li class="listitem">
                     <p><span class="topcom">限制</span></p>
                     <p>处理 LIMIT 子句。</p>
                  </li><li class="listitem">
                     <p><span class="topcom">窗口</span></p>
                     <p>运行窗口函数。</p>
                  </li><li class="listitem">
                     <p><span class="topcom">结果</span></p>
                     <p>运行不涉及任何表访问的标量函数。</p>
                  </li><li class="listitem">
                     <p><span class="topcom">子计划</span></p>
                     <p>用于特定的子查询。</p>
                  </li><li class="listitem">
                     <p><span class="topcom">Network</span></p>
                     <p>将临时结果发送到领导节点，以待进一步处理。</p>
                  </li><li class="listitem">
                     <p><span class="topcom">实体化</span></p>
                     <p>保存嵌套循环联接和某些合并联接的输入中的行。</p>
                  </li></ul></div>
             
         <h2 id="joins-in-EXPLAIN">EXPLAIN 中的联接</h2>
            
            <p>查询优化程序使用不同的联接类型来检索表数据，具体取决于查询和基础表的结构。EXPLAIN 输出引用了联接类型、使用的表以及在集群中分布表数据的方式，以描述查询的处理方式。</p>

            <h3 id="join-types">联接类型示例</h3>
               
               <p>下面的示例显示了查询优化程序可以使用的不同联接类型。查询计划中使用的联接类型取决于所涉表的物理设计。</p>
               <h4 id="hash-join-two-tables">示例：对两个表进行哈希联接</h4>
                  
                  <p>以下查询在 CATID 列上将 EVENT 和 CATEGORY 联接起来。CATID 是 CATEGORY 的分配和排序键，但不适用于 EVENT。使用 EVENT 作为外部表并使用 CATEGORY 作为内部表来执行哈希联接。由于 CATEGORY 是较小的表，因此计划程序在查询处理过程中使用 DS_BCAST_INNER 将其副本广播到计算节点。此示例中的联接成本占计划累计成本的大部分。</p>
                  <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="复制"><awsui-icon name="copy"></awsui-icon></div></div><code class="">explain select * from category, event where category.catid=event.catid;

                               QUERY PLAN
-------------------------------------------------------------------------
 XN Hash Join DS_BCAST_INNER  (cost=0.14..6600286.07 rows=8798 width=84)
   Hash Cond: ("outer".catid = "inner".catid)
   -&gt;  XN Seq Scan on event  (cost=0.00..87.98 rows=8798 width=35)
   -&gt;  XN Hash  (cost=0.11..0.11 rows=11 width=49)
         -&gt;  XN Seq Scan on category  (cost=0.00..0.11 rows=11 width=49)</code></pre>
                  <div class="awsdocs-note"><div class="awsdocs-note-title"><awsui-icon name="status-info" variant="link"></awsui-icon><h6>注意</h6></div><div class="awsdocs-note-text"><p>EXPLAIN 输出中运算符的缩进对齐有时表示这些操作不相互依赖，并且可以并行开始。在前面的示例中，尽管 EVENT 表上的扫描和哈希操作已对齐，但 EVENT 扫描必须等到哈希操作完全完成。</p></div></div>
                
               <h4 id="merge-join-two-tables">示例：对两个表进行合并联接</h4>
                  
                  <p>以下查询还使用 SELECT *，但它在 LISTID 列上联接 SALES 和 LISTING，其中 LISTID 已设置为两个表的分配和排序键。选择合并联接，并且不需要对联接重新分配数据 (DS_DIST_NONE)。</p>
                  <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="复制"><awsui-icon name="copy"></awsui-icon></div></div><code class="">explain select * from sales, listing where sales.listid = listing.listid;
QUERY PLAN
-----------------------------------------------------------------------------
XN Merge Join DS_DIST_NONE  (cost=0.00..6285.93 rows=172456 width=97)
  Merge Cond: ("outer".listid = "inner".listid)
  -&gt;  XN Seq Scan on listing  (cost=0.00..1924.97 rows=192497 width=44)
  -&gt;  XN Seq Scan on sales  (cost=0.00..1724.56 rows=172456 width=53)</code></pre>
                  <p>以下示例演示了同一查询中的不同类型的联接。与前面的示例一样，SALES 和 LISTING 是合并联接的，但第三个表 EVENT 必须与合并联接的结果进行哈希联接。同样，哈希联接会产生广播成本。</p>
                  <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="复制"><awsui-icon name="copy"></awsui-icon></div></div><code class="">explain select * from sales, listing, event
where sales.listid = listing.listid and sales.eventid = event.eventid;
                                  QUERY PLAN
----------------------------------------------------------------------------
XN Hash Join DS_BCAST_INNER  (cost=109.98..3871130276.17 rows=172456 width=132)
  Hash Cond: ("outer".eventid = "inner".eventid)
  -&gt;  XN Merge Join DS_DIST_NONE  (cost=0.00..6285.93 rows=172456 width=97)
        Merge Cond: ("outer".listid = "inner".listid)
        -&gt;  XN Seq Scan on listing  (cost=0.00..1924.97 rows=192497 width=44)
        -&gt;  XN Seq Scan on sales  (cost=0.00..1724.56 rows=172456 width=53)
  -&gt;  XN Hash  (cost=87.98..87.98 rows=8798 width=35)
        -&gt;  XN Seq Scan on event  (cost=0.00..87.98 rows=8798 width=35)</code></pre>
                
               <h4 id="join-aggregate-and-sort-example">示例：联接、聚合和排序</h4>
                  
                  <p>以下查询运行 SALES 和 EVENT 表的哈希联接，然后执行聚合和排序操作，以考虑分组 SUM 函数和 ORDER BY 子句。初始排序运算符在计算节点上并行运行。然后，Network 运算符将结果发送到领导节点，其中合并运算符生成最终的排序结果。</p>
                  <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="复制"><awsui-icon name="copy"></awsui-icon></div></div><code class="">explain select eventname, sum(pricepaid) from sales, event 
where sales.eventid=event.eventid group by eventname
order by 2 desc;
                                           QUERY PLAN
---------------------------------------------------------------------------------
 XN Merge  (cost=1002815366604.92..1002815366606.36 rows=576 width=27)
  Merge Key: sum(sales.pricepaid)
  -&gt;  XN Network  (cost=1002815366604.92..1002815366606.36 rows=576 width=27)
        Send to leader
        -&gt;  XN Sort  (cost=1002815366604.92..1002815366606.36 rows=576 width=27)
              Sort Key: sum(sales.pricepaid)
              -&gt;  XN HashAggregate  (cost=2815366577.07..2815366578.51 rows=576 width=27)
                    -&gt;  XN Hash Join DS_BCAST_INNER  (cost=109.98..2815365714.80 rows=172456 width=27)
                          Hash Cond: ("outer".eventid = "inner".eventid)
                          -&gt;  XN Seq Scan on sales  (cost=0.00..1724.56 rows=172456 width=14)
                          -&gt;  XN Hash  (cost=87.98..87.98 rows=8798 width=21)
                                -&gt;  XN Seq Scan on event  (cost=0.00..87.98 rows=8798 width=21)</code></pre>
                
             
            <h3 id="data-redistribution">数据重新分配</h3>
               
               <p>联接的 EXPLAIN 输出还指定在集群上移动数据以便进行联接的方法。数据移动可以采用广播方法或重新分配。在广播中，联接一侧的数据值将从每个计算节点复制到每个其他计算节点，以便每个计算节点最终得到数据的完整副本。在重新分配中，参与的数据值从其当前切片发送到新切片（可能位于不同节点上）。如果该分配键是联接列之一，则通常会重新分配数据以匹配参与联接的其他表的分配键。如果两个表在其中一个联接列上都没有分配键，则两个表都会被分配，或者内部表将广播到每个节点。</p>
               <p>EXPLAIN 输出还引用内表和外表。首先扫描内部表，并显示在查询计划底部附近。内部表是用来探测匹配项的表。它通常保存在内存中，通常是哈希的源表，如果可能的话，是两者中较小的表。外部表是要与内部表匹配的行的源。它通常是从磁盘读取的。查询优化程序根据最新运行的 ANALYZE 命令中的数据库统计信息选择内表和外表。查询的 FROM 子句中的表顺序并不区分内部表和外部表。</p>
               <p>您可以通过查询计划中的以下属性了解数据的移动方式，以便执行查询：</p>
               <div class="itemizedlist">
                   
                   
                   
                   
                   
                   
                   
               <ul class="itemizedlist"><li class="listitem">
                     <p><span class="topcom">DS_BCAST_INNER</span></p>
                     <p>将整个内部表的副本广播到所有计算节点。</p>
                  </li><li class="listitem">
                     <p><span class="topcom">DS_DIST_ALL_NONE</span></p>
                     <p>无需重新分配，因为内部表已经使用 DISTSTYLE ALL 被分配到每个节点。</p>
                  </li><li class="listitem">
                     <p><span class="topcom">DS_DIST_NONE</span></p>
                     <p>两个表都未重新分配。可以使用并置连接，因为相应的切片联接时不会在节点之间移动数据。</p>
                  </li><li class="listitem">
                     <p><span class="topcom">DS_DIST_INNER</span></p>
                     <p>内部表重新分配。</p>
                  </li><li class="listitem">
                     <p><span class="topcom">DS_DIST_OUTER</span></p>
                     <p>外部表重新分配。</p>
                  </li><li class="listitem">
                     <p><span class="topcom">DS_DIST_ALL_INNER</span></p>
                     <p>整个内部表重新分配到单个切片，因为外部表使用 DISTSTYLE ALL。</p>
                  </li><li class="listitem">
                     <p><span class="topcom">DS_DIST_BOTH</span></p>
                     <p>两个表都重新分配。</p>
                  </li></ul></div>
             
         <awsdocs-copyright class="copyright-print"></awsdocs-copyright><awsdocs-thumb-feedback right-edge="{{$ctrl.thumbFeedbackRightEdge}}"></awsdocs-thumb-feedback></div><noscript><div><div><div><div id="js_error_message"><p><img src="https://d1ge0kk1l5kms0.cloudfront.net/images/G/01/webservices/console/warning.png" alt="警告" /> <strong>Javascript 在您的浏览器中被禁用或不可用。</strong></p><p>要使用 Amazon Web Services 文档，必须启用 Javascript。请参阅浏览器的帮助页面以了解相关说明。</p></div></div></div></div></noscript><div id="main-col-footer" class="awsui-util-font-size-0"><div id="doc-conventions"><a target="_top" href="/general/latest/gr/docconventions.html">文档惯例</a></div><div class="prev-next"><div id="previous" class="prev-link" accesskey="p" href="./c-query-planning.html">查询计划和执行工作流程</div><div id="next" class="next-link" accesskey="n" href="./reviewing-query-plan-steps.html">检查查询计划步骤</div></div></div><awsdocs-page-utilities></awsdocs-page-utilities></div><div id="quick-feedback-yes" style="display: none;"><div class="title">此页面对您有帮助吗？- 是</div><div class="content"><p>感谢您对我们工作的肯定！</p><p>如果不耽误您的时间，请告诉我们做得好的地方，让我们做得更好。</p><p><awsui-button id="fblink" rel="noopener noreferrer" target="_blank" text="反馈" click="linkClick($event)" href="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=Redshift&amp;topic_url=https://docs.aws.amazon.com/zh_cn/redshift/latest/dg/c-the-query-plan.html"></awsui-button></p></div></div><div id="quick-feedback-no" style="display: none;"><div class="title">此页面对您有帮助吗？- 否</div><div class="content"><p>感谢您告诉我们本页内容还需要完善。很抱歉让您失望了。</p><p>如果不耽误您的时间，请告诉我们如何改进文档。</p><p><awsui-button id="fblink" rel="noopener noreferrer" target="_blank" text="反馈" click="linkClick($event)" href="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=Redshift&amp;topic_url=https://docs.aws.amazon.com/zh_cn/redshift/latest/dg/c-the-query-plan.html"></awsui-button></p></div></div></div></body></div></awsdocs-view><div class="page-loading-indicator" id="page-loading-indicator"><awsui-spinner size="large"></awsui-spinner></div></div><div id="tools-panel" dom-region="tools"><awsdocs-tools-panel id="awsdocs-tools-panel"></awsdocs-tools-panel></div></awsui-app-layout><awsdocs-cookie-banner class="doc-cookie-banner"></awsdocs-cookie-banner></div></body></html>