<!DOCTYPE html>
    <html xmlns="http://www.w3.org/1999/xhtml" lang="zh-CN"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>COPY 示例 - Amazon Redshift</title><meta name="viewport" content="width=device-width,initial-scale=1" /><meta name="assets_root" content="/assets" /><meta name="target_state" content="r_COPY_command_examples" /><meta name="default_state" content="r_COPY_command_examples" /><link rel="icon" type="image/ico" href="/assets/images/favicon.ico" /><link rel="shortcut icon" type="image/ico" href="/assets/images/favicon.ico" /><link rel="canonical" href="https://docs.aws.amazon.com/zh_cn/redshift/latest/dg/r_COPY_command_examples.html" /><meta name="description" content="提供有关如何使用 COPY 加载各种源中的数据的示例。" /><meta name="deployment_region" content="IAD" /><meta name="product" content="Amazon Redshift" /><meta name="guide" content="数据库开发人员指南" /><meta name="abstract" content="使用 Amazon Redshift – 一种完全托管的企业 PB 级数据仓库服务 – 创建和管理数据仓库。" /><meta name="guide-locale" content="zh_cn" /><meta name="tocs" content="toc-contents.json" /><link rel="canonical" href="https://docs.aws.amazon.com/zh_cn/redshift/latest/dg/r_COPY_command_examples.html" /><link rel="alternative" href="https://docs.aws.amazon.com/id_id/redshift/latest/dg/r_COPY_command_examples.html" hreflang="id-id" /><link rel="alternative" href="https://docs.aws.amazon.com/id_id/redshift/latest/dg/r_COPY_command_examples.html" hreflang="id" /><link rel="alternative" href="https://docs.aws.amazon.com/de_de/redshift/latest/dg/r_COPY_command_examples.html" hreflang="de-de" /><link rel="alternative" href="https://docs.aws.amazon.com/de_de/redshift/latest/dg/r_COPY_command_examples.html" hreflang="de" /><link rel="alternative" href="https://docs.aws.amazon.com/redshift/latest/dg/r_COPY_command_examples.html" hreflang="en-us" /><link rel="alternative" href="https://docs.aws.amazon.com/redshift/latest/dg/r_COPY_command_examples.html" hreflang="en" /><link rel="alternative" href="https://docs.aws.amazon.com/es_es/redshift/latest/dg/r_COPY_command_examples.html" hreflang="es-es" /><link rel="alternative" href="https://docs.aws.amazon.com/es_es/redshift/latest/dg/r_COPY_command_examples.html" hreflang="es" /><link rel="alternative" href="https://docs.aws.amazon.com/fr_fr/redshift/latest/dg/r_COPY_command_examples.html" hreflang="fr-fr" /><link rel="alternative" href="https://docs.aws.amazon.com/fr_fr/redshift/latest/dg/r_COPY_command_examples.html" hreflang="fr" /><link rel="alternative" href="https://docs.aws.amazon.com/it_it/redshift/latest/dg/r_COPY_command_examples.html" hreflang="it-it" /><link rel="alternative" href="https://docs.aws.amazon.com/it_it/redshift/latest/dg/r_COPY_command_examples.html" hreflang="it" /><link rel="alternative" href="https://docs.aws.amazon.com/ja_jp/redshift/latest/dg/r_COPY_command_examples.html" hreflang="ja-jp" /><link rel="alternative" href="https://docs.aws.amazon.com/ja_jp/redshift/latest/dg/r_COPY_command_examples.html" hreflang="ja" /><link rel="alternative" href="https://docs.aws.amazon.com/ko_kr/redshift/latest/dg/r_COPY_command_examples.html" hreflang="ko-kr" /><link rel="alternative" href="https://docs.aws.amazon.com/ko_kr/redshift/latest/dg/r_COPY_command_examples.html" hreflang="ko" /><link rel="alternative" href="https://docs.aws.amazon.com/pt_br/redshift/latest/dg/r_COPY_command_examples.html" hreflang="pt-br" /><link rel="alternative" href="https://docs.aws.amazon.com/pt_br/redshift/latest/dg/r_COPY_command_examples.html" hreflang="pt" /><link rel="alternative" href="https://docs.aws.amazon.com/zh_cn/redshift/latest/dg/r_COPY_command_examples.html" hreflang="zh-cn" /><link rel="alternative" href="https://docs.aws.amazon.com/zh_tw/redshift/latest/dg/r_COPY_command_examples.html" hreflang="zh-tw" /><link rel="alternative" href="https://docs.aws.amazon.com/redshift/latest/dg/r_COPY_command_examples.html" hreflang="x-default" /><meta name="feedback-item" content="Redshift" /><meta name="this_doc_product" content="Amazon Redshift" /><meta name="this_doc_guide" content="数据库开发人员指南" /><script defer="" src="/assets/r/vendor4.js?version=2021.12.02"></script><script defer="" src="/assets/r/vendor3.js?version=2021.12.02"></script><script defer="" src="/assets/r/vendor1.js?version=2021.12.02"></script><script defer="" src="/assets/r/awsdocs-common.js?version=2021.12.02"></script><script defer="" src="/assets/r/awsdocs-doc-page.js?version=2021.12.02"></script><link href="/assets/r/vendor4.css?version=2021.12.02" rel="stylesheet" /><link href="/assets/r/awsdocs-common.css?version=2021.12.02" rel="stylesheet" /><link href="/assets/r/awsdocs-doc-page.css?version=2021.12.02" rel="stylesheet" /><script async="" id="awsc-panorama-bundle" type="text/javascript" src="https://prod.pa.cdn.uis.awsstatic.com/panorama-nav-init.js" data-config="{'appEntity':'aws-documentation','region':'us-east-1','service':'redshift'}"></script><meta id="panorama-serviceSubSection" value="数据库开发人员指南" /><meta id="panorama-serviceConsolePage" value="COPY 示例" /></head><body class="awsdocs awsui"><div class="awsdocs-container"><awsdocs-header></awsdocs-header><awsui-app-layout id="app-layout" class="awsui-util-no-gutters" ng-controller="ContentController as $ctrl" header-selector="awsdocs-header" navigation-hide="false" navigation-width="$ctrl.navWidth" navigation-open="$ctrl.navOpen" navigation-change="$ctrl.onNavChange($event)" tools-hide="$ctrl.hideTools" tools-width="$ctrl.toolsWidth" tools-open="$ctrl.toolsOpen" tools-change="$ctrl.onToolsChange($event)"><div id="guide-toc" dom-region="navigation"><awsdocs-toc></awsdocs-toc></div><div id="main-column" dom-region="content" tabindex="-1"><awsdocs-view class="awsdocs-view"><div id="awsdocs-content"><head><title>COPY 示例 - Amazon Redshift</title><meta name="pdf" content="redshift-dg.pdf#r_COPY_command_examples" /><meta name="rss" content="Dochistory.rss" /><meta name="forums" content="http://forums.aws.amazon.com/forum.jspa?forumID=155" /><meta name="feedback" content="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=Redshift&amp;topic_url=https://docs.aws.amazon.com/zh_cn/redshift/latest/dg/r_COPY_command_examples.html" /><meta name="feedback-yes" content="feedbackyes.html?topic_url=https://docs.aws.amazon.com/zh_cn/redshift/latest/dg/r_COPY_command_examples.html" /><meta name="feedback-no" content="feedbackno.html?topic_url=https://docs.aws.amazon.com/zh_cn/redshift/latest/dg/r_COPY_command_examples.html" /><meta name="keywords" content="Amazon Redshift,AWS Redshift,Redshift,Redshift Spectrum,集群,数据仓库,开发人员,示例数据,数据库,数据库开发人员,HLL" /><script type="application/ld+json">
{
    "@context" : "https://schema.org",
    "@type" : "BreadcrumbList",
    "itemListElement" : [
      {
        "@type" : "ListItem",
        "position" : 1,
        "name" : "AWS",
        "item" : "https://aws.amazon.com"
      },
      {
        "@type" : "ListItem",
        "position" : 2,
        "name" : "Amazon Redshift",
        "item" : "https://docs.aws.amazon.com/redshift/index.html"
      },
      {
        "@type" : "ListItem",
        "position" : 3,
        "name" : "数据库开发人员指南",
        "item" : "https://docs.aws.amazon.com/zh_cn/redshift/latest/dg"
      },
      {
        "@type" : "ListItem",
        "position" : 4,
        "name" : "SQL 参考",
        "item" : "https://docs.aws.amazon.com/zh_cn/redshift/latest/dg/cm_chap_SQLCommandRef.html"
      },
      {
        "@type" : "ListItem",
        "position" : 5,
        "name" : "SQL 命令",
        "item" : "https://docs.aws.amazon.com/zh_cn/redshift/latest/dg/c_SQL_commands.html"
      },
      {
        "@type" : "ListItem",
        "position" : 6,
        "name" : "COPY",
        "item" : "https://docs.aws.amazon.com/zh_cn/redshift/latest/dg/r_COPY.html"
      },
      {
        "@type" : "ListItem",
        "position" : 7,
        "name" : "COPY 示例",
        "item" : "https://docs.aws.amazon.com/zh_cn/redshift/latest/dg/r_COPY.html"
      }
    ]
}
</script></head><body><div id="main"><div style="display: none"><a href="redshift-dg.pdf#r_COPY_command_examples" target="_blank" rel="noopener noreferrer" title="打开 PDF"></a></div><div id="breadcrumbs" class="breadcrumb"><a href="https://aws.amazon.com">AWS</a><a href="/index.html">文档</a><a href="/redshift/index.html">Amazon Redshift</a><a href="welcome.html">数据库开发人员指南</a></div><div id="page-toc-src"><a href="#r_COPY_command_examples-load-favoritemovies-from-an-amazon-dynamodb-table">从 DynamoDB 表中加载 FAVORITEMOVIES</a><a href="#r_COPY_command_examples-load-listing-from-an-amazon-s3-bucket">从 Amazon S3 桶中加载 LISTING</a><a href="#copy-command-examples-emr">从 Amazon EMR 集群中加载 LISTING</a><a href="#copy-command-examples-manifest">使用清单指定数据文件</a><a href="#r_COPY_command_examples-load-listing-from-a-pipe-delimited-file-default-delimiter">从以竖线（默认分隔符）分隔的文件中加载 LISTING</a><a href="#r_COPY_command_examples-load-listing-from-parquet">使用 Parquet 格式的列式数据加载 LISTING</a><a href="#r_COPY_command_examples-load-listing-from-orc">使用 ORC 格式的列式数据加载 LISTING</a><a href="#r_COPY_command_examples-load-event-with-options">使用选项加载 EVENT</a><a href="#r_COPY_command_examples-load-venue-from-a-fixed-width-data-file">从固定宽度的数据文件中加载 VENUE</a><a href="#load-from-csv">从 CSV 文件中加载 CATEGORY</a><a href="#r_COPY_command_examples-load-venue-with-explicit-values-for-an-identity-column">加载具有显式的 IDENTITY 列值的 VENUE</a><a href="#r_COPY_command_examples-load-time-from-a-pipe-delimited-gzip-file">从以竖线分隔的 GZIP 文件中加载 TIME</a><a href="#r_COPY_command_examples-load-a-time-datestamp">加载时间戳或日期戳</a><a href="#r_COPY_command_examples-load-data-from-a-file-with-default-values">从具有默认值的文件中加载数据</a><a href="#r_COPY_command_examples-copy-data-with-the-escape-option">使用 ESCAPE 选项复制数据</a><a href="#r_COPY_command_examples-copy-from-json">从 JSON 中复制的示例</a><a href="#r_COPY_command_examples-copy-from-avro">从 Avro 中复制的示例</a><a href="#r_COPY_preparing_data">使用 ESCAPE 选项为 COPY 准备文件</a><a href="#copy-example-spatial-copy-shapefile">加载一个 shapefile</a><a href="#r_COPY_command_examples-load-noload-option">带有 NOLOAD 选项的 COPY 命令</a></div><div id="main-content" class="awsui-util-container"><div id="main-col-body"><awsdocs-language-banner data-service="$ctrl.pageService"></awsdocs-language-banner><h1 class="topictitle" id="r_COPY_command_examples">COPY 示例</h1><div class="awsdocs-page-header-container"><awsdocs-page-header></awsdocs-page-header><awsdocs-filter-selector id="awsdocs-filter-selector"></awsdocs-filter-selector></div><div class="awsdocs-note"><div class="awsdocs-note-title"><awsui-icon name="status-info" variant="link"></awsui-icon><h6>注意</h6></div><div class="awsdocs-note-text"><p>为便于阅读，这些示例包含换行符。请不要在您的 <em>credentials-args</em> 字符串中包含换行符或空格。</p></div></div><div class="highlights" id="inline-topiclist"><h6>主题</h6><ul><li><a href="#r_COPY_command_examples-load-favoritemovies-from-an-amazon-dynamodb-table">从 DynamoDB 表中加载 FAVORITEMOVIES</a></li><li><a href="#r_COPY_command_examples-load-listing-from-an-amazon-s3-bucket">从 Amazon S3 桶中加载 LISTING</a></li><li><a href="#copy-command-examples-emr">从 Amazon EMR 集群中加载 LISTING</a></li><li><a href="#copy-command-examples-manifest">使用清单指定数据文件</a></li><li><a href="#r_COPY_command_examples-load-listing-from-a-pipe-delimited-file-default-delimiter">从以竖线（默认分隔符）分隔的文件中加载 LISTING</a></li><li><a href="#r_COPY_command_examples-load-listing-from-parquet">使用 Parquet 格式的列式数据加载 LISTING</a></li><li><a href="#r_COPY_command_examples-load-listing-from-orc">使用 ORC 格式的列式数据加载 LISTING</a></li><li><a href="#r_COPY_command_examples-load-event-with-options">使用选项加载 EVENT</a></li><li><a href="#r_COPY_command_examples-load-venue-from-a-fixed-width-data-file">从固定宽度的数据文件中加载 VENUE</a></li><li><a href="#load-from-csv">从 CSV 文件中加载 CATEGORY</a></li><li><a href="#r_COPY_command_examples-load-venue-with-explicit-values-for-an-identity-column">加载具有显式的 IDENTITY 列值的 VENUE</a></li><li><a href="#r_COPY_command_examples-load-time-from-a-pipe-delimited-gzip-file">从以竖线分隔的 GZIP 文件中加载 TIME</a></li><li><a href="#r_COPY_command_examples-load-a-time-datestamp">加载时间戳或日期戳</a></li><li><a href="#r_COPY_command_examples-load-data-from-a-file-with-default-values">从具有默认值的文件中加载数据</a></li><li><a href="#r_COPY_command_examples-copy-data-with-the-escape-option">使用 ESCAPE 选项复制数据</a></li><li><a href="#r_COPY_command_examples-copy-from-json">从 JSON 中复制的示例</a></li><li><a href="#r_COPY_command_examples-copy-from-avro">从 Avro 中复制的示例</a></li><li><a href="#r_COPY_preparing_data">使用 ESCAPE 选项为 COPY 准备文件</a></li><li><a href="#copy-example-spatial-copy-shapefile">将 shapefile 加载到 Amazon Redshift</a></li><li><a href="#r_COPY_command_examples-load-noload-option">带有 NOLOAD 选项的 COPY 命令</a></li></ul></div>
         <h2 id="r_COPY_command_examples-load-favoritemovies-from-an-amazon-dynamodb-table">从 DynamoDB 表中加载 FAVORITEMOVIES</h2>


         <p>AWS 开发工具包包括一个创建名为 <em>Movies</em> 的 DynamoDB 表的简单示例。（有关此示例，请参阅 <a href="https://docs.aws.amazon.com/amazondynamodb/latest/developerguide/GettingStarted.html">DynamoDB 入门</a>。） 以下示例加载包含 DynamoDB 表中数据的 Amazon Redshift MOVIES 表。Amazon Redshift 表必须已存在于数据库中。</p>
         <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="复制"><awsui-icon name="copy"></awsui-icon></div></div><code class="">copy favoritemovies from 'dynamodb://Movies'
iam_role 'arn:aws:iam::0123456789012:role/MyRedshiftRole' 
readratio 50;</code></pre>
       
         <h2 id="r_COPY_command_examples-load-listing-from-an-amazon-s3-bucket">从 Amazon S3 桶中加载 LISTING</h2>


         <p>以下示例从 Amazon S3 桶加载 LISTING。COPY 命令将加载 <code class="code">/data/listing/</code> 文件夹中的所有文件。</p>
         <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="复制"><awsui-icon name="copy"></awsui-icon></div></div><code class="">copy listing
from 's3://mybucket/data/listing/' 
iam_role 'arn:aws:iam::0123456789012:role/MyRedshiftRole';</code></pre>
       
         <h2 id="copy-command-examples-emr">从 Amazon EMR 集群中加载 LISTING</h2>

         <p>以下示例从 Amazon EMR 集群的 lzop 压缩文件加载使用制表符分隔数据的 SALES 表。COPY 加载 <code class="code">myoutput/</code> 文件夹中每个以 <code class="code">part-</code> 开头的文件。</p>
         <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="复制"><awsui-icon name="copy"></awsui-icon></div></div><code class="">copy sales
from 'emr://j-SAMPLE2B500FC/myoutput/part-*' 
iam_role 'arn:aws:iam::0123456789012:role/MyRedshiftRole'
delimiter '\t' lzop;</code></pre>
         <p>以下示例将加载包含 Amazon EMR 集群中的 JSON 格式的数据的 SALES 表。COPY 加载 <code class="code">myoutput/json/</code> 文件夹中的每个文件。</p>
         <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="复制"><awsui-icon name="copy"></awsui-icon></div></div><code class="">copy sales
from 'emr://j-SAMPLE2B500FC/myoutput/json/' 
iam_role 'arn:aws:iam::0123456789012:role/MyRedshiftRole'
JSON 's3://mybucket/jsonpaths.txt';</code></pre>
       
         <h2 id="copy-command-examples-manifest">使用清单指定数据文件</h2>

         <p>您可以使用清单确保 COPY 命令将从 Amazon S3 加载所有必需的文件，而且仅加载必需的文件。当您需要从不同的桶加载多个文件或加载未共享相同前缀的文件时，您也可使用清单。</p>
         <p>例如，假设您需要加载下列三个文件：<code class="code">custdata1.txt</code>、<code class="code">custdata2.txt</code> 和 <code class="code">custdata3.txt</code>。您可使用以下命令通过指定前缀来加载 <code class="code">mybucket</code> 中以 <code class="code">custdata</code> 开头的所有文件：</p>
         <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="复制"><awsui-icon name="copy"></awsui-icon></div></div><code class="">copy category
from 's3://mybucket/custdata' 
iam_role 'arn:aws:iam::0123456789012:role/MyRedshiftRole';</code></pre>
         <p>如果由于错误仅存在两个文件，则 COPY 仅加载这两个文件并成功完成，从而导致不完整的数据加载。如果桶还包含恰巧使用相同前缀的不需要的文件（例如名为 <code class="code">custdata.backup</code> 的文件），则 COPY 还加载此文件，从而导致加载不需要的数据。</p>
         <p>为了确保加载所有必需的文件并防止加载不需要的文件，您可使用清单文件。清单是 JSON 格式的文本文件，其中列出了要通过 COPY 命令处理的文件。例如，以下清单将加载上例中的三个文件。</p>
         <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="复制"><awsui-icon name="copy"></awsui-icon></div></div><code class=""><span>{</span>  
   "entries":[  
      <span>{</span>  
         "url":"s3://mybucket/custdata.1",
         "mandatory":true
      },
      <span>{</span>  
         "url":"s3://mybucket/custdata.2",
         "mandatory":true
      },
      <span>{</span>  
         "url":"s3://mybucket/custdata.3",
         "mandatory":true
      }
   ]
}</code></pre>
         <p>可选的 <code class="code">mandatory</code> 标志指示 COPY 是否应在文件不存在时终止。默认为 <code class="code">false</code>。如果未找到任何文件，则无论 mandatory 设置如何，COPY 都会终止。在此示例中，如果未找到任何文件，COPY 将返回错误。将忽略可能会在仅指定键前缀（如 <code class="code">custdata.backup</code>）的情况下选取的不需要的文件，因为它们不在清单上。</p>
         <p>在从采用 ORC 或 Parquet 格式的数据文件中加载时，需要 <code class="code">meta</code> 字段，如以下示例所示。</p>
         <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="复制"><awsui-icon name="copy"></awsui-icon></div></div><code class=""><span>{</span>  
   "entries":[  
      <span>{</span>  
         "url":"s3://mybucket-alpha/orc/2013-10-04-custdata",
         "mandatory":true,
         "meta":<span>{</span>  
            "content_length":99
         }
      },
      <span>{</span>  
         "url":"s3://mybucket-beta/orc/2013-10-05-custdata",
         "mandatory":true,
         "meta":<span>{</span>  
            "content_length":99
         }
      }
   ]
}</code></pre>
         <p>以下示例使用名为 <code class="code">cust.manifest</code> 的清单。</p>
         <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="复制"><awsui-icon name="copy"></awsui-icon></div></div><code class="">copy customer
from 's3://mybucket/cust.manifest' 
iam_role 'arn:aws:iam::0123456789012:role/MyRedshiftRole'
format as orc
manifest;</code></pre>
         <p>您可以使用清单来加载不同桶或文件中未共享相同前缀的文件。以下示例显示了用于加载名称以日期戳开头的文件中的数据的 JSON。</p>
         <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="复制"><awsui-icon name="copy"></awsui-icon></div></div><code class=""><span>{</span>
  "entries": [
    <span>{</span>"url":"s3://mybucket/2013-10-04-custdata.txt","mandatory":true},
    <span>{</span>"url":"s3://mybucket/2013-10-05-custdata.txt","mandatory":true},
    <span>{</span>"url":"s3://mybucket/2013-10-06-custdata.txt","mandatory":true},
    <span>{</span>"url":"s3://mybucket/2013-10-07-custdata.txt","mandatory":true}
  ]
}</code></pre>
         <p>此清单可列出位于不同桶中的文件，前提是桶与集群位于同一 AWS 区域。</p>
         <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="复制"><awsui-icon name="copy"></awsui-icon></div></div><code class=""><span>{</span>
  "entries": [
    <span>{</span>"url":"s3://mybucket-alpha/custdata1.txt","mandatory":false},
    <span>{</span>"url":"s3://mybucket-beta/custdata1.txt","mandatory":false},
    <span>{</span>"url":"s3://mybucket-beta/custdata2.txt","mandatory":false}
  ]
}</code></pre>
       
         <h2 id="r_COPY_command_examples-load-listing-from-a-pipe-delimited-file-default-delimiter">从以竖线（默认分隔符）分隔的文件中加载 LISTING</h2>


         <p>以下示例是一个非常简单的示例，其中未指定任何选项并且输入文件包含默认分隔符，即竖线字符（“|”）。</p>
         <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="复制"><awsui-icon name="copy"></awsui-icon></div></div><code class="">copy listing 
from 's3://mybucket/data/listings_pipe.txt' 
iam_role 'arn:aws:iam::0123456789012:role/MyRedshiftRole';</code></pre>
       
         <h2 id="r_COPY_command_examples-load-listing-from-parquet">使用 Parquet 格式的列式数据加载 LISTING</h2>
         <p>以下示例从 Amazon S3 上的名为 parquet 的文件夹加载数据。</p>
         <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="复制"><awsui-icon name="copy"></awsui-icon></div></div><code class="">copy listing 
from 's3://mybucket/data/listings/parquet/' 
iam_role 'arn:aws:iam::0123456789012:role/MyRedshiftRole'
format as parquet;</code></pre>
       
         <h2 id="r_COPY_command_examples-load-listing-from-orc">使用 ORC 格式的列式数据加载 LISTING</h2>
         <p>以下示例从 Amazon S3 上名为 <code class="code">orc</code> 的文件夹加载数据。</p>
         <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="复制"><awsui-icon name="copy"></awsui-icon></div></div><code class="">copy listing 
from 's3://mybucket/data/listings/orc/' 
iam_role 'arn:aws:iam::0123456789012:role/MyRedshiftRole'
format as orc;</code></pre>
       
         <h2 id="r_COPY_command_examples-load-event-with-options">使用选项加载 EVENT</h2>


         <p>以下示例将竖线分隔的数据加载到 EVENT 表中并应用下列规则：</p>
         <div class="itemizedlist">
             
             
             
             
         <ul class="itemizedlist"><li class="listitem">
               <p>如果使用了引号对来括起任何字符串，则会删除它们。</p>
            </li><li class="listitem">
               <p>空字符串和包含空白的字符串将作为 NULL 值加载。</p>
            </li><li class="listitem">
               <p>如果返回了 5 个以上的错误，则加载失败。</p>
            </li><li class="listitem">
               <p>时间戳值必须遵循指定的格式；例如，有效的时间戳为 <code class="code">2008-09-26 05:43:12</code>。</p>
            </li></ul></div>
         <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="复制"><awsui-icon name="copy"></awsui-icon></div></div><code class="">copy event
from 's3://mybucket/data/allevents_pipe.txt' 
iam_role 'arn:aws:iam::0123456789012:role/MyRedshiftRole' 
removequotes
emptyasnull
blanksasnull
maxerror 5
delimiter '|'
timeformat 'YYYY-MM-DD HH:MI:SS';</code></pre>
       
         <h2 id="r_COPY_command_examples-load-venue-from-a-fixed-width-data-file">从固定宽度的数据文件中加载 VENUE</h2>


         <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="复制"><awsui-icon name="copy"></awsui-icon></div></div><code class="">copy venue
from 's3://mybucket/data/venue_fw.txt' 
iam_role 'arn:aws:iam::0123456789012:role/MyRedshiftRole'
fixedwidth 'venueid:3,venuename:25,venuecity:12,venuestate:2,venueseats:6';</code></pre>
         <p>上例假设数据文件与所示的样本数据是使用相同的方式设置格式的。在下面的示例中，空格充当占位符，以便所有列的宽度与规范中的规定相同：</p>
         <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="复制"><awsui-icon name="copy"></awsui-icon></div></div><code class="">1  Toyota Park              Bridgeview  IL0
2  Columbus Crew Stadium    Columbus    OH0
3  RFK Stadium              Washington  DC0
4  CommunityAmerica BallparkKansas City KS0
5  Gillette Stadium         Foxborough  MA68756</code></pre>
       
         <h2 id="load-from-csv">从 CSV 文件中加载 CATEGORY</h2>

         <p>假设您要加载具有下表中所示值的 CATEGORY。</p>
         <div class="table-container"><div class="table-contents"><table id="w319aac47b9c67c31c25b5"><thead>
                  <tr>
                     <th>catid</th>
                     <th>catgroup</th>
                     <th>catname</th>
                     <th>catdesc </th>
                  </tr>
               </thead>
                  <tr>
                     <td tabindex="-1">12</td>
                     <td tabindex="-1">Shows </td>
                     <td tabindex="-1">Musicals</td>
                     <td tabindex="-1">Musical theatre</td>
                  </tr>
                  <tr>
                     <td tabindex="-1">13</td>
                     <td tabindex="-1">Shows</td>
                     <td tabindex="-1">Plays</td>
                     <td tabindex="-1">All "non-musical" theatre</td>
                  </tr>
                  <tr>
                     <td tabindex="-1">14</td>
                     <td tabindex="-1">Shows</td>
                     <td tabindex="-1">Opera</td>
                     <td tabindex="-1">All opera, light, and "rock" opera</td>
                  </tr>
                  <tr>
                     <td tabindex="-1">15</td>
                     <td tabindex="-1">Concerts</td>
                     <td tabindex="-1">Classical </td>
                     <td tabindex="-1">All symphony, concerto, and choir concerts</td>
                  </tr>

               </table></div></div>
         <p>以下示例显示了字段值用逗号隔开的文本文件的内容。</p>
         <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="复制"><awsui-icon name="copy"></awsui-icon></div></div><code class="">12,Shows,Musicals,Musical theatre
13,Shows,Plays,All "non-musical" theatre  
14,Shows,Opera,All opera, light, and "rock" opera
15,Concerts,Classical,All symphony, concerto, and choir concerts</code></pre>
         <p>如果您在加载文件时使用 DELIMITER 参数指定逗号分隔的输入，则 COPY 命令失败，因为一些输入字段包含逗号。您可通过使用 CSV 参数并将包含逗号的字段括在引号字符中来避免以上问题。如果用引号括起来的字符串中出现引号字符，则需要通过双引号字符来进行转义。默认引号字符为双引号，因此您需要使用一个额外的双引号对每个双引号进行转义。您的新输入文件与下面类似。</p>
         <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="复制"><awsui-icon name="copy"></awsui-icon></div></div><code class="">12,Shows,Musicals,Musical theatre
13,Shows,Plays,"All ""non-musical"" theatre"
14,Shows,Opera,"All opera, light, and ""rock"" opera"
15,Concerts,Classical,"All symphony, concerto, and choir concerts"</code></pre>
         <p>假定文件名为 <code class="code">category_csv.txt</code>，则可通过使用以下 COPY 命令加载文件：</p>
         <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="复制"><awsui-icon name="copy"></awsui-icon></div></div><code class="">copy category
from 's3://mybucket/data/category_csv.txt' 
iam_role 'arn:aws:iam::0123456789012:role/MyRedshiftRole' 
csv;</code></pre>
         <p>或者，若要避免对输入中的双引号进行转义，可通过使用 QUOTE AS 参数来指定其他引号字符。例如，以下版本的 <code class="code">category_csv.txt</code> 使用“<code class="code">%</code>”作为引号字符。</p>
         <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="复制"><awsui-icon name="copy"></awsui-icon></div></div><code class="">12,Shows,Musicals,Musical theatre
13,Shows,Plays,%All "non-musical" theatre%
14,Shows,Opera,%All opera, light, and "rock" opera%
15,Concerts,Classical,%All symphony, concerto, and choir concerts%</code></pre>
         <p>以下 COPY 命令使用 QUOTE AS 来加载 <code class="code">category_csv.txt</code>：</p>
         <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="复制"><awsui-icon name="copy"></awsui-icon></div></div><code class="">copy category
from 's3://mybucket/data/category_csv.txt' 
iam_role 'arn:aws:iam::0123456789012:role/MyRedshiftRole' 
csv quote as '%';</code></pre>
       
         <h2 id="r_COPY_command_examples-load-venue-with-explicit-values-for-an-identity-column">加载具有显式的 IDENTITY 列值的 VENUE</h2>


         <p>以下示例假设在创建 VENUE 表时，至少将一个列（如 <code class="code">venueid</code> 列）指定为 IDENTITY 列。此命令将覆盖 IDENTITY 列的自动生成值的默认 IDENTITY 行为，并将改为从 venue.txt 文件加载显式值。使用 EXLICIT_IDS 选项时，Amazon Redshift 不会检查表中是否加载了重复的 IDENTITY 值。</p>
         <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="复制"><awsui-icon name="copy"></awsui-icon></div></div><code class="">copy venue
from 's3://mybucket/data/venue.txt' 
iam_role 'arn:aws:iam::0123456789012:role/MyRedshiftRole'
explicit_ids;</code></pre>
       
         <h2 id="r_COPY_command_examples-load-time-from-a-pipe-delimited-gzip-file">从以竖线分隔的 GZIP 文件中加载 TIME</h2>


         <p>以下示例从用竖线分隔的 GZIP 文件加载 TIME 表：</p>
         <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="复制"><awsui-icon name="copy"></awsui-icon></div></div><code class="">copy time
from 's3://mybucket/data/timerows.gz' 
iam_role 'arn:aws:iam::0123456789012:role/MyRedshiftRole'
gzip
delimiter '|';</code></pre>
       
         <h2 id="r_COPY_command_examples-load-a-time-datestamp">加载时间戳或日期戳</h2>


         <p>以下示例加载具有带格式的时间戳的数据。</p>
         <div class="awsdocs-note"><div class="awsdocs-note-title"><awsui-icon name="status-info" variant="link"></awsui-icon><h6>注意</h6></div><div class="awsdocs-note-text"><p><code class="code">HH:MI:SS</code> 的 TIMEFORMAT 还可支持超出 <code class="code">SS</code> 的高达微秒细节级别的小数秒。此示例中使用的文件 <code class="code">time.txt</code> 包含一行，即 <code class="code">2009-01-12
               14:15:57.119568</code>。</p></div></div>
         <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="复制"><awsui-icon name="copy"></awsui-icon></div></div><code class="">copy timestamp1 
from 's3://mybucket/data/time.txt' 
iam_role 'arn:aws:iam::0123456789012:role/MyRedshiftRole'
timeformat 'YYYY-MM-DD HH:MI:SS';</code></pre>
         <p>此复制的结果如下所示：</p>
         <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="复制"><awsui-icon name="copy"></awsui-icon></div></div><code class="">select * from timestamp1;
c1
----------------------------
2009-01-12 14:15:57.119568
(1 row)</code></pre>
       
         <h2 id="r_COPY_command_examples-load-data-from-a-file-with-default-values">从具有默认值的文件中加载数据</h2>


         <p>以下示例使用 TICKIT 数据库中的 VENUE 表的变体。考虑使用以下语句定义的 VENUE_NEW 表：</p>
         <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="复制"><awsui-icon name="copy"></awsui-icon></div></div><code class="">create table venue_new(
venueid smallint not null,
venuename varchar(100) not null,
venuecity varchar(30),
venuestate char(2),
venueseats integer not null default '1000');</code></pre>
         <p>考虑未包含任何 VENUESEATS 列值的 venue_noseats.txt 数据文件，如以下示例中所示：</p>
         <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="复制"><awsui-icon name="copy"></awsui-icon></div></div><code class="">1|Toyota Park|Bridgeview|IL|
2|Columbus Crew Stadium|Columbus|OH|
3|RFK Stadium|Washington|DC|
4|CommunityAmerica Ballpark|Kansas City|KS|
5|Gillette Stadium|Foxborough|MA|
6|New York Giants Stadium|East Rutherford|NJ|
7|BMO Field|Toronto|ON|
8|The Home Depot Center|Carson|CA|
9|Dick's Sporting Goods Park|Commerce City|CO|
10|Pizza Hut Park|Frisco|TX|</code></pre>
         <p>以下 COPY 语句将成功地从此文件中加载表并对已省略的列应用 DEFAULT 值（“1000”）：</p>
         <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="复制"><awsui-icon name="copy"></awsui-icon></div></div><code class="">copy venue_new(venueid, venuename, venuecity, venuestate) 
from 's3://mybucket/data/venue_noseats.txt' 
iam_role 'arn:aws:iam::0123456789012:role/MyRedshiftRole'
delimiter '|';</code></pre>
         <p>现在查看加载的表：</p>
         <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="复制"><awsui-icon name="copy"></awsui-icon></div></div><code class="">select * from venue_new order by venueid;
venueid |         venuename          |    venuecity    | venuestate | venueseats
---------+----------------------------+-----------------+------------+------------
1 | Toyota Park                | Bridgeview      | IL         |       1000
2 | Columbus Crew Stadium      | Columbus        | OH         |       1000
3 | RFK Stadium                | Washington      | DC         |       1000
4 | CommunityAmerica Ballpark  | Kansas City     | KS         |       1000
5 | Gillette Stadium           | Foxborough      | MA         |       1000
6 | New York Giants Stadium    | East Rutherford | NJ         |       1000
7 | BMO Field                  | Toronto         | ON         |       1000
8 | The Home Depot Center      | Carson          | CA         |       1000
9 | Dick's Sporting Goods Park | Commerce City   | CO         |       1000
10 | Pizza Hut Park             | Frisco          | TX         |       1000
(10 rows)</code></pre>
         <p>在以下示例中，除了假设此文件中未包含任何 VENUESEATS 数据之外，还假设未包含任何 VENUENAME 数据：</p>
         <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="复制"><awsui-icon name="copy"></awsui-icon></div></div><code class="">1||Bridgeview|IL|
2||Columbus|OH|
3||Washington|DC|
4||Kansas City|KS|
5||Foxborough|MA|
6||East Rutherford|NJ|
7||Toronto|ON|
8||Carson|CA|
9||Commerce City|CO|
10||Frisco|TX|</code></pre>
         <p> 通过使用相同的表定义，以下 COPY 语句失败，因为未为 VENUENAME 指定任何 DEFAULT 值，并且 VENUENAME 是一个非 NULL 列：</p>
         <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="复制"><awsui-icon name="copy"></awsui-icon></div></div><code class="">copy venue(venueid, venuecity, venuestate) 
from 's3://mybucket/data/venue_pipe.txt' 
iam_role 'arn:aws:iam::0123456789012:role/MyRedshiftRole'
delimiter '|';</code></pre>
         <p>现在考虑使用 IDENTITY 列的 VENUE 表的变体：</p>
         <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="复制"><awsui-icon name="copy"></awsui-icon></div></div><code class="">create table venue_identity(
venueid int identity(1,1),
venuename varchar(100) not null,
venuecity varchar(30),
venuestate char(2),
venueseats integer not null default '1000');</code></pre>
         <p>与上例一样，假设 VENUESEATS 列没有源文件中的对应值。以下 COPY 语句成功地加载表（包括预先定义的 IDENTITY 数据值）而不是自动生成这些值：</p>
         <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="复制"><awsui-icon name="copy"></awsui-icon></div></div><code class="">copy venue(venueid, venuename, venuecity, venuestate) 
from 's3://mybucket/data/venue_pipe.txt' 
iam_role 'arn:aws:iam::0123456789012:role/MyRedshiftRole'
delimiter '|' explicit_ids;</code></pre>
         <p>此语句将失败，因为它未包含 IDENTITY 列（列列表中缺少 VENUEID），而是包含 EXPLICIT_IDS 参数：</p>
         <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="复制"><awsui-icon name="copy"></awsui-icon></div></div><code class="">copy venue(venuename, venuecity, venuestate) 
from 's3://mybucket/data/venue_pipe.txt' 
iam_role 'arn:aws:iam::0123456789012:role/MyRedshiftRole'
delimiter '|' explicit_ids;</code></pre>
         <p>此语句将失败，因为它不包含 EXPLICIT_IDS 参数：</p>
         <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="复制"><awsui-icon name="copy"></awsui-icon></div></div><code class="">copy venue(venueid, venuename, venuecity, venuestate)
from 's3://mybucket/data/venue_pipe.txt' 
iam_role 'arn:aws:iam::0123456789012:role/MyRedshiftRole'
delimiter '|';</code></pre>
       
         <h2 id="r_COPY_command_examples-copy-data-with-the-escape-option">使用 ESCAPE 选项复制数据</h2>


         <p>以下示例演示如何加载与分隔符字符（在此示例中为竖线字符）匹配的字符。在输入文件中，确保使用反斜杠字符 (\) 转义您要加载的所有竖线字符 (|)。然后使用 ESCAPE 参数加载此文件。</p>
         <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="复制"><awsui-icon name="copy"></awsui-icon></div></div><code class="">$ more redshiftinfo.txt
1|public\|event\|dwuser
2|public\|sales\|dwuser

create table redshiftinfo(infoid int,tableinfo varchar(50));

copy redshiftinfo from 's3://mybucket/data/redshiftinfo.txt' 
iam_role 'arn:aws:iam::0123456789012:role/MyRedshiftRole' 
delimiter '|' escape;

select * from redshiftinfo order by 1;
infoid |       tableinfo
-------+--------------------
1      | public|event|dwuser
2      | public|sales|dwuser
(2 rows)</code></pre>
         <p>如果没有 ESCAPE 参数，此 COPY 命令将失败，并返回 <code class="code">Extra column(s)
               found</code> 错误。</p>
         <div class="awsdocs-note awsdocs-important"><div class="awsdocs-note-title"><awsui-icon name="status-warning" variant="error"></awsui-icon><h6>重要</h6></div><div class="awsdocs-note-text"><p>如果使用包含 ESCAPE 参数的 COPY 加载数据，则还必须在 UNLOAD 命令中指定 ESCAPE 参数与以生成反向输出文件。同样，如果您使用 ESCAPE 参数执行 UNLOAD 命令，则在您对相同数据执行 COPY 操作时需要使用 ESCAPE 参数。</p></div></div>
       
         <h2 id="r_COPY_command_examples-copy-from-json">从 JSON 中复制的示例</h2>

         <p>在以下示例中，您加载具有以下数据的 CATEGORY 表。</p>
         <div class="table-container"><div class="table-contents"><table id="w319aac47b9c67c31c37b5"><thead>
                  <tr>
                     <th>CATID</th>
                     <th>CATGROUP</th>
                     <th>CATNAME</th>
                     <th>CATDESC</th>
                  </tr>
               </thead>
                  <tr>
                     <td tabindex="-1">1</td>
                     <td tabindex="-1">Sports</td>
                     <td tabindex="-1">MLB</td>
                     <td tabindex="-1"> Major League Baseball</td>
                  </tr>
                  <tr>
                     <td tabindex="-1">2</td>
                     <td tabindex="-1">Sports</td>
                     <td tabindex="-1">NHL</td>
                     <td tabindex="-1">National Hockey League</td>
                  </tr>
                  <tr>
                     <td tabindex="-1">3</td>
                     <td tabindex="-1">Sports</td>
                     <td tabindex="-1">NFL</td>
                     <td tabindex="-1">National Football League</td>
                  </tr>
                  <tr>
                     <td tabindex="-1">4</td>
                     <td tabindex="-1">Sports</td>
                     <td tabindex="-1">NBA</td>
                     <td tabindex="-1">National Basketball Association</td>
                  </tr>
                  <tr>
                     <td tabindex="-1">5</td>
                     <td tabindex="-1">Concerts</td>
                     <td tabindex="-1">Classical</td>
                     <td tabindex="-1">All symphony, concerto, and choir concerts</td>
                  </tr>
               </table></div></div>
         <div class="highlights" id="inline-topiclist"><h6>主题</h6><ul><li><a href="#copy-from-json-examples-using-auto">使用“auto”选项从 JSON 数据中加载</a></li><li><a href="#copy-from-json-examples-using-auto-ignorecase">使用“auto ignorecase”选项从 JSON 数据中加载</a></li><li><a href="#copy-from-json-examples-using-jsonpaths">使用 JSONPaths 文件从 JSON 数据中加载</a></li><li><a href="#copy-from-json-examples-using-jsonpaths-arrays">使用 JSONPaths 文件从 JSON 数组中加载</a></li></ul></div>

          
            <h3 id="copy-from-json-examples-using-auto">使用“auto”选项从 JSON 数据中加载</h3>

            <p>要使用 <code class="code">'auto'</code> 选项从 JSON 数据加载，JSON 数据必须包含一组对象。键名称必须与列名称匹配，但顺序并不重要。下面显示了名为 <code class="code">category_object_auto.json</code> 的文件的内容。</p>
            <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="复制"><awsui-icon name="copy"></awsui-icon></div></div><code class=""><span>{</span>
    "catdesc": "Major League Baseball",
    "catid": 1,
    "catgroup": "Sports",
    "catname": "MLB"
}
<span>{</span>
    "catgroup": "Sports",
    "catid": 2,
    "catname": "NHL",
    "catdesc": "National Hockey League"
}<span>{</span>
    "catid": 3,
    "catname": "NFL",
    "catgroup": "Sports",
    "catdesc": "National Football League"
}
<span>{</span>
    "bogus": "Bogus Sports LLC",
    "catid": 4,
    "catgroup": "Sports",
    "catname": "NBA",
    "catdesc": "National Basketball Association"
}
<span>{</span>
    "catid": 5,
    "catgroup": "Shows",
    "catname": "Musicals",
    "catdesc": "All symphony, concerto, and choir concerts"
}</code></pre>
            <p>若要从上例中的 JSON 数据文件加载，请执行以下 COPY 命令。</p>
            <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="复制"><awsui-icon name="copy"></awsui-icon></div></div><code class="">copy category
from 's3://mybucket/category_object_auto.json'
iam_role 'arn:aws:iam::0123456789012:role/MyRedshiftRole' 
json 'auto';</code></pre>
          
         
          
            <h3 id="copy-from-json-examples-using-auto-ignorecase">使用“auto ignorecase”选项从 JSON 数据中加载</h3>
            
            <p>要使用 <code class="code">'auto ignorecase'</code> 选项从 JSON 数据加载，JSON 数据必须包含一组对象。键名称的大小写不必与列名称匹配，顺序并不重要。下面显示了名为 <code class="code">category_object_auto-ignorecase.json</code> 的文件的内容。</p>
            <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="复制"><awsui-icon name="copy"></awsui-icon></div></div><code class=""><span>{</span>
    "CatDesc": "Major League Baseball",
    "CatID": 1,
    "CatGroup": "Sports",
    "CatName": "MLB"
}
<span>{</span>
    "CatGroup": "Sports",
    "CatID": 2,
    "CatName": "NHL",
    "CatDesc": "National Hockey League"
}<span>{</span>
    "CatID": 3,
    "CatName": "NFL",
    "CatGroup": "Sports",
    "CatDesc": "National Football League"
}
<span>{</span>
    "bogus": "Bogus Sports LLC",
    "CatID": 4,
    "CatGroup": "Sports",
    "CatName": "NBA",
    "CatDesc": "National Basketball Association"
}
<span>{</span>
    "CatID": 5,
    "CatGroup": "Shows",
    "CatName": "Musicals",
    "CatDesc": "All symphony, concerto, and choir concerts"
}</code></pre>
            <p>若要从上例中的 JSON 数据文件加载，请执行以下 COPY 命令。</p>
            <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="复制"><awsui-icon name="copy"></awsui-icon></div></div><code class="">copy category
from 's3://mybucket/category_object_auto ignorecase.json'
iam_role 'arn:aws:iam::0123456789012:role/MyRedshiftRole' 
json 'auto ignorecase';</code></pre>
          
          
            <h3 id="copy-from-json-examples-using-jsonpaths">使用 JSONPaths 文件从 JSON 数据中加载</h3>
            
            <p>如果 JSON 数据对象未直接对应于列名称，则可使用 JSONPaths 文件将 JSON 元素映射到列。顺序在 JSON 源数据中也不重要，但 JSONPaths 文件表达式的顺序必须与列顺序匹配。假设您具有以下名为 <code class="code">category_object_paths.json</code> 的数据文件。</p>
            <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="复制"><awsui-icon name="copy"></awsui-icon></div></div><code class=""><span>{</span>
    "one": 1,
    "two": "Sports",
    "three": "MLB",
    "four": "Major League Baseball"
}
<span>{</span>
    "three": "NHL",
    "four": "National Hockey League",
    "one": 2,
    "two": "Sports"
}
<span>{</span>
    "two": "Sports",
    "three": "NFL",
    "one": 3,
    "four": "National Football League"
}
<span>{</span>
    "one": 4,
    "two": "Sports",
    "three": "NBA",
    "four": "National Basketball Association"
}
<span>{</span>
    "one": 6,
    "two": "Shows",
    "three": "Musicals",
    "four": "All symphony, concerto, and choir concerts"
}</code></pre>
            <p>以下名为 <code class="code">category_jsonpath.json</code> 的 JSONPaths 文件会将源数据映射到表列。</p>
            <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="复制"><awsui-icon name="copy"></awsui-icon></div></div><code class=""><span>{</span>
    "jsonpaths": [
        "$['one']",
        "$['two']",
        "$['three']",
        "$['four']"
    ]
}</code></pre>
            <p>若要从上例中的 JSON 数据文件加载，请执行以下 COPY 命令。</p>
            <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="复制"><awsui-icon name="copy"></awsui-icon></div></div><code class="">copy category
from 's3://mybucket/category_object_paths.json'
iam_role 'arn:aws:iam::0123456789012:role/MyRedshiftRole' 
json 's3://mybucket/category_jsonpath.json';</code></pre>
          
         
         
          
            <h3 id="copy-from-json-examples-using-jsonpaths-arrays">使用 JSONPaths 文件从 JSON 数组中加载</h3>

            <p>若要从包含一组数组的 JSON 数据加载，必须使用 JSONPaths 文件将数组元素映射到列。假设您具有以下名为 <code class="code">category_array_data.json</code> 的数据文件。</p>
            <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="复制"><awsui-icon name="copy"></awsui-icon></div></div><code class="">[1,"Sports","MLB","Major League Baseball"]
[2,"Sports","NHL","National Hockey League"]
[3,"Sports","NFL","National Football League"]
[4,"Sports","NBA","National Basketball Association"]
[5,"Concerts","Classical","All symphony, concerto, and choir concerts"]</code></pre>
            <p>以下名为 <code class="code">category_array_jsonpath.json</code> 的 JSONPaths 文件会将源数据映射到表列。</p>
            <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="复制"><awsui-icon name="copy"></awsui-icon></div></div><code class=""><span>{</span>
    "jsonpaths": [
        "$[0]",
        "$[1]",
        "$[2]",
        "$[3]"
    ]
}</code></pre>
            <p>若要从上例中的 JSON 数据文件加载，请执行以下 COPY 命令。</p>
            <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="复制"><awsui-icon name="copy"></awsui-icon></div></div><code class="">copy category
from 's3://mybucket/category_array_data.json'
iam_role 'arn:aws:iam::0123456789012:role/MyRedshiftRole' 
json 's3://mybucket/category_array_jsonpath.json';</code></pre>
          
             
         <h2 id="r_COPY_command_examples-copy-from-avro">从 Avro 中复制的示例</h2>

         <p>在以下示例中，您加载具有以下数据的 CATEGORY 表。</p>
         <div class="table-container"><div class="table-contents"><table id="w319aac47b9c67c31c39b5"><thead>
                  <tr>
                     <th>CATID</th>
                     <th>CATGROUP</th>
                     <th>CATNAME</th>
                     <th>CATDESC</th>
                  </tr>
               </thead>
                  <tr>
                     <td tabindex="-1">1</td>
                     <td tabindex="-1">Sports</td>
                     <td tabindex="-1">MLB</td>
                     <td tabindex="-1"> Major League Baseball</td>
                  </tr>
                  <tr>
                     <td tabindex="-1">2</td>
                     <td tabindex="-1">Sports</td>
                     <td tabindex="-1">NHL</td>
                     <td tabindex="-1">National Hockey League</td>
                  </tr>
                  <tr>
                     <td tabindex="-1">3</td>
                     <td tabindex="-1">Sports</td>
                     <td tabindex="-1">NFL</td>
                     <td tabindex="-1">National Football League</td>
                  </tr>
                  <tr>
                     <td tabindex="-1">4</td>
                     <td tabindex="-1">Sports</td>
                     <td tabindex="-1">NBA</td>
                     <td tabindex="-1">National Basketball Association</td>
                  </tr>
                  <tr>
                     <td tabindex="-1">5</td>
                     <td tabindex="-1">Concerts</td>
                     <td tabindex="-1">Classical</td>
                     <td tabindex="-1">All symphony, concerto, and choir concerts</td>
                  </tr>
               </table></div></div>
         <div class="highlights" id="inline-topiclist"><h6>主题</h6><ul><li><a href="#copy-from-avro-examples-using-auto">使用“auto”选项从 Avro 数据中加载</a></li><li><a href="#copy-from-avro-examples-using-auto-ignorecase">使用“auto ignorecase”选项从 Avro 数据中加载</a></li><li><a href="#copy-from-avro-examples-using-avropaths">使用 JSONPaths 文件从 Avro 数据中加载</a></li></ul></div>
          
            <h3 id="copy-from-avro-examples-using-auto">使用“auto”选项从 Avro 数据中加载</h3>

            <p>若要使用 <code class="code">'auto'</code> 参数从 Avro 数据加载，Avro schema 中的字段名称必须与列名称匹配。在使用 <code class="code">'auto'</code> 参数时，顺序并不重要。下面显示了名为 <code class="code">category_auto.avro</code> 的文件的 schema。</p>
            <pre class="screen"><span>{</span>
    "name": "category",
    "type": "record",
    "fields": [
        <span>{</span>"name": "catid", "type": "int"},
        <span>{</span>"name": "catdesc", "type": "string"},
        <span>{</span>"name": "catname", "type": "string"},
        <span>{</span>"name": "catgroup", "type": "string"},
}</pre>
            <p>Avro 文件中的数据为二进制格式，不是人类可读的格式。下面显示了 <code class="code">category_auto.avro</code> 文件中的数据的 JSON 表示形式。</p>
            <pre class="screen"><span>{</span>
   "catid": 1,
   "catdesc": "Major League Baseball",
   "catname": "MLB",
   "catgroup": "Sports"
}
<span>{</span>
   "catid": 2,
   "catdesc": "National Hockey League",
   "catname": "NHL",
   "catgroup": "Sports"
}
<span>{</span>
   "catid": 3,
   "catdesc": "National Basketball Association",
   "catname": "NBA",
   "catgroup": "Sports"
}
<span>{</span>
   "catid": 4,
   "catdesc": "All symphony, concerto, and choir concerts",
   "catname": "Classical",
   "catgroup": "Concerts"
}</pre>
            <p>要从上例中的 Avro 数据文件加载，请执行以下 COPY 命令。</p>
            <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="复制"><awsui-icon name="copy"></awsui-icon></div></div><code class="">copy category
from 's3://mybucket/category_auto.avro'
iam_role 'arn:aws:iam::0123456789012:role/MyRedshiftRole'
format as avro 'auto';</code></pre>
          
         
          
            <h3 id="copy-from-avro-examples-using-auto-ignorecase">使用“auto ignorecase”选项从 Avro 数据中加载</h3>
            
            <p>若要使用 <code class="code">'auto ignorecase'</code> 参数从 Avro 数据加载，Avro schema 中的字段名称的大小写不必与列名称的大小写匹配。在使用 <code class="code">'auto ignorecase'</code> 参数时，顺序并不重要。下面显示了名为 <code class="code">category_auto-ignorecase.avro</code> 的文件的 schema。</p>
            <pre class="screen"><span>{</span>
    "name": "category",
    "type": "record",
    "fields": [
        <span>{</span>"name": "CatID", "type": "int"},
        <span>{</span>"name": "CatDesc", "type": "string"},
        <span>{</span>"name": "CatName", "type": "string"},
        <span>{</span>"name": "CatGroup", "type": "string"},
}</pre>
            <p>Avro 文件中的数据为二进制格式，不是人类可读的格式。下面显示了 <code class="code">category_auto-ignorecase.avro</code> 文件中的数据的 JSON 表示形式。</p>
            <pre class="screen"><span>{</span>
   "CatID": 1,
   "CatDesc": "Major League Baseball",
   "CatName": "MLB",
   "CatGroup": "Sports"
}
<span>{</span>
   "CatID": 2,
   "CatDesc": "National Hockey League",
   "CatName": "NHL",
   "CatGroup": "Sports"
}
<span>{</span>
   "CatID": 3,
   "CatDesc": "National Basketball Association",
   "CatName": "NBA",
   "CatGroup": "Sports"
}
<span>{</span>
   "CatID": 4,
   "CatDesc": "All symphony, concerto, and choir concerts",
   "CatName": "Classical",
   "CatGroup": "Concerts"
}</pre>
            <p>要从上例中的 Avro 数据文件加载，请执行以下 COPY 命令。</p>
            <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="复制"><awsui-icon name="copy"></awsui-icon></div></div><code class="">copy category
from 's3://mybucket/category_auto-ignorecase.avro'
iam_role 'arn:aws:iam::0123456789012:role/MyRedshiftRole'
format as avro 'auto ignorecase';</code></pre>
          
         
          
            <h3 id="copy-from-avro-examples-using-avropaths">使用 JSONPaths 文件从 Avro 数据中加载</h3>

            <p>如果 Avro schema 中的字段名称未直接对应于列名称，则可使用 JSONPaths 文件将 schema 元素映射到列。JSONPaths 文件表达式的顺序必须与列顺序一致。</p>
            <p>假设您具有名为 <code class="code">category_paths.avro</code> 的数据文件，其中包含的数据与上例相同，但具有以下架构。</p>
            <pre class="screen"><span>{</span>
    "name": "category",
    "type": "record",
    "fields": [
        <span>{</span>"name": "id", "type": "int"},
        <span>{</span>"name": "desc", "type": "string"},
        <span>{</span>"name": "name", "type": "string"},
        <span>{</span>"name": "group", "type": "string"},
        <span>{</span>"name": "region", "type": "string"} 
     ]
}</pre>
            <p>以下名为 <code class="code">category_path.avropath</code> 的 JSONPaths 文件会将源数据映射到表列。</p>
            <pre class="screen"><span>{</span>
    "jsonpaths": [
        "$['id']",
        "$['group']",
        "$['name']",
        "$['desc']"
    ]
}</pre>
            <p>要从上例中的 Avro 数据文件加载，请执行以下 COPY 命令。</p>
            <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="复制"><awsui-icon name="copy"></awsui-icon></div></div><code class="">copy category
from 's3://mybucket/category_object_paths.avro'
iam_role 'arn:aws:iam::0123456789012:role/MyRedshiftRole' 
format avro 's3://mybucket/category_path.avropath ';</code></pre>
          

       
         <h2 id="r_COPY_preparing_data">使用 ESCAPE 选项为 COPY 准备文件</h2>


         <p>以下示例描述了在使用包含 ESCAPE 参数的 COPY 命令将数据导入到 Amazon Redshift 表中之前，如何准备数据以“转义”换行符。如果未准备数据以限定换行符，则 Amazon Redshift 将会在您运行 COPY 命令时返回加载错误，因为换行符一般用作记录分隔符。</p>
         <p>例如，考虑要复制到 Amazon Redshift 表中的一个文件或外部表中的一个列。如果该文件或列包含 XML 格式的内容或类似数据，则需要确保使用反斜杠字符 (\) 转义此内容中的所有换行符 (\n)。</p>
         <p>包含嵌入换行符的文件或表提供了相对轻松的匹配模式。每个嵌入的换行符很有可能始终跟随一个 <code class="code">&gt;</code> 字符（在这二者之间可能还包含一些空格字符（<code class="code">' '</code> 或制表符）），如下面的名为 <code>nlTest1.txt</code> 的文本文件的示例中所示。</p>
         <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="复制"><awsui-icon name="copy"></awsui-icon></div></div><code class="">$ cat nlTest1.txt
&lt;xml start&gt;
&lt;newline characters provide&gt;
&lt;line breaks at the end of each&gt;
&lt;line in content&gt;
&lt;/xml&gt;|1000
&lt;xml&gt;
&lt;/xml&gt;|2000</code></pre>
         <p>在以下示例中，您可运行文本处理实用工具预先处理源文件，并在需要的位置插入转义字符。（<code class="code">|</code> 字符旨在用作分隔符，以便在列数据复制到 Amazon Redshift 表中后分隔这些数据。） </p>
         <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="复制"><awsui-icon name="copy"></awsui-icon></div></div><code class="">$ sed -e ':a;N;$!ba;s/&gt;[[:space:]]*\n/&gt;\\\n/g' nlTest1.txt &gt; nlTest2.txt</code></pre>
         <p>同样，可使用 Perl 执行类似操作：</p>
         <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="复制"><awsui-icon name="copy"></awsui-icon></div></div><code class="">cat nlTest1.txt | perl -p -e 's/&gt;\s*\n/&gt;\\\n/g' &gt; nlTest2.txt</code></pre>
         <p>为了便于将 <code>nlTest2.txt</code> 文件中的数据加载到 Amazon Redshift 中，我们在 Amazon Redshift 中创建了一个包含两列的表。第一列 c1 是字符列，用于放置 <code>nlTest2.txt</code> 文件中 XML 格式的内容。第二列 c2 将放置从同一文件加载的整数值。</p>
         <p>在运行 <code class="code">sed</code> 命令后，可使用 ESCAPE 参数将 <code>nlTest2.txt</code> 文件中的数据正确地加载到 Amazon Redshift 表中。</p>
         <div class="awsdocs-note"><div class="awsdocs-note-title"><awsui-icon name="status-info" variant="link"></awsui-icon><h6>注意</h6></div><div class="awsdocs-note-text"><p>如果您在 COPY 命令中包含 ESCAPE 参数，则它会将一些包含反斜杠字符的特殊字符（包括换行符）进行转义。</p></div></div>
         <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="复制"><awsui-icon name="copy"></awsui-icon></div></div><code class="">copy t2 from 's3://mybucket/data/nlTest2.txt' 
iam_role 'arn:aws:iam::0123456789012:role/MyRedshiftRole'  
escape
delimiter as '|';

select * from t2 order by 2;

c1           |  c2
-------------+------
&lt;xml start&gt;
&lt;newline characters provide&gt;
&lt;line breaks at the end of each&gt;
&lt;line in content&gt;
&lt;/xml&gt;
| 1000
&lt;xml&gt;
&lt;/xml&gt;       | 2000
(2 rows)</code></pre>
         <p>您可以类似方式准备从外部数据库导出的数据文件。例如，对于 Oracle 数据库，可对要复制到 Amazon Redshift 中的表中的每个受影响的列使用 REPLACE 函数。</p>
         <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="复制"><awsui-icon name="copy"></awsui-icon></div></div><code class="">SELECT c1, REPLACE(c2, \n',\\n' ) as c2 from my_table_with_xml</code></pre>
         <p>此外，许多用于定期处理大量数据的数据库导出和提取、转换、加载 (ETL) 工具提供了指定转义字符和分隔符字符的选项。</p>
       
         
         
         <h2 id="copy-example-spatial-copy-shapefile">将 shapefile 加载到 Amazon Redshift</h2>
         
         <p>以下示例演示如何使用 COPY 加载 Esri shapefile。有关加载 shapefile 的更多信息，请参阅<a href="./spatial-copy-shapefile.html">将 shapefile 加载到 Amazon Redshift</a>。</p>        

         
         
          
            <h3 id="copy-example-spatial-copy-shapefile-loading-copy">加载一个 shapefile</h3>
            
            
            <p>以下步骤介绍如何使用 COPY 命令从 Amazon S3 中摄取 OpenStreetMap 数据。此示例假定 <a href="https://download.geofabrik.de/europe.html" rel="noopener noreferrer" target="_blank"><span>Geofabrik 下载站点的</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a> Norway shapefile 归档已经上载到 AWS 区域中的私有 Amazon S3 桶。<code>.shp</code>、<code>.shx</code> 和 <code>.dbf</code> 文件必须共享相同的 Amazon S3 前缀和文件名。</p>
            
             
               <h4 id="spatial-copy-shapefile-loading-copy-fits">无需简化即可摄取数据</h4>
               <p>以下命令可创建表并摄取可适合最大几何大小的数据，而无需进行任何简化。在您的首选 GIS 软件中打开 <code>gis_osm_natural_free_1.shp</code>，然后检查此图层中的列。预设情况下，IDENTITY 或 GEOMETRY 列位于首位。当 GEOMETRY 列位于首位时，您可以创建表，如下所示。</p>
               <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="复制"><awsui-icon name="copy"></awsui-icon></div></div><code class="sql ">CREATE TABLE norway_natural (
   wkb_geometry GEOMETRY,
   osm_id BIGINT,
   code INT,
   fclass VARCHAR,
   name VARCHAR);            
</code></pre>
               
               <p>或者，当 IDENTITY 列位于首位时，您可以创建表，如下所示。</p>
               
               <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="复制"><awsui-icon name="copy"></awsui-icon></div></div><code class="sql ">CREATE TABLE norway_natural_with_id (
   fid INT IDENTITY(1,1),
   wkb_geometry GEOMETRY,
   osm_id BIGINT,
   code INT,
   fclass VARCHAR,
   name VARCHAR);            
</code></pre>
               
               <p>现在，您可以使用 COPY 摄取数据。</p>
               <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="复制"><awsui-icon name="copy"></awsui-icon></div></div><code class="sql ">COPY norway_natural FROM 's3://<code class="replaceable">bucket_name</code>/shapefiles/norway/gis_osm_natural_free_1.shp'
FORMAT SHAPEFILE
CREDENTIALS 'aws_iam_role=arn:aws:iam::123456789012:role/MyRoleName';
INFO: Load into table 'norway_natural' completed, 83891 record(s) loaded successfully
</code></pre>
               
               <p>或者，您可以按如下所示摄取数据。</p>
               
               <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="复制"><awsui-icon name="copy"></awsui-icon></div></div><code class="sql ">COPY norway_natural_with_id FROM 's3://<code class="replaceable">bucket_name</code>/shapefiles/norway/gis_osm_natural_free_1.shp'
FORMAT SHAPEFILE
CREDENTIALS 'aws_iam_role=arn:aws:iam::123456789012:role/MyRoleName';
INFO: Load into table 'norway_natural_with_id' completed, 83891 record(s) loaded successfully.
</code></pre>         
             
            
             
               <h4 id="spatial-copy-shapefile-loading-copy-no-fit">通过简化摄取数据</h4>
               <p>以下命令创建一个表，并尝试在不进行任何简化的情况下摄取无法适合最大几何大小的数据。检查 <code>gis_osm_water_a_free_1.shp</code> shapefile 并创建相应的表，如下所示。</p>             
               <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="复制"><awsui-icon name="copy"></awsui-icon></div></div><code class="sql ">CREATE TABLE norway_water (
   wkb_geometry GEOMETRY,
   osm_id BIGINT,
   code INT,
   fclass VARCHAR,
   name VARCHAR);
</code></pre>
               
               <p>当 COPY 命令运行时，会导致错误。</p>
               
               <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="复制"><awsui-icon name="copy"></awsui-icon></div></div><code class="sql ">COPY norway_water FROM 's3://<code class="replaceable">bucket_name</code>/shapefiles/norway/gis_osm_water_a_free_1.shp'
FORMAT SHAPEFILE
CREDENTIALS 'aws_iam_role=arn:aws:iam::123456789012:role/MyRoleName';
ERROR:  Load into table 'norway_water' failed.  Check 'stl_load_errors' system table for details.              
</code></pre>
               
               <p>查询 <code class="code">STL_LOAD_ERRORS</code> 显示几何体过大。</p>
               
               <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="复制"><awsui-icon name="copy"></awsui-icon></div></div><code class="nohighlight">SELECT line_number, btrim(colname), btrim(err_reason) FROM stl_load_errors WHERE query = pg_last_copy_id();
 line_number |    btrim     |                                 btrim
-------------+--------------+-----------------------------------------------------------------------
     1184705 | wkb_geometry | Geometry size: 1513736 is larger than maximum supported size: 1048447              
</code></pre>
               
               <p>为了克服这个问题，将 <code class="code">SIMPLIFY AUTO</code> 参数添加到 COPY 命令中以简化几何体。</p>
               
               <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="复制"><awsui-icon name="copy"></awsui-icon></div></div><code class="sql ">COPY norway_water FROM 's3://<code class="replaceable">bucket_name</code>/shapefiles/norway/gis_osm_water_a_free_1.shp'
FORMAT SHAPEFILE
SIMPLIFY AUTO
CREDENTIALS 'aws_iam_role=arn:aws:iam::123456789012:role/MyRoleName';

INFO:  Load into table 'norway_water' completed, 1989196 record(s) loaded successfully.              
</code></pre>
               
               <p>要查看简化的行和几何体，请查询 <code class="code">SVL_SPATIAL_SIMPLIFY</code>。</p>
               
               <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="复制"><awsui-icon name="copy"></awsui-icon></div></div><code class="nohighlight">SELECT * FROM svl_spatial_simplify WHERE query = pg_last_copy_id();
 query | line_number | maximum_tolerance | initial_size | simplified | final_size |   final_tolerance
-------+-------------+-------------------+--------------+------------+------------+----------------------
    20 |     1184704 |                -1 |      1513736 | t          |    1008808 |   1.276386653895e-05
    20 |     1664115 |                -1 |      1233456 | t          |    1023584 | 6.11707814796635e-06               
</code></pre>
               
               <p>使用容差低于自动计算容差的 SIMPLIFY AUTO <em>max_tolerance</em> 可能会导致摄入误差。在这种情况下，请使用 MAXERROR 忽略错误。</p>
               
               <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="复制"><awsui-icon name="copy"></awsui-icon></div></div><code class="sql ">COPY norway_water FROM 's3://<code class="replaceable">bucket_name</code>/shapefiles/norway/gis_osm_water_a_free_1.shp'
FORMAT SHAPEFILE
SIMPLIFY AUTO 1.1E-05
MAXERROR 2
CREDENTIALS 'aws_iam_role=arn:aws:iam::123456789012:role/MyRoleName';

INFO:  Load into table 'norway_water' completed, 1989195 record(s) loaded successfully.
INFO:  Load into table 'norway_water' completed, 1 record(s) could not be loaded.  Check 'stl_load_errors' system table for details.               
</code></pre>
               
               <p>再次查询 <code class="code">SVL_SPATIAL_SIMPLIFY</code> 来识别 COPY 未成功加载的记录。</p>
               <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="复制"><awsui-icon name="copy"></awsui-icon></div></div><code class="nohighlight">SELECT * FROM svl_spatial_simplify WHERE query = pg_last_copy_id();
 query | line_number | maximum_tolerance | initial_size | simplified | final_size | final_tolerance
-------+-------------+-------------------+--------------+------------+------------+-----------------
    29 |     1184704 |           1.1e-05 |      1513736 | f          |          0 |               0
    29 |     1664115 |           1.1e-05 |      1233456 | t          |     794432 |         1.1e-05             
</code></pre>
               
               <p>在这个示例中，第一条记录没有成功适应，因此 <code class="code">simplified</code> 列显示为 false。第二条记录已在给定容差范围内加载。但是，最终大小比使用自动计算的容差大，而不指定最大公差。</p>             
                       
             
                       
          
         
          
            <h3 id="copy-example-spatial-copy-shapefile-compressed">正在从压缩的 shapefile 文件加载</h3>
            <p>Amazon Redshift COPY 支持从压缩的 shapefile 中摄取数据。所有 shapefile 组件必须具有相同的 Amazon S3 前缀和相同的压缩后缀。例如，假设您要加载上面示例中的数据。在本例中，文件 <code>gis_osm_water_a_free_1.shp.gz</code>、<code>gis_osm_water_a_free_1.dbf.gz</code> 和 <code>gis_osm_water_a_free_1.shx.gz</code> 必须共享相同的 Amazon S3 目录。COPY 命令需要 GZIP 选项，FROM 子句必须指定正确的压缩文件，如下所示。</p>
            
            <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="复制"><awsui-icon name="copy"></awsui-icon></div></div><code class="sql ">COPY norway_natural FROM 's3://<code class="replaceable">bucket_name</code>/shapefiles/norway/compressed/gis_osm_natural_free_1.shp.gz'
FORMAT SHAPEFILE
GZIP
CREDENTIALS 'aws_iam_role=arn:aws:iam::123456789012:role/MyRoleName';
INFO:  Load into table 'norway_natural' completed, 83891 record(s) loaded successfully.          
</code></pre>
          
         
          
            <h3 id="copy-example-spatial-copy-shapefile-column-order">正在将数据加载到具有不同列顺序的表</h3>
            <p>如果您有一个没有将 <code class="code">GEOMETRY</code> 作为第一列的表，则可以使用列映射将列映射到目标表。例如，创建一个将 <code class="code">osm_id</code> 指定为第一列的表。</p>
            
            <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="复制"><awsui-icon name="copy"></awsui-icon></div></div><code class="sql ">CREATE TABLE norway_natural_order (
   osm_id BIGINT,
   wkb_geometry GEOMETRY,
   code INT,
   fclass VARCHAR,
   name VARCHAR);         
</code></pre>
            <p>然后使用列映射摄取 shapefile。</p>
            <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="复制"><awsui-icon name="copy"></awsui-icon></div></div><code class="sql ">COPY norway_natural_order(wkb_geometry, osm_id, code, fclass, name) 
FROM 's3://<code class="replaceable">bucket_name</code>/shapefiles/norway/gis_osm_natural_free_1.shp'
FORMAT SHAPEFILE
CREDENTIALS 'aws_iam_role=arn:aws:iam::123456789012:role/MyRoleName';
INFO:  Load into table 'norway_natural_order' completed, 83891 record(s) loaded successfully.         
</code></pre>
            
          
         
          
            
            <h3 id="copy-example-spatial-copy-shapefile-geography">将数据加载到具有 geography 列的表中</h3>
            <p>如果某个表具有 <code class="code">GEOGRAPHY</code> 列，请首先提取到 <code class="code">GEOMETRY</code> 列，然后将对象强制转换为 <code class="code">GEOGRAPHY</code> 对象。例如，在将 shapefile 复制到 <code class="code">GEOMETRY</code> 列后，对表进行更改，添加 <code class="code">GEOGRAPHY</code> 数据类型。</p>           
            <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="复制"><awsui-icon name="copy"></awsui-icon></div></div><code class="sql ">ALTER TABLE norway_natural ADD COLUMN wkb_geography GEOGRAPHY;</code></pre>
            
            <p>然后将 geometry 转换为 geography。</p>
            <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="复制"><awsui-icon name="copy"></awsui-icon></div></div><code class="sql ">UPDATE norway_natural SET wkb_geography = wkb_geometry::geography;</code></pre>
            
            <p>（可选）您可以删除 <code class="code">GEOMETRY</code> 列。</p>
            <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="复制"><awsui-icon name="copy"></awsui-icon></div></div><code class="sql ">ALTER TABLE norway_natural DROP COLUMN wkb_geometry;</code></pre>
            
          
         
       
         
         <h2 id="r_COPY_command_examples-load-noload-option">带有 NOLOAD 选项的 COPY 命令</h2>
              
         <p>要在实际加载数据之前验证数据文件，请使用带有 NOLOAD 选项的 COPY 命令。Amazon Redshift 会解析输入文件并显示发生的任何错误。以下示例使用 NOLOAD 选项，实际上并未将任何行加载到表中。</p>
         <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="复制"><awsui-icon name="copy"></awsui-icon></div></div><code class="sql "><code class="userinput">COPY public.zipcode1
FROM 's3://mybucket/mydata/zipcode.csv' 
DELIMITER ';' 
IGNOREHEADER 1 REGION 'us-east-1'
NOLOAD
CREDENTIALS 'aws_iam_role=arn:aws:iam::123456789012:role/myRedshiftRole'</code>;
<code class="computeroutput" copy="false">
Warnings:
Load into table 'zipcode1' completed, 0 record(s) loaded successfully.  
</code>       
         
         </code></pre>
      <awsdocs-copyright class="copyright-print"></awsdocs-copyright><awsdocs-thumb-feedback right-edge="{{$ctrl.thumbFeedbackRightEdge}}"></awsdocs-thumb-feedback></div><noscript><div><div><div><div id="js_error_message"><p><img src="https://d1ge0kk1l5kms0.cloudfront.net/images/G/01/webservices/console/warning.png" alt="警告" /> <strong>Javascript 在您的浏览器中被禁用或不可用。</strong></p><p>要使用 Amazon Web Services 文档，必须启用 Javascript。请参阅浏览器的帮助页面以了解相关说明。</p></div></div></div></div></noscript><div id="main-col-footer" class="awsui-util-font-size-0"><div id="doc-conventions"><a target="_top" href="/general/latest/gr/docconventions.html">文档惯例</a></div><div class="prev-next"><div id="previous" class="prev-link" accesskey="p" href="./automatic-recognition.html">在 DATEFORMAT 和 TIMEFORMAT 中使用自动识别</div><div id="next" class="next-link" accesskey="n" href="./r_CREATE_DATABASE.html">CREATE DATABASE</div></div></div><awsdocs-page-utilities></awsdocs-page-utilities></div><div id="quick-feedback-yes" style="display: none;"><div class="title">此页面对您有帮助吗？- 是</div><div class="content"><p>感谢您对我们工作的肯定！</p><p>如果不耽误您的时间，请告诉我们做得好的地方，让我们做得更好。</p><p><awsui-button id="fblink" rel="noopener noreferrer" target="_blank" text="反馈" click="linkClick($event)" href="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=Redshift&amp;topic_url=https://docs.aws.amazon.com/zh_cn/redshift/latest/dg/r_COPY_command_examples.html"></awsui-button></p></div></div><div id="quick-feedback-no" style="display: none;"><div class="title">此页面对您有帮助吗？- 否</div><div class="content"><p>感谢您告诉我们本页内容还需要完善。很抱歉让您失望了。</p><p>如果不耽误您的时间，请告诉我们如何改进文档。</p><p><awsui-button id="fblink" rel="noopener noreferrer" target="_blank" text="反馈" click="linkClick($event)" href="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=Redshift&amp;topic_url=https://docs.aws.amazon.com/zh_cn/redshift/latest/dg/r_COPY_command_examples.html"></awsui-button></p></div></div></div></body></div></awsdocs-view><div class="page-loading-indicator" id="page-loading-indicator"><awsui-spinner size="large"></awsui-spinner></div></div><div id="tools-panel" dom-region="tools"><awsdocs-tools-panel id="awsdocs-tools-panel"></awsdocs-tools-panel></div></awsui-app-layout><awsdocs-cookie-banner class="doc-cookie-banner"></awsdocs-cookie-banner></div></body></html>