<!DOCTYPE html>
    <html xmlns="http://www.w3.org/1999/xhtml" lang="en-US"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>DECLARE - Amazon Redshift</title><meta name="viewport" content="width=device-width,initial-scale=1" /><meta name="assets_root" content="/assets" /><meta name="target_state" content="declare" /><meta name="default_state" content="declare" /><link rel="icon" type="image/ico" href="/assets/images/favicon.ico" /><link rel="shortcut icon" type="image/ico" href="/assets/images/favicon.ico" /><link rel="canonical" href="https://docs.aws.amazon.com/redshift/latest/dg/declare.html" /><meta name="description" content="Defines a new cursor within a transaction block. Use a cursor to retrieve a few rows at a time from the result set of a larger query." /><meta name="deployment_region" content="IAD" /><meta name="product" content="Amazon Redshift" /><meta name="guide" content="Database Developer Guide" /><meta name="abstract" content="Create and manage a data warehouse with Amazon Redshift, an enterprise-level, petabyte scale, fully managed data warehousing service." /><meta name="guide-locale" content="en_us" /><meta name="tocs" content="toc-contents.json" /><link rel="canonical" href="https://docs.aws.amazon.com/redshift/latest/dg/declare.html" /><link rel="alternative" href="https://docs.aws.amazon.com/id_id/redshift/latest/dg/declare.html" hreflang="id-id" /><link rel="alternative" href="https://docs.aws.amazon.com/id_id/redshift/latest/dg/declare.html" hreflang="id" /><link rel="alternative" href="https://docs.aws.amazon.com/de_de/redshift/latest/dg/declare.html" hreflang="de-de" /><link rel="alternative" href="https://docs.aws.amazon.com/de_de/redshift/latest/dg/declare.html" hreflang="de" /><link rel="alternative" href="https://docs.aws.amazon.com/redshift/latest/dg/declare.html" hreflang="en-us" /><link rel="alternative" href="https://docs.aws.amazon.com/redshift/latest/dg/declare.html" hreflang="en" /><link rel="alternative" href="https://docs.aws.amazon.com/es_es/redshift/latest/dg/declare.html" hreflang="es-es" /><link rel="alternative" href="https://docs.aws.amazon.com/es_es/redshift/latest/dg/declare.html" hreflang="es" /><link rel="alternative" href="https://docs.aws.amazon.com/fr_fr/redshift/latest/dg/declare.html" hreflang="fr-fr" /><link rel="alternative" href="https://docs.aws.amazon.com/fr_fr/redshift/latest/dg/declare.html" hreflang="fr" /><link rel="alternative" href="https://docs.aws.amazon.com/it_it/redshift/latest/dg/declare.html" hreflang="it-it" /><link rel="alternative" href="https://docs.aws.amazon.com/it_it/redshift/latest/dg/declare.html" hreflang="it" /><link rel="alternative" href="https://docs.aws.amazon.com/ja_jp/redshift/latest/dg/declare.html" hreflang="ja-jp" /><link rel="alternative" href="https://docs.aws.amazon.com/ja_jp/redshift/latest/dg/declare.html" hreflang="ja" /><link rel="alternative" href="https://docs.aws.amazon.com/ko_kr/redshift/latest/dg/declare.html" hreflang="ko-kr" /><link rel="alternative" href="https://docs.aws.amazon.com/ko_kr/redshift/latest/dg/declare.html" hreflang="ko" /><link rel="alternative" href="https://docs.aws.amazon.com/pt_br/redshift/latest/dg/declare.html" hreflang="pt-br" /><link rel="alternative" href="https://docs.aws.amazon.com/pt_br/redshift/latest/dg/declare.html" hreflang="pt" /><link rel="alternative" href="https://docs.aws.amazon.com/zh_cn/redshift/latest/dg/declare.html" hreflang="zh-cn" /><link rel="alternative" href="https://docs.aws.amazon.com/zh_tw/redshift/latest/dg/declare.html" hreflang="zh-tw" /><link rel="alternative" href="https://docs.aws.amazon.com/redshift/latest/dg/declare.html" hreflang="x-default" /><meta name="feedback-item" content="Redshift" /><meta name="this_doc_product" content="Amazon Redshift" /><meta name="this_doc_guide" content="Database Developer Guide" /><script defer="" src="/assets/r/vendor4.js?version=2021.12.02"></script><script defer="" src="/assets/r/vendor3.js?version=2021.12.02"></script><script defer="" src="/assets/r/vendor1.js?version=2021.12.02"></script><script defer="" src="/assets/r/awsdocs-common.js?version=2021.12.02"></script><script defer="" src="/assets/r/awsdocs-doc-page.js?version=2021.12.02"></script><link href="/assets/r/vendor4.css?version=2021.12.02" rel="stylesheet" /><link href="/assets/r/awsdocs-common.css?version=2021.12.02" rel="stylesheet" /><link href="/assets/r/awsdocs-doc-page.css?version=2021.12.02" rel="stylesheet" /><script async="" id="awsc-panorama-bundle" type="text/javascript" src="https://prod.pa.cdn.uis.awsstatic.com/panorama-nav-init.js" data-config="{'appEntity':'aws-documentation','region':'us-east-1','service':'redshift'}"></script><meta id="panorama-serviceSubSection" value="Database Developer Guide" /><meta id="panorama-serviceConsolePage" value="DECLARE" /></head><body class="awsdocs awsui"><div class="awsdocs-container"><awsdocs-header></awsdocs-header><awsui-app-layout id="app-layout" class="awsui-util-no-gutters" ng-controller="ContentController as $ctrl" header-selector="awsdocs-header" navigation-hide="false" navigation-width="$ctrl.navWidth" navigation-open="$ctrl.navOpen" navigation-change="$ctrl.onNavChange($event)" tools-hide="$ctrl.hideTools" tools-width="$ctrl.toolsWidth" tools-open="$ctrl.toolsOpen" tools-change="$ctrl.onToolsChange($event)"><div id="guide-toc" dom-region="navigation"><awsdocs-toc></awsdocs-toc></div><div id="main-column" dom-region="content" tabindex="-1"><awsdocs-view class="awsdocs-view"><div id="awsdocs-content"><head><title>DECLARE - Amazon Redshift</title><meta name="pdf" content="/pdfs/redshift/latest/dg/redshift-dg.pdf#declare" /><meta name="rss" content="Dochistory.rss" /><meta name="forums" content="http://forums.aws.amazon.com/forum.jspa?forumID=155" /><meta name="feedback" content="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=Redshift&amp;topic_url=https://docs.aws.amazon.com/en_us/redshift/latest/dg/declare.html" /><meta name="feedback-yes" content="feedbackyes.html?topic_url=https://docs.aws.amazon.com/en_us/redshift/latest/dg/declare.html" /><meta name="feedback-no" content="feedbackno.html?topic_url=https://docs.aws.amazon.com/en_us/redshift/latest/dg/declare.html" /><meta name="keywords" content="Amazon Redshift,AWS Redshift,Redshift,Redshift Spectrum,cluster,data warehouse,developer,sample data,database,database developer,HLL" /><script type="application/ld+json">
{
    "@context" : "https://schema.org",
    "@type" : "BreadcrumbList",
    "itemListElement" : [
      {
        "@type" : "ListItem",
        "position" : 1,
        "name" : "AWS",
        "item" : "https://aws.amazon.com"
      },
      {
        "@type" : "ListItem",
        "position" : 2,
        "name" : "Amazon Redshift",
        "item" : "https://docs.aws.amazon.com/redshift/index.html"
      },
      {
        "@type" : "ListItem",
        "position" : 3,
        "name" : "Database Developer Guide",
        "item" : "https://docs.aws.amazon.com/redshift/latest/dg"
      },
      {
        "@type" : "ListItem",
        "position" : 4,
        "name" : "SQL reference",
        "item" : "https://docs.aws.amazon.com/redshift/latest/dg/cm_chap_SQLCommandRef.html"
      },
      {
        "@type" : "ListItem",
        "position" : 5,
        "name" : "SQL commands",
        "item" : "https://docs.aws.amazon.com/redshift/latest/dg/c_SQL_commands.html"
      },
      {
        "@type" : "ListItem",
        "position" : 6,
        "name" : "DECLARE",
        "item" : "https://docs.aws.amazon.com/redshift/latest/dg/c_SQL_commands.html"
      }
    ]
}
</script></head><body><div id="main"><div style="display: none"><a href="/pdfs/redshift/latest/dg/redshift-dg.pdf#declare" target="_blank" rel="noopener noreferrer" title="Open PDF"></a></div><div id="breadcrumbs" class="breadcrumb"><a href="https://aws.amazon.com">AWS</a><a href="/index.html">Documentation</a><a href="/redshift/index.html">Amazon Redshift</a><a href="welcome.html">Database Developer Guide</a></div><div id="page-toc-src"><a href="#declare-synopsis">Syntax</a><a href="#declare-parameters">Parameters</a><a href="#declare-usage">Usage Notes</a><a href="#declare-constraints">Cursor constraints</a><a href="#declare-performance">Performance considerations when using
               cursors</a><a href="#declare-example">DECLARE CURSOR examples</a></div><div id="main-content" class="awsui-util-container"><div id="main-col-body"><awsdocs-language-banner data-service="$ctrl.pageService"></awsdocs-language-banner><h1 class="topictitle" id="declare">DECLARE</h1><div class="awsdocs-page-header-container"><awsdocs-page-header></awsdocs-page-header><awsdocs-filter-selector id="awsdocs-filter-selector"></awsdocs-filter-selector></div><p>Defines a new cursor. Use a cursor to retrieve a few rows at a time from the result set
         of a larger query. </p><p>When the first row of a cursor is fetched, the entire result set is materialized on the
         leader node, in memory or on disk, if needed. Because of the potential negative performance
         impact of using cursors with large result sets, we recommend using alternative approaches
         whenever possible. For more information, see <a href="#declare-performance">Performance considerations when using
               cursors</a>.</p><p>You must declare a cursor within a transaction block. Only one cursor at a time can be
         open per session. </p><p>For more information, see <a href="./fetch.html">FETCH</a>, <a href="./close.html">CLOSE</a>.</p>
         <h2 id="declare-synopsis">Syntax</h2>
         <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="nohighlight">DECLARE <em>cursor_name</em> CURSOR FOR <em>query</em></code></pre>
       
         <h2 id="declare-parameters">Parameters</h2>
         <div class="variablelist">
             
             
         <dl>
               <dt><span class="term"><em>cursor_name</em>
               </span></dt>
               <dd>
                  <p>Name of the new cursor. </p>
               </dd>
             
               <dt><span class="term">
                  <em>query</em>
               </span></dt>
               <dd>
                  <p>A SELECT statement that populates the cursor.</p>
               </dd>
            </dl></div>
       
         <h2 id="declare-usage">DECLARE CURSOR usage notes</h2>
         <p>If your client application uses an ODBC connection and your query creates a result
            set that is too large to fit in memory, you can stream the result set to your client
            application by using a cursor. When you use a cursor, the entire result set is
            materialized on the leader node, and then your client can fetch the results
            incrementally. </p>
         <div class="awsdocs-note"><div class="awsdocs-note-title"><awsui-icon name="status-info" variant="link"></awsui-icon><h6>Note</h6></div><div class="awsdocs-note-text"><p>To enable cursors in ODBC for Microsoft Windows, enable the <b>Use
                  Declare/Fetch</b> option in the ODBC DSN you use for Amazon Redshift. We recommend
               setting the ODBC cache size, using the <b>Cache Size</b> field in the
               ODBC DSN options dialog, to 4,000 or greater on multi-node clusters to minimize round
               trips. On a single-node cluster, set Cache Size to 1,000.</p></div></div>
         <p>Because of the potential negative performance impact of using cursors, we recommend
            using alternative approaches whenever possible. For more information, see <a href="#declare-performance">Performance considerations when using
               cursors</a>.</p>
         <p>Amazon Redshift cursors are supported with the following limitations:</p>
         <div class="itemizedlist">
             
             
             
         <ul class="itemizedlist"><li class="listitem">
               <p>Only one cursor at a time can be open per session. </p>
            </li><li class="listitem">
               <p>Cursors must be used within a transaction (BEGIN … END). </p>
            </li><li class="listitem">
               <p>The maximum cumulative result set size for all cursors is constrained based on
                  the cluster node type. If you need larger result sets, you can resize to an XL or
                  8XL node configuration.</p>
               <p>For more information, see <a href="#declare-constraints">Cursor constraints</a>. </p>
            </li></ul></div>
       
         <h2 id="declare-constraints">Cursor constraints</h2>
         <p>When the first row of a cursor is fetched, the entire result set is materialized on
            the leader node. If the result set doesn't fit in memory, it is written to disk as
            needed. To protect the integrity of the leader node, Amazon Redshift enforces constraints on
            the size of all cursor result sets, based on the cluster's node type.</p>
         <p>The following table shows the maximum total result set size for each cluster node
            type. Maximum result set sizes are in megabytes.</p>
         <div class="table-container"><div class="table-contents"><table id="w323aac67c10d169c17b7"><thead>
                  <tr>
                     <th>Node type</th>
                     <th>Maximum result set per cluster (MB)</th>
                  </tr>
               </thead>
                  <tr>
                     <td tabindex="-1">
                        <p> DS1 or DS2 XL single node </p>
                     </td>
                     <td tabindex="-1">
                        <p> 64000 </p>
                     </td>
                  </tr>
                  <tr>
                     <td tabindex="-1">
                        <p> DS1 or DS2 XL multiple nodes </p>
                     </td>
                     <td tabindex="-1">
                        <p> 1800000 </p>
                     </td>
                  </tr>
                  <tr>
                     <td tabindex="-1">
                        <p> DS1 or DS2 8XL multiple nodes </p>
                     </td>
                     <td tabindex="-1">
                        <p> 14400000 </p>
                     </td>
                  </tr>
                  <tr>
                     <td tabindex="-1">
                        <p> RA3 16XL multiple nodes </p>
                     </td>
                     <td tabindex="-1">
                        <p> 14400000 </p>
                     </td>
                  </tr>
                  <tr>
                     <td tabindex="-1">
                        <p>
                           DC1 Large single node </p>
                     </td>
                     <td tabindex="-1">
                        <p> 16000 </p>
                     </td>
                  </tr>
                  <tr>
                     <td tabindex="-1">
                        <p>
                           DC1 Large multiple nodes </p>
                     </td>
                     <td tabindex="-1">
                        <p> 384000 </p>
                     </td>
                  </tr>
                  <tr>
                     <td tabindex="-1">
                        <p> DC1 8XL multiple nodes </p>
                     </td>
                     <td tabindex="-1">
                        <p> 3000000 </p>
                     </td>
                  </tr>
                  <tr>
                     <td tabindex="-1">
                        <p>
                           DC2 Large single node </p>
                     </td>
                     <td tabindex="-1">
                        <p> 8000 </p>
                     </td>
                  </tr>
                  <tr>
                     <td tabindex="-1">
                        <p>
                           DC2 Large multiple nodes </p>
                     </td>
                     <td tabindex="-1">
                        <p> 192000 </p>
                     </td>
                  </tr>
                  <tr>
                     <td tabindex="-1">
                        <p> DC2 8XL multiple nodes </p>
                     </td>
                     <td tabindex="-1">
                        <p> 3200000 </p>
                     </td>
                  </tr>
                  <tr>
                     <td tabindex="-1">
                        <p> RA3 4XL multiple nodes </p>
                     </td>
                     <td tabindex="-1">
                        <p> 3200000 </p>
                     </td>
                  </tr>
                  
                  <tr>
                     <td tabindex="-1">
                        <p> RA3 XLPLUS multiple nodes </p>
                     </td>
                     <td tabindex="-1">
                        <p> 1000000</p>
                     </td>
                  </tr>
                  
                  <tr>
                     <td tabindex="-1">
                        <p> RA3 XLPLUS single node </p>
                     </td>
                     <td tabindex="-1">
                        <p> 64000 </p>
                     </td>
                  </tr>
                  
                     <tr>
                            <td tabindex="-1"><p>Amazon Redshift Serverless</p></td>
                            <td tabindex="-1"><p>150000</p></td>
                        </tr>
               </table></div></div>
         <p>To view the active cursor configuration for a cluster, query the <a href="./r_STV_CURSOR_CONFIGURATION.html">STV_CURSOR_CONFIGURATION</a>
            system table as a superuser. To view the state of active cursors, query the <a href="./r_STV_ACTIVE_CURSORS.html">STV_ACTIVE_CURSORS</a> system table.
            Only the rows for a user's own cursors are visible to the user, but a superuser can
            view all cursors.</p>

       
         <h2 id="declare-performance">Performance considerations when using
               cursors</h2>
         <p>Because cursors materialize the entire result set on the leader node before beginning
            to return results to the client, using cursors with very large result sets can have a
            negative impact on performance. We strongly recommend against using cursors with very
            large result sets. In some cases, such as when your application uses an ODBC connection,
            cursors might be the only feasible solution. If possible, we recommend using these
            alternatives:</p>
         <div class="itemizedlist">
             
             
         <ul class="itemizedlist"><li class="listitem">
               <p>Use <a href="./r_UNLOAD.html">UNLOAD</a> to export a large
                  table. When you use UNLOAD, the compute nodes work in parallel to transfer the
                  data directly to data files on Amazon Simple Storage Service. For more information, see <a href="./c_unloading_data.html">Unloading data</a>. </p>
            </li><li class="listitem">
               <p>Set the JDBC fetch size parameter in your client application. If you use a JDBC
                  connection and you are encountering client-side out-of-memory errors, you can
                  enable your client to retrieve result sets in smaller batches by setting the JDBC
                  fetch size parameter. For more information, see <a href="./queries-troubleshooting.html#set-the-JDBC-fetch-size-parameter">Setting the JDBC fetch size parameter</a>. </p>
            </li></ul></div>
       
         <h2 id="declare-example">DECLARE CURSOR examples</h2>
         <p>The following example declares a cursor named LOLLAPALOOZA to select sales
            information for the Lollapalooza event, and then fetches rows from the result set using
            the cursor:</p>
         <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="">-- Begin a transaction

begin;

-- Declare a cursor

declare lollapalooza cursor for
select eventname, starttime, pricepaid/qtysold as costperticket, qtysold
from sales, event
where sales.eventid = event.eventid
and eventname='Lollapalooza';

-- Fetch the first 5 rows in the cursor lollapalooza:

fetch forward 5 from lollapalooza;

  eventname   |      starttime      | costperticket | qtysold
--------------+---------------------+---------------+---------
 Lollapalooza | 2008-05-01 19:00:00 |   92.00000000 |       3
 Lollapalooza | 2008-11-15 15:00:00 |  222.00000000 |       2
 Lollapalooza | 2008-04-17 15:00:00 |  239.00000000 |       3
 Lollapalooza | 2008-04-17 15:00:00 |  239.00000000 |       4
 Lollapalooza | 2008-04-17 15:00:00 |  239.00000000 |       1
(5 rows)

-- Fetch the next row:

fetch next from lollapalooza;

  eventname   |      starttime      | costperticket | qtysold
--------------+---------------------+---------------+---------
 Lollapalooza | 2008-10-06 14:00:00 |  114.00000000 |       2

-- Close the cursor and end the transaction:

close lollapalooza;
commit;
</code></pre>
         <p>The following example loops over a refcursor with all the results from a table:</p>
         <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="">CREATE TABLE tbl_1 (a int, b int);
INSERT INTO tbl_1 values (1, 2),(3, 4);

CREATE OR REPLACE PROCEDURE sp_cursor_loop() AS $$
DECLARE
    target record;
    curs1 cursor for select * from tbl_1;
BEGIN
    OPEN curs1;
    LOOP
        fetch curs1 into target;
        exit when not found;
        RAISE INFO 'a %', target.a;
    END LOOP;
    CLOSE curs1;
END;
$$ LANGUAGE plpgsql;

CALL sp_cursor_loop();
         
SELECT message 
   from svl_stored_proc_messages 
   where querytxt like 'CALL sp_cursor_loop()%';
         
  message
----------
      a 1
      a 3</code></pre>
      <awsdocs-copyright class="copyright-print"></awsdocs-copyright><awsdocs-thumb-feedback right-edge="{{$ctrl.thumbFeedbackRightEdge}}"></awsdocs-thumb-feedback></div><noscript><div><div><div><div id="js_error_message"><p><img src="https://d1ge0kk1l5kms0.cloudfront.net/images/G/01/webservices/console/warning.png" alt="Warning" /> <strong>Javascript is disabled or is unavailable in your browser.</strong></p><p>To use the Amazon Web Services Documentation, Javascript must be enabled. Please refer to your browser's Help pages for instructions.</p></div></div></div></div></noscript><div id="main-col-footer" class="awsui-util-font-size-0"><div id="doc-conventions"><a target="_top" href="/general/latest/gr/docconventions.html">Document Conventions</a></div><div class="prev-next"><div id="previous" class="prev-link" accesskey="p" href="./r_DEALLOCATE.html">DEALLOCATE</div><div id="next" class="next-link" accesskey="n" href="./r_DELETE.html">DELETE</div></div></div><awsdocs-page-utilities></awsdocs-page-utilities></div><div id="quick-feedback-yes" style="display: none;"><div class="title">Did this page help you? - Yes</div><div class="content"><p>Thanks for letting us know we're doing a good job!</p><p>If you've got a moment, please tell us what we did right so we can do more of it.</p><p><awsui-button id="fblink" rel="noopener noreferrer" target="_blank" text="Feedback" click="linkClick($event)" href="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=Redshift&amp;topic_url=https://docs.aws.amazon.com/en_us/redshift/latest/dg/declare.html"></awsui-button></p></div></div><div id="quick-feedback-no" style="display: none;"><div class="title">Did this page help you? - No</div><div class="content"><p>Thanks for letting us know this page needs work. We're sorry we let you down.</p><p>If you've got a moment, please tell us how we can make the documentation better.</p><p><awsui-button id="fblink" rel="noopener noreferrer" target="_blank" text="Feedback" click="linkClick($event)" href="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=Redshift&amp;topic_url=https://docs.aws.amazon.com/en_us/redshift/latest/dg/declare.html"></awsui-button></p></div></div></div></body></div></awsdocs-view><div class="page-loading-indicator" id="page-loading-indicator"><awsui-spinner size="large"></awsui-spinner></div></div><div id="tools-panel" dom-region="tools"><awsdocs-tools-panel id="awsdocs-tools-panel"></awsdocs-tools-panel></div></awsui-app-layout><awsdocs-cookie-banner class="doc-cookie-banner"></awsdocs-cookie-banner></div></body></html>