<!DOCTYPE html>
    <html xmlns="http://www.w3.org/1999/xhtml" lang="en-US"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Tutorial: Using spatial SQL functions with Amazon Redshift - Amazon Redshift</title><meta name="viewport" content="width=device-width,initial-scale=1" /><meta name="assets_root" content="/assets" /><meta name="target_state" content="spatial-tutorial" /><meta name="default_state" content="spatial-tutorial" /><link rel="icon" type="image/ico" href="/assets/images/favicon.ico" /><link rel="shortcut icon" type="image/ico" href="/assets/images/favicon.ico" /><link rel="canonical" href="https://docs.aws.amazon.com/redshift/latest/dg/spatial-tutorial.html" /><meta name="description" content="Use this tutorial to learn about how to use spatial SQL functions with Amazon Redshift." /><meta name="deployment_region" content="IAD" /><meta name="product" content="Amazon Redshift" /><meta name="guide" content="Database Developer Guide" /><meta name="abstract" content="Create and manage a data warehouse with Amazon Redshift, an enterprise-level, petabyte scale, fully managed data warehousing service." /><meta name="guide-locale" content="en_us" /><meta name="tocs" content="toc-contents.json" /><link rel="canonical" href="https://docs.aws.amazon.com/redshift/latest/dg/spatial-tutorial.html" /><link rel="alternative" href="https://docs.aws.amazon.com/id_id/redshift/latest/dg/spatial-tutorial.html" hreflang="id-id" /><link rel="alternative" href="https://docs.aws.amazon.com/id_id/redshift/latest/dg/spatial-tutorial.html" hreflang="id" /><link rel="alternative" href="https://docs.aws.amazon.com/de_de/redshift/latest/dg/spatial-tutorial.html" hreflang="de-de" /><link rel="alternative" href="https://docs.aws.amazon.com/de_de/redshift/latest/dg/spatial-tutorial.html" hreflang="de" /><link rel="alternative" href="https://docs.aws.amazon.com/redshift/latest/dg/spatial-tutorial.html" hreflang="en-us" /><link rel="alternative" href="https://docs.aws.amazon.com/redshift/latest/dg/spatial-tutorial.html" hreflang="en" /><link rel="alternative" href="https://docs.aws.amazon.com/es_es/redshift/latest/dg/spatial-tutorial.html" hreflang="es-es" /><link rel="alternative" href="https://docs.aws.amazon.com/es_es/redshift/latest/dg/spatial-tutorial.html" hreflang="es" /><link rel="alternative" href="https://docs.aws.amazon.com/fr_fr/redshift/latest/dg/spatial-tutorial.html" hreflang="fr-fr" /><link rel="alternative" href="https://docs.aws.amazon.com/fr_fr/redshift/latest/dg/spatial-tutorial.html" hreflang="fr" /><link rel="alternative" href="https://docs.aws.amazon.com/it_it/redshift/latest/dg/spatial-tutorial.html" hreflang="it-it" /><link rel="alternative" href="https://docs.aws.amazon.com/it_it/redshift/latest/dg/spatial-tutorial.html" hreflang="it" /><link rel="alternative" href="https://docs.aws.amazon.com/ja_jp/redshift/latest/dg/spatial-tutorial.html" hreflang="ja-jp" /><link rel="alternative" href="https://docs.aws.amazon.com/ja_jp/redshift/latest/dg/spatial-tutorial.html" hreflang="ja" /><link rel="alternative" href="https://docs.aws.amazon.com/ko_kr/redshift/latest/dg/spatial-tutorial.html" hreflang="ko-kr" /><link rel="alternative" href="https://docs.aws.amazon.com/ko_kr/redshift/latest/dg/spatial-tutorial.html" hreflang="ko" /><link rel="alternative" href="https://docs.aws.amazon.com/pt_br/redshift/latest/dg/spatial-tutorial.html" hreflang="pt-br" /><link rel="alternative" href="https://docs.aws.amazon.com/pt_br/redshift/latest/dg/spatial-tutorial.html" hreflang="pt" /><link rel="alternative" href="https://docs.aws.amazon.com/zh_cn/redshift/latest/dg/spatial-tutorial.html" hreflang="zh-cn" /><link rel="alternative" href="https://docs.aws.amazon.com/zh_tw/redshift/latest/dg/spatial-tutorial.html" hreflang="zh-tw" /><link rel="alternative" href="https://docs.aws.amazon.com/redshift/latest/dg/spatial-tutorial.html" hreflang="x-default" /><meta name="feedback-item" content="Redshift" /><meta name="this_doc_product" content="Amazon Redshift" /><meta name="this_doc_guide" content="Database Developer Guide" /><script defer="" src="/assets/r/vendor4.js?version=2021.12.02"></script><script defer="" src="/assets/r/vendor3.js?version=2021.12.02"></script><script defer="" src="/assets/r/vendor1.js?version=2021.12.02"></script><script defer="" src="/assets/r/awsdocs-common.js?version=2021.12.02"></script><script defer="" src="/assets/r/awsdocs-doc-page.js?version=2021.12.02"></script><link href="/assets/r/vendor4.css?version=2021.12.02" rel="stylesheet" /><link href="/assets/r/awsdocs-common.css?version=2021.12.02" rel="stylesheet" /><link href="/assets/r/awsdocs-doc-page.css?version=2021.12.02" rel="stylesheet" /><script async="" id="awsc-panorama-bundle" type="text/javascript" src="https://prod.pa.cdn.uis.awsstatic.com/panorama-nav-init.js" data-config="{'appEntity':'aws-documentation','region':'us-east-1','service':'redshift'}"></script><meta id="panorama-serviceSubSection" value="Database Developer Guide" /><meta id="panorama-serviceConsolePage" value="Tutorial: Using spatial SQL functions with Amazon Redshift" /></head><body class="awsdocs awsui"><div class="awsdocs-container"><awsdocs-header></awsdocs-header><awsui-app-layout id="app-layout" class="awsui-util-no-gutters" ng-controller="ContentController as $ctrl" header-selector="awsdocs-header" navigation-hide="false" navigation-width="$ctrl.navWidth" navigation-open="$ctrl.navOpen" navigation-change="$ctrl.onNavChange($event)" tools-hide="$ctrl.hideTools" tools-width="$ctrl.toolsWidth" tools-open="$ctrl.toolsOpen" tools-change="$ctrl.onToolsChange($event)"><div id="guide-toc" dom-region="navigation"><awsdocs-toc></awsdocs-toc></div><div id="main-column" dom-region="content" tabindex="-1"><awsdocs-view class="awsdocs-view"><div id="awsdocs-content"><head><title>Tutorial: Using spatial SQL functions with Amazon Redshift - Amazon Redshift</title><meta name="pdf" content="/pdfs/redshift/latest/dg/redshift-dg.pdf#spatial-tutorial" /><meta name="rss" content="Dochistory.rss" /><meta name="forums" content="http://forums.aws.amazon.com/forum.jspa?forumID=155" /><meta name="feedback" content="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=Redshift&amp;topic_url=https://docs.aws.amazon.com/en_us/redshift/latest/dg/spatial-tutorial.html" /><meta name="feedback-yes" content="feedbackyes.html?topic_url=https://docs.aws.amazon.com/en_us/redshift/latest/dg/spatial-tutorial.html" /><meta name="feedback-no" content="feedbackno.html?topic_url=https://docs.aws.amazon.com/en_us/redshift/latest/dg/spatial-tutorial.html" /><meta name="keywords" content="Amazon Redshift,AWS Redshift,Redshift,Redshift Spectrum,cluster,data warehouse,developer,sample data,database,database developer,HLL" /><script type="application/ld+json">
{
    "@context" : "https://schema.org",
    "@type" : "BreadcrumbList",
    "itemListElement" : [
      {
        "@type" : "ListItem",
        "position" : 1,
        "name" : "AWS",
        "item" : "https://aws.amazon.com"
      },
      {
        "@type" : "ListItem",
        "position" : 2,
        "name" : "Amazon Redshift",
        "item" : "https://docs.aws.amazon.com/redshift/index.html"
      },
      {
        "@type" : "ListItem",
        "position" : 3,
        "name" : "Database Developer Guide",
        "item" : "https://docs.aws.amazon.com/redshift/latest/dg"
      },
      {
        "@type" : "ListItem",
        "position" : 4,
        "name" : "Querying spatial data in Amazon Redshift",
        "item" : "https://docs.aws.amazon.com/redshift/latest/dg/geospatial-overview.html"
      },
      {
        "@type" : "ListItem",
        "position" : 5,
        "name" : "Tutorial: Using spatial SQL functions with Amazon Redshift",
        "item" : "https://docs.aws.amazon.com/redshift/latest/dg/geospatial-overview.html"
      }
    ]
}
</script></head><body><div id="main"><div style="display: none"><a href="/pdfs/redshift/latest/dg/redshift-dg.pdf#spatial-tutorial" target="_blank" rel="noopener noreferrer" title="Open PDF"></a></div><div id="breadcrumbs" class="breadcrumb"><a href="https://aws.amazon.com">AWS</a><a href="/index.html">Documentation</a><a href="/redshift/index.html">Amazon Redshift</a><a href="welcome.html">Database Developer Guide</a></div><div id="page-toc-src"><a href="#spatial-tutorial-prerequisites">Prerequisites</a><a href="#spatial-tutorial-test-data">Step 1: Create tables and load test data</a><a href="#spatial-tutorial-query">Step 2: Query spatial data</a><a href="#spatial-tutorial-clean-up">Step 3: Clean up your resources</a></div><div id="main-content" class="awsui-util-container"><div id="main-col-body"><awsdocs-language-banner data-service="$ctrl.pageService"></awsdocs-language-banner><h1 class="topictitle" id="spatial-tutorial">Tutorial: Using spatial SQL functions with Amazon Redshift</h1><div class="awsdocs-page-header-container"><awsdocs-page-header></awsdocs-page-header><awsdocs-filter-selector id="awsdocs-filter-selector"></awsdocs-filter-selector></div><p>This tutorial demonstrates how to use some of the spatial SQL functions with Amazon Redshift. </p><p>To do this, you query two tables using spatial SQL functions. The tutorial uses data from
        public datasets that correlate location data of rental accommodations with postal codes in
        Berlin, Germany. </p><div class="highlights" id="inline-topiclist"><h6>Topics</h6><ul><li><a href="#spatial-tutorial-prerequisites">Prerequisites</a></li><li><a href="#spatial-tutorial-test-data">Step 1: Create tables and load test data</a></li><li><a href="#spatial-tutorial-query">Step 2: Query spatial data</a></li><li><a href="#spatial-tutorial-clean-up">Step 3: Clean up your resources</a></li></ul></div>
        <h2 id="spatial-tutorial-prerequisites">Prerequisites</h2>
           
        <p>For this tutorial, you need the following resources:</p>
           
        <div class="itemizedlist">
             
             
             
             
             
        <ul class="itemizedlist"><li class="listitem">
                        <p>An existing Amazon Redshift cluster and database that you can access and update.
                    In the existing cluster, you create tables, load sample data, and run SQL
                    queries to demonstrate spatial functions. Your cluster should have at least two
                    nodes. To learn how to create a cluster, follow the steps in <a href="https://docs.aws.amazon.com/redshift/latest/gsg/">Amazon Redshift Getting Started Guide</a>. </p>
            </li><li class="listitem">
                        <p>To use the Amazon Redshift query editor, make sure that your cluster is in an AWS
                    Region that supports the query editor. For more information, see <a href="https://docs.aws.amazon.com/redshift/latest/mgmt/query-editor.html">Querying a database using the query
                        editor</a> in the <em>Amazon Redshift Management Guide</em>. </p>
            </li><li class="listitem">
                        <p>AWS credentials for your Amazon Redshift cluster that allow it to load test data
                    from Amazon S3. For information about how to access other AWS services like Amazon S3, see
                            <a href="https://docs.aws.amazon.com/redshift/latest/mgmt/authorizing-redshift-service.html">
                                Authorizing Amazon Redshift to access AWS services</a>.</p>
            </li><li class="listitem">
                        <p>The AWS Identity and Access Management (IAM) role named <code class="code">mySpatialDemoRole</code>, which
                    has the managed policy <code class="code">AmazonS3ReadOnlyAccess</code> attached to read Amazon S3
                    data. To create a role with permission to load data from an Amazon S3 bucket, see
                        <a href="https://docs.aws.amazon.com/redshift/latest/mgmt/copy-unload-iam-role.html">Authorizing COPY,
                        UNLOAD, and CREATE EXTERNAL SCHEMA operations using IAM roles</a> in the
                        <em>Amazon Redshift Management Guide</em>. </p>
            </li><li class="listitem"><p>After you create the IAM role <code class="code">mySpatialDemoRole</code>, that role needs an association
                    with your Amazon Redshift cluster. For more information on how to create that association,
                    see <a href="https://docs.aws.amazon.com/redshift/latest/mgmt/copy-unload-iam-role.html">Authorizing COPY,
                        UNLOAD, and CREATE EXTERNAL SCHEMA operations using IAM roles</a> in the
                        <em>Amazon Redshift Management Guide</em>. </p>    
            </li></ul></div>   

        
        <h2 id="spatial-tutorial-test-data">Step 1: Create tables and load test data</h2>
            
            
             
            <p>The source data used by this tutorial is in files named
                <code>accommodations.csv</code> and <code>zipcodes.csv</code>. </p>
        <p>The <code>accommodations.csv</code> file is open-source data from
            insideairbnb.com. The <code>zipcodes.csv</code> file provides postal codes that
            are open-source data from the national statistics institute of Berlin-Brandenburg in
            Germany (Amt für Statistik Berlin-Brandenburg). Both data sources are provided under a
            Creative Commons license. The data is limited to the Berlin, Germany, region. These
            files are located in an Amazon S3 public bucket to use with this tutorial. </p>
            
            <p>You can optionally download the source data from the following Amazon S3 links:</p> 
            <div class="itemizedlist">
                 
                 
            <ul class="itemizedlist"><li class="listitem"><p><a href="https://s3.amazonaws.com/redshift-downloads/spatial-data/accommodations.csv" rel="noopener noreferrer" target="_blank"><span>
                    Source data for the <code class="code">accommodations</code> table</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a>.  
                    </p></li><li class="listitem"><p><a href="https://s3.amazonaws.com/redshift-downloads/spatial-data/zipcode.csv" rel="noopener noreferrer" target="_blank"><span>
                    Source data for the <code class="code">zipcode</code> table</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a>. 
                    </p></li></ul></div>
            
           <p>Use the following procedure to create tables and load test data. </p>

            <div class="procedure"><h6>To create tables and load test data</h6><ol><li>
                    <p>Open the Amazon Redshift query editor. For more information on working with the query
                    editor, see <a href="https://docs.aws.amazon.com/redshift/latest/mgmt/query-editor.html">Querying a database
                        using the query editor</a> in the <em>Amazon Redshift Management Guide</em>. </p> 
                </li><li>
                    <p>Drop any tables used by this tutorial if they already exist in your database. For more
                        information, see <a href="#spatial-tutorial-clean-up">Step 3: Clean up your resources</a>. </p>
                </li><li>
                    <p>Create the <code class="code">accommodations</code> table to store each accommodation's geographical
                    location (longitude and latitude), the name of the listing, and other business
                    data. </p>
                <p>This tutorial explores room rentals in Berlin, Germany. The <code class="code">shape</code>
                    column stores geographic points of the location of accommodations. The other
                    columns contain information about the rental. </p>
                    <p>To create the <code class="code">accommodations</code> table, run the following SQL
                    statement in the Amazon Redshift query editor. </p>
                    <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="sql ">CREATE TABLE public.accommodations (
  id INTEGER PRIMARY KEY,
  shape GEOMETRY,
  name VARCHAR(100),
  host_name VARCHAR(100),
  neighbourhood_group VARCHAR(100),
  neighbourhood VARCHAR(100),
  room_type VARCHAR(100),
  price SMALLINT,
  minimum_nights SMALLINT,
  number_of_reviews SMALLINT,
  last_review DATE,
  reviews_per_month NUMERIC(8,2),
  calculated_host_listings_count SMALLINT, 
  availability_365 SMALLINT
);</code></pre>
               </li><li>
                    <p>Create the <code class="code">zipcode</code> table in the query editor to store Berlin
                    postal codes. </p>
                <p>A <em>postal code</em> is defined as a polygon in
                    the <code class="code">wkb_geometry</code> column. The rest of the columns describe
                    additional spatial metadata about the postal code. </p>
                <p>To create the <code class="code">zipcode</code> table, run the following SQL statement in
                    the Amazon Redshift query editor. </p>
                    
                    <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="sql ">CREATE TABLE public.zipcode (
  ogc_field INTEGER PRIMARY KEY NOT NULL,
  wkb_geometry GEOMETRY,
  gml_id VARCHAR(256),
  spatial_name VARCHAR(256),
  spatial_alias VARCHAR(256),
  spatial_type VARCHAR(256)
 );</code></pre>
                    
                </li><li>
                    <p>Load the tables using sample data. </p>
                <p>The sample data for this tutorial is provided in an Amazon S3 bucket that allows
                    read access to all authenticated AWS users. Make sure that you provide valid AWS
                    credentials that permit access to Amazon S3. </p>
                <p>To load test data to your tables, run the following COPY commands. Replace
                            <code class="replaceable"><code class="code">account-number</code></code> with your own AWS
                    account number. The segment of the credentials string that is enclosed in single
                    quotation marks can't contain any spaces or line breaks. </p>
                    
                    
  
                                                         
                            
                            <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="sql ">COPY public.accommodations 
FROM 's3://redshift-downloads/spatial-data/accommodations.csv' 
DELIMITER ';' 
IGNOREHEADER 1 REGION 'us-east-1'
CREDENTIALS 'aws_iam_role=arn:aws:iam::<code class="replaceable">account-number</code>:role/mySpatialDemoRole';
</code></pre>
                            
                            <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="sql ">COPY public.zipcode 
FROM 's3://redshift-downloads/spatial-data/zipcode.csv' 
DELIMITER ';' 
IGNOREHEADER 1 REGION 'us-east-1'
CREDENTIALS 'aws_iam_role=arn:aws:iam::<code class="replaceable">account-number</code>:role/mySpatialDemoRole';
</code></pre>  
 
 
                            
                            
                             
                            
                </li><li>
                    <p>Verify that each table loaded correctly by running the following commands. </p>
                    <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="sql ">select count(*) from accommodations;</code></pre>
                    <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="sql ">select count(*) from zipcode;</code></pre>
                    <p>The following results show the number of rows in each table of test data.</p>
                    <div class="table-container"><div class="table-contents"><table id="w323aac44c75c11c17c12b9"><thead>
                                <tr>
                                    <th>Table name</th>
                                    <th>Rows</th>
                                </tr>
                            </thead>
                                <tr>
                                    <td tabindex="-1">accommodations</td>
                                    <td tabindex="-1">22,248</td>
                                </tr>
                                <tr>
                                    <td tabindex="-1">zipcode</td>
                                    <td tabindex="-1">190</td>
                                </tr>
                            </table></div></div>
                </li></ol></div>                       
     
        <h2 id="spatial-tutorial-query">Step 2: Query spatial data</h2>

        <p>After your tables are created and loaded, you can query them using SQL SELECT
            statements. The following queries demonstrate some of the information that you can
            retrieve. You can write many other queries that use spatial functions to satisfy your
            needs. </p>
        <div class="procedure"><h6>To query spatial data</h6><ol><li>
                <p>Query to get the count of the total number of listings stored in the
                        <code class="code">accommodations</code> table, as shown following. The spatial reference
                    system is World Geodetic System (WGS) 84, which has the unique spatial reference
                    identifier 4326.</p>
                <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="sql ">SELECT count(*) FROM public.accommodations WHERE ST_SRID(shape) = 4326;</code></pre>
                <pre class="programlisting"><div class="code-btn-container"></div><code class="nohighlight">
 count
-------
 22248</code></pre>                
            </li><li>
                <p>Fetch the geometry objects in well-known text (WKT) format with some
                    additional attributes. Additionally, you can validate if this postal code data
                    is also stored in World Geodetic System (WGS) 84, which uses the spatial
                    reference ID (SRID) 4326. Spatial data must be stored in the same spatial
                    reference system to be interoperable. </p>
                <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="sql ">SELECT ogc_field, spatial_name, spatial_type, ST_SRID(wkb_geometry), ST_AsText(wkb_geometry) 
FROM public.zipcode 
ORDER BY spatial_name;</code></pre>
                <pre class="programlisting"><div class="code-btn-container"></div><code class="nohighlight">
ogc_field  spatial_name  spatial_type  st_srid  st_astext
---------------------------------------------------------------
0           10115        Polygon        4326     POLYGON((...))
4           10117        Polygon        4326     POLYGON((...))
8           10119        Polygon        4326     POLYGON((...))
...
(190 rows returned)</code></pre>
                
            </li><li>
                <p>Select the polygon of Berlin Mitte (10117), a borough of Berlin, in GeoJSON format, its dimension,  
                    and the number of points in this polygon.  </p>
                <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="sql ">SELECT ogc_field, spatial_name, ST_AsGeoJSON(wkb_geometry), ST_Dimension(wkb_geometry), ST_NPoints(wkb_geometry)
FROM public.zipcode 
WHERE spatial_name='10117';</code></pre>
                <pre class="programlisting"><div class="code-btn-container"></div><code class="nohighlight">
ogc_field  spatial_name  spatial_type                                   st_dimension  st_npoint
-----------------------------------------------------------------------------------------------
4           10117         <span>{</span>"type":"Polygon", "coordinates":[[[...]]]}    2             331
</code></pre>
                
            </li><li>
                <p>Run the following SQL command to view how many accommodations are within 500
                    meters of the Brandenburg Gate. </p>
                <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="sql ">SELECT count(*) 
FROM public.accommodations 
WHERE ST_DistanceSphere(shape, ST_GeomFromText('POINT(13.377704 52.516431)', 4326)) &lt; 500;</code></pre>
                <pre class="programlisting"><div class="code-btn-container"></div><code class="nohighlight">
count
------
  29
</code></pre>
                             
            </li><li>
                <p>Get the rough location of the Brandenburg Gate from data stored in the
                    accommodations that are listed as nearby by running the following query.</p>
                <p>This query requires a subselect. It leads to a different count because the
                    requested location is not the same as the previous query because it is closer to
                    the accommodations. </p>
                <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="sql ">WITH poi(loc) as (
  SELECT st_astext(shape) FROM accommodations WHERE name LIKE '%brandenburg gate%'
)
SELECT count(*) 
FROM accommodations a, poi p
WHERE ST_DistanceSphere(a.shape, ST_GeomFromText(p.loc, 4326)) &lt; 500;</code></pre>                
                <pre class="programlisting"><div class="code-btn-container"></div><code class="nohighlight">
count
------
  60
</code></pre>  
                
              
            </li><li>
                <p>Run the following query to show the details of all accommodations around the
                    Brandenburg Gate, ordered by price in descending order. </p>
                <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="sql ">SELECT name, price, ST_AsText(shape) 
FROM public.accommodations
WHERE ST_DistanceSphere(shape, ST_GeomFromText('POINT(13.377704 52.516431)', 4326)) &lt; 500
ORDER BY price DESC;</code></pre>
                <pre class="programlisting"><div class="code-btn-container"></div><code class="nohighlight">
name                                                   price  st_astext
-------------------------------------------------------------------------------------------------------
DUPLEX APARTMENT/PENTHOUSE in 5* LOCATION! 7583        300    POINT(13.3826510209548 52.5159819722552)
DUPLEX-PENTHOUSE IN FIRST LOCATION! 7582               300    POINT(13.3799997083855 52.5135918444834)
... 
(29 rows returned)
</code></pre> 
                
                             
            </li><li>
                <p>Run the following query to retrieve the most expensive accommodation with its
                    postal code. </p>
                <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="sql ">SELECT 
  a.price, a.name, ST_AsText(a.shape), 
  z.spatial_name, ST_AsText(z.wkb_geometry) 
FROM accommodations a, zipcode z 
WHERE price = 9000 AND ST_Within(a.shape, z.wkb_geometry);</code></pre>
                <pre class="programlisting"><div class="code-btn-container"></div><code class="nohighlight">
price   name                                 st_astext                                  spatial_name      st_astext
-------------------------------------------------------------------------------------------------------------------------------------------------
9000    Ueber den Dächern Berlins Zentrum    POINT(13.334436985013 52.4979779501538)    10777             POLYGON((13.3318284987227 52.4956021172799,...
</code></pre>               
            </li><li>
                <p>Calculate the maximum, minimum, or median price of accommodations by using a
                    subquery. </p>
                <p>The following query lists the median price of accommodations by postal code. </p>
                <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="sql ">SELECT 
  a.price, a.name, ST_AsText(a.shape), 
  z.spatial_name, ST_AsText(z.wkb_geometry) 
FROM accommodations a, zipcode z 
WHERE 
  ST_Within(a.shape, z.wkb_geometry) AND 
  price = (SELECT median(price) FROM accommodations)
ORDER BY a.price;</code></pre>
                <pre class="programlisting"><div class="code-btn-container"></div><code class="nohighlight">
price name                            st_astext                                   spatial_name   st_astext
---------------------------------------------------------------------------------------------------------------------------------------------                    
45    "Cozy room Berlin-Mitte"        POINT(13.3864349535358 52.5292016386514)    10115          POLYGON((13.3658598465795 52.535659581048,...
...
(723 rows returned)
</code></pre> 
                
            </li><li>
                <p>Run the following query to retrieve the number of accommodations listed in
                    Berlin. To find the hot spots, these are grouped by postal code and sorted by
                    the amount of supply. </p>
                <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="sql ">SELECT z.spatial_name as zip, count(*) as numAccommodations 
FROM public.accommodations a, public.zipcode z
WHERE ST_Within(a.shape, z.wkb_geometry)
GROUP BY zip 
ORDER BY numAccommodations DESC;</code></pre>
                <pre class="programlisting"><div class="code-btn-container"></div><code class="nohighlight">
zip  	numaccommodations
----------------------------
10245	872
10247	832
10437	733
10115	664
...
(187 rows returned)
</code></pre>
            </li></ol></div>




     
           <h2 id="spatial-tutorial-clean-up">Step 3: Clean up your resources</h2>
           
           
           <p>Your cluster continues to accrue charges as long as it's running. When you
            have completed this tutorial, you can delete your sample cluster. </p>
           <p>If you want to keep the cluster but recover the storage used by the test data
            tables, run the following commands to delete the tables. </p>
           <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="sql ">drop table public.accommodations cascade;</code></pre>
           <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="sql ">drop table public.zipcode cascade;</code></pre>
           
       <awsdocs-copyright class="copyright-print"></awsdocs-copyright><awsdocs-thumb-feedback right-edge="{{$ctrl.thumbFeedbackRightEdge}}"></awsdocs-thumb-feedback></div><noscript><div><div><div><div id="js_error_message"><p><img src="https://d1ge0kk1l5kms0.cloudfront.net/images/G/01/webservices/console/warning.png" alt="Warning" /> <strong>Javascript is disabled or is unavailable in your browser.</strong></p><p>To use the Amazon Web Services Documentation, Javascript must be enabled. Please refer to your browser's Help pages for instructions.</p></div></div></div></div></noscript><div id="main-col-footer" class="awsui-util-font-size-0"><div id="doc-conventions"><a target="_top" href="/general/latest/gr/docconventions.html">Document Conventions</a></div><div class="prev-next"><div id="previous" class="prev-link" accesskey="p" href="./geospatial-overview.html">Querying spatial data</div><div id="next" class="next-link" accesskey="n" href="./spatial-copy-shapefile.html">Loading a shapefile</div></div></div><awsdocs-page-utilities></awsdocs-page-utilities></div><div id="quick-feedback-yes" style="display: none;"><div class="title">Did this page help you? - Yes</div><div class="content"><p>Thanks for letting us know we're doing a good job!</p><p>If you've got a moment, please tell us what we did right so we can do more of it.</p><p><awsui-button id="fblink" rel="noopener noreferrer" target="_blank" text="Feedback" click="linkClick($event)" href="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=Redshift&amp;topic_url=https://docs.aws.amazon.com/en_us/redshift/latest/dg/spatial-tutorial.html"></awsui-button></p></div></div><div id="quick-feedback-no" style="display: none;"><div class="title">Did this page help you? - No</div><div class="content"><p>Thanks for letting us know this page needs work. We're sorry we let you down.</p><p>If you've got a moment, please tell us how we can make the documentation better.</p><p><awsui-button id="fblink" rel="noopener noreferrer" target="_blank" text="Feedback" click="linkClick($event)" href="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=Redshift&amp;topic_url=https://docs.aws.amazon.com/en_us/redshift/latest/dg/spatial-tutorial.html"></awsui-button></p></div></div></div></body></div></awsdocs-view><div class="page-loading-indicator" id="page-loading-indicator"><awsui-spinner size="large"></awsui-spinner></div></div><div id="tools-panel" dom-region="tools"><awsdocs-tools-panel id="awsdocs-tools-panel"></awsdocs-tools-panel></div></awsui-app-layout><awsdocs-cookie-banner class="doc-cookie-banner"></awsdocs-cookie-banner></div></body></html>