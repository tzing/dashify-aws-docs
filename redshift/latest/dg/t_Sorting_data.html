<!DOCTYPE html>
    <html xmlns="http://www.w3.org/1999/xhtml" lang="en-US"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Working with sort keys - Amazon Redshift</title><meta name="viewport" content="width=device-width,initial-scale=1" /><meta name="assets_root" content="/assets" /><meta name="target_state" content="t_Sorting_data" /><meta name="default_state" content="t_Sorting_data" /><link rel="icon" type="image/ico" href="/assets/images/favicon.ico" /><link rel="shortcut icon" type="image/ico" href="/assets/images/favicon.ico" /><link rel="canonical" href="https://docs.aws.amazon.com/redshift/latest/dg/t_Sorting_data.html" /><meta name="description" content="When you create a table, you can define one or more of its columns as sort keys. When data is initially loaded into the empty table, the values in the sort key columns are stored on disk in sorted order." /><meta name="deployment_region" content="IAD" /><meta name="product" content="Amazon Redshift" /><meta name="guide" content="Database Developer Guide" /><meta name="abstract" content="Create and manage a data warehouse with Amazon Redshift, an enterprise-level, petabyte scale, fully managed data warehousing service." /><meta name="guide-locale" content="en_us" /><meta name="tocs" content="toc-contents.json" /><link rel="canonical" href="https://docs.aws.amazon.com/redshift/latest/dg/t_Sorting_data.html" /><link rel="alternative" href="https://docs.aws.amazon.com/id_id/redshift/latest/dg/t_Sorting_data.html" hreflang="id-id" /><link rel="alternative" href="https://docs.aws.amazon.com/id_id/redshift/latest/dg/t_Sorting_data.html" hreflang="id" /><link rel="alternative" href="https://docs.aws.amazon.com/de_de/redshift/latest/dg/t_Sorting_data.html" hreflang="de-de" /><link rel="alternative" href="https://docs.aws.amazon.com/de_de/redshift/latest/dg/t_Sorting_data.html" hreflang="de" /><link rel="alternative" href="https://docs.aws.amazon.com/redshift/latest/dg/t_Sorting_data.html" hreflang="en-us" /><link rel="alternative" href="https://docs.aws.amazon.com/redshift/latest/dg/t_Sorting_data.html" hreflang="en" /><link rel="alternative" href="https://docs.aws.amazon.com/es_es/redshift/latest/dg/t_Sorting_data.html" hreflang="es-es" /><link rel="alternative" href="https://docs.aws.amazon.com/es_es/redshift/latest/dg/t_Sorting_data.html" hreflang="es" /><link rel="alternative" href="https://docs.aws.amazon.com/fr_fr/redshift/latest/dg/t_Sorting_data.html" hreflang="fr-fr" /><link rel="alternative" href="https://docs.aws.amazon.com/fr_fr/redshift/latest/dg/t_Sorting_data.html" hreflang="fr" /><link rel="alternative" href="https://docs.aws.amazon.com/it_it/redshift/latest/dg/t_Sorting_data.html" hreflang="it-it" /><link rel="alternative" href="https://docs.aws.amazon.com/it_it/redshift/latest/dg/t_Sorting_data.html" hreflang="it" /><link rel="alternative" href="https://docs.aws.amazon.com/ja_jp/redshift/latest/dg/t_Sorting_data.html" hreflang="ja-jp" /><link rel="alternative" href="https://docs.aws.amazon.com/ja_jp/redshift/latest/dg/t_Sorting_data.html" hreflang="ja" /><link rel="alternative" href="https://docs.aws.amazon.com/ko_kr/redshift/latest/dg/t_Sorting_data.html" hreflang="ko-kr" /><link rel="alternative" href="https://docs.aws.amazon.com/ko_kr/redshift/latest/dg/t_Sorting_data.html" hreflang="ko" /><link rel="alternative" href="https://docs.aws.amazon.com/pt_br/redshift/latest/dg/t_Sorting_data.html" hreflang="pt-br" /><link rel="alternative" href="https://docs.aws.amazon.com/pt_br/redshift/latest/dg/t_Sorting_data.html" hreflang="pt" /><link rel="alternative" href="https://docs.aws.amazon.com/zh_cn/redshift/latest/dg/t_Sorting_data.html" hreflang="zh-cn" /><link rel="alternative" href="https://docs.aws.amazon.com/zh_tw/redshift/latest/dg/t_Sorting_data.html" hreflang="zh-tw" /><link rel="alternative" href="https://docs.aws.amazon.com/redshift/latest/dg/t_Sorting_data.html" hreflang="x-default" /><meta name="feedback-item" content="Redshift" /><meta name="this_doc_product" content="Amazon Redshift" /><meta name="this_doc_guide" content="Database Developer Guide" /><script defer="" src="/assets/r/vendor4.js?version=2021.12.02"></script><script defer="" src="/assets/r/vendor3.js?version=2021.12.02"></script><script defer="" src="/assets/r/vendor1.js?version=2021.12.02"></script><script defer="" src="/assets/r/awsdocs-common.js?version=2021.12.02"></script><script defer="" src="/assets/r/awsdocs-doc-page.js?version=2021.12.02"></script><link href="/assets/r/vendor4.css?version=2021.12.02" rel="stylesheet" /><link href="/assets/r/awsdocs-common.css?version=2021.12.02" rel="stylesheet" /><link href="/assets/r/awsdocs-doc-page.css?version=2021.12.02" rel="stylesheet" /><script async="" id="awsc-panorama-bundle" type="text/javascript" src="https://prod.pa.cdn.uis.awsstatic.com/panorama-nav-init.js" data-config="{'appEntity':'aws-documentation','region':'us-east-1','service':'redshift'}"></script><meta id="panorama-serviceSubSection" value="Database Developer Guide" /><meta id="panorama-serviceConsolePage" value="Working with sort keys" /></head><body class="awsdocs awsui"><div class="awsdocs-container"><awsdocs-header></awsdocs-header><awsui-app-layout id="app-layout" class="awsui-util-no-gutters" ng-controller="ContentController as $ctrl" header-selector="awsdocs-header" navigation-hide="false" navigation-width="$ctrl.navWidth" navigation-open="$ctrl.navOpen" navigation-change="$ctrl.onNavChange($event)" tools-hide="$ctrl.hideTools" tools-width="$ctrl.toolsWidth" tools-open="$ctrl.toolsOpen" tools-change="$ctrl.onToolsChange($event)"><div id="guide-toc" dom-region="navigation"><awsdocs-toc></awsdocs-toc></div><div id="main-column" dom-region="content" tabindex="-1"><awsdocs-view class="awsdocs-view"><div id="awsdocs-content"><head><title>Working with sort keys - Amazon Redshift</title><meta name="pdf" content="/pdfs/redshift/latest/dg/redshift-dg.pdf#t_Sorting_data" /><meta name="rss" content="Dochistory.rss" /><meta name="forums" content="http://forums.aws.amazon.com/forum.jspa?forumID=155" /><meta name="feedback" content="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=Redshift&amp;topic_url=https://docs.aws.amazon.com/en_us/redshift/latest/dg/t_Sorting_data.html" /><meta name="feedback-yes" content="feedbackyes.html?topic_url=https://docs.aws.amazon.com/en_us/redshift/latest/dg/t_Sorting_data.html" /><meta name="feedback-no" content="feedbackno.html?topic_url=https://docs.aws.amazon.com/en_us/redshift/latest/dg/t_Sorting_data.html" /><meta name="keywords" content="Amazon Redshift,AWS Redshift,Redshift,Redshift Spectrum,cluster,data warehouse,developer,sample data,database,database developer,HLL" /><script type="application/ld+json">
{
    "@context" : "https://schema.org",
    "@type" : "BreadcrumbList",
    "itemListElement" : [
      {
        "@type" : "ListItem",
        "position" : 1,
        "name" : "AWS",
        "item" : "https://aws.amazon.com"
      },
      {
        "@type" : "ListItem",
        "position" : 2,
        "name" : "Amazon Redshift",
        "item" : "https://docs.aws.amazon.com/redshift/index.html"
      },
      {
        "@type" : "ListItem",
        "position" : 3,
        "name" : "Database Developer Guide",
        "item" : "https://docs.aws.amazon.com/redshift/latest/dg"
      },
      {
        "@type" : "ListItem",
        "position" : 4,
        "name" : "Working with automatic table optimization",
        "item" : "https://docs.aws.amazon.com/redshift/latest/dg/t_Creating_tables.html"
      },
      {
        "@type" : "ListItem",
        "position" : 5,
        "name" : "Working with sort keys",
        "item" : "https://docs.aws.amazon.com/redshift/latest/dg/t_Creating_tables.html"
      }
    ]
}
</script></head><body><div id="main"><div style="display: none"><a href="/pdfs/redshift/latest/dg/redshift-dg.pdf#t_Sorting_data" target="_blank" rel="noopener noreferrer" title="Open PDF"></a></div><div id="breadcrumbs" class="breadcrumb"><a href="https://aws.amazon.com">AWS</a><a href="/index.html">Documentation</a><a href="/redshift/index.html">Amazon Redshift</a><a href="welcome.html">Database Developer Guide</a></div><div id="page-toc-src"><a href="#t_Sorting_mutidimensional-sort-key">Multidimensional data layout sorting (preview)</a><a href="#t_Sorting_data-compound">Compound sort key</a><a href="#t_Sorting_data-interleaved">Interleaved sort key</a></div><div id="main-content" class="awsui-util-container"><div id="main-col-body"><awsdocs-language-banner data-service="$ctrl.pageService"></awsdocs-language-banner><h1 class="topictitle" id="t_Sorting_data">Working with sort keys</h1><div class="awsdocs-page-header-container"><awsdocs-page-header></awsdocs-page-header><awsdocs-filter-selector id="awsdocs-filter-selector"></awsdocs-filter-selector></div><div class="awsdocs-note"><div class="awsdocs-note-title"><awsui-icon name="status-info" variant="link"></awsui-icon><h6>Note</h6></div><div class="awsdocs-note-text"><p>We recommend that you create your tables with <code class="code">SORTKEY AUTO</code>. If you do so, then Amazon Redshift uses 
            automatic table optimization to choose the sort key.
            For more information, see <a href="./t_Creating_tables.html">Working with automatic table optimization</a>.
            The rest of this section provides details about the sort order. </p></div></div><p>When you create a table, you can alternatively define one or more of its columns as <em>sort
                keys</em>. When data is initially loaded into the empty table, the rows are
            stored on disk in sorted order. Information about sort key columns is passed to the
            query planner, and the planner uses this information to construct plans that exploit the
            way that the data is sorted. 
            For more information, see 
            <a href="./r_CREATE_TABLE_NEW.html">CREATE TABLE</a>. For information
            on best practices when creating a sort key, see <a href="./c_best-practices-sort-key.html">Choose the best sort key</a>.</p><p>Sorting enables efficient handling of range-restricted predicates. Amazon Redshift stores
            columnar data in 1 MB disk blocks. The min and max values for each block are stored as
            part of the metadata. If a query uses a range-restricted predicate, the query processor
            can use the min and max values to rapidly skip over large numbers of blocks during table
            scans. For example, suppose that a table stores five years of data sorted by date and a
            query specifies a date range of one month. In this case, you can remove up to 98 percent
            of the disk blocks from the scan. If the data is not sorted, more of the disk blocks
            (possibly all of them) have to be scanned. </p><p>You can specify either a compound or interleaved sort key. A compound sort key is more
            efficient when query predicates use a <em>prefix</em>, which
            is a subset of the sort key columns in order. An interleaved sort key gives equal weight
            to each column in the sort key, so query predicates can use any subset of the columns
            that make up the sort key, in any order. 
            
            </p><p>To understand the impact of the chosen sort key on query performance, use the <a href="./r_EXPLAIN.html">EXPLAIN</a> command. For more information, see
                <a href="./c-query-planning.html">Query planning and execution workflow</a>.
        </p><p>To define a sort type, use either the INTERLEAVED or COMPOUND keyword with your CREATE
            TABLE or CREATE TABLE AS statement. The default is COMPOUND. COMPOUND is
            recommended when you update your tables regularly with INSERT, UPDATE, or
            DELETE operations. An INTERLEAVED sort key can use a maximum of eight columns. Depending on your
            data and cluster size, VACUUM REINDEX takes significantly longer than VACUUM FULL
            because it makes an additional pass to analyze the interleaved sort keys. The sort and
            merge operation can take longer for interleaved tables because the interleaved sort
            might have to rearrange more rows than a compound sort.</p><p>To view the sort keys for a table, query the <a href="./r_SVV_TABLE_INFO.html">SVV_TABLE_INFO</a> system view.</p><div class="highlights" id="inline-topiclist"><h6>Topics</h6><ul><li><a href="#t_Sorting_mutidimensional-sort-key">Multidimensional data layout sorting (preview)</a></li><li><a href="#t_Sorting_data-compound">Compound sort key</a></li><li><a href="#t_Sorting_data-interleaved">Interleaved sort key</a></li></ul></div>
            
            <h2 id="t_Sorting_mutidimensional-sort-key">Multidimensional data layout sorting (preview)</h2>
            
            <div class="table-container"><div class="table-contents"><table id="w323aac28c33c21b5">
      <tr>
        <td tabindex="-1"><em><b>The following is prerelease documentation for the multidimensional data layout sorting of tables, 
        which is in preview release. The documentation and the feature are both subject to change.
        We recommend that you use this feature only with test clusters, and not in production environments.
        For preview terms and conditions, see <em>Beta Service Participation</em> in <a href="https://aws.amazon.com/service-terms/" rel="noopener noreferrer" target="_blank"><span>AWS Service Terms</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a>.
        </b></em>
        </td>
      </tr>
    </table></div></div>
            
            <div class="awsdocs-note"><div class="awsdocs-note-title"><awsui-icon name="status-info" variant="link"></awsui-icon><h6>Note</h6></div><div class="awsdocs-note-text"><p>This feature is only available using a preview cluster or preview workgroup. 
                To create a preview cluster, see 
                <a href="https://docs.aws.amazon.com/redshift/latest/mgmt/managing-clusters-console.html#cluster-preview">Creating a preview cluster</a> 
                in the <em>Amazon Redshift Management Guide</em>.
                To create a preview workgroup, see 
                <a href="https://docs.aws.amazon.com/redshift/latest/mgmt/serverless-workgroup-preview.html">Creating a preview workgroup</a> 
                in the <em>Amazon Redshift Management Guide</em>.</p></div></div>
            
            <p>A multidimensional data layout sort key is a type of AUTO sort key that is based
                on repetitive predicates found in a workload. If your workload has repetitive
                predicates, then Amazon Redshift can improve table scan performance by colocating data rows
                that satisfy the repetitive predicates. Instead of storing data of a table in strict
                column order, a multidimensional data layout sort key stores data by analyzing
                repetitive predicates that appear in a workload. More than one repetitive predicate
                can be found in a workload. Depending on your workload, this kind of sort key can
                improve performance of many predicates. Amazon Redshift automatically determines if this sort
                key method should be used for tables that are defined with an <code class="code">AUTO</code> sort
                key.</p>
            <p>For example, suppose you have a table that has data sorted in column order. 
                Many data blocks might need to be examined to determine if they satisfy the predicates in your workload.        
                But, if the data is stored on disk in a predicate order, then fewer blocks need to be scanned to satisfy the query.
                Using a multidimensional data layout sort key is beneficial in this case.</p>
            
            <p>To view whether a query is using a multidimensional data layout key, see 
                the <code class="code">step_attribute</code> column of the <a href="./SYS_QUERY_DETAIL.html">SYS_QUERY_DETAIL</a> view. 
                When the value is <code class="code">multi-dimensional</code> then multidimensional data layout was used for the query.
                To view whether a table defined with the AUTO sort key is using a multidimensional data layout, see 
                the <code class="code">sortkey1</code> column of the <a href="./r_SVV_TABLE_INFO.html">SVV_TABLE_INFO</a> view. 
                When the value is <code class="code">padb_internal_mddl_key_col</code> then multidimensional data layout was used for the table sort key.</p>
            
            <p>To prevent Amazon Redshift from using a multidimensional data layout sort key, choose a different table sort key option other than <code class="code">SORTKEY AUTO</code>.
               For more information on SORTKEY options, see 
                <a href="./r_CREATE_TABLE_NEW.html">CREATE TABLE</a>.</p>
            
         
            <h2 id="t_Sorting_data-compound">Compound sort key</h2>

            <p> A compound key is made up of all of the columns listed in the sort key
                definition, in the order they are listed. A compound sort key is most useful when a
                query's filter applies conditions, such as filters and joins, that use a prefix of
                the sort keys. The performance benefits of compound sorting decrease when queries
                depend only on secondary sort columns, without referencing the primary columns.
                COMPOUND is the default sort type.</p>
            <p>Compound sort keys might speed up joins, GROUP BY and ORDER BY operations, and
                window functions that use PARTITION BY and ORDER BY. For example, a merge join,
                which is often faster than a hash join, is feasible when the data is distributed and
                presorted on the joining columns. Compound sort keys also help improve compression. </p>
            <p>As you add rows to a sorted table that already contains data, the unsorted region
                grows, which has a significant effect on performance. The effect is greater when the
                table uses interleaved sorting, especially when the sort columns include data that
                increases monotonically, such as date or timestamp columns. Run a VACUUM operation
                regularly, especially after large data loads, to re-sort and re-analyze the data.
                For more information, see <a href="./r_vacuum_diskspacereqs.html">Managing the size of the unsorted
                  region</a>. After vacuuming to resort the data,
                it's a good practice to run an ANALYZE command to update the statistical
                metadata for the query planner. For more information, see <a href="./t_Analyzing_tables.html">Analyzing tables</a>.</p>

         
            <h2 id="t_Sorting_data-interleaved">Interleaved sort key</h2>

            <p>An interleaved sort gives equal weight to each column, or subset of columns, in
                the sort key. If multiple queries use different columns for filters, then you can
                often improve performance for those queries by using an interleaved sort style. When
                a query uses restrictive predicates on secondary sort columns, interleaved sorting
                significantly improves query performance as compared to compound sorting. </p>
            <div class="awsdocs-note awsdocs-important"><div class="awsdocs-note-title"><awsui-icon name="status-warning" variant="error"></awsui-icon><h6>Important</h6></div><div class="awsdocs-note-text"><p>Don't use an interleaved sort key on columns with monotonically increasing
                    attributes, such as identity columns, dates, or timestamps.</p></div></div>
            <p>The performance improvements you gain by implementing an interleaved sort key
                should be weighed against increased load and vacuum times. </p>

            <p>Interleaved sorts are most effective with highly selective queries that filter on
                one or more of the sort key columns in the WHERE clause, for example <code class="code">select
                    c_name from customer where c_region = 'ASIA'</code>. The benefits of interleaved
                sorting increase with the number of sorted columns that are restricted. </p>
            <p>An interleaved sort is more effective with large tables. Sorting is applied on
                each slice. Thus, an interleaved sort is most effective when a table is large enough
                to require multiple 1 MB blocks per slice. Here, the query processor can skip a
                significant proportion of the blocks using restrictive predicates. To view the
                number of blocks a table uses, query the <a href="./r_STV_BLOCKLIST.html">STV_BLOCKLIST</a> system view.</p>

            <p> When sorting on a single column, an interleaved sort might give better
                performance than a compound sort if the column values have a long common prefix. For
                example, URLs commonly begin with "http://www". Compound sort keys use a limited
                number of characters from the prefix, which results in a lot of duplication of keys.
                Interleaved sorts use an internal compression scheme for zone map values that
                enables them to better discriminate among column values that have a long common
                prefix.</p>
            <p>
                When migrating Amazon Redshift provisioned clusters to Amazon Redshift Serverless,
                Redshift converts tables with interleaved sort keys and DISTSTYLE
                KEY to compound sort keys. The DISTSTYLE doesn't change.
                For more information on distribution styles, see <a href="https://docs.aws.amazon.com/redshift/latest/dg/t_Distributing_data.html">Working with data distribution styles</a>.
            </p>
             
                <h6>VACUUM REINDEX</h6>
                <p>As you add rows to a sorted table that already contains data, performance
                    might deteriorate over time. This deterioration occurs for both compound and
                    interleaved sorts, but it has a greater effect on interleaved tables. A VACUUM
                    restores the sort order, but the operation can take longer for interleaved
                    tables because merging new interleaved data might involve modifying every data
                    block.</p>
             
            <p>When tables are initially loaded, Amazon Redshift analyzes the distribution of the values
                in the sort key columns and uses that information for optimal interleaving of the
                sort key columns. As a table grows, the distribution of the values in the sort key
                columns can change, or skew, especially with date or timestamp columns. If the skew
                becomes too large, performance might be affected. To re-analyze the sort keys and
                restore performance, run the VACUUM command with the REINDEX key word. Because it
                must take an extra analysis pass over the data, VACUUM REINDEX can take longer than
                a standard VACUUM for interleaved tables. To view information about key distribution
                skew and last reindex time, query the <a href="./r_SVV_INTERLEAVED_COLUMNS.html">SVV_INTERLEAVED_COLUMNS</a> system view.</p>
            <p>For more information about how to determine how often to run VACUUM and when to
                run a VACUUM REINDEX, see <a href="./r_vacuum-decide-whether-to-reindex.html">Deciding whether to
                  reindex</a>. </p>

        <awsdocs-copyright class="copyright-print"></awsdocs-copyright><awsdocs-thumb-feedback right-edge="{{$ctrl.thumbFeedbackRightEdge}}"></awsdocs-thumb-feedback></div><noscript><div><div><div><div id="js_error_message"><p><img src="https://d1ge0kk1l5kms0.cloudfront.net/images/G/01/webservices/console/warning.png" alt="Warning" /> <strong>Javascript is disabled or is unavailable in your browser.</strong></p><p>To use the Amazon Web Services Documentation, Javascript must be enabled. Please refer to your browser's Help pages for instructions.</p></div></div></div></div></noscript><div id="main-col-footer" class="awsui-util-font-size-0"><div id="doc-conventions"><a target="_top" href="/general/latest/gr/docconventions.html">Document Conventions</a></div><div class="prev-next"><div id="previous" class="prev-link" accesskey="p" href="./c_Distribution_examples.html">Distribution examples</div><div id="next" class="next-link" accesskey="n" href="./t_Defining_constraints.html">Defining table constraints</div></div></div><awsdocs-page-utilities></awsdocs-page-utilities></div><div id="quick-feedback-yes" style="display: none;"><div class="title">Did this page help you? - Yes</div><div class="content"><p>Thanks for letting us know we're doing a good job!</p><p>If you've got a moment, please tell us what we did right so we can do more of it.</p><p><awsui-button id="fblink" rel="noopener noreferrer" target="_blank" text="Feedback" click="linkClick($event)" href="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=Redshift&amp;topic_url=https://docs.aws.amazon.com/en_us/redshift/latest/dg/t_Sorting_data.html"></awsui-button></p></div></div><div id="quick-feedback-no" style="display: none;"><div class="title">Did this page help you? - No</div><div class="content"><p>Thanks for letting us know this page needs work. We're sorry we let you down.</p><p>If you've got a moment, please tell us how we can make the documentation better.</p><p><awsui-button id="fblink" rel="noopener noreferrer" target="_blank" text="Feedback" click="linkClick($event)" href="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=Redshift&amp;topic_url=https://docs.aws.amazon.com/en_us/redshift/latest/dg/t_Sorting_data.html"></awsui-button></p></div></div></div></body></div></awsdocs-view><div class="page-loading-indicator" id="page-loading-indicator"><awsui-spinner size="large"></awsui-spinner></div></div><div id="tools-panel" dom-region="tools"><awsdocs-tools-panel id="awsdocs-tools-panel"></awsdocs-tools-panel></div></awsui-app-layout><awsdocs-cookie-banner class="doc-cookie-banner"></awsdocs-cookie-banner></div></body></html>