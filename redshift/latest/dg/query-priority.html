<!DOCTYPE html>
    <html xmlns="http://www.w3.org/1999/xhtml" lang="en-US"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Query priority - Amazon Redshift</title><meta name="viewport" content="width=device-width,initial-scale=1" /><meta name="assets_root" content="/assets" /><meta name="target_state" content="query-priority" /><meta name="default_state" content="query-priority" /><link rel="icon" type="image/ico" href="/assets/images/favicon.ico" /><link rel="shortcut icon" type="image/ico" href="/assets/images/favicon.ico" /><link rel="canonical" href="https://docs.aws.amazon.com/redshift/latest/dg/query-priority.html" /><meta name="description" content="Not all queries are of equal importance, and often performance of one workload or set of users might be more important. If you have enabled automatic WLM , you can define the relative importance of queries in a workload by setting a priority value. The priority is specified for a queue and inherited by all queries associated with the queue. You associate queries to a queue by mapping user groups and query groups to the queue. You can set the following priorities (listed from highest to lowest priority):" /><meta name="deployment_region" content="IAD" /><meta name="product" content="Amazon Redshift" /><meta name="guide" content="Database Developer Guide" /><meta name="abstract" content="Create and manage a data warehouse with Amazon Redshift, an enterprise-level, petabyte scale, fully managed data warehousing service." /><meta name="guide-locale" content="en_us" /><meta name="tocs" content="toc-contents.json" /><link rel="canonical" href="https://docs.aws.amazon.com/redshift/latest/dg/query-priority.html" /><link rel="alternative" href="https://docs.aws.amazon.com/id_id/redshift/latest/dg/query-priority.html" hreflang="id-id" /><link rel="alternative" href="https://docs.aws.amazon.com/id_id/redshift/latest/dg/query-priority.html" hreflang="id" /><link rel="alternative" href="https://docs.aws.amazon.com/de_de/redshift/latest/dg/query-priority.html" hreflang="de-de" /><link rel="alternative" href="https://docs.aws.amazon.com/de_de/redshift/latest/dg/query-priority.html" hreflang="de" /><link rel="alternative" href="https://docs.aws.amazon.com/redshift/latest/dg/query-priority.html" hreflang="en-us" /><link rel="alternative" href="https://docs.aws.amazon.com/redshift/latest/dg/query-priority.html" hreflang="en" /><link rel="alternative" href="https://docs.aws.amazon.com/es_es/redshift/latest/dg/query-priority.html" hreflang="es-es" /><link rel="alternative" href="https://docs.aws.amazon.com/es_es/redshift/latest/dg/query-priority.html" hreflang="es" /><link rel="alternative" href="https://docs.aws.amazon.com/fr_fr/redshift/latest/dg/query-priority.html" hreflang="fr-fr" /><link rel="alternative" href="https://docs.aws.amazon.com/fr_fr/redshift/latest/dg/query-priority.html" hreflang="fr" /><link rel="alternative" href="https://docs.aws.amazon.com/it_it/redshift/latest/dg/query-priority.html" hreflang="it-it" /><link rel="alternative" href="https://docs.aws.amazon.com/it_it/redshift/latest/dg/query-priority.html" hreflang="it" /><link rel="alternative" href="https://docs.aws.amazon.com/ja_jp/redshift/latest/dg/query-priority.html" hreflang="ja-jp" /><link rel="alternative" href="https://docs.aws.amazon.com/ja_jp/redshift/latest/dg/query-priority.html" hreflang="ja" /><link rel="alternative" href="https://docs.aws.amazon.com/ko_kr/redshift/latest/dg/query-priority.html" hreflang="ko-kr" /><link rel="alternative" href="https://docs.aws.amazon.com/ko_kr/redshift/latest/dg/query-priority.html" hreflang="ko" /><link rel="alternative" href="https://docs.aws.amazon.com/pt_br/redshift/latest/dg/query-priority.html" hreflang="pt-br" /><link rel="alternative" href="https://docs.aws.amazon.com/pt_br/redshift/latest/dg/query-priority.html" hreflang="pt" /><link rel="alternative" href="https://docs.aws.amazon.com/zh_cn/redshift/latest/dg/query-priority.html" hreflang="zh-cn" /><link rel="alternative" href="https://docs.aws.amazon.com/zh_tw/redshift/latest/dg/query-priority.html" hreflang="zh-tw" /><link rel="alternative" href="https://docs.aws.amazon.com/redshift/latest/dg/query-priority.html" hreflang="x-default" /><meta name="feedback-item" content="Redshift" /><meta name="this_doc_product" content="Amazon Redshift" /><meta name="this_doc_guide" content="Database Developer Guide" /><script defer="" src="/assets/r/vendor4.js?version=2021.12.02"></script><script defer="" src="/assets/r/vendor3.js?version=2021.12.02"></script><script defer="" src="/assets/r/vendor1.js?version=2021.12.02"></script><script defer="" src="/assets/r/awsdocs-common.js?version=2021.12.02"></script><script defer="" src="/assets/r/awsdocs-doc-page.js?version=2021.12.02"></script><link href="/assets/r/vendor4.css?version=2021.12.02" rel="stylesheet" /><link href="/assets/r/awsdocs-common.css?version=2021.12.02" rel="stylesheet" /><link href="/assets/r/awsdocs-doc-page.css?version=2021.12.02" rel="stylesheet" /><script async="" id="awsc-panorama-bundle" type="text/javascript" src="https://prod.pa.cdn.uis.awsstatic.com/panorama-nav-init.js" data-config="{'appEntity':'aws-documentation','region':'us-east-1','service':'redshift'}"></script><meta id="panorama-serviceSubSection" value="Database Developer Guide" /><meta id="panorama-serviceConsolePage" value="Query priority" /></head><body class="awsdocs awsui"><div class="awsdocs-container"><awsdocs-header></awsdocs-header><awsui-app-layout id="app-layout" class="awsui-util-no-gutters" ng-controller="ContentController as $ctrl" header-selector="awsdocs-header" navigation-hide="false" navigation-width="$ctrl.navWidth" navigation-open="$ctrl.navOpen" navigation-change="$ctrl.onNavChange($event)" tools-hide="$ctrl.hideTools" tools-width="$ctrl.toolsWidth" tools-open="$ctrl.toolsOpen" tools-change="$ctrl.onToolsChange($event)"><div id="guide-toc" dom-region="navigation"><awsdocs-toc></awsdocs-toc></div><div id="main-column" dom-region="content" tabindex="-1"><awsdocs-view class="awsdocs-view"><div id="awsdocs-content"><head><title>Query priority - Amazon Redshift</title><meta name="pdf" content="/pdfs/redshift/latest/dg/redshift-dg.pdf#query-priority" /><meta name="rss" content="Dochistory.rss" /><meta name="forums" content="http://forums.aws.amazon.com/forum.jspa?forumID=155" /><meta name="feedback" content="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=Redshift&amp;topic_url=https://docs.aws.amazon.com/en_us/redshift/latest/dg/query-priority.html" /><meta name="feedback-yes" content="feedbackyes.html?topic_url=https://docs.aws.amazon.com/en_us/redshift/latest/dg/query-priority.html" /><meta name="feedback-no" content="feedbackno.html?topic_url=https://docs.aws.amazon.com/en_us/redshift/latest/dg/query-priority.html" /><meta name="keywords" content="Amazon Redshift,AWS Redshift,Redshift,Redshift Spectrum,cluster,data warehouse,developer,sample data,database,database developer,HLL" /><script type="application/ld+json">
{
    "@context" : "https://schema.org",
    "@type" : "BreadcrumbList",
    "itemListElement" : [
      {
        "@type" : "ListItem",
        "position" : 1,
        "name" : "AWS",
        "item" : "https://aws.amazon.com"
      },
      {
        "@type" : "ListItem",
        "position" : 2,
        "name" : "Amazon Redshift",
        "item" : "https://docs.aws.amazon.com/redshift/index.html"
      },
      {
        "@type" : "ListItem",
        "position" : 3,
        "name" : "Database Developer Guide",
        "item" : "https://docs.aws.amazon.com/redshift/latest/dg"
      },
      {
        "@type" : "ListItem",
        "position" : 4,
        "name" : "Implementing workload management",
        "item" : "https://docs.aws.amazon.com/redshift/latest/dg/cm-c-implementing-workload-management.html"
      },
      {
        "@type" : "ListItem",
        "position" : 5,
        "name" : "Implementing automatic WLM",
        "item" : "https://docs.aws.amazon.com/redshift/latest/dg/automatic-wlm.html"
      },
      {
        "@type" : "ListItem",
        "position" : 6,
        "name" : "Query priority",
        "item" : "https://docs.aws.amazon.com/redshift/latest/dg/automatic-wlm.html"
      }
    ]
}
</script></head><body><div id="main"><div style="display: none"><a href="/pdfs/redshift/latest/dg/redshift-dg.pdf#query-priority" target="_blank" rel="noopener noreferrer" title="Open PDF"></a></div><div id="breadcrumbs" class="breadcrumb"><a href="https://aws.amazon.com">AWS</a><a href="/index.html">Documentation</a><a href="/redshift/index.html">Amazon Redshift</a><a href="welcome.html">Database Developer Guide</a></div><div id="page-toc-src"><a href="#concurrency-scaling-queues">Configuring queue priority</a><a href="#query-priority-qmr">Changing query priority with QMR</a><a href="#query-priority-monitoring">Monitoring query priority</a></div><div id="main-content" class="awsui-util-container"><div id="main-col-body"><awsdocs-language-banner data-service="$ctrl.pageService"></awsdocs-language-banner><h1 class="topictitle" id="query-priority">Query priority</h1><div class="awsdocs-page-header-container"><awsdocs-page-header></awsdocs-page-header><awsdocs-filter-selector id="awsdocs-filter-selector"></awsdocs-filter-selector></div><p>Not all queries are of equal importance, and often performance of one workload or set
            of users might be more important. If you have enabled <a href="./automatic-wlm.html">automatic WLM</a>, you can define the relative
            importance of queries in a workload by setting a priority value. The priority is
            specified for a queue and inherited by all queries associated with the queue. You
            associate queries to a queue by mapping user groups and query groups to the queue. You
            can set the following priorities (listed from highest to lowest priority):</p><div class="orderedlist">
             
             
             
             
             
         <ol><li><p><code class="code">HIGHEST</code></p></li><li><p><code class="code">HIGH</code></p></li><li><p><code class="code">NORMAL</code></p></li><li><p><code class="code">LOW</code></p></li><li><p><code class="code">LOWEST</code></p></li></ol></div><p>Administrators use these priorities to show the relative importance of their
            workloads when there are queries with different priorities contending for the same
            resources. Amazon Redshift uses the priority when letting queries into the system, and to determine
            the amount of resources allocated to a query.
            By default, queries run with their
            priority set to <code class="code">NORMAL</code>. </p><p>An additional priority, <code class="code">CRITICAL</code>, which is a higher priority than
               <code class="code">HIGHEST</code>, is available to superusers. To set this priority, you can use
            the functions <a href="./r_CHANGE_QUERY_PRIORITY.html">CHANGE_QUERY_PRIORITY</a>, <a href="./r_CHANGE_SESSION_PRIORITY.html">CHANGE_SESSION_PRIORITY</a>. and <a href="./r_CHANGE_USER_PRIORITY.html">CHANGE_USER_PRIORITY</a>. To grant a
            database user permission to use these functions, you can create a stored procedure and
            grant permission to a user. For an example, see <a href="./r_CHANGE_SESSION_PRIORITY.html">CHANGE_SESSION_PRIORITY</a>. </p><div class="awsdocs-note"><div class="awsdocs-note-title"><awsui-icon name="status-info" variant="link"></awsui-icon><h6>Note</h6></div><div class="awsdocs-note-text"><p>Only one <code class="code">CRITICAL</code> query can run at a time.</p></div></div><p>Let's take an example where the priority of an extract, transform, load (ETL)
            workload is higher than the priority of the analytics workload. The ETL workload runs
            every six hours, and the analytics workload runs throughout the day. When only the
            analytics workload is running on the cluster, it gets the entire system to itself,
            yielding high throughput with optimal system utilization. However, when the ETL workload
            starts, it gets the right of the way because it has a higher priority. Queries running
            as part of the ETL workload get the right of the way during admission and also
            preferential resource allocation after they are admitted. As a consequence, the ETL
            workload performs predictably regardless of what else might be running on the system.
            Thus, it provides predictable performance and the ability for administrators to provide
            service level agreements (SLAs) for their business users. </p><p>Within a given cluster, the predictable performance for a high priority workload
            comes at the cost of other, lower priority workloads. Lower priority workloads might run
            longer either because their queries are waiting behind more important queries to
            complete. Or they might run longer because they're getting a smaller fraction of
            resources when they are running concurrently with higher priority queries. Lower
            priority queries don't suffer from starvation, but rather keep making progress at a
            slower pace.</p><p>In the preceding example, the administrator can enable <a href="./concurrency-scaling.html">concurrency
               scaling</a> for the analytics workload. Doing this enables that workload to
            maintain its throughput, even though the ETL workload is running at high priority. </p>
            <h2 id="concurrency-scaling-queues">Configuring queue priority</h2>
            <p>If you have enabled automatic WLM, each queue has a priority value. Queries are
               routed to queues based on user groups and query groups. Start with a queue priority set to 
               <code class="code">NORMAL</code>. Set the priority higher or lower based on the workload
               associated with the queue's user groups and query groups. </p>
            <p>You can change the priority of a queue on the Amazon Redshift console. On the Amazon Redshift console,
               the <b>Workload Management</b> page displays the queues and enables
               editing of queue properties such as <b>Priority</b>. To set the
               priority using the CLI or API operations, use the <code class="code">wlm_json_configuration</code>
               parameter. For more information, see <a href="https://docs.aws.amazon.com/redshift/latest/mgmt/workload-mgmt-config.html">Configuring Workload
                  Management</a> in the <em>Amazon Redshift Management Guide</em>.</p>
            <p>The following <code class="code">wlm_json_configuration</code> example defines three user groups (<code class="code">ingest</code>, <code class="code">reporting</code>, and <code class="code">analytics</code>). 
               Queries submitted from users from one of these groups run with priority <code class="code">highest</code>, <code class="code">normal</code>, and <code class="code">low</code>, respectively.</p>
            <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="">[
    <span>{</span>
        "user_group": [
            "ingest"
        ],
        "priority": "highest",
        "queue_type": "auto"
    },
    <span>{</span>
        "user_group": [
            "reporting"
        ],
        "priority": "normal",
        "queue_type": "auto"
    },
    <span>{</span>
        "user_group": [
            "analytics"
        ],
        "priority": "low",
        "queue_type": "auto",
        "auto_wlm": true
    }
]</code></pre>
            
          
            <h2 id="query-priority-qmr">Changing query priority with query monitoring
                  rules</h2>
            <p>Query monitoring rules (QMR) enable you to change the priority of a query based on
               its behavior while it is running. You do this by specifying the priority attribute in
               a QMR predicate in addition to an action. For more information, see <a href="./cm-c-wlm-query-monitoring-rules.html">WLM query monitoring rules</a>. </p>
            <p>For example, you can define a rule to cancel any query classified as <code class="code">high</code> priority that runs for more than 10 minutes.</p>
            <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="json ">"rules" :[
  <span>{</span>
    "rule_name":"rule_abort",
    "predicate":[
      <span>{</span>
        "metric_name":"query_cpu_time",
        "operator":"&gt;",
        "value":600
      },
      <span>{</span>
        "metric_name":"query_priority",
        "operator":"=",
        "value":"high"
      }
    ],
    "action":"abort"
  }
]</code></pre>
            <p>Another example is to define a rule to change the query priority to <code class="code">lowest</code> for any query with current priority <code class="code">normal</code> that spills more than 1 TB to disk. </p>
            <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="json ">"rules":[
  <span>{</span>
    "rule_name":"rule_change_priority",
    "predicate":[
      <span>{</span>
        "metric_name":"query_temp_blocks_to_disk",
        "operator":"&gt;",
        "value":1000000
      },
      <span>{</span>
        "metric_name":"query_priority",
        "operator":"=",
        "value":"normal"
      }
    ],
    "action":"change_query_priority",
    "value":"lowest"
  }
]</code></pre>
            
          
            <h2 id="query-priority-monitoring">Monitoring query priority</h2>
            <p>To display priority for waiting and running queries, view the <code class="code">query_priority</code> column in the stv_wlm_query_state system table.</p>
            <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="">
query    | service_cl | wlm_start_time             | state            | queue_time | query_priority
---------+------------+----------------------------+------------------+------------+----------------
2673299  | 102        | 2019-06-24 17:35:38.866356 | QueuedWaiting    | 265116     | Highest
2673236  | 101        | 2019-06-24 17:35:33.313854 | Running          | 0          | Highest
2673265  | 102        | 2019-06-24 17:35:33.523332 | Running          | 0          | High
2673284  | 102        | 2019-06-24 17:35:38.477366 | Running          | 0          | Highest
2673288  | 102        | 2019-06-24 17:35:38.621819 | Running          | 0          | Highest
2673310  | 103        | 2019-06-24 17:35:39.068513 | QueuedWaiting    | 62970      | High
2673303  | 102        | 2019-06-24 17:35:38.968921 | QueuedWaiting    | 162560     | Normal
2673306  | 104        | 2019-06-24 17:35:39.002733 | QueuedWaiting    | 128691     | Lowest           
</code></pre>
            
            <p>To list query priority for completed queries, see the <code class="code">query_priority</code> column in the stl_wlm_query system table.</p>
            <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="sql ">select query, service_class as svclass, service_class_start_time as starttime, query_priority 
from stl_wlm_query order by 3 desc limit 10;</code></pre>
            
            <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="">
  query  | svclass |         starttime          |    query_priority
---------+---------+----------------------------+----------------------
 2723254 |     100 | 2019-06-24 18:14:50.780094 | Normal
 2723251 |     102 | 2019-06-24 18:14:50.749961 | Highest  
 2723246 |     102 | 2019-06-24 18:14:50.725275 | Highest
 2723244 |     103 | 2019-06-24 18:14:50.719241 | High
 2723243 |     101 | 2019-06-24 18:14:50.699325 | Low
 2723242 |     102 | 2019-06-24 18:14:50.692573 | Highest
 2723239 |     101 | 2019-06-24 18:14:50.668535 | Low
 2723237 |     102 | 2019-06-24 18:14:50.661918 | Highest
 2723236 |     102 | 2019-06-24 18:14:50.643636 | Highest            
</code></pre>
            
            
            
            
               <p>To optimize the throughput of your workload, Amazon Redshift might modify the priority of
               user submitted queries. Amazon Redshift uses advanced machine learning algorithms to determine
               when this optimization benefits your workload and automatically applies it when all
               the following conditions are met. </p>
               <div class="itemizedlist">
                   
                   
                   
               <ul class="itemizedlist"><li class="listitem"><p>Automatic WLM is enabled.</p></li><li class="listitem"><p>Only one WLM queue is defined.</p></li><li class="listitem"><p>You have not defined query monitoring rules (QMRs) which set query priority. Such rules
                     include the QMR metric <code class="code">query_priority</code> or the QMR action
                     <code class="code">change_query_priority</code>. For more information, see <a href="./cm-c-wlm-query-monitoring-rules.html">WLM query monitoring rules</a>. </p></li></ul></div>
               
         <awsdocs-copyright class="copyright-print"></awsdocs-copyright><awsdocs-thumb-feedback right-edge="{{$ctrl.thumbFeedbackRightEdge}}"></awsdocs-thumb-feedback></div><noscript><div><div><div><div id="js_error_message"><p><img src="https://d1ge0kk1l5kms0.cloudfront.net/images/G/01/webservices/console/warning.png" alt="Warning" /> <strong>Javascript is disabled or is unavailable in your browser.</strong></p><p>To use the Amazon Web Services Documentation, Javascript must be enabled. Please refer to your browser's Help pages for instructions.</p></div></div></div></div></noscript><div id="main-col-footer" class="awsui-util-font-size-0"><div id="doc-conventions"><a target="_top" href="/general/latest/gr/docconventions.html">Document Conventions</a></div><div class="prev-next"><div id="previous" class="prev-link" accesskey="p" href="./automatic-wlm.html">Automatic WLM</div><div id="next" class="next-link" accesskey="n" href="./cm-c-defining-query-queues.html">Manual WLM</div></div></div><awsdocs-page-utilities></awsdocs-page-utilities></div><div id="quick-feedback-yes" style="display: none;"><div class="title">Did this page help you? - Yes</div><div class="content"><p>Thanks for letting us know we're doing a good job!</p><p>If you've got a moment, please tell us what we did right so we can do more of it.</p><p><awsui-button id="fblink" rel="noopener noreferrer" target="_blank" text="Feedback" click="linkClick($event)" href="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=Redshift&amp;topic_url=https://docs.aws.amazon.com/en_us/redshift/latest/dg/query-priority.html"></awsui-button></p></div></div><div id="quick-feedback-no" style="display: none;"><div class="title">Did this page help you? - No</div><div class="content"><p>Thanks for letting us know this page needs work. We're sorry we let you down.</p><p>If you've got a moment, please tell us how we can make the documentation better.</p><p><awsui-button id="fblink" rel="noopener noreferrer" target="_blank" text="Feedback" click="linkClick($event)" href="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=Redshift&amp;topic_url=https://docs.aws.amazon.com/en_us/redshift/latest/dg/query-priority.html"></awsui-button></p></div></div></div></body></div></awsdocs-view><div class="page-loading-indicator" id="page-loading-indicator"><awsui-spinner size="large"></awsui-spinner></div></div><div id="tools-panel" dom-region="tools"><awsdocs-tools-panel id="awsdocs-tools-panel"></awsdocs-tools-panel></div></awsui-app-layout><awsdocs-cookie-banner class="doc-cookie-banner"></awsdocs-cookie-banner></div></body></html>