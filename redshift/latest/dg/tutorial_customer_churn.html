<!DOCTYPE html>
    <html xmlns="http://www.w3.org/1999/xhtml" lang="en-US"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Tutorial: Building customer churn models - Amazon Redshift</title><meta name="viewport" content="width=device-width,initial-scale=1" /><meta name="assets_root" content="/assets" /><meta name="target_state" content="tutorial_customer_churn" /><meta name="default_state" content="tutorial_customer_churn" /><link rel="icon" type="image/ico" href="/assets/images/favicon.ico" /><link rel="shortcut icon" type="image/ico" href="/assets/images/favicon.ico" /><link rel="canonical" href="https://docs.aws.amazon.com/redshift/latest/dg/tutorial_customer_churn.html" /><meta name="description" content="Use this tutorial for an end-to-end example of creating an Amazon Redshift machine learning model and running inference queries." /><meta name="deployment_region" content="IAD" /><meta name="product" content="Amazon Redshift" /><meta name="guide" content="Database Developer Guide" /><meta name="abstract" content="Create and manage a data warehouse with Amazon Redshift, an enterprise-level, petabyte scale, fully managed data warehousing service." /><meta name="guide-locale" content="en_us" /><meta name="tocs" content="toc-contents.json" /><link rel="canonical" href="https://docs.aws.amazon.com/redshift/latest/dg/tutorial_customer_churn.html" /><link rel="alternative" href="https://docs.aws.amazon.com/id_id/redshift/latest/dg/tutorial_customer_churn.html" hreflang="id-id" /><link rel="alternative" href="https://docs.aws.amazon.com/id_id/redshift/latest/dg/tutorial_customer_churn.html" hreflang="id" /><link rel="alternative" href="https://docs.aws.amazon.com/de_de/redshift/latest/dg/tutorial_customer_churn.html" hreflang="de-de" /><link rel="alternative" href="https://docs.aws.amazon.com/de_de/redshift/latest/dg/tutorial_customer_churn.html" hreflang="de" /><link rel="alternative" href="https://docs.aws.amazon.com/redshift/latest/dg/tutorial_customer_churn.html" hreflang="en-us" /><link rel="alternative" href="https://docs.aws.amazon.com/redshift/latest/dg/tutorial_customer_churn.html" hreflang="en" /><link rel="alternative" href="https://docs.aws.amazon.com/es_es/redshift/latest/dg/tutorial_customer_churn.html" hreflang="es-es" /><link rel="alternative" href="https://docs.aws.amazon.com/es_es/redshift/latest/dg/tutorial_customer_churn.html" hreflang="es" /><link rel="alternative" href="https://docs.aws.amazon.com/fr_fr/redshift/latest/dg/tutorial_customer_churn.html" hreflang="fr-fr" /><link rel="alternative" href="https://docs.aws.amazon.com/fr_fr/redshift/latest/dg/tutorial_customer_churn.html" hreflang="fr" /><link rel="alternative" href="https://docs.aws.amazon.com/it_it/redshift/latest/dg/tutorial_customer_churn.html" hreflang="it-it" /><link rel="alternative" href="https://docs.aws.amazon.com/it_it/redshift/latest/dg/tutorial_customer_churn.html" hreflang="it" /><link rel="alternative" href="https://docs.aws.amazon.com/ja_jp/redshift/latest/dg/tutorial_customer_churn.html" hreflang="ja-jp" /><link rel="alternative" href="https://docs.aws.amazon.com/ja_jp/redshift/latest/dg/tutorial_customer_churn.html" hreflang="ja" /><link rel="alternative" href="https://docs.aws.amazon.com/ko_kr/redshift/latest/dg/tutorial_customer_churn.html" hreflang="ko-kr" /><link rel="alternative" href="https://docs.aws.amazon.com/ko_kr/redshift/latest/dg/tutorial_customer_churn.html" hreflang="ko" /><link rel="alternative" href="https://docs.aws.amazon.com/pt_br/redshift/latest/dg/tutorial_customer_churn.html" hreflang="pt-br" /><link rel="alternative" href="https://docs.aws.amazon.com/pt_br/redshift/latest/dg/tutorial_customer_churn.html" hreflang="pt" /><link rel="alternative" href="https://docs.aws.amazon.com/zh_cn/redshift/latest/dg/tutorial_customer_churn.html" hreflang="zh-cn" /><link rel="alternative" href="https://docs.aws.amazon.com/zh_tw/redshift/latest/dg/tutorial_customer_churn.html" hreflang="zh-tw" /><link rel="alternative" href="https://docs.aws.amazon.com/redshift/latest/dg/tutorial_customer_churn.html" hreflang="x-default" /><meta name="feedback-item" content="Redshift" /><meta name="this_doc_product" content="Amazon Redshift" /><meta name="this_doc_guide" content="Database Developer Guide" /><script defer="" src="/assets/r/vendor4.js?version=2021.12.02"></script><script defer="" src="/assets/r/vendor3.js?version=2021.12.02"></script><script defer="" src="/assets/r/vendor1.js?version=2021.12.02"></script><script defer="" src="/assets/r/awsdocs-common.js?version=2021.12.02"></script><script defer="" src="/assets/r/awsdocs-doc-page.js?version=2021.12.02"></script><link href="/assets/r/vendor4.css?version=2021.12.02" rel="stylesheet" /><link href="/assets/r/awsdocs-common.css?version=2021.12.02" rel="stylesheet" /><link href="/assets/r/awsdocs-doc-page.css?version=2021.12.02" rel="stylesheet" /><script async="" id="awsc-panorama-bundle" type="text/javascript" src="https://prod.pa.cdn.uis.awsstatic.com/panorama-nav-init.js" data-config="{'appEntity':'aws-documentation','region':'us-east-1','service':'redshift'}"></script><meta id="panorama-serviceSubSection" value="Database Developer Guide" /><meta id="panorama-serviceConsolePage" value="Tutorial: Building customer churn models" /></head><body class="awsdocs awsui"><div class="awsdocs-container"><awsdocs-header></awsdocs-header><awsui-app-layout id="app-layout" class="awsui-util-no-gutters" ng-controller="ContentController as $ctrl" header-selector="awsdocs-header" navigation-hide="false" navigation-width="$ctrl.navWidth" navigation-open="$ctrl.navOpen" navigation-change="$ctrl.onNavChange($event)" tools-hide="$ctrl.hideTools" tools-width="$ctrl.toolsWidth" tools-open="$ctrl.toolsOpen" tools-change="$ctrl.onToolsChange($event)"><div id="guide-toc" dom-region="navigation"><awsdocs-toc></awsdocs-toc></div><div id="main-column" dom-region="content" tabindex="-1"><awsdocs-view class="awsdocs-view"><div id="awsdocs-content"><head><title>Tutorial: Building customer churn models - Amazon Redshift</title><meta name="pdf" content="/pdfs/redshift/latest/dg/redshift-dg.pdf#tutorial_customer_churn" /><meta name="rss" content="Dochistory.rss" /><meta name="forums" content="http://forums.aws.amazon.com/forum.jspa?forumID=155" /><meta name="feedback" content="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=Redshift&amp;topic_url=https://docs.aws.amazon.com/en_us/redshift/latest/dg/tutorial_customer_churn.html" /><meta name="feedback-yes" content="feedbackyes.html?topic_url=https://docs.aws.amazon.com/en_us/redshift/latest/dg/tutorial_customer_churn.html" /><meta name="feedback-no" content="feedbackno.html?topic_url=https://docs.aws.amazon.com/en_us/redshift/latest/dg/tutorial_customer_churn.html" /><meta name="keywords" content="Amazon Redshift,AWS Redshift,Redshift,Redshift Spectrum,cluster,data warehouse,developer,sample data,database,database developer,HLL" /><script type="application/ld+json">
{
    "@context" : "https://schema.org",
    "@type" : "BreadcrumbList",
    "itemListElement" : [
      {
        "@type" : "ListItem",
        "position" : 1,
        "name" : "AWS",
        "item" : "https://aws.amazon.com"
      },
      {
        "@type" : "ListItem",
        "position" : 2,
        "name" : "Amazon Redshift",
        "item" : "https://docs.aws.amazon.com/redshift/index.html"
      },
      {
        "@type" : "ListItem",
        "position" : 3,
        "name" : "Database Developer Guide",
        "item" : "https://docs.aws.amazon.com/redshift/latest/dg"
      },
      {
        "@type" : "ListItem",
        "position" : 4,
        "name" : "Using machine learning in Amazon Redshift",
        "item" : "https://docs.aws.amazon.com/redshift/latest/dg/machine_learning.html"
      },
      {
        "@type" : "ListItem",
        "position" : 5,
        "name" : "Getting started with Amazon Redshift ML",
        "item" : "https://docs.aws.amazon.com/redshift/latest/dg/getting-started-machine-learning.html"
      },
      {
        "@type" : "ListItem",
        "position" : 6,
        "name" : "Tutorials for Amazon Redshift ML",
        "item" : "https://docs.aws.amazon.com/redshift/latest/dg/tutorials_for_amazon_redshift_ml.html"
      },
      {
        "@type" : "ListItem",
        "position" : 7,
        "name" : "Tutorial: Building customer churn models",
        "item" : "https://docs.aws.amazon.com/redshift/latest/dg/tutorials_for_amazon_redshift_ml.html"
      }
    ]
}
</script></head><body><div id="main"><div style="display: none"><a href="/pdfs/redshift/latest/dg/redshift-dg.pdf#tutorial_customer_churn" target="_blank" rel="noopener noreferrer" title="Open PDF"></a></div><div id="breadcrumbs" class="breadcrumb"><a href="https://aws.amazon.com">AWS</a><a href="/index.html">Documentation</a><a href="/redshift/index.html">Amazon Redshift</a><a href="welcome.html">Database Developer Guide</a></div><div id="page-toc-src"><a href="#tutorial_customer_churn_tasks">Use case examples</a><a href="#tutorial_customer_churn_prereqs">Prerequisites</a><a href="#tutorial_customer_churn_step_load">Step 1: Load the data from Amazon S3 to Amazon Redshift</a><a href="#tutorial_customer_churn_step_create_model">Step 2: Create the machine learning model</a><a href="#tutorial_customer_churn_step_perform_predictions">Step 3: Perform predictions with the model</a><a href="#tutorial_customer_churn_related_topics">Related topics</a></div><div id="main-content" class="awsui-util-container"><div id="main-col-body"><awsdocs-language-banner data-service="$ctrl.pageService"></awsdocs-language-banner><h1 class="topictitle" id="tutorial_customer_churn">Tutorial: Building customer churn
               models</h1><div class="awsdocs-page-header-container"><awsdocs-page-header></awsdocs-page-header><awsdocs-filter-selector id="awsdocs-filter-selector"></awsdocs-filter-selector></div><p>In this tutorial, you use Amazon Redshift ML to create a customer churn model with the
            CREATE MODEL command, and run prediction queries for user scenarios. Then, you implement
            queries using the SQL function that the CREATE MODEL command generates.</p><p>You can use a simple CREATE MODEL command to export training data, train a model,
            import the model, and prepare an Amazon Redshift prediction function. Use the CREATE MODEL
            statement to specify training data either as a table or SELECT statement.</p><p>This example uses historical information to construct a machine learning model of a
            mobile operator’s customer churn. First, SageMaker trains your machine learning model and
            then tests your model using the profile information of an arbitrary customer. After the
            model is validated, Amazon SageMaker deploys the model and the prediction function to Amazon Redshift.
            You can use the prediction function to predict whether a customer is going to churn or
            not.</p>
            <h2 id="tutorial_customer_churn_tasks">Use case examples</h2>
            <p>You can solve other binary classification problems using Amazon Redshift ML, 
               such as predicting if a sales lead will close or not. You could also predict whether a 
               financial transaction is fraudulent or not.</p>
            <p><b>Tasks</b></p><div class="itemizedlist">
                
                
                
                
            <ul class="itemizedlist"><li class="listitem">
                  <p>Prerequisites</p>
               </li><li class="listitem">
                  <p>Step 1: Load the data from Amazon S3 to Amazon Redshift</p>
               </li><li class="listitem">
                  <p>Step 2: Create the machine learning model</p>
               </li><li class="listitem">
                  <p>Step 3: Perform predictions with the model</p>
               </li></ul></div>
          
            <h2 id="tutorial_customer_churn_prereqs">Prerequisites</h2>
            <p>To complete this tutorial, you must have the following prerequisites:</p>
            
            
            <div class="itemizedlist">
               
                
                
                
               
            <ul class="itemizedlist"><li class="listitem">
                  <p>You must set up an Amazon Redshift cluster for Amazon Redshift ML. To do so, use the
                     documentation for <a href="https://docs.aws.amazon.com/redshift/latest/dg/admin-setup.html">Cluster and configure setup for Amazon Redshift ML administration.</a></p>
               </li><li class="listitem">
                  <p>The Amazon Redshift cluster that you use to create the model, and the Amazon S3 bucket that
                     you use to stage the training data and store the model artifacts must be in the same
                     AWS Region.</p>
               </li><li class="listitem">
                  <p>To download the SQL commands and the sample dataset used in this
                     documentation, do one of the following:</p>
                  <div class="itemizedlist">
                      
                      
                  <ul class="itemizedlist"><li class="listitem">
                        <p>Download the <a href="https://s3.amazonaws.com/redshift-downloads/redshift-ml/tutorial-scripts/redshift-ml-tutorial.sql" rel="noopener noreferrer" target="_blank"><span>SQL commands</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a>, <a href="https://s3.amazonaws.com/redshift-downloads/redshift-ml/customer_activity/customer_activity.csv" rel="noopener noreferrer" target="_blank"><span>Customer activity file</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a>, and <a href="https://s3.amazonaws.com/redshift-downloads/redshift-ml/abalone_xg/abalone.csv" rel="noopener noreferrer" target="_blank"><span>Abalone file</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a>.</p>
                     </li><li class="listitem">
                        <p>Using the AWS CLI for Amazon S3, run the following command. You can use your
                           own target path.</p>
                        <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="nohighlight">aws s3 cp s3://redshift-downloads/redshift-ml/tutorial-scripts/redshift-ml-tutorial.sql <code class="replaceable">&lt;/target/path&gt;</code>
aws s3 cp s3://redshift-downloads/redshift-ml/customer_activity/customer_activity.csv <code class="replaceable">&lt;/target/path&gt;</code>
aws s3 cp s3://redshift-downloads/redshift-ml/abalone_xgb/abalone_xgb.csv <code class="replaceable">&lt;/target/path&gt;</code></code></pre>
                     </li></ul></div>
               </li></ul></div>
          
            <h2 id="tutorial_customer_churn_step_load">Step 1: Load the data from Amazon S3 to Amazon Redshift</h2>
            <p>Use the <a href="https://docs.aws.amazon.com/redshift/latest/mgmt/query-editor-v2-using.html">Amazon Redshift query editor v2</a> to edit and run queries and visualize results.</p>
            <p>Running the following queries creates a table named
                     <code class="code">customer_activity</code> and ingests the sample dataset from Amazon S3.</p>
            <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="">DROP TABLE IF EXISTS customer_activity;

CREATE TABLE customer_activity (
state varchar(2),
account_length int,
area_code int,
phone varchar(8),
intl_plan varchar(3),
vMail_plan varchar(3),
vMail_message int,
day_mins float,
day_calls int,
day_charge float,
total_charge float,
eve_mins float,
eve_calls int,
eve_charge float,
night_mins float,
night_calls int,
night_charge float,
intl_mins float,
intl_calls int,
intl_charge float,
cust_serv_calls int,
churn varchar(6),
record_date date
);

COPY customer_activity
FROM 's3://redshift-downloads/redshift-ml/customer_activity/'
REGION 'us-east-1' IAM_ROLE default
FORMAT AS CSV IGNOREHEADER 1;</code></pre>
          
            <h2 id="tutorial_customer_churn_step_create_model">Step 2: Create the machine learning model</h2>
            
            <p>Churn is our target input in this model. All other inputs for the model are
               attributes that help to create a function to predict churn.</p>
            <p>The following example uses the CREATE MODEL operation to deliver a model that
               predicts whether a customer will be active, using inputs such as the customer’s age,
               postal code, spending, and cases. In the following example, replace
               <code class="replaceable"><code class="code">DOC-EXAMPLE-BUCKET</code></code> with your own Amazon S3 bucket.</p>
            <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="nohighlight">CREATE MODEL customer_churn_auto_model
FROM
    (
      SELECT state,
             account_length,
             area_code,
             total_charge/account_length AS average_daily_spend,
             cust_serv_calls/account_length AS average_daily_cases,
             churn
      FROM customer_activity
      WHERE  record_date &lt; '2020-01-01'
     )
TARGET churn FUNCTION ml_fn_customer_churn_auto
IAM_ROLE default SETTINGS (
  S3_BUCKET '<code class="replaceable">&lt;DOC-EXAMPLE-BUCKET&gt;</code>'
);</code></pre>
            <p>The SELECT query in the preceding example creates the training data. The TARGET
               clause specifies which column is the machine learning label that the CREATE MODEL operation uses to
               learn how to predict. The target column “churn” indicates whether the customer still
               has an active membership or has suspended the membership. The S3_BUCKET field is the
               name of the Amazon S3 bucket that you previously created. The Amazon S3 bucket is used to share
               training data and artifacts between Amazon Redshift and Amazon SageMaker. The remaining columns are
               the features that are used for the prediction.</p>
            <p>For a summary of the syntax and features of a basic use case of the CREATE MODEL
               command, see <a href="https://docs.aws.amazon.com/redshift/latest/dg/r_create_model_use_cases.html#r_simple_create_model">Simple CREATE MODEL</a>.</p>
             
               <h3 id="tutorial_customer_churn_encryption">Add permissions for server-side encryption (optional)</h3>
               <p>Amazon Redshift by default uses Amazon SageMaker Autopilot for training. In particular,
                     Amazon Redshift securely exports the training data to the customer-specified Amazon S3 bucket.
                     If you don’t specify a <code class="code">KMS_KEY_ID</code>, then the data is encrypted
                     using server-side encryption SSE-S3 by default.</p>
               <p>When you encrypt your input using server-side encryption with a AWS KMS managed
                  key (SSE-MMS), then add the following permissions:</p>
               <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class=""><span>{</span>
    "Effect": "Allow",
    "Action": [
    "kms:Encrypt"
    "kms:Decrypt"
    ]
}</code></pre>
               <p>For more information about Amazon SageMaker roles, see <a href="https://docs.aws.amazon.com/sagemaker/latest/dg/sagemaker-roles.html">Amazon SageMaker roles</a> in the <em>Amazon SageMaker Developer Guide</em>.</p>
               
             
             
               <h3 id="tutorial_customer_churn_check_status">Check the status of model training (optional)</h3>
               <p>You can use the SHOW MODEL command to know when your model is ready.</p><p>Use
                     the following operation to check the status of the
                     model.</p><pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="">SHOW MODEL customer_churn_auto_model;</code></pre><p>The
                     following is an example of the output of the previous
                  operation.</p><pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="nohighlight">+--------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------+
|           Key            |                                                                             Value                                                                             |
+--------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------+
|        Model Name        |                                                                   customer_churn_auto_model                                                                   |
|       Schema Name        |                                                                            public                                                                             |
|          Owner           |                                                                            awsuser                                                                            |
|      Creation Time       |                                                                   Tue, 14.06.2022 17:15:52                                                                    |
|       Model State        |                                                                           TRAINING                                                                            |
|                          |                                                                                                                                                               |
|      TRAINING DATA:      |                                                                                                                                                               |
|          Query           | SELECT STATE, ACCOUNT_LENGTH, AREA_CODE, TOTAL_CHARGE / ACCOUNT_LENGTH AS AVERAGE_DAILY_SPEND, CUST_SERV_CALLS / ACCOUNT_LENGTH AS AVERAGE_DAILY_CASES, CHURN |
|                          |                                                                    FROM CUSTOMER_ACTIVITY                                                                     |
|                          |                                                               WHERE RECORD_DATE &lt; '2020-01-01'                                                                |
|      Target Column       |                                                                             CHURN                                                                             |
|                          |                                                                                                                                                               |
|       PARAMETERS:        |                                                                                                                                                               |
|        Model Type        |                                                                             auto                                                                              |
|       Problem Type       |                                                                                                                                                               |
|        Objective         |                                                                                                                                                               |
|     AutoML Job Name      |                                                                redshiftml-20220614171552640901                                                                |
|      Function Name       |                                                                   ml_fn_customer_churn_auto                                                                   |
|   Function Parameters    |                                            state account_length area_code average_daily_spend average_daily_cases                                             |
| Function Parameter Types |                                                                 varchar int4 int4 float8 int4                                                                 |
|         IAM Role         |                                                                     default-aws-iam-role                                                                      |
|        S3 Bucket         |                                                                        <code class="replaceable">DOC-EXAMPLE-BUCKET</code>                                                                     |
|       Max Runtime        |                                                                             5400                                                                              |
+--------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------+</code></pre><p>When
                  the model training is complete, the <code class="code">model_state</code> variable becomes <code class="code">Model is Ready</code>, and the prediction function becomes available.</p>
             
            
            
            
            
          
            <h2 id="tutorial_customer_churn_step_perform_predictions">Step 3: Perform predictions with the model</h2>
            <p>You can use SQL statements to view the predictions made by the prediction model.
               In this example, the prediction function created by the CREATE MODEL operation is
               named <code class="code">ml_fn_customer_churn_auto</code>. The input arguments for the prediction
               function correspond to the types of the features, such as varchar for the
                  <code class="code">state</code> and integer for <code class="code">account_length</code>. The output of the
               prediction function is the same type as the TARGET column of the CREATE MODEL statement.</p><div class="orderedlist">
                   
                   
                   
               <ol><li>
                     <p>You trained the model on data from before 2020-01-01, so now you use the
                        prediction function on the testing set. The following query displays the
                        predictions of whether customers who signed up after 2020-01-01 will go
                        through churn or not.</p><pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="">SELECT
    phone,
    ml_fn_customer_churn_auto(
        state,
        account_length,
        area_code,
        total_charge / account_length,
        cust_serv_calls / account_length
    ) AS active
FROM
    customer_activity
WHERE
    record_date &gt; '2020-01-01';</code></pre>
                  </li><li>
                     <p>The following example uses the same prediction function for a different
                        use case. In this case, Amazon Redshift predicts the proportion of churners and
                        non-churners among customers from different states where the record date is
                        greater than 2020-01-01.</p>
                     <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="">WITH predicted AS (
    SELECT
        state,
        ml_fn_customer_churn_auto(
            state,
            account_length,
            area_code,
            total_charge / account_length,
            cust_serv_calls / account_length
        ) :: varchar(6) AS active
    FROM
        customer_activity
    WHERE
        record_date &gt; '2020-01-01'
)
SELECT
    state,
    SUM(
        CASE
            WHEN active = 'True.' THEN 1
            ELSE 0
        END
    ) AS churners,
    SUM(
        CASE
            WHEN active = 'False.' THEN 1
            ELSE 0
        END
    ) AS nonchurners,
    COUNT(*) AS total_per_state
FROM
    predicted
GROUP BY
    state
ORDER BY
    state;</code></pre>
                  </li><li>
                     <p>The following example uses the prediction function for the use case of
                           predicting the percentage of customers who churn in a state. In this
                           case, Amazon Redshift predicts the churn percentage where the record date is greater
                           than 2020-01-01.</p><pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="">WITH predicted AS (
    SELECT
        state,
        ml_fn_customer_churn_auto(
            state,
            account_length,
            area_code,
            total_charge / account_length,
            cust_serv_calls / account_length
        ) :: varchar(6) AS active
    FROM
        customer_activity
    WHERE
        record_date &gt; '2020-01-01'
)
SELECT
    state,
    CAST((CAST((SUM(
        CASE
            WHEN active = 'True.' THEN 1
            ELSE 0
        END
    )) AS FLOAT) / CAST(COUNT(*) AS FLOAT)) AS DECIMAL (3, 2)) AS pct_churn,
    COUNT(*) AS total_customers_per_state
FROM
    predicted
GROUP BY
    state
ORDER BY
    3 DESC;</code></pre>
                  </li></ol></div>
          
            <h2 id="tutorial_customer_churn_related_topics">Related topics</h2>
            <p>For more information about Amazon Redshift ML, see the following documentation:</p><div class="itemizedlist">
                   
                   
                   
               <ul class="itemizedlist"><li class="listitem">
                     <p><a href="https://docs.aws.amazon.com/redshift/latest/dg/cost.html">Costs for using Amazon RedshiftML</a></p>
                  </li><li class="listitem">
                     <p><a href="https://docs.aws.amazon.com/redshift/latest/dg/r_CREATE_MODEL.html">CREATE MODEL command</a></p>
                  </li><li class="listitem">
                     <p><a href="https://docs.aws.amazon.com/redshift/latest/dg/r_explain_model_function.html">EXPLAIN_MODEL function</a></p>
                  </li></ul></div>
            <p>For more information about machine learning, see the following documentation:</p>
               <div class="itemizedlist">
                   
                   
                   
               <ul class="itemizedlist"><li class="listitem">
                     <p><a href="https://docs.aws.amazon.com/redshift/latest/dg/machine_learning_overview.html">Machine learning overview</a></p>
                  </li><li class="listitem">
                     <p><a href="https://docs.aws.amazon.com/redshift/latest/dg/novice_expert.html">Machine learning for novices and experts</a></p>
                  </li><li class="listitem">
                     <p><a href="https://docs.aws.amazon.com/sagemaker/latest/dg/clarify-fairness-and-explainability.html">What Is Fairness and Model Explainability for Machine Learning
                           Predictions?</a></p>
                  </li></ul></div>
         <awsdocs-copyright class="copyright-print"></awsdocs-copyright><awsdocs-thumb-feedback right-edge="{{$ctrl.thumbFeedbackRightEdge}}"></awsdocs-thumb-feedback></div><noscript><div><div><div><div id="js_error_message"><p><img src="https://d1ge0kk1l5kms0.cloudfront.net/images/G/01/webservices/console/warning.png" alt="Warning" /> <strong>Javascript is disabled or is unavailable in your browser.</strong></p><p>To use the Amazon Web Services Documentation, Javascript must be enabled. Please refer to your browser's Help pages for instructions.</p></div></div></div></div></noscript><div id="main-col-footer" class="awsui-util-font-size-0"><div id="doc-conventions"><a target="_top" href="/general/latest/gr/docconventions.html">Document Conventions</a></div><div class="prev-next"><div id="previous" class="prev-link" accesskey="p" href="./tutorials_for_amazon_redshift_ml.html">Tutorials for Amazon Redshift ML</div><div id="next" class="next-link" accesskey="n" href="./tutorial_remote_inference.html">Tutorial: Building remote inference models</div></div></div><awsdocs-page-utilities></awsdocs-page-utilities></div><div id="quick-feedback-yes" style="display: none;"><div class="title">Did this page help you? - Yes</div><div class="content"><p>Thanks for letting us know we're doing a good job!</p><p>If you've got a moment, please tell us what we did right so we can do more of it.</p><p><awsui-button id="fblink" rel="noopener noreferrer" target="_blank" text="Feedback" click="linkClick($event)" href="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=Redshift&amp;topic_url=https://docs.aws.amazon.com/en_us/redshift/latest/dg/tutorial_customer_churn.html"></awsui-button></p></div></div><div id="quick-feedback-no" style="display: none;"><div class="title">Did this page help you? - No</div><div class="content"><p>Thanks for letting us know this page needs work. We're sorry we let you down.</p><p>If you've got a moment, please tell us how we can make the documentation better.</p><p><awsui-button id="fblink" rel="noopener noreferrer" target="_blank" text="Feedback" click="linkClick($event)" href="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=Redshift&amp;topic_url=https://docs.aws.amazon.com/en_us/redshift/latest/dg/tutorial_customer_churn.html"></awsui-button></p></div></div></div></body></div></awsdocs-view><div class="page-loading-indicator" id="page-loading-indicator"><awsui-spinner size="large"></awsui-spinner></div></div><div id="tools-panel" dom-region="tools"><awsdocs-tools-panel id="awsdocs-tools-panel"></awsdocs-tools-panel></div></awsui-app-layout><awsdocs-cookie-banner class="doc-cookie-banner"></awsdocs-cookie-banner></div></body></html>