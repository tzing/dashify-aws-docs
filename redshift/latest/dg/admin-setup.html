<!DOCTYPE html>
    <html xmlns="http://www.w3.org/1999/xhtml" lang="en-US"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Cluster and configure setup for Amazon Redshift ML administration - Amazon Redshift</title><meta name="viewport" content="width=device-width,initial-scale=1" /><meta name="assets_root" content="/assets" /><meta name="target_state" content="admin-setup" /><meta name="default_state" content="admin-setup" /><link rel="icon" type="image/ico" href="/assets/images/favicon.ico" /><link rel="shortcut icon" type="image/ico" href="/assets/images/favicon.ico" /><link rel="canonical" href="https://docs.aws.amazon.com/redshift/latest/dg/admin-setup.html" /><meta name="description" content="Before you work with Amazon Redshift ML, complete the cluster setup and configure permissions for using Amazon Redshift ML." /><meta name="deployment_region" content="IAD" /><meta name="product" content="Amazon Redshift" /><meta name="guide" content="Database Developer Guide" /><meta name="abstract" content="Create and manage a data warehouse with Amazon Redshift, an enterprise-level, petabyte scale, fully managed data warehousing service." /><meta name="guide-locale" content="en_us" /><meta name="tocs" content="toc-contents.json" /><link rel="canonical" href="https://docs.aws.amazon.com/redshift/latest/dg/admin-setup.html" /><link rel="alternative" href="https://docs.aws.amazon.com/id_id/redshift/latest/dg/admin-setup.html" hreflang="id-id" /><link rel="alternative" href="https://docs.aws.amazon.com/id_id/redshift/latest/dg/admin-setup.html" hreflang="id" /><link rel="alternative" href="https://docs.aws.amazon.com/de_de/redshift/latest/dg/admin-setup.html" hreflang="de-de" /><link rel="alternative" href="https://docs.aws.amazon.com/de_de/redshift/latest/dg/admin-setup.html" hreflang="de" /><link rel="alternative" href="https://docs.aws.amazon.com/redshift/latest/dg/admin-setup.html" hreflang="en-us" /><link rel="alternative" href="https://docs.aws.amazon.com/redshift/latest/dg/admin-setup.html" hreflang="en" /><link rel="alternative" href="https://docs.aws.amazon.com/es_es/redshift/latest/dg/admin-setup.html" hreflang="es-es" /><link rel="alternative" href="https://docs.aws.amazon.com/es_es/redshift/latest/dg/admin-setup.html" hreflang="es" /><link rel="alternative" href="https://docs.aws.amazon.com/fr_fr/redshift/latest/dg/admin-setup.html" hreflang="fr-fr" /><link rel="alternative" href="https://docs.aws.amazon.com/fr_fr/redshift/latest/dg/admin-setup.html" hreflang="fr" /><link rel="alternative" href="https://docs.aws.amazon.com/it_it/redshift/latest/dg/admin-setup.html" hreflang="it-it" /><link rel="alternative" href="https://docs.aws.amazon.com/it_it/redshift/latest/dg/admin-setup.html" hreflang="it" /><link rel="alternative" href="https://docs.aws.amazon.com/ja_jp/redshift/latest/dg/admin-setup.html" hreflang="ja-jp" /><link rel="alternative" href="https://docs.aws.amazon.com/ja_jp/redshift/latest/dg/admin-setup.html" hreflang="ja" /><link rel="alternative" href="https://docs.aws.amazon.com/ko_kr/redshift/latest/dg/admin-setup.html" hreflang="ko-kr" /><link rel="alternative" href="https://docs.aws.amazon.com/ko_kr/redshift/latest/dg/admin-setup.html" hreflang="ko" /><link rel="alternative" href="https://docs.aws.amazon.com/pt_br/redshift/latest/dg/admin-setup.html" hreflang="pt-br" /><link rel="alternative" href="https://docs.aws.amazon.com/pt_br/redshift/latest/dg/admin-setup.html" hreflang="pt" /><link rel="alternative" href="https://docs.aws.amazon.com/zh_cn/redshift/latest/dg/admin-setup.html" hreflang="zh-cn" /><link rel="alternative" href="https://docs.aws.amazon.com/zh_tw/redshift/latest/dg/admin-setup.html" hreflang="zh-tw" /><link rel="alternative" href="https://docs.aws.amazon.com/redshift/latest/dg/admin-setup.html" hreflang="x-default" /><meta name="feedback-item" content="Redshift" /><meta name="this_doc_product" content="Amazon Redshift" /><meta name="this_doc_guide" content="Database Developer Guide" /><script defer="" src="/assets/r/vendor4.js?version=2021.12.02"></script><script defer="" src="/assets/r/vendor3.js?version=2021.12.02"></script><script defer="" src="/assets/r/vendor1.js?version=2021.12.02"></script><script defer="" src="/assets/r/awsdocs-common.js?version=2021.12.02"></script><script defer="" src="/assets/r/awsdocs-doc-page.js?version=2021.12.02"></script><link href="/assets/r/vendor4.css?version=2021.12.02" rel="stylesheet" /><link href="/assets/r/awsdocs-common.css?version=2021.12.02" rel="stylesheet" /><link href="/assets/r/awsdocs-doc-page.css?version=2021.12.02" rel="stylesheet" /><script async="" id="awsc-panorama-bundle" type="text/javascript" src="https://prod.pa.cdn.uis.awsstatic.com/panorama-nav-init.js" data-config="{'appEntity':'aws-documentation','region':'us-east-1','service':'redshift'}"></script><meta id="panorama-serviceSubSection" value="Database Developer Guide" /><meta id="panorama-serviceConsolePage" value="Cluster and configure setup for Amazon Redshift ML administration" /></head><body class="awsdocs awsui"><div class="awsdocs-container"><awsdocs-header></awsdocs-header><awsui-app-layout id="app-layout" class="awsui-util-no-gutters" ng-controller="ContentController as $ctrl" header-selector="awsdocs-header" navigation-hide="false" navigation-width="$ctrl.navWidth" navigation-open="$ctrl.navOpen" navigation-change="$ctrl.onNavChange($event)" tools-hide="$ctrl.hideTools" tools-width="$ctrl.toolsWidth" tools-open="$ctrl.toolsOpen" tools-change="$ctrl.onToolsChange($event)"><div id="guide-toc" dom-region="navigation"><awsdocs-toc></awsdocs-toc></div><div id="main-column" dom-region="content" tabindex="-1"><awsdocs-view class="awsdocs-view"><div id="awsdocs-content"><head><title>Cluster and configure setup for Amazon Redshift ML administration - Amazon Redshift</title><meta name="pdf" content="/pdfs/redshift/latest/dg/redshift-dg.pdf#admin-setup" /><meta name="rss" content="Dochistory.rss" /><meta name="forums" content="http://forums.aws.amazon.com/forum.jspa?forumID=155" /><meta name="feedback" content="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=Redshift&amp;topic_url=https://docs.aws.amazon.com/en_us/redshift/latest/dg/admin-setup.html" /><meta name="feedback-yes" content="feedbackyes.html?topic_url=https://docs.aws.amazon.com/en_us/redshift/latest/dg/admin-setup.html" /><meta name="feedback-no" content="feedbackno.html?topic_url=https://docs.aws.amazon.com/en_us/redshift/latest/dg/admin-setup.html" /><meta name="keywords" content="Amazon Redshift,AWS Redshift,Redshift,Redshift Spectrum,cluster,data warehouse,developer,sample data,database,database developer,HLL" /><script type="application/ld+json">
{
    "@context" : "https://schema.org",
    "@type" : "BreadcrumbList",
    "itemListElement" : [
      {
        "@type" : "ListItem",
        "position" : 1,
        "name" : "AWS",
        "item" : "https://aws.amazon.com"
      },
      {
        "@type" : "ListItem",
        "position" : 2,
        "name" : "Amazon Redshift",
        "item" : "https://docs.aws.amazon.com/redshift/index.html"
      },
      {
        "@type" : "ListItem",
        "position" : 3,
        "name" : "Database Developer Guide",
        "item" : "https://docs.aws.amazon.com/redshift/latest/dg"
      },
      {
        "@type" : "ListItem",
        "position" : 4,
        "name" : "Using machine learning in Amazon Redshift",
        "item" : "https://docs.aws.amazon.com/redshift/latest/dg/machine_learning.html"
      },
      {
        "@type" : "ListItem",
        "position" : 5,
        "name" : "Getting started with Amazon Redshift ML",
        "item" : "https://docs.aws.amazon.com/redshift/latest/dg/getting-started-machine-learning.html"
      },
      {
        "@type" : "ListItem",
        "position" : 6,
        "name" : "Cluster and configure setup for Amazon Redshift ML administration",
        "item" : "https://docs.aws.amazon.com/redshift/latest/dg/getting-started-machine-learning.html"
      }
    ]
}
</script></head><body><div id="main"><div style="display: none"><a href="/pdfs/redshift/latest/dg/redshift-dg.pdf#admin-setup" target="_blank" rel="noopener noreferrer" title="Open PDF"></a></div><div id="breadcrumbs" class="breadcrumb"><a href="https://aws.amazon.com">AWS</a><a href="/index.html">Documentation</a><a href="/redshift/index.html">Amazon Redshift</a><a href="welcome.html">Database Developer Guide</a></div><div id="page-toc-src"><a href="#cluster-setup">Cluster setup for using Amazon Redshift ML</a><a href="#permissions-ownership">Managing permissions and ownership</a></div><div id="main-content" class="awsui-util-container"><div id="main-col-body"><awsdocs-language-banner data-service="$ctrl.pageService"></awsdocs-language-banner><h1 class="topictitle" id="admin-setup">Cluster and configure setup for Amazon Redshift ML
               administration</h1><div class="awsdocs-page-header-container"><awsdocs-page-header></awsdocs-page-header><awsdocs-filter-selector id="awsdocs-filter-selector"></awsdocs-filter-selector></div><p>Before you work with Amazon Redshift ML, complete the cluster setup and configure
            permissions for using Amazon Redshift ML.</p>
            <h2 id="cluster-setup">Cluster setup for using Amazon Redshift ML</h2>
            <p>Before you work with Amazon Redshift ML, complete the following prerequisites.</p>
            <p>As an Amazon Redshift administrator, do the following one-time setup.</p>
            <div class="procedure"><p>To perform one-time cluster setup for Amazon Redshift ML </p><ol><li>
                  <p>Create a Redshift cluster using the AWS Management Console or the AWS Command Line Interface (AWS CLI).
                     Make sure to attach the AWS Identity and Access Management (IAM) policy while creating the cluster.
                     For more information about permissions required to use Amazon Redshift ML with
                     Amazon SageMaker, see <a href="https://docs.aws.amazon.com/redshift/latest/mgmt/redshift-iam-access-control-identity-based.html#iam-permission-ml">Permissions required to use Amazon Redshift machine learning (ML) with
                        Amazon SageMaker</a>.</p>
               </li><li>
                  <p>Create the IAM role required for using Amazon Redshift ML in one of
                     the following ways:</p>
                  <div class="itemizedlist">
                      
                      
                      
                  <ul class="itemizedlist"><li class="listitem">
                        <p>A simple operation is to create an IAM role with
                              <code class="code">AmazonS3FullAccess</code> and
                              <code class="code">AmazonSageMakerFullAccess</code> policies for use with Amazon Redshift
                           ML. If you plan to also create Forecast models, attach the <code class="code">AmazonForecastFullAccess</code>
                        policy to your role as well.</p>
                     </li><li class="listitem">
                        <p>We recommend that you create an IAM role through the Amazon Redshift console
                           that has the <code class="code">AmazonRedshiftAllCommandsFullAccess</code> policy with
                           permissions to run SQL commands, such as CREATE MODEL. Amazon Redshift uses a
                           seamless API-based mechanism to programmatically create IAM roles in
                           your AWS account on your behalf. Amazon Redshift automatically attaches
                           existing AWS managed policies to the IAM role. This approach means
                           that you can stay within the Amazon Redshift console and don't have to switch
                           to the IAM console for role creation. For more information, see <a href="https://docs.aws.amazon.com/redshift/latest/mgmt/default-iam-role.html">Creating an IAM role as default for Amazon Redshift</a>.</p>
                        <p>When an IAM role is created as the default for your cluster, include
                              <code class="code">redshift</code> as part of the resource name or use a
                           Redshift-specific tag to tag those resources.</p>
                        <p>If your cluster has enhanced Amazon VPC routing turned on, you can use an
                           IAM role created through the Amazon Redshift console. This IAM role has the
                              <code class="code">AmazonRedshiftAllCommandsFullAccess</code> policy attached and
                           adds the following permissions to the policy. These additional
                           permissions allow Amazon Redshift to create and delete an elastic network
                           interface (ENI) in your account and attach it to compilation tasks
                           running on Amazon EC2 or Amazon ECS. Doing this enables objects in your Amazon S3
                           buckets to be accessed only from within a virtual private cloud (VPC)
                           with internet access blocked.</p>
                        <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class=""><span>{</span>
    "Effect": "Allow",
    "Action": [
        "ec2:DescribeVpcEndpoints",
        "ec2:DescribeDhcpOptions",
        "ec2:DescribeVpcs",
        "ec2:DescribeSubnets",
        "ec2:DescribeSecurityGroups",
        "ec2:DescribeNetworkInterfaces",
        "ec2:DeleteNetworkInterfacePermission",
        "ec2:DeleteNetworkInterface",
        "ec2:CreateNetworkInterfacePermission",
        "ec2:CreateNetworkInterface",
        "ec2:ModifyNetworkInterfaceAttribute"
    ],
    "Resource": "*"
}</code></pre>
                     </li><li class="listitem">
                        <p>If you want to create an IAM role with a more restrictive policy,
                           you can use the policy following. You can also modify this policy to meet
                           your needs.</p>
                        <p>The Amazon S3 bucket <code class="code">redshift-downloads/redshift-ml/</code> is the
                           location where the sample data used for other steps and examples is
                           stored. You can remove it if you don't need to load data from Amazon S3.
                           Or, replace it with other Amazon S3 buckets that you use to load data into
                           Amazon Redshift. </p>
                        <p>The <code class="replaceable"><code class="code">your-account-id</code></code>,
                                 <code class="replaceable"><code class="code">your-role</code></code>, and
                                 <code class="replaceable"><code class="code">your-s3-bucket</code></code> values are
                           the ones that you specify as part of your CREATE MODEL command.</p>
                        <p>(Optional) Use the AWS KMS keys section of the sample policy if you
                           specify an AWS KMS key while using Amazon Redshift ML. The
                                 <code class="replaceable"><code class="code">your-kms-key</code></code> value is the
                           key that you use as part of your CREATE MODEL command.</p>
                        <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="nohighlight"><span>{</span>
    "Version": "2012-10-17",
    "Statement": [
        <span>{</span>
            "Effect": "Allow",
            "Action": [
                "cloudwatch:PutMetricData",
                "ecr:BatchCheckLayerAvailability",
                "ecr:BatchGetImage",
                "ecr:GetAuthorizationToken",
                "ecr:GetDownloadUrlForLayer",
                "logs:CreateLogGroup",
                "logs:CreateLogStream",
                "logs:DescribeLogStreams",
                "logs:PutLogEvents",
                "sagemaker:*Job*"
            ],
            "Resource": "*"
        },
        <span>{</span>
            "Effect": "Allow",
            "Action": [
                "iam:PassRole",
                "s3:AbortMultipartUpload",
                "s3:GetObject",
                "s3:DeleteObject",
                "s3:PutObject"
            ],
            "Resource": [
                "arn:aws:iam::<code class="replaceable">&lt;your-account-id&gt;</code>:role/<code class="replaceable">&lt;your-role&gt;</code>",
                "arn:aws:s3:::<code class="replaceable">&lt;your-s3-bucket&gt;</code>/*",
                "arn:aws:s3:::redshift-downloads/*"
            ]
        },
        <span>{</span>
            "Effect": "Allow",
            "Action": [
                "s3:GetBucketLocation",
                "s3:ListBucket"
            ],
            "Resource": [
                "arn:aws:s3:::<code class="replaceable">&lt;your-s3-bucket&gt;</code>",
                "arn:aws:s3:::redshift-downloads"
            ]
        }
        // Optional section needed if you use AWS KMS keys.
        ,<span>{</span>
            "Effect": "Allow",
            "Action": [
                "kms:CreateGrant",
                "kms:Decrypt",
                "kms:DescribeKey",
                "kms:Encrypt",
                "kms:GenerateDataKey*"
             ],
             "Resource": [
                "arn:aws:kms<code class="replaceable">:&lt;your-region&gt;</code>:<code class="replaceable">&lt;your-account-id&gt;</code>:key/<code class="replaceable">&lt;your-kms-key&gt;</code>"
             ]
        }
    ]
}</code></pre>
                     </li></ul></div>
               </li><li>
                  <p>To allow Amazon Redshift and SageMaker to assume the role to interact with other
                     services, add the following trust policy to the IAM role.</p>
                  <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class=""><span>{</span>
  "Version": "2012-10-17",
  "Statement": [
    <span>{</span>
      "Effect": "Allow",
      "Principal": <span>{</span>
        "Service": [
          "redshift.amazonaws.com",
          "sagemaker.amazonaws.com",
          "forecast.amazonaws.com"
        ]
      },
      "Action": "sts:AssumeRole"
    }
  ]
}</code></pre>
               </li><li>
                  <p>(Optional) Create an Amazon S3 bucket and an AWS KMS key. These are for Amazon Redshift to
                     use to store the training data sent to Amazon SageMaker and receive the trained model
                     from Amazon SageMaker.</p>
               </li><li>
                  <p>(Optional) Create different combinations of IAM roles and Amazon S3 buckets for
                     controlling access to different user groups.</p>
               </li><li>
                  <p>(Optional) When you turn on VPC routing for your Redshift cluster, create
                     an Amazon S3 endpoint and a SageMaker endpoint for the VPC that your Redshift cluster is
                     in. Doing this makes it possible for traffic to run through your VPC between
                     services during CREATE MODEL. For more information about VPC routing, see
                        <a href="https://docs.aws.amazon.com/redshift/latest/mgmt/enhanced-vpc-routing.html">Enhanced VPC routing in Amazon Redshift</a>.</p>
                  <p>For more information about permissions required to specify a private VPC for
                     your hyperparameter tuning job, see <a href="https://docs.aws.amazon.com/redshift/latest/mgmt/redshift-iam-access-control-identity-based.html">Permissions required to use Amazon Redshift ML with Amazon SageMaker</a>.</p>
                  
                  
               </li></ol></div>
            <p>For information on how to use the CREATE MODEL statement to start creating models
               for different use cases, see <a href="./r_CREATE_MODEL.html">CREATE MODEL</a>.</p>
          
            <h2 id="permissions-ownership">Managing permissions and ownership</h2>
            <p>Just as with other database objects, such as tables or functions, Amazon Redshift binds
               creating and using ML models to access control mechanisms. There are separate
               permissions for creating a model that runs prediction functions. </p>
            <p>The following examples use two user groups, <code class="code">retention_analyst_grp</code>
               (model creator) and <code class="code">marketing_analyst_grp</code> (model user) to illustrate how
               Amazon Redshift manages access control. The retention analyst creates machine learning
               models that the other set of users can use through acquired permissions. </p>
            <p>A superuser can GRANT USER or GROUP permission to create machine learning models
               using the following statement.</p>
            <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="">GRANT CREATE MODEL TO GROUP retention_analyst_grp;</code></pre>
            <p>Users or groups with this permission can create a model in any schema in the
               cluster if a user has the usual CREATE permission on the SCHEMA. The machine learning
               model is part of the schema hierarchy in a similar way to tables, views, procedures,
               and user-defined functions. </p>
            <p>Assuming a schema <code class="code">demo_ml</code> already exists, grant the two user groups
               the permission on the schema as follows.</p>
            <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="">GRANT CREATE, USAGE ON SCHEMA demo_ml TO GROUP retention_analyst_grp;</code></pre>
            <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="">GRANT USAGE ON SCHEMA demo_ml TO GROUP marketing_analyst_grp;</code></pre>
            <p>To let other users use your machine learning inference function, grant the EXECUTE
               permission. The following example uses the EXECUTE permission to grant the
               marketing_analyst_grp GROUP the permission to use the model.</p>
            <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="">GRANT EXECUTE ON MODEL demo_ml.customer_churn_auto_model TO GROUP marketing_analyst_grp;</code></pre>
            <p>Use the REVOKE statement with CREATE MODEL and EXECUTE to revoke those permissions
               from users or groups. For more information on permission control commands, see <a href="./r_GRANT.html">GRANT</a> and <a href="./r_REVOKE.html">REVOKE</a>.</p>
         <awsdocs-copyright class="copyright-print"></awsdocs-copyright><awsdocs-thumb-feedback right-edge="{{$ctrl.thumbFeedbackRightEdge}}"></awsdocs-thumb-feedback></div><noscript><div><div><div><div id="js_error_message"><p><img src="https://d1ge0kk1l5kms0.cloudfront.net/images/G/01/webservices/console/warning.png" alt="Warning" /> <strong>Javascript is disabled or is unavailable in your browser.</strong></p><p>To use the Amazon Web Services Documentation, Javascript must be enabled. Please refer to your browser's Help pages for instructions.</p></div></div></div></div></noscript><div id="main-col-footer" class="awsui-util-font-size-0"><div id="doc-conventions"><a target="_top" href="/general/latest/gr/docconventions.html">Document Conventions</a></div><div class="prev-next"><div id="previous" class="prev-link" accesskey="p" href="./getting-started-machine-learning.html">Getting started with Amazon Redshift ML</div><div id="next" class="next-link" accesskey="n" href="./clarify.html">Using model explainability with Amazon Redshift ML</div></div></div><awsdocs-page-utilities></awsdocs-page-utilities></div><div id="quick-feedback-yes" style="display: none;"><div class="title">Did this page help you? - Yes</div><div class="content"><p>Thanks for letting us know we're doing a good job!</p><p>If you've got a moment, please tell us what we did right so we can do more of it.</p><p><awsui-button id="fblink" rel="noopener noreferrer" target="_blank" text="Feedback" click="linkClick($event)" href="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=Redshift&amp;topic_url=https://docs.aws.amazon.com/en_us/redshift/latest/dg/admin-setup.html"></awsui-button></p></div></div><div id="quick-feedback-no" style="display: none;"><div class="title">Did this page help you? - No</div><div class="content"><p>Thanks for letting us know this page needs work. We're sorry we let you down.</p><p>If you've got a moment, please tell us how we can make the documentation better.</p><p><awsui-button id="fblink" rel="noopener noreferrer" target="_blank" text="Feedback" click="linkClick($event)" href="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=Redshift&amp;topic_url=https://docs.aws.amazon.com/en_us/redshift/latest/dg/admin-setup.html"></awsui-button></p></div></div></div></body></div></awsdocs-view><div class="page-loading-indicator" id="page-loading-indicator"><awsui-spinner size="large"></awsui-spinner></div></div><div id="tools-panel" dom-region="tools"><awsdocs-tools-panel id="awsdocs-tools-panel"></awsdocs-tools-panel></div></awsui-app-layout><awsdocs-cookie-banner class="doc-cookie-banner"></awsdocs-cookie-banner></div></body></html>