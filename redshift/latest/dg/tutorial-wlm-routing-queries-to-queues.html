<!DOCTYPE html>
    <html xmlns="http://www.w3.org/1999/xhtml" lang="en-US"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Section 3: Routing queries to queues based on user groups and query groups - Amazon Redshift</title><meta name="viewport" content="width=device-width,initial-scale=1" /><meta name="assets_root" content="/assets" /><meta name="target_state" content="tutorial-wlm-routing-queries-to-queues" /><meta name="default_state" content="tutorial-wlm-routing-queries-to-queues" /><link rel="icon" type="image/ico" href="/assets/images/favicon.ico" /><link rel="shortcut icon" type="image/ico" href="/assets/images/favicon.ico" /><link rel="canonical" href="https://docs.aws.amazon.com/redshift/latest/dg/tutorial-wlm-routing-queries-to-queues.html" /><meta name="description" content="Now you have your cluster associated with a new parameter group and you've configured WLM. Next, run some queries to see how Amazon Redshift routes queries into queues for processing." /><meta name="deployment_region" content="IAD" /><meta name="product" content="Amazon Redshift" /><meta name="guide" content="Database Developer Guide" /><meta name="abstract" content="Create and manage a data warehouse with Amazon Redshift, an enterprise-level, petabyte scale, fully managed data warehousing service." /><meta name="guide-locale" content="en_us" /><meta name="tocs" content="toc-contents.json" /><link rel="canonical" href="https://docs.aws.amazon.com/redshift/latest/dg/tutorial-wlm-routing-queries-to-queues.html" /><link rel="alternative" href="https://docs.aws.amazon.com/id_id/redshift/latest/dg/tutorial-wlm-routing-queries-to-queues.html" hreflang="id-id" /><link rel="alternative" href="https://docs.aws.amazon.com/id_id/redshift/latest/dg/tutorial-wlm-routing-queries-to-queues.html" hreflang="id" /><link rel="alternative" href="https://docs.aws.amazon.com/de_de/redshift/latest/dg/tutorial-wlm-routing-queries-to-queues.html" hreflang="de-de" /><link rel="alternative" href="https://docs.aws.amazon.com/de_de/redshift/latest/dg/tutorial-wlm-routing-queries-to-queues.html" hreflang="de" /><link rel="alternative" href="https://docs.aws.amazon.com/redshift/latest/dg/tutorial-wlm-routing-queries-to-queues.html" hreflang="en-us" /><link rel="alternative" href="https://docs.aws.amazon.com/redshift/latest/dg/tutorial-wlm-routing-queries-to-queues.html" hreflang="en" /><link rel="alternative" href="https://docs.aws.amazon.com/es_es/redshift/latest/dg/tutorial-wlm-routing-queries-to-queues.html" hreflang="es-es" /><link rel="alternative" href="https://docs.aws.amazon.com/es_es/redshift/latest/dg/tutorial-wlm-routing-queries-to-queues.html" hreflang="es" /><link rel="alternative" href="https://docs.aws.amazon.com/fr_fr/redshift/latest/dg/tutorial-wlm-routing-queries-to-queues.html" hreflang="fr-fr" /><link rel="alternative" href="https://docs.aws.amazon.com/fr_fr/redshift/latest/dg/tutorial-wlm-routing-queries-to-queues.html" hreflang="fr" /><link rel="alternative" href="https://docs.aws.amazon.com/it_it/redshift/latest/dg/tutorial-wlm-routing-queries-to-queues.html" hreflang="it-it" /><link rel="alternative" href="https://docs.aws.amazon.com/it_it/redshift/latest/dg/tutorial-wlm-routing-queries-to-queues.html" hreflang="it" /><link rel="alternative" href="https://docs.aws.amazon.com/ja_jp/redshift/latest/dg/tutorial-wlm-routing-queries-to-queues.html" hreflang="ja-jp" /><link rel="alternative" href="https://docs.aws.amazon.com/ja_jp/redshift/latest/dg/tutorial-wlm-routing-queries-to-queues.html" hreflang="ja" /><link rel="alternative" href="https://docs.aws.amazon.com/ko_kr/redshift/latest/dg/tutorial-wlm-routing-queries-to-queues.html" hreflang="ko-kr" /><link rel="alternative" href="https://docs.aws.amazon.com/ko_kr/redshift/latest/dg/tutorial-wlm-routing-queries-to-queues.html" hreflang="ko" /><link rel="alternative" href="https://docs.aws.amazon.com/pt_br/redshift/latest/dg/tutorial-wlm-routing-queries-to-queues.html" hreflang="pt-br" /><link rel="alternative" href="https://docs.aws.amazon.com/pt_br/redshift/latest/dg/tutorial-wlm-routing-queries-to-queues.html" hreflang="pt" /><link rel="alternative" href="https://docs.aws.amazon.com/zh_cn/redshift/latest/dg/tutorial-wlm-routing-queries-to-queues.html" hreflang="zh-cn" /><link rel="alternative" href="https://docs.aws.amazon.com/zh_tw/redshift/latest/dg/tutorial-wlm-routing-queries-to-queues.html" hreflang="zh-tw" /><link rel="alternative" href="https://docs.aws.amazon.com/redshift/latest/dg/tutorial-wlm-routing-queries-to-queues.html" hreflang="x-default" /><meta name="feedback-item" content="Redshift" /><meta name="this_doc_product" content="Amazon Redshift" /><meta name="this_doc_guide" content="Database Developer Guide" /><script defer="" src="/assets/r/vendor4.js?version=2021.12.02"></script><script defer="" src="/assets/r/vendor3.js?version=2021.12.02"></script><script defer="" src="/assets/r/vendor1.js?version=2021.12.02"></script><script defer="" src="/assets/r/awsdocs-common.js?version=2021.12.02"></script><script defer="" src="/assets/r/awsdocs-doc-page.js?version=2021.12.02"></script><link href="/assets/r/vendor4.css?version=2021.12.02" rel="stylesheet" /><link href="/assets/r/awsdocs-common.css?version=2021.12.02" rel="stylesheet" /><link href="/assets/r/awsdocs-doc-page.css?version=2021.12.02" rel="stylesheet" /><script async="" id="awsc-panorama-bundle" type="text/javascript" src="https://prod.pa.cdn.uis.awsstatic.com/panorama-nav-init.js" data-config="{'appEntity':'aws-documentation','region':'us-east-1','service':'redshift'}"></script><meta id="panorama-serviceSubSection" value="Database Developer Guide" /><meta id="panorama-serviceConsolePage" value="Section 3: Routing queries to queues based on user groups and query groups" /></head><body class="awsdocs awsui"><div class="awsdocs-container"><awsdocs-header></awsdocs-header><awsui-app-layout id="app-layout" class="awsui-util-no-gutters" ng-controller="ContentController as $ctrl" header-selector="awsdocs-header" navigation-hide="false" navigation-width="$ctrl.navWidth" navigation-open="$ctrl.navOpen" navigation-change="$ctrl.onNavChange($event)" tools-hide="$ctrl.hideTools" tools-width="$ctrl.toolsWidth" tools-open="$ctrl.toolsOpen" tools-change="$ctrl.onToolsChange($event)"><div id="guide-toc" dom-region="navigation"><awsdocs-toc></awsdocs-toc></div><div id="main-column" dom-region="content" tabindex="-1"><awsdocs-view class="awsdocs-view"><div id="awsdocs-content"><head><title>Section 3: Routing queries to queues based on user groups and query groups - Amazon Redshift</title><meta name="pdf" content="/pdfs/redshift/latest/dg/redshift-dg.pdf#tutorial-wlm-routing-queries-to-queues" /><meta name="rss" content="Dochistory.rss" /><meta name="forums" content="http://forums.aws.amazon.com/forum.jspa?forumID=155" /><meta name="feedback" content="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=Redshift&amp;topic_url=https://docs.aws.amazon.com/en_us/redshift/latest/dg/tutorial-wlm-routing-queries-to-queues.html" /><meta name="feedback-yes" content="feedbackyes.html?topic_url=https://docs.aws.amazon.com/en_us/redshift/latest/dg/tutorial-wlm-routing-queries-to-queues.html" /><meta name="feedback-no" content="feedbackno.html?topic_url=https://docs.aws.amazon.com/en_us/redshift/latest/dg/tutorial-wlm-routing-queries-to-queues.html" /><meta name="keywords" content="Amazon Redshift,AWS Redshift,Redshift,Redshift Spectrum,cluster,data warehouse,developer,sample data,database,database developer,HLL" /><script type="application/ld+json">
{
    "@context" : "https://schema.org",
    "@type" : "BreadcrumbList",
    "itemListElement" : [
      {
        "@type" : "ListItem",
        "position" : 1,
        "name" : "AWS",
        "item" : "https://aws.amazon.com"
      },
      {
        "@type" : "ListItem",
        "position" : 2,
        "name" : "Amazon Redshift",
        "item" : "https://docs.aws.amazon.com/redshift/index.html"
      },
      {
        "@type" : "ListItem",
        "position" : 3,
        "name" : "Database Developer Guide",
        "item" : "https://docs.aws.amazon.com/redshift/latest/dg"
      },
      {
        "@type" : "ListItem",
        "position" : 4,
        "name" : "Implementing workload management",
        "item" : "https://docs.aws.amazon.com/redshift/latest/dg/cm-c-implementing-workload-management.html"
      },
      {
        "@type" : "ListItem",
        "position" : 5,
        "name" : "Implementing manual WLM",
        "item" : "https://docs.aws.amazon.com/redshift/latest/dg/cm-c-defining-query-queues.html"
      },
      {
        "@type" : "ListItem",
        "position" : 6,
        "name" : "Tutorial: Configuring manual workload management (WLM) queues",
        "item" : "https://docs.aws.amazon.com/redshift/latest/dg/tutorial-configuring-workload-management.html"
      },
      {
        "@type" : "ListItem",
        "position" : 7,
        "name" : "Section 3: Routing queries to queues based on user groups and query groups",
        "item" : "https://docs.aws.amazon.com/redshift/latest/dg/tutorial-configuring-workload-management.html"
      }
    ]
}
</script></head><body><div id="main"><div style="display: none"><a href="/pdfs/redshift/latest/dg/redshift-dg.pdf#tutorial-wlm-routing-queries-to-queues" target="_blank" rel="noopener noreferrer" title="Open PDF"></a></div><div id="breadcrumbs" class="breadcrumb"><a href="https://aws.amazon.com">AWS</a><a href="/index.html">Documentation</a><a href="/redshift/index.html">Amazon Redshift</a><a href="welcome.html">Database Developer Guide</a></div><div id="page-toc-src"><a href="#tutorial-wlm-view-query-config">Step 1: View query queue
                    configuration in the database</a><a href="#tutorial-wlm-query-group">Step 2: Run a query using the query group
                    queue</a><a href="#tutorial-wlm-create-db-user-and-group">Step 3: Create a database
                    user and group</a><a href="#tutorial-wlm-user-group-query">Step 4: Run a query using the user
                    group queue</a></div><div id="main-content" class="awsui-util-container"><div id="main-col-body"><awsdocs-language-banner data-service="$ctrl.pageService"></awsdocs-language-banner><h1 class="topictitle" id="tutorial-wlm-routing-queries-to-queues">Section 3: Routing queries to
                queues based on user groups and query groups</h1><div class="awsdocs-page-header-container"><awsdocs-page-header></awsdocs-page-header><awsdocs-filter-selector id="awsdocs-filter-selector"></awsdocs-filter-selector></div><p>Now you have your cluster associated with a new parameter group and you've
            configured WLM. Next, run some queries to see how Amazon Redshift routes queries into queues
            for processing.</p>
            <h2 id="tutorial-wlm-view-query-config">Step 1: View query queue
                    configuration in the database</h2>

            <p>First, verify that the database has the WLM configuration that you expect.</p>
             
                <h3 id="how-to-wlm-view-query-config">To view the query queue
                        configuration</h3>

                <div class="orderedlist">
                     
                     
                <ol><li>
                        <p>Open RSQL and run the following query. The query uses the
                            WLM_QUEUE_STATE_VW view you created in <a href="./tutorial-wlm-understanding-default-processing.html#tutorial-wlm-create-queue-state-view">Step 1: Create the
                    WLM_QUEUE_STATE_VW view</a>. If you
                            already had a session connected to the database prior to the cluster
                            reboot, you need to reconnect.</p>
                        <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="">select * from wlm_queue_state_vw;</code></pre>
                        <p>The following is an example result.</p>
                        <div class="mediaobject">
                             
                                <img src="/images/redshift/latest/dg/images/psql_tutorial_wlm_060.png" class="aws-docs-img-whiteBg aws-docs-img-padding" />
                             
                        </div>
                        <p>Compare these results to the results you received in <a href="./tutorial-wlm-understanding-default-processing.html#tutorial-wlm-create-queue-state-view">Step 1: Create the
                    WLM_QUEUE_STATE_VW view</a>. Notice that
                            there are now two additional queues. Queue 1 is now the queue for the
                            test query group, and queue 2 is the queue for the admin user
                            group.</p>
                        <p>Queue 3 is now the default queue. The last queue in the list is always
                            the default queue. That's the queue to which queries are routed by
                            default if no user group or query group is specified in a query.</p>
                    </li><li>
                        <p>Run the following query to confirm that your query now runs in queue
                            3.</p>
                        <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="">select * from wlm_query_state_vw;</code></pre>
                        <p>The following is an example result.</p>
                        <div class="mediaobject">
                             
                                <img src="/images/redshift/latest/dg/images/psql_tutorial_wlm_070.png" class="aws-docs-img-whiteBg aws-docs-img-padding" />
                             
                        </div>
                    </li></ol></div>
             
         
            <h2 id="tutorial-wlm-query-group">Step 2: Run a query using the query group
                    queue</h2>


             
                <h3 id="how-to-wlm-query-group">To run a query using the query group
                        queue</h3>

                <div class="orderedlist">
                     
                     
                     
                     
                     
                <ol><li>
                        <p>Run the following query to route it to the <code class="code">test</code> query
                            group.</p>
                        <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="">set query_group to test;
select avg(l.priceperticket*s.qtysold) from listing l, sales s where l.listid &lt;40000;</code></pre>
                    </li><li>
                        <p>From the other RSQL window, run the following query.</p>
                        <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="">select * from wlm_query_state_vw;</code></pre>
                        <p>The following is an example result.</p>
                        <div class="mediaobject">
                             
                                <img src="/images/redshift/latest/dg/images/psql_tutorial_wlm_080.png" class="aws-docs-img-whiteBg aws-docs-img-padding" />
                             
                        </div>
                        <p>The query was routed to the test query group, which is queue 1
                            now.</p>
                    </li><li>
                        <p>Select all from the queue state view.</p>
                        <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="">select * from wlm_queue_state_vw;</code></pre>
                        <p>You see a result similar to the following.</p>
                        <div class="mediaobject">
                             
                                <img src="/images/redshift/latest/dg/images/psql_tutorial_wlm_090.png" class="aws-docs-img-whiteBg aws-docs-img-padding" />
                             
                        </div>
                    </li><li>
                        <p>Now, reset the query group and run the long query again:</p>
                        <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="">reset query_group;
select avg(l.priceperticket*s.qtysold) from listing l, sales s where l.listid &lt;40000;</code></pre>
                    </li><li>
                        <p>Run the queries against the views to see the results.</p>
                        <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="">select * from wlm_queue_state_vw;
select * from wlm_query_state_vw;</code></pre>
                        <p>The following are example results.</p>
                        <div class="mediaobject">
                             
                                <img src="/images/redshift/latest/dg/images/psql_tutorial_wlm_100.png" class="aws-docs-img-whiteBg aws-docs-img-padding" />
                             
                        </div>
                        <div class="mediaobject">
                             
                                <img src="/images/redshift/latest/dg/images/psql_tutorial_wlm_110.png" class="aws-docs-img-whiteBg aws-docs-img-padding" />
                             
                        </div>
                        <p>The result should be that the query is now running in queue 3
                            again.</p>
                    </li></ol></div>
             
         
            <h2 id="tutorial-wlm-create-db-user-and-group">Step 3: Create a database
                    user and group</h2>

            <p>Before you can run any
                queries in this queue, you need to create the user group in the database and add a
                user to the group. Then you log in with RSQL using the new user’s credentials and
                run queries. You need to run queries as a superuser, such as the admin user, to
                create database users.</p>
             
                <h3 id="how-to-wlm-create-db-user-and-group">To create a new database
                        user and user group</h3>

                <div class="orderedlist">
                     
                     
                <ol><li>
                        <p>In the database, create a new database user named
                                <code class="code">adminwlm</code> by running the following command in an RSQL
                            window.</p>
                        <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="">create user adminwlm createuser password '123Admin';</code></pre>
                    </li><li>
                        <p>Then, run the following commands to create the new user group and add
                            your new <code class="code">adminwlm</code> user to it.</p>
                        <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="">create group admin;
alter group admin add user adminwlm;</code></pre>
                    </li></ol></div>
             
         
            <h2 id="tutorial-wlm-user-group-query">Step 4: Run a query using the user
                    group queue</h2>

            <p>Next you run a query and route it to the user group queue. You do this when you
                want to route your query to a queue that is configured to handle the type of query
                you want to run.</p>
             
                <h3 id="how-to-wlm-user-group-query">To run a query using the user
                        group queue</h3>

                <div class="orderedlist">
                     
                     
                     
                     
                     
                <ol><li>
                        <p>In RSQL window 2, run the following queries to switch to the
                                <code class="code">adminwlm</code> account and run a query as that user.</p>
                        <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="">set session authorization 'adminwlm';
select avg(l.priceperticket*s.qtysold) from listing l, sales s where l.listid &lt;40000;</code></pre>
                    </li><li>
                        <p>In RSQL window 1, run the following query to see the query queue that
                            the queries are routed to.</p>
                        <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="">select * from wlm_query_state_vw;
select * from wlm_queue_state_vw;</code></pre>
                        <p>The following are example results.</p>
                        <div class="mediaobject">
                             
                                <img src="/images/redshift/latest/dg/images/psql_tutorial_wlm_120.png" class="aws-docs-img-whiteBg aws-docs-img-padding" />
                             
                        </div>
                        <div class="mediaobject">
                             
                                <img src="/images/redshift/latest/dg/images/psql_tutorial_wlm_130.png" class="aws-docs-img-whiteBg aws-docs-img-padding" />
                             
                        </div>
                        <p>The queue that this query ran in is queue 2, the <code class="code">admin</code>
                            user queue. Anytime you run queries logged in as this user, they run in
                            queue 2 unless you specify a different query group to use.
                             The chosen queue depends on
                            the queue assignment rules. For more information, see <a href="./cm-c-wlm-queue-assignment-rules.html">WLM queue assignment rules</a>. </p>
                    </li><li>
                        <p>Now run the following query from RSQL window 2.</p>
                        <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="">set query_group to test;
select avg(l.priceperticket*s.qtysold) from listing l, sales s where l.listid &lt;40000;</code></pre>
                    </li><li>
                        <p>In RSQL window 1, run the following query to see the query queue that
                            the queries are routed to.</p>
                        <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="">select * from wlm_queue_state_vw;
select * from wlm_query_state_vw;</code></pre>
                        <p>The following are example results.</p>
                        <div class="mediaobject">
                             
                                <img src="/images/redshift/latest/dg/images/psql_tutorial_wlm_140.png" class="aws-docs-img-whiteBg aws-docs-img-padding" />
                             
                        </div>
                        <div class="mediaobject">
                             
                                <img src="/images/redshift/latest/dg/images/psql_tutorial_wlm_150.png" class="aws-docs-img-whiteBg aws-docs-img-padding" />
                             
                        </div>
                    </li><li>
                        <p>When you’re done, reset the query group.</p>
                        <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="">reset query_group;</code></pre>
                    </li></ol></div>
             
        <awsdocs-copyright class="copyright-print"></awsdocs-copyright><awsdocs-thumb-feedback right-edge="{{$ctrl.thumbFeedbackRightEdge}}"></awsdocs-thumb-feedback></div><noscript><div><div><div><div id="js_error_message"><p><img src="https://d1ge0kk1l5kms0.cloudfront.net/images/G/01/webservices/console/warning.png" alt="Warning" /> <strong>Javascript is disabled or is unavailable in your browser.</strong></p><p>To use the Amazon Web Services Documentation, Javascript must be enabled. Please refer to your browser's Help pages for instructions.</p></div></div></div></div></noscript><div id="main-col-footer" class="awsui-util-font-size-0"><div id="doc-conventions"><a target="_top" href="/general/latest/gr/docconventions.html">Document Conventions</a></div><div class="prev-next"><div id="previous" class="prev-link" accesskey="p" href="./tutorial-wlm-modifying-wlm-configuration.html">Section 2: Modifying the WLM
                query queue configuration</div><div id="next" class="next-link" accesskey="n" href="./tutorial-wlm-query-slot-count.html">Section 4: Using wlm_query_slot_count to
                temporarily override the concurrency level in a queue</div></div></div><awsdocs-page-utilities></awsdocs-page-utilities></div><div id="quick-feedback-yes" style="display: none;"><div class="title">Did this page help you? - Yes</div><div class="content"><p>Thanks for letting us know we're doing a good job!</p><p>If you've got a moment, please tell us what we did right so we can do more of it.</p><p><awsui-button id="fblink" rel="noopener noreferrer" target="_blank" text="Feedback" click="linkClick($event)" href="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=Redshift&amp;topic_url=https://docs.aws.amazon.com/en_us/redshift/latest/dg/tutorial-wlm-routing-queries-to-queues.html"></awsui-button></p></div></div><div id="quick-feedback-no" style="display: none;"><div class="title">Did this page help you? - No</div><div class="content"><p>Thanks for letting us know this page needs work. We're sorry we let you down.</p><p>If you've got a moment, please tell us how we can make the documentation better.</p><p><awsui-button id="fblink" rel="noopener noreferrer" target="_blank" text="Feedback" click="linkClick($event)" href="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=Redshift&amp;topic_url=https://docs.aws.amazon.com/en_us/redshift/latest/dg/tutorial-wlm-routing-queries-to-queues.html"></awsui-button></p></div></div></div></body></div></awsdocs-view><div class="page-loading-indicator" id="page-loading-indicator"><awsui-spinner size="large"></awsui-spinner></div></div><div id="tools-panel" dom-region="tools"><awsdocs-tools-panel id="awsdocs-tools-panel"></awsdocs-tools-panel></div></awsui-app-layout><awsdocs-cookie-banner class="doc-cookie-banner"></awsdocs-cookie-banner></div></body></html>