<!DOCTYPE html>
    <html xmlns="http://www.w3.org/1999/xhtml" lang="en-US"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Serializing complex nested JSON - Amazon Redshift</title><meta name="viewport" content="width=device-width,initial-scale=1" /><meta name="assets_root" content="/assets" /><meta name="target_state" content="serializing-complex-JSON" /><meta name="default_state" content="serializing-complex-JSON" /><link rel="icon" type="image/ico" href="/assets/images/favicon.ico" /><link rel="shortcut icon" type="image/ico" href="/assets/images/favicon.ico" /><link rel="canonical" href="https://docs.aws.amazon.com/redshift/latest/dg/serializing-complex-JSON.html" /><meta name="description" content="An alternate to methods demonstrated in this tutorial is to query top-level nested collection columns as serialized JSON. You can use the serialization to inspect, convert, and ingest nested data as JSON with Redshift Spectrum. This method is supported for ORC, JSON, Ion, and Parquet formats. Use the session configuration parameter" /><meta name="deployment_region" content="IAD" /><meta name="product" content="Amazon Redshift" /><meta name="guide" content="Database Developer Guide" /><meta name="abstract" content="Create and manage a data warehouse with Amazon Redshift, an enterprise-level, petabyte scale, fully managed data warehousing service." /><meta name="guide-locale" content="en_us" /><meta name="tocs" content="toc-contents.json" /><link rel="canonical" href="https://docs.aws.amazon.com/redshift/latest/dg/serializing-complex-JSON.html" /><link rel="alternative" href="https://docs.aws.amazon.com/id_id/redshift/latest/dg/serializing-complex-JSON.html" hreflang="id-id" /><link rel="alternative" href="https://docs.aws.amazon.com/id_id/redshift/latest/dg/serializing-complex-JSON.html" hreflang="id" /><link rel="alternative" href="https://docs.aws.amazon.com/de_de/redshift/latest/dg/serializing-complex-JSON.html" hreflang="de-de" /><link rel="alternative" href="https://docs.aws.amazon.com/de_de/redshift/latest/dg/serializing-complex-JSON.html" hreflang="de" /><link rel="alternative" href="https://docs.aws.amazon.com/redshift/latest/dg/serializing-complex-JSON.html" hreflang="en-us" /><link rel="alternative" href="https://docs.aws.amazon.com/redshift/latest/dg/serializing-complex-JSON.html" hreflang="en" /><link rel="alternative" href="https://docs.aws.amazon.com/es_es/redshift/latest/dg/serializing-complex-JSON.html" hreflang="es-es" /><link rel="alternative" href="https://docs.aws.amazon.com/es_es/redshift/latest/dg/serializing-complex-JSON.html" hreflang="es" /><link rel="alternative" href="https://docs.aws.amazon.com/fr_fr/redshift/latest/dg/serializing-complex-JSON.html" hreflang="fr-fr" /><link rel="alternative" href="https://docs.aws.amazon.com/fr_fr/redshift/latest/dg/serializing-complex-JSON.html" hreflang="fr" /><link rel="alternative" href="https://docs.aws.amazon.com/it_it/redshift/latest/dg/serializing-complex-JSON.html" hreflang="it-it" /><link rel="alternative" href="https://docs.aws.amazon.com/it_it/redshift/latest/dg/serializing-complex-JSON.html" hreflang="it" /><link rel="alternative" href="https://docs.aws.amazon.com/ja_jp/redshift/latest/dg/serializing-complex-JSON.html" hreflang="ja-jp" /><link rel="alternative" href="https://docs.aws.amazon.com/ja_jp/redshift/latest/dg/serializing-complex-JSON.html" hreflang="ja" /><link rel="alternative" href="https://docs.aws.amazon.com/ko_kr/redshift/latest/dg/serializing-complex-JSON.html" hreflang="ko-kr" /><link rel="alternative" href="https://docs.aws.amazon.com/ko_kr/redshift/latest/dg/serializing-complex-JSON.html" hreflang="ko" /><link rel="alternative" href="https://docs.aws.amazon.com/pt_br/redshift/latest/dg/serializing-complex-JSON.html" hreflang="pt-br" /><link rel="alternative" href="https://docs.aws.amazon.com/pt_br/redshift/latest/dg/serializing-complex-JSON.html" hreflang="pt" /><link rel="alternative" href="https://docs.aws.amazon.com/zh_cn/redshift/latest/dg/serializing-complex-JSON.html" hreflang="zh-cn" /><link rel="alternative" href="https://docs.aws.amazon.com/zh_tw/redshift/latest/dg/serializing-complex-JSON.html" hreflang="zh-tw" /><link rel="alternative" href="https://docs.aws.amazon.com/redshift/latest/dg/serializing-complex-JSON.html" hreflang="x-default" /><meta name="feedback-item" content="Redshift" /><meta name="this_doc_product" content="Amazon Redshift" /><meta name="this_doc_guide" content="Database Developer Guide" /><script defer="" src="/assets/r/vendor4.js?version=2021.12.02"></script><script defer="" src="/assets/r/vendor3.js?version=2021.12.02"></script><script defer="" src="/assets/r/vendor1.js?version=2021.12.02"></script><script defer="" src="/assets/r/awsdocs-common.js?version=2021.12.02"></script><script defer="" src="/assets/r/awsdocs-doc-page.js?version=2021.12.02"></script><link href="/assets/r/vendor4.css?version=2021.12.02" rel="stylesheet" /><link href="/assets/r/awsdocs-common.css?version=2021.12.02" rel="stylesheet" /><link href="/assets/r/awsdocs-doc-page.css?version=2021.12.02" rel="stylesheet" /><script async="" id="awsc-panorama-bundle" type="text/javascript" src="https://prod.pa.cdn.uis.awsstatic.com/panorama-nav-init.js" data-config="{'appEntity':'aws-documentation','region':'us-east-1','service':'redshift'}"></script><meta id="panorama-serviceSubSection" value="Database Developer Guide" /><meta id="panorama-serviceConsolePage" value="Serializing complex nested JSON" /></head><body class="awsdocs awsui"><div class="awsdocs-container"><awsdocs-header></awsdocs-header><awsui-app-layout id="app-layout" class="awsui-util-no-gutters" ng-controller="ContentController as $ctrl" header-selector="awsdocs-header" navigation-hide="false" navigation-width="$ctrl.navWidth" navigation-open="$ctrl.navOpen" navigation-change="$ctrl.onNavChange($event)" tools-hide="$ctrl.hideTools" tools-width="$ctrl.toolsWidth" tools-open="$ctrl.toolsOpen" tools-change="$ctrl.onToolsChange($event)"><div id="guide-toc" dom-region="navigation"><awsdocs-toc></awsdocs-toc></div><div id="main-column" dom-region="content" tabindex="-1"><awsdocs-view class="awsdocs-view"><div id="awsdocs-content"><head><title>Serializing complex nested JSON - Amazon Redshift</title><meta name="pdf" content="/pdfs/redshift/latest/dg/redshift-dg.pdf#serializing-complex-JSON" /><meta name="rss" content="Dochistory.rss" /><meta name="forums" content="http://forums.aws.amazon.com/forum.jspa?forumID=155" /><meta name="feedback" content="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=Redshift&amp;topic_url=https://docs.aws.amazon.com/en_us/redshift/latest/dg/serializing-complex-JSON.html" /><meta name="feedback-yes" content="feedbackyes.html?topic_url=https://docs.aws.amazon.com/en_us/redshift/latest/dg/serializing-complex-JSON.html" /><meta name="feedback-no" content="feedbackno.html?topic_url=https://docs.aws.amazon.com/en_us/redshift/latest/dg/serializing-complex-JSON.html" /><meta name="keywords" content="Amazon Redshift,AWS Redshift,Redshift,Redshift Spectrum,cluster,data warehouse,developer,sample data,database,database developer,HLL" /><script type="application/ld+json">
{
    "@context" : "https://schema.org",
    "@type" : "BreadcrumbList",
    "itemListElement" : [
      {
        "@type" : "ListItem",
        "position" : 1,
        "name" : "AWS",
        "item" : "https://aws.amazon.com"
      },
      {
        "@type" : "ListItem",
        "position" : 2,
        "name" : "Amazon Redshift",
        "item" : "https://docs.aws.amazon.com/redshift/index.html"
      },
      {
        "@type" : "ListItem",
        "position" : 3,
        "name" : "Database Developer Guide",
        "item" : "https://docs.aws.amazon.com/redshift/latest/dg"
      },
      {
        "@type" : "ListItem",
        "position" : 4,
        "name" : "Querying external data using Amazon Redshift Spectrum",
        "item" : "https://docs.aws.amazon.com/redshift/latest/dg/c-using-spectrum.html"
      },
      {
        "@type" : "ListItem",
        "position" : 5,
        "name" : "Tutorial: Querying nested data with Amazon Redshift Spectrum",
        "item" : "https://docs.aws.amazon.com/redshift/latest/dg/tutorial-query-nested-data.html"
      },
      {
        "@type" : "ListItem",
        "position" : 6,
        "name" : "Serializing complex nested JSON",
        "item" : "https://docs.aws.amazon.com/redshift/latest/dg/tutorial-query-nested-data.html"
      }
    ]
}
</script></head><body><div id="main"><div style="display: none"><a href="/pdfs/redshift/latest/dg/redshift-dg.pdf#serializing-complex-JSON" target="_blank" rel="noopener noreferrer" title="Open PDF"></a></div><div id="breadcrumbs" class="breadcrumb"><a href="https://aws.amazon.com">AWS</a><a href="/index.html">Documentation</a><a href="/redshift/index.html">Amazon Redshift</a><a href="welcome.html">Database Developer Guide</a></div><div id="page-toc-src"><a href="#serializing-complex-JSON-strings">Serializing complex types containing JSON strings</a></div><div id="main-content" class="awsui-util-container"><div id="main-col-body"><awsdocs-language-banner data-service="$ctrl.pageService"></awsdocs-language-banner><h1 class="topictitle" id="serializing-complex-JSON">Serializing complex nested JSON</h1><div class="awsdocs-page-header-container"><awsdocs-page-header></awsdocs-page-header><awsdocs-filter-selector id="awsdocs-filter-selector"></awsdocs-filter-selector></div><p>An alternate to methods demonstrated in this tutorial is to query top-level nested
            collection columns as serialized JSON. You can use the serialization to inspect,
            convert, and ingest nested data as JSON with Redshift Spectrum. This method is supported for ORC,
            JSON, Ion, and Parquet formats. Use the session configuration parameter
                <code class="code">json_serialization_enable</code> to configure the serialization behavior. When
            set, complex JSON data types are serialized to VARCHAR(65535). The nested JSON can be
            accessed with <a href="./json-functions.html">JSON functions</a>. For more
            information, see <a href="./r_json_serialization_enable.html">json_serialization_enable</a>.</p><p>For example, without setting <code class="code">json_serialization_enable</code>, the following queries that access nested columns directly fail. </p><pre class="programlisting"><div class="code-btn-container"></div><code class="nohighlight">SELECT * FROM spectrum.customers LIMIT 1;

=&gt; ERROR:  Nested tables do not support '*' in the SELECT clause.

SELECT name FROM spectrum.customers LIMIT 1;

=&gt; ERROR:  column "name" does not exist in customers</code></pre><p>Setting <code class="code">json_serialization_enable</code> enables querying top-level collections directly. </p><pre class="programlisting"><div class="code-btn-container"></div><code class="nohighlight">SET json_serialization_enable TO true;

SELECT * FROM spectrum.customers order by id LIMIT 1;

id | name                                 | phones         | orders
---+--------------------------------------+----------------+----------------------------------------------------------------------------------------------------------------------
1  | <span>{</span>"given": "John", "family": "Smith"} | ["123-457789"] | [<span>{</span>"shipdate": "2018-03-01T11:59:59.000Z", "price": 100.50}, <span>{</span>"shipdate": "2018-03-01T09:10:00.000Z", "price": 99.12}]          
 
SELECT name FROM spectrum.customers order by id LIMIT 1;

name
---------
<span>{</span>"given": "John", "family": "Smith"}  </code></pre><p>Consider the following items when serializing nested JSON.</p><div class="itemizedlist">
             
             
             
             
             
             
        <ul class="itemizedlist"><li class="listitem"><p>When collection columns are serialized as VARCHAR(65535), their nested subfields can't be
                    accessed directly as part of the query syntax (for example, in the filter
                    clause). However, JSON functions can be used to access nested JSON. </p></li><li class="listitem"><p>The following specialized representations are not supported: </p>
                <div class="itemizedlist">
                     
                     
                     
                     
                <ul class="itemizedlist"><li class="listitem"><p>ORC unions</p></li><li class="listitem"><p>ORC maps with complex type keys</p></li><li class="listitem"><p>Ion datagrams</p></li><li class="listitem"><p>Ion SEXP</p></li></ul></div></li><li class="listitem"><p>Timestamps are returned as ISO serialized strings.</p></li><li class="listitem"><p>Primitive map keys are promoted to string (for example, <code class="code">1</code> to
                    <code class="code">"1"</code>).</p></li><li class="listitem"><p>Top-level null values are serialized as NULLs.</p></li><li class="listitem"><p>If the serialization overflows the maximum VARCHAR size of 65535, the cell is set to
                    NULL.</p></li></ul></div>
            <h2 id="serializing-complex-JSON-strings">Serializing complex types containing JSON strings</h2>
            <p>By default, string values contained in nested collections are serialized as
                escaped JSON strings. Escaping might be undesirable when the strings are valid JSON.
                Instead you might want to write nested subelements or fields that are VARCHAR
                directly as JSON. Enable this behavior with the
                    <code class="code">json_serialization_parse_nested_strings</code> session-level
                configuration. When both <code class="code">json_serialization_enable</code> and
                    <code class="code">json_serialization_parse_nested_strings</code> are set, valid JSON values
                are serialized inline without escape characters. When the value is not valid JSON,
                it is escaped as if the <code class="code">json_serialization_parse_nested_strings</code>
                configuration value was not set. For more information, see <a href="./r_json_serialization_parse_nested_strings.html">json_serialization_parse_nested_strings</a>.</p>  
            <p>For example, assume the data from the previous example contained JSON as a
                    <code class="code">structs</code> complex type in the <code class="code">name</code> VARCHAR(20) field: </p>
            <pre class="programlisting"><div class="code-btn-container"></div><code class="nohighlight">name
---------
<span>{</span>"given": "<span>{</span>\"first\":\"John\",\"middle\":\"James\"}", "family": "Smith"}</code></pre>
            <p>When <code class="code">json_serialization_parse_nested_strings</code> is set, the
                    <code class="code">name</code> column is serialized as follows: </p>
            
            <pre class="programlisting"><div class="code-btn-container"></div><code class="nohighlight">SET json_serialization_enable TO true;
SET json_serialization_parse_nested_strings TO true;
SELECT name FROM spectrum.customers order by id LIMIT 1;

name
---------
<span>{</span>"given": <span>{</span>"first":"John","middle":"James"}, "family": "Smith"}</code></pre>
            <p>Instead of being escaped like this:</p>
            <pre class="programlisting"><div class="code-btn-container"></div><code class="nohighlight">SET json_serialization_enable TO true;
SELECT name FROM spectrum.customers order by id LIMIT 1;

name
---------
<span>{</span>"given": "<span>{</span>\"first\":\"John\",\"middle\":\"James\"}", "family": "Smith"}</code></pre>
        <awsdocs-copyright class="copyright-print"></awsdocs-copyright><awsdocs-thumb-feedback right-edge="{{$ctrl.thumbFeedbackRightEdge}}"></awsdocs-thumb-feedback></div><noscript><div><div><div><div id="js_error_message"><p><img src="https://d1ge0kk1l5kms0.cloudfront.net/images/G/01/webservices/console/warning.png" alt="Warning" /> <strong>Javascript is disabled or is unavailable in your browser.</strong></p><p>To use the Amazon Web Services Documentation, Javascript must be enabled. Please refer to your browser's Help pages for instructions.</p></div></div></div></div></noscript><div id="main-col-footer" class="awsui-util-font-size-0"><div id="doc-conventions"><a target="_top" href="/general/latest/gr/docconventions.html">Document Conventions</a></div><div class="prev-next"><div id="previous" class="prev-link" accesskey="p" href="./nested-data-restrictions.html">Nested data limitations (preview)</div><div id="next" class="next-link" accesskey="n" href="./hyperloglog-overview.html">Using HyperLogLog sketches in Amazon Redshift</div></div></div><awsdocs-page-utilities></awsdocs-page-utilities></div><div id="quick-feedback-yes" style="display: none;"><div class="title">Did this page help you? - Yes</div><div class="content"><p>Thanks for letting us know we're doing a good job!</p><p>If you've got a moment, please tell us what we did right so we can do more of it.</p><p><awsui-button id="fblink" rel="noopener noreferrer" target="_blank" text="Feedback" click="linkClick($event)" href="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=Redshift&amp;topic_url=https://docs.aws.amazon.com/en_us/redshift/latest/dg/serializing-complex-JSON.html"></awsui-button></p></div></div><div id="quick-feedback-no" style="display: none;"><div class="title">Did this page help you? - No</div><div class="content"><p>Thanks for letting us know this page needs work. We're sorry we let you down.</p><p>If you've got a moment, please tell us how we can make the documentation better.</p><p><awsui-button id="fblink" rel="noopener noreferrer" target="_blank" text="Feedback" click="linkClick($event)" href="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=Redshift&amp;topic_url=https://docs.aws.amazon.com/en_us/redshift/latest/dg/serializing-complex-JSON.html"></awsui-button></p></div></div></div></body></div></awsdocs-view><div class="page-loading-indicator" id="page-loading-indicator"><awsui-spinner size="large"></awsui-spinner></div></div><div id="tools-panel" dom-region="tools"><awsdocs-tools-panel id="awsdocs-tools-panel"></awsdocs-tools-panel></div></awsui-app-layout><awsdocs-cookie-banner class="doc-cookie-banner"></awsdocs-cookie-banner></div></body></html>