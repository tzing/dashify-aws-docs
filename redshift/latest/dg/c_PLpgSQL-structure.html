<!DOCTYPE html>
    <html xmlns="http://www.w3.org/1999/xhtml" lang="en-US"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Structure of PL/pgSQL - Amazon Redshift</title><meta name="viewport" content="width=device-width,initial-scale=1" /><meta name="assets_root" content="/assets" /><meta name="target_state" content="c_PLpgSQL-structure" /><meta name="default_state" content="c_PLpgSQL-structure" /><link rel="icon" type="image/ico" href="/assets/images/favicon.ico" /><link rel="shortcut icon" type="image/ico" href="/assets/images/favicon.ico" /><link rel="canonical" href="https://docs.aws.amazon.com/redshift/latest/dg/c_PLpgSQL-structure.html" /><meta name="description" content="Learn about the structure of the PL/pgSQL language that is used in Amazon Redshift." /><meta name="deployment_region" content="IAD" /><meta name="product" content="Amazon Redshift" /><meta name="guide" content="Database Developer Guide" /><meta name="abstract" content="Create and manage a data warehouse with Amazon Redshift, an enterprise-level, petabyte scale, fully managed data warehousing service." /><meta name="guide-locale" content="en_us" /><meta name="tocs" content="toc-contents.json" /><link rel="canonical" href="https://docs.aws.amazon.com/redshift/latest/dg/c_PLpgSQL-structure.html" /><link rel="alternative" href="https://docs.aws.amazon.com/id_id/redshift/latest/dg/c_PLpgSQL-structure.html" hreflang="id-id" /><link rel="alternative" href="https://docs.aws.amazon.com/id_id/redshift/latest/dg/c_PLpgSQL-structure.html" hreflang="id" /><link rel="alternative" href="https://docs.aws.amazon.com/de_de/redshift/latest/dg/c_PLpgSQL-structure.html" hreflang="de-de" /><link rel="alternative" href="https://docs.aws.amazon.com/de_de/redshift/latest/dg/c_PLpgSQL-structure.html" hreflang="de" /><link rel="alternative" href="https://docs.aws.amazon.com/redshift/latest/dg/c_PLpgSQL-structure.html" hreflang="en-us" /><link rel="alternative" href="https://docs.aws.amazon.com/redshift/latest/dg/c_PLpgSQL-structure.html" hreflang="en" /><link rel="alternative" href="https://docs.aws.amazon.com/es_es/redshift/latest/dg/c_PLpgSQL-structure.html" hreflang="es-es" /><link rel="alternative" href="https://docs.aws.amazon.com/es_es/redshift/latest/dg/c_PLpgSQL-structure.html" hreflang="es" /><link rel="alternative" href="https://docs.aws.amazon.com/fr_fr/redshift/latest/dg/c_PLpgSQL-structure.html" hreflang="fr-fr" /><link rel="alternative" href="https://docs.aws.amazon.com/fr_fr/redshift/latest/dg/c_PLpgSQL-structure.html" hreflang="fr" /><link rel="alternative" href="https://docs.aws.amazon.com/it_it/redshift/latest/dg/c_PLpgSQL-structure.html" hreflang="it-it" /><link rel="alternative" href="https://docs.aws.amazon.com/it_it/redshift/latest/dg/c_PLpgSQL-structure.html" hreflang="it" /><link rel="alternative" href="https://docs.aws.amazon.com/ja_jp/redshift/latest/dg/c_PLpgSQL-structure.html" hreflang="ja-jp" /><link rel="alternative" href="https://docs.aws.amazon.com/ja_jp/redshift/latest/dg/c_PLpgSQL-structure.html" hreflang="ja" /><link rel="alternative" href="https://docs.aws.amazon.com/ko_kr/redshift/latest/dg/c_PLpgSQL-structure.html" hreflang="ko-kr" /><link rel="alternative" href="https://docs.aws.amazon.com/ko_kr/redshift/latest/dg/c_PLpgSQL-structure.html" hreflang="ko" /><link rel="alternative" href="https://docs.aws.amazon.com/pt_br/redshift/latest/dg/c_PLpgSQL-structure.html" hreflang="pt-br" /><link rel="alternative" href="https://docs.aws.amazon.com/pt_br/redshift/latest/dg/c_PLpgSQL-structure.html" hreflang="pt" /><link rel="alternative" href="https://docs.aws.amazon.com/zh_cn/redshift/latest/dg/c_PLpgSQL-structure.html" hreflang="zh-cn" /><link rel="alternative" href="https://docs.aws.amazon.com/zh_tw/redshift/latest/dg/c_PLpgSQL-structure.html" hreflang="zh-tw" /><link rel="alternative" href="https://docs.aws.amazon.com/redshift/latest/dg/c_PLpgSQL-structure.html" hreflang="x-default" /><meta name="feedback-item" content="Redshift" /><meta name="this_doc_product" content="Amazon Redshift" /><meta name="this_doc_guide" content="Database Developer Guide" /><script defer="" src="/assets/r/vendor4.js?version=2021.12.02"></script><script defer="" src="/assets/r/vendor3.js?version=2021.12.02"></script><script defer="" src="/assets/r/vendor1.js?version=2021.12.02"></script><script defer="" src="/assets/r/awsdocs-common.js?version=2021.12.02"></script><script defer="" src="/assets/r/awsdocs-doc-page.js?version=2021.12.02"></script><link href="/assets/r/vendor4.css?version=2021.12.02" rel="stylesheet" /><link href="/assets/r/awsdocs-common.css?version=2021.12.02" rel="stylesheet" /><link href="/assets/r/awsdocs-doc-page.css?version=2021.12.02" rel="stylesheet" /><script async="" id="awsc-panorama-bundle" type="text/javascript" src="https://prod.pa.cdn.uis.awsstatic.com/panorama-nav-init.js" data-config="{'appEntity':'aws-documentation','region':'us-east-1','service':'redshift'}"></script><meta id="panorama-serviceSubSection" value="Database Developer Guide" /><meta id="panorama-serviceConsolePage" value="Structure of PL/pgSQL" /></head><body class="awsdocs awsui"><div class="awsdocs-container"><awsdocs-header></awsdocs-header><awsui-app-layout id="app-layout" class="awsui-util-no-gutters" ng-controller="ContentController as $ctrl" header-selector="awsdocs-header" navigation-hide="false" navigation-width="$ctrl.navWidth" navigation-open="$ctrl.navOpen" navigation-change="$ctrl.onNavChange($event)" tools-hide="$ctrl.hideTools" tools-width="$ctrl.toolsWidth" tools-open="$ctrl.toolsOpen" tools-change="$ctrl.onToolsChange($event)"><div id="guide-toc" dom-region="navigation"><awsdocs-toc></awsdocs-toc></div><div id="main-column" dom-region="content" tabindex="-1"><awsdocs-view class="awsdocs-view"><div id="awsdocs-content"><head><title>Structure of PL/pgSQL - Amazon Redshift</title><meta name="pdf" content="/pdfs/redshift/latest/dg/redshift-dg.pdf#c_PLpgSQL-structure" /><meta name="rss" content="Dochistory.rss" /><meta name="forums" content="http://forums.aws.amazon.com/forum.jspa?forumID=155" /><meta name="feedback" content="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=Redshift&amp;topic_url=https://docs.aws.amazon.com/en_us/redshift/latest/dg/c_PLpgSQL-structure.html" /><meta name="feedback-yes" content="feedbackyes.html?topic_url=https://docs.aws.amazon.com/en_us/redshift/latest/dg/c_PLpgSQL-structure.html" /><meta name="feedback-no" content="feedbackno.html?topic_url=https://docs.aws.amazon.com/en_us/redshift/latest/dg/c_PLpgSQL-structure.html" /><meta name="keywords" content="Amazon Redshift,AWS Redshift,Redshift,Redshift Spectrum,cluster,data warehouse,developer,sample data,database,database developer,HLL" /><script type="application/ld+json">
{
    "@context" : "https://schema.org",
    "@type" : "BreadcrumbList",
    "itemListElement" : [
      {
        "@type" : "ListItem",
        "position" : 1,
        "name" : "AWS",
        "item" : "https://aws.amazon.com"
      },
      {
        "@type" : "ListItem",
        "position" : 2,
        "name" : "Amazon Redshift",
        "item" : "https://docs.aws.amazon.com/redshift/index.html"
      },
      {
        "@type" : "ListItem",
        "position" : 3,
        "name" : "Database Developer Guide",
        "item" : "https://docs.aws.amazon.com/redshift/latest/dg"
      },
      {
        "@type" : "ListItem",
        "position" : 4,
        "name" : "Creating stored procedures in Amazon Redshift",
        "item" : "https://docs.aws.amazon.com/redshift/latest/dg/stored-procedure-overview.html"
      },
      {
        "@type" : "ListItem",
        "position" : 5,
        "name" : "PL/pgSQL language reference",
        "item" : "https://docs.aws.amazon.com/redshift/latest/dg/c_pl_pgSQL_reference.html"
      },
      {
        "@type" : "ListItem",
        "position" : 6,
        "name" : "Structure of PL/pgSQL",
        "item" : "https://docs.aws.amazon.com/redshift/latest/dg/c_pl_pgSQL_reference.html"
      }
    ]
}
</script></head><body><div id="main"><div style="display: none"><a href="/pdfs/redshift/latest/dg/redshift-dg.pdf#c_PLpgSQL-structure" target="_blank" rel="noopener noreferrer" title="Open PDF"></a></div><div id="breadcrumbs" class="breadcrumb"><a href="https://aws.amazon.com">AWS</a><a href="/index.html">Documentation</a><a href="/redshift/index.html">Amazon Redshift</a><a href="welcome.html">Database Developer Guide</a></div><div id="page-toc-src"><a href="#r_PLpgSQL-block">Block</a><a href="#r_PLpgSQL-variable-declaration">Variable declaration</a><a href="#r_PLpgSQL-alias-declaration">Alias declaration</a><a href="#r_PLpgSQL-builtin-variables">Built-in variables</a><a href="#r_PLpgSQL-record-type">Record types</a></div><div id="main-content" class="awsui-util-container"><div id="main-col-body"><awsdocs-language-banner data-service="$ctrl.pageService"></awsdocs-language-banner><h1 class="topictitle" id="c_PLpgSQL-structure">Structure of PL/pgSQL</h1><div class="awsdocs-page-header-container"><awsdocs-page-header></awsdocs-page-header><awsdocs-filter-selector id="awsdocs-filter-selector"></awsdocs-filter-selector></div><p>PL/pgSQL is a procedural language with many of the same constructs as other procedural languages. 
             </p><div class="highlights" id="inline-topiclist"><h6>Topics</h6><ul><li><a href="#r_PLpgSQL-block">Block</a></li><li><a href="#r_PLpgSQL-variable-declaration">Variable declaration</a></li><li><a href="#r_PLpgSQL-alias-declaration">Alias declaration</a></li><li><a href="#r_PLpgSQL-builtin-variables">Built-in variables</a></li><li><a href="#r_PLpgSQL-record-type">Record types</a></li></ul></div>
            <h2 id="r_PLpgSQL-block">Block</h2>

            <p>PL/pgSQL is a block-structured language. 
               The complete body of a procedure is defined in a block, which contains variable declarations and PL/pgSQL statements. 
               A statement can also be a nested block, or subblock. </p>
            
            <p>End declarations and statements with a semicolon. 
               Follow the END keyword in a block or subblock with a semicolon. 
               Don't use semicolons after the keywords DECLARE and BEGIN. </p>
            <p>You can write all keywords and identifiers in mixed uppercase and lowercase.
        Identifiers are implicitly converted to lowercase unless enclosed in double quotation
        marks.</p>
            <p>A double hyphen (--) starts a comment that extends to the end of the line. A /*
              starts a block comment that extends to the next occurrence of */. You can't nest block
        comments. However, you can enclose double-hyphen comments in a block comment, and a double
        hyphen can hide the block comment delimiters /* and */.</p>
            <p>Any statement in the statement section of a block can be a subblock. You can use
        subblocks for logical grouping or to localize variables to a small group of
        statements.</p>         
         
<pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="nohighlight">[ &lt;&lt;label&gt;&gt; ]
[ DECLARE
  declarations ]
BEGIN
  statements
END [ label ];  
</code></pre>
            
            <p>The variables declared in the declarations section preceding a block are
        initialized to their default values every time the block is entered. In other words,
        they're not initialized only once per function call.</p> 
            
            
            <p>The following shows an example.</p>
            <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="sql ">CREATE PROCEDURE update_value() AS $$
DECLARE
  value integer := 20;
BEGIN
  RAISE NOTICE 'Value here is %', value;  -- Value here is 20
  value := 50;
  --
  -- Create a subblock
  --
  DECLARE
    value integer := 80;
  BEGIN
    RAISE NOTICE 'Value here is %', value;  -- Value here is 80
  END;

  RAISE NOTICE 'Value here is %', value;  -- Value here is 50
END;
$$ LANGUAGE plpgsql;               
</code></pre>
            
         <p>Use a label to identify the block to use in an EXIT statement or to qualify the names
        of the variables declared in the block.</p>
            <p>Don't confuse the use of BEGIN/END for grouping statements in PL/pgSQL with
        the database commands for transaction control. The BEGIN and END in PL/pgSQL are only for
        grouping. They don't start or end a transaction.</p>   
          
            <h2 id="r_PLpgSQL-variable-declaration">Variable declaration</h2>
            
           <p>Declare all variables in a block,
             except
             for loop variables, in the block's DECLARE section. Variables can use
             any valid Amazon Redshift data type. For supported data types, see <a href="./c_Supported_data_types.html">Data types</a>.

        </p>
            
            <p>PL/pgSQL variables can be any Amazon Redshift supported data type, plus <code class="code">RECORD</code>
        and <code class="code">refcursor</code>. For more information about <code class="code">RECORD</code>, see <a href="#r_PLpgSQL-record-type">Record types</a>. For more
        information about <code class="code">refcursor</code>, see <a href="./c_PLpgSQL-statements.html#r_PLpgSQL-cursors">Cursors</a>. </p>
           
 
            
<pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="nohighlight">DECLARE
name [ CONSTANT ] type [ NOT NULL ] [ <span>{</span> DEFAULT | := } expression ];
</code></pre>
            
            
            <p>Following, you can find example variable declarations.</p>
<pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="nohighlight">customerID integer;
numberofitems numeric(6);
link varchar;
onerow RECORD;
</code></pre>
            
            <p>The loop variable of a FOR loop iterating over a range of integers is
            automatically declared as an integer variable. </p>
            
            <p>The DEFAULT clause, if given, specifies the initial value assigned to the variable
        when the block is entered. If the DEFAULT clause is not given, then the variable is
        initialized to the SQL NULL value. The CONSTANT option prevents the variable from being
        assigned to, so that its value remains constant for the duration of the block. If NOT NULL
        is specified, an assignment of a null value results in a runtime error. All variables
        declared as NOT NULL must have a non-null default value specified.</p>
            <p>The default value is evaluated every time the block is entered. For example,
        assigning <code class="code">now()</code> to a variable of type <code class="code">timestamp</code> causes the
        variable to have the time of the current function call, not the time when the function was
        precompiled.</p>
<pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="nohighlight">quantity INTEGER DEFAULT 32;
url VARCHAR := 'http://mysite.com';
user_id CONSTANT INTEGER := 10;
</code></pre>
            
            <p>The <code class="code">refcursor</code> data type is the data type of cursor variables within stored procedures. A <code class="code">refcursor</code> value can be returned from within a stored procedure.
               For more information, see <a href="./stored-procedure-result-set.html">Returning a result set</a>.</p>
            

          
            <h2 id="r_PLpgSQL-alias-declaration">Alias declaration</h2>
            
           <p>If stored procedure's signature omits the argument name, you can declare an alias for the argument.</p>
            
            
            <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="sql ">name ALIAS FOR $n;</code></pre>
 
          
            <h2 id="r_PLpgSQL-builtin-variables">Built-in variables</h2>
            
            <p>The following built-in variables are supported:</p>
            <div class="itemizedlist">
                
                
                
                               
            <ul class="itemizedlist"><li class="listitem"><p>FOUND</p></li><li class="listitem"><p>SQLSTATE</p></li><li class="listitem"><p>SQLERRM</p></li><li class="listitem"><p>GET DIAGNOSTICS integer_var := ROW_COUNT;</p></li></ul></div>
      
            <p>FOUND is a special variable of type Boolean. FOUND starts out false within each procedure call. FOUND is set by the following types of statements:</p>
            
            <div class="itemizedlist">
                
                
                
                               
            <ul class="itemizedlist"><li class="listitem"><p>SELECT INTO</p><p>Sets FOUND to true if it returns a row, false if no row is returned.</p></li><li class="listitem"><p>UPDATE, INSERT, and DELETE</p><p>Sets FOUND to true if at least one row is affected, false if no row is affected.</p></li><li class="listitem"><p>FETCH</p><p>Sets FOUND to true if it returns a row, false if no row is returned.</p></li><li class="listitem"><p>FOR statement</p>
                  <p>Sets FOUND to true if the FOR statement iterates one or more times, and
            otherwise false. This applies to all three variants of the FOR statement: integer FOR
            loops, record-set FOR loops, and dynamic record-set FOR loops. </p>
          <p>FOUND is set when the FOR loop exits. Inside the runtime of the loop, FOUND
            isn't modified by the FOR statement. However, it can be changed by running other
            statements within the loop body.</p></li></ul></div>
            
            <p>The following shows an example.</p>
            <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="sql ">CREATE TABLE employee(empname varchar);
CREATE OR REPLACE PROCEDURE show_found()
AS  $$
DECLARE
  myrec record;
BEGIN
  SELECT INTO myrec * FROM employee WHERE empname = 'John';
  IF NOT FOUND THEN
    RAISE EXCEPTION 'employee John not found';
  END IF;
END;
$$ LANGUAGE plpgsql;
</code></pre>
            
            <p>Within an exception handler, the special variable SQLSTATE contains the error code
        that corresponds to the exception that was raised. The special variable SQLERRM contains the
        error message associated with the exception. These variables are undefined outside exception
        handlers and display an error if used.</p>
            <p>The following shows an example.</p>
            <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="sql ">CREATE OR REPLACE PROCEDURE sqlstate_sqlerrm() AS
$$
BEGIN
  UPDATE employee SET firstname = 'Adam' WHERE lastname = 'Smith';
  EXECUTE 'select invalid';
  EXCEPTION WHEN OTHERS THEN
  RAISE INFO 'error message SQLERRM %', SQLERRM;
  RAISE INFO 'error message SQLSTATE %', SQLSTATE;
END;
$$ LANGUAGE plpgsql;               
</code></pre>
            
            <p>ROW_COUNT is used with the GET DIAGNOSTICS command. It shows the number of rows processed by the last SQL command sent down to the SQL engine.</p>
            <p>The following shows an example.</p>
            <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="sql ">CREATE OR REPLACE PROCEDURE sp_row_count() AS
$$
DECLARE
  integer_var int;
BEGIN
  INSERT INTO tbl_row_count VALUES(1);
  GET DIAGNOSTICS integer_var := ROW_COUNT;
  RAISE INFO 'rows inserted = %', integer_var;
END;
$$ LANGUAGE plpgsql;               
</code></pre>
            
          
            <h2 id="r_PLpgSQL-record-type">Record types</h2> 
            <p>A RECORD type is not a true data type, only a placeholder. Record type variables
        assume the actual row structure of the row that they are assigned during a SELECT or FOR
        command. The substructure of a record variable can change each time it is assigned a value.
        Until a record variable is first assigned to, it has no substructure. Any attempt to access
        a field in it throws a runtime error.</p>
            
<pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="nohighlight">name RECORD;
</code></pre>
         <p>The following shows an example.</p><pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="sql ">CREATE TABLE tbl_record(a int, b int);
INSERT INTO tbl_record VALUES(1, 2);
CREATE OR REPLACE PROCEDURE record_example()
LANGUAGE plpgsql
AS $$
DECLARE
  rec RECORD;
BEGIN
  FOR rec IN SELECT a FROM tbl_record
  LOOP
    RAISE INFO 'a = %', rec.a;
  END LOOP;
END;
$$;           
</code></pre><awsdocs-copyright class="copyright-print"></awsdocs-copyright><awsdocs-thumb-feedback right-edge="{{$ctrl.thumbFeedbackRightEdge}}"></awsdocs-thumb-feedback></div><noscript><div><div><div><div id="js_error_message"><p><img src="https://d1ge0kk1l5kms0.cloudfront.net/images/G/01/webservices/console/warning.png" alt="Warning" /> <strong>Javascript is disabled or is unavailable in your browser.</strong></p><p>To use the Amazon Web Services Documentation, Javascript must be enabled. Please refer to your browser's Help pages for instructions.</p></div></div></div></div></noscript><div id="main-col-footer" class="awsui-util-font-size-0"><div id="doc-conventions"><a target="_top" href="/general/latest/gr/docconventions.html">Document Conventions</a></div><div class="prev-next"><div id="previous" class="prev-link" accesskey="p" href="./c_PL_reference_conventions.html">PL/pgSQL reference conventions</div><div id="next" class="next-link" accesskey="n" href="./c_PLpgSQL-statements.html">Supported PL/pgSQL statements</div></div></div><awsdocs-page-utilities></awsdocs-page-utilities></div><div id="quick-feedback-yes" style="display: none;"><div class="title">Did this page help you? - Yes</div><div class="content"><p>Thanks for letting us know we're doing a good job!</p><p>If you've got a moment, please tell us what we did right so we can do more of it.</p><p><awsui-button id="fblink" rel="noopener noreferrer" target="_blank" text="Feedback" click="linkClick($event)" href="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=Redshift&amp;topic_url=https://docs.aws.amazon.com/en_us/redshift/latest/dg/c_PLpgSQL-structure.html"></awsui-button></p></div></div><div id="quick-feedback-no" style="display: none;"><div class="title">Did this page help you? - No</div><div class="content"><p>Thanks for letting us know this page needs work. We're sorry we let you down.</p><p>If you've got a moment, please tell us how we can make the documentation better.</p><p><awsui-button id="fblink" rel="noopener noreferrer" target="_blank" text="Feedback" click="linkClick($event)" href="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=Redshift&amp;topic_url=https://docs.aws.amazon.com/en_us/redshift/latest/dg/c_PLpgSQL-structure.html"></awsui-button></p></div></div></div></body></div></awsdocs-view><div class="page-loading-indicator" id="page-loading-indicator"><awsui-spinner size="large"></awsui-spinner></div></div><div id="tools-panel" dom-region="tools"><awsdocs-tools-panel id="awsdocs-tools-panel"></awsdocs-tools-panel></div></awsui-app-layout><awsdocs-cookie-banner class="doc-cookie-banner"></awsdocs-cookie-banner></div></body></html>