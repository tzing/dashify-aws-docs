<!DOCTYPE html>
    <html xmlns="http://www.w3.org/1999/xhtml" lang="en-US"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Getting started with streaming ingestion from Amazon Kinesis Data Streams - Amazon Redshift</title><meta name="viewport" content="width=device-width,initial-scale=1" /><meta name="assets_root" content="/assets" /><meta name="target_state" content="materialized-view-streaming-ingestion-getting-started" /><meta name="default_state" content="materialized-view-streaming-ingestion-getting-started" /><link rel="icon" type="image/ico" href="/assets/images/favicon.ico" /><link rel="shortcut icon" type="image/ico" href="/assets/images/favicon.ico" /><link rel="canonical" href="https://docs.aws.amazon.com/redshift/latest/dg/materialized-view-streaming-ingestion-getting-started.html" /><meta name="description" content="Learn how to set up streaming ingestion from Amazon Kinesis Data Streams." /><meta name="deployment_region" content="IAD" /><meta name="product" content="Amazon Redshift" /><meta name="guide" content="Database Developer Guide" /><meta name="abstract" content="Create and manage a data warehouse with Amazon Redshift, an enterprise-level, petabyte scale, fully managed data warehousing service." /><meta name="guide-locale" content="en_us" /><meta name="tocs" content="toc-contents.json" /><link rel="canonical" href="https://docs.aws.amazon.com/redshift/latest/dg/materialized-view-streaming-ingestion-getting-started.html" /><link rel="alternative" href="https://docs.aws.amazon.com/id_id/redshift/latest/dg/materialized-view-streaming-ingestion-getting-started.html" hreflang="id-id" /><link rel="alternative" href="https://docs.aws.amazon.com/id_id/redshift/latest/dg/materialized-view-streaming-ingestion-getting-started.html" hreflang="id" /><link rel="alternative" href="https://docs.aws.amazon.com/de_de/redshift/latest/dg/materialized-view-streaming-ingestion-getting-started.html" hreflang="de-de" /><link rel="alternative" href="https://docs.aws.amazon.com/de_de/redshift/latest/dg/materialized-view-streaming-ingestion-getting-started.html" hreflang="de" /><link rel="alternative" href="https://docs.aws.amazon.com/redshift/latest/dg/materialized-view-streaming-ingestion-getting-started.html" hreflang="en-us" /><link rel="alternative" href="https://docs.aws.amazon.com/redshift/latest/dg/materialized-view-streaming-ingestion-getting-started.html" hreflang="en" /><link rel="alternative" href="https://docs.aws.amazon.com/es_es/redshift/latest/dg/materialized-view-streaming-ingestion-getting-started.html" hreflang="es-es" /><link rel="alternative" href="https://docs.aws.amazon.com/es_es/redshift/latest/dg/materialized-view-streaming-ingestion-getting-started.html" hreflang="es" /><link rel="alternative" href="https://docs.aws.amazon.com/fr_fr/redshift/latest/dg/materialized-view-streaming-ingestion-getting-started.html" hreflang="fr-fr" /><link rel="alternative" href="https://docs.aws.amazon.com/fr_fr/redshift/latest/dg/materialized-view-streaming-ingestion-getting-started.html" hreflang="fr" /><link rel="alternative" href="https://docs.aws.amazon.com/it_it/redshift/latest/dg/materialized-view-streaming-ingestion-getting-started.html" hreflang="it-it" /><link rel="alternative" href="https://docs.aws.amazon.com/it_it/redshift/latest/dg/materialized-view-streaming-ingestion-getting-started.html" hreflang="it" /><link rel="alternative" href="https://docs.aws.amazon.com/ja_jp/redshift/latest/dg/materialized-view-streaming-ingestion-getting-started.html" hreflang="ja-jp" /><link rel="alternative" href="https://docs.aws.amazon.com/ja_jp/redshift/latest/dg/materialized-view-streaming-ingestion-getting-started.html" hreflang="ja" /><link rel="alternative" href="https://docs.aws.amazon.com/ko_kr/redshift/latest/dg/materialized-view-streaming-ingestion-getting-started.html" hreflang="ko-kr" /><link rel="alternative" href="https://docs.aws.amazon.com/ko_kr/redshift/latest/dg/materialized-view-streaming-ingestion-getting-started.html" hreflang="ko" /><link rel="alternative" href="https://docs.aws.amazon.com/pt_br/redshift/latest/dg/materialized-view-streaming-ingestion-getting-started.html" hreflang="pt-br" /><link rel="alternative" href="https://docs.aws.amazon.com/pt_br/redshift/latest/dg/materialized-view-streaming-ingestion-getting-started.html" hreflang="pt" /><link rel="alternative" href="https://docs.aws.amazon.com/zh_cn/redshift/latest/dg/materialized-view-streaming-ingestion-getting-started.html" hreflang="zh-cn" /><link rel="alternative" href="https://docs.aws.amazon.com/zh_tw/redshift/latest/dg/materialized-view-streaming-ingestion-getting-started.html" hreflang="zh-tw" /><link rel="alternative" href="https://docs.aws.amazon.com/redshift/latest/dg/materialized-view-streaming-ingestion-getting-started.html" hreflang="x-default" /><meta name="feedback-item" content="Redshift" /><meta name="this_doc_product" content="Amazon Redshift" /><meta name="this_doc_guide" content="Database Developer Guide" /><script defer="" src="/assets/r/vendor4.js?version=2021.12.02"></script><script defer="" src="/assets/r/vendor3.js?version=2021.12.02"></script><script defer="" src="/assets/r/vendor1.js?version=2021.12.02"></script><script defer="" src="/assets/r/awsdocs-common.js?version=2021.12.02"></script><script defer="" src="/assets/r/awsdocs-doc-page.js?version=2021.12.02"></script><link href="/assets/r/vendor4.css?version=2021.12.02" rel="stylesheet" /><link href="/assets/r/awsdocs-common.css?version=2021.12.02" rel="stylesheet" /><link href="/assets/r/awsdocs-doc-page.css?version=2021.12.02" rel="stylesheet" /><script async="" id="awsc-panorama-bundle" type="text/javascript" src="https://prod.pa.cdn.uis.awsstatic.com/panorama-nav-init.js" data-config="{'appEntity':'aws-documentation','region':'us-east-1','service':'redshift'}"></script><meta id="panorama-serviceSubSection" value="Database Developer Guide" /><meta id="panorama-serviceConsolePage" value="Getting started with streaming ingestion from Amazon Kinesis Data Streams" /></head><body class="awsdocs awsui"><div class="awsdocs-container"><awsdocs-header></awsdocs-header><awsui-app-layout id="app-layout" class="awsui-util-no-gutters" ng-controller="ContentController as $ctrl" header-selector="awsdocs-header" navigation-hide="false" navigation-width="$ctrl.navWidth" navigation-open="$ctrl.navOpen" navigation-change="$ctrl.onNavChange($event)" tools-hide="$ctrl.hideTools" tools-width="$ctrl.toolsWidth" tools-open="$ctrl.toolsOpen" tools-change="$ctrl.onToolsChange($event)"><div id="guide-toc" dom-region="navigation"><awsdocs-toc></awsdocs-toc></div><div id="main-column" dom-region="content" tabindex="-1"><awsdocs-view class="awsdocs-view"><div id="awsdocs-content"><head><title>Getting started with streaming ingestion from Amazon Kinesis Data Streams - Amazon Redshift</title><meta name="pdf" content="/pdfs/redshift/latest/dg/redshift-dg.pdf#materialized-view-streaming-ingestion-getting-started" /><meta name="rss" content="Dochistory.rss" /><meta name="forums" content="http://forums.aws.amazon.com/forum.jspa?forumID=155" /><meta name="feedback" content="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=Redshift&amp;topic_url=https://docs.aws.amazon.com/en_us/redshift/latest/dg/materialized-view-streaming-ingestion-getting-started.html" /><meta name="feedback-yes" content="feedbackyes.html?topic_url=https://docs.aws.amazon.com/en_us/redshift/latest/dg/materialized-view-streaming-ingestion-getting-started.html" /><meta name="feedback-no" content="feedbackno.html?topic_url=https://docs.aws.amazon.com/en_us/redshift/latest/dg/materialized-view-streaming-ingestion-getting-started.html" /><meta name="keywords" content="Amazon Redshift,AWS Redshift,Redshift,Redshift Spectrum,cluster,data warehouse,developer,sample data,database,database developer,HLL" /><script type="application/ld+json">
{
    "@context" : "https://schema.org",
    "@type" : "BreadcrumbList",
    "itemListElement" : [
      {
        "@type" : "ListItem",
        "position" : 1,
        "name" : "AWS",
        "item" : "https://aws.amazon.com"
      },
      {
        "@type" : "ListItem",
        "position" : 2,
        "name" : "Amazon Redshift",
        "item" : "https://docs.aws.amazon.com/redshift/index.html"
      },
      {
        "@type" : "ListItem",
        "position" : 3,
        "name" : "Database Developer Guide",
        "item" : "https://docs.aws.amazon.com/redshift/latest/dg"
      },
      {
        "@type" : "ListItem",
        "position" : 4,
        "name" : "Creating materialized views in Amazon Redshift",
        "item" : "https://docs.aws.amazon.com/redshift/latest/dg/materialized-view-overview.html"
      },
      {
        "@type" : "ListItem",
        "position" : 5,
        "name" : "Streaming ingestion",
        "item" : "https://docs.aws.amazon.com/redshift/latest/dg/materialized-view-streaming-ingestion.html"
      },
      {
        "@type" : "ListItem",
        "position" : 6,
        "name" : "Getting started with streaming ingestion from Amazon Kinesis Data Streams",
        "item" : "https://docs.aws.amazon.com/redshift/latest/dg/materialized-view-streaming-ingestion.html"
      }
    ]
}
</script></head><body><div id="main"><div style="display: none"><a href="/pdfs/redshift/latest/dg/redshift-dg.pdf#materialized-view-streaming-ingestion-getting-started" target="_blank" rel="noopener noreferrer" title="Open PDF"></a></div><div id="breadcrumbs" class="breadcrumb"><a href="https://aws.amazon.com">AWS</a><a href="/index.html">Documentation</a><a href="/redshift/index.html">Amazon Redshift</a><a href="welcome.html">Database Developer Guide</a></div><div id="main-content" class="awsui-util-container"><div id="main-col-body"><awsdocs-language-banner data-service="$ctrl.pageService"></awsdocs-language-banner><h1 class="topictitle" id="materialized-view-streaming-ingestion-getting-started">Getting started with streaming ingestion from Amazon Kinesis Data Streams</h1><div class="awsdocs-page-header-container"><awsdocs-page-header></awsdocs-page-header><awsdocs-filter-selector id="awsdocs-filter-selector"></awsdocs-filter-selector></div><p> Setting up Amazon Redshift streaming ingestion involves creating an external schema that
                maps to the streaming data source and creating a materialized view that references
                the external schema. Amazon Redshift streaming ingestion supports Kinesis Data Streams as a source. As such,
                you
                must
                have a Kinesis Data Streams source available
                before
                configuring streaming ingestion. If you don't have a source, follow the instructions
                in the Kinesis documentation at <a href="https://docs.aws.amazon.com/streams/latest/dev/getting-started.html">Getting
                    Started with Amazon Kinesis Data Streams</a> or create one on the console using the
                instructions at <a href="https://docs.aws.amazon.com/streams/latest/dev/how-do-i-create-a-stream.html">Creating a
                    Stream via the AWS Management Console</a>.</p><p>
                Amazon Redshift streaming ingestion uses a materialized view, which is updated directly from the stream when <code class="code">REFRESH</code> is run. The materialized view 
                maps to the stream data source. You can perform filtering and aggregations on the stream data as part of the materialized-view definition. Your 
                streaming ingestion materialized view (the <em>base</em> materialized view) can reference only one stream, but you 
                can create additional materialized views that join with the base materialized view and with other materialized views or tables. 
            </p><div class="awsdocs-note"><div class="awsdocs-note-title"><awsui-icon name="status-info" variant="link"></awsui-icon><h6>Note</h6></div><div class="awsdocs-note-text"><p><em>Streaming ingestion and Amazon Redshift Serverless</em> - The configuration steps in this topic apply
                both to provisioned Amazon Redshift clusters and to Amazon Redshift Serverless. For more information, see <a href="./materialized-view-streaming-ingestion.html#materialized-view-streaming-ingestion-considerations">Streaming ingestion considerations</a>.</p></div></div><p>Assuming you have a Kinesis Data Streams stream available, the first step is to define a schema 
                in Amazon Redshift with <code class="code">CREATE EXTERNAL SCHEMA</code> and to reference a Kinesis Data Streams 
                resource. Following that, to access data in the stream, define the 
                    <code class="code">STREAM</code> in a materialized view. You can store stream records in the 
                semi-structured <code class="code">SUPER</code> format, or define a schema that results in data 
                converted to Redshift data types. When you query the materialized view, 
                the returned records are a point-in-time view of the stream. </p><div class="procedure"><ol><li><p>Create an IAM role with a trust policy that allows your Amazon Redshift cluster or Amazon Redshift Serverless workgroup to assume 
                    the role. For information about how to configure the trust policy for the IAM role, see <a href="https://docs.aws.amazon.com/redshift/latest/mgmt/authorizing-redshift-service.html">Authorizing Amazon Redshift to access other AWS services on your behalf</a>. After it is created, the role 
                    should have the following IAM policy, which provides permission for communication with the Amazon Kinesis data stream. </p>
                    <p><b>IAM policy for an unencrypted stream from Kinesis Data Streams</b></p>
                <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class=""><span>{</span>
    "Version": "2012-10-17",
    "Statement": [
        <span>{</span>
            "Sid": "ReadStream",
            "Effect": "Allow",
            "Action": [
                "kinesis:DescribeStreamSummary",
                "kinesis:GetShardIterator",
                "kinesis:GetRecords",
                "kinesis:DescribeStream"
            ],
            "Resource": "arn:aws:kinesis:*:0123456789:stream/*"
        },
        <span>{</span>
            "Sid": "ListStream",
            "Effect": "Allow",
            "Action": [
                "kinesis:ListStreams",
                "kinesis:ListShards"
            ],
            "Resource": "*"
        }
    ]
}</code></pre>
    <p><b>IAM policy for an encrypted stream from Kinesis Data Streams</b></p>
                    <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class=""><span>{</span>
	"Version": "2012-10-17",
	"Statement": [<span>{</span>
			"Sid": "ReadStream",
			"Effect": "Allow",
			"Action": [
				"kinesis:DescribeStreamSummary",
				"kinesis:GetShardIterator",
				"kinesis:GetRecords",
				"kinesis:DescribeStream"
			],
			"Resource": "arn:aws:kinesis:*:0123456789:stream/*"
		},
		<span>{</span>
			"Sid": "DecryptStream",
			"Effect": "Allow",
			"Action": [
				"kms:Decrypt"
			],
			"Resource": "arn:aws:kms:us-east-1:0123456789:key/1234abcd-12ab-34cd-56ef-1234567890ab"
		}, 
        <span>{</span>
			"Sid": "ListStream",
			"Effect": "Allow",
			"Action": [
				"kinesis:ListStreams",
				"kinesis:ListShards"
			],
			"Resource": "*"
		}
	]
}</code></pre>
                </li><li><p>Check your VPC and
                        verify
                        that your Amazon Redshift cluster or Amazon Redshift Serverless has a route to get to the Kinesis Data Streams endpoints over the
                        internet using a NAT gateway or
                        internet
                        gateway. If you want traffic between Redshift and Kinesis Data Streams to remain
                        within the AWS network,
                        consider
                        using a Kinesis Interface VPC Endpoint. For more information, see <a href="https://docs.aws.amazon.com/streams/latest/dev/vpc.html">Using Amazon Kinesis Data Streams Kinesis Data Streams with
                            Interface VPC Endpoints</a>.</p></li><li><p>In Amazon Redshift, create an external schema to map the data from Kinesis to a schema.</p>
                    <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="">CREATE EXTERNAL SCHEMA kds
FROM KINESIS
IAM_ROLE <span>{</span> default | 'iam-role-arn' };</code></pre>
                    
                        <p>
                            Streaming ingestion for Kinesis Data Streams doesn't require an authentication type. It uses the IAM role 
                            defined in the <code class="code">CREATE EXTERNAL SCHEMA</code> statement for making Kinesis Data Streams requests. 
                        </p>
                    <p>
                        Optional: Use the REGION keyword to specify the region where the Amazon Kinesis Data Streams or Amazon MSK stream resides. 
                    </p>
                    <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="">CREATE EXTERNAL SCHEMA kds
FROM KINESIS
REGION 'us-west-2'
IAM_ROLE <span>{</span> default | 'iam-role-arn' };</code></pre>
                    <p>In this sample, the region specifies the location of the source stream. The IAM_ROLE is a sample.</p></li><li><p>Create a materialized view to consume the stream data. The following 
                    example defines a materialized view with JSON source data. Note 
                    that the following view validates the data is valid JSON source . Kinesis stream names are case sensitive 
                    and can contain both uppercase and lowercase letters. To ingest from streams with uppercase names, you can set the 
                    configuration <code class="code">enable_case_sensitive_identifier</code> to <code class="code">true</code> at the database level. For more 
                    information, see <a href="https://docs.aws.amazon.com/redshift/latest/dg/r_names.html">Names and identifiers</a> 
                    and <a href="https://docs.aws.amazon.com/redshift/latest/dg/r_enable_case_sensitive_identifier.html">enable_case_sensitive_identifier</a>.</p>
                    
                    <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="">CREATE MATERIALIZED VIEW my_view AUTO REFRESH YES AS
SELECT approximate_arrival_timestamp,
JSON_PARSE(kinesis_data) as Data
FROM kds.my_stream_name
WHERE CAN_JSON_PARSE(kinesis_data);</code></pre>
                    <p>To turn on auto refresh, use <code class="code">AUTO REFRESH YES</code>. The default behavior is manual refresh.
                    </p>
                <p>Metadata columns include the following:</p>
                    <div class="table-container"><div class="table-contents"><table id="w323aac38c55c13c13b7c10"><thead>
                                <tr>
                                    <th>Metadata column</th>
                                    <th>Data type</th>
                                    <th>Description</th>
                                </tr>
                            </thead>
                                <tr>
                                    <td tabindex="-1">
                                        approximate_arrival_timestamp 
                                    </td>
                                    <td tabindex="-1">
                                        timestamp without time zone
                                    </td>
                                    <td tabindex="-1">
                                        The approximate time that the record was inserted into the Kinesis stream
                                    </td>
                                </tr>
                                <tr>
                                    <td tabindex="-1">
                                        partition_key
                                    </td>
                                    <td tabindex="-1">
                                        varchar(256)
                                    </td>
                                    <td tabindex="-1">
                                        The key used by Kinesis to assign the record to a shard
                                    </td>
                                </tr>
                                <tr>
                                    <td tabindex="-1">
                                        shard_id
                                    </td>
                                    <td tabindex="-1">
                                        char(20)
                                    </td>
                                    <td tabindex="-1">
                                        The unique identifier of the shard within the stream from which the record was retrieved
                                    </td>
                                </tr>
                                <tr>
                                    <td tabindex="-1">
                                        sequence_number
                                    </td>
                                    <td tabindex="-1">
                                        varchar(128)
                                    </td>
                                    <td tabindex="-1">
                                        The unique identifier of the record from the Kinesis shard
                                    </td>
                                </tr>
                                <tr>
                                    <td tabindex="-1">
                                        refresh_time
                                    </td>
                                    <td tabindex="-1">
                                        timestamp without time zone
                                    </td>
                                    <td tabindex="-1">
                                        The time the refresh started
                                    </td>
                                </tr>
                                <tr>
                                    <td tabindex="-1">
                                        kinesis_data
                                    </td>
                                    <td tabindex="-1">
                                        varbyte
                                    </td>
                                    <td tabindex="-1">
                                        The record from the Kinesis stream
                                    </td>
                                </tr>
                            </table></div></div>
                    <p>It's important to note if you have business logic in your materialized view definition that parsing errors can cause streaming 
                        ingestion to be blocked in some cases. This might lead to where you have to drop and re-create the materialized view. To avoid this, we 
                        recommend that you keep your parsing logic as simple as possible and perform most of your business-logic checks on the data 
                        following ingestion.</p>
                </li><li><p>Refresh the view, which invokes Redshift to read from the stream and load data into the materialized view.</p>
                    <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="">REFRESH MATERIALIZED VIEW my_view;</code></pre></li><li><p>Query data in the materialized view.</p>
                    <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="">select * from my_view;</code></pre></li></ol></div><awsdocs-copyright class="copyright-print"></awsdocs-copyright><awsdocs-thumb-feedback right-edge="{{$ctrl.thumbFeedbackRightEdge}}"></awsdocs-thumb-feedback></div><noscript><div><div><div><div id="js_error_message"><p><img src="https://d1ge0kk1l5kms0.cloudfront.net/images/G/01/webservices/console/warning.png" alt="Warning" /> <strong>Javascript is disabled or is unavailable in your browser.</strong></p><p>To use the Amazon Web Services Documentation, Javascript must be enabled. Please refer to your browser's Help pages for instructions.</p></div></div></div></div></noscript><div id="main-col-footer" class="awsui-util-font-size-0"><div id="doc-conventions"><a target="_top" href="/general/latest/gr/docconventions.html">Document Conventions</a></div><div class="prev-next"><div id="previous" class="prev-link" accesskey="p" href="./materialized-view-streaming-ingestion.html">Streaming ingestion</div><div id="next" class="next-link" accesskey="n" href="./materialized-view-streaming-ingestion-getting-started-MSK.html">Getting started with streaming ingestion from Amazon Managed Streaming for Apache Kafka</div></div></div><awsdocs-page-utilities></awsdocs-page-utilities></div><div id="quick-feedback-yes" style="display: none;"><div class="title">Did this page help you? - Yes</div><div class="content"><p>Thanks for letting us know we're doing a good job!</p><p>If you've got a moment, please tell us what we did right so we can do more of it.</p><p><awsui-button id="fblink" rel="noopener noreferrer" target="_blank" text="Feedback" click="linkClick($event)" href="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=Redshift&amp;topic_url=https://docs.aws.amazon.com/en_us/redshift/latest/dg/materialized-view-streaming-ingestion-getting-started.html"></awsui-button></p></div></div><div id="quick-feedback-no" style="display: none;"><div class="title">Did this page help you? - No</div><div class="content"><p>Thanks for letting us know this page needs work. We're sorry we let you down.</p><p>If you've got a moment, please tell us how we can make the documentation better.</p><p><awsui-button id="fblink" rel="noopener noreferrer" target="_blank" text="Feedback" click="linkClick($event)" href="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=Redshift&amp;topic_url=https://docs.aws.amazon.com/en_us/redshift/latest/dg/materialized-view-streaming-ingestion-getting-started.html"></awsui-button></p></div></div></div></body></div></awsdocs-view><div class="page-loading-indicator" id="page-loading-indicator"><awsui-spinner size="large"></awsui-spinner></div></div><div id="tools-panel" dom-region="tools"><awsdocs-tools-panel id="awsdocs-tools-panel"></awsdocs-tools-panel></div></awsui-app-layout><awsdocs-cookie-banner class="doc-cookie-banner"></awsdocs-cookie-banner></div></body></html>