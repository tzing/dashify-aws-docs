<!DOCTYPE html>
    <html xmlns="http://www.w3.org/1999/xhtml" lang="en-US"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Improving query performance - Amazon Redshift</title><meta name="viewport" content="width=device-width,initial-scale=1" /><meta name="assets_root" content="/assets" /><meta name="target_state" content="query-performance-improvement-opportunities" /><meta name="default_state" content="query-performance-improvement-opportunities" /><link rel="icon" type="image/ico" href="/assets/images/favicon.ico" /><link rel="shortcut icon" type="image/ico" href="/assets/images/favicon.ico" /><link rel="canonical" href="https://docs.aws.amazon.com/redshift/latest/dg/query-performance-improvement-opportunities.html" /><meta name="description" content="This topic identifies common issues that affect query performance, how to diagnose them, and how to resolve them." /><meta name="deployment_region" content="IAD" /><meta name="product" content="Amazon Redshift" /><meta name="guide" content="Database Developer Guide" /><meta name="abstract" content="Create and manage a data warehouse with Amazon Redshift, an enterprise-level, petabyte scale, fully managed data warehousing service." /><meta name="guide-locale" content="en_us" /><meta name="tocs" content="toc-contents.json" /><link rel="canonical" href="https://docs.aws.amazon.com/redshift/latest/dg/query-performance-improvement-opportunities.html" /><link rel="alternative" href="https://docs.aws.amazon.com/id_id/redshift/latest/dg/query-performance-improvement-opportunities.html" hreflang="id-id" /><link rel="alternative" href="https://docs.aws.amazon.com/id_id/redshift/latest/dg/query-performance-improvement-opportunities.html" hreflang="id" /><link rel="alternative" href="https://docs.aws.amazon.com/de_de/redshift/latest/dg/query-performance-improvement-opportunities.html" hreflang="de-de" /><link rel="alternative" href="https://docs.aws.amazon.com/de_de/redshift/latest/dg/query-performance-improvement-opportunities.html" hreflang="de" /><link rel="alternative" href="https://docs.aws.amazon.com/redshift/latest/dg/query-performance-improvement-opportunities.html" hreflang="en-us" /><link rel="alternative" href="https://docs.aws.amazon.com/redshift/latest/dg/query-performance-improvement-opportunities.html" hreflang="en" /><link rel="alternative" href="https://docs.aws.amazon.com/es_es/redshift/latest/dg/query-performance-improvement-opportunities.html" hreflang="es-es" /><link rel="alternative" href="https://docs.aws.amazon.com/es_es/redshift/latest/dg/query-performance-improvement-opportunities.html" hreflang="es" /><link rel="alternative" href="https://docs.aws.amazon.com/fr_fr/redshift/latest/dg/query-performance-improvement-opportunities.html" hreflang="fr-fr" /><link rel="alternative" href="https://docs.aws.amazon.com/fr_fr/redshift/latest/dg/query-performance-improvement-opportunities.html" hreflang="fr" /><link rel="alternative" href="https://docs.aws.amazon.com/it_it/redshift/latest/dg/query-performance-improvement-opportunities.html" hreflang="it-it" /><link rel="alternative" href="https://docs.aws.amazon.com/it_it/redshift/latest/dg/query-performance-improvement-opportunities.html" hreflang="it" /><link rel="alternative" href="https://docs.aws.amazon.com/ja_jp/redshift/latest/dg/query-performance-improvement-opportunities.html" hreflang="ja-jp" /><link rel="alternative" href="https://docs.aws.amazon.com/ja_jp/redshift/latest/dg/query-performance-improvement-opportunities.html" hreflang="ja" /><link rel="alternative" href="https://docs.aws.amazon.com/ko_kr/redshift/latest/dg/query-performance-improvement-opportunities.html" hreflang="ko-kr" /><link rel="alternative" href="https://docs.aws.amazon.com/ko_kr/redshift/latest/dg/query-performance-improvement-opportunities.html" hreflang="ko" /><link rel="alternative" href="https://docs.aws.amazon.com/pt_br/redshift/latest/dg/query-performance-improvement-opportunities.html" hreflang="pt-br" /><link rel="alternative" href="https://docs.aws.amazon.com/pt_br/redshift/latest/dg/query-performance-improvement-opportunities.html" hreflang="pt" /><link rel="alternative" href="https://docs.aws.amazon.com/zh_cn/redshift/latest/dg/query-performance-improvement-opportunities.html" hreflang="zh-cn" /><link rel="alternative" href="https://docs.aws.amazon.com/zh_tw/redshift/latest/dg/query-performance-improvement-opportunities.html" hreflang="zh-tw" /><link rel="alternative" href="https://docs.aws.amazon.com/redshift/latest/dg/query-performance-improvement-opportunities.html" hreflang="x-default" /><meta name="feedback-item" content="Redshift" /><meta name="this_doc_product" content="Amazon Redshift" /><meta name="this_doc_guide" content="Database Developer Guide" /><script defer="" src="/assets/r/vendor4.js?version=2021.12.02"></script><script defer="" src="/assets/r/vendor3.js?version=2021.12.02"></script><script defer="" src="/assets/r/vendor1.js?version=2021.12.02"></script><script defer="" src="/assets/r/awsdocs-common.js?version=2021.12.02"></script><script defer="" src="/assets/r/awsdocs-doc-page.js?version=2021.12.02"></script><link href="/assets/r/vendor4.css?version=2021.12.02" rel="stylesheet" /><link href="/assets/r/awsdocs-common.css?version=2021.12.02" rel="stylesheet" /><link href="/assets/r/awsdocs-doc-page.css?version=2021.12.02" rel="stylesheet" /><script async="" id="awsc-panorama-bundle" type="text/javascript" src="https://prod.pa.cdn.uis.awsstatic.com/panorama-nav-init.js" data-config="{'appEntity':'aws-documentation','region':'us-east-1','service':'redshift'}"></script><meta id="panorama-serviceSubSection" value="Database Developer Guide" /><meta id="panorama-serviceConsolePage" value="Improving query performance" /></head><body class="awsdocs awsui"><div class="awsdocs-container"><awsdocs-header></awsdocs-header><awsui-app-layout id="app-layout" class="awsui-util-no-gutters" ng-controller="ContentController as $ctrl" header-selector="awsdocs-header" navigation-hide="false" navigation-width="$ctrl.navWidth" navigation-open="$ctrl.navOpen" navigation-change="$ctrl.onNavChange($event)" tools-hide="$ctrl.hideTools" tools-width="$ctrl.toolsWidth" tools-open="$ctrl.toolsOpen" tools-change="$ctrl.onToolsChange($event)"><div id="guide-toc" dom-region="navigation"><awsdocs-toc></awsdocs-toc></div><div id="main-column" dom-region="content" tabindex="-1"><awsdocs-view class="awsdocs-view"><div id="awsdocs-content"><head><title>Improving query performance - Amazon Redshift</title><meta name="pdf" content="/pdfs/redshift/latest/dg/redshift-dg.pdf#query-performance-improvement-opportunities" /><meta name="rss" content="Dochistory.rss" /><meta name="forums" content="http://forums.aws.amazon.com/forum.jspa?forumID=155" /><meta name="feedback" content="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=Redshift&amp;topic_url=https://docs.aws.amazon.com/en_us/redshift/latest/dg/query-performance-improvement-opportunities.html" /><meta name="feedback-yes" content="feedbackyes.html?topic_url=https://docs.aws.amazon.com/en_us/redshift/latest/dg/query-performance-improvement-opportunities.html" /><meta name="feedback-no" content="feedbackno.html?topic_url=https://docs.aws.amazon.com/en_us/redshift/latest/dg/query-performance-improvement-opportunities.html" /><meta name="keywords" content="Amazon Redshift,AWS Redshift,Redshift,Redshift Spectrum,cluster,data warehouse,developer,sample data,database,database developer,HLL" /><script type="application/ld+json">
{
    "@context" : "https://schema.org",
    "@type" : "BreadcrumbList",
    "itemListElement" : [
      {
        "@type" : "ListItem",
        "position" : 1,
        "name" : "AWS",
        "item" : "https://aws.amazon.com"
      },
      {
        "@type" : "ListItem",
        "position" : 2,
        "name" : "Amazon Redshift",
        "item" : "https://docs.aws.amazon.com/redshift/index.html"
      },
      {
        "@type" : "ListItem",
        "position" : 3,
        "name" : "Database Developer Guide",
        "item" : "https://docs.aws.amazon.com/redshift/latest/dg"
      },
      {
        "@type" : "ListItem",
        "position" : 4,
        "name" : "Tuning query performance",
        "item" : "https://docs.aws.amazon.com/redshift/latest/dg/c-optimizing-query-performance.html"
      },
      {
        "@type" : "ListItem",
        "position" : 5,
        "name" : "Analyzing and improving queries",
        "item" : "https://docs.aws.amazon.com/redshift/latest/dg/c-query-tuning.html"
      },
      {
        "@type" : "ListItem",
        "position" : 6,
        "name" : "Improving query performance",
        "item" : "https://docs.aws.amazon.com/redshift/latest/dg/c-query-tuning.html"
      }
    ]
}
</script></head><body><div id="main"><div style="display: none"><a href="/pdfs/redshift/latest/dg/redshift-dg.pdf#query-performance-improvement-opportunities" target="_blank" rel="noopener noreferrer" title="Open PDF"></a></div><div id="breadcrumbs" class="breadcrumb"><a href="https://aws.amazon.com">AWS</a><a href="/index.html">Documentation</a><a href="/redshift/index.html">Amazon Redshift</a><a href="welcome.html">Database Developer Guide</a></div><div id="page-toc-src"><a href="#table-statistics-missing-or-out-of-date">Table statistics missing or out of
                  date</a><a href="#nested-loop">Nested loop</a><a href="#hash-join">Hash join</a><a href="#ghost-rows-or-uncommitted-rows">Ghost rows or uncommitted rows</a><a href="#unsorted-or-mis-sorted-rows">Unsorted or missorted rows</a><a href="#suboptimal-data-distribution">Suboptimal data distribution</a><a href="#insufficient-memory-allocated-to-the-query">Insufficient memory allocated to the
                  query</a><a href="#suboptimal-WHERE-clause">Suboptimal WHERE clause</a><a href="#insufficiently-restrictive-predicate">Insufficiently restrictive predicate</a><a href="#very-large-result-set">Very large result set</a><a href="#large-SELECT-list">Large SELECT list</a></div><div id="main-content" class="awsui-util-container"><div id="main-col-body"><awsdocs-language-banner data-service="$ctrl.pageService"></awsdocs-language-banner><h1 class="topictitle" id="query-performance-improvement-opportunities">Improving query performance</h1><div class="awsdocs-page-header-container"><awsdocs-page-header></awsdocs-page-header><awsdocs-filter-selector id="awsdocs-filter-selector"></awsdocs-filter-selector></div><p>Following are some common issues that affect query performance, with instructions on
            ways to diagnose and resolve them.</p><div class="highlights" id="inline-topiclist"><h6>Topics</h6><ul><li><a href="#table-statistics-missing-or-out-of-date">Table statistics missing or out of
                  date</a></li><li><a href="#nested-loop">Nested loop</a></li><li><a href="#hash-join">Hash join</a></li><li><a href="#ghost-rows-or-uncommitted-rows">Ghost rows or uncommitted rows</a></li><li><a href="#unsorted-or-mis-sorted-rows">Unsorted or missorted rows</a></li><li><a href="#suboptimal-data-distribution">Suboptimal data distribution</a></li><li><a href="#insufficient-memory-allocated-to-the-query">Insufficient memory allocated to the
                  query</a></li><li><a href="#suboptimal-WHERE-clause">Suboptimal WHERE clause</a></li><li><a href="#insufficiently-restrictive-predicate">Insufficiently restrictive predicate</a></li><li><a href="#very-large-result-set">Very large result set</a></li><li><a href="#large-SELECT-list">Large SELECT list</a></li></ul></div><h2 id="table-statistics-missing-or-out-of-date">Table statistics missing or out of
                  date</h2>
            
            <p>If table statistics are missing or out of date, you might see the
               following:</p>
            <div class="itemizedlist">
                
                
            <ul class="itemizedlist"><li class="listitem">
                  <p>A warning message in EXPLAIN command results.</p>
               </li><li class="listitem">
                  <p>A missing statistics alert event in STL_ALERT_EVENT_LOG. For more
                     information, see <a href="./c-reviewing-query-alerts.html">Reviewing query alerts</a>.</p>
               </li></ul></div>
            <p>To fix this issue, run <a href="./r_ANALYZE.html">ANALYZE</a>.</p>
         <h2 id="nested-loop">Nested loop</h2>
            
            <p>If a nested loop is present, you might see a nested loop alert event in
               STL_ALERT_EVENT_LOG. You can also identify this type of event by running the query at
                  <a href="./diagnostic-queries-for-query-tuning.html#identify-queries-with-nested-loops">Identifying queries with nested loops</a>. For more information, see
                  <a href="./c-reviewing-query-alerts.html">Reviewing query alerts</a>.</p>
            <p>To fix this, review your query for cross-joins and remove them if possible.
               Cross-joins are joins without a join condition that result in the Cartesian product
               of two tables. They are typically run as nested loop joins, which are the
               slowest of the possible join types.</p>
         <h2 id="hash-join">Hash join</h2>
            
            <p>If a hash join is present, you might see the following:</p>
            <div class="itemizedlist">
                
                
            <ul class="itemizedlist"><li class="listitem">
                  <p>Hash and hash join operations in the query plan. For more information, see
                        <a href="./c-analyzing-the-query-plan.html">Analyzing the query plan</a>.</p>
               </li><li class="listitem">
                  <p>An HJOIN step in the segment with the highest maxtime value in
                     SVL_QUERY_SUMMARY. For more information, see <a href="./using-SVL-Query-Summary.html">Using the SVL_QUERY_SUMMARY view</a>.</p>
               </li></ul></div>
            <p>To fix this issue, you can take a couple of approaches:</p>
            <div class="itemizedlist">
                
                
            <ul class="itemizedlist"><li class="listitem">
                  <p>Rewrite the query to use a merge join if possible. You can do this by
                     specifying join columns that are both distribution keys and sort keys.</p>
               </li><li class="listitem">
                  <p>If the HJOIN step in SVL_QUERY_SUMMARY has a very high value in the rows
                     field compared to the rows value in the final RETURN step in the query, check
                     whether you can rewrite the query to join on a unique column. When a query does
                     not join on a unique column, such as a primary key, that increases the number
                     of rows involved in the join.</p>
               </li></ul></div>
         <h2 id="ghost-rows-or-uncommitted-rows">Ghost rows or uncommitted rows</h2>
            
            <p>If ghost rows or uncommitted rows are present, you might see an alert event in
               STL_ALERT_EVENT_LOG that indicates excessive ghost rows. For more information, see
                  <a href="./c-reviewing-query-alerts.html">Reviewing query alerts</a>.</p>
            <p>To fix this issue, you can take a couple of approaches:</p>
            <div class="itemizedlist">
                
                
            <ul class="itemizedlist"><li class="listitem">
                  <p>Check the <b>Loads</b> tab of your Amazon Redshift console for active
                     load operations on any of the query tables. If you see active load operations,
                     wait for those to complete before taking action.</p>
               </li><li class="listitem">
                  <p>If there are no active load operations, run <a href="./r_VACUUM_command.html">VACUUM</a> on the query tables to remove deleted
                     rows.</p>
               </li></ul></div>
         <h2 id="unsorted-or-mis-sorted-rows">Unsorted or missorted rows</h2>
            
            <p>If unsorted or missorted rows are present, you might see a very selective filter
               alert event in STL_ALERT_EVENT_LOG. For more information, see <a href="./c-reviewing-query-alerts.html">Reviewing query alerts</a>.</p>
            <p>You can also check to see if any of the tables in your query have large unsorted
               areas by running the query in <a href="./diagnostic-queries-for-query-tuning.html#identify-tables-with-data-skew-or-unsorted-rows">Identifying tables with data skew
                  or unsorted rows</a>.</p>
            <p>To fix this issue, you can take a couple of approaches:</p>
            <div class="itemizedlist">
                
                
            <ul class="itemizedlist"><li class="listitem">
                  <p>Run <a href="./r_VACUUM_command.html">VACUUM</a> on
                     the query tables to re-sort the rows.</p>
               </li><li class="listitem">
                  <p>Review the sort keys on the query tables to see if any improvements can be
                     made. Remember to weigh the performance of this query against the performance
                     of other important queries and the system overall before making any changes.
                     For more information, see <a href="./t_Sorting_data.html">Working with sort keys</a>.</p>
               </li></ul></div>
         <h2 id="suboptimal-data-distribution">Suboptimal data distribution</h2>
            
            <p>If data distribution is suboptimal, you might see the following:</p>
            <div class="itemizedlist">
                
                
                
            <ul class="itemizedlist"><li class="listitem">
                  <p>A serial execution, large broadcast, or large distribution alert event
                     appears in STL_ALERT_EVENT_LOG. For more information, see <a href="./c-reviewing-query-alerts.html">Reviewing query alerts</a>.</p>
               </li><li class="listitem">
                  <p>Slices are not processing approximately the same number of rows for a given
                     step. For more information, see <a href="./using-SVL-Query-Report.html">Using the SVL_QUERY_REPORT view</a>.</p>
               </li><li class="listitem">
                  <p>Slices are not taking approximately the same amount of time for a given
                     step. For more information, see <a href="./using-SVL-Query-Report.html">Using the SVL_QUERY_REPORT view</a>.</p>
               </li></ul></div>
            <p>If none of the preceding is true, you can also see if any of the tables in your
               query have data skew by running the query in <a href="./diagnostic-queries-for-query-tuning.html#identify-tables-with-data-skew-or-unsorted-rows">Identifying tables with data skew
                  or unsorted rows</a>.</p>
            <p>To fix this issue, review the distribution styles for the tables in the query and see if any improvements can
               be made. Remember to weigh the performance of this query against the performance of
               other important queries and the system overall before making any changes. For more
               information, see <a href="./t_Distributing_data.html">Working with data distribution styles</a>.</p>
         <h2 id="insufficient-memory-allocated-to-the-query">Insufficient memory allocated to the
                  query</h2>
            
            <p>If insufficient memory is allocated to your query, you might see a step in
               SVL_QUERY_SUMMARY that has an <code class="code">is_diskbased</code> value of true. For more
               information, see <a href="./using-SVL-Query-Summary.html">Using the SVL_QUERY_SUMMARY view</a>.</p>
            <p>To fix this issue, allocate more memory to the query by temporarily increasing the
               number of query slots it uses. Workload Management (WLM) reserves slots in a query
               queue equivalent to the concurrency level set for the queue. For example, a queue
               with a concurrency level of 5 has 5 slots. Memory assigned to the queue is allocated
               equally to each slot. Assigning several slots to one query gives that query access to
               the memory for all of those slots. For more information on how to temporarily
               increase the slots for a query, see <a href="./r_wlm_query_slot_count.html">wlm_query_slot_count</a>.</p>
         <h2 id="suboptimal-WHERE-clause">Suboptimal WHERE clause</h2>
            
            <p>If your WHERE clause causes excessive table scans, you might see a SCAN step in
               the segment with the highest <code class="code">maxtime</code> value in SVL_QUERY_SUMMARY. For
               more information, see <a href="./using-SVL-Query-Summary.html">Using the SVL_QUERY_SUMMARY view</a>.</p>
            <p>To fix this issue, add a WHERE clause to the query based on the primary sort
               column of the largest table. This approach helps minimize scanning time. For more
               information, see <a href="./c_designing-tables-best-practices.html">Amazon Redshift best practices for designing
            tables</a>.</p>
         <h2 id="insufficiently-restrictive-predicate">Insufficiently restrictive predicate</h2>
            
            <p>If your query has an insufficiently restrictive predicate, you might see a SCAN
               step in the segment with the highest <code class="code">maxtime</code> value in SVL_QUERY_SUMMARY
               that has a very high <code class="code">rows</code> value compared to the <code class="code">rows</code> value
               in the final RETURN step in the query. For more information, see <a href="./using-SVL-Query-Summary.html">Using the SVL_QUERY_SUMMARY view</a>.</p>
            <p>To fix this issue, try adding a predicate to the query or making the existing
               predicate more restrictive to narrow the output.</p>
         <h2 id="very-large-result-set">Very large result set</h2>
            
            <p>If your query returns a very large result set, consider rewriting the query to use
                  <a href="./r_UNLOAD.html">UNLOAD</a> to write the results to Amazon S3.
               This approach improves the performance of the RETURN step by taking advantage of
               parallel processing. For more information on checking for a very large result set,
               see <a href="./using-SVL-Query-Summary.html">Using the SVL_QUERY_SUMMARY view</a>.</p>
         <h2 id="large-SELECT-list">Large SELECT list</h2>
            
            <p>If your query has an unusually large SELECT list, you might see a
                  <code class="code">bytes</code> value that is high relative to the <code class="code">rows</code> value for
               any step (in comparison to other steps) in SVL_QUERY_SUMMARY. This high
                  <code class="code">bytes</code> value can be an indicator that you are selecting a lot of
               columns. For more information, see <a href="./using-SVL-Query-Summary.html">Using the SVL_QUERY_SUMMARY view</a>.</p>
            <p>To fix this issue, review the columns you are selecting and see if any can be
               removed.</p>
         <awsdocs-copyright class="copyright-print"></awsdocs-copyright><awsdocs-thumb-feedback right-edge="{{$ctrl.thumbFeedbackRightEdge}}"></awsdocs-thumb-feedback></div><noscript><div><div><div><div id="js_error_message"><p><img src="https://d1ge0kk1l5kms0.cloudfront.net/images/G/01/webservices/console/warning.png" alt="Warning" /> <strong>Javascript is disabled or is unavailable in your browser.</strong></p><p>To use the Amazon Web Services Documentation, Javascript must be enabled. Please refer to your browser's Help pages for instructions.</p></div></div></div></div></noscript><div id="main-col-footer" class="awsui-util-font-size-0"><div id="doc-conventions"><a target="_top" href="/general/latest/gr/docconventions.html">Document Conventions</a></div><div class="prev-next"><div id="previous" class="prev-link" accesskey="p" href="./query-plan-summary-map.html">Mapping the query plan to the query summary</div><div id="next" class="next-link" accesskey="n" href="./diagnostic-queries-for-query-tuning.html">Diagnostic queries for query tuning</div></div></div><awsdocs-page-utilities></awsdocs-page-utilities></div><div id="quick-feedback-yes" style="display: none;"><div class="title">Did this page help you? - Yes</div><div class="content"><p>Thanks for letting us know we're doing a good job!</p><p>If you've got a moment, please tell us what we did right so we can do more of it.</p><p><awsui-button id="fblink" rel="noopener noreferrer" target="_blank" text="Feedback" click="linkClick($event)" href="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=Redshift&amp;topic_url=https://docs.aws.amazon.com/en_us/redshift/latest/dg/query-performance-improvement-opportunities.html"></awsui-button></p></div></div><div id="quick-feedback-no" style="display: none;"><div class="title">Did this page help you? - No</div><div class="content"><p>Thanks for letting us know this page needs work. We're sorry we let you down.</p><p>If you've got a moment, please tell us how we can make the documentation better.</p><p><awsui-button id="fblink" rel="noopener noreferrer" target="_blank" text="Feedback" click="linkClick($event)" href="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=Redshift&amp;topic_url=https://docs.aws.amazon.com/en_us/redshift/latest/dg/query-performance-improvement-opportunities.html"></awsui-button></p></div></div></div></body></div></awsdocs-view><div class="page-loading-indicator" id="page-loading-indicator"><awsui-spinner size="large"></awsui-spinner></div></div><div id="tools-panel" dom-region="tools"><awsdocs-tools-panel id="awsdocs-tools-panel"></awsdocs-tools-panel></div></awsui-app-layout><awsdocs-cookie-banner class="doc-cookie-banner"></awsdocs-cookie-banner></div></body></html>