<!DOCTYPE html>
    <html xmlns="http://www.w3.org/1999/xhtml" lang="en-US"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Serializable isolation - Amazon Redshift</title><meta name="viewport" content="width=device-width,initial-scale=1" /><meta name="assets_root" content="/assets" /><meta name="target_state" content="c_serial_isolation" /><meta name="default_state" content="c_serial_isolation" /><link rel="icon" type="image/ico" href="/assets/images/favicon.ico" /><link rel="shortcut icon" type="image/ico" href="/assets/images/favicon.ico" /><link rel="canonical" href="https://docs.aws.amazon.com/redshift/latest/dg/c_serial_isolation.html" /><meta name="description" content="Serializable isolation preserves the illusion that a transaction running against a table is the only transaction that is running against that table." /><meta name="deployment_region" content="IAD" /><meta name="product" content="Amazon Redshift" /><meta name="guide" content="Database Developer Guide" /><meta name="abstract" content="Create and manage a data warehouse with Amazon Redshift, an enterprise-level, petabyte scale, fully managed data warehousing service." /><meta name="guide-locale" content="en_us" /><meta name="tocs" content="toc-contents.json" /><link rel="canonical" href="https://docs.aws.amazon.com/redshift/latest/dg/c_serial_isolation.html" /><link rel="alternative" href="https://docs.aws.amazon.com/id_id/redshift/latest/dg/c_serial_isolation.html" hreflang="id-id" /><link rel="alternative" href="https://docs.aws.amazon.com/id_id/redshift/latest/dg/c_serial_isolation.html" hreflang="id" /><link rel="alternative" href="https://docs.aws.amazon.com/de_de/redshift/latest/dg/c_serial_isolation.html" hreflang="de-de" /><link rel="alternative" href="https://docs.aws.amazon.com/de_de/redshift/latest/dg/c_serial_isolation.html" hreflang="de" /><link rel="alternative" href="https://docs.aws.amazon.com/redshift/latest/dg/c_serial_isolation.html" hreflang="en-us" /><link rel="alternative" href="https://docs.aws.amazon.com/redshift/latest/dg/c_serial_isolation.html" hreflang="en" /><link rel="alternative" href="https://docs.aws.amazon.com/es_es/redshift/latest/dg/c_serial_isolation.html" hreflang="es-es" /><link rel="alternative" href="https://docs.aws.amazon.com/es_es/redshift/latest/dg/c_serial_isolation.html" hreflang="es" /><link rel="alternative" href="https://docs.aws.amazon.com/fr_fr/redshift/latest/dg/c_serial_isolation.html" hreflang="fr-fr" /><link rel="alternative" href="https://docs.aws.amazon.com/fr_fr/redshift/latest/dg/c_serial_isolation.html" hreflang="fr" /><link rel="alternative" href="https://docs.aws.amazon.com/it_it/redshift/latest/dg/c_serial_isolation.html" hreflang="it-it" /><link rel="alternative" href="https://docs.aws.amazon.com/it_it/redshift/latest/dg/c_serial_isolation.html" hreflang="it" /><link rel="alternative" href="https://docs.aws.amazon.com/ja_jp/redshift/latest/dg/c_serial_isolation.html" hreflang="ja-jp" /><link rel="alternative" href="https://docs.aws.amazon.com/ja_jp/redshift/latest/dg/c_serial_isolation.html" hreflang="ja" /><link rel="alternative" href="https://docs.aws.amazon.com/ko_kr/redshift/latest/dg/c_serial_isolation.html" hreflang="ko-kr" /><link rel="alternative" href="https://docs.aws.amazon.com/ko_kr/redshift/latest/dg/c_serial_isolation.html" hreflang="ko" /><link rel="alternative" href="https://docs.aws.amazon.com/pt_br/redshift/latest/dg/c_serial_isolation.html" hreflang="pt-br" /><link rel="alternative" href="https://docs.aws.amazon.com/pt_br/redshift/latest/dg/c_serial_isolation.html" hreflang="pt" /><link rel="alternative" href="https://docs.aws.amazon.com/zh_cn/redshift/latest/dg/c_serial_isolation.html" hreflang="zh-cn" /><link rel="alternative" href="https://docs.aws.amazon.com/zh_tw/redshift/latest/dg/c_serial_isolation.html" hreflang="zh-tw" /><link rel="alternative" href="https://docs.aws.amazon.com/redshift/latest/dg/c_serial_isolation.html" hreflang="x-default" /><meta name="feedback-item" content="Redshift" /><meta name="this_doc_product" content="Amazon Redshift" /><meta name="this_doc_guide" content="Database Developer Guide" /><script defer="" src="/assets/r/vendor4.js?version=2021.12.02"></script><script defer="" src="/assets/r/vendor3.js?version=2021.12.02"></script><script defer="" src="/assets/r/vendor1.js?version=2021.12.02"></script><script defer="" src="/assets/r/awsdocs-common.js?version=2021.12.02"></script><script defer="" src="/assets/r/awsdocs-doc-page.js?version=2021.12.02"></script><link href="/assets/r/vendor4.css?version=2021.12.02" rel="stylesheet" /><link href="/assets/r/awsdocs-common.css?version=2021.12.02" rel="stylesheet" /><link href="/assets/r/awsdocs-doc-page.css?version=2021.12.02" rel="stylesheet" /><script async="" id="awsc-panorama-bundle" type="text/javascript" src="https://prod.pa.cdn.uis.awsstatic.com/panorama-nav-init.js" data-config="{'appEntity':'aws-documentation','region':'us-east-1','service':'redshift'}"></script><meta id="panorama-serviceSubSection" value="Database Developer Guide" /><meta id="panorama-serviceConsolePage" value="Serializable isolation" /></head><body class="awsdocs awsui"><div class="awsdocs-container"><awsdocs-header></awsdocs-header><awsui-app-layout id="app-layout" class="awsui-util-no-gutters" ng-controller="ContentController as $ctrl" header-selector="awsdocs-header" navigation-hide="false" navigation-width="$ctrl.navWidth" navigation-open="$ctrl.navOpen" navigation-change="$ctrl.onNavChange($event)" tools-hide="$ctrl.hideTools" tools-width="$ctrl.toolsWidth" tools-open="$ctrl.toolsOpen" tools-change="$ctrl.onToolsChange($event)"><div id="guide-toc" dom-region="navigation"><awsdocs-toc></awsdocs-toc></div><div id="main-column" dom-region="content" tabindex="-1"><awsdocs-view class="awsdocs-view"><div id="awsdocs-content"><head><title>Serializable isolation - Amazon Redshift</title><meta name="pdf" content="/pdfs/redshift/latest/dg/redshift-dg.pdf#c_serial_isolation" /><meta name="rss" content="Dochistory.rss" /><meta name="forums" content="http://forums.aws.amazon.com/forum.jspa?forumID=155" /><meta name="feedback" content="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=Redshift&amp;topic_url=https://docs.aws.amazon.com/en_us/redshift/latest/dg/c_serial_isolation.html" /><meta name="feedback-yes" content="feedbackyes.html?topic_url=https://docs.aws.amazon.com/en_us/redshift/latest/dg/c_serial_isolation.html" /><meta name="feedback-no" content="feedbackno.html?topic_url=https://docs.aws.amazon.com/en_us/redshift/latest/dg/c_serial_isolation.html" /><meta name="keywords" content="Amazon Redshift,AWS Redshift,Redshift,Redshift Spectrum,cluster,data warehouse,developer,sample data,database,database developer,HLL" /><script type="application/ld+json">
{
    "@context" : "https://schema.org",
    "@type" : "BreadcrumbList",
    "itemListElement" : [
      {
        "@type" : "ListItem",
        "position" : 1,
        "name" : "AWS",
        "item" : "https://aws.amazon.com"
      },
      {
        "@type" : "ListItem",
        "position" : 2,
        "name" : "Amazon Redshift",
        "item" : "https://docs.aws.amazon.com/redshift/index.html"
      },
      {
        "@type" : "ListItem",
        "position" : 3,
        "name" : "Database Developer Guide",
        "item" : "https://docs.aws.amazon.com/redshift/latest/dg"
      },
      {
        "@type" : "ListItem",
        "position" : 4,
        "name" : "Loading data",
        "item" : "https://docs.aws.amazon.com/redshift/latest/dg/t_Loading_data.html"
      },
      {
        "@type" : "ListItem",
        "position" : 5,
        "name" : "Managing concurrent write operations",
        "item" : "https://docs.aws.amazon.com/redshift/latest/dg/c_Concurrent_writes.html"
      },
      {
        "@type" : "ListItem",
        "position" : 6,
        "name" : "Serializable isolation",
        "item" : "https://docs.aws.amazon.com/redshift/latest/dg/c_Concurrent_writes.html"
      }
    ]
}
</script></head><body><div id="main"><div style="display: none"><a href="/pdfs/redshift/latest/dg/redshift-dg.pdf#c_serial_isolation" target="_blank" rel="noopener noreferrer" title="Open PDF"></a></div><div id="breadcrumbs" class="breadcrumb"><a href="https://aws.amazon.com">AWS</a><a href="/index.html">Documentation</a><a href="/redshift/index.html">Amazon Redshift</a><a href="welcome.html">Database Developer Guide</a></div><div id="page-toc-src"><a href="#c_serial_isolation-serializable-isolation-for-tables">Serializable isolation for system tables and catalog
                  tables</a><a href="#c_serial_isolation-serializable-isolation-troubleshooting">How to fix serializable isolation errors</a></div><div id="main-content" class="awsui-util-container"><div id="main-col-body"><awsdocs-language-banner data-service="$ctrl.pageService"></awsdocs-language-banner><h1 class="topictitle" id="c_serial_isolation">Serializable isolation</h1><div class="awsdocs-page-header-container"><awsdocs-page-header></awsdocs-page-header><awsdocs-filter-selector id="awsdocs-filter-selector"></awsdocs-filter-selector></div><p>Some applications require not only concurrent querying and loading, but also the
            ability to write to multiple tables or the same table concurrently. In this context,
               <em>concurrently</em> means overlapping, not scheduled to run at
            precisely the same time. Two transactions are considered to be concurrent if the second
            one starts before the first commits. Concurrent operations can originate from different
            sessions that are controlled either by the same user or by different users.</p><div class="awsdocs-note"><div class="awsdocs-note-title"><awsui-icon name="status-info" variant="link"></awsui-icon><h6>Note</h6></div><div class="awsdocs-note-text"><p>Amazon Redshift supports a default <em>automatic commit</em> behavior in
               which each separately run SQL command commits individually. If you enclose a set of
               commands in a transaction block (defined by <a href="./r_BEGIN.html">BEGIN</a> and <a href="./r_END.html">END</a>
               statements), the block commits as one transaction, so you can roll it back if
               necessary. Exceptions to this behavior are the TRUNCATE and VACUUM commands, which
               automatically commit all outstanding changes made in the current transaction. </p><p>Some SQL clients issue BEGIN and COMMIT commands automatically, so the client
               controls whether a group of statements are run as a transaction or each individual
               statement is run as its own transaction. Check the documentation for the interface
               you are using. For example, when using the Amazon Redshift JDBC driver, a JDBC
                  <code class="code">PreparedStatement</code> with a query string that contains multiple
               (semicolon separated) SQL commands runs all the statements as a single transaction.
               In contrast, if you use SQL Workbench/J and set AUTO COMMIT ON, then if you run
               multiple statements, each statement runs as its own transaction. </p></div></div><p>Concurrent write operations are supported in Amazon Redshift in a protective way, using
            write locks on tables and the principle of <em>serializable isolation</em>.
            Serializable isolation preserves the illusion that a transaction running against a table
            is the only transaction that is running against that table. For example, two
            concurrently running transactions, T1 and T2, must produce the same results as at least
            one of the following:</p><div class="itemizedlist">
             
             
         <ul class="itemizedlist"><li class="listitem">
               <p>T1 and T2 run serially in that order.</p>
            </li><li class="listitem">
               <p>T2 and T1 run serially in that order.</p>
            </li></ul></div><p>Concurrent transactions are invisible to each other; they cannot detect each
            other's changes. Each concurrent transaction will create a snapshot of the database
            at the beginning of the transaction. A database snapshot is created within a transaction
            on the first occurrence of most SELECT statements, DML commands such as COPY, DELETE,
            INSERT, UPDATE, and TRUNCATE, and the following DDL commands:</p><div class="itemizedlist">
             
             
             
             
         <ul class="itemizedlist"><li class="listitem">
               <p>ALTER TABLE (to add or drop columns)</p>
            </li><li class="listitem">
               <p>CREATE TABLE</p>
            </li><li class="listitem">
               <p>DROP TABLE</p>
            </li><li class="listitem">
               <p>TRUNCATE TABLE</p>
            </li></ul></div><p>If any serial execution of the concurrent transactions produces the same results as
            their concurrent execution, those transactions are deemed "serializable" and can be run
            safely. If no serial execution of those transactions can produce the same results, the
            transaction that runs a statement that might break the ability to serialize is stopped
            and rolled back.</p><p>System catalog tables (PG) and other Amazon Redshift system tables (STL and STV) are not
            locked in a transaction. Therefore, changes to database objects that arise from DDL and
            TRUNCATE operations are visible on commit to any concurrent transactions.</p><p>For example, suppose that table A exists in the database when two concurrent
            transactions, T1 and T2, start. Suppose that T2 returns a list of tables by selecting
            from the PG_TABLES catalog table. Then T1 drops table A and commits, and then T2 lists
            the tables again. Table A is now no longer listed. If T2 tries to query the dropped
            table, Amazon Redshift returns a "relation does not exist" error. The catalog query that
            returns the list of tables to T2 or checks that table A exists isn't subject to the
            same isolation rules as operations performed on user tables.</p><p>Transactions for updates to these tables run in a read committed isolation mode.
            PG-prefix catalog tables don't support snapshot isolation.</p>
            <h2 id="c_serial_isolation-serializable-isolation-for-tables">Serializable
                  isolation for system tables and catalog tables</h2>
            <p>A database snapshot is also created in a transaction for any SELECT query that
               references a user-created table or Amazon Redshift system table (STL or STV). SELECT queries
               that don't reference any table don't create a new transaction database
               snapshot. INSERT, DELETE, and UPDATE statements that operate solely on system catalog
               tables (PG) also don't create a new transaction database snapshot.</p>
          
            <h2 id="c_serial_isolation-serializable-isolation-troubleshooting">How to
                  fix serializable isolation errors</h2>
            
             
               <h3 id="c_serial_isolation-serialization-isolation-1023">ERROR:1023
                     DETAIL: Serializable isolation violation on a table in Redshift</h3>
               <p>When Amazon Redshift detects a serializable isolation error, you see an error message such
                  as the following.</p>
               <pre class="programlisting"><div class="code-btn-container"></div><code class="nohighlight">ERROR:1023 DETAIL: Serializable isolation violation on table in Redshift</code></pre>
               <p>To address a serializable isolation error, you can try the following
                  methods:</p>
               <div class="itemizedlist">
                  
                   
                   
                   
                   
               <ul class="itemizedlist"><li class="listitem">
                     <p>Retry the canceled transaction.</p>
                     <p> Amazon Redshift detected that a concurrent workload is not serializable. It
                        suggests gaps in the application logic, which can usually be worked around
                        by retrying the transaction that encountered the error. If the issue
                        persists, try one of the other methods.
                        
                     </p>
                  </li><li class="listitem">
                     <p>Move any operations that don't have to be in the same atomic
                        transaction outside of the transaction.</p>
                     <p>This method applies when individual operations inside two transactions
                        cross-reference each other in a way that can affect the outcome of the other
                        transaction. For example, the following two sessions each start a
                        transaction. 
                     </p>
                     <pre class="programlisting"><div class="code-btn-container"></div><code class="nohighlight">Session1_Redshift=# begin;</code></pre>
                     <pre class="programlisting"><div class="code-btn-container"></div><code class="nohighlight">Session2_Redshift=# begin;</code></pre>
                     <p>The result of a SELECT statement in each transaction might be affected by
                        an INSERT statement in the other. In other words, suppose that you run the
                        following statements serially, in any order. In every case, the result is
                        one of the SELECT statements returning one more row than if the transactions
                        were run concurrently. There is no order in which the operations can run
                        serially that produces the same result as when run concurrently. Thus, the
                        last operation that is run results in a serializable isolation error.</p>
                     <pre class="programlisting"><div class="code-btn-container"></div><code class="nohighlight">Session1_Redshift=# select * from tab1;
Session1_Redshift=# insert into tab2 values (1);</code></pre>
                     <pre class="programlisting"><div class="code-btn-container"></div><code class="nohighlight">Session2_Redshift=# insert into tab1 values (1);
Session2_Redshift=# select * from tab2;</code></pre>
                     <p>In many cases, the result of the SELECT statements isn't important.
                        In other words, the atomicity of the operations in the transactions
                        isn't important. In these cases, move the SELECT statements outside of
                        their transactions, as shown in the following examples.</p>
                     <pre class="programlisting"><div class="code-btn-container"></div><code class="nohighlight">Session1_Redshift=# begin;
Session1_Redshift=# insert into tab1 values (1)
Session1_Redshift=# end;
Session1_Redshift=# select * from tab2;</code></pre>
                     <pre class="programlisting"><div class="code-btn-container"></div><code class="nohighlight">Session2_Redshift # select * from tab1;
Session2_Redshift=# begin;
Session2_Redshift=# insert into tab2 values (1)
Session2_Redshift=# end;</code></pre>
                     <p>In these examples, there are no cross-references in the transactions. The
                        two INSERT statements don't affect each other. In these examples, there
                        is at least one order in which the transactions can run serially and produce
                        the same result as if run concurrently. This means that the transactions are
                        serializable.</p>
                  </li><li class="listitem">
                     <p>Force serialization by locking all tables in each session.</p>
                     <p>The <a href="./r_LOCK.html">LOCK</a> command blocks
                        operations that can result in serializable isolation errors. When you use
                        the LOCK command, be sure to do the following:</p>
                     <div class="itemizedlist">
                         
                         
                         
                     <ul class="itemizedlist"><li class="listitem">
                           <p>Lock all tables affected by the transaction, including those
                              affected by read-only SELECT statements inside the transaction.</p>
                        </li><li class="listitem">
                           <p>Lock tables in the same order, regardless of the order that
                              operations are performed in.</p>
                        </li><li class="listitem">
                           <p>Lock all tables at the beginning of the transaction, before
                              performing any operations.</p>
                        </li></ul></div>
                  </li><li class="listitem"><p>Use snapshot isolation for concurrent transactions</p>
                  <p>Use an ALTER DATABASE command with snapshot isolation. For more information about 
                     the SNAPSHOT parameter for ALTER DATABASE, see 
                     <a href="./r_ALTER_DATABASE.html#r_ALTER_DATABASE-parameters">Parameters</a>.</p></li></ul></div>
             
             
               <h3 id="c_serial_isolation-serialization-isolation-1018">ERROR:1018
                     DETAIL: Relation does not exist</h3>
               <p>When you run concurrent Amazon Redshift operations in different sessions, you see an
                  error message such as the following.</p>
               <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="">ERROR: 1018 DETAIL: Relation does not exist.</code></pre>
               <p>Transactions in Amazon Redshift follow snapshot isolation. After a transaction begins,
                  Amazon Redshift takes a snapshot of the database. For the entire lifecycle of the
                  transaction, the transaction operates on the state of the database as reflected in
                  the snapshot. If the transaction reads from a table that doesn't exist in the
                  snapshot, it throws the 1018 error message shown previously. Even when another
                  concurrent transaction creates a table after the transaction has taken the
                  snapshot, the transaction can't read from the newly created table.</p>
               <p>To address this serialization isolation error, you can try to move the start of
                  the transaction to a point where you know the table exists.</p>
               <p>If the table is created by another transaction, this point is at least after
                  that transaction has been committed. Also, ensure that no concurrent transaction
                  has been committed that might have dropped the table.</p>
               <pre class="programlisting"><div class="code-btn-container"></div><code class="nohighlight">session1 = # BEGIN;
session1 = # DROP TABLE A;
session1 = # COMMIT;</code></pre>
               <pre class="programlisting"><div class="code-btn-container"></div><code class="nohighlight">session2 = # BEGIN;</code></pre>
               <pre class="programlisting"><div class="code-btn-container"></div><code class="nohighlight">session3 = # BEGIN;
session3 = # CREATE TABLE A (id INT);
session3 = # COMMIT;</code></pre>
               <pre class="programlisting"><div class="code-btn-container"></div><code class="nohighlight">session2 = # SELECT * FROM A;</code></pre>
               <p>The last operation that is run as the read operation by session2 results in a
                  serializable isolation error. This error happens when session2 takes a snapshot
                  and the table has already been dropped by a committed session1. In other words,
                  even though a concurrent session3 has created the table, session2 doesn't see the
                  table because it's not in the snapshot.</p>
               <p>To resolve this error, you can reorder the sessions as follows.</p>
               <pre class="programlisting"><div class="code-btn-container"></div><code class="nohighlight">session1 = # BEGIN;
session1 = # DROP TABLE A;
session1 = # COMMIT;</code></pre>
               <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="nocopy ">session3 = # BEGIN;
session3 = # CREATE TABLE A (id INT);
session3 = # COMMIT;</code></pre>
               <pre class="programlisting"><div class="code-btn-container"></div><code class="nohighlight">session2 = # BEGIN;
session2 = # SELECT * FROM A;</code></pre>
               <p>Now when session2 takes its snapshot, session3 has already been committed, and
                  the table is in the database. Session2 can read from the table without any
                  error.</p>
             
         <awsdocs-copyright class="copyright-print"></awsdocs-copyright><awsdocs-thumb-feedback right-edge="{{$ctrl.thumbFeedbackRightEdge}}"></awsdocs-thumb-feedback></div><noscript><div><div><div><div id="js_error_message"><p><img src="https://d1ge0kk1l5kms0.cloudfront.net/images/G/01/webservices/console/warning.png" alt="Warning" /> <strong>Javascript is disabled or is unavailable in your browser.</strong></p><p>To use the Amazon Web Services Documentation, Javascript must be enabled. Please refer to your browser's Help pages for instructions.</p></div></div></div></div></noscript><div id="main-col-footer" class="awsui-util-font-size-0"><div id="doc-conventions"><a target="_top" href="/general/latest/gr/docconventions.html">Document Conventions</a></div><div class="prev-next"><div id="previous" class="prev-link" accesskey="p" href="./c_Concurrent_writes.html">Managing concurrent write operations</div><div id="next" class="next-link" accesskey="n" href="./c_write_readwrite.html">Write and read/write operations</div></div></div><awsdocs-page-utilities></awsdocs-page-utilities></div><div id="quick-feedback-yes" style="display: none;"><div class="title">Did this page help you? - Yes</div><div class="content"><p>Thanks for letting us know we're doing a good job!</p><p>If you've got a moment, please tell us what we did right so we can do more of it.</p><p><awsui-button id="fblink" rel="noopener noreferrer" target="_blank" text="Feedback" click="linkClick($event)" href="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=Redshift&amp;topic_url=https://docs.aws.amazon.com/en_us/redshift/latest/dg/c_serial_isolation.html"></awsui-button></p></div></div><div id="quick-feedback-no" style="display: none;"><div class="title">Did this page help you? - No</div><div class="content"><p>Thanks for letting us know this page needs work. We're sorry we let you down.</p><p>If you've got a moment, please tell us how we can make the documentation better.</p><p><awsui-button id="fblink" rel="noopener noreferrer" target="_blank" text="Feedback" click="linkClick($event)" href="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=Redshift&amp;topic_url=https://docs.aws.amazon.com/en_us/redshift/latest/dg/c_serial_isolation.html"></awsui-button></p></div></div></div></body></div></awsdocs-view><div class="page-loading-indicator" id="page-loading-indicator"><awsui-spinner size="large"></awsui-spinner></div></div><div id="tools-panel" dom-region="tools"><awsdocs-tools-panel id="awsdocs-tools-panel"></awsdocs-tools-panel></div></awsui-app-layout><awsdocs-cookie-banner class="doc-cookie-banner"></awsdocs-cookie-banner></div></body></html>