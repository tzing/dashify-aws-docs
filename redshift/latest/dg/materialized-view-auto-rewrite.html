<!DOCTYPE html>
    <html xmlns="http://www.w3.org/1999/xhtml" lang="en-US"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Automatic query rewriting to use materialized views - Amazon Redshift</title><meta name="viewport" content="width=device-width,initial-scale=1" /><meta name="assets_root" content="/assets" /><meta name="target_state" content="materialized-view-auto-rewrite" /><meta name="default_state" content="materialized-view-auto-rewrite" /><link rel="icon" type="image/ico" href="/assets/images/favicon.ico" /><link rel="shortcut icon" type="image/ico" href="/assets/images/favicon.ico" /><link rel="canonical" href="https://docs.aws.amazon.com/redshift/latest/dg/materialized-view-auto-rewrite.html" /><meta name="description" content="Amazon Redshift can rewrite queries to use a materialized view." /><meta name="deployment_region" content="IAD" /><meta name="product" content="Amazon Redshift" /><meta name="guide" content="Database Developer Guide" /><meta name="abstract" content="Create and manage a data warehouse with Amazon Redshift, an enterprise-level, petabyte scale, fully managed data warehousing service." /><meta name="guide-locale" content="en_us" /><meta name="tocs" content="toc-contents.json" /><link rel="canonical" href="https://docs.aws.amazon.com/redshift/latest/dg/materialized-view-auto-rewrite.html" /><link rel="alternative" href="https://docs.aws.amazon.com/id_id/redshift/latest/dg/materialized-view-auto-rewrite.html" hreflang="id-id" /><link rel="alternative" href="https://docs.aws.amazon.com/id_id/redshift/latest/dg/materialized-view-auto-rewrite.html" hreflang="id" /><link rel="alternative" href="https://docs.aws.amazon.com/de_de/redshift/latest/dg/materialized-view-auto-rewrite.html" hreflang="de-de" /><link rel="alternative" href="https://docs.aws.amazon.com/de_de/redshift/latest/dg/materialized-view-auto-rewrite.html" hreflang="de" /><link rel="alternative" href="https://docs.aws.amazon.com/redshift/latest/dg/materialized-view-auto-rewrite.html" hreflang="en-us" /><link rel="alternative" href="https://docs.aws.amazon.com/redshift/latest/dg/materialized-view-auto-rewrite.html" hreflang="en" /><link rel="alternative" href="https://docs.aws.amazon.com/es_es/redshift/latest/dg/materialized-view-auto-rewrite.html" hreflang="es-es" /><link rel="alternative" href="https://docs.aws.amazon.com/es_es/redshift/latest/dg/materialized-view-auto-rewrite.html" hreflang="es" /><link rel="alternative" href="https://docs.aws.amazon.com/fr_fr/redshift/latest/dg/materialized-view-auto-rewrite.html" hreflang="fr-fr" /><link rel="alternative" href="https://docs.aws.amazon.com/fr_fr/redshift/latest/dg/materialized-view-auto-rewrite.html" hreflang="fr" /><link rel="alternative" href="https://docs.aws.amazon.com/it_it/redshift/latest/dg/materialized-view-auto-rewrite.html" hreflang="it-it" /><link rel="alternative" href="https://docs.aws.amazon.com/it_it/redshift/latest/dg/materialized-view-auto-rewrite.html" hreflang="it" /><link rel="alternative" href="https://docs.aws.amazon.com/ja_jp/redshift/latest/dg/materialized-view-auto-rewrite.html" hreflang="ja-jp" /><link rel="alternative" href="https://docs.aws.amazon.com/ja_jp/redshift/latest/dg/materialized-view-auto-rewrite.html" hreflang="ja" /><link rel="alternative" href="https://docs.aws.amazon.com/ko_kr/redshift/latest/dg/materialized-view-auto-rewrite.html" hreflang="ko-kr" /><link rel="alternative" href="https://docs.aws.amazon.com/ko_kr/redshift/latest/dg/materialized-view-auto-rewrite.html" hreflang="ko" /><link rel="alternative" href="https://docs.aws.amazon.com/pt_br/redshift/latest/dg/materialized-view-auto-rewrite.html" hreflang="pt-br" /><link rel="alternative" href="https://docs.aws.amazon.com/pt_br/redshift/latest/dg/materialized-view-auto-rewrite.html" hreflang="pt" /><link rel="alternative" href="https://docs.aws.amazon.com/zh_cn/redshift/latest/dg/materialized-view-auto-rewrite.html" hreflang="zh-cn" /><link rel="alternative" href="https://docs.aws.amazon.com/zh_tw/redshift/latest/dg/materialized-view-auto-rewrite.html" hreflang="zh-tw" /><link rel="alternative" href="https://docs.aws.amazon.com/redshift/latest/dg/materialized-view-auto-rewrite.html" hreflang="x-default" /><meta name="feedback-item" content="Redshift" /><meta name="this_doc_product" content="Amazon Redshift" /><meta name="this_doc_guide" content="Database Developer Guide" /><script defer="" src="/assets/r/vendor4.js?version=2021.12.02"></script><script defer="" src="/assets/r/vendor3.js?version=2021.12.02"></script><script defer="" src="/assets/r/vendor1.js?version=2021.12.02"></script><script defer="" src="/assets/r/awsdocs-common.js?version=2021.12.02"></script><script defer="" src="/assets/r/awsdocs-doc-page.js?version=2021.12.02"></script><link href="/assets/r/vendor4.css?version=2021.12.02" rel="stylesheet" /><link href="/assets/r/awsdocs-common.css?version=2021.12.02" rel="stylesheet" /><link href="/assets/r/awsdocs-doc-page.css?version=2021.12.02" rel="stylesheet" /><script async="" id="awsc-panorama-bundle" type="text/javascript" src="https://prod.pa.cdn.uis.awsstatic.com/panorama-nav-init.js" data-config="{'appEntity':'aws-documentation','region':'us-east-1','service':'redshift'}"></script><meta id="panorama-serviceSubSection" value="Database Developer Guide" /><meta id="panorama-serviceConsolePage" value="Automatic query rewriting to use materialized views" /></head><body class="awsdocs awsui"><div class="awsdocs-container"><awsdocs-header></awsdocs-header><awsui-app-layout id="app-layout" class="awsui-util-no-gutters" ng-controller="ContentController as $ctrl" header-selector="awsdocs-header" navigation-hide="false" navigation-width="$ctrl.navWidth" navigation-open="$ctrl.navOpen" navigation-change="$ctrl.onNavChange($event)" tools-hide="$ctrl.hideTools" tools-width="$ctrl.toolsWidth" tools-open="$ctrl.toolsOpen" tools-change="$ctrl.onToolsChange($event)"><div id="guide-toc" dom-region="navigation"><awsdocs-toc></awsdocs-toc></div><div id="main-column" dom-region="content" tabindex="-1"><awsdocs-view class="awsdocs-view"><div id="awsdocs-content"><head><title>Automatic query rewriting to use materialized views - Amazon Redshift</title><meta name="pdf" content="/pdfs/redshift/latest/dg/redshift-dg.pdf#materialized-view-auto-rewrite" /><meta name="rss" content="Dochistory.rss" /><meta name="forums" content="http://forums.aws.amazon.com/forum.jspa?forumID=155" /><meta name="feedback" content="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=Redshift&amp;topic_url=https://docs.aws.amazon.com/en_us/redshift/latest/dg/materialized-view-auto-rewrite.html" /><meta name="feedback-yes" content="feedbackyes.html?topic_url=https://docs.aws.amazon.com/en_us/redshift/latest/dg/materialized-view-auto-rewrite.html" /><meta name="feedback-no" content="feedbackno.html?topic_url=https://docs.aws.amazon.com/en_us/redshift/latest/dg/materialized-view-auto-rewrite.html" /><meta name="keywords" content="Amazon Redshift,AWS Redshift,Redshift,Redshift Spectrum,cluster,data warehouse,developer,sample data,database,database developer,HLL" /><script type="application/ld+json">
{
    "@context" : "https://schema.org",
    "@type" : "BreadcrumbList",
    "itemListElement" : [
      {
        "@type" : "ListItem",
        "position" : 1,
        "name" : "AWS",
        "item" : "https://aws.amazon.com"
      },
      {
        "@type" : "ListItem",
        "position" : 2,
        "name" : "Amazon Redshift",
        "item" : "https://docs.aws.amazon.com/redshift/index.html"
      },
      {
        "@type" : "ListItem",
        "position" : 3,
        "name" : "Database Developer Guide",
        "item" : "https://docs.aws.amazon.com/redshift/latest/dg"
      },
      {
        "@type" : "ListItem",
        "position" : 4,
        "name" : "Creating materialized views in Amazon Redshift",
        "item" : "https://docs.aws.amazon.com/redshift/latest/dg/materialized-view-overview.html"
      },
      {
        "@type" : "ListItem",
        "position" : 5,
        "name" : "Automatic query rewriting to use materialized views",
        "item" : "https://docs.aws.amazon.com/redshift/latest/dg/materialized-view-overview.html"
      }
    ]
}
</script></head><body><div id="main"><div style="display: none"><a href="/pdfs/redshift/latest/dg/redshift-dg.pdf#materialized-view-auto-rewrite" target="_blank" rel="noopener noreferrer" title="Open PDF"></a></div><div id="breadcrumbs" class="breadcrumb"><a href="https://aws.amazon.com">AWS</a><a href="/index.html">Documentation</a><a href="/redshift/index.html">Amazon Redshift</a><a href="welcome.html">Database Developer Guide</a></div><div id="page-toc-src"><a href="#mv_auto-rewrite_usage">Usage notes</a><a href="#mv_auto-rewrite_limitations">Limitations</a></div><div id="main-content" class="awsui-util-container"><div id="main-col-body"><awsdocs-language-banner data-service="$ctrl.pageService"></awsdocs-language-banner><h1 class="topictitle" id="materialized-view-auto-rewrite">Automatic query rewriting to use
                materialized views</h1><div class="awsdocs-page-header-container"><awsdocs-page-header></awsdocs-page-header><awsdocs-filter-selector id="awsdocs-filter-selector"></awsdocs-filter-selector></div><p>You can use automatic query rewriting of materialized views in Amazon Redshift to have
            Amazon Redshift rewrite queries to use materialized views. Doing this accelerates query
            workloads even for queries that don't explicitly reference a materialized view.
            When Amazon Redshift rewrites queries, it only uses materialized views that are up to date.</p>
            <h2 id="mv_auto-rewrite_usage">Usage notes</h2>
          
     
        <p>To check if automatic rewriting of queries is used for a query, you can inspect the
                query plan or STL_EXPLAIN. The following shows a SELECT statement and the EXPLAIN
                output of the original query
                plan.</p>
            <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="">SELECT catgroup, SUM(qtysold) AS sold
FROM category c, event e, sales s
WHERE c.catid = e.catid AND e.eventid = s.eventid
GROUP BY 1;

EXPLAIN 
 XN HashAggregate  (cost=920021.24..920021.24 rows=1 width=35)
   -&gt;  XN Hash Join DS_BCAST_INNER  (cost=440004.53..920021.22 rows=4 width=35)
         Hash Cond: ("outer".eventid = "inner".eventid)
         -&gt;  XN Seq Scan on sales s  (cost=0.00..7.40 rows=740 width=6)
         -&gt;  XN Hash  (cost=440004.52..440004.52 rows=1 width=37)
               -&gt;  XN Hash Join DS_BCAST_INNER  (cost=0.01..440004.52 rows=1 width=37)
                     Hash Cond: ("outer".catid = "inner".catid)
                     -&gt;  XN Seq Scan on event e  (cost=0.00..2.00 rows=200 width=6)
                     -&gt;  XN Hash  (cost=0.01..0.01 rows=1 width=35)
                           -&gt;  XN Seq Scan on category c  (cost=0.00..0.01 rows=1 width=35)</code></pre>
                <p>The following shows the EXPLAIN output after a successful automatic rewriting.
                This output includes a scan on the materialized view in the query plan that replaces
                parts of the original query plan.
                </p>
                <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="">* EXPLAIN 
     XN HashAggregate  (cost=11.85..12.35 rows=200 width=41)
       -&gt;  XN Seq Scan on mv_tbl__tickets_mv__0 derived_table1  (cost=0.00..7.90 rows=790 width=41)
</code></pre>
                
            
            
            
                
                
                
                <p>Only up-to-date (fresh) materialized views are considered for automatic
                rewriting of queries, irrespective of the refresh strategy, such as auto, scheduled,
                or manual. Hence, the original query returns up-to-date results. When a materialized
                view is explicitly referenced in queries, Amazon Redshift accesses currently stored data in
                the materialized view. This data might not reflect the latest changes from the base tables
                of the materialized view.</p>
            <p>You can use automatic query rewriting of materialized views that are created on cluster version 1.0.20949 or later.</p>
            <p>You can stop automatic query rewriting at the session level by using SET
                mv_enable_aqmv_for_session to FALSE.</p>
               
            
            
          
            
         
            <h2 id="mv_auto-rewrite_limitations">Limitations</h2>
            <p>Following are limitations for using automatic query rewriting of materialized views:</p>
            <div class="itemizedlist">
                 
               
                 
           
            <ul class="itemizedlist"><li class="listitem"><p>Automatic query rewriting works with materialized views that don't reference or
                include any of the following:</p>
                <div class="itemizedlist">
                     
                     
                     
                     
                     
                     
                     
                     
                     
                <ul class="itemizedlist"><li class="listitem"><p>Subqueries</p></li><li class="listitem"><p>Left, right, or full outer joins</p></li><li class="listitem"><p>Set operations </p></li><li class="listitem"><p>Any aggregate functions, except SUM, COUNT, MIN, MAX, and AVG. (These are the only 
                        aggregate functions that work with automatic query rewriting.)</p></li><li class="listitem"><p>Any aggregate functions with DISTINCT</p></li><li class="listitem"><p>Any window functions</p></li><li class="listitem"><p>SELECT DISTINCT or HAVING clauses</p></li><li class="listitem"><p>External tables</p></li><li class="listitem"><p>Other materialized views</p></li></ul></div></li><li class="listitem"><p>Automatic query rewriting rewrites SELECT queries that refer to user-defined
                Amazon Redshift tables. Amazon Redshift doesn't rewrite the following queries:</p>
                  <div class="itemizedlist">
                       
                       
                       
                       
                  <ul class="itemizedlist"><li class="listitem"><p>CREATE TABLE AS statements</p></li><li class="listitem"><p>SELECT INTO statements</p></li><li class="listitem"><p>Queries on catalogs or system tables</p></li><li class="listitem"><p>Queries with outer joins or a SELECT DISTINCT clause</p></li></ul></div></li><li class="listitem"><p>If a query isn't automatically rewritten, check whether you have the SELECT permission on
                        the specified materialized view and the <a href="./r_mv_enable_aqmv_for_session.html">mv_enable_aqmv_for_session</a> option is set to TRUE. </p>
            <p>You can also check if your materialized views are eligible for automatic rewriting
                of queries by inspecting STV_MV_INFO. For more information, see <a href="./r_STV_MV_INFO.html">STV_MV_INFO</a>.</p></li></ul></div>
    <awsdocs-copyright class="copyright-print"></awsdocs-copyright><awsdocs-thumb-feedback right-edge="{{$ctrl.thumbFeedbackRightEdge}}"></awsdocs-thumb-feedback></div><noscript><div><div><div><div id="js_error_message"><p><img src="https://d1ge0kk1l5kms0.cloudfront.net/images/G/01/webservices/console/warning.png" alt="Warning" /> <strong>Javascript is disabled or is unavailable in your browser.</strong></p><p>To use the Amazon Web Services Documentation, Javascript must be enabled. Please refer to your browser's Help pages for instructions.</p></div></div></div></div></noscript><div id="main-col-footer" class="awsui-util-font-size-0"><div id="doc-conventions"><a target="_top" href="/general/latest/gr/docconventions.html">Document Conventions</a></div><div class="prev-next"><div id="previous" class="prev-link" accesskey="p" href="./materialized-view-query.html">Querying a materialized view</div><div id="next" class="next-link" accesskey="n" href="./materialized-view-refresh.html">Refreshing a materialized view</div></div></div><awsdocs-page-utilities></awsdocs-page-utilities></div><div id="quick-feedback-yes" style="display: none;"><div class="title">Did this page help you? - Yes</div><div class="content"><p>Thanks for letting us know we're doing a good job!</p><p>If you've got a moment, please tell us what we did right so we can do more of it.</p><p><awsui-button id="fblink" rel="noopener noreferrer" target="_blank" text="Feedback" click="linkClick($event)" href="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=Redshift&amp;topic_url=https://docs.aws.amazon.com/en_us/redshift/latest/dg/materialized-view-auto-rewrite.html"></awsui-button></p></div></div><div id="quick-feedback-no" style="display: none;"><div class="title">Did this page help you? - No</div><div class="content"><p>Thanks for letting us know this page needs work. We're sorry we let you down.</p><p>If you've got a moment, please tell us how we can make the documentation better.</p><p><awsui-button id="fblink" rel="noopener noreferrer" target="_blank" text="Feedback" click="linkClick($event)" href="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=Redshift&amp;topic_url=https://docs.aws.amazon.com/en_us/redshift/latest/dg/materialized-view-auto-rewrite.html"></awsui-button></p></div></div></div></body></div></awsdocs-view><div class="page-loading-indicator" id="page-loading-indicator"><awsui-spinner size="large"></awsui-spinner></div></div><div id="tools-panel" dom-region="tools"><awsdocs-tools-panel id="awsdocs-tools-panel"></awsdocs-tools-panel></div></awsui-app-layout><awsdocs-cookie-banner class="doc-cookie-banner"></awsdocs-cookie-banner></div></body></html>