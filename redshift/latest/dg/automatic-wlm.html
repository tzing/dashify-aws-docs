<!DOCTYPE html>
    <html xmlns="http://www.w3.org/1999/xhtml" lang="en-US"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Implementing automatic WLM - Amazon Redshift</title><meta name="viewport" content="width=device-width,initial-scale=1" /><meta name="assets_root" content="/assets" /><meta name="target_state" content="automatic-wlm" /><meta name="default_state" content="automatic-wlm" /><link rel="icon" type="image/ico" href="/assets/images/favicon.ico" /><link rel="shortcut icon" type="image/ico" href="/assets/images/favicon.ico" /><link rel="canonical" href="https://docs.aws.amazon.com/redshift/latest/dg/automatic-wlm.html" /><meta name="description" content="With automatic workload management (WLM), Amazon Redshift manages query concurrency and memory allocation. You can create up to eight queues with the service class identifiers 100–107. Each queue has a priority. For more information, see ." /><meta name="deployment_region" content="IAD" /><meta name="product" content="Amazon Redshift" /><meta name="guide" content="Database Developer Guide" /><meta name="abstract" content="Create and manage a data warehouse with Amazon Redshift, an enterprise-level, petabyte scale, fully managed data warehousing service." /><meta name="guide-locale" content="en_us" /><meta name="tocs" content="toc-contents.json" /><link rel="canonical" href="https://docs.aws.amazon.com/redshift/latest/dg/automatic-wlm.html" /><link rel="alternative" href="https://docs.aws.amazon.com/id_id/redshift/latest/dg/automatic-wlm.html" hreflang="id-id" /><link rel="alternative" href="https://docs.aws.amazon.com/id_id/redshift/latest/dg/automatic-wlm.html" hreflang="id" /><link rel="alternative" href="https://docs.aws.amazon.com/de_de/redshift/latest/dg/automatic-wlm.html" hreflang="de-de" /><link rel="alternative" href="https://docs.aws.amazon.com/de_de/redshift/latest/dg/automatic-wlm.html" hreflang="de" /><link rel="alternative" href="https://docs.aws.amazon.com/redshift/latest/dg/automatic-wlm.html" hreflang="en-us" /><link rel="alternative" href="https://docs.aws.amazon.com/redshift/latest/dg/automatic-wlm.html" hreflang="en" /><link rel="alternative" href="https://docs.aws.amazon.com/es_es/redshift/latest/dg/automatic-wlm.html" hreflang="es-es" /><link rel="alternative" href="https://docs.aws.amazon.com/es_es/redshift/latest/dg/automatic-wlm.html" hreflang="es" /><link rel="alternative" href="https://docs.aws.amazon.com/fr_fr/redshift/latest/dg/automatic-wlm.html" hreflang="fr-fr" /><link rel="alternative" href="https://docs.aws.amazon.com/fr_fr/redshift/latest/dg/automatic-wlm.html" hreflang="fr" /><link rel="alternative" href="https://docs.aws.amazon.com/it_it/redshift/latest/dg/automatic-wlm.html" hreflang="it-it" /><link rel="alternative" href="https://docs.aws.amazon.com/it_it/redshift/latest/dg/automatic-wlm.html" hreflang="it" /><link rel="alternative" href="https://docs.aws.amazon.com/ja_jp/redshift/latest/dg/automatic-wlm.html" hreflang="ja-jp" /><link rel="alternative" href="https://docs.aws.amazon.com/ja_jp/redshift/latest/dg/automatic-wlm.html" hreflang="ja" /><link rel="alternative" href="https://docs.aws.amazon.com/ko_kr/redshift/latest/dg/automatic-wlm.html" hreflang="ko-kr" /><link rel="alternative" href="https://docs.aws.amazon.com/ko_kr/redshift/latest/dg/automatic-wlm.html" hreflang="ko" /><link rel="alternative" href="https://docs.aws.amazon.com/pt_br/redshift/latest/dg/automatic-wlm.html" hreflang="pt-br" /><link rel="alternative" href="https://docs.aws.amazon.com/pt_br/redshift/latest/dg/automatic-wlm.html" hreflang="pt" /><link rel="alternative" href="https://docs.aws.amazon.com/zh_cn/redshift/latest/dg/automatic-wlm.html" hreflang="zh-cn" /><link rel="alternative" href="https://docs.aws.amazon.com/zh_tw/redshift/latest/dg/automatic-wlm.html" hreflang="zh-tw" /><link rel="alternative" href="https://docs.aws.amazon.com/redshift/latest/dg/automatic-wlm.html" hreflang="x-default" /><meta name="feedback-item" content="Redshift" /><meta name="this_doc_product" content="Amazon Redshift" /><meta name="this_doc_guide" content="Database Developer Guide" /><script defer="" src="/assets/r/vendor4.js?version=2021.12.02"></script><script defer="" src="/assets/r/vendor3.js?version=2021.12.02"></script><script defer="" src="/assets/r/vendor1.js?version=2021.12.02"></script><script defer="" src="/assets/r/awsdocs-common.js?version=2021.12.02"></script><script defer="" src="/assets/r/awsdocs-doc-page.js?version=2021.12.02"></script><link href="/assets/r/vendor4.css?version=2021.12.02" rel="stylesheet" /><link href="/assets/r/awsdocs-common.css?version=2021.12.02" rel="stylesheet" /><link href="/assets/r/awsdocs-doc-page.css?version=2021.12.02" rel="stylesheet" /><script async="" id="awsc-panorama-bundle" type="text/javascript" src="https://prod.pa.cdn.uis.awsstatic.com/panorama-nav-init.js" data-config="{'appEntity':'aws-documentation','region':'us-east-1','service':'redshift'}"></script><meta id="panorama-serviceSubSection" value="Database Developer Guide" /><meta id="panorama-serviceConsolePage" value="Implementing automatic WLM" /></head><body class="awsdocs awsui"><div class="awsdocs-container"><awsdocs-header></awsdocs-header><awsui-app-layout id="app-layout" class="awsui-util-no-gutters" ng-controller="ContentController as $ctrl" header-selector="awsdocs-header" navigation-hide="false" navigation-width="$ctrl.navWidth" navigation-open="$ctrl.navOpen" navigation-change="$ctrl.onNavChange($event)" tools-hide="$ctrl.hideTools" tools-width="$ctrl.toolsWidth" tools-open="$ctrl.toolsOpen" tools-change="$ctrl.onToolsChange($event)"><div id="guide-toc" dom-region="navigation"><awsdocs-toc></awsdocs-toc></div><div id="main-column" dom-region="content" tabindex="-1"><awsdocs-view class="awsdocs-view"><div id="awsdocs-content"><head><title>Implementing automatic WLM - Amazon Redshift</title><meta name="pdf" content="/pdfs/redshift/latest/dg/redshift-dg.pdf#automatic-wlm" /><meta name="rss" content="Dochistory.rss" /><meta name="forums" content="http://forums.aws.amazon.com/forum.jspa?forumID=155" /><meta name="feedback" content="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=Redshift&amp;topic_url=https://docs.aws.amazon.com/en_us/redshift/latest/dg/automatic-wlm.html" /><meta name="feedback-yes" content="feedbackyes.html?topic_url=https://docs.aws.amazon.com/en_us/redshift/latest/dg/automatic-wlm.html" /><meta name="feedback-no" content="feedbackno.html?topic_url=https://docs.aws.amazon.com/en_us/redshift/latest/dg/automatic-wlm.html" /><meta name="keywords" content="Amazon Redshift,AWS Redshift,Redshift,Redshift Spectrum,cluster,data warehouse,developer,sample data,database,database developer,HLL" /><script type="application/ld+json">
{
    "@context" : "https://schema.org",
    "@type" : "BreadcrumbList",
    "itemListElement" : [
      {
        "@type" : "ListItem",
        "position" : 1,
        "name" : "AWS",
        "item" : "https://aws.amazon.com"
      },
      {
        "@type" : "ListItem",
        "position" : 2,
        "name" : "Amazon Redshift",
        "item" : "https://docs.aws.amazon.com/redshift/index.html"
      },
      {
        "@type" : "ListItem",
        "position" : 3,
        "name" : "Database Developer Guide",
        "item" : "https://docs.aws.amazon.com/redshift/latest/dg"
      },
      {
        "@type" : "ListItem",
        "position" : 4,
        "name" : "Implementing workload management",
        "item" : "https://docs.aws.amazon.com/redshift/latest/dg/cm-c-implementing-workload-management.html"
      },
      {
        "@type" : "ListItem",
        "position" : 5,
        "name" : "Implementing automatic WLM",
        "item" : "https://docs.aws.amazon.com/redshift/latest/dg/cm-c-implementing-workload-management.html"
      }
    ]
}
</script></head><body><div id="main"><div style="display: none"><a href="/pdfs/redshift/latest/dg/redshift-dg.pdf#automatic-wlm" target="_blank" rel="noopener noreferrer" title="Open PDF"></a></div><div id="breadcrumbs" class="breadcrumb"><a href="https://aws.amazon.com">AWS</a><a href="/index.html">Documentation</a><a href="/redshift/index.html">Amazon Redshift</a><a href="welcome.html">Database Developer Guide</a></div><div id="page-toc-src"><a href="#wlm-auto-query-priority">Priority</a><a href="#wlm-auto-concurrency-scaling-mode">Concurrency scaling mode</a><a href="#wlm-auto-defining-query-queues-user-groups">User groups</a><a href="#wlm-auto-defining-query-queues-query-groups">Query groups</a><a href="#wlm-auto-wildcards">Wildcards</a><a href="#wlm-auto-query-monitoring-rules">Query monitoring rules</a><a href="#wlm-monitoring-automatic-wlm">Checking for automatic WLM</a></div><div id="main-content" class="awsui-util-container"><div id="main-col-body"><awsdocs-language-banner data-service="$ctrl.pageService"></awsdocs-language-banner><h1 class="topictitle" id="automatic-wlm">Implementing automatic WLM</h1><div class="awsdocs-page-header-container"><awsdocs-page-header></awsdocs-page-header><awsdocs-filter-selector id="awsdocs-filter-selector"></awsdocs-filter-selector></div><p>With automatic workload management (WLM), Amazon Redshift manages query concurrency and memory
         allocation. You can create up to eight queues with the service class identifiers 100–107. Each
         queue has a priority. For more information, see <a href="./query-priority.html">Query priority</a>. </p><p>Automatic WLM determines the amount of resources that
         queries need and adjusts the concurrency based on the workload. When queries requiring
         large amounts of resources are in the system (for example, hash joins between large
         tables), the concurrency is lower. When lighter queries (such as inserts, deletes, scans,
         or simple aggregations) are submitted, concurrency is higher. </p><p>Automatic WLM is separate from short query acceleration (SQA) and it evaluates queries differently. 
         Automatic WLM and SQA work together to allow short running and lightweight queries to complete even while long running, resource intensive queries are active.
         For more information about SQA, see <a href="./wlm-short-query-acceleration.html">Working with short query
            acceleration</a>.
      </p><p>Amazon Redshift enables automatic WLM through parameter groups:</p><div class="itemizedlist">
             
             
         <ul class="itemizedlist"><li class="listitem"><p>If your clusters use the default parameter group, Amazon Redshift enables automatic WLM for them.</p></li><li class="listitem"><p>If your clusters use custom parameter groups, you can configure the clusters to enable
               automatic WLM. We recommend that you create a separate parameter group for your automatic WLM configuration. 
</p></li></ul></div><p>To configure WLM, edit the <code class="code">wlm_json_configuration</code> parameter in a parameter
         group that can be associated with one or more clusters. For more information, see <a href="./cm-c-modifying-wlm-configuration.html">Modifying the WLM configuration</a>.</p><p>You define query queues within the WLM configuration. You can add additional query
         queues to the default WLM configuration, up to a total of eight user queues. You can
         configure the following for each query queue: </p><div class="itemizedlist">
          
          
          
          
          
      <ul class="itemizedlist"><li class="listitem">
            <p>Priority </p>
         </li><li class="listitem">
            <p>Concurrency scaling mode </p>
         </li><li class="listitem">
            <p>User groups </p>
         </li><li class="listitem">
            <p>Query groups </p>
         </li><li class="listitem">
            <p>Query monitoring rules </p>
         </li></ul></div>
         <h2 id="wlm-auto-query-priority">Priority</h2>
         <p>You can define the relative
            importance of queries in a workload by setting a priority value. The priority is
            specified for a queue and inherited by all queries associated with the queue. 
            For more information, see
            <a href="./query-priority.html">Query priority</a>.</p>
       
         <h2 id="wlm-auto-concurrency-scaling-mode">Concurrency scaling mode</h2>
         <p>When concurrency scaling is enabled, Amazon Redshift automatically adds additional cluster
            capacity when you need it to process an increase in concurrent read and write queries. Your users see the most current
            data, whether the queries run on the main cluster or on a concurrency scaling cluster. </p>
         <p>You manage which queries are sent to the concurrency scaling cluster by configuring
            WLM queues. When you enable concurrency scaling for a queue, eligible queries are sent
            to the concurrency scaling cluster instead of waiting in a queue. For more information, see
               <a href="./concurrency-scaling.html">Working with concurrency scaling</a>.</p>
       
         <h2 id="wlm-auto-defining-query-queues-user-groups">User groups</h2>
         
         
         <p>You can assign a set of user groups to a queue by specifying each user group name or
            by using wildcards. When a member of a listed user group runs a query, that query runs
            in the corresponding queue. There is no set limit on the number of user groups that can
            be assigned to a queue. For more information, see 
            <a href="./cm-c-executing-queries.html#cm-c-executing-queries-assigning-queries-to-queues-based-on-user-groups">Assigning queries to queues based on user groups</a>. </p>
       
         <h2 id="wlm-auto-defining-query-queues-query-groups">Query groups </h2>
         
         
         <p>You can assign a set of query groups to a queue by specifying each query group name
            or by using wildcards. A <em>query group</em> is simply a
            label. At runtime, you can assign the query group label to a series of queries. Any
            queries that are assigned to a listed query group run in the corresponding queue. There
            is no set limit to the number of query groups that can be assigned to a queue. For more
            information, see <a href="./cm-c-executing-queries.html#cm-c-executing-queries-assigning-a-query-to-a-query-group">Assigning a
               query to a query group</a>. </p>
       
         <h2 id="wlm-auto-wildcards">Wildcards</h2>
         
         <p>If wildcards are enabled in the WLM queue configuration, you can assign user groups
            and query groups to a queue either individually or by using Unix shell–style
            wildcards. The pattern matching is case-insensitive. </p>
         <p>For example, the '*' wildcard character matches any number of characters. Thus, if
            you add <code class="code">dba_*</code> to the list of user groups for a queue, any user-run query
            that belongs to a group with a name that begins with <code class="code">dba_</code> is assigned to
            that queue. Examples are <code class="code">dba_admin</code> or <code class="code">DBA_primary</code>. The '?'
            wildcard character matches any single character. Thus, if the queue includes user-group
               <code class="code">dba?1</code>, then user groups named <code class="code">dba11</code> and <code class="code">dba21</code>
            match, but <code class="code">dba12</code> doesn't match. </p>
         <p>By default, wildcards aren't enabled.</p>
       
         <h2 id="wlm-auto-query-monitoring-rules">Query monitoring rules</h2>
         
         <p>Query monitoring rules define metrics-based performance boundaries for WLM queues and
            specify what action to take when a query goes beyond those boundaries. For example, for
            a queue dedicated to short running queries, you might create a rule that cancels queries
            that run for more than 60 seconds. To track poorly designed queries, you might have
            another rule that logs queries that contain nested loops. For more information, see
            <a href="./cm-c-wlm-query-monitoring-rules.html">WLM query monitoring rules</a>.</p>
       
         <h2 id="wlm-monitoring-automatic-wlm">Checking for automatic WLM</h2>
         
         <p>To check whether automatic WLM is enabled, run the following query. If the query returns at least one row,
            then automatic WLM is enabled.</p>
         <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="">select * from stv_wlm_service_class_config 
where service_class &gt;= 100;</code></pre>
         
         <p>The following query shows the number of queries that went through each query queue
            (service class). It also shows the average execution time, the number of queries with
            wait time at the 90th percentile, and the average wait time. Automatic WLM queries use
            service classes 100
            through
            107.</p>
         <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="">select final_state, service_class, count(*), avg(total_exec_time), 
percentile_cont(0.9) within group (order by total_queue_time), avg(total_queue_time) 
from stl_wlm_query where userid &gt;= 100 group by 1,2 order by 2,1; </code></pre>
         
         <p>To find which queries were run by automatic WLM, and completed successfully, run the
            following query.</p>
         <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="">select a.queue_start_time, a.total_exec_time, label, trim(querytxt) 
from stl_wlm_query a, stl_query b 
where a.query = b.query and a.service_class &gt;= 100 and a.final_state = 'Completed' 
order by b.query desc limit 5;</code></pre>
 
      <awsdocs-copyright class="copyright-print"></awsdocs-copyright><awsdocs-thumb-feedback right-edge="{{$ctrl.thumbFeedbackRightEdge}}"></awsdocs-thumb-feedback></div><noscript><div><div><div><div id="js_error_message"><p><img src="https://d1ge0kk1l5kms0.cloudfront.net/images/G/01/webservices/console/warning.png" alt="Warning" /> <strong>Javascript is disabled or is unavailable in your browser.</strong></p><p>To use the Amazon Web Services Documentation, Javascript must be enabled. Please refer to your browser's Help pages for instructions.</p></div></div></div></div></noscript><div id="main-col-footer" class="awsui-util-font-size-0"><div id="doc-conventions"><a target="_top" href="/general/latest/gr/docconventions.html">Document Conventions</a></div><div class="prev-next"><div id="previous" class="prev-link" accesskey="p" href="./cm-c-modifying-wlm-configuration.html">Modifying the WLM configuration</div><div id="next" class="next-link" accesskey="n" href="./query-priority.html">Query priority</div></div></div><awsdocs-page-utilities></awsdocs-page-utilities></div><div id="quick-feedback-yes" style="display: none;"><div class="title">Did this page help you? - Yes</div><div class="content"><p>Thanks for letting us know we're doing a good job!</p><p>If you've got a moment, please tell us what we did right so we can do more of it.</p><p><awsui-button id="fblink" rel="noopener noreferrer" target="_blank" text="Feedback" click="linkClick($event)" href="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=Redshift&amp;topic_url=https://docs.aws.amazon.com/en_us/redshift/latest/dg/automatic-wlm.html"></awsui-button></p></div></div><div id="quick-feedback-no" style="display: none;"><div class="title">Did this page help you? - No</div><div class="content"><p>Thanks for letting us know this page needs work. We're sorry we let you down.</p><p>If you've got a moment, please tell us how we can make the documentation better.</p><p><awsui-button id="fblink" rel="noopener noreferrer" target="_blank" text="Feedback" click="linkClick($event)" href="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=Redshift&amp;topic_url=https://docs.aws.amazon.com/en_us/redshift/latest/dg/automatic-wlm.html"></awsui-button></p></div></div></div></body></div></awsdocs-view><div class="page-loading-indicator" id="page-loading-indicator"><awsui-spinner size="large"></awsui-spinner></div></div><div id="tools-panel" dom-region="tools"><awsdocs-tools-panel id="awsdocs-tools-panel"></awsdocs-tools-panel></div></awsui-app-layout><awsdocs-cookie-banner class="doc-cookie-banner"></awsdocs-cookie-banner></div></body></html>