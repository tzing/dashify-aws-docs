<!DOCTYPE html>
    <html xmlns="http://www.w3.org/1999/xhtml" lang="en-US"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Amazon Redshift best practices for designing queries - Amazon Redshift</title><meta name="viewport" content="width=device-width,initial-scale=1" /><meta name="assets_root" content="/assets" /><meta name="target_state" content="c_designing-queries-best-practices" /><meta name="default_state" content="c_designing-queries-best-practices" /><link rel="icon" type="image/ico" href="/assets/images/favicon.ico" /><link rel="shortcut icon" type="image/ico" href="/assets/images/favicon.ico" /><link rel="canonical" href="https://docs.aws.amazon.com/redshift/latest/dg/c_designing-queries-best-practices.html" /><meta name="description" content="To maximize query performance, follow these recommendations when creating queries:" /><meta name="deployment_region" content="IAD" /><meta name="product" content="Amazon Redshift" /><meta name="guide" content="Database Developer Guide" /><meta name="abstract" content="Create and manage a data warehouse with Amazon Redshift, an enterprise-level, petabyte scale, fully managed data warehousing service." /><meta name="guide-locale" content="en_us" /><meta name="tocs" content="toc-contents.json" /><link rel="canonical" href="https://docs.aws.amazon.com/redshift/latest/dg/c_designing-queries-best-practices.html" /><link rel="alternative" href="https://docs.aws.amazon.com/id_id/redshift/latest/dg/c_designing-queries-best-practices.html" hreflang="id-id" /><link rel="alternative" href="https://docs.aws.amazon.com/id_id/redshift/latest/dg/c_designing-queries-best-practices.html" hreflang="id" /><link rel="alternative" href="https://docs.aws.amazon.com/de_de/redshift/latest/dg/c_designing-queries-best-practices.html" hreflang="de-de" /><link rel="alternative" href="https://docs.aws.amazon.com/de_de/redshift/latest/dg/c_designing-queries-best-practices.html" hreflang="de" /><link rel="alternative" href="https://docs.aws.amazon.com/redshift/latest/dg/c_designing-queries-best-practices.html" hreflang="en-us" /><link rel="alternative" href="https://docs.aws.amazon.com/redshift/latest/dg/c_designing-queries-best-practices.html" hreflang="en" /><link rel="alternative" href="https://docs.aws.amazon.com/es_es/redshift/latest/dg/c_designing-queries-best-practices.html" hreflang="es-es" /><link rel="alternative" href="https://docs.aws.amazon.com/es_es/redshift/latest/dg/c_designing-queries-best-practices.html" hreflang="es" /><link rel="alternative" href="https://docs.aws.amazon.com/fr_fr/redshift/latest/dg/c_designing-queries-best-practices.html" hreflang="fr-fr" /><link rel="alternative" href="https://docs.aws.amazon.com/fr_fr/redshift/latest/dg/c_designing-queries-best-practices.html" hreflang="fr" /><link rel="alternative" href="https://docs.aws.amazon.com/it_it/redshift/latest/dg/c_designing-queries-best-practices.html" hreflang="it-it" /><link rel="alternative" href="https://docs.aws.amazon.com/it_it/redshift/latest/dg/c_designing-queries-best-practices.html" hreflang="it" /><link rel="alternative" href="https://docs.aws.amazon.com/ja_jp/redshift/latest/dg/c_designing-queries-best-practices.html" hreflang="ja-jp" /><link rel="alternative" href="https://docs.aws.amazon.com/ja_jp/redshift/latest/dg/c_designing-queries-best-practices.html" hreflang="ja" /><link rel="alternative" href="https://docs.aws.amazon.com/ko_kr/redshift/latest/dg/c_designing-queries-best-practices.html" hreflang="ko-kr" /><link rel="alternative" href="https://docs.aws.amazon.com/ko_kr/redshift/latest/dg/c_designing-queries-best-practices.html" hreflang="ko" /><link rel="alternative" href="https://docs.aws.amazon.com/pt_br/redshift/latest/dg/c_designing-queries-best-practices.html" hreflang="pt-br" /><link rel="alternative" href="https://docs.aws.amazon.com/pt_br/redshift/latest/dg/c_designing-queries-best-practices.html" hreflang="pt" /><link rel="alternative" href="https://docs.aws.amazon.com/zh_cn/redshift/latest/dg/c_designing-queries-best-practices.html" hreflang="zh-cn" /><link rel="alternative" href="https://docs.aws.amazon.com/zh_tw/redshift/latest/dg/c_designing-queries-best-practices.html" hreflang="zh-tw" /><link rel="alternative" href="https://docs.aws.amazon.com/redshift/latest/dg/c_designing-queries-best-practices.html" hreflang="x-default" /><meta name="feedback-item" content="Redshift" /><meta name="this_doc_product" content="Amazon Redshift" /><meta name="this_doc_guide" content="Database Developer Guide" /><script defer="" src="/assets/r/vendor4.js?version=2021.12.02"></script><script defer="" src="/assets/r/vendor3.js?version=2021.12.02"></script><script defer="" src="/assets/r/vendor1.js?version=2021.12.02"></script><script defer="" src="/assets/r/awsdocs-common.js?version=2021.12.02"></script><script defer="" src="/assets/r/awsdocs-doc-page.js?version=2021.12.02"></script><link href="/assets/r/vendor4.css?version=2021.12.02" rel="stylesheet" /><link href="/assets/r/awsdocs-common.css?version=2021.12.02" rel="stylesheet" /><link href="/assets/r/awsdocs-doc-page.css?version=2021.12.02" rel="stylesheet" /><script async="" id="awsc-panorama-bundle" type="text/javascript" src="https://prod.pa.cdn.uis.awsstatic.com/panorama-nav-init.js" data-config="{'appEntity':'aws-documentation','region':'us-east-1','service':'redshift'}"></script><meta id="panorama-serviceSubSection" value="Database Developer Guide" /><meta id="panorama-serviceConsolePage" value="Amazon Redshift best practices for designing queries" /></head><body class="awsdocs awsui"><div class="awsdocs-container"><awsdocs-header></awsdocs-header><awsui-app-layout id="app-layout" class="awsui-util-no-gutters" ng-controller="ContentController as $ctrl" header-selector="awsdocs-header" navigation-hide="false" navigation-width="$ctrl.navWidth" navigation-open="$ctrl.navOpen" navigation-change="$ctrl.onNavChange($event)" tools-hide="$ctrl.hideTools" tools-width="$ctrl.toolsWidth" tools-open="$ctrl.toolsOpen" tools-change="$ctrl.onToolsChange($event)"><div id="guide-toc" dom-region="navigation"><awsdocs-toc></awsdocs-toc></div><div id="main-column" dom-region="content" tabindex="-1"><awsdocs-view class="awsdocs-view"><div id="awsdocs-content"><head><title>Amazon Redshift best practices for designing queries - Amazon Redshift</title><meta name="pdf" content="/pdfs/redshift/latest/dg/redshift-dg.pdf#c_designing-queries-best-practices" /><meta name="rss" content="Dochistory.rss" /><meta name="forums" content="http://forums.aws.amazon.com/forum.jspa?forumID=155" /><meta name="feedback" content="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=Redshift&amp;topic_url=https://docs.aws.amazon.com/en_us/redshift/latest/dg/c_designing-queries-best-practices.html" /><meta name="feedback-yes" content="feedbackyes.html?topic_url=https://docs.aws.amazon.com/en_us/redshift/latest/dg/c_designing-queries-best-practices.html" /><meta name="feedback-no" content="feedbackno.html?topic_url=https://docs.aws.amazon.com/en_us/redshift/latest/dg/c_designing-queries-best-practices.html" /><meta name="keywords" content="Amazon Redshift,AWS Redshift,Redshift,Redshift Spectrum,cluster,data warehouse,developer,sample data,database,database developer,HLL" /><script type="application/ld+json">
{
    "@context" : "https://schema.org",
    "@type" : "BreadcrumbList",
    "itemListElement" : [
      {
        "@type" : "ListItem",
        "position" : 1,
        "name" : "AWS",
        "item" : "https://aws.amazon.com"
      },
      {
        "@type" : "ListItem",
        "position" : 2,
        "name" : "Amazon Redshift",
        "item" : "https://docs.aws.amazon.com/redshift/index.html"
      },
      {
        "@type" : "ListItem",
        "position" : 3,
        "name" : "Database Developer Guide",
        "item" : "https://docs.aws.amazon.com/redshift/latest/dg"
      },
      {
        "@type" : "ListItem",
        "position" : 4,
        "name" : "Amazon Redshift best practices",
        "item" : "https://docs.aws.amazon.com/redshift/latest/dg/best-practices.html"
      },
      {
        "@type" : "ListItem",
        "position" : 5,
        "name" : "Amazon Redshift best practices for designing queries",
        "item" : "https://docs.aws.amazon.com/redshift/latest/dg/best-practices.html"
      }
    ]
}
</script></head><body><div id="main"><div style="display: none"><a href="/pdfs/redshift/latest/dg/redshift-dg.pdf#c_designing-queries-best-practices" target="_blank" rel="noopener noreferrer" title="Open PDF"></a></div><div id="breadcrumbs" class="breadcrumb"><a href="https://aws.amazon.com">AWS</a><a href="/index.html">Documentation</a><a href="/redshift/index.html">Amazon Redshift</a><a href="welcome.html">Database Developer Guide</a></div><div id="main-content" class="awsui-util-container"><div id="main-col-body"><awsdocs-language-banner data-service="$ctrl.pageService"></awsdocs-language-banner><h1 class="topictitle" id="c_designing-queries-best-practices">Amazon Redshift best practices for designing
            queries</h1><div class="awsdocs-page-header-container"><awsdocs-page-header></awsdocs-page-header><awsdocs-filter-selector id="awsdocs-filter-selector"></awsdocs-filter-selector></div><p>To maximize query performance, follow these recommendations when creating
         queries:</p><div class="itemizedlist">
          
          
          
          
          
          
          
          
          
          
          
          
      <ul class="itemizedlist"><li class="listitem">
            <p>Design tables according to best practices to provide a solid foundation for query
               performance. For more information, see <a href="./c_designing-tables-best-practices.html">Amazon Redshift best practices for designing
            tables</a>.</p>
         </li><li class="listitem">
            <p>Avoid using <code class="code">select *</code>. Include only the columns you specifically
               need.</p>
         </li><li class="listitem">
            <p>Use a <a href="./r_CASE_function.html">CASE conditional expression</a> to perform
               complex aggregations instead of selecting from the same table multiple times.</p>
         </li><li class="listitem">
            <p>Don't use cross-joins unless absolutely necessary. These joins without a join
               condition result in the Cartesian product of two tables. Cross-joins are typically
               run as nested-loop joins, which are the slowest of the possible join types.
            </p>
         </li><li class="listitem">
            <p>Use subqueries in cases where one table in the query is used only for predicate
               conditions and the subquery returns a small number of rows (less than about 200). The
               following example uses a subquery to avoid joining the LISTING table.</p>
            <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="">select sum(sales.qtysold)
from sales
where salesid in (select listid from listing where listtime &gt; '2008-12-26');</code></pre>
         </li><li class="listitem">
            <p>Use predicates to restrict the dataset as much as possible.</p>
         </li><li class="listitem">
            <p>In the predicate, use the least expensive operators that you can. <a href="./r_comparison_condition.html">Comparison condition</a>
               operators are preferable to <a href="./r_patternmatching_condition_like.html">LIKE</a> operators. LIKE operators are
               still preferable to <a href="./pattern-matching-conditions-similar-to.html">SIMILAR TO</a> or <a href="./pattern-matching-conditions-posix.html">POSIX operators</a>.</p>
         </li><li class="listitem">
            <p>Avoid using functions in query predicates. Using them can drive up the cost of the
               query by requiring large numbers of rows to resolve the intermediate steps of the
               query.</p>
         </li><li class="listitem">
            <p>If possible, use a WHERE clause to restrict the dataset. The query planner can
               then use row order to help determine which records match the criteria, so it can skip
               scanning large numbers of disk blocks. Without this, the query execution engine must
               scan participating columns entirely.</p>
         </li><li class="listitem">
            <p>Add predicates to filter tables that participate in joins, even if the predicates
               apply the same filters. The query returns the same result set, but Amazon Redshift is able to
               filter the join tables before the scan step and can then efficiently skip scanning
               blocks from those tables. Redundant filters aren't needed if you filter on a column
               that's used in the join condition. </p>
            <p>For example, suppose that you want to join <code class="code">SALES</code> and
                  <code class="code">LISTING</code> to find ticket sales for tickets listed after December,
               grouped by seller. Both tables are sorted by date. The following query joins the
               tables on their common key and filters for <code class="code">listing.listtime</code> values
               greater than December 1.</p>
            <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="">select listing.sellerid, sum(sales.qtysold)
from sales, listing
where sales.salesid = listing.listid
and listing.listtime &gt; '2008-12-01'
group by 1 order by 1;</code></pre>
            <p>The WHERE clause doesn't include a predicate for <code class="code">sales.saletime</code>, so
               the execution engine is forced to scan the entire <code class="code">SALES</code> table. If you
               know the filter would result in fewer rows participating in the join, then add that
               filter as well. The following example cuts execution time significantly.</p>

            <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="">select listing.sellerid, sum(sales.qtysold)
from sales, listing
where sales.salesid = listing.listid
and listing.listtime &gt; '2008-12-01'
and sales.saletime &gt; '2008-12-01'
group by 1 order by 1;</code></pre>

         </li><li class="listitem">
            <p>Use sort keys in the GROUP BY clause so the query planner can use more efficient
               aggregation. A query might qualify for one-phase aggregation when its GROUP BY list
               contains only sort key columns, one of which is also the distribution key. The sort
               key columns in the GROUP BY list must include the first sort key, then other sort
               keys that you want to use in sort key order. For example, it is valid to use the
               first sort key, the first and second sort keys, the first, second, and third sort
               keys, and so on. It is not valid to use the first and third sort keys.</p>
            <p>You can confirm the use of one-phase aggregation by running the <a href="./r_EXPLAIN.html">EXPLAIN</a> command and looking for <code class="code">XN
                  GroupAggregate</code> in the aggregation step of the query.</p>
         </li><li class="listitem">
            <p>If you use both GROUP BY and ORDER BY clauses, make sure that you put the columns
               in the same order in both. That is, use the approach just following.</p>
            <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="">group by a, b, c
order by a, b, c</code></pre>
            <p>Don't use the following approach.</p>
            <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="">group by b, c, a
order by a, b, c</code></pre>
         </li></ul></div><awsdocs-copyright class="copyright-print"></awsdocs-copyright><awsdocs-thumb-feedback right-edge="{{$ctrl.thumbFeedbackRightEdge}}"></awsdocs-thumb-feedback></div><noscript><div><div><div><div id="js_error_message"><p><img src="https://d1ge0kk1l5kms0.cloudfront.net/images/G/01/webservices/console/warning.png" alt="Warning" /> <strong>Javascript is disabled or is unavailable in your browser.</strong></p><p>To use the Amazon Web Services Documentation, Javascript must be enabled. Please refer to your browser's Help pages for instructions.</p></div></div></div></div></noscript><div id="main-col-footer" class="awsui-util-font-size-0"><div id="doc-conventions"><a target="_top" href="/general/latest/gr/docconventions.html">Document Conventions</a></div><div class="prev-next"><div id="previous" class="prev-link" accesskey="p" href="./c_best-practices-avoid-maintenance.html">Schedule around maintenance
               windows</div><div id="next" class="next-link" accesskey="n" href="./advisor.html">Working with Advisor</div></div></div><awsdocs-page-utilities></awsdocs-page-utilities></div><div id="quick-feedback-yes" style="display: none;"><div class="title">Did this page help you? - Yes</div><div class="content"><p>Thanks for letting us know we're doing a good job!</p><p>If you've got a moment, please tell us what we did right so we can do more of it.</p><p><awsui-button id="fblink" rel="noopener noreferrer" target="_blank" text="Feedback" click="linkClick($event)" href="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=Redshift&amp;topic_url=https://docs.aws.amazon.com/en_us/redshift/latest/dg/c_designing-queries-best-practices.html"></awsui-button></p></div></div><div id="quick-feedback-no" style="display: none;"><div class="title">Did this page help you? - No</div><div class="content"><p>Thanks for letting us know this page needs work. We're sorry we let you down.</p><p>If you've got a moment, please tell us how we can make the documentation better.</p><p><awsui-button id="fblink" rel="noopener noreferrer" target="_blank" text="Feedback" click="linkClick($event)" href="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=Redshift&amp;topic_url=https://docs.aws.amazon.com/en_us/redshift/latest/dg/c_designing-queries-best-practices.html"></awsui-button></p></div></div></div></body></div></awsdocs-view><div class="page-loading-indicator" id="page-loading-indicator"><awsui-spinner size="large"></awsui-spinner></div></div><div id="tools-panel" dom-region="tools"><awsdocs-tools-panel id="awsdocs-tools-panel"></awsdocs-tools-panel></div></awsui-app-layout><awsdocs-cookie-banner class="doc-cookie-banner"></awsdocs-cookie-banner></div></body></html>