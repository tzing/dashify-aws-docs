<!DOCTYPE html>
    <html xmlns="http://www.w3.org/1999/xhtml" lang="en-US"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>WLM query queue hopping - Amazon Redshift</title><meta name="viewport" content="width=device-width,initial-scale=1" /><meta name="assets_root" content="/assets" /><meta name="target_state" content="wlm-queue-hopping" /><meta name="default_state" content="wlm-queue-hopping" /><link rel="icon" type="image/ico" href="/assets/images/favicon.ico" /><link rel="shortcut icon" type="image/ico" href="/assets/images/favicon.ico" /><link rel="canonical" href="https://docs.aws.amazon.com/redshift/latest/dg/wlm-queue-hopping.html" /><meta name="description" content="A query can be hopped due to a WLM timeout or a query monitoring rule (QMR) hop action . You can only hop queries in a manual WLM configuration." /><meta name="deployment_region" content="IAD" /><meta name="product" content="Amazon Redshift" /><meta name="guide" content="Database Developer Guide" /><meta name="abstract" content="Create and manage a data warehouse with Amazon Redshift, an enterprise-level, petabyte scale, fully managed data warehousing service." /><meta name="guide-locale" content="en_us" /><meta name="tocs" content="toc-contents.json" /><link rel="canonical" href="https://docs.aws.amazon.com/redshift/latest/dg/wlm-queue-hopping.html" /><link rel="alternative" href="https://docs.aws.amazon.com/id_id/redshift/latest/dg/wlm-queue-hopping.html" hreflang="id-id" /><link rel="alternative" href="https://docs.aws.amazon.com/id_id/redshift/latest/dg/wlm-queue-hopping.html" hreflang="id" /><link rel="alternative" href="https://docs.aws.amazon.com/de_de/redshift/latest/dg/wlm-queue-hopping.html" hreflang="de-de" /><link rel="alternative" href="https://docs.aws.amazon.com/de_de/redshift/latest/dg/wlm-queue-hopping.html" hreflang="de" /><link rel="alternative" href="https://docs.aws.amazon.com/redshift/latest/dg/wlm-queue-hopping.html" hreflang="en-us" /><link rel="alternative" href="https://docs.aws.amazon.com/redshift/latest/dg/wlm-queue-hopping.html" hreflang="en" /><link rel="alternative" href="https://docs.aws.amazon.com/es_es/redshift/latest/dg/wlm-queue-hopping.html" hreflang="es-es" /><link rel="alternative" href="https://docs.aws.amazon.com/es_es/redshift/latest/dg/wlm-queue-hopping.html" hreflang="es" /><link rel="alternative" href="https://docs.aws.amazon.com/fr_fr/redshift/latest/dg/wlm-queue-hopping.html" hreflang="fr-fr" /><link rel="alternative" href="https://docs.aws.amazon.com/fr_fr/redshift/latest/dg/wlm-queue-hopping.html" hreflang="fr" /><link rel="alternative" href="https://docs.aws.amazon.com/it_it/redshift/latest/dg/wlm-queue-hopping.html" hreflang="it-it" /><link rel="alternative" href="https://docs.aws.amazon.com/it_it/redshift/latest/dg/wlm-queue-hopping.html" hreflang="it" /><link rel="alternative" href="https://docs.aws.amazon.com/ja_jp/redshift/latest/dg/wlm-queue-hopping.html" hreflang="ja-jp" /><link rel="alternative" href="https://docs.aws.amazon.com/ja_jp/redshift/latest/dg/wlm-queue-hopping.html" hreflang="ja" /><link rel="alternative" href="https://docs.aws.amazon.com/ko_kr/redshift/latest/dg/wlm-queue-hopping.html" hreflang="ko-kr" /><link rel="alternative" href="https://docs.aws.amazon.com/ko_kr/redshift/latest/dg/wlm-queue-hopping.html" hreflang="ko" /><link rel="alternative" href="https://docs.aws.amazon.com/pt_br/redshift/latest/dg/wlm-queue-hopping.html" hreflang="pt-br" /><link rel="alternative" href="https://docs.aws.amazon.com/pt_br/redshift/latest/dg/wlm-queue-hopping.html" hreflang="pt" /><link rel="alternative" href="https://docs.aws.amazon.com/zh_cn/redshift/latest/dg/wlm-queue-hopping.html" hreflang="zh-cn" /><link rel="alternative" href="https://docs.aws.amazon.com/zh_tw/redshift/latest/dg/wlm-queue-hopping.html" hreflang="zh-tw" /><link rel="alternative" href="https://docs.aws.amazon.com/redshift/latest/dg/wlm-queue-hopping.html" hreflang="x-default" /><meta name="feedback-item" content="Redshift" /><meta name="this_doc_product" content="Amazon Redshift" /><meta name="this_doc_guide" content="Database Developer Guide" /><script defer="" src="/assets/r/vendor4.js?version=2021.12.02"></script><script defer="" src="/assets/r/vendor3.js?version=2021.12.02"></script><script defer="" src="/assets/r/vendor1.js?version=2021.12.02"></script><script defer="" src="/assets/r/awsdocs-common.js?version=2021.12.02"></script><script defer="" src="/assets/r/awsdocs-doc-page.js?version=2021.12.02"></script><link href="/assets/r/vendor4.css?version=2021.12.02" rel="stylesheet" /><link href="/assets/r/awsdocs-common.css?version=2021.12.02" rel="stylesheet" /><link href="/assets/r/awsdocs-doc-page.css?version=2021.12.02" rel="stylesheet" /><script async="" id="awsc-panorama-bundle" type="text/javascript" src="https://prod.pa.cdn.uis.awsstatic.com/panorama-nav-init.js" data-config="{'appEntity':'aws-documentation','region':'us-east-1','service':'redshift'}"></script><meta id="panorama-serviceSubSection" value="Database Developer Guide" /><meta id="panorama-serviceConsolePage" value="WLM query queue hopping" /></head><body class="awsdocs awsui"><div class="awsdocs-container"><awsdocs-header></awsdocs-header><awsui-app-layout id="app-layout" class="awsui-util-no-gutters" ng-controller="ContentController as $ctrl" header-selector="awsdocs-header" navigation-hide="false" navigation-width="$ctrl.navWidth" navigation-open="$ctrl.navOpen" navigation-change="$ctrl.onNavChange($event)" tools-hide="$ctrl.hideTools" tools-width="$ctrl.toolsWidth" tools-open="$ctrl.toolsOpen" tools-change="$ctrl.onToolsChange($event)"><div id="guide-toc" dom-region="navigation"><awsdocs-toc></awsdocs-toc></div><div id="main-column" dom-region="content" tabindex="-1"><awsdocs-view class="awsdocs-view"><div id="awsdocs-content"><head><title>WLM query queue hopping - Amazon Redshift</title><meta name="pdf" content="/pdfs/redshift/latest/dg/redshift-dg.pdf#wlm-queue-hopping" /><meta name="rss" content="Dochistory.rss" /><meta name="forums" content="http://forums.aws.amazon.com/forum.jspa?forumID=155" /><meta name="feedback" content="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=Redshift&amp;topic_url=https://docs.aws.amazon.com/en_us/redshift/latest/dg/wlm-queue-hopping.html" /><meta name="feedback-yes" content="feedbackyes.html?topic_url=https://docs.aws.amazon.com/en_us/redshift/latest/dg/wlm-queue-hopping.html" /><meta name="feedback-no" content="feedbackno.html?topic_url=https://docs.aws.amazon.com/en_us/redshift/latest/dg/wlm-queue-hopping.html" /><meta name="keywords" content="Amazon Redshift,AWS Redshift,Redshift,Redshift Spectrum,cluster,data warehouse,developer,sample data,database,database developer,HLL" /><script type="application/ld+json">
{
    "@context" : "https://schema.org",
    "@type" : "BreadcrumbList",
    "itemListElement" : [
      {
        "@type" : "ListItem",
        "position" : 1,
        "name" : "AWS",
        "item" : "https://aws.amazon.com"
      },
      {
        "@type" : "ListItem",
        "position" : 2,
        "name" : "Amazon Redshift",
        "item" : "https://docs.aws.amazon.com/redshift/index.html"
      },
      {
        "@type" : "ListItem",
        "position" : 3,
        "name" : "Database Developer Guide",
        "item" : "https://docs.aws.amazon.com/redshift/latest/dg"
      },
      {
        "@type" : "ListItem",
        "position" : 4,
        "name" : "Implementing workload management",
        "item" : "https://docs.aws.amazon.com/redshift/latest/dg/cm-c-implementing-workload-management.html"
      },
      {
        "@type" : "ListItem",
        "position" : 5,
        "name" : "Implementing manual WLM",
        "item" : "https://docs.aws.amazon.com/redshift/latest/dg/cm-c-defining-query-queues.html"
      },
      {
        "@type" : "ListItem",
        "position" : 6,
        "name" : "WLM query queue hopping",
        "item" : "https://docs.aws.amazon.com/redshift/latest/dg/cm-c-defining-query-queues.html"
      }
    ]
}
</script></head><body><div id="main"><div style="display: none"><a href="/pdfs/redshift/latest/dg/redshift-dg.pdf#wlm-queue-hopping" target="_blank" rel="noopener noreferrer" title="Open PDF"></a></div><div id="breadcrumbs" class="breadcrumb"><a href="https://aws.amazon.com">AWS</a><a href="/index.html">Documentation</a><a href="/redshift/index.html">Amazon Redshift</a><a href="welcome.html">Database Developer Guide</a></div><div id="page-toc-src"><a href="#wlm-queue-hopping-summary">WLM timeout actions</a><a href="#wlm-timeout-queue-hopping">WLM timeout queue hopping</a><a href="#wlm-timeout-reassigned-and-restarted-queries">WLM timeout reassigned
                  and restarted queries</a><a href="#qmr-hop-action-queue-hopping">QMR hop actions</a><a href="#qmr-hop-action-reassigned-and-restarted-queries">QMR hop action
                  reassigned and restarted queries</a></div><div id="main-content" class="awsui-util-container"><div id="main-col-body"><awsdocs-language-banner data-service="$ctrl.pageService"></awsdocs-language-banner><h1 class="topictitle" id="wlm-queue-hopping">WLM query queue hopping</h1><div class="awsdocs-page-header-container"><awsdocs-page-header></awsdocs-page-header><awsdocs-filter-selector id="awsdocs-filter-selector"></awsdocs-filter-selector></div><p>A query can be hopped due to a <a href="./cm-c-defining-query-queues.html#wlm-timeout">WLM timeout</a> or a <a href="./cm-c-wlm-query-monitoring-rules.html#cm-c-wlm-defining-query-monitoring-rules">query monitoring rule (QMR) hop
            action</a>. You can only hop queries in a manual WLM configuration. </p><p>When a query is hopped, WLM attempts to route the query to the next matching queue based
         on the <a href="./cm-c-wlm-queue-assignment-rules.html">WLM queue assignment rules</a>.
         If the query doesn't match any other queue definition, the query is canceled. It's not
         assigned to the default queue. </p>
         <h2 id="wlm-queue-hopping-summary">WLM timeout actions</h2>
         <p>The following table summarizes the behavior of different types of queries with a WLM
            timeout.</p>
         <div class="table-container"><div class="table-contents"><table id="w323aac62c53c35b7b5"><thead>
                  <tr>
                     <th>Query type</th>
                     <th>Action</th>
                  </tr>
               </thead>
                  <tr>
                     <td tabindex="-1">INSERT, UPDATE, and DELETE</td>
                     <td tabindex="-1">Cancel</td>
                  </tr>
                  <tr>
                     <td tabindex="-1">User-defined functions (UDFs)</td>
                     <td tabindex="-1">Cancel</td>
                  </tr>
                  <tr>
                     <td tabindex="-1">UNLOAD</td>
                     <td tabindex="-1">Cancel</td>
                  </tr>
                  <tr>
                     <td tabindex="-1">COPY</td>
                     <td tabindex="-1">Continue execution</td>
                  </tr>
                  <tr>
                     <td tabindex="-1">Maintenance operations</td>
                     <td tabindex="-1">Continue execution</td>
                  </tr>
                  <tr>
                     <td tabindex="-1">Read-only queries in a <code class="code">returning</code>
                        state</td>
                     <td tabindex="-1">Continue execution</td>
                  </tr>
                  <tr>
                     <td tabindex="-1">Read-only queries in a <code class="code">running</code> state</td>
                     <td tabindex="-1">Reassign or restart</td>
                  </tr>
                  <tr>
                     <td tabindex="-1">CREATE TABLE AS (CTAS), SELECT INTO</td>
                     <td tabindex="-1">Reassign or restart</td>
                  </tr>
               </table></div></div>
         
       
         <h2 id="wlm-timeout-queue-hopping">WLM timeout queue hopping</h2>
         <p>WLM hops the following types of queries when they time out:</p>
         <div class="itemizedlist">
             
             
             
         <ul class="itemizedlist"><li class="listitem">
               <p>Read-only queries, such as SELECT statements, that are in a WLM state of
                     <code class="code">running</code>. To find the WLM state of a query, view the STATE column
                  on the <a href="./r_STV_WLM_QUERY_STATE.html">STV_WLM_QUERY_STATE</a> system table. </p>
            </li><li class="listitem">
               <p>CREATE TABLE AS (CTAS) statements. WLM queue hopping supports both user-defined
                  and system-generated CTAS statements. </p>
            </li><li class="listitem">
               <p>SELECT INTO statements.</p>
            </li></ul></div>
         <p>Queries that aren't subject to WLM timeout continue running in the original queue
            until completion. The following types of queries aren't subject to WLM timeout:</p>
         <div class="itemizedlist">
             
             
             
         <ul class="itemizedlist"><li class="listitem">
               <p>COPY statements</p>
            </li><li class="listitem">
               <p>Maintenance operations, such as ANALYZE and VACUUM</p>
            </li><li class="listitem">
               <p>Read-only queries, such as SELECT statements, that have reached a WLM state of
                     <code class="code">returning</code>. To find the WLM state of a query, view the STATE column
                  on the <a href="./r_STV_WLM_QUERY_STATE.html">STV_WLM_QUERY_STATE</a> system table. </p>
            </li></ul></div>
         <p>Queries that aren't eligible for hopping by WLM timeout are canceled when they time
            out. The following types of queries are not eligible for hopping by a WLM
            timeout:</p>
         <div class="itemizedlist">
             
             
             
         <ul class="itemizedlist"><li class="listitem">
               <p>INSERT, UPDATE, and DELETE statements</p>
            </li><li class="listitem">
               <p>UNLOAD statements</p>
            </li><li class="listitem">
               <p>User-defined functions (UDFs)</p>
            </li></ul></div>

       
         <h2 id="wlm-timeout-reassigned-and-restarted-queries">WLM timeout reassigned
                  and restarted queries</h2>
         <p>When a query is hopped and no matching queue is found, the query is canceled.</p>
         <p>When a query is hopped and a matching queue is found, WLM attempts to reassign the
            query to the new queue. If a query can't be reassigned, it's restarted in the new queue,
            as described following.</p>
         <p>A query is reassigned only if all of the following are true:</p>
         <div class="itemizedlist">
             
             
             
         <ul class="itemizedlist"><li class="listitem">
               <p>A matching queue is found.</p>
            </li><li class="listitem">
               <p>The new queue has enough free slots to run the query. A query might require
                  multiple slots if the <a href="./r_wlm_query_slot_count.html">wlm_query_slot_count</a> parameter was set to a value greater
                  than 1.</p>
            </li><li class="listitem">
               <p>The new queue has at least as much memory available as the query currently
                  uses. </p>
            </li></ul></div>
         <p>If the query is reassigned, the query continues executing in the new queue.
            Intermediate results are preserved, so there is minimal effect on total execution time. </p>
         <p>If the query can't be reassigned, the query is canceled and restarted in the new
            queue. Intermediate results are deleted. The query waits in the queue, then begins
            running when enough slots are available.</p>

       
         <h2 id="qmr-hop-action-queue-hopping">QMR hop actions</h2>
         
         <p>The following table summarizes the behavior of different types of queries with a QMR
            hop action.</p>
         <div class="table-container"><div class="table-contents"><table id="w323aac62c53c35c13b5"><thead>
                  <tr>
                     <th>Query type</th>
                     <th>Action</th>
                  </tr>
               </thead>
                  <tr>
                     <td tabindex="-1">COPY</td>
                     <td tabindex="-1">Continue execution</td>
                  </tr>
                  <tr>
                     <td tabindex="-1">Maintenance operations</td>
                     <td tabindex="-1">Continue execution</td>
                  </tr>
                  <tr>
                     <td tabindex="-1">User-defined functions (UDFs)</td>
                     <td tabindex="-1">Continue execution</td>
                  </tr>
                  <tr>
                     <td tabindex="-1">UNLOAD</td>
                     <td tabindex="-1">Reassign or continue execution</td>
                  </tr>
                  <tr>
                     <td tabindex="-1">INSERT, UPDATE, and DELETE</td>
                     <td tabindex="-1">Reassign or continue execution</td>
                  </tr>
                  <tr>
                     <td tabindex="-1">Read-only queries in a <code class="code">returning</code>
                        state</td>
                     <td tabindex="-1">Reassign or continue execution</td>
                  </tr>
                  <tr>
                     <td tabindex="-1">Read-only queries in a <code class="code">running</code> state</td>
                     <td tabindex="-1">Reassign or restart</td>
                  </tr>
                  <tr>
                     <td tabindex="-1">CREATE TABLE AS (CTAS), SELECT INTO</td>
                     <td tabindex="-1">Reassign or restart</td>
                  </tr>
               </table></div></div>
         
         <p>To find whether a query that was hopped by QMR was reassigned, restarted, or
            canceled, query the <a href="./r_STL_WLM_RULE_ACTION.html">STL_WLM_RULE_ACTION</a> system log table.</p>
  
         

       
         <h2 id="qmr-hop-action-reassigned-and-restarted-queries">QMR hop action
                  reassigned and restarted queries</h2>
         <p>When a query is hopped and no matching queue is found, the query is canceled.</p>
         <p>When a query is hopped and a matching queue is found, WLM attempts to reassign the
            query to the new queue. If a query can't be reassigned, it's restarted in the new queue
            or continues execution in the original queue, as described following.</p>
         <p>A query is reassigned only if all of the following are true:</p>
         <div class="itemizedlist">
             
             
             
         <ul class="itemizedlist"><li class="listitem">
               <p>A matching queue is found.</p>
            </li><li class="listitem">
               <p>The new queue has enough free slots to run the query. A query might require
                  multiple slots if the <a href="./r_wlm_query_slot_count.html">wlm_query_slot_count</a> parameter was set to a value greater
                  than 1.</p>
            </li><li class="listitem">
               <p>The new queue has at least as much memory available as the query currently
                  uses. </p>
            </li></ul></div>
         <p>If the query is reassigned, the query continues executing in the new queue.
            Intermediate results are preserved, so there is minimal effect on total execution time. </p>
         <p>If a query can't be reassigned, the query is either restarted or continues execution
            in the original queue. If the query is restarted, the query is canceled and restarted in
            the new queue. Intermediate results are deleted. The query waits in the queue, then
            begins execution when enough slots are available.</p>
            
          
         

      <awsdocs-copyright class="copyright-print"></awsdocs-copyright><awsdocs-thumb-feedback right-edge="{{$ctrl.thumbFeedbackRightEdge}}"></awsdocs-thumb-feedback></div><noscript><div><div><div><div id="js_error_message"><p><img src="https://d1ge0kk1l5kms0.cloudfront.net/images/G/01/webservices/console/warning.png" alt="Warning" /> <strong>Javascript is disabled or is unavailable in your browser.</strong></p><p>To use the Amazon Web Services Documentation, Javascript must be enabled. Please refer to your browser's Help pages for instructions.</p></div></div></div></div></noscript><div id="main-col-footer" class="awsui-util-font-size-0"><div id="doc-conventions"><a target="_top" href="/general/latest/gr/docconventions.html">Document Conventions</a></div><div class="prev-next"><div id="previous" class="prev-link" accesskey="p" href="./cm-c-defining-query-queues.html">Manual WLM</div><div id="next" class="next-link" accesskey="n" href="./tutorial-configuring-workload-management.html">Tutorial: Configuring
            manual WLM queues</div></div></div><awsdocs-page-utilities></awsdocs-page-utilities></div><div id="quick-feedback-yes" style="display: none;"><div class="title">Did this page help you? - Yes</div><div class="content"><p>Thanks for letting us know we're doing a good job!</p><p>If you've got a moment, please tell us what we did right so we can do more of it.</p><p><awsui-button id="fblink" rel="noopener noreferrer" target="_blank" text="Feedback" click="linkClick($event)" href="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=Redshift&amp;topic_url=https://docs.aws.amazon.com/en_us/redshift/latest/dg/wlm-queue-hopping.html"></awsui-button></p></div></div><div id="quick-feedback-no" style="display: none;"><div class="title">Did this page help you? - No</div><div class="content"><p>Thanks for letting us know this page needs work. We're sorry we let you down.</p><p>If you've got a moment, please tell us how we can make the documentation better.</p><p><awsui-button id="fblink" rel="noopener noreferrer" target="_blank" text="Feedback" click="linkClick($event)" href="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=Redshift&amp;topic_url=https://docs.aws.amazon.com/en_us/redshift/latest/dg/wlm-queue-hopping.html"></awsui-button></p></div></div></div></body></div></awsdocs-view><div class="page-loading-indicator" id="page-loading-indicator"><awsui-spinner size="large"></awsui-spinner></div></div><div id="tools-panel" dom-region="tools"><awsdocs-tools-panel id="awsdocs-tools-panel"></awsdocs-tools-panel></div></awsui-app-layout><awsdocs-cookie-banner class="doc-cookie-banner"></awsdocs-cookie-banner></div></body></html>