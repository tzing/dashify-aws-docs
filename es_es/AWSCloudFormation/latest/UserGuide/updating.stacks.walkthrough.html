<!DOCTYPE html>
    <html xmlns="http://www.w3.org/1999/xhtml" lang="es-ES"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Tutorial: Actualización de una pila - AWS CloudFormation</title><meta name="viewport" content="width=device-width,initial-scale=1" /><meta name="assets_root" content="/assets" /><meta name="target_state" content="updating.stacks.walkthrough" /><meta name="default_state" content="updating.stacks.walkthrough" /><link rel="icon" type="image/ico" href="/assets/images/favicon.ico" /><link rel="shortcut icon" type="image/ico" href="/assets/images/favicon.ico" /><link rel="canonical" href="https://docs.aws.amazon.com/es_es/AWSCloudFormation/latest/UserGuide/updating.stacks.walkthrough.html" /><meta name="description" content="Pase por una sencilla progresión de actualizaciones a una pila en ejecución con AWS CloudFormation." /><meta name="deployment_region" content="IAD" /><meta name="product" content="AWS CloudFormation" /><meta name="guide" content="Guía del usuario" /><meta name="abstract" content="Cree y administre implementaciones de infraestructura de AWS de forma predecible y repetida mediante AWS CloudFormation con esta Guía del usuario." /><meta name="guide-locale" content="es_es" /><meta name="tocs" content="toc-contents.json" /><link rel="canonical" href="https://docs.aws.amazon.com/es_es/AWSCloudFormation/latest/UserGuide/updating.stacks.walkthrough.html" /><link rel="alternative" href="https://docs.aws.amazon.com/id_id/AWSCloudFormation/latest/UserGuide/updating.stacks.walkthrough.html" hreflang="id-id" /><link rel="alternative" href="https://docs.aws.amazon.com/id_id/AWSCloudFormation/latest/UserGuide/updating.stacks.walkthrough.html" hreflang="id" /><link rel="alternative" href="https://docs.aws.amazon.com/de_de/AWSCloudFormation/latest/UserGuide/updating.stacks.walkthrough.html" hreflang="de-de" /><link rel="alternative" href="https://docs.aws.amazon.com/de_de/AWSCloudFormation/latest/UserGuide/updating.stacks.walkthrough.html" hreflang="de" /><link rel="alternative" href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/updating.stacks.walkthrough.html" hreflang="en-us" /><link rel="alternative" href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/updating.stacks.walkthrough.html" hreflang="en" /><link rel="alternative" href="https://docs.aws.amazon.com/es_es/AWSCloudFormation/latest/UserGuide/updating.stacks.walkthrough.html" hreflang="es-es" /><link rel="alternative" href="https://docs.aws.amazon.com/es_es/AWSCloudFormation/latest/UserGuide/updating.stacks.walkthrough.html" hreflang="es" /><link rel="alternative" href="https://docs.aws.amazon.com/fr_fr/AWSCloudFormation/latest/UserGuide/updating.stacks.walkthrough.html" hreflang="fr-fr" /><link rel="alternative" href="https://docs.aws.amazon.com/fr_fr/AWSCloudFormation/latest/UserGuide/updating.stacks.walkthrough.html" hreflang="fr" /><link rel="alternative" href="https://docs.aws.amazon.com/it_it/AWSCloudFormation/latest/UserGuide/updating.stacks.walkthrough.html" hreflang="it-it" /><link rel="alternative" href="https://docs.aws.amazon.com/it_it/AWSCloudFormation/latest/UserGuide/updating.stacks.walkthrough.html" hreflang="it" /><link rel="alternative" href="https://docs.aws.amazon.com/ja_jp/AWSCloudFormation/latest/UserGuide/updating.stacks.walkthrough.html" hreflang="ja-jp" /><link rel="alternative" href="https://docs.aws.amazon.com/ja_jp/AWSCloudFormation/latest/UserGuide/updating.stacks.walkthrough.html" hreflang="ja" /><link rel="alternative" href="https://docs.aws.amazon.com/ko_kr/AWSCloudFormation/latest/UserGuide/updating.stacks.walkthrough.html" hreflang="ko-kr" /><link rel="alternative" href="https://docs.aws.amazon.com/ko_kr/AWSCloudFormation/latest/UserGuide/updating.stacks.walkthrough.html" hreflang="ko" /><link rel="alternative" href="https://docs.aws.amazon.com/pt_br/AWSCloudFormation/latest/UserGuide/updating.stacks.walkthrough.html" hreflang="pt-br" /><link rel="alternative" href="https://docs.aws.amazon.com/pt_br/AWSCloudFormation/latest/UserGuide/updating.stacks.walkthrough.html" hreflang="pt" /><link rel="alternative" href="https://docs.aws.amazon.com/zh_cn/AWSCloudFormation/latest/UserGuide/updating.stacks.walkthrough.html" hreflang="zh-cn" /><link rel="alternative" href="https://docs.aws.amazon.com/zh_tw/AWSCloudFormation/latest/UserGuide/updating.stacks.walkthrough.html" hreflang="zh-tw" /><link rel="alternative" href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/updating.stacks.walkthrough.html" hreflang="x-default" /><meta name="feedback-item" content="CloudFormation" /><meta name="this_doc_product" content="AWS CloudFormation" /><meta name="this_doc_guide" content="Guía del usuario" /><script defer="" src="/assets/r/vendor4.js?version=2021.12.02"></script><script defer="" src="/assets/r/vendor3.js?version=2021.12.02"></script><script defer="" src="/assets/r/vendor1.js?version=2021.12.02"></script><script defer="" src="/assets/r/awsdocs-common.js?version=2021.12.02"></script><script defer="" src="/assets/r/awsdocs-doc-page.js?version=2021.12.02"></script><link href="/assets/r/vendor4.css?version=2021.12.02" rel="stylesheet" /><link href="/assets/r/awsdocs-common.css?version=2021.12.02" rel="stylesheet" /><link href="/assets/r/awsdocs-doc-page.css?version=2021.12.02" rel="stylesheet" /><script async="" id="awsc-panorama-bundle" type="text/javascript" src="https://prod.pa.cdn.uis.awsstatic.com/panorama-nav-init.js" data-config="{'appEntity':'aws-documentation','region':'us-east-1','service':'cloudformation'}"></script><meta id="panorama-serviceSubSection" value="Guía del usuario" /><meta id="panorama-serviceConsolePage" value="Tutorial: Actualización de una pila" /></head><body class="awsdocs awsui"><div class="awsdocs-container"><awsdocs-header></awsdocs-header><awsui-app-layout id="app-layout" class="awsui-util-no-gutters" ng-controller="ContentController as $ctrl" header-selector="awsdocs-header" navigation-hide="false" navigation-width="$ctrl.navWidth" navigation-open="$ctrl.navOpen" navigation-change="$ctrl.onNavChange($event)" tools-hide="$ctrl.hideTools" tools-width="$ctrl.toolsWidth" tools-open="$ctrl.toolsOpen" tools-change="$ctrl.onToolsChange($event)"><div id="guide-toc" dom-region="navigation"><awsdocs-toc></awsdocs-toc></div><div id="main-column" dom-region="content" tabindex="-1"><awsdocs-view class="awsdocs-view"><div id="awsdocs-content"><head><title>Tutorial: Actualización de una pila - AWS CloudFormation</title><meta name="rss" content="aws-cloudformation-release-notes.rss" /><meta name="forums" content="http://forums.aws.amazon.com/forum.jspa?forumID=92" /><meta name="feedback" content="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=CloudFormation&amp;topic_url=https://docs.aws.amazon.com/es_es/AWSCloudFormation/latest/UserGuide/updating.stacks.walkthrough.html" /><meta name="feedback-yes" content="feedbackyes.html?topic_url=https://docs.aws.amazon.com/es_es/AWSCloudFormation/latest/UserGuide/updating.stacks.walkthrough.html" /><meta name="feedback-no" content="feedbackno.html?topic_url=https://docs.aws.amazon.com/es_es/AWSCloudFormation/latest/UserGuide/updating.stacks.walkthrough.html" /><meta name="keywords" content="CloudFormation,AWSCloudFormation,aprovisionamiento de recursos,configuración de recursos,administración de la infraestructura,CloudFormer,Pila de CloudFormation,Conjunto de pilas de CloudFormation,Plantilla de CloudFormation,conjunto de cambios" /><script type="application/ld+json">
{
    "@context" : "https://schema.org",
    "@type" : "BreadcrumbList",
    "itemListElement" : [
      {
        "@type" : "ListItem",
        "position" : 1,
        "name" : "AWS",
        "item" : "https://aws.amazon.com"
      },
      {
        "@type" : "ListItem",
        "position" : 2,
        "name" : "AWS CloudFormation",
        "item" : "https://docs.aws.amazon.com/cloudformation/index.html"
      },
      {
        "@type" : "ListItem",
        "position" : 3,
        "name" : "Guía del usuario",
        "item" : "https://docs.aws.amazon.com/es_es/AWSCloudFormation/latest/UserGuide"
      },
      {
        "@type" : "ListItem",
        "position" : 4,
        "name" : "Introducción a AWS CloudFormation",
        "item" : "https://docs.aws.amazon.com/es_es/AWSCloudFormation/latest/UserGuide/GettingStarted.html"
      },
      {
        "@type" : "ListItem",
        "position" : 5,
        "name" : "Tutorial: Actualización de una pila",
        "item" : "https://docs.aws.amazon.com/es_es/AWSCloudFormation/latest/UserGuide/GettingStarted.html"
      }
    ]
}
</script></head><body><div id="main"><div style="display: none"></div><div id="breadcrumbs" class="breadcrumb"><a href="https://aws.amazon.com">AWS</a><a href="/index.html">Documentación</a><a href="/cloudformation/index.html">AWS CloudFormation</a><a href="Welcome.html">Guía del usuario</a></div><div id="page-toc-src"><a href="#updating.simple.application">Una aplicación sencilla</a><a href="#updating.create.initial.stack">Cree la pila inicial</a><a href="#update.application">Actualizar la aplicación</a><a href="#update.walkthrough.changing.resource.properties">Cambio de propiedades de recurso</a><a href="#update.walkthrough.adding.properties">Añadido de propiedades de recursos</a><a href="#update.walkthrough.change.resources">Cambie los recursos de la pila</a><a href="#update.walkthrough.impact">Consideraciones sobre el impacto y la disponibilidad</a><a href="#update.walkthrough.related">Recursos relacionados</a></div><div id="main-content" class="awsui-util-container"><div id="main-col-body"><awsdocs-language-banner data-service="$ctrl.pageService"></awsdocs-language-banner><h1 class="topictitle" id="updating.stacks.walkthrough">Tutorial: Actualización de una pila</h1><div class="awsdocs-page-header-container"><awsdocs-page-header></awsdocs-page-header><awsdocs-filter-selector id="awsdocs-filter-selector"></awsdocs-filter-selector></div><p>Con AWS CloudFormation, puede actualizar las propiedades de los recursos de sus pilas existentes. Estos cambios pueden variar desde sencillos cambios de configuración, como actualizar el umbral de la alarma en una alarma de CloudWatch, para realizar cambios más complejos, como la actualización de la imagen de Amazon Machine (AMI) que se ejecuta en una instancia Amazon EC2. Se pueden actualizar muchos de los recursos de AWS en una plantilla y seguimos agregando soporte para más.</p><p>Esta sección explica con detalle una sencilla progresión de las actualizaciones de una pila. Muestra cómo el uso de las plantillas permite utilizar un sistema de control de versiones para la configuración de su infraestructura de AWS, igual que usted usa el control de versiones para el software que está ejecutando. Le explicaremos con detalle los pasos siguientes:</p><div class="orderedlist">
     
     
     
     
     
     
  <ol><li>
      <p><a href="#updating.create.initial.stack">Cree la pila inicial</a>: cree una pila con una AMI de Amazon Linux básica, e instale el servidor web Apache y una sencilla aplicación PHP con los scripts auxiliares de AWS CloudFormation.</p>
    </li><li>
      <p><a href="#update.application">Actualizar la aplicación</a>: actualice uno de los archivos en la aplicación e implemente el software con CloudFormation.</p>
    </li><li>
      <p> <a href="#update.walkthrough.instance.type">Actualice el tipo de instancia</a>: cambie el tipo de instancia de la instancia de Amazon EC2 subyacente.</p>
    </li><li>
      <p> <a href="#update.walkthrough.ami">Actualice la AMI en una instancia Amazon EC2</a>: cambie la Imagen de máquina de Amazon (AMI) para la instancia de Amazon EC2 en la pila.</p>
    </li><li>
      <p><a href="#update.walkthrough.security.group">Añada un par de claves a una instancia</a>: agregue un par de claves de Amazon EC2 a la instancia y, a continuación, actualice el grupo de seguridad para permitir el acceso de SSH a la instancia.</p>
    </li><li>
      <p><a href="#update.walkthrough.change.resources">Cambie los recursos de la pila</a>: agregue y elimine los recursos de la pila, y conviértalos a una aplicación de escalado automático y con equilibrador de carga mediante la actualización de la plantilla.</p>
    </li></ol></div>
    <h2 id="updating.simple.application">Una aplicación sencilla</h2>

    <p>Empezaremos creando una pila que podemos utilizar a lo largo del resto de esta sección. Hemos proporcionado una sencilla plantilla que lanza una aplicación web PHP de una sola instancia alojada en el servidor web Apache y que se ejecuta en una AMI de Amazon Linux.</p>
    <p>El servidor web Apache, PHP y la aplicación PHP sencilla están instalados por los scripts auxiliares de CloudFormation que vienen instalados de forma predeterminada en la AMI de Amazon Linux. El siguiente fragmento de la plantilla muestra los metadatos que describe los paquetes y archivos para instalar, en este caso, el servidor web Apache y la infraestructura PHP desde el repositorio Yum para la AMI de Amazon Linux. El fragmento también muestra la sección Servicios, que garantiza que el servidor web Apache se está ejecutando. En la sección Propiedades de la definición de la instancia Amazon EC2, la propiedad UserData contiene el script CloudInit que llama a cfn-init para instalar los paquetes y archivos.</p>
    <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copiar"><awsui-icon name="copy"></awsui-icon></div></div><code class="json ">
  "WebServerInstance": <span>{</span>
    "Type" : "AWS::EC2::Instance",
    "Metadata" : <span>{</span>
      "AWS::CloudFormation::Init" : <span>{</span>
        "config" : <span>{</span>
          "packages" : <span>{</span>
            "yum" : <span>{</span>
              "httpd"             : [],
              "php"               : []
            }
          },

          "files" : <span>{</span>

            "/var/www/html/index.php" : <span>{</span>
              "content" : <span>{</span> "Fn::Join" : ["", [
                "&lt;?php\n",
                "echo '&lt;h1&gt;AWS CloudFormation sample PHP application&lt;/h1&gt;';\n",
                "echo '&lt;p&gt;", <span>{</span> "Ref" : "WelcomeMessage" }, "&lt;/p&gt;';\n",
                "?&gt;\n"
              ]]},
              "mode"    : "000644",
              "owner"   : "apache",
              "group"   : "apache"
            },
          },

          :

          "services" : <span>{</span>
            "sysvinit" : <span>{</span>
              "httpd"    : <span>{</span> "enabled" : "true", "ensureRunning" : "true" }
            }
          }
        }
      }
    },

    "Properties": <span>{</span>
      :
      "UserData"       : <span>{</span> "Fn::Base64" : <span>{</span> "Fn::Join" : ["", [
        "#!/bin/bash\n",
        "yum install -y aws-cfn-bootstrap\n",

        :

        "# Install the files and packages from the metadata\n",
        "/opt/aws/bin/cfn-init -v ",
        "         --stack ", <span>{</span> "Ref" : "AWS::StackName" },
        "         --resource WebServerInstance ",
        "         --region ", <span>{</span> "Ref" : "AWS::Region" }, "\n", 
        :
      ]]}}
    }
  },     </code></pre>
    <p>La aplicación en sí es un ejemplo de dos líneas, del tipo “Hola, mundo”, que se define completamente en la plantilla. En el caso de una aplicación real, los archivos pueden almacenarse en Amazon S3, GitHub o en otro repositorio y consultarse desde la plantilla. CloudFormation puede descargar paquetes (como RPM o RubyGems) y los archivos individuales de referencia y expandir archivos <code>.zip</code> y <code>.tar</code> para crear los artefactos de aplicación en la instancia de Amazon EC2.</p>
    <p>La plantilla permite y configura el daemon cfn-hup para escuchar los cambios de la configuración definidos en los metadatos de la instancia Amazon EC2. Al utilizar el daemon cfn-hup, puede actualizar el software de aplicación, como la versión de Apache o PHP, o puede actualizar el archivo de la aplicación PHP de AWS CloudFormation. El siguiente fragmento del mismo recurso de Amazon EC2 de la plantilla muestra los elementos necesarios para configurar cfn-hup y así llamar al cfn-init para actualizar, si se detecta un cambio en los metadatos:</p>
    <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copiar"><awsui-icon name="copy"></awsui-icon></div></div><code class="json ">
  "WebServerInstance": <span>{</span>
    "Type" : "AWS::EC2::Instance",
    "Metadata" : <span>{</span>
      "AWS::CloudFormation::Init" : <span>{</span>
        "config" : <span>{</span>

            :

          "files" : <span>{</span>

            :

            "/etc/cfn/cfn-hup.conf" : <span>{</span>
              "content" : <span>{</span> "Fn::Join" : ["", [
                "[main]\n",
                "stack=", <span>{</span> "Ref" : "AWS::StackName" }, "\n",
                "region=", <span>{</span> "Ref" : "AWS::Region" }, "\n"
              ]]},
              "mode"    : "000400",
              "owner"   : "root",
              "group"   : "root"
            },

            "/etc/cfn/hooks.d/cfn-auto-reloader.conf" : <span>{</span>
              "content": <span>{</span> "Fn::Join" : ["", [
                "[cfn-auto-reloader-hook]\n",
                "triggers=post.update\n",
                "path=Resources.WebServerInstance.Metadata.AWS::CloudFormation::Init\n",
                "action=/opt/aws/bin/cfn-init -s ", <span>{</span> "Ref" : "AWS::StackId" }, " -r WebServerInstance ",
                " --region     ", <span>{</span> "Ref" : "AWS::Region" }, "\n",  
                "runas=root\n"
              ]]}
            }
          },
          :
    },

    "Properties": <span>{</span>

         :

      "UserData"       : <span>{</span> "Fn::Base64" : <span>{</span> "Fn::Join" : ["", [

        :

        "# Start up the cfn-hup daemon to listen for changes to the Web Server metadata\n",
        "/opt/aws/bin/cfn-hup || error_exit 'Failed to start cfn-hup'\n",  

        :
      ]]}}
    }
  },     </code></pre>
    <p>Para completar la pila, la plantilla crea un grupo de seguridad de Amazon EC2.</p>
    <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copiar"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
  "AWSTemplateFormatVersion" : "2010-09-09",

  "Description" : "AWS CloudFormation Sample Template: Sample template that can be used to test EC2 updates. **WARNING** This template creates an Amazon Ec2 Instance. You will be billed for the AWS resources used if you create a stack from this template.",
  
  "Parameters" : <span>{</span>
          
    "InstanceType" : <span>{</span>
      "Description" : "WebServer EC2 instance type",
      "Type" : "String",
      "Default" : "t2.small",
      "AllowedValues" : [ 
        "t1.micro", 
        "t2.nano", 
        "t2.micro", 
        "t2.small", 
        "t2.medium", 
        "t2.large", 
        "m1.small", 
        "m1.medium", 
        "m1.large", 
        "m1.xlarge", 
        "m2.xlarge", 
        "m2.2xlarge", 
        "m2.4xlarge", 
        "m3.medium", 
        "m3.large", 
        "m3.xlarge", 
        "m3.2xlarge", 
        "m4.large", 
        "m4.xlarge", 
        "m4.2xlarge", 
        "m4.4xlarge", 
        "m4.10xlarge", 
        "c1.medium", 
        "c1.xlarge", 
        "c3.large", 
        "c3.xlarge", 
        "c3.2xlarge", 
        "c3.4xlarge", 
        "c3.8xlarge", 
        "c4.large", 
        "c4.xlarge", 
        "c4.2xlarge", 
        "c4.4xlarge", 
        "c4.8xlarge", 
        "g2.2xlarge", 
        "g2.8xlarge", 
        "r3.large", 
        "r3.xlarge", 
        "r3.2xlarge", 
        "r3.4xlarge", 
        "r3.8xlarge", 
        "i2.xlarge", 
        "i2.2xlarge", 
        "i2.4xlarge", 
        "i2.8xlarge", 
        "d2.xlarge", 
        "d2.2xlarge", 
        "d2.4xlarge", 
        "d2.8xlarge", 
        "hi1.4xlarge", 
        "hs1.8xlarge", 
        "cr1.8xlarge", 
        "cc2.8xlarge", 
        "cg1.4xlarge"
      ],
      "ConstraintDescription" : "must be a valid EC2 instance type."
    }
  },
    
  "Mappings" : <span>{</span>
    "AWSInstanceType2Arch" : <span>{</span>
      "t1.micro"    : <span>{</span> "Arch" : "HVM64"  },
      "t2.nano"     : <span>{</span> "Arch" : "HVM64"  },
      "t2.micro"    : <span>{</span> "Arch" : "HVM64"  },
      "t2.small"    : <span>{</span> "Arch" : "HVM64"  },
      "t2.medium"   : <span>{</span> "Arch" : "HVM64"  },
      "t2.large"    : <span>{</span> "Arch" : "HVM64"  },
      "m1.small"    : <span>{</span> "Arch" : "HVM64"  },
      "m1.medium"   : <span>{</span> "Arch" : "HVM64"  },
      "m1.large"    : <span>{</span> "Arch" : "HVM64"  },
      "m1.xlarge"   : <span>{</span> "Arch" : "HVM64"  },
      "m2.xlarge"   : <span>{</span> "Arch" : "HVM64"  },
      "m2.2xlarge"  : <span>{</span> "Arch" : "HVM64"  },
      "m2.4xlarge"  : <span>{</span> "Arch" : "HVM64"  },
      "m3.medium"   : <span>{</span> "Arch" : "HVM64"  },
      "m3.large"    : <span>{</span> "Arch" : "HVM64"  },
      "m3.xlarge"   : <span>{</span> "Arch" : "HVM64"  },
      "m3.2xlarge"  : <span>{</span> "Arch" : "HVM64"  },
      "m4.large"    : <span>{</span> "Arch" : "HVM64"  },
      "m4.xlarge"   : <span>{</span> "Arch" : "HVM64"  },
      "m4.2xlarge"  : <span>{</span> "Arch" : "HVM64"  },
      "m4.4xlarge"  : <span>{</span> "Arch" : "HVM64"  },
      "m4.10xlarge" : <span>{</span> "Arch" : "HVM64"  },
      "c1.medium"   : <span>{</span> "Arch" : "HVM64"  },
      "c1.xlarge"   : <span>{</span> "Arch" : "HVM64"  },
      "c3.large"    : <span>{</span> "Arch" : "HVM64"  },
      "c3.xlarge"   : <span>{</span> "Arch" : "HVM64"  },
      "c3.2xlarge"  : <span>{</span> "Arch" : "HVM64"  },
      "c3.4xlarge"  : <span>{</span> "Arch" : "HVM64"  },
      "c3.8xlarge"  : <span>{</span> "Arch" : "HVM64"  },
      "c4.large"    : <span>{</span> "Arch" : "HVM64"  },
      "c4.xlarge"   : <span>{</span> "Arch" : "HVM64"  },
      "c4.2xlarge"  : <span>{</span> "Arch" : "HVM64"  },
      "c4.4xlarge"  : <span>{</span> "Arch" : "HVM64"  },
      "c4.8xlarge"  : <span>{</span> "Arch" : "HVM64"  },
      "g2.2xlarge"  : <span>{</span> "Arch" : "HVMG2"  },
      "g2.8xlarge"  : <span>{</span> "Arch" : "HVMG2"  },
      "r3.large"    : <span>{</span> "Arch" : "HVM64"  },
      "r3.xlarge"   : <span>{</span> "Arch" : "HVM64"  },
      "r3.2xlarge"  : <span>{</span> "Arch" : "HVM64"  },
      "r3.4xlarge"  : <span>{</span> "Arch" : "HVM64"  },
      "r3.8xlarge"  : <span>{</span> "Arch" : "HVM64"  },
      "i2.xlarge"   : <span>{</span> "Arch" : "HVM64"  },
      "i2.2xlarge"  : <span>{</span> "Arch" : "HVM64"  },
      "i2.4xlarge"  : <span>{</span> "Arch" : "HVM64"  },
      "i2.8xlarge"  : <span>{</span> "Arch" : "HVM64"  },
      "d2.xlarge"   : <span>{</span> "Arch" : "HVM64"  },
      "d2.2xlarge"  : <span>{</span> "Arch" : "HVM64"  },
      "d2.4xlarge"  : <span>{</span> "Arch" : "HVM64"  },
      "d2.8xlarge"  : <span>{</span> "Arch" : "HVM64"  },
      "hi1.4xlarge" : <span>{</span> "Arch" : "HVM64"  },
      "hs1.8xlarge" : <span>{</span> "Arch" : "HVM64"  },
      "cr1.8xlarge" : <span>{</span> "Arch" : "HVM64"  },
      "cc2.8xlarge" : <span>{</span> "Arch" : "HVM64"  }
    },

    "AWSRegionArch2AMI" : <span>{</span>
      "us-east-1"        : <span>{</span>"HVM64" : "ami-0ff8a91507f77f867", "HVMG2" : "ami-0a584ac55a7631c0c"},
      "us-west-2"        : <span>{</span>"HVM64" : "ami-a0cfeed8", "HVMG2" : "ami-0e09505bc235aa82d"},
      "us-west-1"        : <span>{</span>"HVM64" : "ami-0bdb828fd58c52235", "HVMG2" : "ami-066ee5fd4a9ef77f1"},
      "eu-west-1"        : <span>{</span>"HVM64" : "ami-047bb4163c506cd98", "HVMG2" : "ami-0a7c483d527806435"},
      "eu-west-2"        : <span>{</span>"HVM64" : "ami-f976839e", "HVMG2" : "NOT_SUPPORTED"},
      "eu-west-3"        : <span>{</span>"HVM64" : "ami-0ebc281c20e89ba4b", "HVMG2" : "NOT_SUPPORTED"},
      "eu-central-1"     : <span>{</span>"HVM64" : "ami-0233214e13e500f77", "HVMG2" : "ami-06223d46a6d0661c7"},
      "ap-northeast-1"   : <span>{</span>"HVM64" : "ami-06cd52961ce9f0d85", "HVMG2" : "ami-053cdd503598e4a9d"},
      "ap-northeast-2"   : <span>{</span>"HVM64" : "ami-0a10b2721688ce9d2", "HVMG2" : "NOT_SUPPORTED"},
      "ap-northeast-3"   : <span>{</span>"HVM64" : "ami-0d98120a9fb693f07", "HVMG2" : "NOT_SUPPORTED"},
      "ap-southeast-1"   : <span>{</span>"HVM64" : "ami-08569b978cc4dfa10", "HVMG2" : "ami-0be9df32ae9f92309"},
      "ap-southeast-2"   : <span>{</span>"HVM64" : "ami-09b42976632b27e9b", "HVMG2" : "ami-0a9ce9fecc3d1daf8"},
      "ap-south-1"       : <span>{</span>"HVM64" : "ami-0912f71e06545ad88", "HVMG2" : "ami-097b15e89dbdcfcf4"},
      "us-east-2"        : <span>{</span>"HVM64" : "ami-0b59bfac6be064b78", "HVMG2" : "NOT_SUPPORTED"},
      "ca-central-1"     : <span>{</span>"HVM64" : "ami-0b18956f", "HVMG2" : "NOT_SUPPORTED"},
      "sa-east-1"        : <span>{</span>"HVM64" : "ami-07b14488da8ea02a0", "HVMG2" : "NOT_SUPPORTED"},
      "cn-north-1"       : <span>{</span>"HVM64" : "ami-0a4eaf6c4454eda75", "HVMG2" : "NOT_SUPPORTED"},
      "cn-northwest-1"   : <span>{</span>"HVM64" : "ami-6b6a7d09", "HVMG2" : "NOT_SUPPORTED"}
    }
  },
    
  "Resources" : <span>{</span>   

    "WebServerInstance": <span>{</span>  
      "Type" : "AWS::EC2::Instance",
      "Metadata" : <span>{</span>
        "Comment" : "Install a simple PHP application",
        "AWS::CloudFormation::Init" : <span>{</span>
          "config" : <span>{</span>
            "packages" : <span>{</span>
              "yum" : <span>{</span>
                "httpd"             : [],
                "php"               : []
              }
            },

            "files" : <span>{</span>

              "/var/www/html/index.php" : <span>{</span>
                "content" : <span>{</span> "Fn::Join" : ["", [
                  "&lt;?php\n",
                  "echo '&lt;h1&gt;AWS CloudFormation sample PHP application&lt;/h1&gt;';\n",
                  "?&gt;\n"
                ]]},
                "mode"    : "000644",
                "owner"   : "apache",
                "group"   : "apache"
              },


              "/etc/cfn/cfn-hup.conf" : <span>{</span>
                "content" : <span>{</span> "Fn::Join" : ["", [
                  "[main]\n",
                  "stack=", <span>{</span> "Ref" : "AWS::StackId" }, "\n",
                  "region=", <span>{</span> "Ref" : "AWS::Region" }, "\n"
                ]]},
                "mode"    : "000400",
                "owner"   : "root",
                "group"   : "root"
              },

              "/etc/cfn/hooks.d/cfn-auto-reloader.conf" : <span>{</span>
                "content": <span>{</span> "Fn::Join" : ["", [
                  "[cfn-auto-reloader-hook]\n",
                  "triggers=post.update\n",
                  "path=Resources.WebServerInstance.Metadata.AWS::CloudFormation::Init\n",
                  "action=/opt/aws/bin/cfn-init -s ", <span>{</span> "Ref" : "AWS::StackId" }, " -r WebServerInstance ",
                                                   " --region     ", <span>{</span> "Ref" : "AWS::Region" }, "\n",
                  "runas=root\n"
                ]]}
              }
            },

            "services" : <span>{</span>
              "sysvinit" : <span>{</span>
                "httpd"    : <span>{</span> "enabled" : "true", "ensureRunning" : "true" },
                "cfn-hup" : <span>{</span> "enabled" : "true", "ensureRunning" : "true",
                    "files" : ["/etc/cfn/cfn-hup.conf", "/etc/cfn/hooks.d/cfn-auto-reloader.conf"]}
              }
            }
          }
        }
      },

      "Properties": <span>{</span>
        "ImageId" : <span>{</span> "Fn::FindInMap" : [ "AWSRegionArch2AMI", <span>{</span> "Ref" : "AWS::Region" },
                          <span>{</span> "Fn::FindInMap" : [ "AWSInstanceType2Arch", <span>{</span> "Ref" : "InstanceType" }, "Arch" ] } ] },
        "InstanceType"   : <span>{</span> "Ref" : "InstanceType" },
        "SecurityGroups" : [ <span>{</span>"Ref" : "WebServerSecurityGroup"} ],
        "UserData"       : <span>{</span> "Fn::Base64" : <span>{</span> "Fn::Join" : ["", [
             "#!/bin/bash -xe\n",
             "yum install -y aws-cfn-bootstrap\n",

             "# Install the files and packages from the metadata\n",
             "/opt/aws/bin/cfn-init -v ",
             "         --stack ", <span>{</span> "Ref" : "AWS::StackName" },
             "         --resource WebServerInstance ",
             "         --region ", <span>{</span> "Ref" : "AWS::Region" }, "\n",

             "# Start up the cfn-hup daemon to listen for changes to the Web Server metadata\n",
             "/opt/aws/bin/cfn-hup || error_exit 'Failed to start cfn-hup'\n",  

             "# Signal the status from cfn-init\n",
             "/opt/aws/bin/cfn-signal -e $? ",
             "         --stack ", <span>{</span> "Ref" : "AWS::StackName" },
             "         --resource WebServerInstance ",
             "         --region ", <span>{</span> "Ref" : "AWS::Region" }, "\n"
        ]]}}        
      },
      "CreationPolicy" : <span>{</span>
        "ResourceSignal" : <span>{</span>
          "Timeout" : "PT5M"
        }
      }
    },

    "WebServerSecurityGroup" : <span>{</span>
      "Type" : "AWS::EC2::SecurityGroup",
      "Properties" : <span>{</span>
        "GroupDescription" : "Enable HTTP access via port 80",
        "SecurityGroupIngress" : [
          <span>{</span>"IpProtocol" : "tcp", "FromPort" : "80", "ToPort" : "80", "CidrIp" : "0.0.0.0/0"}
        ]
      }      
    }          
  },
  
  "Outputs" : <span>{</span>
    "WebsiteURL" : <span>{</span>
      "Description" : "Application URL",
      "Value" : <span>{</span> "Fn::Join" : ["", ["http://", <span>{</span> "Fn::GetAtt" : [ "WebServerInstance", "PublicDnsName" ]}]] }
    }
  }
}</code></pre>
    <p>Este ejemplo utiliza una única instancia de Amazon EC2, pero puede utilizar los mismos mecanismos en soluciones más complejas que usan Elastic Load Balancing y grupos de Amazon EC2 Auto Scaling para administrar una colección de servidores de aplicaciones. Existen, sin embargo, algunas consideraciones especiales para los grupos de Auto Scaling. Para obtener más información, consulte <a href="#updating.autoscaling">Actualización de grupos de Auto Scaling</a>.</p>
   
    <h2 id="updating.create.initial.stack">Cree la pila inicial</h2>
    

    <p>Para este ejemplo, vamos a utilizar la AWS Management Console para crear una pila inicial con la plantilla de ejemplo.</p>
    <div class="awsdocs-note awsdocs-warning"><div class="awsdocs-note-title"><awsui-icon name="status-warning" variant="error"></awsui-icon><h6>aviso</h6></div><div class="awsdocs-note-text"><p>Completar este procedimiento implementará en directo los servicios de AWS. Se le cobrarán las tarifas de uso estándar, siempre que estos servicios estén ejecutándose.</p></div></div>
    <div class="procedure"><h6>Para crear la pila de la AWS Management Console</h6><ol><li>
        <p>Copie la plantilla anterior y guárdela localmente en el sistema como un archivo de texto. Anote la ubicación, porque necesitará usar el archivo en el siguiente paso.</p>
      </li><li>
        <p>Inicie sesión en la consola de CloudFormation, en <a href="https://console.aws.amazon.com/cloudformation" rel="noopener noreferrer" target="_blank"><span>https://console.aws.amazon.com/cloudformation</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a>.</p>
      </li><li>
        <p>Elija <b>Create New Stack</b>.</p>
      </li><li>
        <p>En el asistente <b>Create New Stack (Crear una pila nueva)</b>, en la pantalla <b>Select Template (Seleccionar plantilla)</b>, escriba <code class="userinput">UpdateTutorial</code> en el campo <b>Name (Nombre)</b>. En la misma página, seleccione <b>Upload a template to Amazon S3 (Cargar una plantilla en Amazon S3)</b> y busque el archivo que ha descargado en el primer paso; a continuación, elija <b>Next (Siguiente)</b>.</p>
      </li><li>
        <p>En la pantalla <b>Specify Parameters (Especificar parámetros)</b>, en el cuadro <b>Instance Type (Tipo de instancia)</b>, escriba <code class="userinput">t1.micro</code>. A continuación, elija <b>Siguiente</b>.</p>
      </li><li>
        <p>En la pantalla <b>Options (Opciones)</b>, elija <b>Next (Siguiente)</b>.</p>
      </li><li>
        <p>En la pantalla <b>Review (Revisar)</b>, compruebe que todos los ajustes sean de su agrado y, a continuación, elija <b>Create (Crear)</b>.</p>
      </li></ol></div>
    <p>Cuando el estado de la pila sea CREATE_COMPLETE, la pestaña de salida mostrará la URL de su sitio web. Si selecciona el valor de salida de WebsiteURL, verá su nueva aplicación PHP en marcha.</p>
   
    <h2 id="update.application">Actualizar la aplicación</h2>
    

    <p>Ahora que hemos implementado la pila, vamos a actualizar la aplicación. Haremos un sencillo cambio en el texto impreso por la aplicación. Para ello, agregaremos un comando echo para el archivo index.php tal y como se muestra en este fragmento de la plantilla:</p>
    <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copiar"><awsui-icon name="copy"></awsui-icon></div></div><code class="json ">"WebServerInstance": <span>{</span>
      "Type" : "AWS::EC2::Instance",
      "Metadata" : <span>{</span>
        "AWS::CloudFormation::Init" : <span>{</span>
          "config" : <span>{</span>
              :

            "files" : <span>{</span>

              "/var/www/html/index.php" : <span>{</span>
                "content" : <span>{</span> "Fn::Join" : ["", [
                  "&lt;?php\n",
                  "echo '&lt;h1&gt;AWS CloudFormation sample PHP application&lt;/h1&gt;';\n",
                  <code class="replaceable">"echo '&lt;p&gt;Updated version via UpdateStack&lt;/p&gt;';\n ",</code>
                  "?&gt;\n"
                ]]},
                "mode"    : "000644",
                "owner"   : "apache",
                "group"   : "apache"
              },

              :

      }
    },</code></pre>
    <p>Utilice un editor de texto para modificar manualmente el archivo de plantilla que guardó localmente.</p>
    <p>Ahora, vamos a actualizar la pila.</p>
    
    <div class="procedure"><h6>Para actualizar la pila de la AWS Management Console</h6><ol><li>
        <p>Inicie sesión en la consola de AWS CloudFormation, en: <a href="https://console.aws.amazon.com/cloudformation" rel="noopener noreferrer" target="_blank"><span>https://console.aws.amazon.com/cloudformation</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a>.</p>
      </li><li>
        <p>En el panel de AWS CloudFormation, seleccione la pila que ha creado anteriormente y, a continuación, elija <b>Update Stack (Actualizar pila)</b>.</p>
      </li><li>
        <p>En el asistente <b>Update Stack (Actualizar pila)</b>, en la pantalla <b>Select Template (Seleccionar plantilla)</b>, seleccione <b>Upload a template to Amazon S3 (Actualizar plantilla en Amazon S3)</b>, seleccione la plantilla modificada y, a continuación, elija <b>Next (Siguiente)</b>.</p>
      </li><li>
        <p>En la pantalla <b>Options (Opciones)</b>, elija <b>Next (Siguiente)</b>.</p>
      </li><li>
        <p>Elija <b>Next (Siguiente)</b> porque la pila no tiene una política de pila. Todos los recursos se pueden actualizar sin una política de anulaciones.</p>
      </li><li>
        <p>En la pantalla <b>Review (Revisar)</b>, compruebe que todos los ajustes sean de su agrado y, a continuación, elija <b>Update (Actualizar)</b>.</p>
      </li></ol></div>
    <p>Si actualiza la pila de la AWS Management Console, observará que los parámetros que se usaron para crear la pila inicial se cumplimentaron previamente en la página <b>Parameters (Parámetros)</b> del asistente <b>Update Stack (Actualizar pila)</b>. Si utiliza el comando <code class="code">aws cloudformation update-stack</code>, asegúrese de escribir los mismos valores para los parámetros que utilizó originalmente para crear la pila.</p>
    <p>Cuando la pila está en el estado UPDATE_COMPLETE, puede seleccionar el valor de salida de WebsiteURL de nuevo, para verificar si han entrado en vigor los cambios de la aplicación. De forma predeterminada, el daemon cfn-hup se ejecuta cada 15 minutos, por lo que la aplicación puede tardar hasta 15 minutos en cambiar una vez actualizado la pila.</p>
    <p>Para ver el conjunto de recursos que se actualizaron, vaya a la consola de AWS CloudFormation. En la pestaña <b>Events (Eventos)</b>, examine los eventos de pila. En este caso concreto, se actualizaron los metadatos de la instancia WebServerInstance de Amazon EC2, lo que provocó que AWS CloudFormation también revaluara los demás recursos (<code class="code">WebServerSecurityGroup</code>) para asegurarse de que no haya otros cambios. Ninguno de los demás recursos de pila se han modificado. AWS CloudFormation actualizará solo los recursos de la pila que se vean afectados por cualquier cambio en la pila. Estos cambios pueden ser directos, como los cambios de metadatos o la propiedad, o pueden deberse a dependencias o flujos de datos a través de Ref, GetAtt, u otras funciones de plantilla intrínsecas.</p>
    <p>Esta sencilla actualización ilustra el proceso; sin embargo, puede realizar cambios mucho más complejos en los archivos y paquetes implementados en las instancias Amazon EC2. Por ejemplo, puede decidir que necesita añadir MySQL a la instancia, junto con el soporte de PHP para MySQL. Para hacerlo, solo tiene que añadir los archivos y paquetes adicionales junto con los servicios adicionales a la configuración y, luego, actualizar la pila para implementar los cambios. En el siguiente fragmento de plantilla, los cambios están marcados en rojo:</p>
    <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copiar"><awsui-icon name="copy"></awsui-icon></div></div><code class="json ">    "WebServerInstance": <span>{</span>
      "Type" : "AWS::EC2::Instance",
      "Metadata" : <span>{</span>
        "Comment" : "Install a simple PHP application",
        "AWS::CloudFormation::Init" : <span>{</span>
          "config" : <span>{</span>
            "packages" : <span>{</span>
              "yum" : <span>{</span>
                "httpd"             : [],
                "php"               : []<code class="replaceable">,
                "php-mysql"         : [],
                "mysql-server"      : [],
                "mysql-libs"        : [],
                "mysql"             : []</code>
              }
            },

            :

            "services" : <span>{</span>
              "sysvinit" : <span>{</span>
                "httpd"    : <span>{</span> "enabled" : "true", "ensureRunning" : "true" },
                "cfn-hup" : <span>{</span> "enabled" : "true", "ensureRunning" : "true",
                    "files" : ["/etc/cfn/cfn-hup.conf", "/etc/cfn/hooks.d/cfn-auto-reloader.conf"]},
                <code class="replaceable">"mysqld"   : <span>{</span> "enabled" : "true", "ensureRunning" : "true" }</code>
              }
            }
          }
        }
      },

      "Properties": <span>{</span>
           :
      }
    }</code></pre>
    <p>Puede actualizar los metadatos de CloudFormation de modo que se actualicen según las nuevas versiones de los paquetes que utiliza la aplicación. En los ejemplos anteriores, la propiedad de la versión de cada paquete está vacía, lo que indica que cfn-init debería instalar la última versión del paquete.</p>
    <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copiar"><awsui-icon name="copy"></awsui-icon></div></div><code class="json ">     "packages" : <span>{</span>
       "yum" : <span>{</span>
         "httpd"             : [],
         "php"               : []
      }</code></pre>
    <p>Si lo desea, puede especificar una cadena de versión de un paquete. Si cambia la cadena de versión en las posteriores llamadas de actualización de pila, se implementará la nueva versión del paquete. A continuación se muestra un ejemplo de cómo utilizar los números de versión para paquetes RubyGems. Cualquier paquete compatible con control de versiones puede tener versiones específicas.</p>
    <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copiar"><awsui-icon name="copy"></awsui-icon></div></div><code class="json ">  "packages" : <span>{</span>
    "rubygems" : <span>{</span>
      "mysql"           : [],
      "rubygems-update" : ["1.6.2"],
      "rake"            : ["0.8.7"],
      "rails"           : ["2.3.11"]
    }
    }</code></pre>
     
      <h3 id="updating.autoscaling">Actualización de grupos de Auto Scaling</h3>

      <p>Si está utilizando los grupos de escalado automático en la plantilla, en lugar de los recursos de instancias de Amazon EC2, la actualización de la aplicación funcionará exactamente igual; sin embargo, AWS CloudFormation no ofrece ninguna sincronización ni serialización entre las instancias de Amazon EC2 en un grupo de escalado automático. El daemon cfn-hup de cada host se ejecutará de forma independiente y actualizará la aplicación según su propia programación. Al utilizar cfn-hup para actualizar la configuración en la instancia, cada instancia ejecutará enlaces de cfn-hup según su propia programación; no hay coordinación entre las instancias de la pila. Debe tener en cuenta lo siguiente:</p>
      <div class="itemizedlist">
         
         
      <ul class="itemizedlist"><li class="listitem">
          <p>Si se ejecutan todos los cambios de cfn-hup en todas las instancias Amazon EC2 del grupo de Auto Scaling al mismo tiempo, su servicio podría no estar disponible durante la actualización.</p>
        </li><li class="listitem">
          <p>Si se ejecutan los cambios de cfn-hup en diferentes momentos, puede que estén ejecutándose versiones antiguas y nuevas del software al mismo tiempo.</p>
        </li></ul></div>
      <p>Para evitar estos problemas, considere la posibilidad de forzar una actualización continua en las instancias del grupo de Auto Scaling. Para obtener más información, consulte <a href="./aws-attribute-updatepolicy.html">Atributo UpdatePolicy</a>.</p>
     
   
    <h2 id="update.walkthrough.changing.resource.properties">Cambio de propiedades de recurso</h2>
    

    <p>Con AWS CloudFormation, puede cambiar las propiedades de un recurso existente en la pila. En la siguiente sección se describen diversas actualizaciones que solucionan problemas específicos; sin embargo, cualquier propiedad de cualquier recurso que admite la actualización en la pila se puede modificar según sea necesario.</p>
     
      <h3 id="update.walkthrough.instance.type">Actualice el tipo de instancia</h3>

      <p>La pila que hemos creado utiliza hasta ahora una instancia Amazon EC2 t1.micro. Supongamos que el sitio web recién creado obtiene más tráfico de lo que puede controlar una instancia t1.micro y ahora desea pasar a un tipo de instancia Amazon EC2 m1.small. Si la arquitectura del tipo de instancia cambia, la instancia se creará con una AMI diferente. Si consulta los mapeos de la plantilla, verá que tanto la t1.micro como la m1.small son la misma arquitectura y usan las mismas AMI de Amazon Linux.</p>
      <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copiar"><awsui-icon name="copy"></awsui-icon></div></div><code class="json ">  "Mappings" : <span>{</span>
    "AWSInstanceType2Arch" : <span>{</span>
      "t1.micro"    : <span>{</span> "Arch" : "HVM64"  },
      "t2.nano"     : <span>{</span> "Arch" : "HVM64"  },
      "t2.micro"    : <span>{</span> "Arch" : "HVM64"  },
      "t2.small"    : <span>{</span> "Arch" : "HVM64"  },
      "t2.medium"   : <span>{</span> "Arch" : "HVM64"  },
      "t2.large"    : <span>{</span> "Arch" : "HVM64"  },
      "m1.small"    : <span>{</span> "Arch" : "HVM64"  },
      "m1.medium"   : <span>{</span> "Arch" : "HVM64"  },
      "m1.large"    : <span>{</span> "Arch" : "HVM64"  },
      "m1.xlarge"   : <span>{</span> "Arch" : "HVM64"  },
      "m2.xlarge"   : <span>{</span> "Arch" : "HVM64"  },
      "m2.2xlarge"  : <span>{</span> "Arch" : "HVM64"  },
      "m2.4xlarge"  : <span>{</span> "Arch" : "HVM64"  },
      "m3.medium"   : <span>{</span> "Arch" : "HVM64"  },
      "m3.large"    : <span>{</span> "Arch" : "HVM64"  },
      "m3.xlarge"   : <span>{</span> "Arch" : "HVM64"  },
      "m3.2xlarge"  : <span>{</span> "Arch" : "HVM64"  },
      "m4.large"    : <span>{</span> "Arch" : "HVM64"  },
      "m4.xlarge"   : <span>{</span> "Arch" : "HVM64"  },
      "m4.2xlarge"  : <span>{</span> "Arch" : "HVM64"  },
      "m4.4xlarge"  : <span>{</span> "Arch" : "HVM64"  },
      "m4.10xlarge" : <span>{</span> "Arch" : "HVM64"  },
      "c1.medium"   : <span>{</span> "Arch" : "HVM64"  },
      "c1.xlarge"   : <span>{</span> "Arch" : "HVM64"  },
      "c3.large"    : <span>{</span> "Arch" : "HVM64"  },
      "c3.xlarge"   : <span>{</span> "Arch" : "HVM64"  },
      "c3.2xlarge"  : <span>{</span> "Arch" : "HVM64"  },
      "c3.4xlarge"  : <span>{</span> "Arch" : "HVM64"  },
      "c3.8xlarge"  : <span>{</span> "Arch" : "HVM64"  },
      "c4.large"    : <span>{</span> "Arch" : "HVM64"  },
      "c4.xlarge"   : <span>{</span> "Arch" : "HVM64"  },
      "c4.2xlarge"  : <span>{</span> "Arch" : "HVM64"  },
      "c4.4xlarge"  : <span>{</span> "Arch" : "HVM64"  },
      "c4.8xlarge"  : <span>{</span> "Arch" : "HVM64"  },
      "g2.2xlarge"  : <span>{</span> "Arch" : "HVMG2"  },
      "g2.8xlarge"  : <span>{</span> "Arch" : "HVMG2"  },
      "r3.large"    : <span>{</span> "Arch" : "HVM64"  },
      "r3.xlarge"   : <span>{</span> "Arch" : "HVM64"  },
      "r3.2xlarge"  : <span>{</span> "Arch" : "HVM64"  },
      "r3.4xlarge"  : <span>{</span> "Arch" : "HVM64"  },
      "r3.8xlarge"  : <span>{</span> "Arch" : "HVM64"  },
      "i2.xlarge"   : <span>{</span> "Arch" : "HVM64"  },
      "i2.2xlarge"  : <span>{</span> "Arch" : "HVM64"  },
      "i2.4xlarge"  : <span>{</span> "Arch" : "HVM64"  },
      "i2.8xlarge"  : <span>{</span> "Arch" : "HVM64"  },
      "d2.xlarge"   : <span>{</span> "Arch" : "HVM64"  },
      "d2.2xlarge"  : <span>{</span> "Arch" : "HVM64"  },
      "d2.4xlarge"  : <span>{</span> "Arch" : "HVM64"  },
      "d2.8xlarge"  : <span>{</span> "Arch" : "HVM64"  },
      "hi1.4xlarge" : <span>{</span> "Arch" : "HVM64"  },
      "hs1.8xlarge" : <span>{</span> "Arch" : "HVM64"  },
      "cr1.8xlarge" : <span>{</span> "Arch" : "HVM64"  },
      "cc2.8xlarge" : <span>{</span> "Arch" : "HVM64"  }
    },
    "AWSRegionArch2AMI" : <span>{</span>
      "us-east-1"        : <span>{</span>"HVM64" : "ami-0ff8a91507f77f867", "HVMG2" : "ami-0a584ac55a7631c0c"},
      "us-west-2"        : <span>{</span>"HVM64" : "ami-a0cfeed8", "HVMG2" : "ami-0e09505bc235aa82d"},
      "us-west-1"        : <span>{</span>"HVM64" : "ami-0bdb828fd58c52235", "HVMG2" : "ami-066ee5fd4a9ef77f1"},
      "eu-west-1"        : <span>{</span>"HVM64" : "ami-047bb4163c506cd98", "HVMG2" : "ami-0a7c483d527806435"},
      "eu-west-2"        : <span>{</span>"HVM64" : "ami-f976839e", "HVMG2" : "NOT_SUPPORTED"},
      "eu-west-3"        : <span>{</span>"HVM64" : "ami-0ebc281c20e89ba4b", "HVMG2" : "NOT_SUPPORTED"},
      "eu-central-1"     : <span>{</span>"HVM64" : "ami-0233214e13e500f77", "HVMG2" : "ami-06223d46a6d0661c7"},
      "ap-northeast-1"   : <span>{</span>"HVM64" : "ami-06cd52961ce9f0d85", "HVMG2" : "ami-053cdd503598e4a9d"},
      "ap-northeast-2"   : <span>{</span>"HVM64" : "ami-0a10b2721688ce9d2", "HVMG2" : "NOT_SUPPORTED"},
      "ap-northeast-3"   : <span>{</span>"HVM64" : "ami-0d98120a9fb693f07", "HVMG2" : "NOT_SUPPORTED"},
      "ap-southeast-1"   : <span>{</span>"HVM64" : "ami-08569b978cc4dfa10", "HVMG2" : "ami-0be9df32ae9f92309"},
      "ap-southeast-2"   : <span>{</span>"HVM64" : "ami-09b42976632b27e9b", "HVMG2" : "ami-0a9ce9fecc3d1daf8"},
      "ap-south-1"       : <span>{</span>"HVM64" : "ami-0912f71e06545ad88", "HVMG2" : "ami-097b15e89dbdcfcf4"},
      "us-east-2"        : <span>{</span>"HVM64" : "ami-0b59bfac6be064b78", "HVMG2" : "NOT_SUPPORTED"},
      "ca-central-1"     : <span>{</span>"HVM64" : "ami-0b18956f", "HVMG2" : "NOT_SUPPORTED"},
      "sa-east-1"        : <span>{</span>"HVM64" : "ami-07b14488da8ea02a0", "HVMG2" : "NOT_SUPPORTED"},
      "cn-north-1"       : <span>{</span>"HVM64" : "ami-0a4eaf6c4454eda75", "HVMG2" : "NOT_SUPPORTED"},
      "cn-northwest-1"   : <span>{</span>"HVM64" : "ami-6b6a7d09", "HVMG2" : "NOT_SUPPORTED"}
    }</code></pre>
      <p>Vamos a utilizar la plantilla que hemos modificado en la sección anterior para cambiar el tipo de instancia. Dado que InstanceType fue un parámetro de entrada de la plantilla, no es necesario modificar la plantilla; se puede cambiar el valor del parámetro en el asistente de actualización de la pila, en la página Specify Parameters (Especificar parámetros).</p>
      <div class="procedure"><h6>Para actualizar la pila de la AWS Management Console</h6><ol><li>
          <p>Inicie sesión en la consola de AWS CloudFormation, en <a href="https://console.aws.amazon.com/cloudformation" rel="noopener noreferrer" target="_blank"><span>https://console.aws.amazon.com/cloudformation</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a>.</p>
        </li><li>
          <p>En el panel de CloudFormation, seleccione la pila que ha creado anteriormente y, a continuación, elija <b>Update Stack (Actualizar pila)</b>.</p>
        </li><li>
          <p>En el asistente <b>Update Stack (Actualizar pila)</b>, en la pantalla <b>Select Template (Seleccionar plantilla)</b>, seleccione <b>Use current template (Usar plantilla actual)</b> y, a continuación, elija <b>Next (Siguiente)</b>.</p>
          <p>Aparecerá la página Specify Details (Especificar detalles) con los parámetros que se usaron para crear la pila inicial y que se rellenaron previamente en la sección <b>Specify Parameters (Especificar parámetros)</b>.</p>
        </li><li>
          <p>Cambie el valor del cuadro de texto <b>InstanceType (Tipo de instancia)</b> de <code class="code">t1.micro</code> a <code class="code">m1.small</code>. A continuación, elija <b>Siguiente</b>.</p>
        </li><li>
          <p>En la pantalla <b>Options (Opciones)</b>, elija <b>Next (Siguiente)</b>.</p>
        </li><li>
          <p>Elija <b>Next (Siguiente)</b> porque la pila no tiene una política de pila. Todos los recursos se pueden actualizar sin una política de anulaciones.</p>
        </li><li>
          <p>En la pantalla <b>Review (Revisar)</b>, compruebe que todos los ajustes sean de su agrado y, a continuación, elija <b>Update (Actualizar)</b>.</p>
        </li></ol></div>
      <p>Puede cambiar dinámicamente el tipo de instancia de una instancia de Amazon EC2 respaldada por EBS para iniciar y detener la instancia. AWS CloudFormation intenta optimizar el cambio actualizando el tipo de instancia y reiniciando la instancia, por lo que el ID de instancia no cambia. Cuando la instancia se reinicia, sin embargo, la dirección IP pública de la instancia sí cambia. Para garantizar que se ha vinculado correctamente la dirección IP elástica tras el cambio, AWS CloudFormation también actualizará la dirección IP elástica. Puede ver los cambios en la consola AWS CloudFormation en la pestaña de eventos.</p>
      <p>Para comprobar el tipo de instancia desde AWS Management Console, abra la consola de Amazon EC2 y busque allí su instancia.</p>
     
     
      <h3 id="update.walkthrough.ami">Actualice la AMI en una instancia Amazon EC2</h3>

      <p>Ahora veamos cómo podemos cambiar la imagen de máquina de Amazon (AMI) que se ejecutan en la instancia. Vamos a iniciar el cambio de AMI actualizando la pila para usar un nuevo tipo de instancia Amazon EC2, como t2.medium, que es un tipo de instancia HVM64.</p>
      <p>Como en la sección anterior, vamos a utilizar nuestra plantilla existente para cambiar el tipo de instancia que usa nuestra plantilla de ejemplo. En el asistente de actualización de pila, en la página Specify Parameters, cambie el valor del tipo de instancia.</p>
      <p>En este caso, no podemos iniciar y detener la instancia para modificar la AMI; AWS CloudFormation lo considera un cambio de una propiedad inmutable del recurso. Para cambiar una propiedad inmutable, AWS CloudFormation debe lanzar un recurso de sustitución; en este caso, una nueva instancia de Amazon EC2 que ejecuta la nueva AMI.</p>
      <p>Cuando está en ejecución la nueva instancia, AWS CloudFormation actualiza el resto de recursos de la pila para que remita al nuevo recurso. Cuando se crean todos los nuevos recursos, se elimina el recurso anterior, un proceso conocido como UPDATE_CLEANUP. En este momento, podrá observar que el ID de instancia y el URL de la aplicación de la instancia de la pila han cambiado como resultado de la actualización. Los acontecimientos de la tabla de eventos contienen una descripción “La actualización solicitada tiene un cambio de una propiedad inmutable y, por tanto, se ha creado un nuevo recurso físico” para indicar que se reemplazó un recurso.</p>
      <p>Si tiene un código de aplicación escrito en la AMI que desea actualizar, puede utilizar el mismo mecanismo de actualización de pila para actualizar la AMI y así cargar su nueva aplicación.</p>
      <div class="procedure"><h6>Para actualizar la AMI en una instancia de la pila</h6><ol><li>
          <p>Cree nuevas AMI que contengan los cambios del sistema operativo o su aplicación. Para obtener más información, consulte <a href="https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/creating-an-ami.html">Creación de su propia AMI</a> en la <em>Guía del usuario de Amazon EC2 para instancias de Linux</em>.</p>
        </li><li>
          <p>Actualice la plantilla para incorporar los nuevos ID de AMI.</p>
        </li><li>
          <p>Actualice la pila, ya sea desde la AWS Management Console según lo explicado en <a href="#update.application">Actualizar la aplicación</a> o mediante el comando de AWS <a href="https://docs.aws.amazon.com/cli/latest/reference/cloudformation/update-stack.html"><code class="code">aws cloudformation update-stack</code></a>.</p>
        </li></ol></div>
      <p>Al actualizar la pila, CloudFormation detecta que el ID de AMI ha cambiado y, a continuación, se activa una actualización de la pila de la misma forma que iniciamos el anterior.</p>
     
     
      <h3 id="update.walkthrough.launch.config">Actualice la configuración de lanzamiento de Amazon EC2 para un grupo de Auto Scaling</h3>

      <p>Si está utilizando grupos de Auto Scaling en lugar de instancias Amazon EC2, el proceso de actualización de las instancias en ejecución es algo diferente. Con los recursos de Auto Scaling, la configuración de las instancias Amazon EC2, como el tipo de instancia o el ID de AMI se encapsula en la configuración de lanzamiento de Auto Scaling. Puede realizar cambios en la configuración de lanzamiento de la misma forma que hemos realizado cambios en los recursos de instancias Amazon EC2 en las secciones anteriores. Sin embargo, cambiar la configuración de lanzamiento no afecta a ninguna de las instancias Amazon EC2 que se ejecuten en el grupo de Auto Scaling. Una configuración de lanzamiento actualizada se aplica únicamente a las nuevas instancias que se crean después de la actualización.</p>
      <p>Si desea propagar el cambio de su configuración de lanzamiento a todas las instancias de su grupo de Auto Scaling, puede utilizar un atributo de actualización. Para obtener más información, consulte <a href="./aws-attribute-updatepolicy.html">Atributo UpdatePolicy</a>.</p>
     
   
    <h2 id="update.walkthrough.adding.properties">Añadido de propiedades de recursos</h2>
    

    <p>Hasta ahora, hemos examinado el cambio de propiedades existentes de un recurso en una plantilla. También puede agregar propiedades que no estaban especificadas originalmente en la plantilla. Para ilustrarlo, vamos a agregar un par de claves de Amazon EC2 a una instancia de EC2 existente y, a continuación, abrir el puerto 22 en el grupo de seguridad de Amazon EC2, para que pueda utilizar Secure Shell (SSH) para acceder a la instancia.</p>
     
      <h3 id="update.walkthrough.security.group">Añada un par de claves a una instancia</h3>

      <div class="procedure"><h6>Para añadir el acceso SSH a una instancia Amazon EC2 existente</h6><ol><li>
          <p>Añada dos parámetros adicionales a la plantilla para transmitirlo en el nombre de una ubicación SSH y un par de claves Amazon EC2 existentes.</p>
          <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copiar"><awsui-icon name="copy"></awsui-icon></div></div><code class="json ">  "Parameters" : <span>{</span>

    "KeyName" : <span>{</span>
      "Description" : "Name of an existing Amazon EC2 key pair for SSH access",
      "Type": "AWS::EC2::KeyPair::KeyName"
    },
    "SSHLocation" : <span>{</span>
      "Description" : " The IP address range that can be used to SSH to the EC2 instances",
      "Type": "String",
      "MinLength": "9",
      "MaxLength": "18",
      "Default": "0.0.0.0/0",
      "AllowedPattern": "(\\d<span>{</span>1,3})\\.(\\d<span>{</span>1,3})\\.(\\d<span>{</span>1,3})\\.(\\d<span>{</span>1,3})/(\\d<span>{</span>1,2})",
      "ConstraintDescription": "must be a valid IP CIDR range of the form x.x.x.x/x."
    }  
    :
  },
</code></pre>
        </li><li>
          <p>Añada la propiedad KeyName a la instancia Amazon EC2.</p>
          <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copiar"><awsui-icon name="copy"></awsui-icon></div></div><code class="json ">          "WebServerInstance": <span>{</span>
          "Type" : "AWS::EC2::Instance",
          :
          "Properties": <span>{</span>
          :
         <code class="replaceable"> "KeyName" : <span>{</span> "Ref" : "KeyName" },</code>
          :
          }
          },
</code></pre>
        </li><li>
          <p>Añada el puerto 22 y la ubicación de SSH a las reglas de entrada del grupo de seguridad de Amazon EC2.</p>
          <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copiar"><awsui-icon name="copy"></awsui-icon></div></div><code class="json ">    "WebServerSecurityGroup" : <span>{</span>
      "Type" : "AWS::EC2::SecurityGroup",
      "Properties" : <span>{</span>
        "GroupDescription" : "Enable HTTP and SSH",
        "SecurityGroupIngress" : [
          <span>{</span>"IpProtocol" : "tcp", "FromPort" : "22", "ToPort" : "22", "CidrIp" : <span>{</span> "Ref" : "SSHLocation"}},
          <span>{</span>"IpProtocol" : "tcp", "FromPort" : "80", "ToPort" : "80", "CidrIp" :  "0.0.0.0/0"}
        ]
      }
    },    </code></pre>
        </li><li>
          <p>Actualice la pila, ya sea desde la AWS Management Console según lo explicado en <a href="#update.application">Actualizar la aplicación</a> o mediante el comando de AWS <a href="https://docs.aws.amazon.com/cli/latest/reference/cloudformation/update-stack.html"><code class="code">aws cloudformation update-stack</code></a>.</p>
        </li></ol></div>
     
   
    <h2 id="update.walkthrough.change.resources">Cambie los recursos de la pila</h2>
    

    <p>Las necesidades de las aplicaciones pueden variar con el tiempo y AWS CloudFormation le permite cambiar el conjunto de recursos que componen la pila. Para demostrarlo, tomaremos la aplicación de instancia única de <a href="#update.walkthrough.adding.properties">Añadido de propiedades de recursos</a> y la convertiremos en una aplicación autoescalada y con balanceo de carga actualizando la pila.</p>
    <p>Se creará una sencilla aplicación PHP de una sola instancia usando una dirección IP elástica. Ahora convertiremos la aplicación en una aplicación autoescalada con balanceo de carga y de gran disponibilidad, a base de cambiar sus recursos durante una actualización.</p>
    <div class="procedure"><ol><li>
        <p>Añada un recurso de Elastic Load Balancer.</p>
        <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copiar"><awsui-icon name="copy"></awsui-icon></div></div><code class="json ">    "ElasticLoadBalancer" : <span>{</span>
      "Type" : "AWS::ElasticLoadBalancing::LoadBalancer",
      "Properties" : <span>{</span>
        "CrossZone" : "true",
        "AvailabilityZones" : <span>{</span> "Fn::GetAZs" : "" },
        "LBCookieStickinessPolicy" : [ <span>{</span>
          "PolicyName" : "CookieBasedPolicy",
          "CookieExpirationPeriod" : "30"
        } ],
        "Listeners" : [ <span>{</span>
          "LoadBalancerPort" : "80",
          "InstancePort" : "80",
          "Protocol" : "HTTP",
          "PolicyNames" : [ "CookieBasedPolicy" ]
        } ],
        "HealthCheck" : <span>{</span>
          "Target" : "HTTP:80/",
          "HealthyThreshold" : "2",
          "UnhealthyThreshold" : "5",
          "Interval" : "10",
          "Timeout" : "5"
        }
      }
    }</code></pre>
      </li><li>
        <p>Cambie la instancia de EC2 de la plantilla a una configuración de lanzamiento de Auto Scaling. Las propiedades son idénticas, por lo que solo es necesario cambiar el nombre de tipo:</p>
        <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copiar"><awsui-icon name="copy"></awsui-icon></div></div><code class="json ">
<code class="replaceable">"WebServerInstance"</code>: <span>{</span>
  "Type" : <code class="replaceable">"AWS::EC2::Instance"</code>,</code></pre>
        <p>a:</p>
        <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copiar"><awsui-icon name="copy"></awsui-icon></div></div><code class="json ">
<code class="replaceable">"LaunchConfig"</code>: <span>{</span>
  "Type" : <code class="replaceable">"AWS::AutoScaling::LaunchConfiguration"</code>,</code></pre>
        <p>Para tener una plantilla clara, hemos cambiado el nombre del recurso de <em>WebServerInstance</em> a <em>LaunchConfig</em>, por lo que habrá que actualizar el nombre de los recursos a los que hagan referencia cfn-init y cfn-hup (basta con buscar WebServerInstance y reemplazarlo por LaunchConfig, salvo cfn-signal). Para cfn-signal, tendrá que marcar el grupo de Auto Scaling (WebServerGroup), no la instancia, tal y como se muestra en el siguiente fragmento:</p>
        <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copiar"><awsui-icon name="copy"></awsui-icon></div></div><code class="text ">             "# Signal the status from cfn-init\n",
             "/opt/aws/bin/cfn-signal -e $? ",
             "         --stack ", <span>{</span> "Ref" : "AWS::StackName" },
             "         --resource <code class="replaceable">WebServerGroup</code> ",
             "         --region ", <span>{</span> "Ref" : "AWS::Region" }, "\n"</code></pre>
      </li><li>
        <p>Agregue un recurso de grupo de escalado automático.</p>
        <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copiar"><awsui-icon name="copy"></awsui-icon></div></div><code class="json ">    "WebServerGroup" : <span>{</span>
      "Type" : "AWS::AutoScaling::AutoScalingGroup",
      "Properties" : <span>{</span>
        "AvailabilityZones" : <span>{</span> "Fn::GetAZs" : "" },
        "LaunchConfigurationName" : <span>{</span> "Ref" : "LaunchConfig" },
        "MinSize" : "1",
        "DesiredCapacity" : "1",
        "MaxSize" : "5",
        "LoadBalancerNames" : [ <span>{</span> "Ref" : "ElasticLoadBalancer" } ]
      },
      "CreationPolicy" : <span>{</span>
        "ResourceSignal" : <span>{</span>
          "Timeout" : "PT15M"
        }
      },
      "UpdatePolicy": <span>{</span>
        "AutoScalingRollingUpdate": <span>{</span>
          "MinInstancesInService": "1",
          "MaxBatchSize": "1",
          "PauseTime" : "PT15M",
          "WaitOnResourceSignals": "true"
        }
      }
    }</code></pre>
      </li><li>
        <p>Actualice la definición de grupo de seguridad para cerrar el tráfico a las instancias desde el balanceador de carga.</p>
        <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copiar"><awsui-icon name="copy"></awsui-icon></div></div><code class="json ">    "WebServerSecurityGroup" : <span>{</span>
      "Type" : "AWS::EC2::SecurityGroup",
      "Properties" : <span>{</span>
        "GroupDescription" : "Enable HTTP access via port 80 locked down to the ELB and SSH access",
        "SecurityGroupIngress" : [
          <span>{</span>"IpProtocol" : "tcp", "FromPort" : "80", "ToPort" : "80", "SourceSecurityGroupOwnerId" : <span>{</span>"Fn::GetAtt" : ["ElasticLoadBalancer", "SourceSecurityGroup.OwnerAlias"]},
"SourceSecurityGroupName" : <span>{</span>"Fn::GetAtt" : ["ElasticLoadBalancer", "SourceSecurityGroup.GroupName"]}},
          <span>{</span>"IpProtocol" : "tcp", "FromPort" : "22", "ToPort" : "22", "CidrIp" : <span>{</span> "Ref" : "SSHLocation"}}
        ]
      }
    }</code></pre>
      </li><li>
        <p>Actualice las salidas para devolver el nombre DNS de Elastic Load Balancer como ubicación de la aplicación de:</p>
        <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copiar"><awsui-icon name="copy"></awsui-icon></div></div><code class="json ">
"WebsiteURL" : <span>{</span>
  "Value" : <span>{</span> "Fn::Join" : ["", ["http://", 
      <span>{</span> "Fn::GetAtt" : [ "<code class="replaceable">WebServerInstance</code>", "<code class="replaceable">PublicDnsName</code>" ]}]]},
  "Description" : "Application URL"
}              </code></pre>
        <p>a:</p>
        <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copiar"><awsui-icon name="copy"></awsui-icon></div></div><code class="json ">
"WebsiteURL" : <span>{</span>
  "Value" : <span>{</span> "Fn::Join" : ["", ["http://", 
      <span>{</span> "Fn::GetAtt" : [ "<code class="replaceable">ElasticLoadBalancer</code>", "<code class="replaceable">DNSName</code>" ]}]]},
  "Description" : "Application URL"
}              </code></pre>
      </li></ol></div>
    <p>Si desea consultar una referencia, la siguiente muestra enseña la plantilla completa. Si utiliza esta plantilla para actualizar la pila, convertirá su aplicación sencilla de una sola instancia en una aplicación de alta disponibilidad, Multi-AZ, de escalado automático y con equilibrador de carga. Solo se modificarán los recursos que deban actualizarse, por lo que de haber habido almacenes de datos para esta aplicación, los datos habrían permanecido intactos. Ahora, puede usar AWS CloudFormation para incrementar o mejorar sus pilas a medida que cambien sus necesidades.</p>
    <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copiar"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
  "AWSTemplateFormatVersion" : "2010-09-09",

  "Description" : "AWS CloudFormation Sample Template: Sample template that can be used to test EC2 updates. **WARNING** This template creates an Amazon Ec2 Instance. You will be billed for the AWS resources used if you create a stack from this template.",
  
  "Parameters" : <span>{</span>
  
    "KeyName": <span>{</span>
      "Description" : "Name of an existing EC2 KeyPair to enable SSH access to the instance",
      "Type": "AWS::EC2::KeyPair::KeyName",
      "ConstraintDescription" : "must be the name of an existing EC2 KeyPair."
    },

    "SSHLocation" : <span>{</span>
      "Description" : " The IP address range that can be used to SSH to the EC2 instances",
      "Type": "String",
      "MinLength": "9",
      "MaxLength": "18",
      "Default": "0.0.0.0/0",
      "AllowedPattern": "(\\d<span>{</span>1,3})\\.(\\d<span>{</span>1,3})\\.(\\d<span>{</span>1,3})\\.(\\d<span>{</span>1,3})/(\\d<span>{</span>1,2})",
      "ConstraintDescription": "must be a valid IP CIDR range of the form x.x.x.x/x."
    },
    
    "InstanceType" : <span>{</span>
      "Description" : "WebServer EC2 instance type",
      "Type" : "String",
      "Default" : "t2.small",
      "AllowedValues" : [ 
        "t1.micro", 
        "t2.nano", 
        "t2.micro", 
        "t2.small", 
        "t2.medium", 
        "t2.large", 
        "m1.small", 
        "m1.medium", 
        "m1.large", 
        "m1.xlarge", 
        "m2.xlarge", 
        "m2.2xlarge", 
        "m2.4xlarge", 
        "m3.medium", 
        "m3.large", 
        "m3.xlarge", 
        "m3.2xlarge", 
        "m4.large", 
        "m4.xlarge", 
        "m4.2xlarge", 
        "m4.4xlarge", 
        "m4.10xlarge", 
        "c1.medium", 
        "c1.xlarge", 
        "c3.large", 
        "c3.xlarge", 
        "c3.2xlarge", 
        "c3.4xlarge", 
        "c3.8xlarge", 
        "c4.large", 
        "c4.xlarge", 
        "c4.2xlarge", 
        "c4.4xlarge", 
        "c4.8xlarge", 
        "g2.2xlarge", 
        "g2.8xlarge", 
        "r3.large", 
        "r3.xlarge", 
        "r3.2xlarge", 
        "r3.4xlarge", 
        "r3.8xlarge", 
        "i2.xlarge", 
        "i2.2xlarge", 
        "i2.4xlarge", 
        "i2.8xlarge", 
        "d2.xlarge", 
        "d2.2xlarge", 
        "d2.4xlarge", 
        "d2.8xlarge", 
        "hi1.4xlarge", 
        "hs1.8xlarge", 
        "cr1.8xlarge", 
        "cc2.8xlarge", 
        "cg1.4xlarge"
      ],
      "ConstraintDescription" : "must be a valid EC2 instance type."
    }
  },
  
  "Mappings" : <span>{</span>
    "AWSInstanceType2Arch" : <span>{</span>
      "t1.micro"    : <span>{</span> "Arch" : "HVM64"  },
      "t2.nano"     : <span>{</span> "Arch" : "HVM64"  },
      "t2.micro"    : <span>{</span> "Arch" : "HVM64"  },
      "t2.small"    : <span>{</span> "Arch" : "HVM64"  },
      "t2.medium"   : <span>{</span> "Arch" : "HVM64"  },
      "t2.large"    : <span>{</span> "Arch" : "HVM64"  },
      "m1.small"    : <span>{</span> "Arch" : "HVM64"  },
      "m1.medium"   : <span>{</span> "Arch" : "HVM64"  },
      "m1.large"    : <span>{</span> "Arch" : "HVM64"  },
      "m1.xlarge"   : <span>{</span> "Arch" : "HVM64"  },
      "m2.xlarge"   : <span>{</span> "Arch" : "HVM64"  },
      "m2.2xlarge"  : <span>{</span> "Arch" : "HVM64"  },
      "m2.4xlarge"  : <span>{</span> "Arch" : "HVM64"  },
      "m3.medium"   : <span>{</span> "Arch" : "HVM64"  },
      "m3.large"    : <span>{</span> "Arch" : "HVM64"  },
      "m3.xlarge"   : <span>{</span> "Arch" : "HVM64"  },
      "m3.2xlarge"  : <span>{</span> "Arch" : "HVM64"  },
      "m4.large"    : <span>{</span> "Arch" : "HVM64"  },
      "m4.xlarge"   : <span>{</span> "Arch" : "HVM64"  },
      "m4.2xlarge"  : <span>{</span> "Arch" : "HVM64"  },
      "m4.4xlarge"  : <span>{</span> "Arch" : "HVM64"  },
      "m4.10xlarge" : <span>{</span> "Arch" : "HVM64"  },
      "c1.medium"   : <span>{</span> "Arch" : "HVM64"  },
      "c1.xlarge"   : <span>{</span> "Arch" : "HVM64"  },
      "c3.large"    : <span>{</span> "Arch" : "HVM64"  },
      "c3.xlarge"   : <span>{</span> "Arch" : "HVM64"  },
      "c3.2xlarge"  : <span>{</span> "Arch" : "HVM64"  },
      "c3.4xlarge"  : <span>{</span> "Arch" : "HVM64"  },
      "c3.8xlarge"  : <span>{</span> "Arch" : "HVM64"  },
      "c4.large"    : <span>{</span> "Arch" : "HVM64"  },
      "c4.xlarge"   : <span>{</span> "Arch" : "HVM64"  },
      "c4.2xlarge"  : <span>{</span> "Arch" : "HVM64"  },
      "c4.4xlarge"  : <span>{</span> "Arch" : "HVM64"  },
      "c4.8xlarge"  : <span>{</span> "Arch" : "HVM64"  },
      "g2.2xlarge"  : <span>{</span> "Arch" : "HVMG2"  },
      "g2.8xlarge"  : <span>{</span> "Arch" : "HVMG2"  },
      "r3.large"    : <span>{</span> "Arch" : "HVM64"  },
      "r3.xlarge"   : <span>{</span> "Arch" : "HVM64"  },
      "r3.2xlarge"  : <span>{</span> "Arch" : "HVM64"  },
      "r3.4xlarge"  : <span>{</span> "Arch" : "HVM64"  },
      "r3.8xlarge"  : <span>{</span> "Arch" : "HVM64"  },
      "i2.xlarge"   : <span>{</span> "Arch" : "HVM64"  },
      "i2.2xlarge"  : <span>{</span> "Arch" : "HVM64"  },
      "i2.4xlarge"  : <span>{</span> "Arch" : "HVM64"  },
      "i2.8xlarge"  : <span>{</span> "Arch" : "HVM64"  },
      "d2.xlarge"   : <span>{</span> "Arch" : "HVM64"  },
      "d2.2xlarge"  : <span>{</span> "Arch" : "HVM64"  },
      "d2.4xlarge"  : <span>{</span> "Arch" : "HVM64"  },
      "d2.8xlarge"  : <span>{</span> "Arch" : "HVM64"  },
      "hi1.4xlarge" : <span>{</span> "Arch" : "HVM64"  },
      "hs1.8xlarge" : <span>{</span> "Arch" : "HVM64"  },
      "cr1.8xlarge" : <span>{</span> "Arch" : "HVM64"  },
      "cc2.8xlarge" : <span>{</span> "Arch" : "HVM64"  }
    },
    "AWSRegionArch2AMI" : <span>{</span>
      "us-east-1"        : <span>{</span>"HVM64" : "ami-0ff8a91507f77f867", "HVMG2" : "ami-0a584ac55a7631c0c"},
      "us-west-2"        : <span>{</span>"HVM64" : "ami-a0cfeed8", "HVMG2" : "ami-0e09505bc235aa82d"},
      "us-west-1"        : <span>{</span>"HVM64" : "ami-0bdb828fd58c52235", "HVMG2" : "ami-066ee5fd4a9ef77f1"},
      "eu-west-1"        : <span>{</span>"HVM64" : "ami-047bb4163c506cd98", "HVMG2" : "ami-0a7c483d527806435"},
      "eu-west-2"        : <span>{</span>"HVM64" : "ami-f976839e", "HVMG2" : "NOT_SUPPORTED"},
      "eu-west-3"        : <span>{</span>"HVM64" : "ami-0ebc281c20e89ba4b", "HVMG2" : "NOT_SUPPORTED"},
      "eu-central-1"     : <span>{</span>"HVM64" : "ami-0233214e13e500f77", "HVMG2" : "ami-06223d46a6d0661c7"},
      "ap-northeast-1"   : <span>{</span>"HVM64" : "ami-06cd52961ce9f0d85", "HVMG2" : "ami-053cdd503598e4a9d"},
      "ap-northeast-2"   : <span>{</span>"HVM64" : "ami-0a10b2721688ce9d2", "HVMG2" : "NOT_SUPPORTED"},
      "ap-northeast-3"   : <span>{</span>"HVM64" : "ami-0d98120a9fb693f07", "HVMG2" : "NOT_SUPPORTED"},
      "ap-southeast-1"   : <span>{</span>"HVM64" : "ami-08569b978cc4dfa10", "HVMG2" : "ami-0be9df32ae9f92309"},
      "ap-southeast-2"   : <span>{</span>"HVM64" : "ami-09b42976632b27e9b", "HVMG2" : "ami-0a9ce9fecc3d1daf8"},
      "ap-south-1"       : <span>{</span>"HVM64" : "ami-0912f71e06545ad88", "HVMG2" : "ami-097b15e89dbdcfcf4"},
      "us-east-2"        : <span>{</span>"HVM64" : "ami-0b59bfac6be064b78", "HVMG2" : "NOT_SUPPORTED"},
      "ca-central-1"     : <span>{</span>"HVM64" : "ami-0b18956f", "HVMG2" : "NOT_SUPPORTED"},
      "sa-east-1"        : <span>{</span>"HVM64" : "ami-07b14488da8ea02a0", "HVMG2" : "NOT_SUPPORTED"},
      "cn-north-1"       : <span>{</span>"HVM64" : "ami-0a4eaf6c4454eda75", "HVMG2" : "NOT_SUPPORTED"},
      "cn-northwest-1"   : <span>{</span>"HVM64" : "ami-6b6a7d09", "HVMG2" : "NOT_SUPPORTED"}
    }
  },
    
  "Resources" : <span>{</span>   
  
    "ElasticLoadBalancer" : <span>{</span>
      "Type" : "AWS::ElasticLoadBalancing::LoadBalancer",
      "Properties" : <span>{</span>
        "CrossZone" : "true",
        "AvailabilityZones" : <span>{</span> "Fn::GetAZs" : "" },
        "LBCookieStickinessPolicy" : [ <span>{</span>
          "PolicyName" : "CookieBasedPolicy",
          "CookieExpirationPeriod" : "30"
        } ],
        "Listeners" : [ <span>{</span>
          "LoadBalancerPort" : "80",
          "InstancePort" : "80",
          "Protocol" : "HTTP",
          "PolicyNames" : [ "CookieBasedPolicy" ]
        } ],
        "HealthCheck" : <span>{</span>
          "Target" : "HTTP:80/",
          "HealthyThreshold" : "2",
          "UnhealthyThreshold" : "5",
          "Interval" : "10",
          "Timeout" : "5"
        }
      }
    },
    
    "WebServerGroup" : <span>{</span>
      "Type" : "AWS::AutoScaling::AutoScalingGroup",
      "Properties" : <span>{</span>
        "AvailabilityZones" : <span>{</span> "Fn::GetAZs" : "" },
        "LaunchConfigurationName" : <span>{</span> "Ref" : "LaunchConfig" },
        "MinSize" : "1",
        "DesiredCapacity" : "1",
        "MaxSize" : "5",
        "LoadBalancerNames" : [ <span>{</span> "Ref" : "ElasticLoadBalancer" } ]
      },
      "CreationPolicy" : <span>{</span>
        "ResourceSignal" : <span>{</span>
          "Timeout" : "PT15M"
        }
      },
      "UpdatePolicy": <span>{</span>
        "AutoScalingRollingUpdate": <span>{</span>
          "MinInstancesInService": "1",
          "MaxBatchSize": "1",
          "PauseTime" : "PT15M",
          "WaitOnResourceSignals": "true"
        }
      }
    },
    
    "LaunchConfig": <span>{</span>  
      "Type" : "AWS::AutoScaling::LaunchConfiguration",
      "Metadata" : <span>{</span>
        "Comment" : "Install a simple PHP application",
        "AWS::CloudFormation::Init" : <span>{</span>
          "config" : <span>{</span>
            "packages" : <span>{</span>
              "yum" : <span>{</span>
                "httpd"             : [],
                "php"               : []
              }
            },

            "files" : <span>{</span>

              "/var/www/html/index.php" : <span>{</span>
                "content" : <span>{</span> "Fn::Join" : ["", [
                  "&lt;?php\n",
                  "echo '&lt;h1&gt;AWS CloudFormation sample PHP application&lt;/h1&gt;';\n",
                  "echo 'Updated version via UpdateStack';\n ",
                  "?&gt;\n"
                ]]},
                "mode"    : "000644",
                "owner"   : "apache",
                "group"   : "apache"
              },


              "/etc/cfn/cfn-hup.conf" : <span>{</span>
                "content" : <span>{</span> "Fn::Join" : ["", [
                  "[main]\n",
                  "stack=", <span>{</span> "Ref" : "AWS::StackId" }, "\n",
                  "region=", <span>{</span> "Ref" : "AWS::Region" }, "\n"
                ]]},
                "mode"    : "000400",
                "owner"   : "root",
                "group"   : "root"
              },

              "/etc/cfn/hooks.d/cfn-auto-reloader.conf" : <span>{</span>
                "content": <span>{</span> "Fn::Join" : ["", [
                  "[cfn-auto-reloader-hook]\n",
                  "triggers=post.update\n",
                  "path=Resources.LaunchConfig.Metadata.AWS::CloudFormation::Init\n",
                  "action=/opt/aws/bin/cfn-init -s ", <span>{</span> "Ref" : "AWS::StackId" }, " -r LaunchConfig ",
                                                   " --region     ", <span>{</span> "Ref" : "AWS::Region" }, "\n",
                  "runas=root\n"
                ]]}
              }
            },

            "services" : <span>{</span>
              "sysvinit" : <span>{</span>
                "httpd"    : <span>{</span> "enabled" : "true", "ensureRunning" : "true" },
                "cfn-hup" : <span>{</span> "enabled" : "true", "ensureRunning" : "true",
                    "files" : ["/etc/cfn/cfn-hup.conf", "/etc/cfn/hooks.d/cfn-auto-reloader.conf"]}
              }
            }
          }
        }
      },

      "Properties": <span>{</span>
        "ImageId" : <span>{</span> "Fn::FindInMap" : [ "AWSRegionArch2AMI", <span>{</span> "Ref" : "AWS::Region" },
                          <span>{</span> "Fn::FindInMap" : [ "AWSInstanceType2Arch", <span>{</span> "Ref" : "InstanceType" }, "Arch" ] } ] },
        "InstanceType"   : <span>{</span> "Ref" : "InstanceType" },
        "KeyName"        : <span>{</span> "Ref" : "KeyName" },
        "SecurityGroups" : [ <span>{</span>"Ref" : "WebServerSecurityGroup"} ],
        "UserData"       : <span>{</span> "Fn::Base64" : <span>{</span> "Fn::Join" : ["", [
             "#!/bin/bash -xe\n",
             "yum install -y aws-cfn-bootstrap\n",

             "# Install the files and packages from the metadata\n",
             "/opt/aws/bin/cfn-init -v ",
             "         --stack ", <span>{</span> "Ref" : "AWS::StackName" },
             "         --resource LaunchConfig ",
             "         --region ", <span>{</span> "Ref" : "AWS::Region" }, "\n",
             
             "# Start up the cfn-hup daemon to listen for changes to the Web Server metadata\n",
             "/opt/aws/bin/cfn-hup || error_exit 'Failed to start cfn-hup'\n",  

             "# Signal the status from cfn-init\n",
             "/opt/aws/bin/cfn-signal -e $? ",
             "         --stack ", <span>{</span> "Ref" : "AWS::StackName" },
             "         --resource WebServerGroup ",
             "         --region ", <span>{</span> "Ref" : "AWS::Region" }, "\n"
        ]]}}        
      }
    },

    "WebServerSecurityGroup" : <span>{</span>
      "Type" : "AWS::EC2::SecurityGroup",
      "Properties" : <span>{</span>
        "GroupDescription" : "Enable HTTP access via port 80 locked down to the ELB and SSH access",
        "SecurityGroupIngress" : [
          <span>{</span>"IpProtocol" : "tcp", "FromPort" : "80", "ToPort" : "80", "SourceSecurityGroupOwnerId" : <span>{</span>"Fn::GetAtt" : ["ElasticLoadBalancer", "SourceSecurityGroup.OwnerAlias"]},"SourceSecurityGroupName" : <span>{</span>"Fn::GetAtt" : ["ElasticLoadBalancer", "SourceSecurityGroup.GroupName"]}},
          <span>{</span>"IpProtocol" : "tcp", "FromPort" : "22", "ToPort" : "22", "CidrIp" : <span>{</span> "Ref" : "SSHLocation"}}
        ]
      }
    }          
  },
  
  "Outputs" : <span>{</span>
    "WebsiteURL" : <span>{</span>
      "Description" : "Application URL",
      "Value" : <span>{</span> "Fn::Join" : ["", ["http://", <span>{</span> "Fn::GetAtt" : [ "ElasticLoadBalancer", "DNSName" ]}]] }
    }
  }
}</code></pre>
   
    <h2 id="update.walkthrough.impact">Consideraciones sobre el impacto y la disponibilidad</h2>

    <p>Las distintas propiedades afectan de forma diferente a los recursos de la pila. Puede utilizar CloudFormation para actualizar cualquier propiedad; no obstante, antes de realizar cambios, debe tener en cuenta estas preguntas:</p>
    <div class="orderedlist">
       
       
    <ol><li>
        <p>¿Cómo afecta la actualización al propio recurso? Por ejemplo, la actualización de un umbral de alarma inutilizará la alarma durante la actualización. Como hemos visto, cambiar el tipo de instancia requiere detener y reiniciar la instancia. AWS CloudFormation utiliza las acciones de actualización o modificación para que los recursos subyacentes realicen cambios en los recursos. Para comprender el impacto de las actualizaciones, debería comprobar la documentación de los recursos específicos.</p>
      </li><li>
        <p>¿Es el cambio mutable o inmutable? Algunos cambios en las propiedades de recursos, como, por ejemplo, el cambio de la AMI en una instancia de Amazon EC2, no son compatibles con los servicios subyacentes. En el caso de cambios mutables, CloudFormation utilizará las API de tipo actualización o modificación para los recursos subyacentes. Para cambios de propiedad inmutables, CloudFormation creará nuevos recursos con las propiedades actualizadas y, a continuación, vincularlas a la pila antes de eliminar los antiguos recursos. Aunque CloudFormation intenta reducir el tiempo de inactividad de los recursos de la pila; sustituir un recurso es un proceso de varios pasos y llevará tiempo. Durante la reconfiguración de pila, su aplicación no estará totalmente operativa. Por ejemplo, es posible que no pueda atender a las solicitudes ni acceder a una base de datos.</p>
      </li></ol></div>
   
    <h2 id="update.walkthrough.related">Recursos relacionados</h2>

    <p>Para obtener más información acerca del uso de CloudFormation para iniciar las aplicaciones y de la integración con otros servicios de configuración e implementación como Puppet y Opscode Chef, consulte los siguientes documentos técnicos:</p>
    <div class="itemizedlist">
       
       
       
    <ul class="itemizedlist"><li class="listitem">
        <p><a href="https://s3.amazonaws.com/cloudformation-examples/BoostrappingApplicationsWithAWSCloudFormation.pdf" rel="noopener noreferrer" target="_blank"><span>Proceso de arranque de aplicaciones mediante AWS CloudFormation</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a></p>
      </li><li class="listitem">
        <p><a href="https://s3.amazonaws.com/cloudformation-examples/IntegratingAWSCloudFormationWithOpscodeChef.pdf" rel="noopener noreferrer" target="_blank"><span>Integración de AWS CloudFormation con Opscode Chef</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a></p>
      </li><li class="listitem">
        <p><a href="https://s3.amazonaws.com/cloudformation-examples/IntegratingAWSCloudFormationWithPuppet.pdf" rel="noopener noreferrer" target="_blank"><span>Integración de AWS CloudFormation con Puppet</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a></p>
      </li></ul></div>
    <p>La plantilla utilizada en esta sección es una aplicación PHP del tipo “Hola, mundo”. La biblioteca de plantillas también tiene una muestra de plantilla de Amazon ElastiCache que muestra cómo integrar una aplicación PHP mediante el uso de cfn-hup y cfn-init por parte de ElasticCache, para responder a los cambios de la configuración del clúster de caché de Amazon ElastiCache, que puede llevar a cabo Update Stack.</p>
  <awsdocs-copyright class="copyright-print"></awsdocs-copyright><awsdocs-thumb-feedback right-edge="{{$ctrl.thumbFeedbackRightEdge}}"></awsdocs-thumb-feedback></div><noscript><div><div><div><div id="js_error_message"><p><img src="https://d1ge0kk1l5kms0.cloudfront.net/images/G/01/webservices/console/warning.png" alt="Aviso" /> <strong>JavaScript está desactivado o no está disponible en su navegador.</strong></p><p>Para utilizar la documentación de AWS, debe estar habilitado JavaScript. Para obtener más información, consulte las páginas de ayuda de su navegador.</p></div></div></div></div></noscript><div id="main-col-footer" class="awsui-util-font-size-0"><div id="doc-conventions"><a target="_top" href="/general/latest/gr/docconventions.html">Convenciones del documento</a></div><div class="prev-next"><div id="previous" class="prev-link" accesskey="p" href="./gettingstarted.templatebasics.html">Más información sobre los aspectos básicos de las plantillas</div><div id="next" class="next-link" accesskey="n" href="./security.html">Seguridad</div></div></div><awsdocs-page-utilities></awsdocs-page-utilities></div><div id="quick-feedback-yes" style="display: none;"><div class="title">¿Le ha servido de ayuda esta página? - Sí</div><div class="content"><p>Gracias por hacernos saber que estamos haciendo un buen trabajo.</p><p>Si tiene un momento, díganos qué es lo que le ha gustado para que podamos seguir trabajando en esa línea.</p><p><awsui-button id="fblink" rel="noopener noreferrer" target="_blank" text="Comentarios" click="linkClick($event)" href="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=CloudFormation&amp;topic_url=https://docs.aws.amazon.com/es_es/AWSCloudFormation/latest/UserGuide/updating.stacks.walkthrough.html"></awsui-button></p></div></div><div id="quick-feedback-no" style="display: none;"><div class="title">¿Le ha servido de ayuda esta página? - No</div><div class="content"><p>Gracias por informarnos de que debemos trabajar en esta página. Lamentamos haberle defraudado.</p><p>Si tiene un momento, díganos cómo podemos mejorar la documentación.</p><p><awsui-button id="fblink" rel="noopener noreferrer" target="_blank" text="Comentarios" click="linkClick($event)" href="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=CloudFormation&amp;topic_url=https://docs.aws.amazon.com/es_es/AWSCloudFormation/latest/UserGuide/updating.stacks.walkthrough.html"></awsui-button></p></div></div></div></body></div></awsdocs-view><div class="page-loading-indicator" id="page-loading-indicator"><awsui-spinner size="large"></awsui-spinner></div></div><div id="tools-panel" dom-region="tools"><awsdocs-tools-panel id="awsdocs-tools-panel"></awsdocs-tools-panel></div></awsui-app-layout><awsdocs-cookie-banner class="doc-cookie-banner"></awsdocs-cookie-banner></div></body></html>