<!DOCTYPE html>
    <html xmlns="http://www.w3.org/1999/xhtml" lang="es-ES"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Tutorial: Búsqueda de ID de imagen de Amazon Machine - AWS CloudFormation</title><meta name="viewport" content="width=device-width,initial-scale=1" /><meta name="assets_root" content="/assets" /><meta name="target_state" content="walkthrough-custom-resources-lambda-lookup-amiids" /><meta name="default_state" content="walkthrough-custom-resources-lambda-lookup-amiids" /><link rel="icon" type="image/ico" href="/assets/images/favicon.ico" /><link rel="shortcut icon" type="image/ico" href="/assets/images/favicon.ico" /><link rel="canonical" href="https://docs.aws.amazon.com/es_es/AWSCloudFormation/latest/UserGuide/walkthrough-custom-resources-lambda-lookup-amiids.html" /><meta name="description" content="Utilice AWS Lambda y un recurso personalizado para buscar de forma dinámica los ID de las AMI." /><meta name="deployment_region" content="IAD" /><meta name="product" content="AWS CloudFormation" /><meta name="guide" content="Guía del usuario" /><meta name="abstract" content="Cree y administre implementaciones de infraestructura de AWS de forma predecible y repetida mediante AWS CloudFormation con esta Guía del usuario." /><meta name="guide-locale" content="es_es" /><meta name="tocs" content="toc-contents.json" /><link rel="canonical" href="https://docs.aws.amazon.com/es_es/AWSCloudFormation/latest/UserGuide/walkthrough-custom-resources-lambda-lookup-amiids.html" /><link rel="alternative" href="https://docs.aws.amazon.com/id_id/AWSCloudFormation/latest/UserGuide/walkthrough-custom-resources-lambda-lookup-amiids.html" hreflang="id-id" /><link rel="alternative" href="https://docs.aws.amazon.com/id_id/AWSCloudFormation/latest/UserGuide/walkthrough-custom-resources-lambda-lookup-amiids.html" hreflang="id" /><link rel="alternative" href="https://docs.aws.amazon.com/de_de/AWSCloudFormation/latest/UserGuide/walkthrough-custom-resources-lambda-lookup-amiids.html" hreflang="de-de" /><link rel="alternative" href="https://docs.aws.amazon.com/de_de/AWSCloudFormation/latest/UserGuide/walkthrough-custom-resources-lambda-lookup-amiids.html" hreflang="de" /><link rel="alternative" href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/walkthrough-custom-resources-lambda-lookup-amiids.html" hreflang="en-us" /><link rel="alternative" href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/walkthrough-custom-resources-lambda-lookup-amiids.html" hreflang="en" /><link rel="alternative" href="https://docs.aws.amazon.com/es_es/AWSCloudFormation/latest/UserGuide/walkthrough-custom-resources-lambda-lookup-amiids.html" hreflang="es-es" /><link rel="alternative" href="https://docs.aws.amazon.com/es_es/AWSCloudFormation/latest/UserGuide/walkthrough-custom-resources-lambda-lookup-amiids.html" hreflang="es" /><link rel="alternative" href="https://docs.aws.amazon.com/fr_fr/AWSCloudFormation/latest/UserGuide/walkthrough-custom-resources-lambda-lookup-amiids.html" hreflang="fr-fr" /><link rel="alternative" href="https://docs.aws.amazon.com/fr_fr/AWSCloudFormation/latest/UserGuide/walkthrough-custom-resources-lambda-lookup-amiids.html" hreflang="fr" /><link rel="alternative" href="https://docs.aws.amazon.com/it_it/AWSCloudFormation/latest/UserGuide/walkthrough-custom-resources-lambda-lookup-amiids.html" hreflang="it-it" /><link rel="alternative" href="https://docs.aws.amazon.com/it_it/AWSCloudFormation/latest/UserGuide/walkthrough-custom-resources-lambda-lookup-amiids.html" hreflang="it" /><link rel="alternative" href="https://docs.aws.amazon.com/ja_jp/AWSCloudFormation/latest/UserGuide/walkthrough-custom-resources-lambda-lookup-amiids.html" hreflang="ja-jp" /><link rel="alternative" href="https://docs.aws.amazon.com/ja_jp/AWSCloudFormation/latest/UserGuide/walkthrough-custom-resources-lambda-lookup-amiids.html" hreflang="ja" /><link rel="alternative" href="https://docs.aws.amazon.com/ko_kr/AWSCloudFormation/latest/UserGuide/walkthrough-custom-resources-lambda-lookup-amiids.html" hreflang="ko-kr" /><link rel="alternative" href="https://docs.aws.amazon.com/ko_kr/AWSCloudFormation/latest/UserGuide/walkthrough-custom-resources-lambda-lookup-amiids.html" hreflang="ko" /><link rel="alternative" href="https://docs.aws.amazon.com/pt_br/AWSCloudFormation/latest/UserGuide/walkthrough-custom-resources-lambda-lookup-amiids.html" hreflang="pt-br" /><link rel="alternative" href="https://docs.aws.amazon.com/pt_br/AWSCloudFormation/latest/UserGuide/walkthrough-custom-resources-lambda-lookup-amiids.html" hreflang="pt" /><link rel="alternative" href="https://docs.aws.amazon.com/zh_cn/AWSCloudFormation/latest/UserGuide/walkthrough-custom-resources-lambda-lookup-amiids.html" hreflang="zh-cn" /><link rel="alternative" href="https://docs.aws.amazon.com/zh_tw/AWSCloudFormation/latest/UserGuide/walkthrough-custom-resources-lambda-lookup-amiids.html" hreflang="zh-tw" /><link rel="alternative" href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/walkthrough-custom-resources-lambda-lookup-amiids.html" hreflang="x-default" /><meta name="feedback-item" content="CloudFormation" /><meta name="this_doc_product" content="AWS CloudFormation" /><meta name="this_doc_guide" content="Guía del usuario" /><script defer="" src="/assets/r/vendor4.js?version=2021.12.02"></script><script defer="" src="/assets/r/vendor3.js?version=2021.12.02"></script><script defer="" src="/assets/r/vendor1.js?version=2021.12.02"></script><script defer="" src="/assets/r/awsdocs-common.js?version=2021.12.02"></script><script defer="" src="/assets/r/awsdocs-doc-page.js?version=2021.12.02"></script><link href="/assets/r/vendor4.css?version=2021.12.02" rel="stylesheet" /><link href="/assets/r/awsdocs-common.css?version=2021.12.02" rel="stylesheet" /><link href="/assets/r/awsdocs-doc-page.css?version=2021.12.02" rel="stylesheet" /><script async="" id="awsc-panorama-bundle" type="text/javascript" src="https://prod.pa.cdn.uis.awsstatic.com/panorama-nav-init.js" data-config="{'appEntity':'aws-documentation','region':'us-east-1','service':'cloudformation'}"></script><meta id="panorama-serviceSubSection" value="Guía del usuario" /><meta id="panorama-serviceConsolePage" value="Tutorial: Búsqueda de ID de imagen de Amazon Machine" /></head><body class="awsdocs awsui"><div class="awsdocs-container"><awsdocs-header></awsdocs-header><awsui-app-layout id="app-layout" class="awsui-util-no-gutters" ng-controller="ContentController as $ctrl" header-selector="awsdocs-header" navigation-hide="false" navigation-width="$ctrl.navWidth" navigation-open="$ctrl.navOpen" navigation-change="$ctrl.onNavChange($event)" tools-hide="$ctrl.hideTools" tools-width="$ctrl.toolsWidth" tools-open="$ctrl.toolsOpen" tools-change="$ctrl.onToolsChange($event)"><div id="guide-toc" dom-region="navigation"><awsdocs-toc></awsdocs-toc></div><div id="main-column" dom-region="content" tabindex="-1"><awsdocs-view class="awsdocs-view"><div id="awsdocs-content"><head><title>Tutorial: Búsqueda de ID de imagen de Amazon Machine - AWS CloudFormation</title><meta name="rss" content="aws-cloudformation-release-notes.rss" /><meta name="forums" content="http://forums.aws.amazon.com/forum.jspa?forumID=92" /><meta name="feedback" content="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=CloudFormation&amp;topic_url=https://docs.aws.amazon.com/es_es/AWSCloudFormation/latest/UserGuide/walkthrough-custom-resources-lambda-lookup-amiids.html" /><meta name="feedback-yes" content="feedbackyes.html?topic_url=https://docs.aws.amazon.com/es_es/AWSCloudFormation/latest/UserGuide/walkthrough-custom-resources-lambda-lookup-amiids.html" /><meta name="feedback-no" content="feedbackno.html?topic_url=https://docs.aws.amazon.com/es_es/AWSCloudFormation/latest/UserGuide/walkthrough-custom-resources-lambda-lookup-amiids.html" /><meta name="keywords" content="CloudFormation,AWSCloudFormation,aprovisionamiento de recursos,configuración de recursos,administración de la infraestructura,CloudFormer,Pila de CloudFormation,Conjunto de pilas de CloudFormation,Plantilla de CloudFormation,conjunto de cambios" /><script type="application/ld+json">
{
    "@context" : "https://schema.org",
    "@type" : "BreadcrumbList",
    "itemListElement" : [
      {
        "@type" : "ListItem",
        "position" : 1,
        "name" : "AWS",
        "item" : "https://aws.amazon.com"
      },
      {
        "@type" : "ListItem",
        "position" : 2,
        "name" : "AWS CloudFormation",
        "item" : "https://docs.aws.amazon.com/cloudformation/index.html"
      },
      {
        "@type" : "ListItem",
        "position" : 3,
        "name" : "Guía del usuario",
        "item" : "https://docs.aws.amazon.com/es_es/AWSCloudFormation/latest/UserGuide"
      },
      {
        "@type" : "ListItem",
        "position" : 4,
        "name" : "Trabajo con plantillas de AWS CloudFormation",
        "item" : "https://docs.aws.amazon.com/es_es/AWSCloudFormation/latest/UserGuide/template-guide.html"
      },
      {
        "@type" : "ListItem",
        "position" : 5,
        "name" : "Recursos personalizados",
        "item" : "https://docs.aws.amazon.com/es_es/AWSCloudFormation/latest/UserGuide/template-custom-resources.html"
      },
      {
        "@type" : "ListItem",
        "position" : 6,
        "name" : "Recursos personalizados y respaldados por AWS Lambda",
        "item" : "https://docs.aws.amazon.com/es_es/AWSCloudFormation/latest/UserGuide/template-custom-resources-lambda.html"
      },
      {
        "@type" : "ListItem",
        "position" : 7,
        "name" : "Tutorial: Búsqueda de ID de imagen de Amazon Machine",
        "item" : "https://docs.aws.amazon.com/es_es/AWSCloudFormation/latest/UserGuide/template-custom-resources-lambda.html"
      }
    ]
}
</script></head><body><div id="main"><div style="display: none"></div><div id="breadcrumbs" class="breadcrumb"><a href="https://aws.amazon.com">AWS</a><a href="/index.html">Documentación</a><a href="/cloudformation/index.html">AWS CloudFormation</a><a href="Welcome.html">Guía del usuario</a></div><div id="page-toc-src"><a href="#walkthrough-custom-resources-lambda-lookup-amiids-savesample">Paso 1: Descargar y guardar el paquete de ejemplo en Amazon S3</a><a href="#walkthrough-custom-resources-lambda-lookup-amiids-createfunction-createstack">Paso 2: Creación de la pila</a><a href="#walkthrough-custom-resources-lambda-lookup-amiids-createfunction-cleanup">Paso 3: Limpiar recursos</a><a href="#w9aac23c26c16b7c29">Información relacionada</a></div><div id="main-content" class="awsui-util-container"><div id="main-col-body"><awsdocs-language-banner data-service="$ctrl.pageService"></awsdocs-language-banner><h1 class="topictitle" id="walkthrough-custom-resources-lambda-lookup-amiids">Tutorial: Búsqueda de ID de imagen de Amazon Machine</h1><div class="awsdocs-page-header-container"><awsdocs-page-header></awsdocs-page-header><awsdocs-filter-selector id="awsdocs-filter-selector"></awsdocs-filter-selector></div><p>Las plantillas de AWS CloudFormation que declaren una instancia de Amazon Elastic Compute Cloud (Amazon EC2) también deben especificar un ID de imagen de máquina de Amazon (AMI) que incluya un sistema operativo y otra información de software y configuración que se use para lanzar la instancia. El ID de AMI correcto depende del tipo de instancia y la región en la que desea lanzar la pila. Y los ID pueden cambiar con regularidad, como cuando una AMI se actualiza con actualizaciones de software.</p><p>Normalmente, puede asignar los ID de AMI a determinados tipos de instancias y regiones. Para actualizar los ID, cámbielos manualmente en cada una de las plantillas. Mediante el uso de los recursos personalizados y AWS Lambda (Lambda), puede crear una función que obtiene el ID de las últimas AMI para la región y el tipo de instancia que está utilizando, para no tener que mantener asignaciones.</p><p>Este tutorial muestra cómo crear un recurso personalizado y asociarle una función de Lambda para buscar los ID de AMI. Tenga en cuenta que el tutorial presupone que entiende cómo utilizar Lambda y recursos personalizados. Para obtener más información, consulte <a href="./template-custom-resources.html">Recursos personalizados</a> o la <a href="https://docs.aws.amazon.com/lambda/latest/dg/">Guía para desarrolladores de AWS Lambda</a>.</p><p>Información general del tutorial</p><p>En este tutorial, creará una pila con un recurso personalizado, una función de Lambda y una instancia de EC2. El tutorial proporciona un código de ejemplo y una plantilla de ejemplo que utilizará para crear la pila.</p><p>La plantilla de ejemplo utiliza el tipo de recurso personalizado para invocar y enviar los valores de entrada a la función de Lambda. Al utilizar la plantilla, AWS CloudFormation invoca la función y le envía información como el tipo de solicitud, los datos de entrada y una URL de Amazon Simple Storage Service (Amazon S3) prefirmada. La función utiliza dicha información para consultar el ID de AMI y, a continuación, envía una respuesta a la URL prefirmada.</p><p>Una vez que AWS CloudFormation obtiene una respuesta en la ubicación de URL prefirmada, procede a crear la pila. Cuando AWS CloudFormation crea la instancia, utiliza la respuesta de la función de Lambda para especificar el ID de AMI de dicha instancia.</p><p>En la siguiente lista se resume el proceso. Se necesitan permisos de AWS Identity and Access Management (IAM) para utilizar todos los servicios correspondientes, como Lambda, Amazon EC2 y AWS CloudFormation.</p><div class="awsdocs-note"><div class="awsdocs-note-title"><awsui-icon name="status-info" variant="link"></awsui-icon><h6>nota</h6></div><div class="awsdocs-note-text"><p>AWS CloudFormation es un servicio gratuito; sin embargo, se le cobrará por los recursos de AWS, como la función de Lambda y la instancia de EC2, que incluya en las pilas según la tarifa actual de cada una. Para obtener más información sobre los precios de AWS, consulte la página de detalles correspondiente a cada producto en <a href="https://aws.amazon.com/" rel="noopener noreferrer" target="_blank"><span>http://aws.amazon.com</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a>.</p></div></div><div class="orderedlist">
     
     
     
  <ol><li>
      <p><a href="#walkthrough-custom-resources-lambda-lookup-amiids-savesample">Guarde el paquete Lambda de ejemplo en un bucket de Amazon Simple Storage Service (Amazon S3).</a></p>
      <p>El paquete de ejemplo contiene todo lo necesario para crear la función de Lambda. Debe guardar el paquete en un bucket que está en la misma región en la que creará la pila.</p>
    </li><li>
      <p><a href="#walkthrough-custom-resources-lambda-lookup-amiids-createfunction-createstack">Use la plantilla de ejemplo para crear una pila.</a></p>
      <p>La pila demuestra cómo asociar la función de Lambda con un recurso personalizado y cómo utilizar los resultados de la función para especificar un ID de AMI. La pila también crea un rol de IAM (rol de ejecución), que Lambda utiliza para realizar llamadas a Amazon EC2.</p>
    </li><li>
      <p><a href="#walkthrough-custom-resources-lambda-lookup-amiids-createfunction-cleanup">Elimina la pila.</a></p>
      <p>Elimine la pila para limpiar todos los recursos de la pila que creó para que no se le cobren los recursos innecesarios.</p>
    </li></ol></div><h2 id="walkthrough-custom-resources-lambda-lookup-amiids-savesample">Paso 1: Descargar y guardar el paquete de ejemplo en Amazon S3</h2>
    
    <p>Al crear una pila con una función de Lambda, debe especificar la ubicación del bucket de Amazon S3 que contiene el código fuente de la función. El bucket debe estar en la misma región en la que crea su pila.</p>
    <p>Este tutorial proporciona un paquete de ejemplo (un archivo <code>.zip</code>) que es necesario para crear la función de Lambda. Un paquete Lambda contiene el código fuente de la función y las bibliotecas necesarias. En este tutorial, la función no requiere bibliotecas adicionales.</p>
    <p>La función toma la región y la arquitectura de una instancia como entradas de una solicitud de recurso personalizado de AWS CloudFormation y devuelve los últimos ID de AMI a una URL de Amazon S3 prefirmada.</p>
    <div class="procedure"><h6>Para descargar y guardar el paquete en Amazon S3</h6><ol><li>
        <p>Descargue el paquete de ejemplo de Amazon S3. Cuando guarde el archivo, utilice el mismo nombre de archivo que la muestra <code>amilookup.zip</code> o <code>amilookup-win.zip</code>.</p>
        <div class="variablelist">
           
           
        <dl>
            <dt><b><span class="term">Buscar los ID de las AMI de Linux</span></b></dt>
            <dd>
              <p><a href="https://s3.amazonaws.com/cloudformation-examples/lambda/amilookup.zip" rel="noopener noreferrer" target="_blank"><span>https://s3.amazonaws.com/cloudformation-examples/lambda/amilookup.zip</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a></p>
            </dd>
          
            <dt><b><span class="term">Buscar los ID de las AMI de Windows</span></b></dt>
            <dd>
              <p><a href="https://s3.amazonaws.com/cloudformation-examples/lambda/amilookup-win.zip" rel="noopener noreferrer" target="_blank"><span>https://s3.amazonaws.com/cloudformation-examples/lambda/amilookup-win.zip</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a></p>
            </dd>
          </dl></div>
      </li><li>
        <p>Abra la consola de Amazon S3 en <a href="https://console.aws.amazon.com/s3/home" rel="noopener noreferrer" target="_blank"><span>https://console.aws.amazon.com/s3/home</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a>.</p>
      </li><li>
        <p>Elija o cree un bucket que se encuentre en la misma región en la que creará su pila de AWS CloudFormation. Registre el nombre del bucket.</p>
        <p>Guardará el paquete de ejemplo en este bucket. Para obtener más información acerca de la creación de un bucket, consulte <a href="https://docs.aws.amazon.com/AmazonS3/latest/user-guide/CreatingaBucket.html">Crear un bucket</a> en la <em>Guía del usuario de Amazon Simple Storage Service</em>.</p>
      </li><li>
        <p>Cargue el paquete de ejemplo al bucket que haya elegido o creado.</p>
        <p>Para obtener más información acerca de cómo cargar objetos, consulte <a href="https://docs.aws.amazon.com/AmazonS3/latest/user-guide/UploadingObjectsintoAmazonS3.html">Carga de objetos</a> en la <em>Guía del usuario de Amazon Simple Storage Service</em>.</p>
      </li></ol></div>
    <p>Con el paquete en Amazon S3, ahora puede especificar su ubicación en la declaración del recurso de Lambda de la plantilla de AWS CloudFormation. El siguiente paso demuestra cómo declarar la función e invocarla mediante un recurso personalizado. También observará cómo utilizar los resultados de la función para especificar el ID de AMI de una instancia de EC2.</p>
   
   <h2 id="walkthrough-custom-resources-lambda-lookup-amiids-createfunction-createstack">Paso 2: Creación de la pila</h2>
    
    <p>Para crear la pila de Amazon EC2 de ejemplo, utilizará una plantilla de ejemplo que incluya una función de Lambda, un rol de ejecución de IAM, un recurso personalizado que invoca la función y una instancia de EC2 que utilice los resultados de la función.</p>
    <p>Durante la creación de la pila, el recurso personalizado invoca la función de Lambda y espera hasta que la función envía una respuesta a la URL de Amazon S3 prefirmada. En la respuesta, la función devuelve el ID de la última AMI que se corresponda con el tipo de instancia de EC2 y la región en la que está creando la instancia. Los datos de la respuesta de la función se almacenan como un atributo del recurso personalizado, que se utiliza para especificar el ID de AMI de la instancia de EC2.</p>
    <p>Los siguientes fragmentos explican las partes importantes de la plantilla de ejemplo para ayudarle a entender cómo asociar una función de Lambda a un recurso personalizado y cómo utilizar la respuesta de la función.</p>
    <p>Para ver toda la plantilla de ejemplo, consulte:</p>
    <div class="variablelist">
       
       
    <dl>
        <dt><b><span class="term">Plantilla de Linux</span></b></dt>
        <dd>
          <p><a href="https://s3.amazonaws.com/cloudformation-examples/lambda/LambdaAMILookupSample.template" rel="noopener noreferrer" target="_blank"><span>https://s3.amazonaws.com/cloudformation-examples/lambda/LambdaAMILookupSample.template</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a></p>
        </dd>
      
        <dt><b><span class="term">Plantilla de Windows</span></b></dt>
        <dd>
          <p><a href="https://s3.amazonaws.com/cloudformation-examples/lambda/LambdaAMILookupSample-win.template" rel="noopener noreferrer" target="_blank"><span>https://s3.amazonaws.com/cloudformation-examples/lambda/LambdaAMILookupSample-win.template</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a></p>
        </dd>
      </dl></div>
    <p>Fragmentos de plantilla de pila</p>
    <p>Para crear la función de Lambda, declare el recurso <code class="code">AWS::Lambda::Function</code>, que requiere el código fuente de la función, el nombre del gestor, el entorno del tiempo de ejecución y el ARN del rol de ejecución.</p>
    <div class="example"><h6>ejemplo Sintaxis JSON</h6><div class="example-contents"><pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copiar"><awsui-icon name="copy"></awsui-icon></div></div><code class="json ">"AMIInfoFunction": <span>{</span>
  "Type": "AWS::Lambda::Function",
  "Properties": <span>{</span>
    "Code": <span>{</span>
      "S3Bucket": <span>{</span> "Ref": "S3Bucket" },
      "S3Key": <span>{</span> "Ref": "S3Key" }
    },
    "Handler": <span>{</span> "Fn::Join" : [ "", [<span>{</span> "Ref": "ModuleName" },".handler"] ] },
    "Runtime": "nodejs18.x",
    "Timeout": "30",
    "Role": <span>{</span> "Fn::GetAtt" : ["LambdaExecutionRole", "Arn"] }
  }
}</code></pre></div></div>
    <div class="example"><h6>ejemplo Sintaxis del YAML</h6><div class="example-contents"><pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copiar"><awsui-icon name="copy"></awsui-icon></div></div><code class="yaml ">AMIInfoFunction:
  Type: AWS::Lambda::Function
  Properties:
    Code:
      S3Bucket: !Ref S3Bucket
      S3Key: !Ref S3Key
    Handler: !Sub "$<span>{</span>ModuleName}.handler"
    Runtime: nodejs18.x
    Timeout: 30
    Role: !GetAtt LambdaExecutionRole.Arn</code></pre></div></div>
    <p>La propiedad <code class="code">Code</code> especifica la ubicación de Amazon S3 (nombre de bucket y de archivo) donde ha cargado el paquete de ejemplo. La plantilla de ejemplo utiliza parámetros de entrada (<code class="code">"Ref":
        "S3Bucket"</code> y <code class="code">"Ref": "S3Key"</code>) para establecer los nombres de bucket y archivo para poder especificar los nombres al crear la pila. Del mismo modo, el nombre del gestor, que se corresponde con el nombre del archivo de origen (el archivo JavaScript) en el paquete <code>.zip</code>, también utiliza un parámetro de entrada (<code class="code">"Ref":
        "ModuleName"</code>). Dado que el archivo de origen es un código JavaScript, se especifica el tiempo de ejecución como <code class="code">nodejs18.x</code>.</p>
    <p>En este tutorial, el tiempo de ejecución de la función supera el valor predeterminado de <code class="code">3</code> segundos, por lo que el tiempo de espera se establece en <code class="code">30</code> segundos. Si no especifica un tiempo de espera lo bastante largo, Lambda podría agotar dicho tiempo antes de que se complete la función, fracasando la creación de la pila.</p>
    <p>El rol de ejecución, que se declara en otra parte de la plantilla, se especifica usando la <code class="code">Fn::GetAtt</code> función intrínseca de la propiedad <code class="code">Role</code>. El rol de ejecución concede permiso a la función de Lambda para enviar registros a AWS y para llamar a la API <code class="code">DescribeImages</code> de EC2. El siguiente fragmento muestra el rol y la política que conceden el permiso correspondiente:</p>
    <div class="example"><h6>ejemplo Sintaxis JSON</h6><div class="example-contents"><pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copiar"><awsui-icon name="copy"></awsui-icon></div></div><code class="json ">"LambdaExecutionRole": <span>{</span>
  "Type": "AWS::IAM::Role",
  "Properties": <span>{</span>
    "AssumeRolePolicyDocument": <span>{</span>
      "Version": "2012-10-17",
      "Statement": [<span>{</span>
        "Effect": "Allow",
        "Principal": <span>{</span>"Service": ["lambda.amazonaws.com"]},
        "Action": ["sts:AssumeRole"]
      }]
    },
    "Path": "/",
    "Policies": [<span>{</span>
      "PolicyName": "root",
      "PolicyDocument": <span>{</span>
        "Version": "2012-10-17",
        "Statement": [<span>{</span>
          "Effect": "Allow",
          "Action": ["logs:CreateLogGroup","logs:CreateLogStream","logs:PutLogEvents"],
          "Resource": "arn:aws:logs:*:*:*"
        },
        <span>{</span>
          "Effect": "Allow",
          "Action": ["ec2:DescribeImages"],
          "Resource": "*"
        }]
      }
    }]
  }
}</code></pre></div></div>
    <div class="example"><h6>ejemplo Sintaxis del YAML</h6><div class="example-contents"><pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copiar"><awsui-icon name="copy"></awsui-icon></div></div><code class="yaml ">LambdaExecutionRole:
  Type: AWS::IAM::Role
  Properties:
    AssumeRolePolicyDocument:
      Version: '2012-10-17'
      Statement:
      - Effect: Allow
        Principal:
          Service:
          - lambda.amazonaws.com
        Action:
        - sts:AssumeRole
    Path: "/"
    Policies:
    - PolicyName: root
      PolicyDocument:
        Version: '2012-10-17'
        Statement:
        - Effect: Allow
          Action:
          - logs:CreateLogGroup
          - logs:CreateLogStream
          - logs:PutLogEvents
          Resource: arn:aws:logs:*:*:*
        - Effect: Allow
          Action:
          - ec2:DescribeImages
          Resource: "*"</code></pre></div></div>
    <p>Para las plantillas de Linux y Windows, el recurso personalizado invoca la función de Lambda que tiene asociada. Para asociar una función con un recurso personalizado, debe especificar el nombre de recurso de Amazon (ARN) de la función de la propiedad <code class="code">ServiceToken</code>, mediante la función intrínseca <code class="code">Fn::GetAtt</code>. AWS CloudFormation envía las propiedades adicionales que se incluyen en la declaración de los recursos personalizados, como <code class="code">Region</code> y <code class="code">Architecture</code>, a la función de Lambda como entradas. La función de Lambda determina los nombres y los valores correctos de estas propiedades de entrada.</p>
    <div class="example"><h6>ejemplo Sintaxis JSON</h6><div class="example-contents"><pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copiar"><awsui-icon name="copy"></awsui-icon></div></div><code class="json ">"AMIInfo": <span>{</span>
  "Type": "Custom::AMIInfo",
  "Properties": <span>{</span>
    "ServiceToken": <span>{</span> "Fn::GetAtt" : ["AMIInfoFunction", "Arn"] },
    "Region": <span>{</span> "Ref": "AWS::Region" },
    "Architecture": <span>{</span> "Fn::FindInMap" : [ "AWSInstanceType2Arch", <span>{</span> "Ref" : "InstanceType" }, "Arch" ] }
  }
}</code></pre></div></div>
    <div class="example"><h6>ejemplo Sintaxis del YAML</h6><div class="example-contents"><pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copiar"><awsui-icon name="copy"></awsui-icon></div></div><code class="yaml ">AMIInfo:
  Type: Custom::AMIInfo
  Properties:
    ServiceToken: !GetAtt AMIInfoFunction.Arn
    Region: !Ref "AWS::Region"
    Architecture:
      Fn::FindInMap:
      - AWSInstanceType2Arch
      - !Ref InstanceType
      - Arch</code></pre></div></div>
    <p>En el caso de Windows, el recurso personalizado proporciona la versión de Windows a la función de Lambda en lugar de la arquitectura de la instancia.</p>
    <div class="example"><h6>ejemplo Sintaxis JSON</h6><div class="example-contents"><pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copiar"><awsui-icon name="copy"></awsui-icon></div></div><code class="json ">"AMIInfo": <span>{</span>
  "Type": "Custom::AMIInfo",
  "Properties": <span>{</span>
    "ServiceToken": <span>{</span> "Fn::GetAtt" : ["AMIInfoFunction", "Arn"] },
    "Region": <span>{</span> "Ref": "AWS::Region" },
    "OSName": <span>{</span> "Ref": "WindowsVersion" }
  }
}</code></pre></div></div>
    <div class="example"><h6>ejemplo Sintaxis del YAML</h6><div class="example-contents"><pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copiar"><awsui-icon name="copy"></awsui-icon></div></div><code class="yaml ">AMIInfo:
  Type: Custom::AMIInfo
  Properties:
    ServiceToken: !GetAtt AMIInfoFunction.Arn
    Region: !Ref "AWS::Region"
    OSName: !Ref "WindowsVersion"</code></pre></div></div>
    <p>Cuando AWS CloudFormation invoca la función de Lambda, la función llama a la API <code class="code">DescribeImages</code> de EC2, que usa la región y la arquitectura de instancias o el nombre del sistema operativo para filtrar la lista de imágenes. A continuación, la función ordena la lista de imágenes por fecha y devuelve el ID de la AMI más reciente.</p>
    <p>Cuando devuelve el ID de la última AMI, la función envía el ID a una URL prefirmada en la propiedad <code class="code">Data</code> del <a href="./crpg-ref-responses.html">objeto de respuesta</a>. Los datos se estructuran como un par de nombre-valor, como se muestra en el ejemplo siguiente:</p>
    <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copiar"><awsui-icon name="copy"></awsui-icon></div></div><code class="json ">"Data": <span>{</span> 
  "Id": "ami-43795473"
}</code></pre>
    <p>El siguiente fragmento muestra cómo obtener los datos de una función de Lambda. Utiliza la función intrínseca <code class="code">Fn::GetAtt</code>, proporcionando el nombre del recurso personalizado y el nombre de atributo del valor que desee obtener. En este tutorial, el nombre del recurso personalizado es <code class="code">AMIInfo</code> y el nombre del atributo es <code class="code">Id</code>.</p>
    <div class="example"><h6>ejemplo Sintaxis JSON</h6><div class="example-contents"><pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copiar"><awsui-icon name="copy"></awsui-icon></div></div><code class="json ">"SampleInstance": <span>{</span>  
  "Type": "AWS::EC2::Instance",
  "Properties": <span>{</span>
    "InstanceType"   : <span>{</span> "Ref" : "InstanceType" },
    "ImageId": <span>{</span> "Fn::GetAtt": [ "AMIInfo", "Id" ] }
  }
}</code></pre></div></div>
    <div class="example"><h6>ejemplo Sintaxis del YAML</h6><div class="example-contents"><pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copiar"><awsui-icon name="copy"></awsui-icon></div></div><code class="yaml ">SampleInstance:
  Type: AWS::EC2::Instance
  Properties:
    InstanceType: !Ref InstanceType
    ImageId: !GetAtt AMIInfo.Id</code></pre></div></div>
    <p>Ahora que entiende lo que hace la plantilla, utilice la plantilla de ejemplo para crear una pila.</p>
    <div class="procedure"><h6>Para crear la pila </h6><ol><li>
        <p>Abra la consola de AWS CloudFormation en <a href="https://console.aws.amazon.com/cloudformation/" rel="noopener noreferrer" target="_blank"><span>https://console.aws.amazon.com/cloudformation/</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a>.</p>
      </li><li>
        <p>Elija <b>Crear pila</b>.</p>
      </li><li>
        <p>En la sección <b>Template (Plantilla)</b>, elija <b>Specify an Amazon S3 template URL (Especificar una URL de plantilla de Amazon S3)</b> y, a continuación, copie y pegue la siguiente URL en el cuadro de texto:</p>
        <div class="variablelist">
           
           
        <dl>
            <dt><b><span class="term">Plantilla de Linux</span></b></dt>
            <dd>
              <p><code class="code"><a href="https://s3.amazonaws.com/cloudformation-examples/lambda/LambdaAMILookupSample.template" rel="noopener noreferrer" target="_blank"><span>https://s3.amazonaws.com/cloudformation-examples/lambda/LambdaAMILookupSample.template</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a></code></p>
            </dd>
          
            <dt><b><span class="term">Plantilla de Windows</span></b></dt>
            <dd>
              <p><code class="code"><a href="https://s3.amazonaws.com/cloudformation-examples/lambda/LambdaAMILookupSample-win.template" rel="noopener noreferrer" target="_blank"><span>https://s3.amazonaws.com/cloudformation-examples/lambda/LambdaAMILookupSample-win.template</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a></code></p>
            </dd>
          </dl></div>
      </li><li>
        <p>Seleccione <b>Siguiente</b>.</p>
      </li><li>
        <p>En el campo <b>Stack name (Nombre de pila)</b>, escriba <code class="userinput">SampleEC2Instance</code>.</p>
      </li><li>
        <p>En la sección <b>Parameters (Parámetros)</b>, especifique el nombre del bucket de Amazon S3; que ha creado y, a continuación, elija <b>Next (Siguiente)</b>.</p>
        <p>Los valores predeterminados para el resto de los parámetros son los mismos nombres que se utilizan en el paquete <code>.zip</code> de ejemplo.</p>
      </li><li>
        <p>Para este tutorial, no tiene que añadir etiquetas ni especificar una configuración avanzada, así que elija <b>Next (Siguiente)</b>.</p>
      </li><li>
        <p>Asegúrese de que el nombre de la pila y la URL de la plantilla sean correctos y elija <b>Create (Crear)</b>.</p>
      </li></ol></div>
    <p>Podría llevarle varios minutos a AWS CloudFormation crear la pila. Para monitorizar el progreso, vea los eventos de la pila. Para obtener más información, consulte <a href="./cfn-console-view-stack-data-resources.html">Visualización de recursos y datos de la pila de AWS CloudFormation en la AWS Management Console</a>.</p>
    <p>Si se crea la pila correctamente, se crean todos los recursos de la pila, como la función de Lambda, el recurso personalizado y la instancia de EC2. Ha utilizado de forma satisfactoria una función de Lambda y un recurso personalizado para especificar el ID de AMI de una instancia de EC2. No es necesario crear y mantener un mapeo de los ID de AMI en esta plantilla.</p>
    <p>Para ver qué ID de AMI usó AWS CloudFormation para crear la instancia de EC2, vea las salidas de la pila.</p>
   <p>Si la función de Lambda devuelve un error, vea los registros de la función en la <a href="https://console.aws.amazon.com/cloudwatch/home#logs:" rel="noopener noreferrer" target="_blank"><span>consola</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a> de Amazon CloudWatch Logs. El nombre de la flujo de registros es el ID físico del recurso personalizado, que puede encontrar al visualizar los recursos de la pila. Para obtener más información, consulte la sección de <a href="https://docs.aws.amazon.com/AmazonCloudWatch/latest/logs/Working-with-log-groups-and-streams.html#ViewingLogData">visualización de datos de registro</a> en la <em>Guía del usuario de Amazon CloudWatch</em>.</p>
   
   <h2 id="walkthrough-custom-resources-lambda-lookup-amiids-createfunction-cleanup">Paso 3: Limpiar recursos</h2>
    
    <p>Para asegurarse de que no se le cobra por servicios no deseados, elimine la pila.</p>
    <div class="procedure"><h6>Para eliminar la pila</h6><ol><li>
        <p>En la consola de AWS CloudFormation, elija la pila <b>SampleEC2Instance</b>.</p>
      </li><li>
        <p>Elija <b>Actions (Acciones)</b> y, a continuación, <b>Delete Stack (Eliminar pila)</b>.</p>
      </li><li>
        <p>En el mensaje de confirmación, elija <b>Yes, Delete (Sí, eliminar)</b>.</p>
      </li></ol></div>
    <p>Se eliminan todos los recursos que creó.</p>
    <p>Ahora que entiende cómo crear y utilizar funciones de Lambda con AWS CloudFormation, puede usar el código y la plantilla de ejemplo de este tutorial para crear otras pilas y funciones.</p>
  <h2 id="w9aac23c26c16b7c29">Información relacionada</h2>
    
    <div class="itemizedlist">
       
    <ul class="itemizedlist"><li class="listitem">
        <p><a href="./crpg-ref.html">AWS CloudFormation Referencia de recursos personalizados</a></p>
      </li></ul></div>
  <awsdocs-copyright class="copyright-print"></awsdocs-copyright><awsdocs-thumb-feedback right-edge="{{$ctrl.thumbFeedbackRightEdge}}"></awsdocs-thumb-feedback></div><noscript><div><div><div><div id="js_error_message"><p><img src="https://d1ge0kk1l5kms0.cloudfront.net/images/G/01/webservices/console/warning.png" alt="Aviso" /> <strong>JavaScript está desactivado o no está disponible en su navegador.</strong></p><p>Para utilizar la documentación de AWS, debe estar habilitado JavaScript. Para obtener más información, consulte las páginas de ayuda de su navegador.</p></div></div></div></div></noscript><div id="main-col-footer" class="awsui-util-font-size-0"><div id="doc-conventions"><a target="_top" href="/general/latest/gr/docconventions.html">Convenciones del documento</a></div><div class="prev-next"><div id="previous" class="prev-link" accesskey="p" href="./template-custom-resources-lambda.html">Recursos personalizados y respaldados por AWS Lambda</div><div id="next" class="next-link" accesskey="n" href="./cfn-lambda-function-code-cfnresponsemodule.html">Módulo cfn-response</div></div></div><awsdocs-page-utilities></awsdocs-page-utilities></div><div id="quick-feedback-yes" style="display: none;"><div class="title">¿Le ha servido de ayuda esta página? - Sí</div><div class="content"><p>Gracias por hacernos saber que estamos haciendo un buen trabajo.</p><p>Si tiene un momento, díganos qué es lo que le ha gustado para que podamos seguir trabajando en esa línea.</p><p><awsui-button id="fblink" rel="noopener noreferrer" target="_blank" text="Comentarios" click="linkClick($event)" href="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=CloudFormation&amp;topic_url=https://docs.aws.amazon.com/es_es/AWSCloudFormation/latest/UserGuide/walkthrough-custom-resources-lambda-lookup-amiids.html"></awsui-button></p></div></div><div id="quick-feedback-no" style="display: none;"><div class="title">¿Le ha servido de ayuda esta página? - No</div><div class="content"><p>Gracias por informarnos de que debemos trabajar en esta página. Lamentamos haberle defraudado.</p><p>Si tiene un momento, díganos cómo podemos mejorar la documentación.</p><p><awsui-button id="fblink" rel="noopener noreferrer" target="_blank" text="Comentarios" click="linkClick($event)" href="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=CloudFormation&amp;topic_url=https://docs.aws.amazon.com/es_es/AWSCloudFormation/latest/UserGuide/walkthrough-custom-resources-lambda-lookup-amiids.html"></awsui-button></p></div></div></div></body></div></awsdocs-view><div class="page-loading-indicator" id="page-loading-indicator"><awsui-spinner size="large"></awsui-spinner></div></div><div id="tools-panel" dom-region="tools"><awsdocs-tools-panel id="awsdocs-tools-panel"></awsdocs-tools-panel></div></awsui-app-layout><awsdocs-cookie-banner class="doc-cookie-banner"></awsdocs-cookie-banner></div></body></html>