<!DOCTYPE html>
    <html xmlns="http://www.w3.org/1999/xhtml" lang="es-ES"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Creación de tablas externas para Redshift Spectrum - Amazon Redshift</title><meta name="viewport" content="width=device-width,initial-scale=1" /><meta name="assets_root" content="/assets" /><meta name="target_state" content="c-spectrum-external-tables" /><meta name="default_state" content="c-spectrum-external-tables" /><link rel="icon" type="image/ico" href="/assets/images/favicon.ico" /><link rel="shortcut icon" type="image/ico" href="/assets/images/favicon.ico" /><link rel="canonical" href="https://docs.aws.amazon.com/es_es/redshift/latest/dg/c-spectrum-external-tables.html" /><meta name="description" content="La tabla externa se crea en un esquema externo. Para crear tablas externas, debe ser el propietario del esquema externo o un superusuario. Para transferir la propiedad de un esquema externo, use para cambiar el propietario. En el siguiente ejemplo, se modifica el propietario del esquema" /><meta name="deployment_region" content="IAD" /><meta name="product" content="Amazon Redshift" /><meta name="guide" content="Guía para desarrolladores de bases de datos" /><meta name="abstract" content="Cree y administre un almacenamiento de datos con Amazon Redshift, un servicio de almacenamiento de datos completamente administrado a escala de petabytes de nivel empresarial." /><meta name="guide-locale" content="es_es" /><meta name="tocs" content="toc-contents.json" /><link rel="canonical" href="https://docs.aws.amazon.com/es_es/redshift/latest/dg/c-spectrum-external-tables.html" /><link rel="alternative" href="https://docs.aws.amazon.com/id_id/redshift/latest/dg/c-spectrum-external-tables.html" hreflang="id-id" /><link rel="alternative" href="https://docs.aws.amazon.com/id_id/redshift/latest/dg/c-spectrum-external-tables.html" hreflang="id" /><link rel="alternative" href="https://docs.aws.amazon.com/de_de/redshift/latest/dg/c-spectrum-external-tables.html" hreflang="de-de" /><link rel="alternative" href="https://docs.aws.amazon.com/de_de/redshift/latest/dg/c-spectrum-external-tables.html" hreflang="de" /><link rel="alternative" href="https://docs.aws.amazon.com/redshift/latest/dg/c-spectrum-external-tables.html" hreflang="en-us" /><link rel="alternative" href="https://docs.aws.amazon.com/redshift/latest/dg/c-spectrum-external-tables.html" hreflang="en" /><link rel="alternative" href="https://docs.aws.amazon.com/es_es/redshift/latest/dg/c-spectrum-external-tables.html" hreflang="es-es" /><link rel="alternative" href="https://docs.aws.amazon.com/es_es/redshift/latest/dg/c-spectrum-external-tables.html" hreflang="es" /><link rel="alternative" href="https://docs.aws.amazon.com/fr_fr/redshift/latest/dg/c-spectrum-external-tables.html" hreflang="fr-fr" /><link rel="alternative" href="https://docs.aws.amazon.com/fr_fr/redshift/latest/dg/c-spectrum-external-tables.html" hreflang="fr" /><link rel="alternative" href="https://docs.aws.amazon.com/it_it/redshift/latest/dg/c-spectrum-external-tables.html" hreflang="it-it" /><link rel="alternative" href="https://docs.aws.amazon.com/it_it/redshift/latest/dg/c-spectrum-external-tables.html" hreflang="it" /><link rel="alternative" href="https://docs.aws.amazon.com/ja_jp/redshift/latest/dg/c-spectrum-external-tables.html" hreflang="ja-jp" /><link rel="alternative" href="https://docs.aws.amazon.com/ja_jp/redshift/latest/dg/c-spectrum-external-tables.html" hreflang="ja" /><link rel="alternative" href="https://docs.aws.amazon.com/ko_kr/redshift/latest/dg/c-spectrum-external-tables.html" hreflang="ko-kr" /><link rel="alternative" href="https://docs.aws.amazon.com/ko_kr/redshift/latest/dg/c-spectrum-external-tables.html" hreflang="ko" /><link rel="alternative" href="https://docs.aws.amazon.com/pt_br/redshift/latest/dg/c-spectrum-external-tables.html" hreflang="pt-br" /><link rel="alternative" href="https://docs.aws.amazon.com/pt_br/redshift/latest/dg/c-spectrum-external-tables.html" hreflang="pt" /><link rel="alternative" href="https://docs.aws.amazon.com/zh_cn/redshift/latest/dg/c-spectrum-external-tables.html" hreflang="zh-cn" /><link rel="alternative" href="https://docs.aws.amazon.com/zh_tw/redshift/latest/dg/c-spectrum-external-tables.html" hreflang="zh-tw" /><link rel="alternative" href="https://docs.aws.amazon.com/redshift/latest/dg/c-spectrum-external-tables.html" hreflang="x-default" /><meta name="feedback-item" content="Redshift" /><meta name="this_doc_product" content="Amazon Redshift" /><meta name="this_doc_guide" content="Guía para desarrolladores de bases de datos" /><script defer="" src="/assets/r/vendor4.js?version=2021.12.02"></script><script defer="" src="/assets/r/vendor3.js?version=2021.12.02"></script><script defer="" src="/assets/r/vendor1.js?version=2021.12.02"></script><script defer="" src="/assets/r/awsdocs-common.js?version=2021.12.02"></script><script defer="" src="/assets/r/awsdocs-doc-page.js?version=2021.12.02"></script><link href="/assets/r/vendor4.css?version=2021.12.02" rel="stylesheet" /><link href="/assets/r/awsdocs-common.css?version=2021.12.02" rel="stylesheet" /><link href="/assets/r/awsdocs-doc-page.css?version=2021.12.02" rel="stylesheet" /><script async="" id="awsc-panorama-bundle" type="text/javascript" src="https://prod.pa.cdn.uis.awsstatic.com/panorama-nav-init.js" data-config="{'appEntity':'aws-documentation','region':'us-east-1','service':'redshift'}"></script><meta id="panorama-serviceSubSection" value="Guía para desarrolladores de bases de datos" /><meta id="panorama-serviceConsolePage" value="Creación de tablas externas para Redshift Spectrum" /></head><body class="awsdocs awsui"><div class="awsdocs-container"><awsdocs-header></awsdocs-header><awsui-app-layout id="app-layout" class="awsui-util-no-gutters" ng-controller="ContentController as $ctrl" header-selector="awsdocs-header" navigation-hide="false" navigation-width="$ctrl.navWidth" navigation-open="$ctrl.navOpen" navigation-change="$ctrl.onNavChange($event)" tools-hide="$ctrl.hideTools" tools-width="$ctrl.toolsWidth" tools-open="$ctrl.toolsOpen" tools-change="$ctrl.onToolsChange($event)"><div id="guide-toc" dom-region="navigation"><awsdocs-toc></awsdocs-toc></div><div id="main-column" dom-region="content" tabindex="-1"><awsdocs-view class="awsdocs-view"><div id="awsdocs-content"><head><title>Creación de tablas externas para Redshift Spectrum - Amazon Redshift</title><meta name="pdf" content="redshift-dg.pdf#c-spectrum-external-tables" /><meta name="rss" content="Dochistory.rss" /><meta name="forums" content="http://forums.aws.amazon.com/forum.jspa?forumID=155" /><meta name="feedback" content="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=Redshift&amp;topic_url=https://docs.aws.amazon.com/es_es/redshift/latest/dg/c-spectrum-external-tables.html" /><meta name="feedback-yes" content="feedbackyes.html?topic_url=https://docs.aws.amazon.com/es_es/redshift/latest/dg/c-spectrum-external-tables.html" /><meta name="feedback-no" content="feedbackno.html?topic_url=https://docs.aws.amazon.com/es_es/redshift/latest/dg/c-spectrum-external-tables.html" /><meta name="keywords" content="Amazon Redshift,AWS Redshift,Redshift,Redshift Spectrum,Clúster,almacenamiento de datos,desarrollador,datos de ejemplo,base de datos,desarrollador de base de datos,HLL" /><script type="application/ld+json">
{
    "@context" : "https://schema.org",
    "@type" : "BreadcrumbList",
    "itemListElement" : [
      {
        "@type" : "ListItem",
        "position" : 1,
        "name" : "AWS",
        "item" : "https://aws.amazon.com"
      },
      {
        "@type" : "ListItem",
        "position" : 2,
        "name" : "Amazon Redshift",
        "item" : "https://docs.aws.amazon.com/redshift/index.html"
      },
      {
        "@type" : "ListItem",
        "position" : 3,
        "name" : "Guía para desarrolladores de bases de datos",
        "item" : "https://docs.aws.amazon.com/es_es/redshift/latest/dg"
      },
      {
        "@type" : "ListItem",
        "position" : 4,
        "name" : "Consulta de datos externos mediante Amazon Redshift Spectrum",
        "item" : "https://docs.aws.amazon.com/es_es/redshift/latest/dg/c-using-spectrum.html"
      },
      {
        "@type" : "ListItem",
        "position" : 5,
        "name" : "Creación de tablas externas para Redshift Spectrum",
        "item" : "https://docs.aws.amazon.com/es_es/redshift/latest/dg/c-using-spectrum.html"
      }
    ]
}
</script></head><body><div id="main"><div style="display: none"><a href="redshift-dg.pdf#c-spectrum-external-tables" target="_blank" rel="noopener noreferrer" title="Abrir PDF"></a></div><div id="breadcrumbs" class="breadcrumb"><a href="https://aws.amazon.com">AWS</a><a href="/index.html">Documentación</a><a href="/redshift/index.html">Amazon Redshift</a><a href="welcome.html">Guía para desarrolladores de bases de datos</a></div><div id="page-toc-src"><a href="#c-spectrum-external-tables-pseudocolumns">Pseudocolumnas</a><a href="#c-spectrum-external-tables-partitioning">Partición de tablas externas de Redshift Spectrum</a><a href="#c-spectrum-column-mapping-orc">Asignación a columnas ORC</a><a href="#c-spectrum-column-mapping-hudi">Creación de tablas externas para datos administrados por Hudi</a><a href="#c-spectrum-column-mapping-delta">Creación de tablas externas para datos de Delta Lake</a></div><div id="main-content" class="awsui-util-container"><div id="main-col-body"><awsdocs-language-banner data-service="$ctrl.pageService"></awsdocs-language-banner><h1 class="topictitle" id="c-spectrum-external-tables">Creación de tablas externas para Redshift Spectrum</h1><div class="awsdocs-page-header-container"><awsdocs-page-header></awsdocs-page-header><awsdocs-filter-selector id="awsdocs-filter-selector"></awsdocs-filter-selector></div><p></p><p>La tabla externa se crea en un esquema externo. Para crear tablas externas, debe ser el propietario del esquema externo o un superusuario. Para transferir la propiedad de un esquema externo, use <a href="./r_ALTER_SCHEMA.html">ALTER SCHEMA</a> para cambiar el propietario. En el siguiente ejemplo, se modifica el propietario del esquema <code class="code">spectrum_schema</code> a <code class="code">newowner</code>.</p><pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copiar"><awsui-icon name="copy"></awsui-icon></div></div><code class="">alter schema spectrum_schema owner to newowner;</code></pre><p>Para ejecutar una consulta de Redshift Spectrum, necesita los siguientes permisos:</p><div class="itemizedlist">
          
          
      <ul class="itemizedlist"><li class="listitem">
            <p>Permiso de uso para el esquema </p>
         </li><li class="listitem">
            <p>Permiso para crear tablas temporales en la base de datos actual </p>
         </li></ul></div><p>En el siguiente ejemplo, se concede permiso de uso para el esquema <code class="code">spectrum_schema</code> al grupo de usuarios <code class="code">spectrumusers</code>.</p><pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copiar"><awsui-icon name="copy"></awsui-icon></div></div><code class="">grant usage on schema spectrum_schema to group spectrumusers;</code></pre><p>En el siguiente ejemplo, se concede un permiso temporal para la base de datos <code class="code">spectrumdb</code> al grupo de usuarios <code class="code">spectrumusers</code>. </p><pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copiar"><awsui-icon name="copy"></awsui-icon></div></div><code class="">grant temp on database spectrumdb to group spectrumusers;</code></pre><p>Puede crear una tabla externa en Amazon Redshift, AWS Glue, Amazon Athena o un metastore de Apache Hive. Para obtener más información, consulte <a href="https://docs.aws.amazon.com/glue/latest/dg/getting-started.html">Introducción al uso de AWS Glue</a> en la <em>Guía para desarrolladores de AWS Glue</em>, <a href="https://docs.aws.amazon.com/athena/latest/ug/getting-started.html">Introducción</a> en la <em>Guía del usuario de Amazon Athena</em>, o bien, <a href="https://docs.aws.amazon.com/emr/latest/ReleaseGuide/emr-hive.html">Apache Hive</a> en la <em>Guía para desarrolladores de Amazon EMR</em>. </p><p>Si la tabla externa se define en AWS Glue, Athena o un metastore de Hive, primero debe crear un esquema externo que referencie la base de datos externa. A continuación, puede referenciar la tabla externa en la instrucción SELECT al colocar como prefijo el nombre del esquema en el nombre de la tabla, sin que sea necesario crear la tabla en Amazon Redshift. Para obtener más información, consulte <a href="./c-spectrum-external-schemas.html">Creación de esquemas externos para Amazon Redshift Spectrum</a>. </p><p>Para permitir que Amazon Redshift visualice las tablas en el AWS Glue Data Catalog, agregue <code class="code">glue:GetTable</code> al rol de IAM de Amazon Redshift. De lo contrario, es posible que obtenga un error similar al siguiente.</p><pre class="programlisting"><div class="code-btn-container"></div><code class="nohighlight">RedshiftIamRoleSession is not authorized to perform: glue:GetTable on resource: *;</code></pre><p>Por ejemplo, supongamos que tiene una tabla externa denominada <code class="code">lineitem_athena</code> que está definida en un catálogo externo de Athena. En este caso, puede definir un esquema externo denominado <code class="code">athena_schema</code> y, luego, consultar la tabla utilizando la siguiente instrucción SELECT.</p><pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copiar"><awsui-icon name="copy"></awsui-icon></div></div><code class="">select count(*) from athena_schema.lineitem_athena;</code></pre><p>Para definir una tabla externa en Amazon Redshift, utilice el comando <a href="./r_CREATE_EXTERNAL_TABLE.html">CREATE EXTERNAL TABLE</a>. La instrucción de tabla externa define las columnas de la tabla, el formato de los archivos de datos y la ubicación de los datos en Amazon S3. Redshift Spectrum examina los archivos en la carpeta especificada y en cualquier subcarpeta. Redshift Spectrum ignora los archivos ocultos y los archivos que comienzan con un punto, un guion bajo o una marca hash ( . , _, o #) o que finalizan con una tilde (~). </p><p>En el siguiente ejemplo, se crea una tabla denominada SALES en el esquema externo <code class="code">spectrum</code> de Amazon Redshift. Los datos están en archivos de texto delimitados por tabulaciones.</p><pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copiar"><awsui-icon name="copy"></awsui-icon></div></div><code class="">create external table spectrum.sales(
salesid integer,
listid integer,
sellerid integer,
buyerid integer,
eventid integer,
dateid smallint,
qtysold smallint,
pricepaid decimal(8,2),
commission decimal(8,2),
saletime timestamp)
row format delimited
fields terminated by '\t'
stored as textfile
location 's3://redshift-downloads/tickit/spectrum/sales/'
table properties ('numRows'='172000');</code></pre><p>Para ver las tablas externas, consulte la vista del sistema <a href="./r_SVV_EXTERNAL_TABLES.html">SVV_EXTERNAL_TABLES</a>. </p>
         <h2 id="c-spectrum-external-tables-pseudocolumns">Pseudocolumnas</h2>

         
         <p>‎De forma predeterminada, Amazon Redshift crea tablas externas con las pseudocolumnas <code class="code">$path</code>, <code class="code">$size</code> y <code class="code">$spectrum_oid</code>. Seleccione la columna <code class="code">$path</code> para ver la ruta a los archivos de datos en Simple Storage Service (Amazon S3) y seleccione la columna <code class="code">$size</code> para ver el tamaño de los archivos de datos de cada fila devuelta por una consulta. La columna <code class="code">$spectrum_oid</code> proporciona la capacidad de realizar consultas correlacionadas con Redshift Spectrum. Para ver un ejemplo, consulte <a href="./c_performing-correlated-subqueries-spectrum.html">Ejemplo: Realización de subconsultas correlacionadas en Redshift Spectrum</a>. Debe delimitar los nombres de las columnas <code class="code">$path</code>, <code class="code">$size</code> y <code class="code">$spectrum_oid</code> con comillas dobles. Una cláusula SELECT * no devuelve las pseudocolumnas. Debe incluir explícitamente los nombres de columna <code class="code">$path</code>, <code class="code">$size</code> y‎ <code class="code">$spectrum_oid</code> en la consulta, tal y como se muestra en el siguiente ejemplo.</p>
         
         <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copiar"><awsui-icon name="copy"></awsui-icon></div></div><code class="SQL ">select "$path", "$size", "$spectrum_oid"
from spectrum.sales_part where saledate = '2008-12-01';</code></pre>
         
         <p>Puede desactivar la creación de pseudocolumnas para una sesión estableciendo el parámetro de configuración <code class="code">spectrum_enable_pseudo_columns</code> ‎en <code class="code">false</code>. Para obtener más información, consulte <a href="./r_spectrum_enable_pseudo_columns.html">spectrum_enable_pseudo_columns</a>. También puede desactivar solo la pseudocolumna <code class="code">$spectrum_oid</code> configurando <code class="code">enable_spectrum_oid</code> en <code class="code">false</code>. Para obtener más información, consulte <a href="./r_spectrum_enable_spectrum_oid.html">enable_spectrum_oid</a>. Sin embargo, desactivar la pseudocolumna <code class="code">$spectrum_oid</code> también desactiva la compatibilidad con consultas correlacionadas con Redshift Spectrum.</p>
         <div class="awsdocs-note awsdocs-important"><div class="awsdocs-note-title"><awsui-icon name="status-warning" variant="error"></awsui-icon><h6>importante</h6></div><div class="awsdocs-note-text"><p>‎Si se selecciona <code class="code">$size</code>, <code class="code">$path</code> o <code class="code">$spectrum_oid</code>, se aplicarán cargos, ya que Redshift Spectrum analiza los archivos de datos de Simple Storage Service (Amazon S3) para determinar el tamaño del conjunto de resultados. Para obtener más información, consulte <a href="https://aws.amazon.com/redshift/pricing/" rel="noopener noreferrer" target="_blank"><span>Precios de Amazon Redshift</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a>.</p></div></div>
          
            <h3 id="c-spectrum-external-tables-pseudocolumns-example">Ejemplo de pseudocolumnas</h3>

            <p>El siguiente ejemplo devuelve el tamaño total de los archivos de datos relacionados de una tabla externa.</p>
            <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copiar"><awsui-icon name="copy"></awsui-icon></div></div><code class="">select distinct "$path", "$size"
from spectrum.sales_part;

 $path                                                                    | $size
--------------------------------------------------------------------------+-------
s3://redshift-downloads/tickit/spectrum/sales_partition/saledate=2008-01/ |  1616
s3://redshift-downloads/tickit/spectrum/sales_partition/saledate=2008-02/ |  1444
s3://redshift-downloads/tickit/spectrum/sales_partition/saledate=2008-03/ |  1644</code></pre>
          
       
         <h2 id="c-spectrum-external-tables-partitioning">Partición de tablas externas de Redshift Spectrum</h2>

         <p>Cuando particiona datos, puede restringir la cantidad de datos que Redshift Spectrum examina al filtrar mediante una clave de partición. Puede particionar datos por cualquier clave. </p>
         <p>Una práctica habitual es particionar datos según el tiempo. Por ejemplo, puede seleccionar particionar por año, mes, fecha y hora. Si tiene datos que vienen de distintos orígenes, puede particionar por identificador de origen de datos y fecha. </p>
         <p>En el siguiente procedimiento, se describe cómo particionar datos.</p>
         <div class="procedure"><h6>Pasos para particionar datos</h6><ol><li>
               <p>Almacene los datos en carpetas en Amazon S3 según la clave de partición. </p>
               <p>Cree una carpeta para cada valor de partición y nombre esa carpeta con la clave de partición y el valor. Por ejemplo, si particiona por fecha, puede tener carpetas que se llamen <code class="code">saledate=2017-04-01</code>, <code class="code">saledate=2017-04-02</code> y, así, sucesivamente. Redshift Spectrum examina los archivos en la carpeta de la partición y en todas las subcarpetas. Redshift Spectrum ignora los archivos ocultos y los archivos que comienzan con un punto, un guion bajo o una marca hash ( . , _, o #) o que finalizan con una tilde (~). </p>

            </li><li>
               <p>Cree una tabla externa y especifique la clave de partición en la cláusula PARTITIONED BY. </p>
               <p>La clave de partición no puede ser el nombre de una columna de tabla. Los tipos de datos pueden ser SMALLINT, INTEGER, BIGINT, DECIMAL, REAL, DOUBLE PRECISION, BOOLEAN, CHAR, VARCHAR, DATE o TIMESTAMP. </p>
            </li><li>
               <p>Agregue las particiones. </p>
               <p>Agregue cada una de las particiones con <a href="./r_ALTER_TABLE.html">ALTER TABLE</a> … ADD PARTITION y especifique el valor de clave y la columna de partición, así como la ubicación de la carpeta de partición en Amazon S3. Puede agregar múltiples particiones en una única instrucción ALTER TABLE … ADD. En el siguiente ejemplo, se agregan particiones para <code class="code">'2008-01'</code> y <code class="code">'2008-03'</code>.</p>
               <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copiar"><awsui-icon name="copy"></awsui-icon></div></div><code class="">alter table spectrum.sales_part add
partition(saledate='2008-01-01') 
location 's3://redshift-downloads/tickit/spectrum/sales_partition/saledate=2008-01/'
partition(saledate='2008-03-01') 
location 's3://redshift-downloads/tickit/spectrum/sales_partition/saledate=2008-03/';</code></pre>
               <div class="awsdocs-note"><div class="awsdocs-note-title"><awsui-icon name="status-info" variant="link"></awsui-icon><h6>nota</h6></div><div class="awsdocs-note-text"><p>Si usa el catálogo de AWS Glue, puede agregar hasta 100 particiones mediante una única instrucción ALTER TABLE.</p></div></div>
            </li></ol></div>

          
            <h3 id="c-spectrum-external-tables-partitioning-example">Ejemplos de partición de datos</h3>


            <p>En este ejemplo, se crea una tabla externa que está particionada por una sola clave de partición y una tabla externa que está particionada por dos claves de partición.</p>

            <p>Los datos de muestra para este ejemplo se encuentran en un bucket de Amazon S3 que brinda acceso de lectura a todos los usuarios autenticados de AWS. El clúster y los archivos de datos externos deben estar en la misma Región de AWS. El bucket de datos de muestra está en la región Este de EE. UU. (Norte de Virginia) (us-east-1). Para obtener acceso a los datos utilizando Redshift Spectrum, el clúster también debe estar en us-east-2. Para que se muestren las carpetas en Amazon S3, ejecute los siguientes comandos.</p>
            <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copiar"><awsui-icon name="copy"></awsui-icon></div></div><code class="">aws s3 ls s3://redshift-downloads/tickit/spectrum/sales_partition/</code></pre>
            <pre class="screen">PRE saledate=2008-01/
PRE saledate=2008-03/
PRE saledate=2008-04/
PRE saledate=2008-05/
PRE saledate=2008-06/
PRE saledate=2008-12/</pre>
            <p>Si aún no tiene un esquema externo, ejecute el siguiente comando. Sustituya el nombre de recurso de Amazon (ARN) para su rol de AWS Identity and Access Management (IAM).</p>
            <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copiar"><awsui-icon name="copy"></awsui-icon></div></div><code class="">create external schema spectrum
from data catalog
database 'spectrumdb'
iam_role 'arn:aws:iam::123456789012:role/myspectrumrole'
create external database if not exists;</code></pre>
             
               <h4 id="c-spectrum-external-tables-single-partition-example">Ejemplo 1: Particionar con una sola clave de partición</h4>
               <p>En el siguiente ejemplo, se crea una tabla externa que se particiona por mes.</p>
               <p>Para crear una tabla externa particionada por mes, ejecute el siguiente comando.</p>
               <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copiar"><awsui-icon name="copy"></awsui-icon></div></div><code class="">create external table spectrum.sales_part(
salesid integer,
listid integer,
sellerid integer,
buyerid integer,
eventid integer,
dateid smallint,
qtysold smallint,
pricepaid decimal(8,2),
commission decimal(8,2),
saletime timestamp)
partitioned by (saledate char(10))
row format delimited
fields terminated by '|'
stored as textfile
location 's3://redshift-downloads/tickit/spectrum/sales_partition/'
table properties ('numRows'='172000');</code></pre>
               <p>Para agregar las particiones, ejecute el siguiente comando ALTER TABLE.</p>
               <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copiar"><awsui-icon name="copy"></awsui-icon></div></div><code class="">alter table spectrum.sales_part add
partition(saledate='2008-01') 
location 's3://redshift-downloads/tickit/spectrum/sales_partition/saledate=2008-01/'

partition(saledate='2008-03') 
location 's3://redshift-downloads/tickit/spectrum/sales_partition/saledate=2008-03/'

partition(saledate='2008-04') 
location 's3://redshift-downloads/tickit/spectrum/sales_partition/saledate=2008-04/';</code></pre>
               <p>Para seleccionar los datos de la tabla particionada, ejecute la siguiente consulta.</p>
               <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copiar"><awsui-icon name="copy"></awsui-icon></div></div><code class="">select top 5 spectrum.sales_part.eventid, sum(spectrum.sales_part.pricepaid) 
from spectrum.sales_part, event
where spectrum.sales_part.eventid = event.eventid
  and spectrum.sales_part.pricepaid &gt; 30
  and saledate = '2008-01'
group by spectrum.sales_part.eventid
order by 2 desc;</code></pre>

               <pre class="screen">eventid | sum     
--------+---------
   4124 | 21179.00
   1924 | 20569.00
   2294 | 18830.00
   2260 | 17669.00
   6032 | 17265.00</pre>
               <p>Para ver particiones de la tabla externa, consulte la vista del sistema <a href="./r_SVV_EXTERNAL_PARTITIONS.html">SVV_EXTERNAL_PARTITIONS</a>.</p>
               <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copiar"><awsui-icon name="copy"></awsui-icon></div></div><code class="">select schemaname, tablename, values, location from svv_external_partitions
where tablename = 'sales_part';</code></pre>

               <pre class="screen">schemaname | tablename  | values      | location                                                                
-----------+------------+-------------+-------------------------------------------------------------------------
spectrum   | sales_part | ["2008-01"] | s3://redshift-downloads/tickit/spectrum/sales_partition/saledate=2008-01
spectrum   | sales_part | ["2008-03"] | s3://redshift-downloads/tickit/spectrum/sales_partition/saledate=2008-03
spectrum   | sales_part | ["2008-04"] | s3://redshift-downloads/tickit/spectrum/sales_partition/saledate=2008-04</pre>
             
             
               <h4 id="c-spectrum-external-tables-multi-partition-example">Ejemplo 2: Particionar con varias claves de partición</h4>

               <p>Para crear una tabla externa particionada por <code class="code">date</code> y <code class="code">eventid</code>, ejecute el siguiente comando.</p>
               <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copiar"><awsui-icon name="copy"></awsui-icon></div></div><code class="">create external table spectrum.sales_event(
salesid integer,
listid integer,
sellerid integer,
buyerid integer,
eventid integer,
dateid smallint,
qtysold smallint,
pricepaid decimal(8,2),
commission decimal(8,2),
saletime timestamp)
partitioned by (salesmonth char(10), event integer)
row format delimited
fields terminated by '|'
stored as textfile
location 's3://redshift-downloads/tickit/spectrum/salesevent/'
table properties ('numRows'='172000');</code></pre>
               <p>Para agregar las particiones, ejecute el siguiente comando ALTER TABLE.</p>
               <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copiar"><awsui-icon name="copy"></awsui-icon></div></div><code class="">alter table spectrum.sales_event add
partition(salesmonth='2008-01', event='101') 
location 's3://redshift-downloads/tickit/spectrum/salesevent/salesmonth=2008-01/event=101/'

partition(salesmonth='2008-01', event='102') 
location 's3://redshift-downloads/tickit/spectrum/salesevent/salesmonth=2008-01/event=102/'

partition(salesmonth='2008-01', event='103') 
location 's3://redshift-downloads/tickit/spectrum/salesevent/salesmonth=2008-01/event=103/'

partition(salesmonth='2008-02', event='101') 
location 's3://redshift-downloads/tickit/spectrum/salesevent/salesmonth=2008-02/event=101/'

partition(salesmonth='2008-02', event='102') 
location 's3://redshift-downloads/tickit/spectrum/salesevent/salesmonth=2008-02/event=102/'

partition(salesmonth='2008-02', event='103') 
location 's3://redshift-downloads/tickit/spectrum/salesevent/salesmonth=2008-02/event=103/'

partition(salesmonth='2008-03', event='101') 
location 's3://redshift-downloads/tickit/spectrum/salesevent/salesmonth=2008-03/event=101/'

partition(salesmonth='2008-03', event='102') 
location 's3://redshift-downloads/tickit/spectrum/salesevent/salesmonth=2008-03/event=102/'

partition(salesmonth='2008-03', event='103') 
location 's3://redshift-downloads/tickit/spectrum/salesevent/salesmonth=2008-03/event=103/';</code></pre>
               <p>Ejecute la siguiente consulta para seleccionar los datos de la tabla particionada.</p>
               <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copiar"><awsui-icon name="copy"></awsui-icon></div></div><code class="">select spectrum.sales_event.salesmonth, event.eventname, sum(spectrum.sales_event.pricepaid) 
from spectrum.sales_event, event
where spectrum.sales_event.eventid = event.eventid
  and salesmonth = '2008-02'
	and (event = '101'
	or event = '102'
	or event = '103')
group by event.eventname, spectrum.sales_event.salesmonth
order by 3 desc;</code></pre>
               <pre class="screen">salesmonth | eventname       | sum    
-----------+-----------------+--------
2008-02    | The Magic Flute | 5062.00
2008-02    | La Sonnambula   | 3498.00
2008-02    | Die Walkure     |  534.00</pre>
             
          
       
         <h2 id="c-spectrum-column-mapping-orc">Asignación de columnas de tablas externas a columnas ORC</h2>
         <p>Las tablas externas de Amazon Redshift Spectrum se utilizan para consultar datos que están en archivos con formato ORC. El formato ORC (Optimized Row Columnar) es un archivo de almacenamiento organizado en columnas que admite estructuras de datos anidadas. Para obtener más información sobre la consulta de datos anidados, consulte <a href="./tutorial-query-nested-data.html#tutorial-nested-data-overview">Consultas de datos anidados con Amazon Redshift Spectrum</a>. </p>
         <p>Cuando crea una tabla externa que hace referencia a datos de un archivo ORC, debe asignar cada columna de la tabla externa a una columna de los datos de ORC. Para ello, puede utilizar uno de los siguientes métodos:</p>
         <div class="itemizedlist">
             
             
         <ul class="itemizedlist"><li class="listitem">
               <p><a href="#orc-mapping-by-position">Asignación por posición</a></p>
            </li><li class="listitem">
               <p><a href="#orc-mapping-by-name">Asignación por nombre de columna</a> </p>
            </li></ul></div>
         <p>La asignación por nombre de columna es el valor predeterminado. </p>
          
            <h3 id="orc-mapping-by-position">Asignación por posición</h3>
            <p>En la asignación por posición, la primera columna definida en la tabla externa se asigna a la primera columna del archivo de datos de ORC y lo mismo ocurre con la segunda, la tercera, etc. En la asignación por posición, es necesario que el orden de las columnas de la tabla externa y del archivo ORC coincidan. Si el orden no coincide, puede asignar las columnas por nombre. </p>
            <div class="awsdocs-note awsdocs-important"><div class="awsdocs-note-title"><awsui-icon name="status-warning" variant="error"></awsui-icon><h6>importante</h6></div><div class="awsdocs-note-text"><p>En versiones anteriores, Redshift Spectrum utilizaba la asignación por posición de manera predeterminada. Si necesita seguir utilizando la asignación por posición en las tablas existentes, establezca la propiedad <code class="code">orc.schema.resolution</code> de la tabla en <code class="code">position</code>, tal y como se muestra en el siguiente ejemplo. </p><pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copiar"><awsui-icon name="copy"></awsui-icon></div></div><code class="">alter table spectrum.orc_example 
set table properties('orc.schema.resolution'='position'); </code></pre></div></div>
            <p>Por ejemplo, la tabla <code class="code">SPECTRUM.ORC_EXAMPLE</code> se define del modo siguiente. </p>
            <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copiar"><awsui-icon name="copy"></awsui-icon></div></div><code class="">create external table spectrum.orc_example(
int_col int,
float_col float,
nested_col struct&lt;
  "int_col" : int,
  "map_col" : map&lt;int, array&lt;float &gt;&gt;
   &gt;
) stored as orc
location 's3://example/orc/files/';</code></pre>
            <p>La estructura de la tabla puede abstraerse tal y como se muestra a continuación. </p>
            <pre class="screen">• 'int_col' : int
• 'float_col' : float
• 'nested_col' : struct
   o 'int_col' : int
   o 'map_col' : map
      - key : int
      - value : array
         - value : float</pre>
            <p>El archivo ORC subyacente tiene la siguiente estructura de archivos.</p>
            <pre class="screen">• ORC file root(id = 0)
   o 'int_col' : int (id = 1)
   o 'float_col' : float (id = 2)
   o 'nested_col' : struct (id = 3)
      - 'int_col' : int (id = 4)
      - 'map_col' : map (id = 5)
         - key : int (id = 6)
         - value : array (id = 7)
            - value : float (id = 8)</pre>
            <p>En este ejemplo, puede asignar cada columna de la tabla externa a una columna del archivo ORC exclusivamente por posición. En el siguiente ejemplo, se muestra la asignación.</p>

            <div class="table-container"><div class="table-contents"><table id="w319aac29c19c45c11c21"><thead>
                     <tr>
                        <th>Nombre de columna de la tabla externa</th>
                        <th>ID de columna ORC</th>
                        <th>Nombre de columna ORC</th>
                     </tr>
                  </thead>
                     <tr>
                        <td tabindex="-1">int_col</td>
                        <td tabindex="-1">1</td>
                        <td tabindex="-1">int_col</td>
                     </tr>
                     <tr>
                        <td tabindex="-1">float_col</td>
                        <td tabindex="-1">2</td>
                        <td tabindex="-1">float_col</td>
                     </tr>
                     <tr>
                        <td tabindex="-1">nested_col</td>
                        <td tabindex="-1">3</td>
                        <td tabindex="-1">nested_col</td>
                     </tr>
                     <tr>
                        <td tabindex="-1">nested_col.int_col</td>
                        <td tabindex="-1">4</td>
                        <td tabindex="-1">int_col</td>
                     </tr>
                     <tr>
                        <td tabindex="-1">nested_col.map_col</td>
                        <td tabindex="-1">5</td>
                        <td tabindex="-1">map_col</td>
                     </tr>
                     <tr>
                        <td tabindex="-1">nested_col.map_col.key</td>
                        <td tabindex="-1">6</td>
                        <td tabindex="-1">N/D</td>
                     </tr>
                     <tr>
                        <td tabindex="-1">nested_col.map_col.value</td>
                        <td tabindex="-1">7</td>
                        <td tabindex="-1">N/D</td>
                     </tr>
                     <tr>
                        <td tabindex="-1">nested_col.map_col.value.item</td>
                        <td tabindex="-1">8</td>
                        <td tabindex="-1">N/D</td>
                     </tr>
                  </table></div></div>
          
          
            <h3 id="orc-mapping-by-name">Asignación por nombre de columna</h3>
            <p>En la asignación por nombre, las columnas de una tabla externa se asignan a columnas de los archivos ORC del mismo nivel que tienen el mismo nombre. </p>
            <p>Por ejemplo, supongamos que desea asignar la tabla del ejemplo anterior, <code class="code">SPECTRUM.ORC_EXAMPLE</code>, a un archivo ORC que utiliza la siguiente estructura de archivos.</p>
            <pre class="screen">• ORC file root(id = 0)
   o 'nested_col' : struct (id = 1)
      - 'map_col' : map (id = 2)
         - key : int (id = 3)
         - value : array (id = 4)
            - value : float (id = 5)
      - 'int_col' : int (id = 6)
   o 'int_col' : int (id = 7)
   o 'float_col' : float (id = 8)</pre>

            <p>Con la asignación por posición, Redshift Spectrum intentaría realizar la siguiente asignación. </p>
            <div class="table-container"><div class="table-contents"><table id="w319aac29c19c45c13c11"><thead>
                     <tr>
                        <th>Nombre de columna de la tabla externa</th>
                        <th>ID de columna ORC</th>
                        <th>Nombre de columna ORC</th>
                     </tr>
                  </thead>
                     <tr>
                        <td tabindex="-1">int_col</td>
                        <td tabindex="-1">1</td>
                        <td tabindex="-1">struct</td>
                     </tr>
                     <tr>
                        <td tabindex="-1">float_col</td>
                        <td tabindex="-1">7</td>
                        <td tabindex="-1">int_col</td>
                     </tr>
                     <tr>
                        <td tabindex="-1">nested_col</td>
                        <td tabindex="-1">8</td>
                        <td tabindex="-1">float_col</td>
                     </tr>
                  </table></div></div>
            <p>Si consulta una tabla con la asignación por posición anterior, el comando SELECT no realiza correctamente la validación de tipos porque las estructuras son diferentes. </p>
            <p>Puede asignar la misma tabla externa a las dos estructuras de archivos que se muestran en los ejemplos anteriores utilizando la asignación por nombre de columna. Las columnas <code class="code">int_col</code>, <code class="code">float_col</code> y <code class="code">nested_col</code> de la tabla se asignan por nombre a las columnas del archivo ORC que tienen el mismo nombre. La columna <code class="code">nested_col</code> se la tabla externa es una columna <code class="code">struct</code> con las subcolumnas <code class="code">map_col</code> e <code class="code">int_col</code>. Las subcolumnas también se asignan correctamente a las columnas correspondientes del archivo ORC a través del nombre. </p>

          
       
      <h2 id="c-spectrum-column-mapping-hudi">Creación de tablas externas para datos administrados en Apache Hudi</h2>
      <p>Si desea realizar consultas de datos en formato de copia en escritura (Copy On Write, CoW) de Apache Hudi, puede emplear las tablas externas de Amazon Redshift Spectrum. Una tabla de copia en escritura de Hudi consiste en una colección de archivos Apache Parquet almacenados en Amazon S3. Puede leer tablas de copia al escribir (CoW) en las versiones 0.5.2, 0.6.0, 0.7.0, 0.8.0, 0.9.0, 0.10.0, 0.10.1, 0.11.0 y 0,11.1 de Apache Hudi que se crean y modifican con las operaciones de escritura insert, delete y upsert. Por ejemplo, no se admiten tablas de arranque. Para obtener más información, consulte <a href="https://hudi.apache.org/docs/next/table_types#copy-on-write-table" rel="noopener noreferrer" target="_blank"><span>Tabla de copia en escritura</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a> en la documentación de Apache Hudi de código abierto. </p>
      <p>Cuando se crea una tabla externa que referencia datos en formato CoW de Hudi, se debe asignar cada columna de la tabla externa a una columna de los datos Hudi. La asignación se realiza por columna. </p>

      <p>Las instrucciones del lenguaje de definición de datos (DDL) para las tablas de Hudi con o sin partición se asemejan a las correspondientes a otros formatos de archivo Apache Parquet. En el caso de las tablas de Hudi, se define <code class="code">INPUTFORMAT</code> como <code class="code">org.apache.hudi.hadoop.HoodieParquetInputFormat</code>. El parámetro <code class="code">LOCATION</code> debe apuntar a la carpeta base de la tabla de Hudi que contiene la carpeta <code class="code">.hoodie</code>, la cual es necesaria para establecer la línea de tiempo de confirmación de Hudi. En algunos casos, una operación SELECT en una tabla de Hudi podría presentar un error y mostrar el mensaje <strong class="errortext"><code>No valid Hudi commit timeline found</code></strong> (No se encontró ninguna línea de tiempo de confirmación de Hudi válida). En ese caso, verifique si la carpeta <code class="code">.hoodie</code> se encuentra en la ubicación correcta y contiene una línea de tiempo de confirmación de Hudi válida. </p>
      <div class="awsdocs-note"><div class="awsdocs-note-title"><awsui-icon name="status-info" variant="link"></awsui-icon><h6>nota</h6></div><div class="awsdocs-note-text"><p>El formato de Apache Hudi solo se admite cuando se utiliza un AWS Glue Data Catalog. No se admite cuando se utiliza un metastore de Apache Hive como el catálogo externo. </p></div></div>
      <p>El DDL que permite definir una tabla sin partición presenta el siguiente formato. </p>
      <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copiar"><awsui-icon name="copy"></awsui-icon></div></div><code class="sql ">CREATE EXTERNAL TABLE <em>tbl_name</em> (<em>columns</em>)
ROW FORMAT SERDE 'org.apache.hadoop.hive.ql.io.parquet.serde.ParquetHiveSerDe'
STORED AS
INPUTFORMAT 'org.apache.hudi.hadoop.HoodieParquetInputFormat'
OUTPUTFORMAT 'org.apache.hadoop.hive.ql.io.parquet.MapredParquetOutputFormat'
LOCATION 's3://<em>s3-bucket</em>/<em>prefix</em>'</code></pre>
      <p>El DDL que permite definir una tabla con partición presenta el siguiente formato. </p>
      <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copiar"><awsui-icon name="copy"></awsui-icon></div></div><code class="sql ">CREATE EXTERNAL TABLE <em>tbl_name</em> (<em>columns</em>)
PARTITIONED BY(<em>pcolumn1</em> <em>pcolumn1-type</em>[,...])
ROW FORMAT SERDE 'org.apache.hadoop.hive.ql.io.parquet.serde.ParquetHiveSerDe'
STORED AS
INPUTFORMAT 'org.apache.hudi.hadoop.HoodieParquetInputFormat'
OUTPUTFORMAT 'org.apache.hadoop.hive.ql.io.parquet.MapredParquetOutputFormat'
LOCATION 's3://<em>s3-bucket</em>/<em>prefix</em>'</code></pre>
      <p>Para agregar particiones a una tabla de Hudi con partición, ejecute un comando ALTER TABLE ADD PARTITION en el que el parámetro <code class="code">LOCATION</code> apunte a la subcarpeta de Amazon S3 que contiene los archivos que pertenecen a la partición.</p>
      <p>El DDL que permite agregar particiones presenta el siguiente formato.</p>
      <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copiar"><awsui-icon name="copy"></awsui-icon></div></div><code class="sql ">ALTER TABLE <em>tbl_name</em>
ADD IF NOT EXISTS PARTITION(<em>pcolumn1</em>=<em>pvalue1</em>[,...])
LOCATION 's3://<em>s3-bucket</em>/<em>prefix</em>/<em>partition-path</em>'</code></pre>
    
      <h2 id="c-spectrum-column-mapping-delta">Creación de tablas externas para datos administrados en Delta Lake</h2>
      <p>Si desea realizar consultas sobre los datos de las tablas de Delta Lake, puede utilizar las tablas externas de Amazon Redshift Spectrum. </p>
         <p>Si desea obtener acceso a una tabla de Delta Lake desde Redshift Spectrum, debe generar un manifiesto antes de realizar la consulta. Un <em>manifiesto</em> de Delta Lake contiene un listado de los archivos que conforman una instantánea consistente de la tabla de Delta Lake. En una tabla con partición, hay un manifiesto por cada partición. Una tabla de Delta Lake consiste en una colección de archivos Apache Parquet almacenados en Amazon S3. Para obtener más información, consulte <a href="https://delta.io" rel="noopener noreferrer" target="_blank"><span>Delta Lake</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a> en la documentación de Delta Lake de código abierto. </p>
      <p>Cuando se crea una tabla externa que referencia los datos de las tablas de Delta Lake, se asigna cada columna de la tabla externa a una de las columnas de la tabla de Delta Lake. La asignación se realiza por nombre de columna. </p>
      
      <p>El DDL para las tablas con o sin partición de Delta Lake se asemeja al correspondiente a otros formatos de archivo Apache Parquet. En el caso de las tablas de Delta Lake, define <code class="code">INPUTFORMAT</code> como <code class="code">org.apache.hadoop.hive.ql.io.SymlinkTextInputFormat</code> y <code class="code">OUTPUTFORMAT</code> como <code class="code">org.apache.hadoop.hive.ql.io.HiveIgnoreKeyTextOutputFormat</code>. El parámetro <code class="code">LOCATION</code> debe apuntar a la carpeta del manifiesto en la carpeta base de la tabla. Si se produce un error en una operación SELECT de una tabla de Delta Lake, consulte <a href="#c-spectrum-column-mapping-delta-limitations">Limitaciones y solución de problemas de las tablas de Delta Lake</a> para obtener información sobre los posibles motivos. </p>
      <p>El DDL que permite definir una tabla sin partición presenta el siguiente formato. </p>
      <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copiar"><awsui-icon name="copy"></awsui-icon></div></div><code class="sql ">CREATE EXTERNAL TABLE <em>tbl_name</em> (<em>columns</em>)
ROW FORMAT SERDE 'org.apache.hadoop.hive.ql.io.parquet.serde.ParquetHiveSerDe'
STORED AS
INPUTFORMAT 'org.apache.hadoop.hive.ql.io.SymlinkTextInputFormat'
OUTPUTFORMAT 'org.apache.hadoop.hive.ql.io.HiveIgnoreKeyTextOutputFormat'
LOCATION 's3://<em>s3-bucket</em>/<em>prefix</em>/_symlink_format_manifest'</code></pre>
      <p>El DDL que permite definir una tabla con partición presenta el siguiente formato. </p>
      <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copiar"><awsui-icon name="copy"></awsui-icon></div></div><code class="sql ">CREATE EXTERNAL TABLE <em>tbl_name</em> (<em>columns</em>)
PARTITIONED BY(<em>pcolumn1</em> <em>pcolumn1-type</em>[,...])
ROW FORMAT SERDE 'org.apache.hadoop.hive.ql.io.parquet.serde.ParquetHiveSerDe'
STORED AS
INPUTFORMAT 'org.apache.hadoop.hive.ql.io.SymlinkTextInputFormat'
OUTPUTFORMAT 'org.apache.hadoop.hive.ql.io.HiveIgnoreKeyTextOutputFormat'
LOCATION 's3://<em>s3-bucket</em>&gt;/<em>prefix</em>/_symlink_format_manifest'</code></pre>
      <p>Si desea agregar particiones a una tabla de Delta Lake con partición, ejecute un comando ALTER TABLE ADD PARTITION en el que el parámetro <code class="code">LOCATION</code> apunte a la subcarpeta de Amazon S3 que contiene el manifiesto de la partición.</p>
      <p>El DDL que permite agregar particiones presenta el siguiente formato.</p>
      <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copiar"><awsui-icon name="copy"></awsui-icon></div></div><code class="sql ">ALTER TABLE <em>tbl_name</em>
ADD IF NOT EXISTS PARTITION(<em>pcolumn1</em>=<em>pvalue1</em>[,...])
LOCATION
's3://<em>s3-bucket</em>/<em>prefix</em>/_symlink_format_manifest/<em>partition-path</em>'</code></pre>
      <p>También puede ejecutar un DDL que apunte directamente al archivo de manifiesto de Delta Lake.</p>
      <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copiar"><awsui-icon name="copy"></awsui-icon></div></div><code class="sql ">ALTER TABLE <em>tbl_name</em>
ADD IF NOT EXISTS PARTITION(<em>pcolumn1</em>=<em>pvalue1</em>[,...])
LOCATION
's3://<em>s3-bucket</em>/<em>prefix</em>/_symlink_format_manifest/<em>partition-path</em>/manifest'</code></pre>
      
       
         <h3 id="c-spectrum-column-mapping-delta-limitations">Limitaciones y solución de problemas de las tablas de Delta Lake</h3>
       
      <p>Cuando consulte las tablas de Delta Lake desde Redshift Spectrum, tenga en cuenta lo siguiente:</p>
      <div class="itemizedlist">
          
          
      <ul class="itemizedlist"><li class="listitem"><p>Si un manifiesto apunta a una instantánea o una partición que ya no existe, se producen errores en las consultas hasta que se genere un nuevo manifiesto válido. Por ejemplo, esto podría suceder con una operación VACUUM en la tabla subyacente.</p></li><li class="listitem"><p>Los manifiestos de Delta Lake solo proporcionan consistencia en el nivel de la partición. </p></li></ul></div>
      <p>En la siguiente tabla, se explican algunos de los posibles motivos por los cuales se producen ciertos errores cuando se consulta una tabla de Delta Lake. </p>
      <div class="table-container"><div class="table-contents"><table id="w319aac29c19c49c37"><thead>
               <tr>
                  <th>Mensaje de error</th>
                  <th>Posible motivo</th>
               </tr>
            </thead>
               
               
               <tr>
                  <td tabindex="-1"><p><strong class="errortext"><code>El manifiesto de Delta Lake en el bucket <em>s3-bucket-1</em> no puede contener entradas en el bucket <em>s3-bucket-2</em>.</code></strong></p></td>
                  <td tabindex="-1"><p>Las entradas del manifiesto apuntan a archivos en un bucket de Amazon S3 distinto al especificado. </p></td>
               </tr>
               <tr>
                  <td tabindex="-1"><p><strong class="errortext"><code>Se espera que los archivos de Delta Lake se encuentren en la misma carpeta.</code></strong></p></td>
                  <td tabindex="-1"><p>Las entradas del manifiesto apuntan a archivos que poseen un prefijo de Amazon S3 distinto al especificado.</p></td>
               </tr>
               <tr>
                  <td tabindex="-1"><p><strong class="errortext"><code>No se ha encontrado el archivo <em>nombre del archivo</em> que aparece en el manifiesto <em>ruta de manifiesto</em> de Delta Lake.</code></strong></p></td>
                  <td tabindex="-1"><p>No se encontró en Amazon S3 un archivo incluido en el manifiesto. </p></td>
               </tr>
               <tr>
                  <td tabindex="-1"><p><strong class="errortext"><code>Se produjo un error en la recuperación del manifiesto de Delta Lake.</code></strong></p></td>
                  <td tabindex="-1"><p>No se encontró el manifiesto en Amazon S3. </p></td>
               </tr>
               <tr>
                  <td tabindex="-1"><p><strong class="errortext"><code>La ruta de S3 no es válida.</code></strong></p></td>
                  <td tabindex="-1"><p>Una entrada en el archivo de manifiesto no constituye una ruta válida de Amazon S3, o bien, se ha dañado el archivo de manifiesto. </p></td>
               </tr>

            </table></div></div>
      
   <awsdocs-copyright class="copyright-print"></awsdocs-copyright><awsdocs-thumb-feedback right-edge="{{$ctrl.thumbFeedbackRightEdge}}"></awsdocs-thumb-feedback></div><noscript><div><div><div><div id="js_error_message"><p><img src="https://d1ge0kk1l5kms0.cloudfront.net/images/G/01/webservices/console/warning.png" alt="Aviso" /> <strong>JavaScript está desactivado o no está disponible en su navegador.</strong></p><p>Para utilizar la documentación de AWS, debe estar habilitado JavaScript. Para obtener más información, consulte las páginas de ayuda de su navegador.</p></div></div></div></div></noscript><div id="main-col-footer" class="awsui-util-font-size-0"><div id="doc-conventions"><a target="_top" href="/general/latest/gr/docconventions.html">Convenciones del documento</a></div><div class="prev-next"><div id="previous" class="prev-link" accesskey="p" href="./c-spectrum-external-schemas.html">Creación de esquemas externos</div><div id="next" class="next-link" accesskey="n" href="./querying-iceberg.html">Uso de tablas de Apache Iceberg</div></div></div><awsdocs-page-utilities></awsdocs-page-utilities></div><div id="quick-feedback-yes" style="display: none;"><div class="title">¿Le ha servido de ayuda esta página? - Sí</div><div class="content"><p>Gracias por hacernos saber que estamos haciendo un buen trabajo.</p><p>Si tiene un momento, díganos qué es lo que le ha gustado para que podamos seguir trabajando en esa línea.</p><p><awsui-button id="fblink" rel="noopener noreferrer" target="_blank" text="Comentarios" click="linkClick($event)" href="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=Redshift&amp;topic_url=https://docs.aws.amazon.com/es_es/redshift/latest/dg/c-spectrum-external-tables.html"></awsui-button></p></div></div><div id="quick-feedback-no" style="display: none;"><div class="title">¿Le ha servido de ayuda esta página? - No</div><div class="content"><p>Gracias por informarnos de que debemos trabajar en esta página. Lamentamos haberle defraudado.</p><p>Si tiene un momento, díganos cómo podemos mejorar la documentación.</p><p><awsui-button id="fblink" rel="noopener noreferrer" target="_blank" text="Comentarios" click="linkClick($event)" href="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=Redshift&amp;topic_url=https://docs.aws.amazon.com/es_es/redshift/latest/dg/c-spectrum-external-tables.html"></awsui-button></p></div></div></div></body></div></awsdocs-view><div class="page-loading-indicator" id="page-loading-indicator"><awsui-spinner size="large"></awsui-spinner></div></div><div id="tools-panel" dom-region="tools"><awsdocs-tools-panel id="awsdocs-tools-panel"></awsdocs-tools-panel></div></awsui-app-layout><awsdocs-cookie-banner class="doc-cookie-banner"></awsdocs-cookie-banner></div></body></html>