<!DOCTYPE html>
    <html xmlns="http://www.w3.org/1999/xhtml" lang="es-ES"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Errores de captura - Amazon Redshift</title><meta name="viewport" content="width=device-width,initial-scale=1" /><meta name="assets_root" content="/assets" /><meta name="target_state" content="stored-procedure-trapping-errors" /><meta name="default_state" content="stored-procedure-trapping-errors" /><link rel="icon" type="image/ico" href="/assets/images/favicon.ico" /><link rel="shortcut icon" type="image/ico" href="/assets/images/favicon.ico" /><link rel="canonical" href="https://docs.aws.amazon.com/es_es/redshift/latest/dg/stored-procedure-trapping-errors.html" /><meta name="description" content="Capture errores en un procedimiento almacenado en Amazon Redshift." /><meta name="deployment_region" content="IAD" /><meta name="product" content="Amazon Redshift" /><meta name="guide" content="Guía para desarrolladores de bases de datos" /><meta name="abstract" content="Cree y administre un almacenamiento de datos con Amazon Redshift, un servicio de almacenamiento de datos completamente administrado a escala de petabytes de nivel empresarial." /><meta name="guide-locale" content="es_es" /><meta name="tocs" content="toc-contents.json" /><link rel="canonical" href="https://docs.aws.amazon.com/es_es/redshift/latest/dg/stored-procedure-trapping-errors.html" /><link rel="alternative" href="https://docs.aws.amazon.com/id_id/redshift/latest/dg/stored-procedure-trapping-errors.html" hreflang="id-id" /><link rel="alternative" href="https://docs.aws.amazon.com/id_id/redshift/latest/dg/stored-procedure-trapping-errors.html" hreflang="id" /><link rel="alternative" href="https://docs.aws.amazon.com/de_de/redshift/latest/dg/stored-procedure-trapping-errors.html" hreflang="de-de" /><link rel="alternative" href="https://docs.aws.amazon.com/de_de/redshift/latest/dg/stored-procedure-trapping-errors.html" hreflang="de" /><link rel="alternative" href="https://docs.aws.amazon.com/redshift/latest/dg/stored-procedure-trapping-errors.html" hreflang="en-us" /><link rel="alternative" href="https://docs.aws.amazon.com/redshift/latest/dg/stored-procedure-trapping-errors.html" hreflang="en" /><link rel="alternative" href="https://docs.aws.amazon.com/es_es/redshift/latest/dg/stored-procedure-trapping-errors.html" hreflang="es-es" /><link rel="alternative" href="https://docs.aws.amazon.com/es_es/redshift/latest/dg/stored-procedure-trapping-errors.html" hreflang="es" /><link rel="alternative" href="https://docs.aws.amazon.com/fr_fr/redshift/latest/dg/stored-procedure-trapping-errors.html" hreflang="fr-fr" /><link rel="alternative" href="https://docs.aws.amazon.com/fr_fr/redshift/latest/dg/stored-procedure-trapping-errors.html" hreflang="fr" /><link rel="alternative" href="https://docs.aws.amazon.com/it_it/redshift/latest/dg/stored-procedure-trapping-errors.html" hreflang="it-it" /><link rel="alternative" href="https://docs.aws.amazon.com/it_it/redshift/latest/dg/stored-procedure-trapping-errors.html" hreflang="it" /><link rel="alternative" href="https://docs.aws.amazon.com/ja_jp/redshift/latest/dg/stored-procedure-trapping-errors.html" hreflang="ja-jp" /><link rel="alternative" href="https://docs.aws.amazon.com/ja_jp/redshift/latest/dg/stored-procedure-trapping-errors.html" hreflang="ja" /><link rel="alternative" href="https://docs.aws.amazon.com/ko_kr/redshift/latest/dg/stored-procedure-trapping-errors.html" hreflang="ko-kr" /><link rel="alternative" href="https://docs.aws.amazon.com/ko_kr/redshift/latest/dg/stored-procedure-trapping-errors.html" hreflang="ko" /><link rel="alternative" href="https://docs.aws.amazon.com/pt_br/redshift/latest/dg/stored-procedure-trapping-errors.html" hreflang="pt-br" /><link rel="alternative" href="https://docs.aws.amazon.com/pt_br/redshift/latest/dg/stored-procedure-trapping-errors.html" hreflang="pt" /><link rel="alternative" href="https://docs.aws.amazon.com/zh_cn/redshift/latest/dg/stored-procedure-trapping-errors.html" hreflang="zh-cn" /><link rel="alternative" href="https://docs.aws.amazon.com/zh_tw/redshift/latest/dg/stored-procedure-trapping-errors.html" hreflang="zh-tw" /><link rel="alternative" href="https://docs.aws.amazon.com/redshift/latest/dg/stored-procedure-trapping-errors.html" hreflang="x-default" /><meta name="feedback-item" content="Redshift" /><meta name="this_doc_product" content="Amazon Redshift" /><meta name="this_doc_guide" content="Guía para desarrolladores de bases de datos" /><script defer="" src="/assets/r/vendor4.js?version=2021.12.02"></script><script defer="" src="/assets/r/vendor3.js?version=2021.12.02"></script><script defer="" src="/assets/r/vendor1.js?version=2021.12.02"></script><script defer="" src="/assets/r/awsdocs-common.js?version=2021.12.02"></script><script defer="" src="/assets/r/awsdocs-doc-page.js?version=2021.12.02"></script><link href="/assets/r/vendor4.css?version=2021.12.02" rel="stylesheet" /><link href="/assets/r/awsdocs-common.css?version=2021.12.02" rel="stylesheet" /><link href="/assets/r/awsdocs-doc-page.css?version=2021.12.02" rel="stylesheet" /><script async="" id="awsc-panorama-bundle" type="text/javascript" src="https://prod.pa.cdn.uis.awsstatic.com/panorama-nav-init.js" data-config="{'appEntity':'aws-documentation','region':'us-east-1','service':'redshift'}"></script><meta id="panorama-serviceSubSection" value="Guía para desarrolladores de bases de datos" /><meta id="panorama-serviceConsolePage" value="Errores de captura" /></head><body class="awsdocs awsui"><div class="awsdocs-container"><awsdocs-header></awsdocs-header><awsui-app-layout id="app-layout" class="awsui-util-no-gutters" ng-controller="ContentController as $ctrl" header-selector="awsdocs-header" navigation-hide="false" navigation-width="$ctrl.navWidth" navigation-open="$ctrl.navOpen" navigation-change="$ctrl.onNavChange($event)" tools-hide="$ctrl.hideTools" tools-width="$ctrl.toolsWidth" tools-open="$ctrl.toolsOpen" tools-change="$ctrl.onToolsChange($event)"><div id="guide-toc" dom-region="navigation"><awsdocs-toc></awsdocs-toc></div><div id="main-column" dom-region="content" tabindex="-1"><awsdocs-view class="awsdocs-view"><div id="awsdocs-content"><head><title>Errores de captura - Amazon Redshift</title><meta name="pdf" content="redshift-dg.pdf#stored-procedure-trapping-errors" /><meta name="rss" content="Dochistory.rss" /><meta name="forums" content="http://forums.aws.amazon.com/forum.jspa?forumID=155" /><meta name="feedback" content="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=Redshift&amp;topic_url=https://docs.aws.amazon.com/es_es/redshift/latest/dg/stored-procedure-trapping-errors.html" /><meta name="feedback-yes" content="feedbackyes.html?topic_url=https://docs.aws.amazon.com/es_es/redshift/latest/dg/stored-procedure-trapping-errors.html" /><meta name="feedback-no" content="feedbackno.html?topic_url=https://docs.aws.amazon.com/es_es/redshift/latest/dg/stored-procedure-trapping-errors.html" /><meta name="keywords" content="Amazon Redshift,AWS Redshift,Redshift,Redshift Spectrum,Clúster,almacenamiento de datos,desarrollador,datos de ejemplo,base de datos,desarrollador de base de datos,HLL" /><script type="application/ld+json">
{
    "@context" : "https://schema.org",
    "@type" : "BreadcrumbList",
    "itemListElement" : [
      {
        "@type" : "ListItem",
        "position" : 1,
        "name" : "AWS",
        "item" : "https://aws.amazon.com"
      },
      {
        "@type" : "ListItem",
        "position" : 2,
        "name" : "Amazon Redshift",
        "item" : "https://docs.aws.amazon.com/redshift/index.html"
      },
      {
        "@type" : "ListItem",
        "position" : 3,
        "name" : "Guía para desarrolladores de bases de datos",
        "item" : "https://docs.aws.amazon.com/es_es/redshift/latest/dg"
      },
      {
        "@type" : "ListItem",
        "position" : 4,
        "name" : "Creación de procedimientos almacenados en Amazon Redshift",
        "item" : "https://docs.aws.amazon.com/es_es/redshift/latest/dg/stored-procedure-overview.html"
      },
      {
        "@type" : "ListItem",
        "position" : 5,
        "name" : "Información general de procedimientos almacenados en Amazon Redshift",
        "item" : "https://docs.aws.amazon.com/es_es/redshift/latest/dg/stored-procedure-create.html"
      },
      {
        "@type" : "ListItem",
        "position" : 6,
        "name" : "Errores de captura",
        "item" : "https://docs.aws.amazon.com/es_es/redshift/latest/dg/stored-procedure-create.html"
      }
    ]
}
</script></head><body><div id="main"><div style="display: none"><a href="redshift-dg.pdf#stored-procedure-trapping-errors" target="_blank" rel="noopener noreferrer" title="Abrir PDF"></a></div><div id="breadcrumbs" class="breadcrumb"><a href="https://aws.amazon.com">AWS</a><a href="/index.html">Documentación</a><a href="/redshift/index.html">Amazon Redshift</a><a href="welcome.html">Guía para desarrolladores de bases de datos</a></div><div id="page-toc-src"><a href="#stored-procedure-trapping-errors-examples">Ejemplo</a></div><div id="main-content" class="awsui-util-container"><div id="main-col-body"><awsdocs-language-banner data-service="$ctrl.pageService"></awsdocs-language-banner><h1 class="topictitle" id="stored-procedure-trapping-errors">Errores de captura</h1><div class="awsdocs-page-header-container"><awsdocs-page-header></awsdocs-page-header><awsdocs-filter-selector id="awsdocs-filter-selector"></awsdocs-filter-selector></div><p>Cuando una consulta o un comando de un procedimiento almacenado provoca un error, las consultas posteriores no se ejecutan y la transacción se revierte. Puede administrar errores mediante un bloque EXCEPTION.</p><div class="awsdocs-note"><div class="awsdocs-note-title"><awsui-icon name="status-info" variant="link"></awsui-icon><h6>nota</h6></div><div class="awsdocs-note-text"><p>El comportamiento predeterminado es que un error provocará que las consultas posteriores no se ejecuten, aunque no haya condiciones adicionales que generen errores en el procedimiento almacenado.</p></div></div><pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copiar"><awsui-icon name="copy"></awsui-icon></div></div><code class="nohighlight">[ &lt;&lt;label&gt;&gt; ]
[ DECLARE
  declarations ]
BEGIN
  statements
EXCEPTION
  WHEN OTHERS THEN
    statements
END;   
</code></pre><p>Cuando se produce una excepción y agrega un bloque de manejo de excepciones, puede escribir instrucciones RAISE y la mayoría de las demás instrucciones PL/PgSQL. Por ejemplo, puede generar una excepción con un mensaje personalizado o insertar un registro en una tabla de registro.</p><p>Al ingresar el bloque de manejo de excepciones, la transacción actual se revierte y se crea una nueva transacción para ejecutar las instrucciones en el bloque. Si las instrucciones en el bloque se ejecutan sin errores, la transacción se confirma y se vuelve a lanzar la excepción. Por último, se cierra el procedimiento almacenado.</p><p>La única condición admitida en un bloque de excepciones es OTHERS, que se asocia a cada tipo de error excepto la cancelación de la consulta. Además, si se produce un error en un bloque de manejo de excepciones, este puede ser capturado por un bloque de manejo de excepciones externo.</p><p>Cuando se produce un error en el procedimiento NONATOMIC, el error no se vuelve a generar si se gestiona mediante un bloque de excepciones. Consulte la instrucción <code class="code">RAISE</code> de PL/pgSQL para generar una excepción detectada por el bloque de gestión de excepciones. Esta instrucción solo es válida en bloques de gestión de excepciones. Para obtener más información, consulte <a href="./c_PLpgSQL-statements.html#r_PLpgSQL-messages-errors">RAISE</a>.</p><p><b>Controlar lo que ocurre después de un error en un procedimiento almacenado con el controlador CONTINUE</b></p><p> El controlador <code class="code">CONTINUE</code> es un tipo de controlador de excepciones que supervisa el flujo de ejecución dentro de un procedimiento almacenado NONATOMIC. Al usarlo, puede atrapar y administrar excepciones sin finalizar el bloque de instrucciones existente. Normalmente, cuando se produce un error en un procedimiento almacenado, el flujo se interrumpe y el error se devuelve a quien llama. Sin embargo, en algunos casos prácticos, la condición de error no es lo suficientemente grave como para justificar la interrupción del flujo. Se recomienda gestionar el error de forma adecuada, utilizando la lógica de gestión de errores que elija en una transacción independiente y, a continuación, seguir ejecutando instrucciones que sigan al error. A continuación se muestra la sintaxis. </p><pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copiar"><awsui-icon name="copy"></awsui-icon></div></div><code class="nohighlight">[ DECLARE
  declarations ]
BEGIN
  statements
EXCEPTION
  [ CONTINUE_HANDLER | EXIT_HANDLER ] WHEN OTHERS THEN
    handler_statements
END;   
</code></pre><p>Existen varias tablas del sistema que le ayudarán a recopilar información sobre los distintos tipos de errores. Para más información, consulte <a href="./r_STL_LOAD_ERRORS.html">STL_LOAD_ERRORS</a>, <a href="./r_STL_ERROR.html">STL_ERROR</a> y <a href="./r_SYS_STREAM_SCAN_ERRORS.html">SYS_STREAM_SCAN_ERRORS</a>. También hay tablas adicionales del sistema que puede utilizar para solucionar errores. Encontrará más información al respecto en <a href="./cm_chap_system-tables.html">Referencia de las tablas y vistas de sistema</a>.</p>
        <h2 id="stored-procedure-trapping-errors-examples">Ejemplo</h2>
     <p>En el siguiente ejemplo se muestra cómo escribir instrucciones en el bloque de manejo de excepciones. El procedimiento almacenado utiliza el comportamiento de administración de transacciones predeterminado.</p>
<pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copiar"><awsui-icon name="copy"></awsui-icon></div></div><code class="">CREATE TABLE employee (firstname varchar, lastname varchar);
INSERT INTO employee VALUES ('Tomas','Smith');
CREATE TABLE employee_error_log (message varchar);

CREATE OR REPLACE PROCEDURE update_employee_sp() AS
$$
BEGIN
    UPDATE employee SET firstname = 'Adam' WHERE lastname = 'Smith';
    EXECUTE 'select invalid';
EXCEPTION WHEN OTHERS THEN
    RAISE INFO 'An exception occurred.';
    INSERT INTO employee_error_log VALUES ('Error message: ' || SQLERRM);
END;
$$ 
LANGUAGE plpgsql;

CALL update_employee_sp();

INFO:  An exception occurred.
ERROR:  column "invalid" does not exist
CONTEXT:  SQL statement "select invalid"
PL/pgSQL function "update_employee_sp" line 3 at execute statement</code></pre>
     <p>En este ejemplo, si llamamos a <code class="code">update_employee_sp</code>, el mensaje informativo <em>Se ha producido una excepción.</em> se genera y el mensaje de error se inserta en la tabla de registro del registro <code class="code">employee_error_log</code>. La excepción original se vuelve a lanzar antes de que finalice el procedimiento almacenado. En las consultas siguientes, se muestran los registros resultantes de la ejecución del ejemplo.</p>
<pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copiar"><awsui-icon name="copy"></awsui-icon></div></div><code class="">SELECT * from employee;

firstname | lastname 
-----------+----------
 Tomas     | Smith

SELECT * from employee_error_log;

          message                     
------------------------------------------------
 Error message: column "invalid" does not exist</code></pre>   
        <p>Para obtener más información acerca de RAISE, incluida la ayuda sobre el formato, junto con una lista de niveles adicionales, consulte <a href="./c_PLpgSQL-statements.html">Instrucciones de PL/pgSQL admitidas</a>.</p>
     <p>En el siguiente ejemplo se muestra cómo escribir instrucciones en el bloque de manejo de excepciones. El procedimiento almacenado utiliza el comportamiento de administración de transacciones NONATOMIC. En este ejemplo, no se devuelve ningún error al autor de la llamada una vez finalizada la llamada al procedimiento. La instrucción UPDATE no se revierte debido al error en la instrucción siguiente. Se genera un mensaje informativo y se inserta el mensaje de error en la tabla de registro.</p><pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copiar"><awsui-icon name="copy"></awsui-icon></div></div><code class="nohighlight">CREATE TABLE employee (firstname varchar, lastname varchar); 
INSERT INTO employee VALUES ('Tomas','Smith'); 
CREATE TABLE employee_error_log (message varchar);

-- Create the SP in NONATOMIC mode
CREATE OR REPLACE PROCEDURE update_employee_sp_2() NONATOMIC AS
$$
BEGIN
    UPDATE employee SET firstname = 'Adam' WHERE lastname = 'Smith';
    EXECUTE 'select invalid';
EXCEPTION WHEN OTHERS THEN
    RAISE INFO 'An exception occurred.';
    INSERT INTO employee_error_log VALUES ('Error message: ' || SQLERRM);
END;
$$ 
LANGUAGE plpgsql;

CALL update_employee_sp_2();
INFO:  An exception occurred.
CALL

SELECT * from employee;

 firstname | lastname 
-----------+----------
 Adam      | Smith
(1 row)

SELECT * from employee_error_log;

                    message                     
------------------------------------------------
 Error message: column "invalid" does not exist
(1 row)
</code></pre><p>En este ejemplo, se muestra cómo crear un procedimiento con dos bloques secundarios. Cuando se llama al procedimiento almacenado, el error del primer bloque secundario se gestiona mediante su bloque de gestión de excepciones. Una vez completado el primer bloque secundario, el procedimiento continúa con la ejecución del segundo bloque secundario. Puede ver en el resultado que no se produce ningún error cuando se completa la llamada al procedimiento. Se confirman las operaciones UPDATE e INSERT en la tabla employee. Los mensajes de error de ambos bloques de excepciones se insertan en la tabla de registro.</p><pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copiar"><awsui-icon name="copy"></awsui-icon></div></div><code class="nohighlight">CREATE TABLE employee (firstname varchar, lastname varchar); 
INSERT INTO employee VALUES ('Tomas','Smith'); 
CREATE TABLE employee_error_log (message varchar);

CREATE OR REPLACE PROCEDURE update_employee_sp_3() NONATOMIC AS
$$
BEGIN
    BEGIN
        UPDATE employee SET firstname = 'Adam' WHERE lastname = 'Smith';
        EXECUTE 'select invalid1';
    EXCEPTION WHEN OTHERS THEN
        RAISE INFO 'An exception occurred in the first block.';
        INSERT INTO employee_error_log VALUES ('Error message: ' || SQLERRM);
    END;
    BEGIN
        INSERT INTO employee VALUES ('Edie','Robertson');
        EXECUTE 'select invalid2';
    EXCEPTION WHEN OTHERS THEN
        RAISE INFO 'An exception occurred in the second block.';
        INSERT INTO employee_error_log VALUES ('Error message: ' || SQLERRM);
    END;
END;
$$ 
LANGUAGE plpgsql;

CALL update_employee_sp_3();
INFO:  An exception occurred in the first block.
INFO:  An exception occurred in the second block.
CALL

SELECT * from employee;

 firstname | lastname  
-----------+-----------
 Adam      | Smith
 Edie      | Robertson
(2 rows)

SELECT * from employee_error_log;

                     message                     
-------------------------------------------------
 Error message: column "invalid1" does not exist
 Error message: column "invalid2" does not exist
(2 rows)
</code></pre><p>El siguiente ejemplo muestra cómo utilizar el controlador de excepciones CONTINUE. En este ejemplo se crean dos tablas y se utilizan en un procedimiento almacenado. El controlador CONTINUE controla el flujo de ejecución en un procedimiento almacenado con un comportamiento de administración de transacciones NONATOMIC.</p><pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copiar"><awsui-icon name="copy"></awsui-icon></div></div><code class="">CREATE TABLE tbl_1 (a int);
CREATE TABLE tbl_error_logging(info varchar, err_state varchar, err_msg varchar);

CREATE OR REPLACE PROCEDURE sp_exc_handling_1() NONATOMIC AS
$$
BEGIN
    INSERT INTO tbl_1 VALUES (1);
    -- Expect an error for the insert statement following, because of the invalid value
    INSERT INTO tbl_1 VALUES ("val");
    INSERT INTO tbl_1 VALUES (2);
EXCEPTION CONTINUE_HANDLER WHEN OTHERS THEN
    INSERT INTO tbl_error_logging VALUES ('Encountered error', SQLSTATE, SQLERRM);
END;
$$ LANGUAGE plpgsql;</code></pre><p>LLame al procedimiento almacenado:</p><pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copiar"><awsui-icon name="copy"></awsui-icon></div></div><code class="">CALL sp_exc_handling_1();</code></pre><p>El flujo actua de la siguiente manera:</p><div class="orderedlist">
         
         
     <ol><li><p>Se produce un error porque se intenta insertar un tipo de datos incompatible en una columna. El control pasa al bloque EXCEPTION. Al entrar en el bloque de control de excepciones, la transacción actual se revierte y se crea una nueva transacción implícita para ejecutar las instrucciones en ella.</p></li><li><p>Si las instrucciones de CONTINUE_HANDLER se ejecutan sin errores, el control pasa a la instrucción inmediatamente posterior a la instrucción que provoca la excepción. (Si una instrucción de CONTINUE_HANDLER genera una nueva excepción, puede gestionarla con un controlador de excepciones dentro del bloque EXCEPTION).</p></li></ol></div><p>Después de llamar al procedimiento almacenado de ejemplo, las tablas contienen los siguientes registros:</p><div class="itemizedlist">
         
         
     <ul class="itemizedlist"><li class="listitem"><p>Si ejecuta <code class="code">SELECT * FROM tbl_1;</code>, se devuelven dos registros que contienen los valores <code class="code">1</code> y <code class="code">2</code>.</p></li><li class="listitem"><p>Si ejecuta <code class="code">SELECT * FROM tbl_error_logging;</code>, se devuelve un registro con los siguientes valores: <em>Encountered error</em>, <em>42703</em> y <em>column "val" does not exist in tbl_1</em>.</p></li></ul></div><p>El siguiente ejemplo de control de errores adicional utiliza un controlador EXIT y un controlador CONTINUE. Este crea dos tablas: una tabla de datos y una tabla de registro. También crea un procedimiento almacenado que demuestra el control de errores:</p><pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copiar"><awsui-icon name="copy"></awsui-icon></div></div><code class="">CREATE TABLE tbl_1 (a int);
CREATE TABLE tbl_error_logging(info varchar, err_state varchar, err_msg varchar);

CREATE OR REPLACE PROCEDURE sp_exc_handling_2() NONATOMIC AS
$$
BEGIN
    INSERT INTO tbl_1 VALUES (1);
    BEGIN
        INSERT INTO tbl_1 VALUES (100);
        -- Expect an error for the insert statement following, because of the invalid value
        INSERT INTO tbl_1 VALUES ("val");
        INSERT INTO tbl_1 VALUES (101);
    EXCEPTION EXIT_HANDLER WHEN OTHERS THEN
        INSERT INTO tbl_error_logging VALUES ('Encountered error', SQLSTATE, SQLERRM);
    END;
    INSERT INTO tbl_1 VALUES (2);
    -- Expect an error for the insert statement following, because of the invalid value
    INSERT INTO tbl_1 VALUES ("val");
    INSERT INTO tbl_1 VALUES (3);
EXCEPTION CONTINUE_HANDLER WHEN OTHERS THEN
    INSERT INTO tbl_error_logging VALUES ('Encountered error', SQLSTATE, SQLERRM);
END;
$$ LANGUAGE plpgsql;</code></pre><p>Tras crear el procedimiento almacenado, llámelo de la siguiente manera:</p><pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copiar"><awsui-icon name="copy"></awsui-icon></div></div><code class="">CALL sp_exc_handling_2();</code></pre><p>Cuando se produce un error en el bloque de excepciones interno, que está entre corchetes entre los conjuntos internos BEGIN y END, este lo controla el controlador EXIT. Cualquier error que se produzca en el bloque exterior lo gestiona el controlador CONTINUE. </p><p>Después de llamar al procedimiento almacenado de ejemplo, las tablas contienen los siguientes registros:</p><div class="itemizedlist">
         
         
     <ul class="itemizedlist"><li class="listitem"><p>Si ejecuta <code class="code">SELECT * FROM tbl_1;</code>, se devuelven cuatro registros con los valores 1, 2, 3 y 100.</p></li><li class="listitem"><p>Si ejecuta <code class="code">SELECT * FROM tbl_error_logging;</code>, se devuelven dos registros Estos tienen los siguientes valores: <em>Encountered error</em>, <em>42703</em> y <em>column "val" does not exist in tbl_1</em>.</p></li></ul></div><p>Si la tabla <b>tbl_error_logging</b> no existe, se genera una excepción.</p><p>El siguiente ejemplo muestra cómo utilizar el controlador de excepciones CONTINUE con el bucle FOR. En este ejemplo se crean tres tablas y se utilizan en un bucle FOR dentro de un procedimiento almacenado. El bucle FOR es una variante del conjunto de resultados, lo que significa que itera sobre los resultados de una consulta:</p><pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copiar"><awsui-icon name="copy"></awsui-icon></div></div><code class="">CREATE TABLE tbl_1 (a int);
INSERT INTO tbl_1 VALUES (1), (2), (3);
CREATE TABLE tbl_2 (a int);
CREATE TABLE tbl_error_logging(info varchar, err_state varchar, err_msg varchar);

CREATE OR REPLACE PROCEDURE sp_exc_handling_loop() NONATOMIC AS
$$
DECLARE
 rec RECORD;
BEGIN
    FOR rec IN SELECT a FROM tbl_1
    LOOP
        IF rec.a = 2 THEN
            -- Expect an error for the insert statement following, because of the invalid value
            INSERT INTO tbl_2 VALUES("val");
        ELSE
            INSERT INTO tbl_2 VALUES (rec.a);
        END IF;
    END LOOP;
EXCEPTION CONTINUE_HANDLER WHEN OTHERS THEN
    INSERT INTO tbl_error_logging VALUES ('Encountered error', SQLSTATE, SQLERRM);
END;
$$ LANGUAGE plpgsql;</code></pre><p>LLame al procedimiento almacenado:</p><pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copiar"><awsui-icon name="copy"></awsui-icon></div></div><code class="">CALL sp_exc_handling_loop();</code></pre><p>Después de llamar al procedimiento almacenado de ejemplo, las tablas contienen los siguientes registros:</p><div class="itemizedlist">
         
         
     <ul class="itemizedlist"><li class="listitem"><p> Si ejecuta <code class="code">SELECT * FROM tbl_2;</code>, se devuelven dos registros que contienen los valores 1 y 3.</p></li><li class="listitem"><p>Si ejecuta <code class="code">SELECT * FROM tbl_error_logging;</code>, se devuelve un registro con los siguientes valores: <em>Encountered error</em>, <em>42703</em> y <em>column "val" does not exist in tbl_2</em>.</p></li></ul></div><p>Notas de uso sobre el controlador CONTINUE:</p><div class="itemizedlist">
         
 
         
     <ul class="itemizedlist"><li class="listitem"><p>Las palabras clave CONTINUE_HANDLER y EXIT_HANDLER solo se pueden usar en procedimientos almacenados NONATOMIC.</p></li><li class="listitem"><p>Las palabras clave CONTINUE_HANDLER y EXIT_HANDLER son opcionales. EXIT_HANDLER es la opción predeterminada.</p></li></ul></div><awsdocs-copyright class="copyright-print"></awsdocs-copyright><awsdocs-thumb-feedback right-edge="{{$ctrl.thumbFeedbackRightEdge}}"></awsdocs-thumb-feedback></div><noscript><div><div><div><div id="js_error_message"><p><img src="https://d1ge0kk1l5kms0.cloudfront.net/images/G/01/webservices/console/warning.png" alt="Aviso" /> <strong>JavaScript está desactivado o no está disponible en su navegador.</strong></p><p>Para utilizar la documentación de AWS, debe estar habilitado JavaScript. Para obtener más información, consulte las páginas de ayuda de su navegador.</p></div></div></div></div></noscript><div id="main-col-footer" class="awsui-util-font-size-0"><div id="doc-conventions"><a target="_top" href="/general/latest/gr/docconventions.html">Convenciones del documento</a></div><div class="prev-next"><div id="previous" class="prev-link" accesskey="p" href="./stored-procedure-transaction-management.html">Administración de transacciones</div><div id="next" class="next-link" accesskey="n" href="./c_PLpgSQL-logging.html">Registro de procedimientos almacenados</div></div></div><awsdocs-page-utilities></awsdocs-page-utilities></div><div id="quick-feedback-yes" style="display: none;"><div class="title">¿Le ha servido de ayuda esta página? - Sí</div><div class="content"><p>Gracias por hacernos saber que estamos haciendo un buen trabajo.</p><p>Si tiene un momento, díganos qué es lo que le ha gustado para que podamos seguir trabajando en esa línea.</p><p><awsui-button id="fblink" rel="noopener noreferrer" target="_blank" text="Comentarios" click="linkClick($event)" href="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=Redshift&amp;topic_url=https://docs.aws.amazon.com/es_es/redshift/latest/dg/stored-procedure-trapping-errors.html"></awsui-button></p></div></div><div id="quick-feedback-no" style="display: none;"><div class="title">¿Le ha servido de ayuda esta página? - No</div><div class="content"><p>Gracias por informarnos de que debemos trabajar en esta página. Lamentamos haberle defraudado.</p><p>Si tiene un momento, díganos cómo podemos mejorar la documentación.</p><p><awsui-button id="fblink" rel="noopener noreferrer" target="_blank" text="Comentarios" click="linkClick($event)" href="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=Redshift&amp;topic_url=https://docs.aws.amazon.com/es_es/redshift/latest/dg/stored-procedure-trapping-errors.html"></awsui-button></p></div></div></div></body></div></awsdocs-view><div class="page-loading-indicator" id="page-loading-indicator"><awsui-spinner size="large"></awsui-spinner></div></div><div id="tools-panel" dom-region="tools"><awsdocs-tools-panel id="awsdocs-tools-panel"></awsdocs-tools-panel></div></awsui-app-layout><awsdocs-cookie-banner class="doc-cookie-banner"></awsdocs-cookie-banner></div></body></html>