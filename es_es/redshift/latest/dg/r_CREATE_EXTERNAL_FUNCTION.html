<!DOCTYPE html>
    <html xmlns="http://www.w3.org/1999/xhtml" lang="es-ES"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>CREATE EXTERNAL FUNCTION - Amazon Redshift</title><meta name="viewport" content="width=device-width,initial-scale=1" /><meta name="assets_root" content="/assets" /><meta name="target_state" content="r_CREATE_EXTERNAL_FUNCTION" /><meta name="default_state" content="r_CREATE_EXTERNAL_FUNCTION" /><link rel="icon" type="image/ico" href="/assets/images/favicon.ico" /><link rel="shortcut icon" type="image/ico" href="/assets/images/favicon.ico" /><link rel="canonical" href="https://docs.aws.amazon.com/es_es/redshift/latest/dg/r_CREATE_EXTERNAL_FUNCTION.html" /><meta name="description" content="Crea una función definida por el usuario (UDF) escalar basada en AWS Lambda para Amazon Redshift." /><meta name="deployment_region" content="IAD" /><meta name="product" content="Amazon Redshift" /><meta name="guide" content="Guía para desarrolladores de bases de datos" /><meta name="abstract" content="Cree y administre un almacenamiento de datos con Amazon Redshift, un servicio de almacenamiento de datos completamente administrado a escala de petabytes de nivel empresarial." /><meta name="guide-locale" content="es_es" /><meta name="tocs" content="toc-contents.json" /><link rel="canonical" href="https://docs.aws.amazon.com/es_es/redshift/latest/dg/r_CREATE_EXTERNAL_FUNCTION.html" /><link rel="alternative" href="https://docs.aws.amazon.com/id_id/redshift/latest/dg/r_CREATE_EXTERNAL_FUNCTION.html" hreflang="id-id" /><link rel="alternative" href="https://docs.aws.amazon.com/id_id/redshift/latest/dg/r_CREATE_EXTERNAL_FUNCTION.html" hreflang="id" /><link rel="alternative" href="https://docs.aws.amazon.com/de_de/redshift/latest/dg/r_CREATE_EXTERNAL_FUNCTION.html" hreflang="de-de" /><link rel="alternative" href="https://docs.aws.amazon.com/de_de/redshift/latest/dg/r_CREATE_EXTERNAL_FUNCTION.html" hreflang="de" /><link rel="alternative" href="https://docs.aws.amazon.com/redshift/latest/dg/r_CREATE_EXTERNAL_FUNCTION.html" hreflang="en-us" /><link rel="alternative" href="https://docs.aws.amazon.com/redshift/latest/dg/r_CREATE_EXTERNAL_FUNCTION.html" hreflang="en" /><link rel="alternative" href="https://docs.aws.amazon.com/es_es/redshift/latest/dg/r_CREATE_EXTERNAL_FUNCTION.html" hreflang="es-es" /><link rel="alternative" href="https://docs.aws.amazon.com/es_es/redshift/latest/dg/r_CREATE_EXTERNAL_FUNCTION.html" hreflang="es" /><link rel="alternative" href="https://docs.aws.amazon.com/fr_fr/redshift/latest/dg/r_CREATE_EXTERNAL_FUNCTION.html" hreflang="fr-fr" /><link rel="alternative" href="https://docs.aws.amazon.com/fr_fr/redshift/latest/dg/r_CREATE_EXTERNAL_FUNCTION.html" hreflang="fr" /><link rel="alternative" href="https://docs.aws.amazon.com/it_it/redshift/latest/dg/r_CREATE_EXTERNAL_FUNCTION.html" hreflang="it-it" /><link rel="alternative" href="https://docs.aws.amazon.com/it_it/redshift/latest/dg/r_CREATE_EXTERNAL_FUNCTION.html" hreflang="it" /><link rel="alternative" href="https://docs.aws.amazon.com/ja_jp/redshift/latest/dg/r_CREATE_EXTERNAL_FUNCTION.html" hreflang="ja-jp" /><link rel="alternative" href="https://docs.aws.amazon.com/ja_jp/redshift/latest/dg/r_CREATE_EXTERNAL_FUNCTION.html" hreflang="ja" /><link rel="alternative" href="https://docs.aws.amazon.com/ko_kr/redshift/latest/dg/r_CREATE_EXTERNAL_FUNCTION.html" hreflang="ko-kr" /><link rel="alternative" href="https://docs.aws.amazon.com/ko_kr/redshift/latest/dg/r_CREATE_EXTERNAL_FUNCTION.html" hreflang="ko" /><link rel="alternative" href="https://docs.aws.amazon.com/pt_br/redshift/latest/dg/r_CREATE_EXTERNAL_FUNCTION.html" hreflang="pt-br" /><link rel="alternative" href="https://docs.aws.amazon.com/pt_br/redshift/latest/dg/r_CREATE_EXTERNAL_FUNCTION.html" hreflang="pt" /><link rel="alternative" href="https://docs.aws.amazon.com/zh_cn/redshift/latest/dg/r_CREATE_EXTERNAL_FUNCTION.html" hreflang="zh-cn" /><link rel="alternative" href="https://docs.aws.amazon.com/zh_tw/redshift/latest/dg/r_CREATE_EXTERNAL_FUNCTION.html" hreflang="zh-tw" /><link rel="alternative" href="https://docs.aws.amazon.com/redshift/latest/dg/r_CREATE_EXTERNAL_FUNCTION.html" hreflang="x-default" /><meta name="feedback-item" content="Redshift" /><meta name="this_doc_product" content="Amazon Redshift" /><meta name="this_doc_guide" content="Guía para desarrolladores de bases de datos" /><script defer="" src="/assets/r/vendor4.js?version=2021.12.02"></script><script defer="" src="/assets/r/vendor3.js?version=2021.12.02"></script><script defer="" src="/assets/r/vendor1.js?version=2021.12.02"></script><script defer="" src="/assets/r/awsdocs-common.js?version=2021.12.02"></script><script defer="" src="/assets/r/awsdocs-doc-page.js?version=2021.12.02"></script><link href="/assets/r/vendor4.css?version=2021.12.02" rel="stylesheet" /><link href="/assets/r/awsdocs-common.css?version=2021.12.02" rel="stylesheet" /><link href="/assets/r/awsdocs-doc-page.css?version=2021.12.02" rel="stylesheet" /><script async="" id="awsc-panorama-bundle" type="text/javascript" src="https://prod.pa.cdn.uis.awsstatic.com/panorama-nav-init.js" data-config="{'appEntity':'aws-documentation','region':'us-east-1','service':'redshift'}"></script><meta id="panorama-serviceSubSection" value="Guía para desarrolladores de bases de datos" /><meta id="panorama-serviceConsolePage" value="CREATE EXTERNAL FUNCTION" /></head><body class="awsdocs awsui"><div class="awsdocs-container"><awsdocs-header></awsdocs-header><awsui-app-layout id="app-layout" class="awsui-util-no-gutters" ng-controller="ContentController as $ctrl" header-selector="awsdocs-header" navigation-hide="false" navigation-width="$ctrl.navWidth" navigation-open="$ctrl.navOpen" navigation-change="$ctrl.onNavChange($event)" tools-hide="$ctrl.hideTools" tools-width="$ctrl.toolsWidth" tools-open="$ctrl.toolsOpen" tools-change="$ctrl.onToolsChange($event)"><div id="guide-toc" dom-region="navigation"><awsdocs-toc></awsdocs-toc></div><div id="main-column" dom-region="content" tabindex="-1"><awsdocs-view class="awsdocs-view"><div id="awsdocs-content"><head><title>CREATE EXTERNAL FUNCTION - Amazon Redshift</title><meta name="pdf" content="redshift-dg.pdf#r_CREATE_EXTERNAL_FUNCTION" /><meta name="rss" content="Dochistory.rss" /><meta name="forums" content="http://forums.aws.amazon.com/forum.jspa?forumID=155" /><meta name="feedback" content="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=Redshift&amp;topic_url=https://docs.aws.amazon.com/es_es/redshift/latest/dg/r_CREATE_EXTERNAL_FUNCTION.html" /><meta name="feedback-yes" content="feedbackyes.html?topic_url=https://docs.aws.amazon.com/es_es/redshift/latest/dg/r_CREATE_EXTERNAL_FUNCTION.html" /><meta name="feedback-no" content="feedbackno.html?topic_url=https://docs.aws.amazon.com/es_es/redshift/latest/dg/r_CREATE_EXTERNAL_FUNCTION.html" /><meta name="keywords" content="Amazon Redshift,AWS Redshift,Redshift,Redshift Spectrum,Clúster,almacenamiento de datos,desarrollador,datos de ejemplo,base de datos,desarrollador de base de datos,HLL" /><script type="application/ld+json">
{
    "@context" : "https://schema.org",
    "@type" : "BreadcrumbList",
    "itemListElement" : [
      {
        "@type" : "ListItem",
        "position" : 1,
        "name" : "AWS",
        "item" : "https://aws.amazon.com"
      },
      {
        "@type" : "ListItem",
        "position" : 2,
        "name" : "Amazon Redshift",
        "item" : "https://docs.aws.amazon.com/redshift/index.html"
      },
      {
        "@type" : "ListItem",
        "position" : 3,
        "name" : "Guía para desarrolladores de bases de datos",
        "item" : "https://docs.aws.amazon.com/es_es/redshift/latest/dg"
      },
      {
        "@type" : "ListItem",
        "position" : 4,
        "name" : "Referencia de SQL",
        "item" : "https://docs.aws.amazon.com/es_es/redshift/latest/dg/cm_chap_SQLCommandRef.html"
      },
      {
        "@type" : "ListItem",
        "position" : 5,
        "name" : "Comandos SQL",
        "item" : "https://docs.aws.amazon.com/es_es/redshift/latest/dg/c_SQL_commands.html"
      },
      {
        "@type" : "ListItem",
        "position" : 6,
        "name" : "CREATE EXTERNAL FUNCTION",
        "item" : "https://docs.aws.amazon.com/es_es/redshift/latest/dg/c_SQL_commands.html"
      }
    ]
}
</script></head><body><div id="main"><div style="display: none"><a href="redshift-dg.pdf#r_CREATE_EXTERNAL_FUNCTION" target="_blank" rel="noopener noreferrer" title="Abrir PDF"></a></div><div id="breadcrumbs" class="breadcrumb"><a href="https://aws.amazon.com">AWS</a><a href="/index.html">Documentación</a><a href="/redshift/index.html">Amazon Redshift</a><a href="welcome.html">Guía para desarrolladores de bases de datos</a></div><div id="page-toc-src"><a href="#r_CREATE_EXTERNAL_FUNCTION-privileges">Privilegios necesarios</a><a href="#r_CREATE_EXTERNAL_FUNCTION-synopsis">Sintaxis</a><a href="#r_CREATE_EXTERNAL_FUNCTION-parameters">Parámetros</a><a href="#r_CREATE_FUNCTION-usage-notes">Notas de uso</a><a href="#r_CREATE_FUNCTION-examples">Ejemplos</a></div><div id="main-content" class="awsui-util-container"><div id="main-col-body"><awsdocs-language-banner data-service="$ctrl.pageService"></awsdocs-language-banner><h1 class="topictitle" id="r_CREATE_EXTERNAL_FUNCTION">CREATE EXTERNAL FUNCTION</h1><div class="awsdocs-page-header-container"><awsdocs-page-header></awsdocs-page-header><awsdocs-filter-selector id="awsdocs-filter-selector"></awsdocs-filter-selector></div><p>Crea una función definida por el usuario (UDF) escalar basada en AWS Lambda para Amazon Redshift. Para obtener más información acerca de las funciones de Lambda definidas por el usuario, consulte <a href="./udf-creating-a-lambda-sql-udf.html">Creación de una UDF de Lambda escalar</a>.</p>
         <h2 id="r_CREATE_EXTERNAL_FUNCTION-privileges">Privilegios necesarios</h2>
         <p>Los siguientes privilegios son necesarios para CREATE EXTERNAL FUNCTION:</p>
         <div class="itemizedlist">
             
             
         <ul class="itemizedlist"><li class="listitem"><p>Superusuario</p></li><li class="listitem"><p>Usuarios con el privilegio CREATE [ OR REPLACE ] EXTERNAL FUNCTION</p></li></ul></div>
       
         <h2 id="r_CREATE_EXTERNAL_FUNCTION-synopsis">Sintaxis</h2>

         <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copiar"><awsui-icon name="copy"></awsui-icon></div></div><code class="nohighlight">CREATE [ OR REPLACE ] EXTERNAL FUNCTION <em>external_fn_name</em> ( [<em>data_type</em>] [, ...] )
RETURNS <em>data_type</em>
<span>{</span> VOLATILE | STABLE }
LAMBDA <em>'lambda_fn_name'</em>
IAM_ROLE <span>{</span> default | ‘arn:aws:iam::<code class="replaceable">&lt;Cuenta de AWS-id&gt;</code>:role/<code class="replaceable">&lt;role-name&gt;</code>’
RETRY_TIMEOUT <em>milliseconds</em>
MAX_BATCH_ROWS count
MAX_BATCH_SIZE size [ KB | MB ];</code></pre>

         
         
         <p>A continuación, se muestra la sintaxis que se aplica para el machine learning en Amazon Redshift. Para obtener información acerca de los parámetros específicos del modelo, consulte <a href="./r_GRANT.html#r_GRANT-parameters">Parámetros</a>.</p>
         <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copiar"><awsui-icon name="copy"></awsui-icon></div></div><code class="nohighlight">CREATE [ OR REPLACE ] EXTERNAL FUNCTION <em>external_fn_name</em> ( [<em>data_type</em>] [, ...] )
RETURNS <em>data_type</em>
<span>{</span> VOLATILE | STABLE }
SAGEMAKER<em>'endpoint_name'</em>
IAM_ROLE <span>{</span> default | ‘arn:aws:iam::<code class="replaceable">&lt;Cuenta de AWS-id&gt;</code>:role/<code class="replaceable">&lt;role-name&gt;</code>’ };</code></pre>


       
         <h2 id="r_CREATE_EXTERNAL_FUNCTION-parameters">Parámetros</h2>


         <div class="variablelist">
             
             
             
             
            
             
          

             
            
         

             

             
             
          
         <dl>
               <dt><span class="term">OR REPLACE</span></dt>
               <dd>
                  <p>Se trata de una cláusula que especifica que, si ya existe una función con el mismo nombre y los mismos tipos de datos de argumento de entrada o <em>firma</em> que este, debe reemplazarse la función existente. Solo puede reemplazar una función con una nueva función que defina un conjunto idéntico de tipos de datos. Debe ser un superusuario para reemplazar una función.</p>
                  <p>Si define una función con el mismo nombre que una función existente, pero con una firma diferente, crea una nueva función. En otras palabras, se sobrecarga el nombre de la función. Para obtener más información, consulte <a href="./udf-naming-udfs.html#udf-naming-overloading-function-names">Sobrecarga de los nombres de función</a>.</p>
               </dd>
             
               <dt><span class="term"><em>external_fn_name</em></span></dt>
               <dd>
                  <p>Se trata del nombre de la función externa. Si especifica un nombre de esquema (como myschema.myfunction), la función se crea con el esquema especificado. De lo contrario, la función se crea en el esquema actual. Para obtener más información acerca de los nombres válidos, consulte <a href="./r_names.html">Nombres e identificadores</a>. </p>
                  <p>Recomendamos que utilice el prefijo <code class="code">f_</code> en los nombres de todas las UDF. Amazon Redshift reserva el prefijo <code class="code">f_</code> para los nombres de las UDF. Con el uso del prefijo <code class="code">f_</code>, se asegura de que los nombres de las UDF no entren en conflicto con ninguno de los nombres de las funciones SQL integradas para Amazon Redshift ahora o en el futuro. Para obtener más información, consulte <a href="./udf-naming-udfs.html">Dar nombre a las UDF</a>.</p>
               </dd>
             
               <dt><span class="term"><em>data_type</em></span></dt>
               <dd>
                  <p>Se trata del tipo de datos para los argumentos de entrada. Para obtener más información, consulte <a href="./c_Supported_data_types.html">Tipos de datos</a>.</p>
               </dd>
             
               <dt><span class="term">RETURNS <em>data_type</em></span></dt>
               <dd>
                  <p>El tipo de datos del valor que la función devuelve. El tipo de datos RETURNS puede ser cualquier tipo de datos estándar de Amazon Redshift. Para obtener más información, consulte <a href="./udf-data-types.html">Tipos de datos de UDF de Python</a>.</p>
               </dd>
             
               <dt><span class="term">VOLATILE | STABLE</span></dt>
               <dd>
                  <p>Informa al optimizador de consultas acerca de la volatilidad de la función. </p>
                  <p>Para obtener la mejor optimización, etiquete la función con la categoría de volatilidad válida más estricta. Las categorías de volatilidad, de la menos estricta a la más estricta, son las siguientes:</p>
                  <div class="itemizedlist">
                       
                      
                  <ul class="itemizedlist"><li class="listitem">
                        <p>VOLATILE</p>
                     </li><li class="listitem">
                        <p>STABLE</p>
                     </li></ul></div>
                  <p>VOLATILE</p>
                  <p>Dados los mismos argumentos, la función puede devolver resultados diferentes en ejecuciones consecutivas, incluso para las filas de una única instrucción. El optimizador de consultas no puede hacer suposiciones sobre el comportamiento de una función volátil. Una consulta que utiliza una función volátil debe reevaluar la función para cada entrada.</p>
                  <p>STABLE</p>
                  <p>Dados los mismos argumentos, se garantiza que la función devuelve los mismos resultados en sucesivas llamadas procesadas en una misma instrucción. La función puede devolver resultados diferentes cuando se evoca en diferentes instrucciones. Con esta categoría, el optimizador puede reducir el número de veces que se llama a la función en una misma instrucción.</p>
                  <p>Tenga en cuenta que si el rigor elegido no es válido para la función, existe el riesgo de que el optimizador omita algunas llamadas basándose en este rigor. Esto puede provocar un conjunto de resultados incorrecto.</p>
                  <p>La cláusula IMMUTABLE no es compatible actualmente con las UDF de Lambda.</p>
                  

               </dd>
             
               <dt><span class="term">LAMBDA <em>'lambda_fn_name'</em> </span></dt>
               <dd>
                  <p> Se trata del nombre de la función a la que llama Amazon Redshift.</p>
                  <p>Si desea conocer los pasos necesarios para crear una función de AWS Lambda, consulte <a href="https://docs.aws.amazon.com/lambda/latest/dg/getting-started-create-function.html">Creación de una función de Lambda con la consola</a> en la <em>Guía para desarrolladores de AWS Lambda</em>.</p>
                 <p>Para obtener información acerca de los permisos necesarios para la función de Lambda, consulte <a href="https://docs.aws.amazon.com/lambda/latest/dg/lambda-permissions.html">Permisos de AWS Lambda</a> en la <em>Guía para desarrolladores de AWS Lambda</em>.</p>

               </dd>
             
               <dt><span class="term">IAM_ROLE <span>{</span> default | ‘arn:aws:iam::<code class="replaceable">&lt;Cuenta de AWS-id&gt;</code>:role/<code class="replaceable">&lt;role-name&gt;</code>’ </span></dt>
               <dd>
                  <p>Utilice la palabra clave predeterminada para que Amazon Redshift utilice el rol de IAM configurado como predeterminado y asociado al clúster cuando se ejecuta el comando CREATE EXTERNAL FUNCTION.</p>
                  <p>Utilice el nombre de recurso de Amazon (ARN), de un rol de IAM que el clúster utiliza para la autenticación y la autorización. El comando CREATE EXTERNAL FUNCTION tiene autorización para invocar funciones de Lambda a través de este rol de IAM. Si su clúster tiene un rol de IAM existente con permisos para invocar funciones de Lambda adjuntas, puede sustituir el ARN de su rol. Para obtener más información, consulte <a href="./udf-creating-a-lambda-sql-udf.html#udf-lambda-authorization">Configuración del parámetro de autorización para las UDF de Lambda</a>.</p>
                  <p>A continuación, se muestra la sintaxis del parámetro IAM_ROLE.</p>
                  <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copiar"><awsui-icon name="copy"></awsui-icon></div></div><code class="nohighlight">IAM_ROLE 'arn:aws:iam::<em>aws-account-id</em>:role/<em>role-name</em>'</code></pre>
               </dd>
             
               <dt><span class="term">RETRY_TIMEOUT <em>milliseconds</em> </span></dt>
               <dd>
                  <p>Se trata de la cantidad de tiempo total en milisegundos que Amazon Redshift utiliza para los retrasos en el reintento de retroceso. </p>
                  <p>En lugar de volver a intentar ejecutar inmediatamente cualquier consulta que presente error, Amazon Redshift realiza retrocesos y espera cierta cantidad de tiempo entre reintentos. Luego, Amazon Redshift vuelve a intentar realizar la solicitud para ejecutar la consulta que presenta error de nuevo hasta que la suma de todos los retrasos sea igual o superior al valor RETRY_TIMEOUT que especificó. El valor predeterminado es 20 000 milisegundos.</p>
                  <p>Cuando se invoca una función de Lambda, Amazon Redshift vuelve a intentar ejecutar las consultas que presentan errores, como <code class="code">TooManyRequestsException</code>, <code class="code">EC2ThrottledException</code> y <code class="code">ServiceException</code>. </p>
                  <p>Puede configurar el parámetro RETRY_TIMEOUT en 0 milisegundos para evitar cualquier reintento de ejecución de una UDF de Lambda.</p>
               </dd>
             
               <dt><span class="term">MAX_BATCH_ROWS <em>recuento</em></span></dt>
               <dd>
                  <p> El número máximo de filas que Amazon Redshift envía en una sola solicitud por lotes para una única invocación de lambda. </p>
                  <p> El valor mínimo de este parámetro es 1. El valor máximo es INT_MAX o 2 147 483 647. </p>
                  <p> Este parámetro es opcional. El valor predeterminado es INT_MAX o 2 147 483 647. </p>
               </dd>
             
            <dt><span class="term">MAX_BATCH_SIZE <em>tamaño</em> [ KB | MB ] </span></dt>
            <dd>
               <p> El tamaño máximo de la carga útil de datos que Amazon Redshift envía en una sola solicitud por lotes para una única invocación de lambda. </p>
               <p> El valor mínimo de este parámetro es 1 KB. El valor máximo es 5 MB. </p>
               <p> El valor predeterminado de este parámetro es 5 MB. </p>
               <p> KB y MB son opcionales. Si no establece la unidad de medida, Amazon Redshift utilizará KB de forma predeterminada. </p>
            </dd>
         </dl></div>
       
         <h2 id="r_CREATE_FUNCTION-usage-notes">Notas de uso</h2>
         <p>Tenga en cuenta lo siguiente al crear UDF de Lambda: </p>
         <div class="itemizedlist">
             
             
         <ul class="itemizedlist"><li class="listitem"><p>El orden de las llamadas a la función de Lambda en los argumentos de entrada no es fijo ni está garantizado. Puede variar de una instancia a otra de las consultas en ejecución, en función de la configuración del clúster.</p></li><li class="listitem"><p>No se garantiza que las funciones se apliquen a cada argumento de entrada una vez y solo una vez. La interacción entre Amazon Redshift y AWS Lambda podría dar lugar a llamadas repetitivas con las mismas entradas.</p></li></ul></div>
       
         <h2 id="r_CREATE_FUNCTION-examples">Ejemplos</h2>
         <p>A continuación, se proporcionan ejemplos de uso de funciones escalares de Lambda definidas por el usuario (UDF).</p>
          
            <h3 id="r_CREATE_FUNCTION-lambda-example-node">Ejemplo de UDF escalar de Lambda con una función Node.js de Lambda</h3>
            <p>En el siguiente ejemplo, se crea una función externa denominada <code class="code">exfunc_sum</code> que toma dos valores enteros como argumentos de entrada. Esta función devuelve la suma como una salida expresada con un número entero. El nombre de la función de Lambda a la que se llamará es <code class="code">lambda_sum</code>. El lenguaje utilizado para esta función de Lambda es Node.js 12.x. Asegúrese de especificar el rol de IAM. El ejemplo utiliza <code class="code">'arn:aws:iam::123456789012:user/johndoe'</code> como rol de IAM.</p>
            
            <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copiar"><awsui-icon name="copy"></awsui-icon></div></div><code class="">CREATE EXTERNAL FUNCTION exfunc_sum(INT,INT)
RETURNS INT
VOLATILE
LAMBDA 'lambda_sum'
IAM_ROLE 'arn:aws:iam::123456789012:role/Redshift-Exfunc-Test';</code></pre>
            <p>La función de Lambda toma la carga de solicitudes e itera sobre cada fila. Se suman todos los valores de una sola fila para calcular la suma de esa fila, que se guarda en la matriz de respuesta. La cantidad de filas en la matriz de resultados es similar a la cantidad de filas recibidas en la carga de la solicitud. </p>
            <p>La carga de respuesta JSON debe tener los datos de resultado en el campo “results” para que la función externa la reconozca. El campo de argumentos de la solicitud enviada a la función de Lambda contiene la carga de datos. En el caso de una solicitud por lote, es posible que existan varias filas en la carga de datos. La siguiente función de Lambda itera sobre todas las filas de la carga de datos de la solicitud. También itera de forma individual sobre todos los valores dentro de una sola fila.</p>
            <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copiar"><awsui-icon name="copy"></awsui-icon></div></div><code class="">exports.handler = async (event) =&gt; <span>{</span>
    // The 'arguments' field in the request sent to the Lambda function contains the data payload.
    var t1 = event['arguments'];

    // 'len(t1)' represents the number of rows in the request payload.
    // The number of results in the response payload should be the same as the number of rows received.
    const resp = new Array(t1.length);

    // Iterating over all the rows in the request payload.
    for (const [i, x] of t1.entries())
    <span>{</span>
        var sum = 0;
        // Iterating over all the values in a single row.
        for (const y of x) <span>{</span>
            sum = sum + y;
        }
        resp[i] = sum;
    }
    // The 'results' field should contain the results of the lambda call.
    const response = <span>{</span>
        results: resp
    };
    return JSON.stringify(response);
};</code></pre>
            <p>En el siguiente ejemplo, se llama a la función externa con valores literales.</p>
            
            <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copiar"><awsui-icon name="copy"></awsui-icon></div></div><code class="">select exfunc_sum(1,2);
exfunc_sum
------------
 3
(1 row)</code></pre>
            <p>En el siguiente ejemplo, se crea una tabla denominada t_sum con dos columnas, c1 y c2, del tipo de datos entero y se insertan dos filas de datos. Luego, se llama a la función externa transmitiendo los nombres de las columnas de esta tabla. Las dos filas de la tabla se envían en una solicitud por lote en la carga de la solicitud como una sola invocación de Lambda.</p>
            
<pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copiar"><awsui-icon name="copy"></awsui-icon></div></div><code class="">CREATE TABLE t_sum(c1 int, c2 int);
INSERT INTO t_sum VALUES (4,5), (6,7);
SELECT exfunc_sum(c1,c2) FROM t_sum;
 exfunc_sum
---------------
 9
 13
(2 rows)</code></pre>
          

         
          
            <h3 id="r_CREATE_FUNCTION-lambda-example-retry">Ejemplo de UDF escalar de Lambda con el atributo RETRY_TIMEOUT</h3>
            <p>En la siguiente sección, encontrará un ejemplo de cómo utilizar el atributo RETRY_TIMEOUT en las UDF de Lambda. </p>
            <p>Las funciones de AWS Lambda tienen límites de simultaneidad que se pueden establecer para cada función. Para obtener más información acerca de los límites de simultaneidad, consulte <a href="https://docs.aws.amazon.com/lambda/latest/dg/configuration-concurrency.html">Administración de la simultaneidad para una función de Lambda</a> en la <em>Guía para desarrolladores de AWS Lambda</em> y la publicación <a href="https://aws.amazon.com/blogs/compute/managing-aws-lambda-function-concurrency" rel="noopener noreferrer" target="_blank"><span>Administración de la simultaneidad de la función AWS Lambda</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a> en el blog de informática de AWS. </p>
            <p>Cuando la cantidad de solicitudes que atiende una UDF de Lambda supera los límites de simultaneidad, las solicitudes nuevas reciben el error <code class="code">TooManyRequestsException</code>. La UDF de Lambda intenta solucionar este error de nuevo hasta que la suma de todos los retrasos entre las solicitudes enviadas a la función de Lambda sea igual o superior al valor RETRY_TIMEOUT que estableció. El valor predeterminado de RETRY_TIMEOUT es 20 000 milisegundos.</p>
              <p>En el siguiente ejemplo, se utiliza una función de Lambda denominada <code class="code">exfunc_sleep_3</code>. Esta función toma la carga de la solicitud, itera sobre cada fila y convierte la entrada a mayúsculas. Luego, está inactiva durante 3 segundos y devuelve el resultado. El lenguaje utilizado para esta función de Lambda es Python 3.8. </p>
            <p>La cantidad de filas en la matriz de resultados es similar a la cantidad de filas recibidas en la carga de la solicitud. La carga de respuesta JSON debe tener los datos de resultado en el campo <code class="code">results</code> para que la función externa la reconozca. El campo de <code class="code">arguments</code> de la solicitud enviada a la función de Lambda contiene la carga de datos. En el caso de una solicitud por lote, es posible que aparezcan varias filas en la carga de datos.</p>
              <p>El límite de simultaneidad para esta función se configura específicamente en 1 en simultaneidad reservada para demostrar el uso del atributo RETRY_TIMEOUT. Cuando el atributo se configura en 1, la función de Lambda solo puede atender una solicitud a la vez.</p>
            <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copiar"><awsui-icon name="copy"></awsui-icon></div></div><code class="">import json
import time
def lambda_handler(event, context):
    t1 = event['arguments']
    # 'len(t1)' represents the number of rows in the request payload.
    # The number of results in the response payload should be the same as the number of rows received.
    resp = [None]*len(t1)

    # Iterating over all rows in the request payload.
    for i, x in enumerate(t1):
        # Iterating over all the values in a single row.
        for j, y in enumerate(x):
            resp[i] = y.upper()

    time.sleep(3)
    ret = dict()
    ret['results'] = resp
    ret_json = json.dumps(ret)
    return ret_json</code></pre>
            <p>A continuación, se incluyen dos ejemplos adicionales que ilustran el atributo RETRY_TIMEOUT. Cada ejemplo invoca una sola UDF de Lambda. Cuando invocan la UDF de Lambda, cada ejemplo ejecuta la misma consulta SQL para invocar la UDF de Lambda desde dos sesiones de base de datos simultáneas. Cuando la primera consulta que invoca la UDF de Lambda es atendida por la UDF, la segunda consulta recibe el error <code class="code">TooManyRequestsException</code>. Este resultado se produce porque se configura de forma específica la simultaneidad reservada en 1 en la UDF. Para obtener información sobre cómo establecer la simultaneidad reservada para las funciones de Lambda, consulte <a href="https://docs.aws.amazon.com/lambda/latest/dg/configuration-concurrency.html#configuration-concurrency-reservedconfiguration-concurrency-reserved">Configuración de la simultaneidad reservada</a>.</p>


            

            <p>A continuación, el primer ejemplo configura el atributo RETRY_TIMEOUT para la UDF de Lambda en 0 milisegundos. Si la solicitud de Lambda recibe alguna excepción de la función de Lambda, Amazon Redshift no realiza ningún reintento. Este resultado se produce porque el atributo RETRY_TIMEOUT se configura en 0.</p>
            
            <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copiar"><awsui-icon name="copy"></awsui-icon></div></div><code class="">CREATE OR REPLACE EXTERNAL FUNCTION exfunc_upper(varchar)
RETURNS varchar
VOLATILE
LAMBDA 'exfunc_sleep_3'
IAM_ROLE 'arn:aws:iam::123456789012:role/Redshift-Exfunc-Test'
RETRY_TIMEOUT 0;</code></pre>
            <p>Con RETRY_TIMEOUT configurado en 0, puede ejecutar las siguientes dos consultas desde sesiones de base de datos independientes para ver resultados diferentes.</p>
            <p>La primera consulta SQL que utiliza la UDF de Lambda se ejecuta correctamente.</p>
            
            <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copiar"><awsui-icon name="copy"></awsui-icon></div></div><code class="">select exfunc_upper('Varchar');
 exfunc_upper
 --------------
 VARCHAR
(1 row)</code></pre>
            <p>La segunda consulta, que se ejecuta desde una sesión de base de datos independiente al mismo tiempo, recibe el error <code class="code">TooManyRequestsException</code>.</p>
                  
            <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copiar"><awsui-icon name="copy"></awsui-icon></div></div><code class="">select exfunc_upper('Varchar');
ERROR:  Rate Exceeded.; Exception: TooManyRequestsException; ShouldRetry: 1
DETAIL:
-----------------------------------------------
error:  Rate Exceeded.; Exception: TooManyRequestsException; ShouldRetry: 1
code:      32103
context:query:     0
location:  exfunc_client.cpp:102
process:   padbmaster [pid=26384]
-----------------------------------------------</code></pre>

                  <p>A continuación, el segundo ejemplo configura el atributo RETRY_TIMEOUT para la UDF de Lambda en 3000 milisegundos. Incluso si la segunda consulta se ejecuta de forma simultánea, la UDF de Lambda reintenta la ejecución hasta que el retraso total sea de 3000 milisegundos. Por lo tanto, ambas consultas se ejecutan correctamente.</p>
                  
                  <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copiar"><awsui-icon name="copy"></awsui-icon></div></div><code class="">CREATE OR REPLACE EXTERNAL FUNCTION exfunc_upper(varchar)
RETURNS varchar
VOLATILE
LAMBDA 'exfunc_sleep_3'
IAM_ROLE 'arn:aws:iam::123456789012:role/Redshift-Exfunc-Test'
RETRY_TIMEOUT 3000;</code></pre>
                  <p>Con RETRY_TIMEOUT configurado en 3000, puede ejecutar las siguientes dos consultas desde sesiones de base de datos independientes para ver los mismos resultados.</p>
                  <p>La primera consulta SQL que ejecuta la UDF de Lambda se ejecuta correctamente.</p>
                  
                  <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copiar"><awsui-icon name="copy"></awsui-icon></div></div><code class="">select exfunc_upper('Varchar');
 exfunc_upper
 --------------
 VARCHAR
(1 row)</code></pre>
                  <p>La segunda consulta se ejecuta de forma simultánea, y la UDF de Lambda reintenta la ejecución hasta que el retraso total sea de 3000 milisegundos.</p>
                  
                  <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copiar"><awsui-icon name="copy"></awsui-icon></div></div><code class="">select exfunc_upper('Varchar');
 exfunc_upper
--------------
 VARCHAR
(1 row)</code></pre>

          

          
            <h3 id="r_CREATE_FUNCTION-lambda-example-python">Ejemplo de UDF escalar de Lambda con una función Python de Lambda</h3>
            <p>En el siguiente ejemplo, se crea una función externa denominada <code class="code">exfunc_multiplication</code> que multiplica números y devuelve un número entero. Este ejemplo incorpora los campos de éxito y <code class="code">error_msg</code> en la respuesta de Lambda. El campo de éxito se establece como false cuando hay un desbordamiento de valores enteros en el resultado de la multiplicación y el mensaje <code class="code">error_msg</code> se establece como <code class="code">Integer multiplication overflow</code>. La función <code class="code">exfunc_multiplication</code> toma tres valores enteros como argumentos de entrada y devuelve la suma como un valor de salida entero. </p>
            <p>El nombre de la función de Lambda que se llama es <code class="code">lambda_multiplication</code>. El lenguaje utilizado para esta función de Lambda es Python 3.8. Asegúrese de especificar el rol de IAM.</p>
            
            <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copiar"><awsui-icon name="copy"></awsui-icon></div></div><code class="">CREATE EXTERNAL FUNCTION exfunc_multiplication(int, int, int)
RETURNS INT
VOLATILE
LAMBDA 'lambda_multiplication'
IAM_ROLE 'arn:aws:iam::123456789012:role/Redshift-Exfunc-Test'; </code></pre>
            <p>La función de Lambda toma la carga de solicitudes e itera sobre cada fila. Todos los valores de una sola fila se multiplican para calcular el resultado de esa fila, que se guarda en la lista de respuestas. En este ejemplo, se utiliza un valor booleano de éxito establecido como true de manera predeterminada. Si el resultado de la multiplicación de una fila tiene un desbordamiento de valores enteros, el valor de éxito se establece como false. Por lo tanto, se interrumpe el ciclo de iteraciones. </p>
            <p>Durante la creación de la carga de respuesta, si el valor de éxito es false, la siguiente función de Lambda agrega el campo <code class="code">error_msg</code> a la carga. También establece el mensaje de error en <code class="code">Integer multiplication overflow</code>. Si el valor de éxito es true, los datos de resultado se agregan en el campo de resultados. La cantidad de filas en la matriz de resultados, si hay, es similar a la cantidad de filas recibidas en la carga de la solicitud. </p>
            <p>El campo de argumentos de la solicitud enviada a la función de Lambda contiene la carga de datos. En el caso de una solicitud por lote, es posible que existan varias filas en la carga de datos. La siguiente función de Lambda itera sobre todas las filas de la carga de datos de la solicitud e itera de manera individual sobre todos los valores dentro de una sola fila. </p>
            <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copiar"><awsui-icon name="copy"></awsui-icon></div></div><code class="">import json
def lambda_handler(event, context):
    t1 = event['arguments']
    # 'len(t1)' represents the number of rows in the request payload.
    # The number of results in the response payload should be the same as the number of rows received.
    resp = [None]*len(t1)

    # By default success is set to 'True'.
    success = True
    # Iterating over all rows in the request payload.
    for i, x in enumerate(t1):
        mul = 1
        # Iterating over all the values in a single row.
        for j, y in enumerate(x):
            mul = mul*y

        # Check integer overflow.
        if (mul &gt;= 9223372036854775807 or mul &lt;= -9223372036854775808):
            success = False
            break
        else:
            resp[i] = mul
    ret = dict()
    ret['success'] = success
    if not success:
        ret['error_msg'] = "Integer multiplication overflow"
    else:
        ret['results'] = resp
    ret_json = json.dumps(ret)

    return ret_json</code></pre>

            <p>En el siguiente ejemplo, se llama a la función externa con valores literales.</p>
            
            <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copiar"><awsui-icon name="copy"></awsui-icon></div></div><code class="">SELECT exfunc_multiplication(8, 9, 2);
  exfunc_multiplication
---------------------------
          144
(1 row)</code></pre>

            <p>En el siguiente ejemplo, se crea una tabla denominada t_multi con tres columnas, c1, c2 y c3, del tipo de datos entero. Se llama a la función externa transmitiendo los nombres de las columnas de esta tabla. Los datos se insertan de tal manera que provocan un desbordamiento de valores enteros para mostrar cómo se propaga el error.</p>
            
            <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copiar"><awsui-icon name="copy"></awsui-icon></div></div><code class="">CREATE TABLE t_multi (c1 int, c2 int, c3 int);
INSERT INTO t_multi VALUES (2147483647, 2147483647, 4);
SELECT exfunc_multiplication(c1, c2, c3) FROM t_multi;
DETAIL:
  -----------------------------------------------
  error:  Integer multiplication overflow
  code:      32004context:
  context:
  query:     38
  location:  exfunc_data.cpp:276
  process:   query2_16_38 [pid=30494]
  -----------------------------------------------</code></pre>
          




         
      <awsdocs-copyright class="copyright-print"></awsdocs-copyright><awsdocs-thumb-feedback right-edge="{{$ctrl.thumbFeedbackRightEdge}}"></awsdocs-thumb-feedback></div><noscript><div><div><div><div id="js_error_message"><p><img src="https://d1ge0kk1l5kms0.cloudfront.net/images/G/01/webservices/console/warning.png" alt="Aviso" /> <strong>JavaScript está desactivado o no está disponible en su navegador.</strong></p><p>Para utilizar la documentación de AWS, debe estar habilitado JavaScript. Para obtener más información, consulte las páginas de ayuda de su navegador.</p></div></div></div></div></noscript><div id="main-col-footer" class="awsui-util-font-size-0"><div id="doc-conventions"><a target="_top" href="/general/latest/gr/docconventions.html">Convenciones del documento</a></div><div class="prev-next"><div id="previous" class="prev-link" accesskey="p" href="./r_CREATE_DATASHARE.html">CREATE DATASHARE</div><div id="next" class="next-link" accesskey="n" href="./r_CREATE_EXTERNAL_SCHEMA.html">CREATE EXTERNAL SCHEMA</div></div></div><awsdocs-page-utilities></awsdocs-page-utilities></div><div id="quick-feedback-yes" style="display: none;"><div class="title">¿Le ha servido de ayuda esta página? - Sí</div><div class="content"><p>Gracias por hacernos saber que estamos haciendo un buen trabajo.</p><p>Si tiene un momento, díganos qué es lo que le ha gustado para que podamos seguir trabajando en esa línea.</p><p><awsui-button id="fblink" rel="noopener noreferrer" target="_blank" text="Comentarios" click="linkClick($event)" href="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=Redshift&amp;topic_url=https://docs.aws.amazon.com/es_es/redshift/latest/dg/r_CREATE_EXTERNAL_FUNCTION.html"></awsui-button></p></div></div><div id="quick-feedback-no" style="display: none;"><div class="title">¿Le ha servido de ayuda esta página? - No</div><div class="content"><p>Gracias por informarnos de que debemos trabajar en esta página. Lamentamos haberle defraudado.</p><p>Si tiene un momento, díganos cómo podemos mejorar la documentación.</p><p><awsui-button id="fblink" rel="noopener noreferrer" target="_blank" text="Comentarios" click="linkClick($event)" href="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=Redshift&amp;topic_url=https://docs.aws.amazon.com/es_es/redshift/latest/dg/r_CREATE_EXTERNAL_FUNCTION.html"></awsui-button></p></div></div></div></body></div></awsdocs-view><div class="page-loading-indicator" id="page-loading-indicator"><awsui-spinner size="large"></awsui-spinner></div></div><div id="tools-panel" dom-region="tools"><awsdocs-tools-panel id="awsdocs-tools-panel"></awsdocs-tools-panel></div></awsui-app-layout><awsdocs-cookie-banner class="doc-cookie-banner"></awsdocs-cookie-banner></div></body></html>