<!DOCTYPE html>
    <html xmlns="http://www.w3.org/1999/xhtml" lang="en-US"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Continue rolling back an update - AWS CloudFormation</title><meta name="viewport" content="width=device-width,initial-scale=1" /><meta name="assets_root" content="/assets" /><meta name="target_state" content="using-cfn-updating-stacks-continueupdaterollback" /><meta name="default_state" content="using-cfn-updating-stacks-continueupdaterollback" /><link rel="icon" type="image/ico" href="/assets/images/favicon.ico" /><link rel="shortcut icon" type="image/ico" href="/assets/images/favicon.ico" /><link rel="canonical" href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/using-cfn-updating-stacks-continueupdaterollback.html" /><meta name="description" content="For a stack in the UPDATE_ROLLBACK_FAILED state, fix the error that caused the failure and continue rolling back the update to return the stack to a working state (UPDATE_ROLLBACK_COMPLETE)." /><meta name="deployment_region" content="IAD" /><meta name="product" content="AWS CloudFormation" /><meta name="guide" content="User Guide" /><meta name="abstract" content="Create and manage AWS infrastructure deployments predictably and repeatedly using AWS CloudFormation with this User Guide." /><meta name="guide-locale" content="en_us" /><meta name="tocs" content="toc-contents.json" /><link rel="canonical" href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/using-cfn-updating-stacks-continueupdaterollback.html" /><link rel="alternative" href="https://docs.aws.amazon.com/id_id/AWSCloudFormation/latest/UserGuide/using-cfn-updating-stacks-continueupdaterollback.html" hreflang="id-id" /><link rel="alternative" href="https://docs.aws.amazon.com/id_id/AWSCloudFormation/latest/UserGuide/using-cfn-updating-stacks-continueupdaterollback.html" hreflang="id" /><link rel="alternative" href="https://docs.aws.amazon.com/de_de/AWSCloudFormation/latest/UserGuide/using-cfn-updating-stacks-continueupdaterollback.html" hreflang="de-de" /><link rel="alternative" href="https://docs.aws.amazon.com/de_de/AWSCloudFormation/latest/UserGuide/using-cfn-updating-stacks-continueupdaterollback.html" hreflang="de" /><link rel="alternative" href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/using-cfn-updating-stacks-continueupdaterollback.html" hreflang="en-us" /><link rel="alternative" href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/using-cfn-updating-stacks-continueupdaterollback.html" hreflang="en" /><link rel="alternative" href="https://docs.aws.amazon.com/es_es/AWSCloudFormation/latest/UserGuide/using-cfn-updating-stacks-continueupdaterollback.html" hreflang="es-es" /><link rel="alternative" href="https://docs.aws.amazon.com/es_es/AWSCloudFormation/latest/UserGuide/using-cfn-updating-stacks-continueupdaterollback.html" hreflang="es" /><link rel="alternative" href="https://docs.aws.amazon.com/fr_fr/AWSCloudFormation/latest/UserGuide/using-cfn-updating-stacks-continueupdaterollback.html" hreflang="fr-fr" /><link rel="alternative" href="https://docs.aws.amazon.com/fr_fr/AWSCloudFormation/latest/UserGuide/using-cfn-updating-stacks-continueupdaterollback.html" hreflang="fr" /><link rel="alternative" href="https://docs.aws.amazon.com/it_it/AWSCloudFormation/latest/UserGuide/using-cfn-updating-stacks-continueupdaterollback.html" hreflang="it-it" /><link rel="alternative" href="https://docs.aws.amazon.com/it_it/AWSCloudFormation/latest/UserGuide/using-cfn-updating-stacks-continueupdaterollback.html" hreflang="it" /><link rel="alternative" href="https://docs.aws.amazon.com/ja_jp/AWSCloudFormation/latest/UserGuide/using-cfn-updating-stacks-continueupdaterollback.html" hreflang="ja-jp" /><link rel="alternative" href="https://docs.aws.amazon.com/ja_jp/AWSCloudFormation/latest/UserGuide/using-cfn-updating-stacks-continueupdaterollback.html" hreflang="ja" /><link rel="alternative" href="https://docs.aws.amazon.com/ko_kr/AWSCloudFormation/latest/UserGuide/using-cfn-updating-stacks-continueupdaterollback.html" hreflang="ko-kr" /><link rel="alternative" href="https://docs.aws.amazon.com/ko_kr/AWSCloudFormation/latest/UserGuide/using-cfn-updating-stacks-continueupdaterollback.html" hreflang="ko" /><link rel="alternative" href="https://docs.aws.amazon.com/pt_br/AWSCloudFormation/latest/UserGuide/using-cfn-updating-stacks-continueupdaterollback.html" hreflang="pt-br" /><link rel="alternative" href="https://docs.aws.amazon.com/pt_br/AWSCloudFormation/latest/UserGuide/using-cfn-updating-stacks-continueupdaterollback.html" hreflang="pt" /><link rel="alternative" href="https://docs.aws.amazon.com/zh_cn/AWSCloudFormation/latest/UserGuide/using-cfn-updating-stacks-continueupdaterollback.html" hreflang="zh-cn" /><link rel="alternative" href="https://docs.aws.amazon.com/zh_tw/AWSCloudFormation/latest/UserGuide/using-cfn-updating-stacks-continueupdaterollback.html" hreflang="zh-tw" /><link rel="alternative" href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/using-cfn-updating-stacks-continueupdaterollback.html" hreflang="x-default" /><meta name="feedback-item" content="CloudFormation" /><meta name="this_doc_product" content="AWS CloudFormation" /><meta name="this_doc_guide" content="User Guide" /><script defer="" src="/assets/r/vendor4.js?version=2021.12.02"></script><script defer="" src="/assets/r/vendor3.js?version=2021.12.02"></script><script defer="" src="/assets/r/vendor1.js?version=2021.12.02"></script><script defer="" src="/assets/r/awsdocs-common.js?version=2021.12.02"></script><script defer="" src="/assets/r/awsdocs-doc-page.js?version=2021.12.02"></script><link href="/assets/r/vendor4.css?version=2021.12.02" rel="stylesheet" /><link href="/assets/r/awsdocs-common.css?version=2021.12.02" rel="stylesheet" /><link href="/assets/r/awsdocs-doc-page.css?version=2021.12.02" rel="stylesheet" /><script async="" id="awsc-panorama-bundle" type="text/javascript" src="https://prod.pa.cdn.uis.awsstatic.com/panorama-nav-init.js" data-config="{'appEntity':'aws-documentation','region':'us-east-1','service':'cloudformation'}"></script><meta id="panorama-serviceSubSection" value="User Guide" /><meta id="panorama-serviceConsolePage" value="Continue rolling back an update" /></head><body class="awsdocs awsui"><div class="awsdocs-container"><awsdocs-header></awsdocs-header><awsui-app-layout id="app-layout" class="awsui-util-no-gutters" ng-controller="ContentController as $ctrl" header-selector="awsdocs-header" navigation-hide="false" navigation-width="$ctrl.navWidth" navigation-open="$ctrl.navOpen" navigation-change="$ctrl.onNavChange($event)" tools-hide="$ctrl.hideTools" tools-width="$ctrl.toolsWidth" tools-open="$ctrl.toolsOpen" tools-change="$ctrl.onToolsChange($event)"><div id="guide-toc" dom-region="navigation"><awsdocs-toc></awsdocs-toc></div><div id="main-column" dom-region="content" tabindex="-1"><awsdocs-view class="awsdocs-view"><div id="awsdocs-content"><head><title>Continue rolling back an update - AWS CloudFormation</title><meta name="rss" content="aws-cloudformation-release-notes.rss" /><meta name="forums" content="http://forums.aws.amazon.com/forum.jspa?forumID=92" /><meta name="feedback" content="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=CloudFormation&amp;topic_url=https://docs.aws.amazon.com/en_us/AWSCloudFormation/latest/UserGuide/using-cfn-updating-stacks-continueupdaterollback.html" /><meta name="feedback-yes" content="feedbackyes.html?topic_url=https://docs.aws.amazon.com/en_us/AWSCloudFormation/latest/UserGuide/using-cfn-updating-stacks-continueupdaterollback.html" /><meta name="feedback-no" content="feedbackno.html?topic_url=https://docs.aws.amazon.com/en_us/AWSCloudFormation/latest/UserGuide/using-cfn-updating-stacks-continueupdaterollback.html" /><meta name="keywords" content="CloudFormation,AWSCloudFormation,resource provisioning,resource configuration,infrastructure management,CloudFormer,CloudFormation stack,CloudFormation stackset,CloudFormation template,change set" /><script type="application/ld+json">
{
    "@context" : "https://schema.org",
    "@type" : "BreadcrumbList",
    "itemListElement" : [
      {
        "@type" : "ListItem",
        "position" : 1,
        "name" : "AWS",
        "item" : "https://aws.amazon.com"
      },
      {
        "@type" : "ListItem",
        "position" : 2,
        "name" : "AWS CloudFormation",
        "item" : "https://docs.aws.amazon.com/cloudformation/index.html"
      },
      {
        "@type" : "ListItem",
        "position" : 3,
        "name" : "User Guide",
        "item" : "https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide"
      },
      {
        "@type" : "ListItem",
        "position" : 4,
        "name" : "Working with stacks",
        "item" : "https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/stacks.html"
      },
      {
        "@type" : "ListItem",
        "position" : 5,
        "name" : "AWS CloudFormation stack updates",
        "item" : "https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/using-cfn-updating-stacks.html"
      },
      {
        "@type" : "ListItem",
        "position" : 6,
        "name" : "Continue rolling back an update",
        "item" : "https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/using-cfn-updating-stacks.html"
      }
    ]
}
</script></head><body><div id="main"><div style="display: none"></div><div id="breadcrumbs" class="breadcrumb"><a href="https://aws.amazon.com">AWS</a><a href="/index.html">Documentation</a><a href="/cloudformation/index.html">AWS CloudFormation</a><a href="Welcome.html">User Guide</a></div><div id="page-toc-src"><a href="#nested-stacks">Using ResourcesToSkip to recover a nested stacks hierarchy</a></div><div id="main-content" class="awsui-util-container"><div id="main-col-body"><awsdocs-language-banner data-service="$ctrl.pageService"></awsdocs-language-banner><h1 class="topictitle" id="using-cfn-updating-stacks-continueupdaterollback">Continue rolling back an update</h1><div class="awsdocs-page-header-container"><awsdocs-page-header></awsdocs-page-header><awsdocs-filter-selector id="awsdocs-filter-selector"></awsdocs-filter-selector></div><p>A stack goes into the <code class="code">UPDATE_ROLLBACK_FAILED</code> state when AWS CloudFormation can't roll back
    all changes during an update. For example, you might have a stack that begins to roll back to an
    old database instance that was deleted outside of CloudFormation. Because CloudFormation doesn't know
    that the database was deleted, it assumes that the database instance still exists and attempts
    to roll back to it, causing the update rollback to fail.</p><p>When a stack is in the <code class="code">UPDATE_ROLLBACK_FAILED</code> state, you can continue to roll
    it back to a working state (<code class="code">UPDATE_ROLLBACK_COMPLETE</code>). You can't update a stack
    that is in the <code class="code">UPDATE_ROLLBACK_FAILED</code> state. However, if you can continue to roll
    it back, you can return the stack to its original settings and then try to update it
    again.</p><p>In most cases, you must fix the error that causes the update rollback to fail before you can continue to roll
  back your stack.  For more information, see . In other cases, you can continue to roll back the update without any
  changes, for example when a stack operation times out.</p><div class="awsdocs-note"><div class="awsdocs-note-title"><awsui-icon name="status-info" variant="link"></awsui-icon><h6>Note</h6></div><div class="awsdocs-note-text"><p>If you use nested stacks, rolling back the parent stack will attempt to roll back all the
      child stacks as well.</p></div></div><div class="procedure"><h6>To continue rolling back an update (console)</h6><ol><li><p>Open the AWS CloudFormation console at
         <a href="https://console.aws.amazon.com/cloudformation/" rel="noopener noreferrer" target="_blank"><span>https://console.aws.amazon.com/cloudformation</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a>.</p></li><li>
      <p>Select the stack that you want to update, choose <b>Stack actions</b>, and then
        choose <b>Continue update rollback</b>.</p>

      <p>If none of the solutions in the <a href="./troubleshooting.html#troubleshooting-errors">Troubleshooting errors</a> worked, you can use the advanced option to skip the resources that CloudFormation
    can't successfully roll back. You must <a href="./cfn-console-view-stack-data-resources.html">look up</a> and type
    the logical IDs of the resources that you want to skip. Specify only resources that went into the
     <code class="code">UPDATE_FAILED</code> state during the <code class="code">UpdateRollback</code> and not during the forward update.</p>
      <div class="awsdocs-note awsdocs-warning"><div class="awsdocs-note-title"><awsui-icon name="status-warning" variant="error"></awsui-icon><h6>Warning</h6></div><div class="awsdocs-note-text"><p>CloudFormation sets the status of the specified resources to <code class="code">UPDATE_COMPLETE</code> and
          continues to roll back the stack. After the rollback is complete, the state of the skipped
          resources will be inconsistent with the state of the resources in the stack template.
          Before performing another stack update, you must update the stack or resources to be
          consistent with each other. If you don't, subsequent stack updates might fail, and the
          stack will become unrecoverable.</p></div></div>
      <p>Specify the minimum number of resources required to successfully roll back your stack.
        For example, a failed resource update might cause dependent resources to fail. In this case,
        it might not be necessary to skip the dependent resources.</p>
      <p>To skip resources that are part of nested stacks, use the following format: <code class="code"><code class="replaceable">NestedStackName</code>.<code class="replaceable">ResourceLogicalID</code></code>. 
        If you want to specify the logical ID of a stack resource (<code class="code">Type: AWS::CloudFormation::Stack</code>) in the <code class="code">ResourcesToSkip</code> list, 
        then its corresponding embedded stack must be in one of the following states: <code class="code">DELETE_IN_PROGRESS</code>, <code class="code">DELETE_COMPLETE</code>, or <code class="code">DELETE_FAILED</code>.</p>
    </li></ol></div><div class="procedure"><h6>To continue rolling back an update (AWS CLI)</h6><ul><li>
   <p>Use the <code class="code"><a href="https://docs.aws.amazon.com/cli/latest/reference/cloudformation/continue-update-rollback.html">aws cloudformation continue-update-rollback</a></code> command with the <code class="code">stack-name</code> option to specify the ID
    of the stack that you want to continue to roll back.</p></li></ul></div><h2 id="nested-stacks">Using <code class="code">ResourcesToSkip</code> to recover a nested stacks hierarchy</h2>
    
    <p>The following diagram shows a nested stacks hierarchy that is in the
        <code class="code">UPDATE_ROLLBACK_FAILED</code> state. In this example, the <code class="code">WebInfra</code> root
      stack has two nested stacks: <code class="code">WebInfra-Compute</code> and <code class="code">WebInfra-Storage</code>,
      which in turn have one or more nested stacks.</p>
    <div class="mediaobject">
       
        <img src="/images/AWSCloudFormation/latest/UserGuide/images/cfn-update-stack-continue-update-rollback_nested-stacks.png" class="aws-docs-img-whiteBg aws-docs-img-padding" alt="&#xA;        A diagram showing a three-level nested stack hierarchy.&#xA;      " style="max-width:100%" />
       
       
    </div>
    <div class="awsdocs-note"><div class="awsdocs-note-title"><awsui-icon name="status-info" variant="link"></awsui-icon><h6>Note</h6></div><div class="awsdocs-note-text"><p>The stack names in this example are truncated for simplicity. Child stack names are
        typically generated by CloudFormation and contain unique random strings, so actual names might
        not be user-friendly.</p></div></div>      
    <p>To successfully get the root stack into an operable state using
        <code class="code">continue-update-rollback</code>, you must use the <code class="code">resources-to-skip</code>
      parameter to skip resources that failed to rollback. In this example,
        <code class="code">resources-to-skip</code> would include the following items:</p>
    <div class="orderedlist">
       
       
       
       
    <ol><li><p>myCustom</p></li><li><p>WebInfra-Compute-Asg.myAsg</p></li><li><p>WebInfra-Compute-LB.myLoadBalancer</p></li><li><p>WebInfra-Storage.DB</p></li></ol></div>
    <p>The following example is the full AWS CLI command:</p>
    <pre class="programlisting"><div class="code-btn-container"></div><code class="sh "><code class="prompt" copy="false">$ </code><code class="userinput">aws cloudformation continue-update-rollback --stack-name WebInfra \
    --resources-to-skip myCustom WebInfra-Compute-Asg.myAsg WebInfra-Compute-LB.myLoadBalancer WebInfra-Storage.DB</code></code></pre>
    <p>We specified resources from nested stacks by using the
          <code class="code"><code class="replaceable">NestedStackName</code>.<code class="replaceable">ResourceLogicalID</code></code>
      format, but for the resources of the root stack, such as <em>myCustom</em>, we
      specified only the logical ID.</p>
    <p><b>Finding the stack name of a nested stack</b></p>
    <p>You can find a child stack's name in its stack ID or Amazon Resource Name (ARN). In the following example, the stack name is <em>WebInfra-Storage-Z2VKC706XKXT</em>:</p>
    <p><code class="code">arn:aws:cloudformation:us-east-1:123456789012:stack/WebInfra-Storage-Z2VKC706XKXT/ea9e7f90-54f7-11e6-a032-028f3d2330bd</code></p>  
    <p><b>Finding the logical ID of a nested stack</b></p>
    <p>You can find a child stack's logical ID in the template definition of its parent. In the diagram, the <code class="code">LogicalId</code> of the <code class="code">WebInfra-Storage-DB</code> child stack is <em>DB</em> in its parent <code class="code">WebInfra-Storage</code>.</p>
    <p>In the CloudFormation console, you can also find the logical ID in the <b>Logical ID</b> column for the stack resource on the <b>Resources</b> tab or the <b>Events</b> tab.</p>
<awsdocs-copyright class="copyright-print"></awsdocs-copyright><awsdocs-thumb-feedback right-edge="{{$ctrl.thumbFeedbackRightEdge}}"></awsdocs-thumb-feedback></div><noscript><div><div><div><div id="js_error_message"><p><img src="https://d1ge0kk1l5kms0.cloudfront.net/images/G/01/webservices/console/warning.png" alt="Warning" /> <strong>Javascript is disabled or is unavailable in your browser.</strong></p><p>To use the Amazon Web Services Documentation, Javascript must be enabled. Please refer to your browser's Help pages for instructions.</p></div></div></div></div></noscript><div id="main-col-footer" class="awsui-util-font-size-0"><div id="doc-conventions"><a target="_top" href="/general/latest/gr/docconventions.html">Document Conventions</a></div><div class="prev-next"><div id="previous" class="prev-link" accesskey="p" href="./protect-stack-resources.html">Prevent updates to stack resources</div><div id="next" class="next-link" accesskey="n" href="./using-cfn-stack-drift.html">Detecting unmanaged configuration changes to stacks and resources</div></div></div><awsdocs-page-utilities></awsdocs-page-utilities></div><div id="quick-feedback-yes" style="display: none;"><div class="title">Did this page help you? - Yes</div><div class="content"><p>Thanks for letting us know we're doing a good job!</p><p>If you've got a moment, please tell us what we did right so we can do more of it.</p><p><awsui-button id="fblink" rel="noopener noreferrer" target="_blank" text="Feedback" click="linkClick($event)" href="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=CloudFormation&amp;topic_url=https://docs.aws.amazon.com/en_us/AWSCloudFormation/latest/UserGuide/using-cfn-updating-stacks-continueupdaterollback.html"></awsui-button></p></div></div><div id="quick-feedback-no" style="display: none;"><div class="title">Did this page help you? - No</div><div class="content"><p>Thanks for letting us know this page needs work. We're sorry we let you down.</p><p>If you've got a moment, please tell us how we can make the documentation better.</p><p><awsui-button id="fblink" rel="noopener noreferrer" target="_blank" text="Feedback" click="linkClick($event)" href="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=CloudFormation&amp;topic_url=https://docs.aws.amazon.com/en_us/AWSCloudFormation/latest/UserGuide/using-cfn-updating-stacks-continueupdaterollback.html"></awsui-button></p></div></div></div></body></div></awsdocs-view><div class="page-loading-indicator" id="page-loading-indicator"><awsui-spinner size="large"></awsui-spinner></div></div><div id="tools-panel" dom-region="tools"><awsdocs-tools-panel id="awsdocs-tools-panel"></awsdocs-tools-panel></div></awsui-app-layout><awsdocs-cookie-banner class="doc-cookie-banner"></awsdocs-cookie-banner></div></body></html>