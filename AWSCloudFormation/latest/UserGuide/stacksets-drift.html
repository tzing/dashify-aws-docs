<!DOCTYPE html>
    <html xmlns="http://www.w3.org/1999/xhtml" lang="en-US"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Detecting unmanaged configuration changes in stack sets - AWS CloudFormation</title><meta name="viewport" content="width=device-width,initial-scale=1" /><meta name="assets_root" content="/assets" /><meta name="target_state" content="stacksets-drift" /><meta name="default_state" content="stacksets-drift" /><link rel="icon" type="image/ico" href="/assets/images/favicon.ico" /><link rel="shortcut icon" type="image/ico" href="/assets/images/favicon.ico" /><link rel="canonical" href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/stacksets-drift.html" /><meta name="description" content="Even as you manage your stacks and the resources they contain through CloudFormation, users can change those resources outside of CloudFormation. Users can edit resources directly by using the underlying service that created the resource. By performing drift detection on a stack set, you can determine if any of the stack instances belonging to that stack set differ, or have" /><meta name="deployment_region" content="IAD" /><meta name="product" content="AWS CloudFormation" /><meta name="guide" content="User Guide" /><meta name="abstract" content="Create and manage AWS infrastructure deployments predictably and repeatedly using AWS CloudFormation with this User Guide." /><meta name="guide-locale" content="en_us" /><meta name="tocs" content="toc-contents.json" /><link rel="canonical" href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/stacksets-drift.html" /><link rel="alternative" href="https://docs.aws.amazon.com/id_id/AWSCloudFormation/latest/UserGuide/stacksets-drift.html" hreflang="id-id" /><link rel="alternative" href="https://docs.aws.amazon.com/id_id/AWSCloudFormation/latest/UserGuide/stacksets-drift.html" hreflang="id" /><link rel="alternative" href="https://docs.aws.amazon.com/de_de/AWSCloudFormation/latest/UserGuide/stacksets-drift.html" hreflang="de-de" /><link rel="alternative" href="https://docs.aws.amazon.com/de_de/AWSCloudFormation/latest/UserGuide/stacksets-drift.html" hreflang="de" /><link rel="alternative" href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/stacksets-drift.html" hreflang="en-us" /><link rel="alternative" href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/stacksets-drift.html" hreflang="en" /><link rel="alternative" href="https://docs.aws.amazon.com/es_es/AWSCloudFormation/latest/UserGuide/stacksets-drift.html" hreflang="es-es" /><link rel="alternative" href="https://docs.aws.amazon.com/es_es/AWSCloudFormation/latest/UserGuide/stacksets-drift.html" hreflang="es" /><link rel="alternative" href="https://docs.aws.amazon.com/fr_fr/AWSCloudFormation/latest/UserGuide/stacksets-drift.html" hreflang="fr-fr" /><link rel="alternative" href="https://docs.aws.amazon.com/fr_fr/AWSCloudFormation/latest/UserGuide/stacksets-drift.html" hreflang="fr" /><link rel="alternative" href="https://docs.aws.amazon.com/it_it/AWSCloudFormation/latest/UserGuide/stacksets-drift.html" hreflang="it-it" /><link rel="alternative" href="https://docs.aws.amazon.com/it_it/AWSCloudFormation/latest/UserGuide/stacksets-drift.html" hreflang="it" /><link rel="alternative" href="https://docs.aws.amazon.com/ja_jp/AWSCloudFormation/latest/UserGuide/stacksets-drift.html" hreflang="ja-jp" /><link rel="alternative" href="https://docs.aws.amazon.com/ja_jp/AWSCloudFormation/latest/UserGuide/stacksets-drift.html" hreflang="ja" /><link rel="alternative" href="https://docs.aws.amazon.com/ko_kr/AWSCloudFormation/latest/UserGuide/stacksets-drift.html" hreflang="ko-kr" /><link rel="alternative" href="https://docs.aws.amazon.com/ko_kr/AWSCloudFormation/latest/UserGuide/stacksets-drift.html" hreflang="ko" /><link rel="alternative" href="https://docs.aws.amazon.com/pt_br/AWSCloudFormation/latest/UserGuide/stacksets-drift.html" hreflang="pt-br" /><link rel="alternative" href="https://docs.aws.amazon.com/pt_br/AWSCloudFormation/latest/UserGuide/stacksets-drift.html" hreflang="pt" /><link rel="alternative" href="https://docs.aws.amazon.com/zh_cn/AWSCloudFormation/latest/UserGuide/stacksets-drift.html" hreflang="zh-cn" /><link rel="alternative" href="https://docs.aws.amazon.com/zh_tw/AWSCloudFormation/latest/UserGuide/stacksets-drift.html" hreflang="zh-tw" /><link rel="alternative" href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/stacksets-drift.html" hreflang="x-default" /><meta name="feedback-item" content="CloudFormation" /><meta name="this_doc_product" content="AWS CloudFormation" /><meta name="this_doc_guide" content="User Guide" /><script defer="" src="/assets/r/vendor4.js?version=2021.12.02"></script><script defer="" src="/assets/r/vendor3.js?version=2021.12.02"></script><script defer="" src="/assets/r/vendor1.js?version=2021.12.02"></script><script defer="" src="/assets/r/awsdocs-common.js?version=2021.12.02"></script><script defer="" src="/assets/r/awsdocs-doc-page.js?version=2021.12.02"></script><link href="/assets/r/vendor4.css?version=2021.12.02" rel="stylesheet" /><link href="/assets/r/awsdocs-common.css?version=2021.12.02" rel="stylesheet" /><link href="/assets/r/awsdocs-doc-page.css?version=2021.12.02" rel="stylesheet" /><script async="" id="awsc-panorama-bundle" type="text/javascript" src="https://prod.pa.cdn.uis.awsstatic.com/panorama-nav-init.js" data-config="{'appEntity':'aws-documentation','region':'us-east-1','service':'cloudformation'}"></script><meta id="panorama-serviceSubSection" value="User Guide" /><meta id="panorama-serviceConsolePage" value="Detecting unmanaged configuration changes in stack sets" /></head><body class="awsdocs awsui"><div class="awsdocs-container"><awsdocs-header></awsdocs-header><awsui-app-layout id="app-layout" class="awsui-util-no-gutters" ng-controller="ContentController as $ctrl" header-selector="awsdocs-header" navigation-hide="false" navigation-width="$ctrl.navWidth" navigation-open="$ctrl.navOpen" navigation-change="$ctrl.onNavChange($event)" tools-hide="$ctrl.hideTools" tools-width="$ctrl.toolsWidth" tools-open="$ctrl.toolsOpen" tools-change="$ctrl.onToolsChange($event)"><div id="guide-toc" dom-region="navigation"><awsdocs-toc></awsdocs-toc></div><div id="main-column" dom-region="content" tabindex="-1"><awsdocs-view class="awsdocs-view"><div id="awsdocs-content"><head><title>Detecting unmanaged configuration changes in stack sets - AWS CloudFormation</title><meta name="rss" content="aws-cloudformation-release-notes.rss" /><meta name="forums" content="http://forums.aws.amazon.com/forum.jspa?forumID=92" /><meta name="feedback" content="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=CloudFormation&amp;topic_url=https://docs.aws.amazon.com/en_us/AWSCloudFormation/latest/UserGuide/stacksets-drift.html" /><meta name="feedback-yes" content="feedbackyes.html?topic_url=https://docs.aws.amazon.com/en_us/AWSCloudFormation/latest/UserGuide/stacksets-drift.html" /><meta name="feedback-no" content="feedbackno.html?topic_url=https://docs.aws.amazon.com/en_us/AWSCloudFormation/latest/UserGuide/stacksets-drift.html" /><meta name="keywords" content="CloudFormation,AWSCloudFormation,resource provisioning,resource configuration,infrastructure management,CloudFormer,CloudFormation stack,CloudFormation stackset,CloudFormation template,change set" /><script type="application/ld+json">
{
    "@context" : "https://schema.org",
    "@type" : "BreadcrumbList",
    "itemListElement" : [
      {
        "@type" : "ListItem",
        "position" : 1,
        "name" : "AWS",
        "item" : "https://aws.amazon.com"
      },
      {
        "@type" : "ListItem",
        "position" : 2,
        "name" : "AWS CloudFormation",
        "item" : "https://docs.aws.amazon.com/cloudformation/index.html"
      },
      {
        "@type" : "ListItem",
        "position" : 3,
        "name" : "User Guide",
        "item" : "https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide"
      },
      {
        "@type" : "ListItem",
        "position" : 4,
        "name" : "Working with AWS CloudFormation StackSets",
        "item" : "https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/what-is-cfnstacksets.html"
      },
      {
        "@type" : "ListItem",
        "position" : 5,
        "name" : "Detecting unmanaged configuration changes in stack sets",
        "item" : "https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/what-is-cfnstacksets.html"
      }
    ]
}
</script></head><body><div id="main"><div style="display: none"></div><div id="breadcrumbs" class="breadcrumb"><a href="https://aws.amazon.com">AWS</a><a href="/index.html">Documentation</a><a href="/cloudformation/index.html">AWS CloudFormation</a><a href="Welcome.html">User Guide</a></div><div id="page-toc-src"><a href="#stacksets-drift-how">How CloudFormation performs drift detection on a
                stack set</a><a href="#stacksets-drift-stop">Stopping drift detection on a stack set</a></div><div id="main-content" class="awsui-util-container"><div id="main-col-body"><awsdocs-language-banner data-service="$ctrl.pageService"></awsdocs-language-banner><h1 class="topictitle" id="stacksets-drift">Detecting unmanaged configuration changes in stack sets</h1><div class="awsdocs-page-header-container"><awsdocs-page-header></awsdocs-page-header><awsdocs-filter-selector id="awsdocs-filter-selector"></awsdocs-filter-selector></div><p>Even as you manage your stacks and the resources they contain through CloudFormation, users
        can change those resources outside of CloudFormation. Users can edit resources directly by using
        the underlying service that created the resource. By performing drift detection on a stack
        set, you can determine if any of the stack instances belonging to that stack set differ, or
        have <em>drifted</em>, from their expected configuration.</p>
        <h2 id="stacksets-drift-how">How CloudFormation performs drift detection on a
                stack set</h2>
        <p>When CloudFormation performs drift detection on a stack set, it performs drift detection
            on the stack associated with each stack instance in the stack set. To do this,
            CloudFormation compares the current state of each resource in the stack with the
            expected state of that resource, as defined in the stack's template and any specified
            input parameters. If the current state of a resource varies from its expected state,
            that resource is considered to have drifted. If one or more resources in a stack have
            drifted, then the stack itself is considered to have drifted, and the stack instances
            that the stack is associated with is considered to have drifted as well. If one or more
            stack instances in a stack set have drifted, the stack set itself is considered to have
            drifted.</p>
        <p>Drift detection identifies unmanaged changes; that is, changes made to stacks outside
            of CloudFormation. Changes made through CloudFormation to a stack directly, rather than
            at the stack-set level, aren't considered drift. For example, suppose you have a stack
            that is associated with a stack instance of a stack set. If you use CloudFormation to
            update that stack to use a different template, that is not considered drift, even though
            that stack now has a different template than any other stacks belonging to the stack
            set. This is because the stack still matches its expected template and parameter
            configuration in CloudFormation.</p>
        <p>For detailed information on how CloudFormation performs drift detection on a stack, see
                <a href="./using-cfn-stack-drift.html">Detecting unmanaged configuration changes to stacks and resources</a>.</p>
        <p>Because CloudFormation performs drift detection on each stack individually, it takes
            any overridden parameter values into account when determining whether a stack has
            drifted. For more information on overriding template parameters in stack instances, see
                <a href="./stackinstances-override.html">Override parameters on stack instances</a>.</p>
        <p>If you perform drift detection <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/using-cfn-stack-drift.html">directly on a
                stack</a> that is associated with a stack instance, those drift results aren't
            available from the <b>StackSets</b> console page.</p>

    <div class="procedure"><h6>To detect drift on a stack set using the AWS Management Console</h6><ol><li><p>Open the AWS CloudFormation console at
         <a href="https://console.aws.amazon.com/cloudformation/" rel="noopener noreferrer" target="_blank"><span>https://console.aws.amazon.com/cloudformation</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a>.</p></li><li>
            <p>On the <b>StackSets</b> page, select the stack set on which you want
                to perform drift detection.</p>
        </li><li>
            <p>From the <b>Actions</b> menu, select <b>Detect
                    drifts</b>.</p>
            <p>CloudFormation displays an information bar stating that drift detection has been
                initiated for the selected stack set.</p>
        </li><li>
            <p>Optional: To monitor the progress of the drift detection operation:</p>
            <ol><li>
                    <p>Select the stack set name to display the <b>Stackset
                            details</b> page.</p>
                </li><li>
                    <p>Select the <b>Operations</b> tab, select the drift detection
                        operation, and then select <b>View drift details</b>.</p>
                </li></ol>
            <p>CloudFormation displays the <b>Operation details</b> dialog box.</p>
        </li><li>
            <p>Wait until CloudFormation completes the drift detection operation. When the drift
                detection operation completes, CloudFormation updates <b>Drift
                    status</b> and <b>Last drift check time</b> for your stack
                set. These fields are listed on the <b>Overview</b> tab of the
                    <b>StackSet details</b> page for the selected stack set.</p>
            <p>The drift detection operation may take some time, depending on the number of stack
                instances included in the stack set, and the number of resources included in the
                stack set. You can only run a single drift detection operation on a given stack set
                at one time. CloudFormation continues the drift detection operation even after you
                dismiss the information bar.</p>
        </li><li>
            <p>To review the drift detection results for the stack instances in a stack set,
                select the <b>Stack instances</b> tab.</p>
            <p>The <b>Stack name</b> column lists the name of the stack associated
                with each stack instance, and the <b>Drift status</b> column lists the
                drift status of that stack. A stack is considered to have drifted if one or more of
                its resources have drifted.</p>
        </li><li>
            <p>To review the drift detection results for the stack associated with a specific
                stack instance:</p>
            <ol><li>
                    <p>Choose the <b>Operations</b> tab.</p>
                </li><li>
                    <p>Select the drift operation you want to view drift detection results for. A
                        split panel will display the stack instance status and reason for the
                        selected operation. For a drift operation, the status reason column shows
                        the drift status of a stack instance.</p>
                </li><li>
                    <p>Choose the stack instance you want to view drift details for, and choose
                            <b>View resource drifts</b>. In the <b>Resource
                            drift status</b> table on the <b>Resource
                            Drifts</b> page, each stack resource is listed with its drift
                        status and the last time drift detection was initiated on the resource. The
                        logical ID and physical ID of each resource is displayed to help you
                        identify them.</p>
                </li></ol>
        </li><li>
            <p>You can sort the resources based on their drift status using the <b>Drift
                    status</b> column.</p>
            <p>To view the details on a modified resource:</p>
            <ol><li>
                    <p>With the resource selected, choose <b>View drift
                        details</b>.</p>
                    <p>CloudFormation displays the drift detail page for that particular
                        resource. This page lists the resource's differences. It also lists the
                        resource's expected and current property values.</p>
                    <div class="awsdocs-note"><div class="awsdocs-note-title"><awsui-icon name="status-info" variant="link"></awsui-icon><h6>Note</h6></div><div class="awsdocs-note-text"><p>If the stack belongs to a different Region and account than the one
                            you're currently signed into, the <b>Detect drift</b>
                            button will be disabled and you will be unable to view the
                            details.</p></div></div>
                </li></ol>
            <div class="mediaobject">
                 
                    <img src="/images/AWSCloudFormation/latest/UserGuide/images/console-stacks-drifts-drift-details-differences-1.png" class="aws-docs-img-whiteBg aws-docs-img-padding" alt="&#xA;                    The Resource drift status section of the&#xA;                            Drift Details page, which contains drift&#xA;                        information for each resource in the stack that supports drift detection.&#xA;                        Details include drift status and expected and current property&#xA;                        values.&#xA;                " style="max-width:100%" />
                 
                 
            </div>

        </li></ol></div><div class="procedure"><h6>To detect drift on a stack set using the AWS CLI</h6><p>To detect drift on an entire stack using the AWS CLI, use the following <code class="code">aws
                cloudformation</code> commands:</p><div class="itemizedlist">
             
             
             
        <ul class="itemizedlist"><li class="listitem">
                <p><code class="code"><a href="https://docs.aws.amazon.com/cli/latest/reference/cloudformation/detect-stack-set-drift.html">detect-stack-set-drift</a></code> to initiate a drift detection
                    operation on a stack.</p>
            </li><li class="listitem">
                <p><code class="code"><a href="https://docs.aws.amazon.com/cli/latest/reference/cloudformation/describe-stack-set-operation.html">describe-stack-set-operation</a></code> to monitor the status of
                    the stack drift detection operation.</p>
            </li><li class="listitem">
                <p>Once the drift detection operation has completed, use the following commands
                    to return drift information you want:</p>
                <div class="itemizedlist">
                     
                     
                     
                     
                     
                <ul class="itemizedlist"><li class="listitem">
                        <p>Use <code class="code"><a href="https://docs.aws.amazon.com/cli/latest/reference/cloudformation/describe-stack-set.html">describe-stack-set</a></code> to return detailed
                            information about the stack set, including detailed information about
                            the last <em>completed</em> drift operation performed on the
                            stack set. (Information about drift operations that are in progress
                            isn't included.)</p>
                    </li><li class="listitem">
                        <p>Use <code class="code"><a href="https://docs.aws.amazon.com/cli/latest/reference/cloudformation/list-stack-instances.html">list-stack-instances</a></code> to return a list of stack
                            instances belonging to the stack set, including the drift status and
                            last drift time checked of each instance.</p>
                    </li><li class="listitem">
                        <p>Use <code class="code"><a href="https://docs.aws.amazon.com/cli/latest/reference/cloudformation/describe-stack-instance.html">describe-stack-instance</a></code> to return detailed
                            information about a specific stack instance, including its drift status
                            and last drift time checked.</p>
                    </li><li class="listitem">
                        <p>Use <code class="code"><a href="https://docs.aws.amazon.com/cli/latest/reference/cloudformation/list-stack-instance-resource-drifts.html">list-stack-instance-resource-drifts</a></code> to return
                            detailed information about the drift status of each resource in a stack
                            instance.</p>
                    </li><li class="listitem">
                        <p>Use <code class="code"><a href="https://docs.aws.amazon.com/cli/latest/reference/cloudformation/stack-instance-resource-drifts-summary.html">stack-instance-resource-drifts-summary</a></code> to return summary information about resource drifts for a stack instance.</p>
                    </li></ul></div>
            </li></ul></div><ol><li>
            <p>Use <code class="code">detect-stack-set-drift</code> to detect drift on an entire stack set and
                its associated stack instances.</p>
            <p>The following example initiates drift detection on the stack set
                    <code class="code">stack-set-drift-example</code>.</p>

            <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="sh "><code class="prompt" copy="false">$ </code><code class="userinput">aws cloudformation detect-stack-set-drift \
    --stack-set-name stack-set-drift-example</code>
<code class="computeroutput" copy="false"><span>{</span>
    "OperationId": "c36e44aa-3a83-411a-b503-cb611example"
}</code></code></pre>
        </li><li>
            <p>Because stack set drift detection operations can be a long-running operation, use
                    <code class="code">describe-stack-set-operation</code> to monitor the status of drift
                operation. This command takes the stack set operation ID returned by the
                    <code class="code">detect-stack-set-drift</code> command.</p>
            <p>The following examples uses the operation ID from the previous example to return
                information on the stack set drift detection operation. In this example, the
                operation is still running. Of the seven stack instances associated with this stack
                set, one stack instance has already been found to have drifted, two instances are in
                sync , and drift detection for the remaining four stack instances is still in
                progress. Because one instance has drifted, the drift status of the stack set itself
                is now <code class="code">DRIFTED</code>.</p>
            <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="sh "><code class="prompt" copy="false">$ </code><code class="userinput">aws cloudformation describe-stack-set-operation \
    --stack-set-name stack-set-drift-example \
    --operation-id c36e44aa-3a83-411a-b503-cb611example</code>
<code class="computeroutput" copy="false">
<span>{</span>
    "StackSetOperation": <span>{</span>
        "Status": "RUNNING",
        "AdministrationRoleARN": "arn:aws:iam::123456789012:role/AWSCloudFormationStackSetAdministrationRole",
        "OperationPreferences": <span>{</span>
            "RegionOrder": []
        },
        "ExecutionRoleName": "AWSCloudFormationStackSetExecutionRole",
        "StackSetDriftDetectionDetails": <span>{</span>
            "DriftedStackInstancesCount": 1,
            "TotalStackInstancesCount": 7,
            "LastDriftCheckTimestamp": "2019-12-04T20:34:28.543Z",
            "InSyncStackInstancesCount": 2,
            "InProgressStackInstancesCount": 4,
            "DriftStatus": "DRIFTED",
            "FailedStackInstancesCount": 0
        },
        "Action": "DETECT_DRIFT",
        "CreationTimestamp": "2019-12-04T20:33:13.673Z",
        "StackSetId": "stack-set-drift-example:bd1f4017-d4f9-432e-a73f-8c22example",
        "OperationId": "c36e44aa-3a83-411a-b503-cb611example"
    }
}</code></code></pre>
            <p>Performing the same command later, this example shows the information returned
                once the drift detection operation has completed. Two of the seven total stack
                instances associated with this stack set have drifted, rendering the drift status of
                the stack set itself as <code class="code">DRIFTED</code>.</p>
            <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="sh "><code class="prompt" copy="false">$ </code><code class="userinput">aws cloudformation describe-stack-set-operation \
    --stack-set-name stack-set-drift-example \
    --operation-id c36e44aa-3a83-411a-b503-cb611example</code>
<code class="computeroutput" copy="false">
<span>{</span>
    "StackSetOperation": <span>{</span>
        "Status": "SUCCEEDED",
        "AdministrationRoleARN": "arn:aws:iam::123456789012:role/AWSCloudFormationStackSetAdministrationRole",
        "OperationPreferences": <span>{</span>
            "RegionOrder": []
        } 
        "ExecutionRoleName": "AWSCloudFormationStackSetExecutionRole",
        "EndTimestamp": "2019-12-04T20:37:32.829Z",
        "StackSetDriftDetectionDetails": <span>{</span>
            "DriftedStackInstancesCount": 2,
            "TotalStackInstancesCount": 7,
            "LastDriftCheckTimestamp": "2019-12-04T20:36:55.612Z",
            "InSyncStackInstancesCount": 5,
            "InProgressStackInstancesCount": 0,
            "DriftStatus": "DRIFTED",
            "FailedStackInstancesCount": 0
        },
        "Action": "DETECT_DRIFT",
        "CreationTimestamp": "2019-12-04T20:33:13.673Z",
        "StackSetId": "stack-set-drift-example:bd1f4017-d4f9-432e-a73f-8c22example",
        "OperationId": "c36e44aa-3a83-411a-b503-cb611example"
    }
}</code></code></pre>
        </li><li>
            <p>When the stack set drift detection operation is complete, use the
                    <code class="code">describe-stack-set</code>, <code class="code">list-stack-instances</code>,
                    <code class="code">describe-stack-instance</code>, and
                    <code class="code">list-stack-instance-resource-drifts</code> commands to review the
                results.</p>
            <p>The <code class="code">describe-stack-set</code> command includes the same detailed drift
                information returned by the <code class="code">describe-stack-set-operation</code>
                command.</p>
            <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="sh "><code class="prompt" copy="false">$ </code><code class="userinput">aws cloudformation describe-stack-set \
    --stack-set-name stack-set-drift-example</code>
<code class="computeroutput" copy="false"><span>{</span>
    "StackSet": <span>{</span>
        "Status": "ACTIVE",
        "Description": "Demonstration of drift detection on stack sets.",
        "Parameters": [],
        "Tags": [
            <span>{</span>
                "Value": "Drift detection",
                "Key": "Feature"
            }
        ], 
        "ExecutionRoleName": "AWSCloudFormationStackSetExecutionRole",
        "Capabilities": [],
        "AdministrationRoleARN": "arn:aws:iam::123456789012:role/AWSCloudFormationStackSetAdministrationRole",
        "StackSetDriftDetectionDetails": <span>{</span>
            "DriftedStackInstancesCount": 2,
            "TotalStackInstancesCount": 7,
            "LastDriftCheckTimestamp": "2019-12-04T20:36:55.612Z",
            "InProgressStackInstancesCount": 0,
            "DriftStatus": "DRIFTED",
            "DriftDetectionStatus": "COMPLETED",
            "InSyncStackInstancesCount": 5,
            "FailedStackInstancesCount": 0
        },
        "StackSetARN": "arn:aws:cloudformation:us-east-1:123456789012:stackset/stack-set-drift-example:bd1f4017-d4f9-432e-a73f-8c22example",
        "TemplateBody": [details omitted],
        "StackSetId": "stack-set-drift-example:bd1f4017-d4f9-432e-a73f-8c22ebexample",
        "StackSetName": "stack-set-drift-example"
    }
}</code></code></pre>
            <p>You can use the <code class="code">list-stack-instances</code> command to return summary
                information about the stack instances associated with a stack set, including the
                drift status of each stack instance.</p>
            <p>In this example, executing <code class="code">list-stack-instances</code> on the example stack
                set with the drift status filter set to <code class="code">DRIFTED</code> enables you to identify
                which two stack instances have a drift status of <code class="code">DRIFTED</code>.</p>
            <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="sh "><code class="prompt" copy="false">$ </code><code class="userinput">aws cloudformation list-stack-instances \
    --stack-set-name stack-set-drift-example \
    --filters Name=DRIFT_STATUS,Values=DRIFTED</code>
<code class="computeroutput" copy="false"><span>{</span>
"Summaries": [
        <span>{</span>
"StackId": "arn:aws:cloudformation:eu-west-1:123456789012:stack/StackSet-stack-set-drift-example-b0fb6083-60c0-4e39-af15-2f071e0db90c/0e4f0940-16d4-11ea-93d8-0641cexample",
            "Status": "CURRENT",
            "Account": "012345678910",
            "Region": "eu-west-1",
            "LastDriftCheckTimestamp": "2019-12-04T20:37:32.687Z",
            "DriftStatus": "DRIFTED",
            "StackSetId": "stack-set-drift-example:bd1f4017-d4f9-432e-a73f-8c22eexample
            "LastOperationId": "c36e44aa-3a83-411a-b503-cb611example"
        },
        <span>{</span>
            "StackId": "arn:aws:cloudformation:us-east-1:123456789012:stack/StackSet-stack-set-drift-example-b7fde68e-e541-44c2-b33d-ef2e2988071a/008e6030-16d4-11ea-8090-12f89example",
            "Status": "CURRENT",
            "Account": "123456789012",
            "Region": "us-east-1",
            "LastDriftCheckTimestamp": "2019-12-04T20:34:28.275Z",
            "DriftStatus": "DRIFTED",
            "StackSetId": "stack-set-drift-example:bd1f4017-d4f9-432e-a73f-8c22eexample"
            "LastOperationId": "c36e44aa-3a83-411a-b503-cb611example"
        },
        
        [additional stack instances omitted]
 
    ]
}</code></code></pre>
            <p>The <code class="code">describe-stack-instance</code> command also returns this information,
                but for a single stack instance, as in the example below.</p>

            <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="sh "><code class="prompt" copy="false">$ </code><code class="userinput">aws cloudformation describe-stack-instance \
    --stack-set-name stack-set-drift-example \
    --stack-instance-account 012345678910 --stack-instance-region us-east-1</code>
<code class="computeroutput" copy="false"><span>{</span>
    "StackInstance": <span>{</span>
        "StackId": "arn:aws:cloudformation:us-east-1:123456789012:stack/StackSet-stack-set-drift-example-b7fde68e-e541-44c2-b33d-ef2e2988071a/008e6030-16d4-11ea-8090-12f89example",
        "Status": "CURRENT",
        "Account": "123456789012",
        "Region": "us-east-1",
        "ParameterOverrides": [],
        "DriftStatus": "DRIFTED",
        "LastDriftCheckTimestamp": "2019-12-04T20:34:28.275Z",
        "StackSetId": "stack-set-drift-example:bd1f4017-d4f9-432e-a73f-8c22eexample"
        "LastOperationId": "c36e44aa-3a83-411a-b503-cb611example"
    }
}</code></code></pre>
        </li><li>
            <p>Once you've identified which stack instances have drifted, you can use the
                information about the stack instances that is returned by the
                    <code class="code">list-stack-instances</code> or <code class="code">describe-stack-instance</code>
                commands to execute <a href="https://docs.aws.amazon.com/cli/latest/reference/cloudformation/list-stack-instance-resource-drifts.html">list-stack-instance-resource-drifts</a>. This command returns detailed
                information about which resources in the stack have drifted for a particular drift
                operation.</p>
            <p>The following example uses the <code class="code">stack-instance-resource-drift-statuses</code>
                parameter to request stack drift information for the resources that have been
                modified or deleted in the previous drift operation example. The request returns
                information on the one resource that has been modified, including details about two
                of its properties and their changed values. No resources have been deleted.</p>
            <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="sh "><code class="prompt" copy="false">$ </code><code class="userinput">aws cloudformation list-stack-instance-resource-drifts \
    --stack-set-name my-stack-set-with-resource-drift \
    --stack-instance-account 123456789012 \
    --stack-instance-region us-east-1 \
    --operation-id c36e44aa-3a83-411a-b503-cb611example \
    --stack-instance-resource-drift-statuses MODIFIED DELETED</code>

<code class="computeroutput" copy="false"><span>{</span>
    "Summaries": [
        <span>{</span>
            "StackId": "arn:aws:cloudformation:us-east-1:123456789012:stack/my-stack-set-with-resource-drift/489e5570-df85-11e7-a7d9-50example",
            "ResourceType": "AWS::SQS::Queue",
            "Timestamp": "2018-03-26T17:23:34.489Z",
            "PhysicalResourceId": "https://sqs.us-east-1.amazonaws.com/123456789012/my-stack-with-resource-drift-Queue-494PBHCO76H4",
            "StackResourceDriftStatus": "MODIFIED",
            "PropertyDifferences": [
                <span>{</span>
                    "PropertyPath": "/DelaySeconds",
                    "ActualValue": "120",
                    "ExpectedValue": "20",
                    "DifferenceType": "NOT_EQUAL"
                },
                <span>{</span>
                    "PropertyPath": "/RedrivePolicy/maxReceiveCount",
                    "ActualValue": "12",
                    "ExpectedValue": "10",
                    "DifferenceType": "NOT_EQUAL"
                }
            ],
            "LogicalResourceId": "Queue"
        }
    ]
}</code></code></pre>
        </li></ol></div>
        <h2 id="stacksets-drift-stop">Stopping drift detection on a stack set</h2>
        <p>Because drift detection on a stack set can be a long-running operation, there may be
            instances when you want to stop a drift detection operation that is currently running on
            a stack set.</p>
        <div class="procedure"><h6>To stop drift detection on a stack set using the
                AWS Management Console</h6><ol><li><p>Open the AWS CloudFormation console at
         <a href="https://console.aws.amazon.com/cloudformation/" rel="noopener noreferrer" target="_blank"><span>https://console.aws.amazon.com/cloudformation</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a>.</p></li><li>
                <p>On the <b>StackSets</b> page, select the name of the stack
                    set.</p>
                <p>CloudFormation displays the <b>StackSets details</b> page for the
                    selected stack set.</p>
            </li><li>
                <p>On the <b>StackSets details</b> page, select the
                        <b>Operations</b> tab, and then select the drift detection
                    operation.</p>
            </li><li>
                <p>Select <b>Stop operation</b>.</p>
            </li></ol></div>
        <div class="procedure"><h6>To stop drift detection on a stack set using the
                AWS CLI</h6><ul><li>
                <p>Use the <code class="code"><a href="https://docs.aws.amazon.com/cli/latest/reference/cloudformation/stop-stack-set-operation.html">stop-stack-set-operation</a></code> command. You must supply both
                    the stack set name and the operation ID of the drift detection stack set
                    operation.</p>
                <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="sh "><code class="prompt" copy="false">$ </code><code class="userinput">aws cloudformation stop-stack-set-operation \
    --stack-set-name stack-set-drift-example \
    --operation-id 624af370-311a-11e8-b6b7-500cexample</code></code></pre>
            </li></ul></div>
    <awsdocs-copyright class="copyright-print"></awsdocs-copyright><awsdocs-thumb-feedback right-edge="{{$ctrl.thumbFeedbackRightEdge}}"></awsdocs-thumb-feedback></div><noscript><div><div><div><div id="js_error_message"><p><img src="https://d1ge0kk1l5kms0.cloudfront.net/images/G/01/webservices/console/warning.png" alt="Warning" /> <strong>Javascript is disabled or is unavailable in your browser.</strong></p><p>To use the Amazon Web Services Documentation, Javascript must be enabled. Please refer to your browser's Help pages for instructions.</p></div></div></div></div></noscript><div id="main-col-footer" class="awsui-util-font-size-0"><div id="doc-conventions"><a target="_top" href="/general/latest/gr/docconventions.html">Document Conventions</a></div><div class="prev-next"><div id="previous" class="prev-link" accesskey="p" href="./stacksets-account-gating.html">Target account gates</div><div id="next" class="next-link" accesskey="n" href="./stacksets-import.html">Importing a stack into a stack set.</div></div></div><awsdocs-page-utilities></awsdocs-page-utilities></div><div id="quick-feedback-yes" style="display: none;"><div class="title">Did this page help you? - Yes</div><div class="content"><p>Thanks for letting us know we're doing a good job!</p><p>If you've got a moment, please tell us what we did right so we can do more of it.</p><p><awsui-button id="fblink" rel="noopener noreferrer" target="_blank" text="Feedback" click="linkClick($event)" href="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=CloudFormation&amp;topic_url=https://docs.aws.amazon.com/en_us/AWSCloudFormation/latest/UserGuide/stacksets-drift.html"></awsui-button></p></div></div><div id="quick-feedback-no" style="display: none;"><div class="title">Did this page help you? - No</div><div class="content"><p>Thanks for letting us know this page needs work. We're sorry we let you down.</p><p>If you've got a moment, please tell us how we can make the documentation better.</p><p><awsui-button id="fblink" rel="noopener noreferrer" target="_blank" text="Feedback" click="linkClick($event)" href="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=CloudFormation&amp;topic_url=https://docs.aws.amazon.com/en_us/AWSCloudFormation/latest/UserGuide/stacksets-drift.html"></awsui-button></p></div></div></div></body></div></awsdocs-view><div class="page-loading-indicator" id="page-loading-indicator"><awsui-spinner size="large"></awsui-spinner></div></div><div id="tools-panel" dom-region="tools"><awsdocs-tools-panel id="awsdocs-tools-panel"></awsdocs-tools-panel></div></awsui-app-layout><awsdocs-cookie-banner class="doc-cookie-banner"></awsdocs-cookie-banner></div></body></html>