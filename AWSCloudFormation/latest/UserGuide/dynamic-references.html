<!DOCTYPE html>
    <html xmlns="http://www.w3.org/1999/xhtml" lang="en-US"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Using dynamic references to specify template values - AWS CloudFormation</title><meta name="viewport" content="width=device-width,initial-scale=1" /><meta name="assets_root" content="/assets" /><meta name="target_state" content="dynamic-references" /><meta name="default_state" content="dynamic-references" /><link rel="icon" type="image/ico" href="/assets/images/favicon.ico" /><link rel="shortcut icon" type="image/ico" href="/assets/images/favicon.ico" /><link rel="canonical" href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/dynamic-references.html" /><meta name="description" content="Dynamic references provide a concise, powerful way for you to specify external values stored and managed in other services in your stack templates." /><meta name="deployment_region" content="IAD" /><meta name="product" content="AWS CloudFormation" /><meta name="guide" content="User Guide" /><meta name="abstract" content="Create and manage AWS infrastructure deployments predictably and repeatedly using AWS CloudFormation with this User Guide." /><meta name="guide-locale" content="en_us" /><meta name="tocs" content="toc-contents.json" /><link rel="canonical" href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/dynamic-references.html" /><link rel="alternative" href="https://docs.aws.amazon.com/id_id/AWSCloudFormation/latest/UserGuide/dynamic-references.html" hreflang="id-id" /><link rel="alternative" href="https://docs.aws.amazon.com/id_id/AWSCloudFormation/latest/UserGuide/dynamic-references.html" hreflang="id" /><link rel="alternative" href="https://docs.aws.amazon.com/de_de/AWSCloudFormation/latest/UserGuide/dynamic-references.html" hreflang="de-de" /><link rel="alternative" href="https://docs.aws.amazon.com/de_de/AWSCloudFormation/latest/UserGuide/dynamic-references.html" hreflang="de" /><link rel="alternative" href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/dynamic-references.html" hreflang="en-us" /><link rel="alternative" href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/dynamic-references.html" hreflang="en" /><link rel="alternative" href="https://docs.aws.amazon.com/es_es/AWSCloudFormation/latest/UserGuide/dynamic-references.html" hreflang="es-es" /><link rel="alternative" href="https://docs.aws.amazon.com/es_es/AWSCloudFormation/latest/UserGuide/dynamic-references.html" hreflang="es" /><link rel="alternative" href="https://docs.aws.amazon.com/fr_fr/AWSCloudFormation/latest/UserGuide/dynamic-references.html" hreflang="fr-fr" /><link rel="alternative" href="https://docs.aws.amazon.com/fr_fr/AWSCloudFormation/latest/UserGuide/dynamic-references.html" hreflang="fr" /><link rel="alternative" href="https://docs.aws.amazon.com/it_it/AWSCloudFormation/latest/UserGuide/dynamic-references.html" hreflang="it-it" /><link rel="alternative" href="https://docs.aws.amazon.com/it_it/AWSCloudFormation/latest/UserGuide/dynamic-references.html" hreflang="it" /><link rel="alternative" href="https://docs.aws.amazon.com/ja_jp/AWSCloudFormation/latest/UserGuide/dynamic-references.html" hreflang="ja-jp" /><link rel="alternative" href="https://docs.aws.amazon.com/ja_jp/AWSCloudFormation/latest/UserGuide/dynamic-references.html" hreflang="ja" /><link rel="alternative" href="https://docs.aws.amazon.com/ko_kr/AWSCloudFormation/latest/UserGuide/dynamic-references.html" hreflang="ko-kr" /><link rel="alternative" href="https://docs.aws.amazon.com/ko_kr/AWSCloudFormation/latest/UserGuide/dynamic-references.html" hreflang="ko" /><link rel="alternative" href="https://docs.aws.amazon.com/pt_br/AWSCloudFormation/latest/UserGuide/dynamic-references.html" hreflang="pt-br" /><link rel="alternative" href="https://docs.aws.amazon.com/pt_br/AWSCloudFormation/latest/UserGuide/dynamic-references.html" hreflang="pt" /><link rel="alternative" href="https://docs.aws.amazon.com/zh_cn/AWSCloudFormation/latest/UserGuide/dynamic-references.html" hreflang="zh-cn" /><link rel="alternative" href="https://docs.aws.amazon.com/zh_tw/AWSCloudFormation/latest/UserGuide/dynamic-references.html" hreflang="zh-tw" /><link rel="alternative" href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/dynamic-references.html" hreflang="x-default" /><meta name="feedback-item" content="CloudFormation" /><meta name="this_doc_product" content="AWS CloudFormation" /><meta name="this_doc_guide" content="User Guide" /><script defer="" src="/assets/r/vendor4.js?version=2021.12.02"></script><script defer="" src="/assets/r/vendor3.js?version=2021.12.02"></script><script defer="" src="/assets/r/vendor1.js?version=2021.12.02"></script><script defer="" src="/assets/r/awsdocs-common.js?version=2021.12.02"></script><script defer="" src="/assets/r/awsdocs-doc-page.js?version=2021.12.02"></script><link href="/assets/r/vendor4.css?version=2021.12.02" rel="stylesheet" /><link href="/assets/r/awsdocs-common.css?version=2021.12.02" rel="stylesheet" /><link href="/assets/r/awsdocs-doc-page.css?version=2021.12.02" rel="stylesheet" /><script async="" id="awsc-panorama-bundle" type="text/javascript" src="https://prod.pa.cdn.uis.awsstatic.com/panorama-nav-init.js" data-config="{'appEntity':'aws-documentation','region':'us-east-1','service':'cloudformation'}"></script><meta id="panorama-serviceSubSection" value="User Guide" /><meta id="panorama-serviceConsolePage" value="Using dynamic references to specify template values" /></head><body class="awsdocs awsui"><div class="awsdocs-container"><awsdocs-header></awsdocs-header><awsui-app-layout id="app-layout" class="awsui-util-no-gutters" ng-controller="ContentController as $ctrl" header-selector="awsdocs-header" navigation-hide="false" navigation-width="$ctrl.navWidth" navigation-open="$ctrl.navOpen" navigation-change="$ctrl.onNavChange($event)" tools-hide="$ctrl.hideTools" tools-width="$ctrl.toolsWidth" tools-open="$ctrl.toolsOpen" tools-change="$ctrl.onToolsChange($event)"><div id="guide-toc" dom-region="navigation"><awsdocs-toc></awsdocs-toc></div><div id="main-column" dom-region="content" tabindex="-1"><awsdocs-view class="awsdocs-view"><div id="awsdocs-content"><head><title>Using dynamic references to specify template values - AWS CloudFormation</title><meta name="rss" content="aws-cloudformation-release-notes.rss" /><meta name="forums" content="http://forums.aws.amazon.com/forum.jspa?forumID=92" /><meta name="feedback" content="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=CloudFormation&amp;topic_url=https://docs.aws.amazon.com/en_us/AWSCloudFormation/latest/UserGuide/dynamic-references.html" /><meta name="feedback-yes" content="feedbackyes.html?topic_url=https://docs.aws.amazon.com/en_us/AWSCloudFormation/latest/UserGuide/dynamic-references.html" /><meta name="feedback-no" content="feedbackno.html?topic_url=https://docs.aws.amazon.com/en_us/AWSCloudFormation/latest/UserGuide/dynamic-references.html" /><meta name="keywords" content="CloudFormation,AWSCloudFormation,resource provisioning,resource configuration,infrastructure management,CloudFormer,CloudFormation stack,CloudFormation stackset,CloudFormation template,change set" /><script type="application/ld+json">
{
    "@context" : "https://schema.org",
    "@type" : "BreadcrumbList",
    "itemListElement" : [
      {
        "@type" : "ListItem",
        "position" : 1,
        "name" : "AWS",
        "item" : "https://aws.amazon.com"
      },
      {
        "@type" : "ListItem",
        "position" : 2,
        "name" : "AWS CloudFormation",
        "item" : "https://docs.aws.amazon.com/cloudformation/index.html"
      },
      {
        "@type" : "ListItem",
        "position" : 3,
        "name" : "User Guide",
        "item" : "https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide"
      },
      {
        "@type" : "ListItem",
        "position" : 4,
        "name" : "Working with AWS CloudFormation templates",
        "item" : "https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/template-guide.html"
      },
      {
        "@type" : "ListItem",
        "position" : 5,
        "name" : "Template anatomy",
        "item" : "https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/template-anatomy.html"
      },
      {
        "@type" : "ListItem",
        "position" : 6,
        "name" : "Parameters",
        "item" : "https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/parameters-section-structure.html"
      },
      {
        "@type" : "ListItem",
        "position" : 7,
        "name" : "Using dynamic references to specify template values",
        "item" : "https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/parameters-section-structure.html"
      }
    ]
}
</script></head><body><div id="main"><div style="display: none"></div><div id="breadcrumbs" class="breadcrumb"><a href="https://aws.amazon.com">AWS</a><a href="/index.html">Documentation</a><a href="/cloudformation/index.html">AWS CloudFormation</a><a href="Welcome.html">User Guide</a></div><div id="page-toc-src"><a href="#dynamic-references-considerations">Considerations when using dynamic
                references</a><a href="#dynamic-references-pattern">Specifying dynamic references in stack
                templates</a><a href="#dynamic-references-ssm">SSM parameters</a><a href="#dynamic-references-ssm-secure-strings">SSM secure string
                parameters</a><a href="#dynamic-references-secretsmanager">Secrets Manager secrets</a></div><div id="page-filters" style="display:none"><filter label="All" id="All"></filter><filter label="JSON" id="JSON"></filter><filter label="YAML" id="YAML"></filter></div><div id="main-content" class="awsui-util-container"><div id="main-col-body"><awsdocs-language-banner data-service="$ctrl.pageService"></awsdocs-language-banner><h1 class="topictitle" id="dynamic-references">Using dynamic references to specify template
            values</h1><div class="awsdocs-page-header-container"><awsdocs-page-header></awsdocs-page-header><awsdocs-filter-selector id="awsdocs-filter-selector"></awsdocs-filter-selector></div><p><em>Dynamic references</em> provide a compact, powerful way for you to specify
        external values that are stored and managed in other services, such as the Systems Manager Parameter
        Store and AWS Secrets Manager, in your stack templates. When you use a dynamic reference,
        CloudFormation retrieves the value of the specified reference when necessary during stack
        and change set operations.</p><p>CloudFormation currently supports the following dynamic reference patterns:</p><div class="itemizedlist">
         
         
         
    <ul class="itemizedlist"><li class="listitem">
            <p><a href="#dynamic-references-ssm">ssm</a>, for plaintext
                values stored in AWS Systems Manager Parameter Store.</p>
        </li><li class="listitem">
            <p><a href="#dynamic-references-ssm-secure-strings">ssm-secure</a>, for secure strings stored in AWS Systems Manager
                Parameter Store.</p>
        </li><li class="listitem">
            <p><a href="#dynamic-references-secretsmanager">secretsmanager</a>, for entire secrets or secret values stored
                in AWS Secrets Manager.</p>
        </li></ul></div>
        <h2 id="dynamic-references-considerations">Considerations when using dynamic
                references</h2>
        <p>Below are considerations you should take into account when using dynamic
            references:</p>
        <div class="awsdocs-note awsdocs-important"><div class="awsdocs-note-title"><awsui-icon name="status-warning" variant="error"></awsui-icon><h6>Important</h6></div><div class="awsdocs-note-text"><p>We strongly recommend against including dynamic references, or any sensitive data,
                in resource properties that are part of a resource's primary identifier.</p><p>When a dynamic reference parameter is included in a property that forms a primary
                resource identifier, CloudFormation may use the <em>actual plaintext
                    value</em> in the primary resource identifier. This resource ID may appear
                in any derived outputs or destinations.</p><p>To determine which resource properties comprise a resource type's primary
                identifier, refer to the <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-template-resource-type-ref.html">resource reference documentation</a> for that resource. In the
                    <b>Return values</b> section, the <code class="code">Ref</code> function return
                value represents the resource properties that comprise the resource type's primary
                identifier.</p></div></div>
        <div class="itemizedlist">
             
             
             
        <ul class="itemizedlist"><li class="listitem">
                <p>You can include up to 60 dynamic references in a stack template.</p>
            </li><li class="listitem">
                <p>For transforms, such as <code class="code">AWS::Include</code> and
                        <code class="code">AWS::Serverless</code>, AWS CloudFormation doesn't resolve dynamic references
                    before invoking any transforms. Rather, AWS CloudFormation passes the literal string of the
                    dynamic reference to the transform. Dynamic references (including those inserted
                    into the processed template as the result of a transform) are resolved when you
                    execute the change set using the template.</p>
            </li><li class="listitem">
                <p>Dynamic references for secure values, such as <code class="code">ssm-secure</code> and
                        <code class="code">secretsmanager</code>, aren't currently supported in <a href="./template-custom-resources.html">custom resources</a>.</p>
            </li></ul></div> <div class="awsdocs-note"><div class="awsdocs-note-title"><awsui-icon name="status-info" variant="link"></awsui-icon><h6>Note</h6></div><div class="awsdocs-note-text"><p>Do not create a dynamic reference that has a backslash (\) as the final value. AWS CloudFormation cannot resolve those references, which results in a resource failure.</p></div></div>  
        <h2 id="dynamic-references-pattern">Specifying dynamic references in stack
                templates</h2>
        <p>Dynamic references adhere to the following pattern:</p>
        <p><code class="code">'<span>{</span><span>{</span>resolve:<code class="replaceable">service-name</code>:<code class="replaceable">reference-key</code>}}'</code>
            or <code class="code">'<span>{</span><span>{</span>resolve:ssm:[a-zA-Z0-9_.\-/]+(:\d+)?}}'</code>.</p>
        <div class="variablelist">
             
             
        <dl>
                <dt><span class="term"><b>service-name</b></span></dt>
                <dd>
                    <p>Specifies the service in which the value is stored and managed.</p>
                    <p>Required.</p>
                    <p>Currently, valid values include:</p>
                    <div class="itemizedlist">
                         
                         
                         
                    <ul class="itemizedlist"><li class="listitem">
                            <p><code class="code">ssm</code>: Systems Manager Parameter Store plaintext
                                parameter.</p>
                        </li><li class="listitem">
                            <p><code class="code">ssm-secure</code>: Systems Manager Parameter Store secure string
                                parameter.</p>
                            <div class="awsdocs-note"><div class="awsdocs-note-title"><awsui-icon name="status-info" variant="link"></awsui-icon><h6>Note</h6></div><div class="awsdocs-note-text"><p>Currently, SecureString parameters aren't supported by Systems Manager
                                    in the <code class="code">cn-north-1</code> and <code class="code">cn-northwest-1</code>
                                    regions.</p></div></div>
                            <p>For more information, see <a href="https://docs.aws.amazon.com/systems-manager/latest/userguide/systems-manager-paramstore.html">AWS Systems Manager
                                    Parameter Store</a> in the
                                    <em>AWS Systems Manager User Guide</em>.</p>
                        </li><li class="listitem">
                            <p><code class="code">secretsmanager</code>: Secrets Manager secret.</p>
                        </li></ul></div>
                </dd>
             
                <dt><span class="term"><b>reference-key</b></span></dt>
                <dd>
                    <p>The reference key. Depending on the type of dynamic reference, the
                        reference key may be comprised of multiple segments.</p>
                    <p>Required.</p>
                </dd>
            </dl></div>
     
        <h2 id="dynamic-references-ssm">SSM parameters</h2>
        <p>Use the <code class="code">ssm</code> dynamic reference to include values stored in the Systems Manager
            Parameter Store of type <code class="code">String</code> or <code class="code">StringList</code> in your
            templates.</p>
         
            <h3 id="dynamic-references-ssm-pattern">Reference pattern</h3>
            <p>For SSM Parameters, the <code class="code">reference-key</code> segment is composed of the
                parameter name and version number. Use the following pattern:</p>
            <p><code class="code">'<span>{</span><span>{</span>resolve:ssm:<code class="replaceable">parameter-name</code>:<code class="replaceable">version</code>}}'</code></p>
            <p>Your reference must adhere to the following regular expression pattern for
                parameter-name and version:</p>
            <p><code class="code">'<span>{</span><span>{</span>resolve:ssm:[a-zA-Z0-9_.-/]+:\\d+}}'</code></p>
            <div class="variablelist">
                 
                 
            <dl>
                    <dt><span class="term"><b>parameter-name</b></span></dt>
                    <dd>
                        <p>The name of the parameter in the Systems Manager Parameter Store. The parameter
                            name is case-sensitive.</p>
                        <p>Required.</p>
                    </dd>
                 
                    <dt><span class="term"><b>version</b></span></dt>
                    <dd>
                        <p>An integer that specifies the version of the parameter to use. If you
                            don't specify the exact version, CloudFormation uses the latest version of
                            the parameter whenever you create or update the stack. For more
                            information, see <a href="https://docs.aws.amazon.com/systems-manager/latest/userguide/sysman-paramstore-versions.html">Working with
                                parameter versions</a> in the
                                <em>AWS Systems Manager User Guide</em></p>
                        <p>Optional.</p>
                    </dd>
                </dl></div>
         
         
            <h3 id="dynamic-references-ssm-example">Example</h3>
            <p>The following example uses an <code class="code">ssm</code> dynamic reference to set the access
                control for an S3 bucket to a parameter value stored in Systems Manager Parameter Store. As
                specified, CloudFormation will use version 2 of the <code class="code">S3AccessControl</code>
                parameter for stack and change set operations.</p>
            <div id="JSON" name="JSON" class="section langfilter">
                <h4 id="dynamic-references-ssm-example.json">JSON</h4>
                <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="json ">  "MyS3Bucket": <span>{</span>
    "Type": "AWS::S3::Bucket",
    "Properties": <span>{</span>
      "AccessControl": "<span>{</span><span>{</span>resolve:ssm:S3AccessControl:2}}"
    }
  }</code></pre>
            </div>
            <div id="YAML" name="YAML" class="section langfilter">
                <h4 id="dynamic-references-ssm-example.yaml">YAML</h4>
                <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="yaml ">  MyS3Bucket:
    Type: 'AWS::S3::Bucket'
    Properties:
      AccessControl: '<span>{</span><span>{</span>resolve:ssm:S3AccessControl:2}}' </code></pre>
            </div>
         
        <p>To specify a parameter stored in the Systems Manager Parameter Store, you must have access to
            call <code class="code"><a href="https://docs.aws.amazon.com/systems-manager/latest/APIReference/API_GetParameter.html">GetParameters</a></code>
            for the specified parameter. For more information, see <a href="https://docs.aws.amazon.com/systems-manager/latest/userguide/sysman-paramstore-access.html">Controlling access to Systems
                Manager parameters</a> in the <em>AWS Systems Manager User Guide</em>.</p>
        <p>Additional considerations to note when using the <code class="code">ssm</code> dynamic reference
            pattern:</p>
        <div class="itemizedlist">
             
             
             
             
             
             
        <ul class="itemizedlist"><li class="listitem">
                <p>Currently, CloudFormation doesn't support cross-account SSM parameter
                    access.</p>
            </li><li class="listitem">
                <p>For custom resources, CloudFormation resolves <code class="code">ssm</code> dynamic references
                    prior to sending the request to the custom resource. For more information, see
                        <a href="./template-custom-resources.html">Custom resources</a>.</p>
            </li><li class="listitem">
                <p>CloudFormation doesn't support using parameter labels or public parameters in
                    dynamic references.</p>
                <p>A parameter label is a user-defined alias to help you manage different
                    versions of a parameter. For more information, see <a href="https://docs.aws.amazon.com/systems-manager/latest/userguide/sysman-paramstore-labels.html">Labeling
                        parameters</a> in the <em>AWS Systems Manager User Guide</em>.</p>
                <p>A public parameter is a parameter provided by an AWS service for use with
                    that service, and stored in AWS Systems Manager Parameter Store. For an example of public
                    parameters, see <a href="https://docs.aws.amazon.com/AmazonECS/latest/developerguide/retrieve-ecs-optimized_AMI.html">Retrieving the Amazon ECS-optimized AMI metadata</a> in the
                        <em>Amazon Elastic Container Service Developer Guide</em>.</p>
            </li><li class="listitem">
                <p>CloudFormation doesn't currently support drift detection on dynamic references.
                    For <code class="code">ssm</code> dynamic references where you haven't specified the
                    parameter version, we recommend that, if you update the parameter version in
                    SSM, you also perform a stack update operation on any stacks that include the
                        <code class="code">ssm</code> dynamic reference, in order to fetch the latest parameter
                    version.</p>
            </li><li class="listitem">
                <p>To verify which version of an the <code class="code">ssm</code> dynamic reference will be
                    used in a stack operation, <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/using-cfn-updating-stacks-changesets-create.html">create a change set</a> for the stack operation. Then <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/using-cfn-updating-stacks-changesets-view.html">review the processed template</a> on the <b>Template</b>
                    tab.</p>
            </li><li class="listitem">
                <p>SSM parameters without a version isn't supported in the <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/parameters-section-structure.html">Parameters block</a>, use <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/parameters-section-structure.html#aws-ssm-parameter-types">SSM parameter types</a> instead. If you do use SSM parameters, you
                    must specify a version of the Systems Manager parameter for AWS CloudFormation to
                    use.</p>
            </li></ul></div>
     
        <h2 id="dynamic-references-ssm-secure-strings">SSM secure string
                parameters</h2>
        <p>Use the <code class="code">ssm-secure</code> dynamic reference pattern to specify AWS Systems Manager
                <code class="code">SecureString</code> type parameters in your templates. For
                <code class="code">ssm-secure</code> dynamic references, AWS CloudFormation never stores the actual parameter
            value. AWS CloudFormation accesses the parameter value during create and update operations for stacks
            and change sets. Currently, secure string parameters can only be used for <a href="#template-parameters-dynamic-patterns-resources">resource properties that
                support</a> the <code class="code">ssm-secure</code> dynamic reference pattern.</p>
        <p>A <em>secure string parameter</em> is any sensitive data that needs to be
            stored and referenced in a secure manner. That is, data that you don't want users to
            alter or reference in clear text, such as passwords or license keys. For more
            information on secure strings, see <a href="https://docs.aws.amazon.com/systems-manager/latest/userguide/sysman-paramstore-about.html#sysman-paramstore-securestring">Use
                secure string parameters</a> in the
            <em>AWS Systems Manager User Guide</em>.</p>
        <p>Secure string parameters values aren't stored in CloudFormation, nor are they returned
            in any API call results.</p>

         
            <h3 id="dynamic-references-ssm-secure-pattern">Reference pattern</h3>
            <p>For <code class="code">ssm-secure</code> dynamic references, the <code class="code">reference-key</code>
                segment is composed of the parameter name and version number. Use the following
                pattern:</p>
            <p><code class="code">'<span>{</span><span>{</span>resolve:ssm-secure:<code class="replaceable">parameter-name</code>:<code class="replaceable">version</code>}}'</code></p>
            <p>Your reference must adhere to the following regular expression pattern for
                parameter-name and version:</p>
            <p><code class="code">'<span>{</span><span>{</span>resolve:ssm-secure:[a-zA-Z0-9_.-/]+:\\d+}}'</code></p>

            <div class="variablelist">
                 
                 
            <dl>
                    <dt><span class="term"><b>parameter-name</b></span></dt>
                    <dd>
                        <p>The name of the parameter in the Systems Manager Parameter Store. The parameter
                            name is case-sensitive.</p>
                        <p>Required.</p>
                    </dd>
                 
                    <dt><span class="term"><b>version</b></span></dt>
                    <dd>
                        <p>An integer that specifies the version of the parameter to use. If you
                            don't specify the exact version, AWS CloudFormation uses the latest
                            version of the parameter whenever you create or update the stack. For
                            more information, see <a href="https://docs.aws.amazon.com/systems-manager/latest/userguide/sysman-paramstore-versions.html">Working with
                                parameter versions</a> in the
                                <em>AWS Systems Manager User Guide</em></p>
                        <p>Optional.</p>
                    </dd>
                </dl></div>

         

         
            <h3 id="dynamic-references-ssm-secure-example">Example</h3>
            <p>The following example uses an <code class="code">ssm-secure</code> dynamic reference to set the
                password for an IAM user to a secure string stored in Systems Manager Parameter Store. As
                specified, CloudFormation will use version 10 of the <code class="code">IAMUserPassword</code>
                parameter for stack and change set operations.</p>
            <div id="JSON" name="JSON" class="section langfilter">
                <h4 id="dynamic-references-ssm-secure-example.json">JSON</h4>
                <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="json ">  "MyIAMUser": <span>{</span>
    "Type": "AWS::IAM::User",
    "Properties": <span>{</span>
      "UserName": "MyUserName",
      "LoginProfile": <span>{</span>
        "Password": "<span>{</span><span>{</span>resolve:ssm-secure:IAMUserPassword:10}}"
      }
    }
  }</code></pre>
            </div>
            <div id="YAML" name="YAML" class="section langfilter">
                <h4 id="dynamic-references-ssm-secure-example.yaml">YAML</h4>
                <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="yaml ">  MyIAMUser:
    Type: AWS::IAM::User
    Properties:
      UserName: 'MyUserName'
      LoginProfile:
        Password: '<span>{</span><span>{</span>resolve:ssm-secure:IAMUserPassword:10}}'</code></pre>
            </div>
         

        <p>Additional considerations to note when using the <code class="code">ssm-secure</code> dynamic
            reference pattern:</p>
        <div class="itemizedlist">
             
             
             
             
             
             
             
        <ul class="itemizedlist"><li class="listitem">
                <p>CloudFormation doesn't return the actual parameter value for secure strings in
                    any API calls, but rather returns the literal dynamic reference.</p>
            </li><li class="listitem">
                <p>CloudFormation does store the literal dynamic reference, which contains the
                    plain text parameter name of the secure string.</p>
            </li><li class="listitem">
                <p>For change sets, CloudFormation compares the literal dynamic reference string.
                    It doesn't resolve and compare the actual values of <code class="code">ssm-secure</code>
                    references.</p>
            </li><li class="listitem">
                <p>Dynamic references for secure values, such as <code class="code">ssm-secure</code> and
                        <code class="code">secretsmanager</code>, aren't currently supported in <a href="./template-custom-resources.html">custom resources</a>.</p>
            </li><li class="listitem">
                <p>In cases where CloudFormation must rollback a stack update, that update
                    rollback operation will fail if the previously specified version of a secure
                    string parameter is no longer available. In such cases, do one of the
                    following:</p>
                <div class="itemizedlist">
                     
                     
                <ul class="itemizedlist"><li class="listitem">
                        <p>Use <code class="code">CONTINUE_UPDATE_ROLLBACK</code> to skip the resource.</p>
                    </li><li class="listitem">
                        <p>Recreate the secure string parameter in the Systems Manager Parameter Store, and
                            update it until the parameter version reaches the version used in the
                            template. Then use <code class="code">CONTINUE_UPDATE_ROLLBACK</code> without
                            skipping the resource.</p>
                    </li></ul></div>
            </li><li class="listitem">
                <p>Currently, AWS CloudFormation doesn't support cross-account SSM parameter access.</p>
            </li><li class="listitem">
                <p>CloudFormation doesn't support using parameter labels or public parameters in
                    dynamic references.</p>
                <p>A parameter label is a user-defined alias to help you manage different
                    versions of a parameter. For more information, see <a href="https://docs.aws.amazon.com/systems-manager/latest/userguide/sysman-paramstore-labels.html">Labeling
                        parameters</a> in the <em>AWS Systems Manager User Guide</em>.</p>
                <p>A public parameter is a parameter provided by an AWS service for use with
                    that service, and stored in AWS Systems Manager Parameter Store. For an example of public
                    parameters, see <a href="https://docs.aws.amazon.com/AmazonECS/latest/developerguide/retrieve-ecs-optimized_AMI.html">Retrieving the Amazon ECS-optimized AMI metadata</a> in the
                        <em>Amazon Elastic Container Service Developer Guide</em>.</p>
            </li></ul></div>
         
            <h3 id="template-parameters-dynamic-patterns-resources">Resources that
                    support dynamic parameter patterns for secure strings</h3>
            <p>Resources that support the <code class="code">ssm-secure</code> dynamic reference pattern
                currently include:</p>
            <div class="table-container"><div class="table-contents"><table id="w1355aac23c15c17c25c19c17b5"><thead>
                        <tr>
                            <th>Resource</th>
                            <th>Property type</th>
                            <th>Properties</th>
                        </tr>
                    </thead>
                        <tr>
                            <td tabindex="-1"><p><a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-resource-directoryservice-microsoftad.html">AWS::DirectoryService::MicrosoftAD</a></p></td>
                            <td tabindex="-1"><p></p></td>
                            <td tabindex="-1"><p><code class="code">Password</code></p></td>
                        </tr>
                        <tr>
                            <td tabindex="-1"><p><a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-resource-directoryservice-simplead.html">AWS::DirectoryService::SimpleAD</a></p></td>
                            <td tabindex="-1"><p></p></td>
                            <td tabindex="-1"><p><code class="code">Password</code></p></td>
                        </tr>
                        <tr>
                            <td tabindex="-1"><p><a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-resource-elasticache-replicationgroup.html">AWS::ElastiCache::ReplicationGroup</a></p></td>
                            <td tabindex="-1"><p></p></td>
                            <td tabindex="-1"><p><code class="code">AuthToken</code></p></td>
                        </tr>
                        <tr>
                            <td tabindex="-1"><p><a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-properties-iam-user.html">AWS::IAM::User</a></p></td>
                            <td tabindex="-1"><p><a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-properties-iam-user-loginprofile.html">LoginProfile</a></p></td>
                            <td tabindex="-1"><p><code class="code">Password</code></p></td>
                        </tr>
                        <tr>
                            <td tabindex="-1"><p><a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-resource-kinesisfirehose-deliverystream.html">AWS::KinesisFirehose::DeliveryStream</a></p></td>
                            <td tabindex="-1"><p><a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-properties-kinesisfirehose-deliverystream-redshiftdestinationconfiguration.html">RedshiftDestinationConfiguration</a></p></td>
                            <td tabindex="-1"><p><code class="code">Password</code></p></td>
                        </tr>
                        <tr>
                            <td tabindex="-1"><p><a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-resource-opsworks-app.html">AWS::OpsWorks::App</a></p></td>
                            <td tabindex="-1"><p><a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-properties-opsworks-stack-source-1.html">Source</a></p></td>
                            <td tabindex="-1"><p><code class="code">Password</code></p></td>
                        </tr>
                        <tr>
                            <td tabindex="-1"><p><a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-resource-opsworks-stack.html">AWS::OpsWorks::Stack</a></p></td>
                            <td tabindex="-1"><p><a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-properties-opsworks-stack-source.html">CustomCookbooksSource</a></p></td>
                            <td tabindex="-1"><p><code class="code">Password</code></p></td>
                        </tr>
                        <tr>
                            <td tabindex="-1"><p><a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-resource-opsworks-stack.html">AWS::OpsWorks::Stack</a></p></td>
                            <td tabindex="-1"><p><a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-properties-opsworks-stack-rdsdbinstance.html">RdsDbInstances</a></p></td>
                            <td tabindex="-1"><p><code class="code">DbPassword</code></p></td>
                        </tr>
                        <tr>
                            <td tabindex="-1"><p><a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-resource-rds-dbcluster.html">AWS::RDS::DBCluster</a></p></td>
                            <td tabindex="-1"><p></p></td>
                            <td tabindex="-1"><p><code class="code">MasterUserPassword</code></p></td>
                        </tr>
                        <tr>
                            <td tabindex="-1"><p><a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-properties-rds-database-instance.html">AWS::RDS::DBInstance</a></p></td>
                            <td tabindex="-1"><p></p></td>
                            <td tabindex="-1"><p><code class="code">MasterUserPassword</code></p>
                            </td>
                        </tr>
                        <tr>
                            <td tabindex="-1"><p><a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-resource-redshift-cluster.html">AWS::Redshift::Cluster</a></p></td>
                            <td tabindex="-1"><p></p></td>
                            <td tabindex="-1"><p><code class="code">MasterUserPassword</code></p></td>
                        </tr>
                    </table></div></div>
         
     
        <h2 id="dynamic-references-secretsmanager">Secrets Manager secrets</h2>
        <p>Use the <code class="code">secretsmanager</code> dynamic reference to retrieve entire secrets or
            secret values that are stored in Secrets Manager for use in your templates.
                <em>Secrets</em> can be database credentials, passwords, third-party API
            keys, or arbitrary text. Using Secrets Manager, you can store and control access to these secrets
            centrally, so that you can replace hardcoded credentials in your code (including
            passwords), with an API call to Secrets Manager to retrieve the secret programmatically. For
            more information, see <a href="https://docs.aws.amazon.com/secretsmanager/latest/userguide/intro.html">What is AWS Secrets Manager?</a>
            in the <em>AWS Secrets Manager User Guide</em>.</p>
         
            <h3 id="dynamic-references-secretsmanager-considerations">Important
                    considerations when using dynamic references for Secrets Manager secrets</h3>
            <p>You should take the following important security considerations into account when
                using dynamic references to specify Secrets Manager secrets in your stack
                templates:</p>
            <div class="itemizedlist">
                 
                 
                 
            <ul class="itemizedlist"><li class="listitem">
                    <p>The <code class="code">secretsmanager</code> dynamic reference can be used in all
                        resource properties. Using the <code class="code">secretsmanager</code> dynamic reference
                        indicates that neither Secrets Manager nor CloudFormation logs should persist any
                        resolved secret value. However, the secret value may show up in the service
                        whose resource it's being used in. Review your usage to avoid leaking secret
                        data.</p>
                </li><li class="listitem">
                    <p>Updating a secret in Secrets Manager doesn't automatically update the secret in
                        CloudFormation. In order for CloudFormation to update a <code class="code">secretsmanager</code>
                        dynamic reference, you must perform a stack update that updates the resource
                        containing the dynamic reference, either by updating the resource property
                        that contains the <code class="code">secretsmanager</code> dynamic reference, or updating
                        another of the resource's properties.</p>
                    <p>For example, suppose in your template you specify the
                            <code class="code">MasterPassword</code> property of an <code class="code"><a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-properties-rds-database-instance.html">AWS::RDS::DBInstance</a></code> resource to be a
                            <code class="code">secretsmanager</code> dynamic reference, and then create a stack
                        from the template. You later update that secret's value in Secrets Manager, but don't
                        update the <code class="code">AWS::RDS::DBInstance</code> resource in your template. In
                        this case, even if you perform a stack update, the secret value in the
                            <code class="code">MasterPassword</code> property isn't updated, and remains the
                        previous secret value.</p>
                    <p>Also, consider using Secrets Manager to automatically rotate the secret for a
                        secured service or database. For more information, see <a href="https://docs.aws.amazon.com/secretsmanager/latest/userguide/rotating-secrets.html">Rotate
                            AWS Secrets Manager secrets</a>.</p>
                </li><li class="listitem">
                    <p>Dynamic references for secure values, such as <code class="code">secretsmanager</code>,
                        aren't currently supported in <a href="./template-custom-resources.html">custom resources</a>.</p>
                </li></ul></div>
         

         
            <h3 id="dynamic-references-secretsmanager-permissions">Permissions
                    required</h3>
            <p>To specify a secret stored in Secrets Manager, you must have access to call <code class="code"><a href="https://docs.aws.amazon.com/secretsmanager/latest/apireference/API_GetSecretValue.html">GetSecretValue</a></code> for the secret.</p>
         
         
            <h3 id="dynamic-references-secretsmanager-pattern">Reference
                    pattern</h3>
            <p>For Secrets Manager secrets, the <code class="code">reference-key</code> segment is composed of several
                segments, including the secret id, secret value key, version stage, and version id.
                Use the following pattern:</p>
            <p><code class="code"><span>{</span><span>{</span>resolve:secretsmanager:<code class="replaceable">secret-id</code>:<code class="replaceable">secret-string</code>:<code class="replaceable">json-key</code>:<code class="replaceable">version-stage</code>:<code class="replaceable">version-id</code>}}</code></p>
            <div class="variablelist">
                 
                 
                 
                 
                 
            <dl>
                    <dt><span class="term"><b>secret-id</b></span></dt>
                    <dd>
                        <p>The name or ARN of the secret.</p>
                        <p>To access a secret in your AWS account, you need only specify the
                            secret name. To access a secret in a different AWS account, specify
                            the complete ARN of the secret.</p>
                        <p>Required.</p>
                    </dd>
                 
                    <dt><span class="term"><b>secret-string</b></span></dt>
                    <dd>
                        <p>Currently, the only supported value is <code class="code">SecretString</code>. The
                            default is <code class="code">SecretString</code>.</p>
                    </dd>
                 
                    <dt><span class="term"><b>json-key</b></span></dt>
                    <dd>
                        <p>The key name of the key-value pair whose value you want to retrieve.
                            If you don't specify a <code class="code">json-key</code>, CloudFormation retrieves
                            the entire secret text.</p>
                        <p>This segment may not include the colon character (
                            <code class="code">:</code>).</p>
                    </dd>
                 
                    <dt><span class="term"><b>version-stage</b></span></dt>
                    <dd>
                        <p>The staging label of the version of the secret to use. Secrets Manager uses
                            staging labels to keep track of different versions during the rotation
                            process. If you use <code class="code">version-stage</code> then don't specify
                                <code class="code">version-id</code>. If you don't specify either
                                <code class="code">version-stage</code> or <code class="code">version-id</code>, then the
                            default is the <code class="code">AWSCURRENT</code> version.</p>
                        <p>This segment may not include the colon character (
                            <code class="code">:</code>).</p>
                    </dd>
                 
                    <dt><span class="term"><b>version-id</b></span></dt>
                    <dd>
                        <p>The unique identifier of the version of the secret to use. If you
                            specify <code class="code">version-id</code>, then don't specify
                                <code class="code">version-stage</code>. If you don't specify either
                                <code class="code">version-stage</code> or <code class="code">version-id</code>, then the
                            default is the <code class="code">AWSCURRENT</code> version.</p>
                        <p>This segment may not include the colon character (
                            <code class="code">:</code>).</p>
                    </dd>
                </dl></div>

         
         
            <h3 id="dynamic-references-secretsmanager-example">Examples</h3>

            <p>The following example uses the <code class="code">secret-name</code> and <code class="code">json-key</code>
                segments to retrieve the user name and password values stored in the MyRDSSecret
                secret. By default, the secret version retrieved is the version with the version
                stage value of <code class="code">AWSCURRENT</code>.</p>
            <div id="JSON" name="JSON" class="section langfilter">
                <h4 id="dynamic-references-secretsmanager-example.json">JSON</h4>
                <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
    "MyRDSInstance": <span>{</span>
        "Type": "AWS::RDS::DBInstance",
        "Properties": <span>{</span>
            "DBName": "MyRDSInstance",
            "AllocatedStorage": "20",
            "DBInstanceClass": "db.t2.micro",
            "Engine": "mysql",
            "MasterUsername": "<span>{</span><span>{</span>resolve:secretsmanager:MyRDSSecret:SecretString:username}}",
            "MasterUserPassword": "<span>{</span><span>{</span>resolve:secretsmanager:MyRDSSecret:SecretString:password}}"
        }
    }
}</code></pre>
            </div>
            <div id="YAML" name="YAML" class="section langfilter">
                <h4 id="dynamic-references-secretsmanager-example.yaml">YAML</h4>
                <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="yaml ">  MyRDSInstance:
    Type: 'AWS::RDS::DBInstance'
    Properties:
      DBName: MyRDSInstance
      AllocatedStorage: '20'
      DBInstanceClass: db.t2.micro
      Engine: mysql
      MasterUsername: '<span>{</span><span>{</span>resolve:secretsmanager:MyRDSSecret:SecretString:username}}'
      MasterUserPassword: '<span>{</span><span>{</span>resolve:secretsmanager:MyRDSSecret:SecretString:password}}'</code></pre>
            </div>

            <p>Specifying the following segments would retrieve the <code class="code">SecretString</code> for
                MySecret.</p>
            <p><code class="code">'<span>{</span><span>{</span>resolve:secretsmanager:MySecret}}'</code> or
     <code class="code">'<span>{</span><span>{</span>resolve:secretsmanager:MySecret::::}}'</code></p>

            <p>Specifying the following segments would retrieve the <code class="code">password</code> value
                for MySecret.</p>
            <p><code class="code">'<span>{</span><span>{</span>resolve:secretsmanager:MySecret:SecretString:password}}'</code></p>

            <p>Specifying the following segments would retrieve the <code class="code">SecretString</code> for
                MySecret that is in another AWS account. You must specify the complete secret ARN
                to access secrets in another AWS account.</p>
            <p><code class="code">'<span>{</span><span>{</span>resolve:secretsmanager:arn:aws:secretsmanager:us-west-2:123456789012:secret:MySecret-a1b2c3}}'</code></p>

            <p>Specifying the following segments would retrieve the <code class="code">password</code> value
                for MySecret that is in another AWS account. You must specify the complete secret
                ARN to access secrets in another AWS account.</p>
            <p><code class="code">'<span>{</span><span>{</span>resolve:secretsmanager:arn:aws:secretsmanager:us-west-2:123456789012:secret:MySecret-a1b2c3:SecretString:password}}'</code></p>

            <p>Specifying the following segments would retrieve the <code class="code">password</code> value
                for the <code class="code">AWSPREVIOUS</code> version of MySecret.</p>
            <p><code class="code">'<span>{</span><span>{</span>resolve:secretsmanager:MySecret:SecretString:password:AWSPREVIOUS}}'</code></p>

         

    <awsdocs-copyright class="copyright-print"></awsdocs-copyright><awsdocs-thumb-feedback right-edge="{{$ctrl.thumbFeedbackRightEdge}}"></awsdocs-thumb-feedback></div><noscript><div><div><div><div id="js_error_message"><p><img src="https://d1ge0kk1l5kms0.cloudfront.net/images/G/01/webservices/console/warning.png" alt="Warning" /> <strong>Javascript is disabled or is unavailable in your browser.</strong></p><p>To use the Amazon Web Services Documentation, Javascript must be enabled. Please refer to your browser's Help pages for instructions.</p></div></div></div></div></noscript><div id="main-col-footer" class="awsui-util-font-size-0"><div id="doc-conventions"><a target="_top" href="/general/latest/gr/docconventions.html">Document Conventions</a></div><div class="prev-next"><div id="previous" class="prev-link" accesskey="p" href="./parameters-section-structure.html">Parameters</div><div id="next" class="next-link" accesskey="n" href="./rules-section-structure.html">Rules</div></div></div><awsdocs-page-utilities></awsdocs-page-utilities></div><div id="quick-feedback-yes" style="display: none;"><div class="title">Did this page help you? - Yes</div><div class="content"><p>Thanks for letting us know we're doing a good job!</p><p>If you've got a moment, please tell us what we did right so we can do more of it.</p><p><awsui-button id="fblink" rel="noopener noreferrer" target="_blank" text="Feedback" click="linkClick($event)" href="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=CloudFormation&amp;topic_url=https://docs.aws.amazon.com/en_us/AWSCloudFormation/latest/UserGuide/dynamic-references.html"></awsui-button></p></div></div><div id="quick-feedback-no" style="display: none;"><div class="title">Did this page help you? - No</div><div class="content"><p>Thanks for letting us know this page needs work. We're sorry we let you down.</p><p>If you've got a moment, please tell us how we can make the documentation better.</p><p><awsui-button id="fblink" rel="noopener noreferrer" target="_blank" text="Feedback" click="linkClick($event)" href="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=CloudFormation&amp;topic_url=https://docs.aws.amazon.com/en_us/AWSCloudFormation/latest/UserGuide/dynamic-references.html"></awsui-button></p></div></div></div></body></div></awsdocs-view><div class="page-loading-indicator" id="page-loading-indicator"><awsui-spinner size="large"></awsui-spinner></div></div><div id="tools-panel" dom-region="tools"><awsdocs-tools-panel id="awsdocs-tools-panel"></awsdocs-tools-panel></div></awsui-app-layout><awsdocs-cookie-banner class="doc-cookie-banner"></awsdocs-cookie-banner></div></body></html>