<!DOCTYPE html>
    <html xmlns="http://www.w3.org/1999/xhtml" lang="en-US"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Prevent updates to stack resources - AWS CloudFormation</title><meta name="viewport" content="width=device-width,initial-scale=1" /><meta name="assets_root" content="/assets" /><meta name="target_state" content="protect-stack-resources" /><meta name="default_state" content="protect-stack-resources" /><link rel="icon" type="image/ico" href="/assets/images/favicon.ico" /><link rel="shortcut icon" type="image/ico" href="/assets/images/favicon.ico" /><link rel="canonical" href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/protect-stack-resources.html" /><meta name="description" content="Prevent stack resources from being unintentionally updated or deleted during a stack update by using AWS CloudFormation stack policies." /><meta name="deployment_region" content="IAD" /><meta name="product" content="AWS CloudFormation" /><meta name="guide" content="User Guide" /><meta name="abstract" content="Create and manage AWS infrastructure deployments predictably and repeatedly using AWS CloudFormation with this User Guide." /><meta name="guide-locale" content="en_us" /><meta name="tocs" content="toc-contents.json" /><link rel="canonical" href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/protect-stack-resources.html" /><link rel="alternative" href="https://docs.aws.amazon.com/id_id/AWSCloudFormation/latest/UserGuide/protect-stack-resources.html" hreflang="id-id" /><link rel="alternative" href="https://docs.aws.amazon.com/id_id/AWSCloudFormation/latest/UserGuide/protect-stack-resources.html" hreflang="id" /><link rel="alternative" href="https://docs.aws.amazon.com/de_de/AWSCloudFormation/latest/UserGuide/protect-stack-resources.html" hreflang="de-de" /><link rel="alternative" href="https://docs.aws.amazon.com/de_de/AWSCloudFormation/latest/UserGuide/protect-stack-resources.html" hreflang="de" /><link rel="alternative" href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/protect-stack-resources.html" hreflang="en-us" /><link rel="alternative" href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/protect-stack-resources.html" hreflang="en" /><link rel="alternative" href="https://docs.aws.amazon.com/es_es/AWSCloudFormation/latest/UserGuide/protect-stack-resources.html" hreflang="es-es" /><link rel="alternative" href="https://docs.aws.amazon.com/es_es/AWSCloudFormation/latest/UserGuide/protect-stack-resources.html" hreflang="es" /><link rel="alternative" href="https://docs.aws.amazon.com/fr_fr/AWSCloudFormation/latest/UserGuide/protect-stack-resources.html" hreflang="fr-fr" /><link rel="alternative" href="https://docs.aws.amazon.com/fr_fr/AWSCloudFormation/latest/UserGuide/protect-stack-resources.html" hreflang="fr" /><link rel="alternative" href="https://docs.aws.amazon.com/it_it/AWSCloudFormation/latest/UserGuide/protect-stack-resources.html" hreflang="it-it" /><link rel="alternative" href="https://docs.aws.amazon.com/it_it/AWSCloudFormation/latest/UserGuide/protect-stack-resources.html" hreflang="it" /><link rel="alternative" href="https://docs.aws.amazon.com/ja_jp/AWSCloudFormation/latest/UserGuide/protect-stack-resources.html" hreflang="ja-jp" /><link rel="alternative" href="https://docs.aws.amazon.com/ja_jp/AWSCloudFormation/latest/UserGuide/protect-stack-resources.html" hreflang="ja" /><link rel="alternative" href="https://docs.aws.amazon.com/ko_kr/AWSCloudFormation/latest/UserGuide/protect-stack-resources.html" hreflang="ko-kr" /><link rel="alternative" href="https://docs.aws.amazon.com/ko_kr/AWSCloudFormation/latest/UserGuide/protect-stack-resources.html" hreflang="ko" /><link rel="alternative" href="https://docs.aws.amazon.com/pt_br/AWSCloudFormation/latest/UserGuide/protect-stack-resources.html" hreflang="pt-br" /><link rel="alternative" href="https://docs.aws.amazon.com/pt_br/AWSCloudFormation/latest/UserGuide/protect-stack-resources.html" hreflang="pt" /><link rel="alternative" href="https://docs.aws.amazon.com/zh_cn/AWSCloudFormation/latest/UserGuide/protect-stack-resources.html" hreflang="zh-cn" /><link rel="alternative" href="https://docs.aws.amazon.com/zh_tw/AWSCloudFormation/latest/UserGuide/protect-stack-resources.html" hreflang="zh-tw" /><link rel="alternative" href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/protect-stack-resources.html" hreflang="x-default" /><meta name="feedback-item" content="CloudFormation" /><meta name="this_doc_product" content="AWS CloudFormation" /><meta name="this_doc_guide" content="User Guide" /><script defer="" src="/assets/r/vendor4.js?version=2021.12.02"></script><script defer="" src="/assets/r/vendor3.js?version=2021.12.02"></script><script defer="" src="/assets/r/vendor1.js?version=2021.12.02"></script><script defer="" src="/assets/r/awsdocs-common.js?version=2021.12.02"></script><script defer="" src="/assets/r/awsdocs-doc-page.js?version=2021.12.02"></script><link href="/assets/r/vendor4.css?version=2021.12.02" rel="stylesheet" /><link href="/assets/r/awsdocs-common.css?version=2021.12.02" rel="stylesheet" /><link href="/assets/r/awsdocs-doc-page.css?version=2021.12.02" rel="stylesheet" /><script async="" id="awsc-panorama-bundle" type="text/javascript" src="https://prod.pa.cdn.uis.awsstatic.com/panorama-nav-init.js" data-config="{'appEntity':'aws-documentation','region':'us-east-1','service':'cloudformation'}"></script><meta id="panorama-serviceSubSection" value="User Guide" /><meta id="panorama-serviceConsolePage" value="Prevent updates to stack resources" /></head><body class="awsdocs awsui"><div class="awsdocs-container"><awsdocs-header></awsdocs-header><awsui-app-layout id="app-layout" class="awsui-util-no-gutters" ng-controller="ContentController as $ctrl" header-selector="awsdocs-header" navigation-hide="false" navigation-width="$ctrl.navWidth" navigation-open="$ctrl.navOpen" navigation-change="$ctrl.onNavChange($event)" tools-hide="$ctrl.hideTools" tools-width="$ctrl.toolsWidth" tools-open="$ctrl.toolsOpen" tools-change="$ctrl.onToolsChange($event)"><div id="guide-toc" dom-region="navigation"><awsdocs-toc></awsdocs-toc></div><div id="main-column" dom-region="content" tabindex="-1"><awsdocs-view class="awsdocs-view"><div id="awsdocs-content"><head><title>Prevent updates to stack resources - AWS CloudFormation</title><meta name="rss" content="aws-cloudformation-release-notes.rss" /><meta name="forums" content="http://forums.aws.amazon.com/forum.jspa?forumID=92" /><meta name="feedback" content="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=CloudFormation&amp;topic_url=https://docs.aws.amazon.com/en_us/AWSCloudFormation/latest/UserGuide/protect-stack-resources.html" /><meta name="feedback-yes" content="feedbackyes.html?topic_url=https://docs.aws.amazon.com/en_us/AWSCloudFormation/latest/UserGuide/protect-stack-resources.html" /><meta name="feedback-no" content="feedbackno.html?topic_url=https://docs.aws.amazon.com/en_us/AWSCloudFormation/latest/UserGuide/protect-stack-resources.html" /><meta name="keywords" content="CloudFormation,AWSCloudFormation,resource provisioning,resource configuration,infrastructure management,CloudFormer,CloudFormation stack,CloudFormation stackset,CloudFormation template,change set" /><script type="application/ld+json">
{
    "@context" : "https://schema.org",
    "@type" : "BreadcrumbList",
    "itemListElement" : [
      {
        "@type" : "ListItem",
        "position" : 1,
        "name" : "AWS",
        "item" : "https://aws.amazon.com"
      },
      {
        "@type" : "ListItem",
        "position" : 2,
        "name" : "AWS CloudFormation",
        "item" : "https://docs.aws.amazon.com/cloudformation/index.html"
      },
      {
        "@type" : "ListItem",
        "position" : 3,
        "name" : "User Guide",
        "item" : "https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide"
      },
      {
        "@type" : "ListItem",
        "position" : 4,
        "name" : "Working with stacks",
        "item" : "https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/stacks.html"
      },
      {
        "@type" : "ListItem",
        "position" : 5,
        "name" : "AWS CloudFormation stack updates",
        "item" : "https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/using-cfn-updating-stacks.html"
      },
      {
        "@type" : "ListItem",
        "position" : 6,
        "name" : "Prevent updates to stack resources",
        "item" : "https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/using-cfn-updating-stacks.html"
      }
    ]
}
</script></head><body><div id="main"><div style="display: none"></div><div id="breadcrumbs" class="breadcrumb"><a href="https://aws.amazon.com">AWS</a><a href="/index.html">Documentation</a><a href="/cloudformation/index.html">AWS CloudFormation</a><a href="Welcome.html">User Guide</a></div><div id="page-toc-src"><a href="#stack-policy-intro-example">Example stack policy</a><a href="#stack-policy-reference">Defining a stack policy</a><a href="#protect-stack-resources-protecting">Setting a stack policy</a><a href="#protect-stack-resources-updating">Updating protected resources</a><a href="#protect-stack-resources-modifying">Modifying a stack policy </a><a href="#stack-policy-samples">More example stack policies</a></div><div id="main-content" class="awsui-util-container"><div id="main-col-body"><awsdocs-language-banner data-service="$ctrl.pageService"></awsdocs-language-banner><h1 class="topictitle" id="protect-stack-resources">Prevent updates to stack resources</h1><div class="awsdocs-page-header-container"><awsdocs-page-header></awsdocs-page-header><awsdocs-filter-selector id="awsdocs-filter-selector"></awsdocs-filter-selector></div><p>When you create a stack, all update actions are allowed on all resources. By default, anyone
    with stack update permissions can update all of the resources in the stack. During an update,
    some resources might require an interruption or be completely replaced, resulting in new
    physical IDs or completely new storage. You can prevent <a href="./aws-template-resource-type-ref.html">stack resources</a> from being unintentionally
    updated or deleted during a stack update by using a stack policy. A stack policy is a JSON
    document that defines the update actions that can be performed on designated resources.</p><p>After you set a stack policy, all of the resources in the stack are protected by default. To allow updates on
  specific resources, you specify an explicit <code class="code">Allow</code> statement for those resources in your stack policy. You
  can define only one stack policy per stack, but, you can protect multiple resources within a single policy. A stack
  policy applies to all AWS CloudFormation users who attempt to update the stack. You can't associate different stack policies with
  different users.</p><p>A stack policy applies only during stack updates. It doesn't provide
    access controls like an AWS Identity and Access Management (IAM) policy. Use a stack policy only as
    a fail-safe mechanism to prevent accidental updates to specific stack
    resources. To control access to AWS resources or actions, use IAM.</p><div class="highlights" id="inline-topiclist"><h6>Topics</h6><ul><li><a href="#stack-policy-intro-example">Example stack policy</a></li><li><a href="#stack-policy-reference">Defining a stack policy</a></li><li><a href="#protect-stack-resources-protecting">Setting a stack policy</a></li><li><a href="#protect-stack-resources-updating">Updating protected resources</a></li><li><a href="#protect-stack-resources-modifying">Modifying a stack policy </a></li><li><a href="#stack-policy-samples">More example stack policies</a></li></ul></div>
   <h2 id="stack-policy-intro-example">Example stack policy</h2>
    <p>The following example stack policy prevents updates to the
        <code class="code">ProductionDatabase</code>
      resource:</p><pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
  "Statement" : [
    <span>{</span>
      "Effect" : "Allow",
      "Action" : "Update:*",
      "Principal": "*",
      "Resource" : "*"
    },
    <span>{</span>
      "Effect" : "Deny",
      "Action" : "Update:*",
      "Principal": "*",
      "Resource" : "LogicalResourceId/ProductionDatabase"
    }
  ]
}</code></pre>
    <p>When you set a stack policy, all resources are protected by default.
      To allow updates on all resources, we add an <code class="code">Allow</code> statement
      that allows all actions on all resources. Although the <code class="code">Allow</code>
      statement specifies all resources, the explicit <code class="code">Deny</code>
      statement overrides it for the resource with the
        <code class="code">ProductionDatabase</code> logical ID. This <code class="code">Deny</code>
      statement prevents all update actions, such as replacement or deletion, on
      the <code class="code">ProductionDatabase</code> resource.</p>
    <p>The <code class="code">Principal</code> element is required, but supports only the
      wild card (<code class="code">*</code>), which means that the statement applies to all
        <a href="https://docs.aws.amazon.com/glossary/latest/reference/glos-chap.html#principal">principals</a>.</p>
    <div class="awsdocs-note"><div class="awsdocs-note-title"><awsui-icon name="status-info" variant="link"></awsui-icon><h6>Note</h6></div><div class="awsdocs-note-text"><p>During a stack update, AWS CloudFormation automatically updates resources that depend on other
        updated resources. For example, AWS CloudFormation updates a resource that references an updated
        resource. AWS CloudFormation makes no physical changes, such as the resource's ID, to automatically
        updated resources, but if a stack policy is associated with those resources, you must have
        permission to update them.</p></div></div>
   
   <h2 id="stack-policy-reference">Defining a stack policy</h2>
    <p>When you create a stack, no stack policy is set, so all update actions are allowed on all
      resources. To protect stack resources from update actions, define a stack policy and then set
      it on your stack. A stack policy is a JSON document that defines the AWS CloudFormation stack update
      actions that AWS CloudFormation users can perform and the resources that the actions apply to. You set the
      stack policy when you create a stack, by specifying a text file that contains your stack
      policy or typing it out. When you set a stack policy on your stack, any update not explicitly
      allowed is denied by default.</p>
    <p>You define a stack policy with five elements: <code class="code">Effect</code>, <code class="code">Action</code>,
        <code class="code">Principal</code>, <code class="code">Resource</code>, and <code class="code">Condition</code>. The following
      pseudo code shows stack policy syntax.</p><pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
  "Statement" : [
    <span>{</span>
      "Effect" : "<code class="replaceable">Deny_or_Allow</code>",
      "Action" : "<code class="replaceable">update_actions</code>",
      "Principal" : "*",
      "Resource" : "LogicalResourceId/<code class="replaceable">resource_logical_ID</code>",
      "Condition" : <span>{</span>
        "<code class="replaceable">StringEquals_or_StringLike</code>" : <span>{</span>
          "ResourceType" : [<code class="replaceable">resource_type, ...</code>]
        }
      }
    }
  ]
}</code></pre>
    <div class="variablelist">
       
       
       
       
       
    <dl>
        <dt><span class="term"><code class="code">Effect</code></span></dt>
        <dd>
          <p>Determines whether the actions that you specify are denied or
            allowed on the resource(s) that you specify. You can specify only
              <code class="code">Deny</code> or <code class="code">Allow</code>, such
            as:</p>
         <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="json ">"Effect" : "Deny"</code></pre>
          <div class="awsdocs-note awsdocs-important"><div class="awsdocs-note-title"><awsui-icon name="status-warning" variant="error"></awsui-icon><h6>Important</h6></div><div class="awsdocs-note-text"><p>If a stack policy includes overlapping statements (both
              allowing and denying updates on a resource), a <code class="code">Deny</code>
              statement always overrides an <code class="code">Allow</code> statement. To
              ensure that a resource is protected, use a <code class="code">Deny</code>
              statement for that resource.</p></div></div>
        </dd>
       
        <dt><span class="term">Action</span></dt>
        <dd>
          <p>Specifies the update actions that are denied or allowed:</p><div class="variablelist">
               
               
               
               
            <dl>
                <dt><span class="term">Update:Modify</span></dt>
                <dd>
                  <p>Specifies update actions during which resources might
                    experience no interruptions or some interruptions while
                    changes are being applied. All resources maintain their
                    physical IDs.</p>
                </dd>
               
                <dt><span class="term">Update:Replace</span></dt>
                <dd>
                  <p>Specifies update actions during which resources are
                    recreated. AWS CloudFormation creates a new resource with the specified
                    updates and then deletes the old resource. Because the
                    resource is recreated, the physical ID of the new resource
                    might be different.</p>
                </dd>
               
                <dt><span class="term">Update:Delete</span></dt>
                <dd>
                  <p>Specifies update actions during which resources are
                    removed. Updates that completely remove resources from a
                    stack template require this action.</p>
                </dd>
               
                <dt><span class="term">Update:*</span></dt>
                <dd>
                  <p>Specifies all update actions. The asterisk is a wild
                    card that represents all update actions.</p>
                </dd>
              </dl></div>
          <p>The following example shows how to specify just the replace and
            delete actions:</p>
          <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="json ">"Action" : ["Update:Replace", "Update:Delete"]</code></pre>
          <p>To allow all update actions except for one, use
              <code class="code">NotAction</code>. For example, to allow all update actions
            except for <code class="code">Update:Delete</code>, use <code class="code">NotAction</code>,
            as shown in this
            example:</p><pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
  "Statement" : [
    <span>{</span>
      "Effect" : "Allow",
      "NotAction" : "Update:Delete",
      "Principal": "*",
      "Resource" : "*"
    }
  ]
}</code></pre>
          <p>For more information about stack updates, see <a href="./using-cfn-updating-stacks.html">AWS CloudFormation stack updates</a>.</p>
        </dd>
       
        <dt><span class="term">Principal</span></dt>
        <dd>
          <p>The <code class="code">Principal</code> element specifies the entity that the
            policy applies to. This element is required but supports only the
            wild card (<code class="code">*</code>), which means that the policy applies to
            all <a href="https://docs.aws.amazon.com/glossary/latest/reference/glos-chap.html#principal">principals</a>.</p>
        </dd>
       
        <dt><span class="term">Resource</span></dt>
        <dd>
          <p>Specifies the logical IDs of the resources that the policy
            applies to. To specify <a href="./aws-template-resource-type-ref.html">types of
            resources</a>, use the <code class="code">Condition</code> element.</p>
          <p>To specify a single resource, use its logical ID. For
            example:</p>
         <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="json ">"Resource" : ["LogicalResourceId/myEC2instance"]</code></pre>
          <p>You can use a wild card with logical IDs. For example, if you
            use a common logical ID prefix for all related resources, you can
            specify all of them with a wild
            card:</p>
         <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="json ">"Resource" : ["LogicalResourceId/CriticalResource*"]</code></pre>
          <p>You can also use a <code class="code">Not</code> element with resources. For
            example, to allow updates to all resources except for one, use a
              <code class="code">NotResource</code> element to protect that
            resource:</p><pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
  "Statement" : [
    <span>{</span>
      "Effect" : "Allow",
      "Action" : "Update:*",
      "Principal": "*",
      "NotResource" : "LogicalResourceId/ProductionDatabase"
    }
  ]
}</code></pre>
          <p>When you set a stack policy, any update not explicitly allowed
            is denied. By allowing updates to all resources except for the
              <code class="code">ProductionDatabase</code> resource, you deny updates to the
              <code class="code">ProductionDatabase</code> resource.</p>
        </dd>
       
        <dt><span class="term">Conditions</span></dt>
        <dd>
          <p>Specifies the <a href="./aws-template-resource-type-ref.html">resource type</a> that the policy applies to. To specify the
            logical IDs of specific resources, use the <code class="code">Resource</code>
            element.</p>
          <p>You can specify a resource type, such as all EC2 and RDS DB
            instances, as shown in the following
            example:</p><pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
  "Statement" : [
  <span>{</span>
    "Effect" : "Deny",
    "Principal" : "*",
    "Action" : "Update:*",
    "Resource" : "*",
    "Condition" : <span>{</span>
      "StringEquals" : <span>{</span>
        "ResourceType" : ["AWS::EC2::Instance", "AWS::RDS::DBInstance"]
      }
    }
  },
  <span>{</span>
    "Effect" : "Allow",
    "Principal" : "*",
    "Action" : "Update:*",
    "Resource" : "*"
  }
  ]
}</code></pre>
          <p>The <code class="code">Allow</code> statement grants update permissions to
            all resources and the <code class="code">Deny</code> statement denies updates to
            EC2 and RDS DB instances. The <code class="code">Deny</code> statement always
            overrides allow actions.</p>
          <p>You can use a wild card with resource types. For example, you
            can deny update permissions to all Amazon EC2 resources—such as
            instances, security groups, and subnets—by using a wild card,
            as shown in the following
            example:</p>
         <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="json ">"Condition" : <span>{</span>
  "StringLike" : <span>{</span>
    "ResourceType" : ["AWS::EC2::*"]
  }
}</code></pre>
          <p>You must use the <code class="code">StringLike</code> condition when you use
            wild cards.</p>
        </dd>
      </dl></div>
   
   <h2 id="protect-stack-resources-protecting">Setting a stack policy</h2>
    <p>You can use the console or AWS CLI to apply a stack policy when you
      create a stack. You can also use the AWS CLI to apply a stack policy to an
      existing stack. After you apply a stack policy, you can't remove it from
      the stack, but you can use the AWS CLI to modify it.</p>
    <p>Stack policies apply to all AWS CloudFormation users who attempt to update the
      stack. You can't associate different stack policies with different
      users.</p>
    <p>For information about writing stack policies, see <a href="#stack-policy-reference">Defining a stack policy</a>.</p>
    <div class="procedure"><h6>To set a stack policy when you create a stack (console)</h6><ol><li><p>Open the AWS CloudFormation console at
         <a href="https://console.aws.amazon.com/cloudformation/" rel="noopener noreferrer" target="_blank"><span>https://console.aws.amazon.com/cloudformation</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a>.</p></li><li>
        <p>On the <b>CloudFormation Stacks</b> page, choose <b>Create
            stack</b>.</p>
      </li><li>
        <p>In the Create Stack wizard, on the <b>Configure stack options</b> page,
          expand the <b>Advanced</b> section and then choose <b>Stack
            policy</b>.</p>
      </li><li>
        <p>Specify the stack policy:</p>
        <div class="itemizedlist">
           
           
        <ul class="itemizedlist"><li class="listitem"><p>To write a policy directly in the console, choose <b>Enter stack policy</b> and
              then type the stack policy directly in the text field.</p></li><li class="listitem"><p>To use a policy defined in a separate file, choose <b>Upload a file</b>, then <b>Choose file</b> to select the file containing the stack policy.</p></li></ul></div>
      </li></ol></div>
    <div class="procedure"><h6>To set a stack policy when you create a stack (AWS CLI)</h6><ul><li>
        <p>Use the <code class="code"><a href="https://docs.aws.amazon.com/cli/latest/reference/cloudformation/create-stack.html">aws cloudformation create-stack</a></code> command with the
            <code class="code">--stack-policy-body</code> option to type in a modified policy
          or the <code class="code">--stack-policy-url</code> option to specify a file
          containing the policy. </p>
      </li></ul></div>
    <div class="procedure"><h6>To set a stack policy on an existing stack (AWS CLI only)</h6><ul><li>
        <p>Use the <code class="code"><a href="https://docs.aws.amazon.com/cli/latest/reference/cloudformation/set-stack-policy.html">aws cloudformation set-stack-policy</a></code> command with the
            <code class="code">--stack-policy-body</code> option to type in a modified policy
          or the <code class="code">--stack-policy-url</code> option to specify a file
          containing the policy.</p>
        <div class="awsdocs-note"><div class="awsdocs-note-title"><awsui-icon name="status-info" variant="link"></awsui-icon><h6>Note</h6></div><div class="awsdocs-note-text"><p>To add a policy to an existing stack, you must have permission
            to the AWS CloudFormation <code class="code"><a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/APIReference/API_SetStackPolicy.html">SetStackPolicy</a></code> action.</p></div></div>
      </li></ul></div>
   
   <h2 id="protect-stack-resources-updating">Updating protected resources</h2>
    <p>To update protected resources, create a temporary policy that
      overrides the stack policy and allows updates on those resources. Specify
      the override policy when you update the stack. The override policy doesn't
      permanently change the stack policy.</p>
    <p>To update protected resources, you must have permission to use the AWS CloudFormation
        <code class="code"><a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/APIReference/API_SetStackPolicy.html">SetStackPolicy</a></code> action. For information about setting AWS CloudFormation permissions, see
        <a href="./using-iam-template.html">Controlling access with AWS Identity and Access Management</a>.</p>
    <div class="awsdocs-note"><div class="awsdocs-note-title"><awsui-icon name="status-info" variant="link"></awsui-icon><h6>Note</h6></div><div class="awsdocs-note-text"><p>During a stack update, AWS CloudFormation automatically updates resources that
        depend on other updated resources. For example, AWS CloudFormation updates a resource
        that references an updated resource. AWS CloudFormation makes no physical changes,
        such as the resources' ID, to automatically updated resources, but if a
        stack policy is associated with those resources, you must have
        permission to update them.</p></div></div>
    <div class="procedure"><h6>To update a protected resource (console)</h6><ol><li><p>Open the AWS CloudFormation console at
         <a href="https://console.aws.amazon.com/cloudformation/" rel="noopener noreferrer" target="_blank"><span>https://console.aws.amazon.com/cloudformation</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a>.</p></li><li>
        <p>Select the stack that you want to update, choose <b>Stack actions</b>,
          and then choose <b>Update stack</b>.</p>
      </li><li>
        <p>If you <em>haven't</em> modified the stack template, select <b>Use
          current template</b>, and then click <b>Next</b>. If you have
          modified the template, select <b>Replace current template</b> and specify the
          location of the updated template in the <b>Specify template</b>
          section:</p>
        <div class="itemizedlist">
           
           
        <ul class="itemizedlist"><li class="listitem">
            <p>For a template stored locally on your computer, select <b>Upload a template
              file</b>. Choose <b>Choose File</b> to navigate to the file and
              select it, and then click <b>Next</b>.</p>
          </li><li class="listitem">
            <p>For a template stored in an Amazon S3 bucket, select <b>Amazon S3 URL</b>. Enter
              or paste the URL for the template, and then click <b>Next</b>.</p>
            <p>If you have a template in a versioning-enabled bucket, you can
              specify a specific version of the template, such as
              <code class="code">https://s3.amazonaws.com/templates/myTemplate.template?versionId=123ab1cdeKdOW5IH4GAcYbEngcpTJTDW</code>.
              For more information, see <a href="https://docs.aws.amazon.com/AmazonS3/latest/user-guide/managing-objects-versioned-bucket.html">Managing objects in a versioning-enabled bucket</a> in the
                <em>Amazon Simple Storage Service User Guide</em>.</p>
          </li></ul></div>
      </li><li>
        <p>If your template contains parameters, on the <b>Specify stack
            details</b> page, enter or modify the parameter values, and then choose
            <b>Next</b>.</p>
        <p>AWS CloudFormation populates each parameter with the value that is currently
          set in the stack except for parameters declared with the
            <code class="code">NoEcho</code> attribute. You can use current values for those
          parameters by choosing <b>Use existing value</b>.</p>
        <p>For more information about using <code class="code">NoEcho</code> to mask sensitive information, as well as using dynamic parameters to manage secrets, see the <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/best-practices.html#creds">Do not embed credentials in your templates</a> best practice.</p>
      </li><li>
        <p>Specify an override stack policy.</p>
        <ol><li><p>On the <b>Configure stack options</b> page, in the <b>Advanced options</b> section, select <b>Stack policy</b>.</p></li><li><p>Select <b>Upload a file</b>.</p></li><li><p>Click <b>Choose file</b> and navigate to the file that contains the overriding stack policy or type a policy.</p></li><li><p>Choose <b>Next</b>.</p></li></ol>
        
        <p>The override policy must specify an <code class="code">Allow</code>
          statement for the protected resources that you want to update. For example, to update all protected resources, specify a
          temporary override policy that allows all
          updates:</p><pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
  "Statement" : [
    <span>{</span>
      "Effect" : "Allow",
      "Action" : "Update:*",
      "Principal": "*",
      "Resource" : "*"
    }
  ]
}</code></pre>
        <div class="awsdocs-note"><div class="awsdocs-note-title"><awsui-icon name="status-info" variant="link"></awsui-icon><h6>Note</h6></div><div class="awsdocs-note-text"><p>AWS CloudFormation applies the override policy only during this update. The
            override policy doesn't permanently change the stack policy. To
            modify a stack policy, see <a href="#protect-stack-resources-modifying">Modifying a stack policy </a>.</p></div></div>
      </li><li>
        <p>Review the stack information and the changes that you
          submitted.</p>
        <p>Check that you submitted the correct information, such as the correct parameter values
          or template URL. If your template contains IAM resources, choose <b>I acknowledge
            that this template may create IAM resources</b> to specify that you want to use
          IAM resources in the template. For more information about using IAM resources in
          templates, see <a href="./using-iam-template.html">Controlling access with AWS Identity and Access Management</a>.</p>
        <p>In the <b>Preview your changes</b> section, check
          that AWS CloudFormation will make all the changes that you expect. For example,
          check that AWS CloudFormation adds, removes, and modifies the resources that you
          intended to add, remove, or modify. AWS CloudFormation generates this preview by
          creating a change set for the stack. For more information, see <a href="./using-cfn-updating-stacks-changesets.html">Updating stacks using change sets</a>.</p>
      </li><li>
        <p>When you are satisfied with your changes, click <b>Update</b>.</p>
        <div class="awsdocs-note"><div class="awsdocs-note-title"><awsui-icon name="status-info" variant="link"></awsui-icon><h6>Note</h6></div><div class="awsdocs-note-text"><p>At this point, you also have the option to view the change set to review your proposed updates
          more thoroughly. To do so, click <b>View change set</b> instead of
          <b>Update</b>. CloudFormation displays the change set generated based on
          your updates. When you are ready to perform the stack update, click
          <b>Execute</b>.</p></div></div>
        <p>CloudFormation displays the <b>Stack details</b> page for your stack. Your stack now has a status of <b>UPDATE_IN_PROGRESS</b>. After CloudFormation has successfully finished updating the stack, it sets the stack status to <b>UPDATE_COMPLETE</b>.</p>
        <p>If the stack update fails, CloudFormation; automatically rolls back changes, and sets the stack
          status to <b>UPDATE_ROLLBACK_COMPLETE</b>.</p>
      </li></ol></div>
    <div class="procedure"><h6>To update a protected resource (AWS CLI)</h6><ul><li>
        <p>Use the <code class="code"><a href="https://docs.aws.amazon.com/cli/latest/reference/cloudformation/update-stack.html">aws cloudformation update-stack</a></code> command with the
            <code class="code">--stack-policy-during-update-body</code> option to type in a
          modified policy or the <code class="code">--stack-policy-during-update-url</code>
          option to specify a file containing the policy.</p>
        <div class="awsdocs-note"><div class="awsdocs-note-title"><awsui-icon name="status-info" variant="link"></awsui-icon><h6>Note</h6></div><div class="awsdocs-note-text"><p>AWS CloudFormation applies the override policy only during this update. The
            override policy doesn't permanently change the stack policy. To
            modify a stack policy, see <a href="#protect-stack-resources-modifying">Modifying a stack policy </a>.</p></div></div>
      </li></ul></div>
   
   <h2 id="protect-stack-resources-modifying">Modifying a stack policy </h2>
    <p>To protect additional resources or to remove protection from
      resources, modify the stack policy. For example, when you add a database
      that you want to protect to your stack, add a <code class="code">Deny</code> statement
      for that database to the stack policy. To modify the policy, you must have
      permission to use the <code class="code"><a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/APIReference/API_SetStackPolicy.html">SetStackPolicy</a></code> action.</p>
    <p>Use the AWS CLI to modify stack policies.</p>
    <div class="procedure"><h6>To modify a stack policy (AWS CLI)</h6><ul><li>
        <p>Use the <code class="code"><a href="https://docs.aws.amazon.com/cli/latest/reference/cloudformation/set-stack-policy.html">aws cloudformation set-stack-policy</a></code> command with the
            <code class="code">--stack-policy-body</code> option to type in a modified policy
          or the <code class="code">--stack-policy-url</code> option to specify a file
          containing the policy.</p>
      </li></ul></div>
    <p>You can't delete a stack policy. To remove all protection from all
      resources, you modify the policy to explicitly allow all actions on all
      resources. The following policy allows all updates on all
      resources:</p><pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
  "Statement" : [
    <span>{</span>
      "Effect" : "Allow",
      "Action" : "Update:*",
      "Principal": "*",
      "Resource" : "*"
    }
  ]
}</code></pre>
   
   <h2 id="stack-policy-samples">More example stack policies</h2>
    <p>The following example policies show how to prevent updates to all
      stack resources and to specific resources, and prevent specific types of
      updates.</p>
     
     <h3 id="w9aac25c17c29c21b5">Prevent updates to all stack resources</h3>
      <p>To prevent updates to all stack resources, the following policy
        specifies a <code class="code">Deny</code> statement for all update actions on all
        resources.</p>
      <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
  "Statement" : [
    <span>{</span>
      "Effect" : "Deny",
      "Action" : "Update:*",
      "Principal": "*",
      "Resource" : "*"
    }
  ]
}</code></pre>
     
     
     <h3 id="w9aac25c17c29c21b7">Prevent updates to a single resource</h3>
      <p>The following policy denies all update actions on the database with
        the <code class="code">MyDatabase</code> logical ID. It allows all update actions on
        all other stack resources with an <code class="code">Allow</code> statement. The
          <code class="code">Allow</code> statement doesn't apply to the
          <code class="code">MyDatabase</code> resource because the <code class="code">Deny</code>
        statement always overrides allow actions.</p>
      <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
  "Statement" : [
    <span>{</span>
      "Effect" : "Deny",
      "Action" : "Update:*",
      "Principal": "*",
      "Resource" : "LogicalResourceId/MyDatabase"
    },
    <span>{</span>
      "Effect" : "Allow",
      "Action" : "Update:*",
      "Principal": "*",
      "Resource" : "*"
    }
  ]
}</code></pre>
      <p>You can achieve the same result as the previous example by using a
        default denial. When you set a stack policy, AWS CloudFormation denies any update
        that is not explicitly allowed. The following policy allows updates to
        all resources except for the <code class="code">ProductionDatabase</code> resource,
        which is denied by default.</p>
      <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
  "Statement" : [
    <span>{</span>
      "Effect" : "Allow",
      "Action" : "Update:*",
      "Principal": "*",
      "NotResource" : "LogicalResourceId/ProductionDatabase"
    }
  ]
}</code></pre>
      <div class="awsdocs-note awsdocs-important"><div class="awsdocs-note-title"><awsui-icon name="status-warning" variant="error"></awsui-icon><h6>Important</h6></div><div class="awsdocs-note-text"><p>There is risk in using a default denial. If you have an
            <code class="code">Allow</code> statement elsewhere in the policy (such as an
            <code class="code">Allow</code> statement that uses a wildcard), you might
          unknowingly grant update permission to resources that you don't intend
          to. Because an explicit denial overrides any allow actions, you can
          ensure that a resource is protected by using a <code class="code">Deny</code>
          statement.</p></div></div>
     
     
     <h3 id="w9aac25c17c29c21b9">Prevent updates to all instances of a resource type</h3>
      <p>The following policy denies all update actions on the RDS DB
        instance resource type. It allows all update actions on all other stack
        resources with an <code class="code">Allow</code> statement. The <code class="code">Allow</code>
        statement doesn't apply to the RDS DB instance resources because a
          <code class="code">Deny</code> statement always overrides allow actions.</p>
      <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
  "Statement" : [
    <span>{</span>
      "Effect" : "Deny",
      "Action" : "Update:*",
      "Principal": "*",
      "Resource" : "*",
      "Condition" : <span>{</span>
        "StringEquals" : <span>{</span>
          "ResourceType" : ["AWS::RDS::DBInstance"]
        }
      }
    },
    <span>{</span>
      "Effect" : "Allow",
      "Action" : "Update:*",
      "Principal": "*",
      "Resource" : "*"
    }
  ]
}</code></pre>
     
     
     <h3 id="w9aac25c17c29c21c11">Prevent replacement updates for an instance</h3>
      <p>The following policy denies updates that would cause a replacement
        of the instance with the <code class="code">MyInstance</code> logical ID. It allows
        all update actions on all other stack resources with an
          <code class="code">Allow</code> statement. The <code class="code">Allow</code> statement doesn't
        apply to the <code class="code">MyInstance</code> resource because the
          <code class="code">Deny</code> statement always overrides allow actions.</p>
      <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
  "Statement" : [
    <span>{</span>
      "Effect" : "Deny",
      "Action" : "Update:Replace",
      "Principal": "*",
      "Resource" : "LogicalResourceId/MyInstance"
    },
    <span>{</span>
      "Effect" : "Allow",
      "Action" : "Update:*",
      "Principal": "*",
      "Resource" : "*"
    }
  ]
}</code></pre>
     
     
     <h3 id="w9aac25c17c29c21c13">Prevent updates to nested stacks</h3>
      <p>The following policy denies all update actions on the AWS CloudFormation stack
        resource type (nested stacks). It allows all update actions on all other
        stack resources with an <code class="code">Allow</code> statement. The
          <code class="code">Allow</code> statement doesn't apply to the AWS CloudFormationstack resources
        because the <code class="code">Deny</code> statement always overrides allow
        actions.</p>
      <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
  "Statement" : [
    <span>{</span>
      "Effect" : "Deny",
      "Action" : "Update:*",
      "Principal": "*",
      "Resource" : "*",
      "Condition" : <span>{</span>
        "StringEquals" : <span>{</span>
          "ResourceType" : ["AWS::CloudFormation::Stack"]
        }
      }
    },
    <span>{</span>
      "Effect" : "Allow",
      "Action" : "Update:*",
      "Principal": "*",
      "Resource" : "*"
    }
  ]
}</code></pre>
     
  <awsdocs-copyright class="copyright-print"></awsdocs-copyright><awsdocs-thumb-feedback right-edge="{{$ctrl.thumbFeedbackRightEdge}}"></awsdocs-thumb-feedback></div><noscript><div><div><div><div id="js_error_message"><p><img src="https://d1ge0kk1l5kms0.cloudfront.net/images/G/01/webservices/console/warning.png" alt="Warning" /> <strong>Javascript is disabled or is unavailable in your browser.</strong></p><p>To use the Amazon Web Services Documentation, Javascript must be enabled. Please refer to your browser's Help pages for instructions.</p></div></div></div></div></noscript><div id="main-col-footer" class="awsui-util-font-size-0"><div id="doc-conventions"><a target="_top" href="/general/latest/gr/docconventions.html">Document Conventions</a></div><div class="prev-next"><div id="previous" class="prev-link" accesskey="p" href="./using-cfn--stack-update-cancel.html">Canceling a stack update</div><div id="next" class="next-link" accesskey="n" href="./using-cfn-updating-stacks-continueupdaterollback.html">Continue rolling back an update</div></div></div><awsdocs-page-utilities></awsdocs-page-utilities></div><div id="quick-feedback-yes" style="display: none;"><div class="title">Did this page help you? - Yes</div><div class="content"><p>Thanks for letting us know we're doing a good job!</p><p>If you've got a moment, please tell us what we did right so we can do more of it.</p><p><awsui-button id="fblink" rel="noopener noreferrer" target="_blank" text="Feedback" click="linkClick($event)" href="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=CloudFormation&amp;topic_url=https://docs.aws.amazon.com/en_us/AWSCloudFormation/latest/UserGuide/protect-stack-resources.html"></awsui-button></p></div></div><div id="quick-feedback-no" style="display: none;"><div class="title">Did this page help you? - No</div><div class="content"><p>Thanks for letting us know this page needs work. We're sorry we let you down.</p><p>If you've got a moment, please tell us how we can make the documentation better.</p><p><awsui-button id="fblink" rel="noopener noreferrer" target="_blank" text="Feedback" click="linkClick($event)" href="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=CloudFormation&amp;topic_url=https://docs.aws.amazon.com/en_us/AWSCloudFormation/latest/UserGuide/protect-stack-resources.html"></awsui-button></p></div></div></div></body></div></awsdocs-view><div class="page-loading-indicator" id="page-loading-indicator"><awsui-spinner size="large"></awsui-spinner></div></div><div id="tools-panel" dom-region="tools"><awsdocs-tools-panel id="awsdocs-tools-panel"></awsdocs-tools-panel></div></awsui-app-layout><awsdocs-cookie-banner class="doc-cookie-banner"></awsdocs-cookie-banner></div></body></html>