<!DOCTYPE html>
    <html xmlns="http://www.w3.org/1999/xhtml" lang="en-US"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Configure Amazon VPC resources with AWS CloudFormation - AWS CloudFormation</title><meta name="viewport" content="width=device-width,initial-scale=1" /><meta name="assets_root" content="/assets" /><meta name="target_state" content="quickref-ec2-vpc" /><meta name="default_state" content="quickref-ec2-vpc" /><link rel="icon" type="image/ico" href="/assets/images/favicon.ico" /><link rel="shortcut icon" type="image/ico" href="/assets/images/favicon.ico" /><link rel="canonical" href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/quickref-ec2-vpc.html" /><meta name="description" content="Use these example template snippets to configure Amazon VPC resources with AWS CloudFormation." /><meta name="deployment_region" content="IAD" /><meta name="product" content="AWS CloudFormation" /><meta name="guide" content="User Guide" /><meta name="abstract" content="Create and manage AWS infrastructure deployments predictably and repeatedly using AWS CloudFormation with this User Guide." /><meta name="guide-locale" content="en_us" /><meta name="tocs" content="toc-contents.json" /><link rel="canonical" href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/quickref-ec2-vpc.html" /><link rel="alternative" href="https://docs.aws.amazon.com/id_id/AWSCloudFormation/latest/UserGuide/quickref-ec2-vpc.html" hreflang="id-id" /><link rel="alternative" href="https://docs.aws.amazon.com/id_id/AWSCloudFormation/latest/UserGuide/quickref-ec2-vpc.html" hreflang="id" /><link rel="alternative" href="https://docs.aws.amazon.com/de_de/AWSCloudFormation/latest/UserGuide/quickref-ec2-vpc.html" hreflang="de-de" /><link rel="alternative" href="https://docs.aws.amazon.com/de_de/AWSCloudFormation/latest/UserGuide/quickref-ec2-vpc.html" hreflang="de" /><link rel="alternative" href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/quickref-ec2-vpc.html" hreflang="en-us" /><link rel="alternative" href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/quickref-ec2-vpc.html" hreflang="en" /><link rel="alternative" href="https://docs.aws.amazon.com/es_es/AWSCloudFormation/latest/UserGuide/quickref-ec2-vpc.html" hreflang="es-es" /><link rel="alternative" href="https://docs.aws.amazon.com/es_es/AWSCloudFormation/latest/UserGuide/quickref-ec2-vpc.html" hreflang="es" /><link rel="alternative" href="https://docs.aws.amazon.com/fr_fr/AWSCloudFormation/latest/UserGuide/quickref-ec2-vpc.html" hreflang="fr-fr" /><link rel="alternative" href="https://docs.aws.amazon.com/fr_fr/AWSCloudFormation/latest/UserGuide/quickref-ec2-vpc.html" hreflang="fr" /><link rel="alternative" href="https://docs.aws.amazon.com/it_it/AWSCloudFormation/latest/UserGuide/quickref-ec2-vpc.html" hreflang="it-it" /><link rel="alternative" href="https://docs.aws.amazon.com/it_it/AWSCloudFormation/latest/UserGuide/quickref-ec2-vpc.html" hreflang="it" /><link rel="alternative" href="https://docs.aws.amazon.com/ja_jp/AWSCloudFormation/latest/UserGuide/quickref-ec2-vpc.html" hreflang="ja-jp" /><link rel="alternative" href="https://docs.aws.amazon.com/ja_jp/AWSCloudFormation/latest/UserGuide/quickref-ec2-vpc.html" hreflang="ja" /><link rel="alternative" href="https://docs.aws.amazon.com/ko_kr/AWSCloudFormation/latest/UserGuide/quickref-ec2-vpc.html" hreflang="ko-kr" /><link rel="alternative" href="https://docs.aws.amazon.com/ko_kr/AWSCloudFormation/latest/UserGuide/quickref-ec2-vpc.html" hreflang="ko" /><link rel="alternative" href="https://docs.aws.amazon.com/pt_br/AWSCloudFormation/latest/UserGuide/quickref-ec2-vpc.html" hreflang="pt-br" /><link rel="alternative" href="https://docs.aws.amazon.com/pt_br/AWSCloudFormation/latest/UserGuide/quickref-ec2-vpc.html" hreflang="pt" /><link rel="alternative" href="https://docs.aws.amazon.com/zh_cn/AWSCloudFormation/latest/UserGuide/quickref-ec2-vpc.html" hreflang="zh-cn" /><link rel="alternative" href="https://docs.aws.amazon.com/zh_tw/AWSCloudFormation/latest/UserGuide/quickref-ec2-vpc.html" hreflang="zh-tw" /><link rel="alternative" href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/quickref-ec2-vpc.html" hreflang="x-default" /><meta name="feedback-item" content="CloudFormation" /><meta name="this_doc_product" content="AWS CloudFormation" /><meta name="this_doc_guide" content="User Guide" /><script defer="" src="/assets/r/vendor4.js?version=2021.12.02"></script><script defer="" src="/assets/r/vendor3.js?version=2021.12.02"></script><script defer="" src="/assets/r/vendor1.js?version=2021.12.02"></script><script defer="" src="/assets/r/awsdocs-common.js?version=2021.12.02"></script><script defer="" src="/assets/r/awsdocs-doc-page.js?version=2021.12.02"></script><link href="/assets/r/vendor4.css?version=2021.12.02" rel="stylesheet" /><link href="/assets/r/awsdocs-common.css?version=2021.12.02" rel="stylesheet" /><link href="/assets/r/awsdocs-doc-page.css?version=2021.12.02" rel="stylesheet" /><script async="" id="awsc-panorama-bundle" type="text/javascript" src="https://prod.pa.cdn.uis.awsstatic.com/panorama-nav-init.js" data-config="{'appEntity':'aws-documentation','region':'us-east-1','service':'cloudformation'}"></script><meta id="panorama-serviceSubSection" value="User Guide" /><meta id="panorama-serviceConsolePage" value="Configure Amazon VPC resources with AWS CloudFormation" /></head><body class="awsdocs awsui"><div class="awsdocs-container"><awsdocs-header></awsdocs-header><awsui-app-layout id="app-layout" class="awsui-util-no-gutters" ng-controller="ContentController as $ctrl" header-selector="awsdocs-header" navigation-hide="false" navigation-width="$ctrl.navWidth" navigation-open="$ctrl.navOpen" navigation-change="$ctrl.onNavChange($event)" tools-hide="$ctrl.hideTools" tools-width="$ctrl.toolsWidth" tools-open="$ctrl.toolsOpen" tools-change="$ctrl.onToolsChange($event)"><div id="guide-toc" dom-region="navigation"><awsdocs-toc></awsdocs-toc></div><div id="main-column" dom-region="content" tabindex="-1"><awsdocs-view class="awsdocs-view"><div id="awsdocs-content"><head><title>Configure Amazon VPC resources with AWS CloudFormation - AWS CloudFormation</title><meta name="rss" content="aws-cloudformation-release-notes.rss" /><meta name="forums" content="http://forums.aws.amazon.com/forum.jspa?forumID=92" /><meta name="feedback" content="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=CloudFormation&amp;topic_url=https://docs.aws.amazon.com/en_us/AWSCloudFormation/latest/UserGuide/quickref-ec2-vpc.html" /><meta name="feedback-yes" content="feedbackyes.html?topic_url=https://docs.aws.amazon.com/en_us/AWSCloudFormation/latest/UserGuide/quickref-ec2-vpc.html" /><meta name="feedback-no" content="feedbackno.html?topic_url=https://docs.aws.amazon.com/en_us/AWSCloudFormation/latest/UserGuide/quickref-ec2-vpc.html" /><meta name="keywords" content="CloudFormation,AWSCloudFormation,resource provisioning,resource configuration,infrastructure management,CloudFormer,CloudFormation stack,CloudFormation stackset,CloudFormation template,change set" /><script type="application/ld+json">
{
    "@context" : "https://schema.org",
    "@type" : "BreadcrumbList",
    "itemListElement" : [
      {
        "@type" : "ListItem",
        "position" : 1,
        "name" : "AWS",
        "item" : "https://aws.amazon.com"
      },
      {
        "@type" : "ListItem",
        "position" : 2,
        "name" : "AWS CloudFormation",
        "item" : "https://docs.aws.amazon.com/cloudformation/index.html"
      },
      {
        "@type" : "ListItem",
        "position" : 3,
        "name" : "User Guide",
        "item" : "https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide"
      },
      {
        "@type" : "ListItem",
        "position" : 4,
        "name" : "Working with AWS CloudFormation templates",
        "item" : "https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/template-guide.html"
      },
      {
        "@type" : "ListItem",
        "position" : 5,
        "name" : "Template snippets",
        "item" : "https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/CHAP_TemplateQuickRef.html"
      },
      {
        "@type" : "ListItem",
        "position" : 6,
        "name" : "Amazon EC2 CloudFormation template snippets",
        "item" : "https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/quickref-ec2.html"
      },
      {
        "@type" : "ListItem",
        "position" : 7,
        "name" : "Configure Amazon VPC resources with AWS CloudFormation",
        "item" : "https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/quickref-ec2.html"
      }
    ]
}
</script></head><body><div id="main"><div style="display: none"></div><div id="breadcrumbs" class="breadcrumb"><a href="https://aws.amazon.com">AWS</a><a href="/index.html">Documentation</a><a href="/cloudformation/index.html">AWS CloudFormation</a><a href="Welcome.html">User Guide</a></div><div id="page-toc-src"><a href="#quickref-ec2-route-egressonlyinternetgateway">Enable IPv6
                    egress-only internet access in a VPC</a><a href="#cfn-template-snippets-eni">Elastic network interface (ENI) template
      snippets</a></div><div id="page-filters" style="display:none"><filter label="All" id="All"></filter><filter label="JSON" id="JSON"></filter><filter label="YAML" id="YAML"></filter></div><div id="main-content" class="awsui-util-container"><div id="main-col-body"><awsdocs-language-banner data-service="$ctrl.pageService"></awsdocs-language-banner><h1 class="topictitle" id="quickref-ec2-vpc">Configure Amazon VPC resources with AWS CloudFormation</h1><div class="awsdocs-page-header-container"><awsdocs-page-header></awsdocs-page-header><awsdocs-filter-selector id="awsdocs-filter-selector"></awsdocs-filter-selector></div><p>This section provides examples for configuring Amazon VPC resources using AWS CloudFormation. VPCs allow
            you to create a virtual network within AWS, and these snippets show how to configure
            aspects of VPCs to meet your networking requirements. </p><div class="highlights" id="inline-topiclist"><h6>Example snippets</h6><ul><li><a href="#quickref-ec2-route-egressonlyinternetgateway">Enable IPv6
                    egress-only internet access in a VPC</a></li><li><a href="#cfn-template-snippets-eni">Elastic network interface (ENI) template
      snippets</a></li></ul></div>
            <h2 id="quickref-ec2-route-egressonlyinternetgateway">Enable IPv6
                    egress-only internet access in a VPC</h2>
            <p>An egress-only internet gateway allows instances within a VPC to access the
                internet and prevent resources on the internet from communicating with the
                instances. The following snippet enables IPv6 egress-only internet access from
                within a VPC. It creates a VPC with an IPv4 address range of <code class="code">10.0.0/16</code>
                using an <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-resource-ec2-vpc.html">AWS::EC2::VPC</a> resource. A route table is associated with this VPC
                resource using an <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-resource-ec2-routetable.html">AWS::EC2::RouteTable</a> resource. The route table manages routes for
                instances within the VPC. An <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-resource-ec2-egressonlyinternetgateway.html">AWS::EC2::EgressOnlyInternetGateway</a> is used to create an egress-only
                internet gateway to enable IPv6 communication for outbound traffic from instances
                within the VPC, while preventing inbound traffic. An <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-resource-ec2-route.html">AWS::EC2::Route</a> resource is specified to create an IPv6 route in the
                route table that directs all outbound IPv6 traffic (<code class="code">::/0</code>) to the
                egress-only internet gateway. </p>
            <p>For more information about egress-only internet gateways, see <a href="https://docs.aws.amazon.com/vpc/latest/userguide/egress-only-internet-gateway.html">Enable outbound
                    IPv6 traffic using an egress-only internet gateway</a>.</p>
            <div id="JSON" name="JSON" class="section langfilter">
                <h3 id="quickref-ec2-example-16.json">JSON</h3>
                <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="json ">"DefaultIpv6Route": <span>{</span>
    "Type": "AWS::EC2::Route",
    "Properties": <span>{</span>
        "DestinationIpv6CidrBlock": "::/0",
        "EgressOnlyInternetGatewayId": <span>{</span>
            "Ref": "EgressOnlyInternetGateway"
        },
        "RouteTableId": <span>{</span>
            "Ref": "RouteTable"
        }
    }
},
"EgressOnlyInternetGateway": <span>{</span>
    "Type": "AWS::EC2::EgressOnlyInternetGateway",
    "Properties": <span>{</span>
        "VpcId": <span>{</span>
            "Ref": "VPC"
        }
    }
},
"RouteTable": <span>{</span>
    "Type": "AWS::EC2::RouteTable",
    "Properties": <span>{</span>
        "VpcId": <span>{</span>
            "Ref": "VPC"
        }
    }
},
"VPC": <span>{</span>
    "Type": "AWS::EC2::VPC",
    "Properties": <span>{</span>
        "CidrBlock": "10.0.0.0/16"
    }
}</code></pre>
            </div>
            <div id="YAML" name="YAML" class="section langfilter">
                <h3 id="quickref-ec2-example-16.yaml">YAML</h3>
                <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="yaml ">DefaultIpv6Route:
  Type: "AWS::EC2::Route"
  Properties:
    DestinationIpv6CidrBlock: "::/0"
    EgressOnlyInternetGatewayId:
      Ref: "EgressOnlyInternetGateway"
    RouteTableId:
      Ref: "RouteTable"
EgressOnlyInternetGateway:
  Type: "AWS::EC2::EgressOnlyInternetGateway"
  Properties:
    VpcId:
      Ref: "VPC"
RouteTable:
  Type: "AWS::EC2::RouteTable"
  Properties:
    VpcId:
      Ref: "VPC"
VPC:
  Type: "AWS::EC2::VPC"
  Properties:
    CidrBlock: "10.0.0.0/16"</code></pre>
            </div>
         
  <h2 id="cfn-template-snippets-eni">Elastic network interface (ENI) template
      snippets</h2>

   
    <h3 id="cfn-template-snippets-eni-template">Create an Amazon EC2 instance with attached
        elastic network interfaces (ENIs)</h3>
    <p>The following example snippet creates an Amazon EC2 instance using an <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-properties-ec2-instance.html">AWS::EC2::Instance</a> resource in the specified Amazon VPC and subnet. It attaches two
      network interfaces (ENIs) with the instance, associates Elastic IP addresses to the instances
      through the attached ENIs, and configures the security group for SSH and HTTP access. User
      data is supplied to the instance as part of the launch configuration when the instance is
      created. The user data includes a script encoded in <code class="code">base64</code> format to ensure it is
      passed to the instance. When the instance is launched, the script runs automatically as part
      of the bootstrapping process. It installs <code class="code">ec2-net-utils</code>, configures the network
      interfaces, and starts the HTTP service. </p>
    <p>To determine the appropriate Amazon Machine Image (AMI) based on the selected Region, the
      snippet uses a <code class="code">Fn::FindInMap</code> function that looks up values in a
        <code class="code">RegionMap</code> mapping. This mapping must  be defined in the larger template. The
      two network interfaces are created using <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-resource-ec2-networkinterface.html">AWS::EC2::NetworkInterface </a>resources. Elastic IP addresses are specified using
        <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-properties-ec2-eip.html">AWS::EC2::EIP </a>
      resources allocated to the <code class="code">vpc</code> domain. These elastic IP addresses are associated
      with the network interfaces using  <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-resource-ec2-eipassociation.html">AWS::EC2::EIPAssociation</a> resources. </p>
    <p>The <code class="code">Outputs</code> section defines values or resources that you want to access after
      the stack is created. In this snippet, the defined output is  <code class="code">InstancePublicIp</code>,
      which represents the public IP address of the EC2 instance created by the stack. You can
      retrieve this output in the <b>Output</b> tab on the AWS CloudFormation console, or using the
        <a href="https://docs.aws.amazon.com/cli/latest/reference/cloudformation/describe-stacks.html"><code class="code">aws cloudformation describe-stacks</code></a>command. </p>
    <p>For more information about elastic network interfaces, see <a href="https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/using-eni.html">Elastic network interfaces</a>.</p>
    <div id="JSON" name="JSON" class="section langfilter">
      <h4 id="cfn-template-snippets-eni-example-1.json">JSON</h4>
      <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="json ">"Resources": <span>{</span>
    "ControlPortAddress": <span>{</span>
        "Type": "AWS::EC2::EIP",
        "Properties": <span>{</span>
            "Domain": "vpc"
        }
    },
    "AssociateControlPort": <span>{</span>
        "Type": "AWS::EC2::EIPAssociation",
        "Properties": <span>{</span>
            "AllocationId": <span>{</span>
                "Fn::GetAtt": [
                    "ControlPortAddress",
                    "AllocationId"
                ]
            },
            "NetworkInterfaceId": <span>{</span>
                "Ref": "controlXface"
            }
        }
    },
    "WebPortAddress": <span>{</span>
        "Type": "AWS::EC2::EIP",
        "Properties": <span>{</span>
            "Domain": "vpc"
        }
    },
    "AssociateWebPort": <span>{</span>
        "Type": "AWS::EC2::EIPAssociation",
        "Properties": <span>{</span>
            "AllocationId": <span>{</span>
                "Fn::GetAtt": [
                    "WebPortAddress",
                    "AllocationId"
                ]
            },
            "NetworkInterfaceId": <span>{</span>
                "Ref": "webXface"
            }
        }
    },
    "SSHSecurityGroup": <span>{</span>
        "Type": "AWS::EC2::SecurityGroup",
        "Properties": <span>{</span>
            "VpcId": <span>{</span>
                "Ref": "VpcId"
            },
            "GroupDescription": "Enable SSH access via port 22",
            "SecurityGroupIngress": [
                <span>{</span>
                    "CidrIp": "0.0.0.0/0",
                    "FromPort": 22,
                    "IpProtocol": "tcp",
                    "ToPort": 22
                }
            ]
        }
    },
    "WebSecurityGroup": <span>{</span>
        "Type": "AWS::EC2::SecurityGroup",
        "Properties": <span>{</span>
            "VpcId": <span>{</span>
                "Ref": "VpcId"
            },
            "GroupDescription": "Enable HTTP access via user-defined port",
            "SecurityGroupIngress": [
                <span>{</span>
                    "CidrIp": "0.0.0.0/0",
                    "FromPort": 80,
                    "IpProtocol": "tcp",
                    "ToPort": 80
                }
            ]
        }
    },
    "controlXface": <span>{</span>
        "Type": "AWS::EC2::NetworkInterface",
        "Properties": <span>{</span>
            "SubnetId": <span>{</span>
                "Ref": "SubnetId"
            },
            "Description": "Interface for controlling traffic such as SSH",
            "GroupSet": [
                <span>{</span>
                    "Fn::GetAtt": [
                        "SSHSecurityGroup",
                        "GroupId"
                    ]
                }
            ],
            "SourceDestCheck": true,
            "Tags": [
                <span>{</span>
                    "Key": "Network",
                    "Value": "Control"
                }
            ]
        }
    },
    "webXface": <span>{</span>
        "Type": "AWS::EC2::NetworkInterface",
        "Properties": <span>{</span>
            "SubnetId": <span>{</span>
                "Ref": "SubnetId"
            },
            "Description": "Interface for web traffic",
            "GroupSet": [
                <span>{</span>
                    "Fn::GetAtt": [
                        "WebSecurityGroup",
                        "GroupId"
                    ]
                }
            ],
            "SourceDestCheck": true,
            "Tags": [
                <span>{</span>
                    "Key": "Network",
                    "Value": "Web"
                }
            ]
        }
    },
    "Ec2Instance": <span>{</span>
        "Type": "AWS::EC2::Instance",
        "Properties": <span>{</span>
            "ImageId": <span>{</span>
                "Fn::FindInMap": [
                    "RegionMap",
                    <span>{</span>
                        "Ref": "AWS::Region"
                    },
                    "AMI"
                ]
            },
            "KeyName": <span>{</span>
                "Ref": "KeyName"
            },
            "NetworkInterfaces": [
                <span>{</span>
                    "NetworkInterfaceId": <span>{</span>
                        "Ref": "controlXface"
                    },
                    "DeviceIndex": "0"
                },
                <span>{</span>
                    "NetworkInterfaceId": <span>{</span>
                        "Ref": "webXface"
                    },
                    "DeviceIndex": "1"
                }
            ],
            "Tags": [
                <span>{</span>
                    "Key": "Role",
                    "Value": "Test Instance"
                }
            ],
            "UserData": <span>{</span>
                "Fn::Base64": <span>{</span>
                    "Fn::Sub": "#!/bin/bash -xe\nyum install ec2-net-utils -y\nec2ifup eth1\nservice httpd start\n"
                }
            }
        }
    }
},
"Outputs": <span>{</span>
    "InstancePublicIp": <span>{</span>
        "Description": "Public IP Address of the EC2 Instance",
        "Value": <span>{</span>
            "Fn::GetAtt": [
                "Ec2Instance",
                "PublicIp"
            ]
        }
    }
}</code></pre>
    </div>
    <div id="YAML" name="YAML" class="section langfilter">
      <h4 id="cfn-template-snippets-eni-example.yaml">YAML</h4>
      <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="yaml ">Resources:
  ControlPortAddress:
    Type: 'AWS::EC2::EIP'
    Properties:
      Domain: vpc
  AssociateControlPort:
    Type: 'AWS::EC2::EIPAssociation'
    Properties:
      AllocationId:
        Fn::GetAtt:
          - ControlPortAddress
          - AllocationId
      NetworkInterfaceId:
        Ref: controlXface
  WebPortAddress:
    Type: 'AWS::EC2::EIP'
    Properties:
      Domain: vpc
  AssociateWebPort:
    Type: 'AWS::EC2::EIPAssociation'
    Properties:
      AllocationId:
        Fn::GetAtt:
          - WebPortAddress
          - AllocationId
      NetworkInterfaceId:
        Ref: webXface
  SSHSecurityGroup:
    Type: 'AWS::EC2::SecurityGroup'
    Properties:
      VpcId:
        Ref: VpcId
      GroupDescription: Enable SSH access via port 22
      SecurityGroupIngress:
        - CidrIp: 0.0.0.0/0
          FromPort: 22
          IpProtocol: tcp
          ToPort: 22
  WebSecurityGroup:
    Type: 'AWS::EC2::SecurityGroup'
    Properties:
      VpcId:
        Ref: VpcId
      GroupDescription: Enable HTTP access via user-defined port
      SecurityGroupIngress:
        - CidrIp: 0.0.0.0/0
          FromPort: 80
          IpProtocol: tcp
          ToPort: 80
  controlXface:
    Type: 'AWS::EC2::NetworkInterface'
    Properties:
      SubnetId:
        Ref: SubnetId
      Description: Interface for controlling traffic such as SSH
      GroupSet:
        - Fn::GetAtt:
            - SSHSecurityGroup
            - GroupId
      SourceDestCheck: true
      Tags:
        - Key: Network
          Value: Control
  webXface:
    Type: 'AWS::EC2::NetworkInterface'
    Properties:
      SubnetId:
        Ref: SubnetId
      Description: Interface for web traffic
      GroupSet:
        - Fn::GetAtt:
            - WebSecurityGroup
            - GroupId
      SourceDestCheck: true
      Tags:
        - Key: Network
          Value: Web
  Ec2Instance:
    Type: AWS::EC2::Instance
    Properties:
      ImageId:
        Fn::FindInMap:
          - RegionMap
          - Ref: AWS::Region
          - AMI
      KeyName:
        Ref: KeyName
      NetworkInterfaces:
        - NetworkInterfaceId:
            Ref: controlXface
          DeviceIndex: "0"
        - NetworkInterfaceId:
            Ref: webXface
          DeviceIndex: "1"
      Tags:
        - Key: Role
          Value: Test Instance
      UserData:
        Fn::Base64: !Sub |
          #!/bin/bash -xe
          yum install ec2-net-utils -y
          ec2ifup eth1
          service httpd start
Outputs:
  InstancePublicIp:
    Description: Public IP Address of the EC2 Instance
    Value:
      Fn::GetAtt:
        - Ec2Instance
        - PublicIp</code></pre>
    </div>
   
<awsdocs-copyright class="copyright-print"></awsdocs-copyright><awsdocs-thumb-feedback right-edge="{{$ctrl.thumbFeedbackRightEdge}}"></awsdocs-thumb-feedback></div><noscript><div><div><div><div id="js_error_message"><p><img src="https://d1ge0kk1l5kms0.cloudfront.net/images/G/01/webservices/console/warning.png" alt="Warning" /> <strong>Javascript is disabled or is unavailable in your browser.</strong></p><p>To use the Amazon Web Services Documentation, Javascript must be enabled. Please refer to your browser's Help pages for instructions.</p></div></div></div></div></noscript><div id="main-col-footer" class="awsui-util-font-size-0"><div id="doc-conventions"><a target="_top" href="/general/latest/gr/docconventions.html">Document Conventions</a></div><div class="prev-next"><div id="previous" class="prev-link" accesskey="p" href="./quickref-ec2-elastic-ip.html">Allocate Elastic IPs</div><div id="next" class="next-link" accesskey="n" href="./quickref-ecs.html">Amazon ECS</div></div></div><awsdocs-page-utilities></awsdocs-page-utilities></div><div id="quick-feedback-yes" style="display: none;"><div class="title">Did this page help you? - Yes</div><div class="content"><p>Thanks for letting us know we're doing a good job!</p><p>If you've got a moment, please tell us what we did right so we can do more of it.</p><p><awsui-button id="fblink" rel="noopener noreferrer" target="_blank" text="Feedback" click="linkClick($event)" href="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=CloudFormation&amp;topic_url=https://docs.aws.amazon.com/en_us/AWSCloudFormation/latest/UserGuide/quickref-ec2-vpc.html"></awsui-button></p></div></div><div id="quick-feedback-no" style="display: none;"><div class="title">Did this page help you? - No</div><div class="content"><p>Thanks for letting us know this page needs work. We're sorry we let you down.</p><p>If you've got a moment, please tell us how we can make the documentation better.</p><p><awsui-button id="fblink" rel="noopener noreferrer" target="_blank" text="Feedback" click="linkClick($event)" href="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=CloudFormation&amp;topic_url=https://docs.aws.amazon.com/en_us/AWSCloudFormation/latest/UserGuide/quickref-ec2-vpc.html"></awsui-button></p></div></div></div></body></div></awsdocs-view><div class="page-loading-indicator" id="page-loading-indicator"><awsui-spinner size="large"></awsui-spinner></div></div><div id="tools-panel" dom-region="tools"><awsdocs-tools-panel id="awsdocs-tools-panel"></awsdocs-tools-panel></div></awsui-app-layout><awsdocs-cookie-banner class="doc-cookie-banner"></awsdocs-cookie-banner></div></body></html>