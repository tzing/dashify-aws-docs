<!DOCTYPE html>
    <html xmlns="http://www.w3.org/1999/xhtml" lang="en-US"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Create a stack set - AWS CloudFormation</title><meta name="viewport" content="width=device-width,initial-scale=1" /><meta name="assets_root" content="/assets" /><meta name="target_state" content="stacksets-getting-started-create" /><meta name="default_state" content="stacksets-getting-started-create" /><link rel="icon" type="image/ico" href="/assets/images/favicon.ico" /><link rel="shortcut icon" type="image/ico" href="/assets/images/favicon.ico" /><link rel="canonical" href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/stacksets-getting-started-create.html" /><meta name="description" content="You can create a stack set using the AWS Management Console or using AWS CloudFormation commands in the AWS CLI. You can create a stack set with either self-managed or service-managed permissions." /><meta name="deployment_region" content="IAD" /><meta name="product" content="AWS CloudFormation" /><meta name="guide" content="User Guide" /><meta name="abstract" content="Create and manage AWS infrastructure deployments predictably and repeatedly using AWS CloudFormation with this User Guide." /><meta name="guide-locale" content="en_us" /><meta name="tocs" content="toc-contents.json" /><link rel="canonical" href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/stacksets-getting-started-create.html" /><link rel="alternative" href="https://docs.aws.amazon.com/id_id/AWSCloudFormation/latest/UserGuide/stacksets-getting-started-create.html" hreflang="id-id" /><link rel="alternative" href="https://docs.aws.amazon.com/id_id/AWSCloudFormation/latest/UserGuide/stacksets-getting-started-create.html" hreflang="id" /><link rel="alternative" href="https://docs.aws.amazon.com/de_de/AWSCloudFormation/latest/UserGuide/stacksets-getting-started-create.html" hreflang="de-de" /><link rel="alternative" href="https://docs.aws.amazon.com/de_de/AWSCloudFormation/latest/UserGuide/stacksets-getting-started-create.html" hreflang="de" /><link rel="alternative" href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/stacksets-getting-started-create.html" hreflang="en-us" /><link rel="alternative" href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/stacksets-getting-started-create.html" hreflang="en" /><link rel="alternative" href="https://docs.aws.amazon.com/es_es/AWSCloudFormation/latest/UserGuide/stacksets-getting-started-create.html" hreflang="es-es" /><link rel="alternative" href="https://docs.aws.amazon.com/es_es/AWSCloudFormation/latest/UserGuide/stacksets-getting-started-create.html" hreflang="es" /><link rel="alternative" href="https://docs.aws.amazon.com/fr_fr/AWSCloudFormation/latest/UserGuide/stacksets-getting-started-create.html" hreflang="fr-fr" /><link rel="alternative" href="https://docs.aws.amazon.com/fr_fr/AWSCloudFormation/latest/UserGuide/stacksets-getting-started-create.html" hreflang="fr" /><link rel="alternative" href="https://docs.aws.amazon.com/it_it/AWSCloudFormation/latest/UserGuide/stacksets-getting-started-create.html" hreflang="it-it" /><link rel="alternative" href="https://docs.aws.amazon.com/it_it/AWSCloudFormation/latest/UserGuide/stacksets-getting-started-create.html" hreflang="it" /><link rel="alternative" href="https://docs.aws.amazon.com/ja_jp/AWSCloudFormation/latest/UserGuide/stacksets-getting-started-create.html" hreflang="ja-jp" /><link rel="alternative" href="https://docs.aws.amazon.com/ja_jp/AWSCloudFormation/latest/UserGuide/stacksets-getting-started-create.html" hreflang="ja" /><link rel="alternative" href="https://docs.aws.amazon.com/ko_kr/AWSCloudFormation/latest/UserGuide/stacksets-getting-started-create.html" hreflang="ko-kr" /><link rel="alternative" href="https://docs.aws.amazon.com/ko_kr/AWSCloudFormation/latest/UserGuide/stacksets-getting-started-create.html" hreflang="ko" /><link rel="alternative" href="https://docs.aws.amazon.com/pt_br/AWSCloudFormation/latest/UserGuide/stacksets-getting-started-create.html" hreflang="pt-br" /><link rel="alternative" href="https://docs.aws.amazon.com/pt_br/AWSCloudFormation/latest/UserGuide/stacksets-getting-started-create.html" hreflang="pt" /><link rel="alternative" href="https://docs.aws.amazon.com/zh_cn/AWSCloudFormation/latest/UserGuide/stacksets-getting-started-create.html" hreflang="zh-cn" /><link rel="alternative" href="https://docs.aws.amazon.com/zh_tw/AWSCloudFormation/latest/UserGuide/stacksets-getting-started-create.html" hreflang="zh-tw" /><link rel="alternative" href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/stacksets-getting-started-create.html" hreflang="x-default" /><meta name="feedback-item" content="CloudFormation" /><meta name="this_doc_product" content="AWS CloudFormation" /><meta name="this_doc_guide" content="User Guide" /><script defer="" src="/assets/r/vendor4.js?version=2021.12.02"></script><script defer="" src="/assets/r/vendor3.js?version=2021.12.02"></script><script defer="" src="/assets/r/vendor1.js?version=2021.12.02"></script><script defer="" src="/assets/r/awsdocs-common.js?version=2021.12.02"></script><script defer="" src="/assets/r/awsdocs-doc-page.js?version=2021.12.02"></script><link href="/assets/r/vendor4.css?version=2021.12.02" rel="stylesheet" /><link href="/assets/r/awsdocs-common.css?version=2021.12.02" rel="stylesheet" /><link href="/assets/r/awsdocs-doc-page.css?version=2021.12.02" rel="stylesheet" /><script async="" id="awsc-panorama-bundle" type="text/javascript" src="https://prod.pa.cdn.uis.awsstatic.com/panorama-nav-init.js" data-config="{'appEntity':'aws-documentation','region':'us-east-1','service':'cloudformation'}"></script><meta id="panorama-serviceSubSection" value="User Guide" /><meta id="panorama-serviceConsolePage" value="Create a stack set" /></head><body class="awsdocs awsui"><div class="awsdocs-container"><awsdocs-header></awsdocs-header><awsui-app-layout id="app-layout" class="awsui-util-no-gutters" ng-controller="ContentController as $ctrl" header-selector="awsdocs-header" navigation-hide="false" navigation-width="$ctrl.navWidth" navigation-open="$ctrl.navOpen" navigation-change="$ctrl.onNavChange($event)" tools-hide="$ctrl.hideTools" tools-width="$ctrl.toolsWidth" tools-open="$ctrl.toolsOpen" tools-change="$ctrl.onToolsChange($event)"><div id="guide-toc" dom-region="navigation"><awsdocs-toc></awsdocs-toc></div><div id="main-column" dom-region="content" tabindex="-1"><awsdocs-view class="awsdocs-view"><div id="awsdocs-content"><head><title>Create a stack set - AWS CloudFormation</title><meta name="rss" content="aws-cloudformation-release-notes.rss" /><meta name="forums" content="http://forums.aws.amazon.com/forum.jspa?forumID=92" /><meta name="feedback" content="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=CloudFormation&amp;topic_url=https://docs.aws.amazon.com/en_us/AWSCloudFormation/latest/UserGuide/stacksets-getting-started-create.html" /><meta name="feedback-yes" content="feedbackyes.html?topic_url=https://docs.aws.amazon.com/en_us/AWSCloudFormation/latest/UserGuide/stacksets-getting-started-create.html" /><meta name="feedback-no" content="feedbackno.html?topic_url=https://docs.aws.amazon.com/en_us/AWSCloudFormation/latest/UserGuide/stacksets-getting-started-create.html" /><meta name="keywords" content="CloudFormation,AWSCloudFormation,resource provisioning,resource configuration,infrastructure management,CloudFormer,CloudFormation stack,CloudFormation stackset,CloudFormation template,change set" /><script type="application/ld+json">
{
    "@context" : "https://schema.org",
    "@type" : "BreadcrumbList",
    "itemListElement" : [
      {
        "@type" : "ListItem",
        "position" : 1,
        "name" : "AWS",
        "item" : "https://aws.amazon.com"
      },
      {
        "@type" : "ListItem",
        "position" : 2,
        "name" : "AWS CloudFormation",
        "item" : "https://docs.aws.amazon.com/cloudformation/index.html"
      },
      {
        "@type" : "ListItem",
        "position" : 3,
        "name" : "User Guide",
        "item" : "https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide"
      },
      {
        "@type" : "ListItem",
        "position" : 4,
        "name" : "Working with AWS CloudFormation StackSets",
        "item" : "https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/what-is-cfnstacksets.html"
      },
      {
        "@type" : "ListItem",
        "position" : 5,
        "name" : "Getting started with AWS CloudFormation StackSets",
        "item" : "https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/stacksets-getting-started.html"
      },
      {
        "@type" : "ListItem",
        "position" : 6,
        "name" : "Create a stack set",
        "item" : "https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/stacksets-getting-started.html"
      }
    ]
}
</script></head><body><div id="main"><div style="display: none"></div><div id="breadcrumbs" class="breadcrumb"><a href="https://aws.amazon.com">AWS</a><a href="/index.html">Documentation</a><a href="/cloudformation/index.html">AWS CloudFormation</a><a href="Welcome.html">User Guide</a></div><div id="page-toc-src"><a href="#stacksets-getting-started-create-self-managed">Create a
                    stack set with self-managed permissions</a><a href="#stacksets-orgs-associate-stackset-with-org">Create a
                    stack set with service-managed permissions</a></div><div id="main-content" class="awsui-util-container"><div id="main-col-body"><awsdocs-language-banner data-service="$ctrl.pageService"></awsdocs-language-banner><h1 class="topictitle" id="stacksets-getting-started-create">Create a stack set</h1><div class="awsdocs-page-header-container"><awsdocs-page-header></awsdocs-page-header><awsdocs-filter-selector id="awsdocs-filter-selector"></awsdocs-filter-selector></div><p>You can create a stack set using the AWS Management Console or using AWS CloudFormation commands in the
            AWS CLI. You can create a stack set with either <code class="code">self-managed</code> or
                <code class="code">service-managed</code> permissions.</p><p>With <code class="code">self-managed</code> permissions, you can deploy stack instances to specific
                AWS accounts in specific Regions. To do this, you must first create
            the necessary IAM roles to establish a trusted relationship between the account you're
            administering the stack set from and the account you're deploying stack instances
            to.</p><p>With <code class="code">service-managed</code> permissions, you can deploy stack instances to
            accounts managed by AWS Organizations in specific Regions. With this model, you don't need to
            create the necessary IAM roles; StackSets creates the IAM roles on your behalf.
            You can also enable automatic deployments to accounts that are added to a target
            organization or organizational unit (OU) in the future. With automatic deployments
            enabled, StackSets automatically deletes stack instances from an account if it's
            removed from a target organization or OU.</p><div class="highlights" id="inline-topiclist"><h6>Topics</h6><ul><li><a href="#stacksets-getting-started-create-self-managed">Create a stack set
                    with self-managed permissions</a></li><li><a href="#stacksets-orgs-associate-stackset-with-org">Create a stack set with
                    service-managed permissions</a></li></ul></div>
            <h2 id="stacksets-getting-started-create-self-managed">Create a stack set
                    with self-managed permissions</h2>

            <div class="highlights" id="inline-topiclist"><h6>Topics</h6><ul><li><a href="#stacksets-getting-started-create-self-managed-console">Create a
                        stack set with self-managed permissions using the AWS Management Console</a></li><li><a href="#stacksets-getting-started-self-managed-cli">Create a stack set
                        with self-managed permissions using the AWS CLI</a></li></ul></div>

             
                <h3 id="stacksets-getting-started-create-self-managed-console">Create a
                        stack set with self-managed permissions using the AWS Management Console</h3>

                <div class="procedure"><ol><li><p>Open the AWS CloudFormation console at
         <a href="https://console.aws.amazon.com/cloudformation/" rel="noopener noreferrer" target="_blank"><span>https://console.aws.amazon.com/cloudformation</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a>.</p></li><li>
                        <p>From the navigation pane, choose
                            <b>StackSets</b>.</p>
                    </li><li>
                        <p>At the top of the <b>StackSets</b> page, choose
                                <b>Create StackSet</b>.</p>
                    </li><li>
                        <p>Under <b>Prerequisite - Prepare template</b>, choose
                                <b>Use a sample template</b>.</p>
                    </li><li>
                        <p>Under <b>Select a sample template</b>, from the
                            drop-down menu choose the <b>Enable AWS config</b>
                            template. Select <b>Next</b>.</p>
                        <div class="mediaobject">
                             
                                <img src="/images/AWSCloudFormation/latest/UserGuide/images/console-create-stackset-choose-template.png" class="aws-docs-img-whiteBg aws-docs-img-padding" alt="&#xA;                                StackSets sample Enable AWS Config template&#xA;                            " style="max-width:100%" />
                             
                             
                        </div>
                    </li><li>
                        <p>On the <b>Specify StackSet details</b> page, provide the
                            following information.</p>
                        <ol><li>
                                <p>Provide a name for the stack set. Stack set names must begin
                                    with an alphabetical character, and contain only letters,
                                    numbers, and hyphens. In this walkthrough, we use the name
                                        <code class="userinput">my-awsconfig-stackset</code>.</p>
                            </li><li>
                                <p>You are prompted to specify values for parameters that are
                                    used by AWS Config. For more information about these parameters, see
                                        <a href="http://docs.aws.amazon.com/config/latest/developerguide/gs-console.html">Setting up AWS Config with the console</a> in the
                                        <em>AWS Config Developer Guide</em>. In this
                                    walkthrough, we will leave default settings for all AWS Config
                                    parameters.</p>
                            </li><li>
                                <p>You can configure Amazon Simple Notification Service (SNS) updates by email, based on
                                    log content, using the <b>TopicARN</b> and
                                        <b>NotificationEmail</b> parameters. For the
                                    purposes of this walkthrough, we are not configuring Amazon SNS
                                    updates.</p>
                            </li><li>
                                <p>You can configure the delivery channel for updates and
                                    notifications using the <b>DeliveryChannelName</b>
                                    and <b>Frequency</b> parameters. For more
                                    information about the delivery channel in AWS Config, see <a href="https://docs.aws.amazon.com/config/latest/developerguide/manage-delivery-channel.html">Managing the delivery channel</a> in the <em>AWS Config
                                        Developer Guide</em>. For the purposes of this
                                    walkthrough, we are leaving default settings in this
                                    area.</p>
                            </li></ol>
                    </li><li>
                        <p>When you are finished specifying parameters for AWS Config, choose
                                <b>Next</b>.</p>
                    </li><li>
                        <p>On the <b>Configure StackSet options</b> page, add a tag
                            by specifying a key and value pair. In this walkthrough, we create a tag
                            called <b>Stage</b>, with a value of
                                <b>Test</b>. Tags that you apply to stack sets are
                            applied to all resources that are created by your stacks. For more
                            information about how tags are used in AWS, see <a href="http://docs.aws.amazon.com/awsaccountbilling/latest/aboutv2/cost-alloc-tags.html">Using cost allocation tags</a> in the <em>AWS Billing and Cost Management User
                                Guide</em>.</p>
                        <p>Leave <b>Permissions</b> unspecified.</p>
                    </li><li>
                        <p>For <b>Execution configuration</b>, choose
                                <b>Active</b> so that StackSets performs
                            non-conflicting operations concurrently and queues conflicting
                            operations. After conflicting operations finish, StackSets starts queued
                            operations in request order.</p>
                        <div class="awsdocs-note"><div class="awsdocs-note-title"><awsui-icon name="status-info" variant="link"></awsui-icon><h6>Note</h6></div><div class="awsdocs-note-text"><p>If there are already running or queued operations, StackSets
                                queues all incoming operations even if they are
                                non-conflicting.</p><p>You can't modify your stack set's execution configuration while
                                there are running or queued operations for that stack set.</p></div></div>
                    </li><li>
                        <p>Choose <b>Next</b>.</p>
                    </li><li>
                        <p>On the <b>Set deployment options</b> page, provide the
                            accounts and Regions into which you want stacks in your stack set
                            deployed.</p>
                        <p>AWS CloudFormation will deploy stacks in the specified accounts within the first
                            Region, then moves on to the next, and so on, as long as a Region's
                            deployment failures do not exceed a specified failure tolerance.</p>
                        <ol><li>
                                <p>For <b>Accounts</b>, choose <b>Deploy
                                        stacks in accounts</b>. Paste your target account
                                    numbers in the text box, separating multiple numbers with
                                    commas.</p>
                            </li><li>
                                <p>For <b>Specify regions</b>, choose
                                    US East (N. Virginia) Region. Repeat for the US West (Oregon) Region. Select the up
                                    arrow next to US West (Oregon) Region to move it to be the first entry in
                                    the list. The order of the Regions under <b>Specify
                                        regions</b> determines their deployment order.</p>
                            </li><li>
                                <p>For <b>Deployment options</b>:</p>
                                <div class="itemizedlist">
                                     
                                     
                                <ul class="itemizedlist"><li class="listitem">
                                        <p>For <b>Maximum concurrent accounts</b>,
                                            keep the defaults of <b>Number</b> and
                                                <b>1</b>.</p>
                                        <p>This means that AWS CloudFormation deploys your stack in only one
                                            account at one time.</p>
                                    </li><li class="listitem">
                                        <p>For <b>Failure tolerance</b>, keep the
                                            defaults of <b>Number</b> and
                                                <b>0</b>.</p>
                                        <p>This means that a maximum of one stack deployment can
                                            fail in one of your specified Regions before AWS CloudFormation stops
                                            deployment in the current Region, and cancels deployment
                                            in remaining Regions.</p>
                                    </li></ul></div>
                            </li><li>
                                <div class="itemizedlist">
                                    <p>For <b>Region concurrency</b>:</p>
                                     
                                <ul class="itemizedlist"><li class="listitem">
                                        <p>Select <b>Sequential</b> or
                                                <b>Parallel</b> to determine
                                            StackSets deployment order for specified Regions. By
                                            default, <b>Sequential</b> is
                                            selected.</p>

                                    </li></ul></div>
                                <p>Select <b>Next</b>.</p>
                            </li></ol>
                        <div class="mediaobject">
                             
                                <img src="/images/AWSCloudFormation/latest/UserGuide/images/console-create-stackset-set-deploy-options.png" class="aws-docs-img-whiteBg aws-docs-img-padding" alt="&#xA;                                Set Deployment Options page&#xA;                            " style="max-width:100%" />
                             
                             
                        </div>
                    </li><li>
                        <p>On the <b>Review</b> page, review your choices and your
                            stack set's properties. To make changes, choose
                                <b>Edit</b> in the area in which you want to change
                            properties. Before you can create the stack set, you must fill the check
                            box in the <b>Capabilities</b> area to acknowledge that
                            some of the resources that you are creating with the stack set might
                            require new IAM resources and permissions. For more information about
                            potentially required permissions, see <a href="http://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/using-iam-template.html#using-iam-capabilities">Acknowledging IAM resources in AWS CloudFormation
                                templates</a> in this guide. When you are ready to create your
                            stack set, choose <b>Submit</b>.</p>
                        <div class="mediaobject">
                             
                                <img src="/images/AWSCloudFormation/latest/UserGuide/images/console-create-stackset-review-capabilities.png" class="aws-docs-img-whiteBg aws-docs-img-padding" alt="&#xA;                                Acknowledge required capabilities&#xA;                            " style="max-width:100%" />
                             
                             
                        </div>
                    </li><li>
                        <p>AWS CloudFormation starts creating your stack set. View the progress and status of
                            the creation of the stacks in your stack set in the stack set details
                            page that opens when you choose <b>Submit</b>.</p>
                        <div class="mediaobject">
                             
                                <img src="/images/AWSCloudFormation/latest/UserGuide/images/console-stackset-detail-operations.png" class="aws-docs-img-whiteBg aws-docs-img-padding" alt="&#xA;                                Operations tab of the StackSets details page&#xA;                            " style="max-width:100%" />
                             
                             
                        </div>
                    </li></ol></div>
             
             
                <h3 id="stacksets-getting-started-self-managed-cli">Create a stack set
                        with self-managed permissions using the AWS CLI</h3>
                <div class="procedure"><p>When you create stack sets by using AWS CLI commands, you run two separate
                        commands: <code class="code">create-stack-set</code> to upload your template and create
                        the stack set container, and <code class="code">create-stack-instances</code> to create
                        the stacks within your stack set. Start by running an AWS CLI command,
                            <code class="code">create-stack-set</code>, to upload the sample AWS CloudFormation template that
                        enables AWS Config, and then start stack set creation.</p><ol><li>
                        <p>Open the AWS CLI.</p>
                    </li><li>
                        <p>Run the following command.</p>
                        <p>For the <code class="code">--template-url</code> parameter, provide the URL of the
                            Amazon S3 bucket in which you are storing your template. For this
                            walkthrough, we use <code class="code">my-awsconfig-stackset</code> as the value of
                            the <code class="code">--stack-set-name</code> parameter. We also activate
                                <code class="code">--managed-execution</code> so that StackSets performs
                            non-conflicting operations concurrently and queues conflicting
                            operations. After conflicting operations finish, StackSets starts queued
                            operations in request order.</p>
                        <div class="awsdocs-note"><div class="awsdocs-note-title"><awsui-icon name="status-info" variant="link"></awsui-icon><h6>Note</h6></div><div class="awsdocs-note-text"><p>If there are already running or queued operations, StackSets
                                queues all incoming operations even if they are
                                non-conflicting.</p><p>You can't modify your stack set's execution configuration while
                                there are running or queued operations for that stack set.</p></div></div>
                        <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="sh ">aws cloudformation create-stack-set \
  --stack-set-name my-awsconfig-stackset \
  --template-url https://s3.amazonaws.com/cloudformation-stackset-sample-templates-us-east-1/EnableAWSConfig.yml</code></pre>
                    </li><li>
                        <p>After your <code class="code">create-stack-set</code> command is finished, run the
                                <code class="code">list-stack-sets</code> command to see that your stack set has
                            been created. You should see your new stack set in the results.</p>
                        <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="sh ">aws cloudformation list-stack-sets</code></pre>
                    </li><li>
                        <p>Run the <code class="code">create-stack-instances</code> AWS CLI command to add stack
                            instances to your stack set. In this walkthrough, we use
                                <code class="code">us-west-2</code> and <code class="code">us-east-1</code> as the values of
                            the <code class="code">--regions</code> parameter.</p>
                        <p>Set the failure tolerance and maximum concurrent accounts by setting
                                <code class="code">FailureToleranceCount</code> to <code class="code">0</code> and
                                <code class="code">MaxConcurrentCount</code> to <code class="code">1</code> in the
                                <code class="code">--operation-preferences</code> parameter, as shown in the
                            following example. To apply percentages instead, use
                                <code class="code">FailureTolerancePercentage</code> or
                                <code class="code">MaxConcurrentPercentage</code>. For the purposes of this
                            walkthrough, we are using count, not percentage.</p>
                        <div class="awsdocs-note"><div class="awsdocs-note-title"><awsui-icon name="status-info" variant="link"></awsui-icon><h6>Note</h6></div><div class="awsdocs-note-text"><p>The value of <code class="code">MaxConcurrentCount</code> is dependent on the
                                value of <code class="code">FailureToleranceCount</code>.
                                    <code class="code">MaxConcurrentCount</code> is at most one more than
                                    <code class="code">FailureToleranceCount</code>.</p></div></div>
                        <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="sh ">aws cloudformation create-stack-instances \
  --stack-set-name my-awsconfig-stackset \
  --accounts '["<code class="replaceable">account_ID_1</code>","<code class="replaceable">account_ID_2</code>"]' \
  --regions '["<code class="replaceable">region_1</code>","<code class="replaceable">region_2</code>"]' \
  --operation-preferences FailureToleranceCount=0,MaxConcurrentCount=1</code></pre>
                        <div class="awsdocs-note"><div class="awsdocs-note-title"><awsui-icon name="status-info" variant="link"></awsui-icon><h6>Note</h6></div><div class="awsdocs-note-text"><p>The concurrency of the StackSet instance deployments in the
                                operation is dependent on the value of
                                    <code class="code">FailureToleranceCount-MaxConcurrentCount</code> and is at
                                most one more than the <code class="code">FailureToleranceCount</code>.</p></div></div>
                        <div class="awsdocs-note awsdocs-important"><div class="awsdocs-note-title"><awsui-icon name="status-warning" variant="error"></awsui-icon><h6>Important</h6></div><div class="awsdocs-note-text"><p>Wait until an operation is complete before starting another one.
                                You can run only one operation at a time.</p></div></div>
                    </li><li>
                        <p>Verify that the stack instances were created successfully. Run
                                    <code class="code"><a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/APIReference/API_DescribeStackSetOperation.html">DescribeStackSetOperation</a></code> with the
                                <code class="code">operation-id</code> that is returned as part of the output of
                            step 4.</p>
                        <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="sh ">aws cloudformation describe-stack-set-operation \
  --stack-set-name my-awsconfig-stackset \
  --operation-id <code class="replaceable">operation_ID</code></code></pre>
                    </li></ol></div>
             
         
            <h2 id="stacksets-orgs-associate-stackset-with-org">Create a stack set with
                    service-managed permissions</h2>

            <div class="highlights" id="inline-topiclist"><h6>Topics</h6><ul><li><a href="#stacksets-orgs-considerations">Considerations when creating a
                        stack set with service-managed permissions</a></li><li><a href="#stacksets-orgs-associate-stackset-with-org-console">Create a
                        stack set with service-managed permissions using the AWS CloudFormation console</a></li><li><a href="#stacksets-orgs-associate-stackset-with-org-cli">Create a stack
                        set with service-managed permissions using the AWS CLI</a></li></ul></div>

             
                <h3 id="stacksets-orgs-considerations">Considerations when creating a
                        stack set with service-managed permissions</h3>

                <p>Before you create a stack set with service-managed permissions, consider the
                    following:</p>

                <div class="itemizedlist">
                     
                     
                     
                     
                     
                     
                     
                     
                     
                     
                <ul class="itemizedlist"><li class="listitem">
                        <p>Stack sets with service-managed permissions are created in the
                            management account, including stack sets that are created by delegated
                            administrators.</p>
                    </li><li class="listitem">
                        <p>Your stack set can target your entire organization or specified
                            organizational units (OUs). If your stack set targets your organization,
                            it also targets all accounts in all OUs in the organization. If your
                            stack set targets specified OUs, it also targets all accounts in those
                            OUs.</p>
                    </li><li class="listitem">
                        <p>If your stack set targets a parent OU, the stack set also targets any
                            child OUs.</p>
                    </li><li class="listitem">
                        <p>Multiple stack sets can target the same organization or OU.</p>
                    </li><li class="listitem">
                        <p>Your stack set can't target accounts outside your organization.</p>
                    </li><li class="listitem">
                        <p>Your stack set can't deploy nested stacks.</p>
                    </li><li class="listitem">
                        <p>StackSets doesn't deploy stack instances to the organization's
                            management account, even if the management account is in your organization
                            or in an OU in your organization.</p>
                    </li><li class="listitem">
                        <p>Automatic deployment is set at the stack set level. You can't adjust
                            automatic deployments selectively for OUs, accounts, or Regions.</p>
                    </li><li class="listitem">
                        <p>The permissions of the IAM principal entity (user, role, or group)
                            that you use to sign in to the management account determine whether you
                            are authorized to deploy with StackSets. For an example IAM policy
                            that grants permissions to deploy to an organization, see <a href="./using-iam-template.html#resource-level-permissions-service-managed-stack-set">Sample policy that grants service-managed stack set permissions</a>.</p>
                    </li><li class="listitem">
                        <p>Delegated administrators have full permissions to deploy to accounts
                            in your organization. The management account can't limit delegated
                            administrator permissions to deploy to specific OUs or to perform
                            specific stack set operations.</p>
                    </li></ul></div>
             

             
                <h3 id="stacksets-orgs-associate-stackset-with-org-console">Create a
                        stack set with service-managed permissions using the AWS CloudFormation console</h3>

                <div class="procedure"><ol><li>
                        <p>Open the AWS CloudFormation console at <a href="https://console.aws.amazon.com/cloudformation" rel="noopener noreferrer" target="_blank"><span>https://console.aws.amazon.com/cloudformation</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a>.</p>
                    </li><li>
                        <p>From the navigation pane, choose <b>StackSets</b>.</p>
                    </li><li>
                        <p>At the top of the <b>StackSets</b> page, choose
                                <b>Create StackSet</b>.</p>
                    </li><li>
                        <p>Under <b>Prepare template</b>, choose <b>Template
                                is ready</b>.</p>
                    </li><li>
                        <p>Under <b>Specify template</b>, choose to either specify
                            the URL for the S3 bucket that contains your stack template or upload a
                            stack template file. Choose <b>Next</b>.</p>
                    </li><li>
                        <p>On the <b>Specify StackSet details</b> page, provide a
                            name for the stack set, specify any parameters, and then choose
                                <b>Next</b>.</p>
                    </li><li>
                        <p>On the <b>Configure StackSet options</b> page, under
                                <b>Tags</b>, specify any tags to apply to resources in
                            your stack.</p>
                    </li><li>
                        <p>Under <b>Permissions</b>, choose
                                <b>Service-managed permissions</b>.</p>
                        <p>If trusted access with AWS Organizations is disabled, a banner displays.
                            Trusted access is required to create or update a stack set with
                            service-managed permissions. Only the administrator in the
                            organization's management account has permissions to <a href="./stacksets-orgs-activate-trusted-access.html">Activate trusted access with
                AWS Organizations</a>.</p>
                        <div class="mediaobject">
                             
                                <img src="/images/AWSCloudFormation/latest/UserGuide/images/console-stackset-service-managed-permissions.png" class="aws-docs-img-whiteBg aws-docs-img-padding" alt="&#xA;                                Activate trusted access banner.&#xA;                            " style="max-width:100%" />
                             
                             
                        </div>
                    </li><li>
                        <p>For <b>Execution configuration</b>, choose
                                <b>Active</b> so that StackSets performs
                            non-conflicting operations concurrently and queues conflicting
                            operations. After conflicting operations finish, StackSets starts queued
                            operations in request order.</p>
                        <div class="awsdocs-note"><div class="awsdocs-note-title"><awsui-icon name="status-info" variant="link"></awsui-icon><h6>Note</h6></div><div class="awsdocs-note-text"><p>If there are already running or queued operations, StackSets
                                queues all incoming operations even if they are
                                non-conflicting.</p><p>You can't modify your stack set's execution configuration while
                                there are running or queued operations for that stack set.</p></div></div>
                    </li><li>
                        <p>Choose <b>Next</b> to proceed and to activate trusted
                            access if not already activated.</p>

                    </li><li>
                        <p>On the <b>Set deployment options</b> page, under
                                <b>Deployment targets</b>, choose the accounts in your
                            organization to deploy to.</p>
                        <div class="itemizedlist">
                             
                             
                        <ul class="itemizedlist"><li class="listitem">
                                <p>Choose <b>Deploy to organization</b> to deploy
                                    to all accounts in your organization.</p>
                                <div class="mediaobject">
                                     
                                        <img src="/images/AWSCloudFormation/latest/UserGuide/images/console-stackset-deploy-to-org.png" class="aws-docs-img-whiteBg aws-docs-img-padding" alt="&#xA;                                        Deploy stack instances to all accounts in your&#xA;                                            organization.&#xA;                                    " style="max-width:100%" />
                                     
                                     
                                </div>
                            </li><li class="listitem">
                                <p>Choose <b>Deploy to organizational units
                                        (OUs)</b> to deploy to all accounts in specific OUs.
                                    Choose <b>Add an OU</b>, and then paste the target
                                    OU ID in the text box. Repeat for each new target OU.</p>
                                <div class="mediaobject">
                                     
                                        <img src="/images/AWSCloudFormation/latest/UserGuide/images/console-stackset-deploy-to-organizational-units.png" class="aws-docs-img-whiteBg aws-docs-img-padding" alt="&#xA;                                        Deploy stack instances to all accounts in select OUs&#xA;                                            within your organization.&#xA;                                    " style="max-width:100%" />
                                     
                                     
                                </div>
                            </li></ul></div>
                    </li><li>
                        <p>Under <b>Automatic deployment</b>, choose whether
                            StackSets will automatically deploy to accounts that are added to the
                            target organization or OUs in the future.</p>
                        <div class="mediaobject">
                             
                                <img src="/images/AWSCloudFormation/latest/UserGuide/images/console-stackset-auto-deploy.png" class="aws-docs-img-whiteBg aws-docs-img-padding" alt="&#xA;                                Automatic deployment settings for stack sets with&#xA;                                    service-managed permissions.&#xA;                            " style="max-width:100%" />
                             
                             
                        </div>
                    </li><li>
                        <p>If you enabled automatic deployment, under <b>Account removal
                                behavior</b>, choose whether stack resources are retained or
                            deleted when an account is removed from a target organization or
                            OU.</p>
                        <div class="mediaobject">
                             
                                <img src="/images/AWSCloudFormation/latest/UserGuide/images/console-stackset-account-removal-retain.png" class="aws-docs-img-whiteBg aws-docs-img-padding" alt="&#xA;                                Account removal behavior settings for stack sets with&#xA;                                    service-managed permissions.&#xA;                            " style="max-width:100%" />
                             
                             
                        </div>
                        <div class="awsdocs-note"><div class="awsdocs-note-title"><awsui-icon name="status-info" variant="link"></awsui-icon><h6>Note</h6></div><div class="awsdocs-note-text"><p>With <b>Retain stacks</b> selected, stack instances
                                are removed from your stack set, but the stacks and their associated
                                resources are retained. The resources stay in their current state,
                                but will no longer be part of the stack set.</p></div></div>
                    </li><li>
                        <p>Under <b>Deployment regions</b>, choose the Regions in
                            which you want to deploy stack instances. Choose
                                <b>Next</b>.</p>
                    </li><li>
                        <p>On the <b>Review</b> page, verify that StackSets
                            will deploy to the correct accounts in the correct Regions, and then
                            choose <b>Create StackSet</b>.</p>
                    </li></ol></div>

                <p>The <b>StackSet details</b> page opens. You can view the
                    progress and status of the creation of the stacks in your stack set.</p>

             
             
                <h3 id="stacksets-orgs-associate-stackset-with-org-cli">Create a stack
                        set with service-managed permissions using the AWS CLI</h3>

                <p>When you create stack sets using the AWS CLI, you run two separate commands.
                    During <code class="code">create-stack-set</code>, you upload your template, create the stack
                    set container, and manage automatic deployments. During
                        <code class="code">create-stack-instances</code>, you create stack instances in specific
                    target accounts.</p>

                <p>When acting as a delegated administrator, you must set the
                        <code class="code">--call-as</code> parameter to <code class="code">DELEGATED_ADMIN</code> each time
                    you run a StackSets command.</p>
                <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="text ">--call-as <code class="replaceable">DELEGATED_ADMIN</code></code></pre>
                <p>Stack sets created by a delegated administrator are created in the
                    organization's management account.</p>

                <div class="procedure"><ol><li>
                        <p>Open the AWS CLI.</p>
                    </li><li>
                        <p>Run the <code class="code">create-stack-set</code> command.</p>
                        <p>In the following example, we enable automatic deployments to allow
                            StackSets to automatically deploy to accounts that are added to the
                            target organization or OUs in the future. We retain stack resources when
                            an account is removed from a target organization or OU. We also activate
                                <code class="code">--managed-execution</code> so that StackSets performs
                            non-conflicting operations concurrently and queues conflicting
                            operations. After conflicting operations finish, StackSets starts queued
                            operations in request order.</p>
                        <div class="awsdocs-note"><div class="awsdocs-note-title"><awsui-icon name="status-info" variant="link"></awsui-icon><h6>Note</h6></div><div class="awsdocs-note-text"><p>If there are already running or queued operations, StackSets
                                queues all incoming operations even if they are
                                non-conflicting.</p><p>You can't modify your stack set's execution configuration while
                                there are running or queued operations for that stack set.</p></div></div>
                        <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="sh ">aws cloudformation create-stack-set \
  --stack-set-name <code class="replaceable">StackSet_myApp</code> \
  --template-url <code class="replaceable">https://s3.us-west-2.amazonaws.com/cloudformation-templates-us-west-2/MyApp.template</code> \
  <b>--permission-model <code class="replaceable">SERVICE_MANAGED</code> \
  --auto-deployment Enabled=<code class="replaceable">true</code>,RetainStacksOnAccountRemoval=<code class="replaceable">true</code></b></code></pre>
                    </li><li>
                        <p>After your <code class="code">create-stack-set</code> command is finished, run the
                                <code class="code">list-stack-sets</code> command to confirm that your stack set
                            was created. Your new stack set is listed in the results.</p>
                        <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="sh ">aws cloudformation list-stack-sets</code></pre>
                        <div class="itemizedlist">
                             
                             
                             
                        <ul class="itemizedlist"><li class="listitem">
                                <p>If you set the <code class="code">--call-as</code> parameter to
                                        <code class="code">DELEGATED_ADMIN</code> while signed in to your member
                                    account, <code class="code">list-stack-sets</code> returns all stack sets
                                    with service-managed permissions in the organization's
                                    management account.</p>
                            </li><li class="listitem">
                                <p>If you set the <code class="code">--call-as</code> parameter to
                                        <code class="code">SELF</code> while signed in to your AWS account,
                                        <code class="code">list-stack-sets</code> returns all self-managed stack
                                    sets in your AWS account.</p>
                            </li><li class="listitem">
                                <p>If you set the <code class="code">--call-as</code> parameter to
                                        <code class="code">SELF</code> while signed in to the organization's
                                    management account, <code class="code">list-stack-sets</code> returns all
                                    stack sets in the organization's management account.</p>
                            </li></ul></div>
                    </li><li>
                        <p>Run the <code class="code">create-stack-instances</code> command to add stack
                            instances to your stack set. For the <code class="code">--deployment-targets</code>
                            parameter, specify the organization root ID to deploy to all accounts in
                            your organization, or specify OU IDs to deploy to all accounts in those
                            OUs. In this example, we specify OUs with <code class="code">ou-rcuk-1x5j1lwo</code>
                            and <code class="code">ou-rcuk-slr5lh0a</code> IDs.</p>
                        <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="sh ">aws cloudformation create-stack-instances --stack-set-name <code class="replaceable">StackSet_myApp</code> <b>--deployment-targets OrganizationalUnitIds='["<code class="replaceable">ou-rcuk-1x5j1lwo</code>", "<code class="replaceable">ou-rcuk-slr5lh0a</code>"]'</b> --regions '["<code class="replaceable">eu-west-1</code>"]'</code></pre>
                        <div class="awsdocs-note awsdocs-important"><div class="awsdocs-note-title"><awsui-icon name="status-warning" variant="error"></awsui-icon><h6>Important</h6></div><div class="awsdocs-note-text"><p>Wait until an operation is complete before starting another one.
                                You can run only one operation at a time.</p></div></div>
                    </li><li>
                        <p>Using the <code class="code">operation-id</code> that was returned as part of the
                                <code class="code">create-stack-instances</code> output in step 4, run
                                <code class="code">describe-stack-set-operation</code> to verify that your stack
                            instances were created successfully.</p>
                    </li></ol></div>

             
        <awsdocs-copyright class="copyright-print"></awsdocs-copyright><awsdocs-thumb-feedback right-edge="{{$ctrl.thumbFeedbackRightEdge}}"></awsdocs-thumb-feedback></div><noscript><div><div><div><div id="js_error_message"><p><img src="https://d1ge0kk1l5kms0.cloudfront.net/images/G/01/webservices/console/warning.png" alt="Warning" /> <strong>Javascript is disabled or is unavailable in your browser.</strong></p><p>To use the Amazon Web Services Documentation, Javascript must be enabled. Please refer to your browser's Help pages for instructions.</p></div></div></div></div></noscript><div id="main-col-footer" class="awsui-util-font-size-0"><div id="doc-conventions"><a target="_top" href="/general/latest/gr/docconventions.html">Document Conventions</a></div><div class="prev-next"><div id="previous" class="prev-link" accesskey="p" href="./stacksets-getting-started.html">Getting started</div><div id="next" class="next-link" accesskey="n" href="./stacksets-update.html">Update your stack set</div></div></div><awsdocs-page-utilities></awsdocs-page-utilities></div><div id="quick-feedback-yes" style="display: none;"><div class="title">Did this page help you? - Yes</div><div class="content"><p>Thanks for letting us know we're doing a good job!</p><p>If you've got a moment, please tell us what we did right so we can do more of it.</p><p><awsui-button id="fblink" rel="noopener noreferrer" target="_blank" text="Feedback" click="linkClick($event)" href="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=CloudFormation&amp;topic_url=https://docs.aws.amazon.com/en_us/AWSCloudFormation/latest/UserGuide/stacksets-getting-started-create.html"></awsui-button></p></div></div><div id="quick-feedback-no" style="display: none;"><div class="title">Did this page help you? - No</div><div class="content"><p>Thanks for letting us know this page needs work. We're sorry we let you down.</p><p>If you've got a moment, please tell us how we can make the documentation better.</p><p><awsui-button id="fblink" rel="noopener noreferrer" target="_blank" text="Feedback" click="linkClick($event)" href="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=CloudFormation&amp;topic_url=https://docs.aws.amazon.com/en_us/AWSCloudFormation/latest/UserGuide/stacksets-getting-started-create.html"></awsui-button></p></div></div></div></body></div></awsdocs-view><div class="page-loading-indicator" id="page-loading-indicator"><awsui-spinner size="large"></awsui-spinner></div></div><div id="tools-panel" dom-region="tools"><awsdocs-tools-panel id="awsdocs-tools-panel"></awsdocs-tools-panel></div></awsui-app-layout><awsdocs-cookie-banner class="doc-cookie-banner"></awsdocs-cookie-banner></div></body></html>