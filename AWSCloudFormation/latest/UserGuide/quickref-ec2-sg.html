<!DOCTYPE html>
    <html xmlns="http://www.w3.org/1999/xhtml" lang="en-US"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Manage security groups with AWS CloudFormation - AWS CloudFormation</title><meta name="viewport" content="width=device-width,initial-scale=1" /><meta name="assets_root" content="/assets" /><meta name="target_state" content="quickref-ec2-sg" /><meta name="default_state" content="quickref-ec2-sg" /><link rel="icon" type="image/ico" href="/assets/images/favicon.ico" /><link rel="shortcut icon" type="image/ico" href="/assets/images/favicon.ico" /><link rel="canonical" href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/quickref-ec2-sg.html" /><meta name="description" content="Use these example template snippets to manage security groups and Amazon EC2 instances with AWS CloudFormation." /><meta name="deployment_region" content="IAD" /><meta name="product" content="AWS CloudFormation" /><meta name="guide" content="User Guide" /><meta name="abstract" content="Create and manage AWS infrastructure deployments predictably and repeatedly using AWS CloudFormation with this User Guide." /><meta name="guide-locale" content="en_us" /><meta name="tocs" content="toc-contents.json" /><link rel="canonical" href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/quickref-ec2-sg.html" /><link rel="alternative" href="https://docs.aws.amazon.com/id_id/AWSCloudFormation/latest/UserGuide/quickref-ec2-sg.html" hreflang="id-id" /><link rel="alternative" href="https://docs.aws.amazon.com/id_id/AWSCloudFormation/latest/UserGuide/quickref-ec2-sg.html" hreflang="id" /><link rel="alternative" href="https://docs.aws.amazon.com/de_de/AWSCloudFormation/latest/UserGuide/quickref-ec2-sg.html" hreflang="de-de" /><link rel="alternative" href="https://docs.aws.amazon.com/de_de/AWSCloudFormation/latest/UserGuide/quickref-ec2-sg.html" hreflang="de" /><link rel="alternative" href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/quickref-ec2-sg.html" hreflang="en-us" /><link rel="alternative" href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/quickref-ec2-sg.html" hreflang="en" /><link rel="alternative" href="https://docs.aws.amazon.com/es_es/AWSCloudFormation/latest/UserGuide/quickref-ec2-sg.html" hreflang="es-es" /><link rel="alternative" href="https://docs.aws.amazon.com/es_es/AWSCloudFormation/latest/UserGuide/quickref-ec2-sg.html" hreflang="es" /><link rel="alternative" href="https://docs.aws.amazon.com/fr_fr/AWSCloudFormation/latest/UserGuide/quickref-ec2-sg.html" hreflang="fr-fr" /><link rel="alternative" href="https://docs.aws.amazon.com/fr_fr/AWSCloudFormation/latest/UserGuide/quickref-ec2-sg.html" hreflang="fr" /><link rel="alternative" href="https://docs.aws.amazon.com/it_it/AWSCloudFormation/latest/UserGuide/quickref-ec2-sg.html" hreflang="it-it" /><link rel="alternative" href="https://docs.aws.amazon.com/it_it/AWSCloudFormation/latest/UserGuide/quickref-ec2-sg.html" hreflang="it" /><link rel="alternative" href="https://docs.aws.amazon.com/ja_jp/AWSCloudFormation/latest/UserGuide/quickref-ec2-sg.html" hreflang="ja-jp" /><link rel="alternative" href="https://docs.aws.amazon.com/ja_jp/AWSCloudFormation/latest/UserGuide/quickref-ec2-sg.html" hreflang="ja" /><link rel="alternative" href="https://docs.aws.amazon.com/ko_kr/AWSCloudFormation/latest/UserGuide/quickref-ec2-sg.html" hreflang="ko-kr" /><link rel="alternative" href="https://docs.aws.amazon.com/ko_kr/AWSCloudFormation/latest/UserGuide/quickref-ec2-sg.html" hreflang="ko" /><link rel="alternative" href="https://docs.aws.amazon.com/pt_br/AWSCloudFormation/latest/UserGuide/quickref-ec2-sg.html" hreflang="pt-br" /><link rel="alternative" href="https://docs.aws.amazon.com/pt_br/AWSCloudFormation/latest/UserGuide/quickref-ec2-sg.html" hreflang="pt" /><link rel="alternative" href="https://docs.aws.amazon.com/zh_cn/AWSCloudFormation/latest/UserGuide/quickref-ec2-sg.html" hreflang="zh-cn" /><link rel="alternative" href="https://docs.aws.amazon.com/zh_tw/AWSCloudFormation/latest/UserGuide/quickref-ec2-sg.html" hreflang="zh-tw" /><link rel="alternative" href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/quickref-ec2-sg.html" hreflang="x-default" /><meta name="feedback-item" content="CloudFormation" /><meta name="this_doc_product" content="AWS CloudFormation" /><meta name="this_doc_guide" content="User Guide" /><script defer="" src="/assets/r/vendor4.js?version=2021.12.02"></script><script defer="" src="/assets/r/vendor3.js?version=2021.12.02"></script><script defer="" src="/assets/r/vendor1.js?version=2021.12.02"></script><script defer="" src="/assets/r/awsdocs-common.js?version=2021.12.02"></script><script defer="" src="/assets/r/awsdocs-doc-page.js?version=2021.12.02"></script><link href="/assets/r/vendor4.css?version=2021.12.02" rel="stylesheet" /><link href="/assets/r/awsdocs-common.css?version=2021.12.02" rel="stylesheet" /><link href="/assets/r/awsdocs-doc-page.css?version=2021.12.02" rel="stylesheet" /><script async="" id="awsc-panorama-bundle" type="text/javascript" src="https://prod.pa.cdn.uis.awsstatic.com/panorama-nav-init.js" data-config="{'appEntity':'aws-documentation','region':'us-east-1','service':'cloudformation'}"></script><meta id="panorama-serviceSubSection" value="User Guide" /><meta id="panorama-serviceConsolePage" value="Manage security groups with AWS CloudFormation" /></head><body class="awsdocs awsui"><div class="awsdocs-container"><awsdocs-header></awsdocs-header><awsui-app-layout id="app-layout" class="awsui-util-no-gutters" ng-controller="ContentController as $ctrl" header-selector="awsdocs-header" navigation-hide="false" navigation-width="$ctrl.navWidth" navigation-open="$ctrl.navOpen" navigation-change="$ctrl.onNavChange($event)" tools-hide="$ctrl.hideTools" tools-width="$ctrl.toolsWidth" tools-open="$ctrl.toolsOpen" tools-change="$ctrl.onToolsChange($event)"><div id="guide-toc" dom-region="navigation"><awsdocs-toc></awsdocs-toc></div><div id="main-column" dom-region="content" tabindex="-1"><awsdocs-view class="awsdocs-view"><div id="awsdocs-content"><head><title>Manage security groups with AWS CloudFormation - AWS CloudFormation</title><meta name="rss" content="aws-cloudformation-release-notes.rss" /><meta name="forums" content="http://forums.aws.amazon.com/forum.jspa?forumID=92" /><meta name="feedback" content="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=CloudFormation&amp;topic_url=https://docs.aws.amazon.com/en_us/AWSCloudFormation/latest/UserGuide/quickref-ec2-sg.html" /><meta name="feedback-yes" content="feedbackyes.html?topic_url=https://docs.aws.amazon.com/en_us/AWSCloudFormation/latest/UserGuide/quickref-ec2-sg.html" /><meta name="feedback-no" content="feedbackno.html?topic_url=https://docs.aws.amazon.com/en_us/AWSCloudFormation/latest/UserGuide/quickref-ec2-sg.html" /><meta name="keywords" content="CloudFormation,AWSCloudFormation,resource provisioning,resource configuration,infrastructure management,CloudFormer,CloudFormation stack,CloudFormation stackset,CloudFormation template,change set" /><script type="application/ld+json">
{
    "@context" : "https://schema.org",
    "@type" : "BreadcrumbList",
    "itemListElement" : [
      {
        "@type" : "ListItem",
        "position" : 1,
        "name" : "AWS",
        "item" : "https://aws.amazon.com"
      },
      {
        "@type" : "ListItem",
        "position" : 2,
        "name" : "AWS CloudFormation",
        "item" : "https://docs.aws.amazon.com/cloudformation/index.html"
      },
      {
        "@type" : "ListItem",
        "position" : 3,
        "name" : "User Guide",
        "item" : "https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide"
      },
      {
        "@type" : "ListItem",
        "position" : 4,
        "name" : "Working with AWS CloudFormation templates",
        "item" : "https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/template-guide.html"
      },
      {
        "@type" : "ListItem",
        "position" : 5,
        "name" : "Template snippets",
        "item" : "https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/CHAP_TemplateQuickRef.html"
      },
      {
        "@type" : "ListItem",
        "position" : 6,
        "name" : "Amazon EC2 CloudFormation template snippets",
        "item" : "https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/quickref-ec2.html"
      },
      {
        "@type" : "ListItem",
        "position" : 7,
        "name" : "Manage security groups with AWS CloudFormation",
        "item" : "https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/quickref-ec2.html"
      }
    ]
}
</script></head><body><div id="main"><div style="display: none"></div><div id="breadcrumbs" class="breadcrumb"><a href="https://aws.amazon.com">AWS</a><a href="/index.html">Documentation</a><a href="/cloudformation/index.html">AWS CloudFormation</a><a href="Welcome.html">User Guide</a></div><div id="page-toc-src"><a href="#quickref-ec2-instances-associate-security-group">Associate an Amazon EC2
                    instance with a security group</a><a href="#quickref-ec2-instances-ingress">Create security groups with ingress
                    rules</a><a href="#scenario-ec2-security-group-elbingress">Create an Elastic Load
                    Balancer with a security group ingress rule</a></div><div id="page-filters" style="display:none"><filter label="All" id="All"></filter><filter label="JSON" id="JSON"></filter><filter label="YAML" id="YAML"></filter></div><div id="main-content" class="awsui-util-container"><div id="main-col-body"><awsdocs-language-banner data-service="$ctrl.pageService"></awsdocs-language-banner><h1 class="topictitle" id="quickref-ec2-sg">Manage security groups with AWS CloudFormation</h1><div class="awsdocs-page-header-container"><awsdocs-page-header></awsdocs-page-header><awsdocs-filter-selector id="awsdocs-filter-selector"></awsdocs-filter-selector></div><p>The following snippets demonstrate how to use AWS CloudFormation to manage security groups and
            Amazon EC2 instances to control access to your AWS resources.</p><div class="highlights" id="inline-topiclist"><h6>Snippet categories</h6><ul><li><a href="#quickref-ec2-instances-associate-security-group">Associate an Amazon EC2
                    instance with a security group</a></li><li><a href="#quickref-ec2-instances-ingress">Create security groups with ingress
                    rules</a></li><li><a href="#scenario-ec2-security-group-elbingress">Create an Elastic Load
                    Balancer with a security group ingress rule</a></li></ul></div>
            <h2 id="quickref-ec2-instances-associate-security-group">Associate an Amazon EC2
                    instance with a security group</h2>
            <p>The following example snippets demonstrate how to associate an Amazon EC2 instance with
                a default Amazon VPC security group using AWS CloudFormation.</p>
            <div class="highlights" id="inline-topiclist"><h6>Example snippets</h6><ul><li><a href="#using-cfn-getatt-default-values">Associate an Amazon EC2 instance
                        with a default VPC security group</a></li><li><a href="#scenario-ec2-volumeattachment">Create an Amazon EC2 instance with an
                        attached volume and security group</a></li></ul></div>
             
                <h3 id="using-cfn-getatt-default-values">Associate an Amazon EC2 instance
                        with a default VPC security group</h3>
                <p>The following snippet creates an Amazon VPC, a subnet within the VPC, and an Amazon EC2
                    instance. The VPC is created using an <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-resource-ec2-vpc.html">AWS::EC2::VPC</a> resource. The IP address range for the VPC is defined
                    in the larger template and is referenced by the <code class="code">MyVPCCIDRRange</code>
                    parameter.</p>
                <p>A subnet is created within the VPC using an <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-resource-ec2-subnet.html">AWS::EC2:: Subnet</a> resource. The subnet is associated with the VPC,
                    which is referenced as <code class="code">MyVPC</code>.</p>
                <p>An EC2 instance is launched within the VPC and subnet using an <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-resource-ec2-instance.html">AWS::EC2::Instance</a> resource. This resource specifies the Amazon
                    Machine Image (AMI) to use to launch the instance, the subnet where the instance
                    will run, and the security group to associate with the instance. The
                        <code class="code">Fn::FindInMap</code> function is used to retrieve values from the
                        <code class="code">AWSRegionToAMI</code> mapping defined in the template to determine the
                        <code class="code">ImageId</code> for the <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-resource-ec2-instance.html">AWS::EC2::Instance</a> resource. </p>
                <p>The security group ID is obtained using the <code class="code">Fn::GetAtt</code> function,
                    which retrieves the default security group from the <code class="code">MyVPC</code> resource. </p>
                <p>The instance is placed within the <code class="code">MySubnet</code> resource defined in
                    the snippet. </p>

                <p>When you create a VPC using AWS CloudFormation, AWS automatically creates default
                    resources within the VPC, including a default security group. However, when you
                    define a VPC within an AWS CloudFormation template, you may not have access to the IDs of
                    these default resources when you create the template. To access and use the
                    default resources specified in the template, you can use intrinsic functions
                    such as <a href="./intrinsic-function-reference-getatt.html">Fn::GetAtt</a>. This function allows
                    you to work with the default resources that are automatically created by
                    AWS CloudFormation.</p>
                <div id="JSON" name="JSON" class="section langfilter">
                    <h4 id="quickref-ec2-example-15.json">JSON</h4>

                    <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="json ">"MyVPC": <span>{</span>
    "Type": "AWS::EC2::VPC",
    "Properties": <span>{</span>
        "CidrBlock": <span>{</span>
            "Ref": "MyVPCCIDRRange"
        },
        "EnableDnsSupport": false,
        "EnableDnsHostnames": false,
        "InstanceTenancy": "default"
    }
},
"MySubnet": <span>{</span>
    "Type": "AWS::EC2::Subnet",
    "Properties": <span>{</span>
        "CidrBlock": <span>{</span>
            "Ref": "MyVPCCIDRRange"
        },
        "VpcId": <span>{</span>
            "Ref": "MyVPC"
        }
    }
},
"MyInstance": <span>{</span>
    "Type": "AWS::EC2::Instance",
    "Properties": <span>{</span>
        "ImageId": <span>{</span>
            "Fn::FindInMap": [
                "AWSRegionToAMI",
                <span>{</span>
                    "Ref": "AWS::Region"
                },
                "64"
            ]
        },
        "SecurityGroupIds": [
            <span>{</span>
                "Fn::GetAtt": [
                    "MyVPC",
                    "DefaultSecurityGroup"
                ]
            }
        ],
        "SubnetId": <span>{</span>
            "Ref": "MySubnet"
        }
    }
}</code></pre>
                </div>
                <div id="YAML" name="YAML" class="section langfilter">
                    <h4 id="quickref-ec2-example-15.yaml">YAML</h4>

                    <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="yaml ">MyVPC:
  Type: AWS::EC2::VPC
  Properties:
    CidrBlock:
      Ref: MyVPCCIDRRange
    EnableDnsSupport: false
    EnableDnsHostnames: false
    InstanceTenancy: default
MySubnet:
  Type: AWS::EC2::Subnet
  Properties:
    CidrBlock:
      Ref: MyVPCCIDRRange
    VpcId:
      Ref: MyVPC
MyInstance:
  Type: AWS::EC2::Instance
  Properties:
    ImageId:
      Fn::FindInMap:
        - AWSRegionToAMI
        - Ref: AWS::Region
        - "64"
    SecurityGroupIds:
      - Fn::GetAtt:
          - MyVPC
          - DefaultSecurityGroup
    SubnetId:
      Ref: MySubnet</code></pre>
                </div>
             
             
                <h3 id="scenario-ec2-volumeattachment">Create an Amazon EC2 instance with an
                        attached volume and security group</h3>
                <p>The following snippet creates an Amazon EC2 instance using an <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-properties-ec2-instance.html">AWS::EC2::Instance</a> resource, which is launched from a designated
                    AMI . The instance is associated with a security group that allows incoming SSH
                    traffic on port 22 from a specified IP address, using an <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-properties-ec2-security-group.html">AWS::EC2::SecurityGroup</a> resource . It creates a 100 GB Amazon EBS volume
                    using an <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-resource-ec2-volume.html">AWS::EC2::Volume</a> resource. The volume is created in the same
                    availability zone as the instance, as specified by the <code class="code">GetAtt</code>
                    function, and is mounted to the instance at the <code class="code">/dev/sdh</code>
                    device.</p>
                <p>For more information about creating Amazon EBS volumes, see <a href="https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/ebs-creating-volume.html">Create an Amazon EBS volume</a>.</p>
                <div id="JSON" name="JSON" class="section langfilter">
                    <h4 id="quickref-ec2-example-14.json">JSON</h4>

                    <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="json ">"Ec2Instance": <span>{</span>
    "Type": "AWS::EC2::Instance",
    "Properties": <span>{</span>
        "SecurityGroups": [
            <span>{</span>
                "Ref": "InstanceSecurityGroup"
            }
        ],
        "ImageId": "<code class="replaceable">ami-1234567890abcdef0</code>"
    }
},
"InstanceSecurityGroup": <span>{</span>
    "Type": "AWS::EC2::SecurityGroup",
    "Properties": <span>{</span>
        "GroupDescription": "Enable SSH access via port 22",
        "SecurityGroupIngress": [
            <span>{</span>
                "IpProtocol": "tcp",
                "FromPort": "22",
                "ToPort": "22",
                "CidrIp": "<code class="replaceable">192.0.2.0/24</code>"
            }
        ]
    }
},
"NewVolume": <span>{</span>
    "Type": "AWS::EC2::Volume",
    "Properties": <span>{</span>
        "Size": "100",
        "AvailabilityZone": <span>{</span>
            "Fn::GetAtt": [
                "Ec2Instance",
                "AvailabilityZone"
            ]
        }
    }
},
"MountPoint": <span>{</span>
    "Type": "AWS::EC2::VolumeAttachment",
    "Properties": <span>{</span>
        "InstanceId": <span>{</span>
            "Ref": "Ec2Instance"
        },
        "VolumeId": <span>{</span>
            "Ref": "NewVolume"
        },
        "Device": "/dev/sdh"
    }
}</code></pre>
                </div>
                <div id="YAML" name="YAML" class="section langfilter">
                    <h4 id="quickref-ec2-example-14.yaml">YAML</h4>

                    <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="yaml ">Ec2Instance:
  Type: AWS::EC2::Instance
  Properties:
    SecurityGroups:
      - !Ref InstanceSecurityGroup
    ImageId: <code class="replaceable">ami-1234567890abcdef0</code>
InstanceSecurityGroup:
  Type: AWS::EC2::SecurityGroup
  Properties:
    GroupDescription: Enable SSH access via port 22
    SecurityGroupIngress:
      - IpProtocol: tcp
        FromPort: 22
        ToPort: 22
        CidrIp: <code class="replaceable">192.0.2.0/24</code>
NewVolume:
  Type: AWS::EC2::Volume
  Properties:
    Size: 100
    AvailabilityZone: !GetAtt [Ec2Instance, AvailabilityZone]
MountPoint:
  Type: AWS::EC2::VolumeAttachment
  Properties:
    InstanceId: !Ref Ec2Instance
    VolumeId: !Ref NewVolume
    Device: /dev/sdh</code></pre>
                </div>
             


         
            <h2 id="quickref-ec2-instances-ingress">Create security groups with ingress
                    rules</h2>
            <p>The following example snippets demonstrate how to configure security groups with
                specific ingress rules using AWS CloudFormation.</p>
            <div class="highlights" id="inline-topiclist"><h6>Snippets</h6><ul><li><a href="#scenario-ec2-security-group-rule">Create security group with
                        ingress rules for SSH and HTTP access</a></li><li><a href="#scenario-ec2-security-group-two-ports">Create a security group
                        with ingress rules for HTTP and SSH access from specified CIDR
                        ranges</a></li><li><a href="#scenario-ec2-security-group-ingress">Create cross-referencing
                        security groups with ingress rules</a></li></ul></div>
             
                <h3 id="scenario-ec2-security-group-rule">Create security group with
                        ingress rules for SSH and HTTP access</h3>

                <p>The following snippet describes two security group ingress rules using an
                        <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-properties-ec2-security-group.html">AWS::EC2::SecurityGroup</a> resource. The first ingress rule allows SSH
                    (port 22) access from an existing security group named
                        <code class="code">MyAdminSecurityGroup</code>, which is owned by the AWS account with
                    the account number <code class="code">1111-2222-3333</code>. The second ingress rule allows
                    HTTP (port 80) access from a different security group named
                        <code class="code">MySecurityGroupCreatedInCFN</code>, which is created in the same
                    template. The <code class="code">Ref</code> function is used to reference the logical name of
                    the security group created in the same template. </p>
                <p>In the first ingress rule, you must add a value for both the
                        <code class="code">SourceSecurityGroupName</code> and
                        <code class="code">SourceSecurityGroupOwnerId</code> properties. In the second ingress
                    rule, <code class="code">MySecurityGroupCreatedInCFNTemplate</code> references a different
                    security group, which is created in the same template. Verify that the logical
                    name <code class="code">MySecurityGroupCreatedInCFNTemplate</code> matches the actual logical
                    name of the security group resource that you specify in the larger template. </p>
                <p>For more information about security groups, see <a href="https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/ec2-security-groups.html">Amazon EC2 security groups
                        for Linux instances</a> or <a href="https://docs.aws.amazon.com/AWSEC2/latest/WindowsGuide/ec2-security-groups.html">Amazon EC2 security
                        groups for Windows instances</a>.</p>
                <div id="JSON" name="JSON" class="section langfilter">
                    <h4 id="quickref-ec2-example-10.json">JSON</h4>

                    <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="json ">"SecurityGroup": <span>{</span>
    "Type": "AWS::EC2::SecurityGroup",
    "Properties": <span>{</span>
        "GroupDescription": "Allow connections from specified source security group",
        "SecurityGroupIngress": [
            <span>{</span>
                "IpProtocol": "tcp",
                "FromPort": "22",
                "ToPort": "22",
                "SourceSecurityGroupName": "MyAdminSecurityGroup",
                "SourceSecurityGroupOwnerId": "<code class="replaceable">1111-2222-3333</code>"
            },
            <span>{</span>
                "IpProtocol": "tcp",
                "FromPort": "80",
                "ToPort": "80",
                "SourceSecurityGroupName": <span>{</span>
                    "Ref": "MySecurityGroupCreatedInCFNTemplate"
                }
            }
        ]
    }
}</code></pre>
                </div>
                <div id="YAML" name="YAML" class="section langfilter">
                    <h4 id="quickref-ec2-example-10.yaml">YAML</h4>

                    <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="yaml ">SecurityGroup:
  Type: 'AWS::EC2::SecurityGroup'
  Properties:
    GroupDescription: Allow connections from specified source security group
    SecurityGroupIngress:
      - IpProtocol: tcp
        FromPort: '22'
        ToPort: '22'
        SourceSecurityGroupName: MyAdminSecurityGroup
        SourceSecurityGroupOwnerId: '<code class="replaceable">1111-2222-3333</code>'
      - IpProtocol: tcp
        FromPort: '80'
        ToPort: '80'
        SourceSecurityGroupName:
          Ref: MySecurityGroupCreatedInCFNTemplate</code></pre>
                </div>
             
             
                <h3 id="scenario-ec2-security-group-two-ports">Create a security group
                        with ingress rules for HTTP and SSH access from specified CIDR
                        ranges</h3>

                <p>The following snippet creates a security group for an Amazon EC2 instance with two
                    inbound rules. The inbound rules allow incoming TCP traffic on the specified
                    ports from the designated CIDR ranges. An <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-properties-ec2-security-group.html">AWS::EC2::SecurityGroup</a> resource is used to specify the rules. You
                    must specify a protocol for each rule. For TCP, you must specify a port or port
                    range. If you do not specify either a source security group or a CIDR range, the
                    stack will launch successfully, but the rule will not be applied to the security
                    group. </p>
                <p>For more information about security groups, see <a href="https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/ec2-security-groups.html">Amazon EC2 security groups
                        for Linux instances</a> or <a href="https://docs.aws.amazon.com/AWSEC2/latest/WindowsGuide/ec2-security-groups.html">Amazon EC2 security
                        groups for Windows instances</a>.</p>
    <div id="JSON" name="JSON" class="section langfilter">
     <h4 id="quickref-ec2-example-9.json">JSON</h4>
                    <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="json ">"ServerSecurityGroup": <span>{</span>
  "Type": "AWS::EC2::SecurityGroup",
  "Properties": <span>{</span>
    "GroupDescription": "Allow connections from specified CIDR ranges",
    "SecurityGroupIngress": [
      <span>{</span>
        "IpProtocol": "tcp",
        "FromPort": "80",
        "ToPort": "80",
        "CidrIp": "<code class="replaceable">192.0.2.0/24</code>"
      },
      <span>{</span>
        "IpProtocol": "tcp",
        "FromPort": "22",
        "ToPort": "22",
        "CidrIp": "<code class="replaceable">192.0.2.0/24</code>"
      }
    ]
  }
}</code></pre>
                </div>
                <div id="YAML" name="YAML" class="section langfilter">
                    <h4 id="quickref-ec2-example-9.yaml">YAML</h4>

                    <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="yaml ">ServerSecurityGroup:
  Type: AWS::EC2::SecurityGroup
  Properties:
    GroupDescription: Allow connections from specified CIDR ranges
    SecurityGroupIngress:
      - IpProtocol: tcp
        FromPort: 80
        ToPort: 80
        CidrIp: <code class="replaceable">192.0.2.0/24</code>
      - IpProtocol: tcp
        FromPort: 22
        ToPort: 22
        CidrIp: <code class="replaceable">192.0.2.0/24</code></code></pre>
                </div>
             
             
                <h3 id="scenario-ec2-security-group-ingress">Create cross-referencing
                        security groups with ingress rules</h3>

                <p>The following snippet uses the <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-properties-ec2-security-group.html">AWS::EC2::SecurityGroup</a> resource to create two Amazon EC2 security
                    groups, <code class="code">SGroup1</code> and <code class="code">SGroup2</code>. Ingress rules that allow
                    communication between the two security groups are created by using the <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-properties-ec2-security-group-ingress.html">AWS::EC2::SecurityGroupIngress</a> resource.
                        <code class="code">SGroup1Ingress</code> establishes an ingress rule for
                        <code class="code">SGroup1</code> that allows incoming TCP traffic on port 80 from the
                    source security group, <code class="code">SGroup2</code>. <code class="code">SGroup2Ingress</code>
                    establishes an ingress rule for <code class="code">SGroup2</code> that allows incoming TCP
                    traffic on port 80 from the source security group, <code class="code">SGroup1</code>. </p>
                <div id="JSON" name="JSON" class="section langfilter">
                    <h4 id="quickref-ec2-example-12.json">JSON</h4>

                    <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="json ">"SGroup1": <span>{</span>
    "Type": "AWS::EC2::SecurityGroup",
    "Properties": <span>{</span>
        "GroupDescription": "EC2 instance access"
    }
},
"SGroup2": <span>{</span>
    "Type": "AWS::EC2::SecurityGroup",
    "Properties": <span>{</span>
        "GroupDescription": "EC2 instance access"
    }
},
"SGroup1Ingress": <span>{</span>
    "Type": "AWS::EC2::SecurityGroupIngress",
    "Properties": <span>{</span>
        "GroupName": <span>{</span>
            "Ref": "SGroup1"
        },
        "IpProtocol": "tcp",
        "ToPort": "80",
        "FromPort": "80",
        "SourceSecurityGroupName": <span>{</span>
            "Ref": "SGroup2"
        }
    }
},
"SGroup2Ingress": <span>{</span>
    "Type": "AWS::EC2::SecurityGroupIngress",
    "Properties": <span>{</span>
        "GroupName": <span>{</span>
            "Ref": "SGroup2"
        },
        "IpProtocol": "tcp",
        "ToPort": "80",
        "FromPort": "80",
        "SourceSecurityGroupName": <span>{</span>
            "Ref": "SGroup1"
        }
    }
}</code></pre>
                </div>
                <div id="YAML" name="YAML" class="section langfilter">
                    <h4 id="quickref-ec2-example-12.yaml">YAML</h4>

                    <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="yaml ">SGroup1:
  Type: AWS::EC2::SecurityGroup
  Properties:
    GroupDescription: EC2 Instance access
SGroup2:
  Type: AWS::EC2::SecurityGroup
  Properties:
    GroupDescription: EC2 Instance access
SGroup1Ingress:
  Type: AWS::EC2::SecurityGroupIngress
  Properties:
    GroupName: !Ref SGroup1
    IpProtocol: tcp
    ToPort: 80
    FromPort: 80
    SourceSecurityGroupName: !Ref SGroup2
SGroup2Ingress:
  Type: AWS::EC2::SecurityGroupIngress
  Properties:
    GroupName: !Ref SGroup2
    IpProtocol: tcp
    ToPort: 80
    FromPort: 80
    SourceSecurityGroupName: !Ref SGroup1</code></pre>
                </div>
             
         
            <h2 id="scenario-ec2-security-group-elbingress">Create an Elastic Load
                    Balancer with a security group ingress rule</h2>
    <p>The following template creates an <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-properties-ec2-elb.html">AWS::ElasticLoadBalancing::LoadBalancer</a> resource in the specified availability zone. The <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-properties-ec2-elb.html">AWS::ElasticLoadBalancing::LoadBalancer</a> resource is configured to listen on port 80 for HTTP traffic and
     direct requests to instances also on port 80. The Elastic Load Balancer is responsible for load balancing incoming
     HTTP traffic among the instances.</p>
    <p> Additionally, this template generates an <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-properties-ec2-security-group.html">AWS::EC2::SecurityGroup</a>
     resource associated with the load balancer. This security group is created with a single ingress rule, described as
      <code class="code">ELB ingress group</code>, which allows incoming TCP traffic on port 80. The source for this ingress rule is
     defined using the <code class="code">Fn::GetAtt</code> fucntion to retrieve attributes from the load balancer resource.
      <code class="code">SourceSecurityGroupOwnerId</code> uses <code class="code">Fn::GetAtt</code> to obtain the <code class="code">OwnerAlias</code> of the
     source security group of the load balancer. <code class="code">SourceSecurityGroupName</code> uses <code class="code">Fn::Getatt</code> to
     obtain the <code class="code">GroupName</code> of the source security group of the ELB. </p>
    <p>This setup ensures secure communication between the ELB and the instances. </p>
    <p>For more information about load balancing, see the <em><a href="https://docs.aws.amazon.com/elasticloadbalancing/latest/userguide/what-is-load-balancing.html">Elastic Load Balancing User
      Guide</a></em>.</p>

    <div id="JSON" name="JSON" class="section langfilter">
     <h3 id="quickref-ec2-example-11.json">JSON</h3>

     <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
    "AWSTemplateFormatVersion": "2010-09-09",
    "Resources": <span>{</span>
        "MyELB": <span>{</span>
            "Type": "AWS::ElasticLoadBalancing::LoadBalancer",
            "Properties": <span>{</span>
                "AvailabilityZones": [
                    "<code class="replaceable">aa-example-1a</code>"
                ],
                "Listeners": [
                    <span>{</span>
                        "LoadBalancerPort": "80",
                        "InstancePort": "80",
                        "Protocol": "HTTP"
                    }
                ]
            }
        },
        "MyELBIngressGroup": <span>{</span>
            "Type": "AWS::EC2::SecurityGroup",
            "Properties": <span>{</span>
                "GroupDescription": "ELB ingress group",
                "SecurityGroupIngress": [
                    <span>{</span>
                        "IpProtocol": "tcp",
                        "FromPort": 80,
                        "ToPort": 80,
                        "SourceSecurityGroupOwnerId": <span>{</span>
                            "Fn::GetAtt": [
                                "MyELB",
                                "SourceSecurityGroup.OwnerAlias"
                            ]
                        },
                        "SourceSecurityGroupName": <span>{</span>
                            "Fn::GetAtt": [
                                "MyELB",
                                "SourceSecurityGroup.GroupName"
                            ]
                        }
                    }
                ]
            }
        }
    }
}</code></pre>
    </div>
    <div id="YAML" name="YAML" class="section langfilter">
     <h3 id="quickref-ec2-example-11.yaml">YAML</h3>

     <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="yaml ">AWSTemplateFormatVersion: '2010-09-09'
Resources:
  MyELB:
    Type: 'AWS::ElasticLoadBalancing::LoadBalancer'
    Properties:
      AvailabilityZones:
        - <code class="replaceable">aa-example-1a</code>
      Listeners:
        - LoadBalancerPort: '80'
          InstancePort: '80'
          Protocol: HTTP
  MyELBIngressGroup:
    Type: 'AWS::EC2::SecurityGroup'
    Properties:
      GroupDescription: ELB ingress group
      SecurityGroupIngress:
        - IpProtocol: tcp
          FromPort: '80'
          ToPort: '80'
          SourceSecurityGroupOwnerId:
            Fn::GetAtt:
              - MyELB
              - SourceSecurityGroup.OwnerAlias
          SourceSecurityGroupName:
            Fn::GetAtt:
              - MyELB
              - SourceSecurityGroup.GroupName</code></pre>
    </div>
   <awsdocs-copyright class="copyright-print"></awsdocs-copyright><awsdocs-thumb-feedback right-edge="{{$ctrl.thumbFeedbackRightEdge}}"></awsdocs-thumb-feedback></div><noscript><div><div><div><div id="js_error_message"><p><img src="https://d1ge0kk1l5kms0.cloudfront.net/images/G/01/webservices/console/warning.png" alt="Warning" /> <strong>Javascript is disabled or is unavailable in your browser.</strong></p><p>To use the Amazon Web Services Documentation, Javascript must be enabled. Please refer to your browser's Help pages for instructions.</p></div></div></div></div></noscript><div id="main-col-footer" class="awsui-util-font-size-0"><div id="doc-conventions"><a target="_top" href="/general/latest/gr/docconventions.html">Document Conventions</a></div><div class="prev-next"><div id="previous" class="prev-link" accesskey="p" href="./quickref-ec2-launch-templates.html">Create launch
                templates</div><div id="next" class="next-link" accesskey="n" href="./quickref-ec2-elastic-ip.html">Allocate Elastic IPs</div></div></div><awsdocs-page-utilities></awsdocs-page-utilities></div><div id="quick-feedback-yes" style="display: none;"><div class="title">Did this page help you? - Yes</div><div class="content"><p>Thanks for letting us know we're doing a good job!</p><p>If you've got a moment, please tell us what we did right so we can do more of it.</p><p><awsui-button id="fblink" rel="noopener noreferrer" target="_blank" text="Feedback" click="linkClick($event)" href="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=CloudFormation&amp;topic_url=https://docs.aws.amazon.com/en_us/AWSCloudFormation/latest/UserGuide/quickref-ec2-sg.html"></awsui-button></p></div></div><div id="quick-feedback-no" style="display: none;"><div class="title">Did this page help you? - No</div><div class="content"><p>Thanks for letting us know this page needs work. We're sorry we let you down.</p><p>If you've got a moment, please tell us how we can make the documentation better.</p><p><awsui-button id="fblink" rel="noopener noreferrer" target="_blank" text="Feedback" click="linkClick($event)" href="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=CloudFormation&amp;topic_url=https://docs.aws.amazon.com/en_us/AWSCloudFormation/latest/UserGuide/quickref-ec2-sg.html"></awsui-button></p></div></div></div></body></div></awsdocs-view><div class="page-loading-indicator" id="page-loading-indicator"><awsui-spinner size="large"></awsui-spinner></div></div><div id="tools-panel" dom-region="tools"><awsdocs-tools-panel id="awsdocs-tools-panel"></awsdocs-tools-panel></div></awsui-app-layout><awsdocs-cookie-banner class="doc-cookie-banner"></awsdocs-cookie-banner></div></body></html>