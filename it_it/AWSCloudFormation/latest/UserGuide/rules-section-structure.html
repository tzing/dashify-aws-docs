<!DOCTYPE html>
    <html xmlns="http://www.w3.org/1999/xhtml" lang="it-IT"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Regolamento - AWS CloudFormation</title><meta name="viewport" content="width=device-width,initial-scale=1" /><meta name="assets_root" content="/assets" /><meta name="target_state" content="rules-section-structure" /><meta name="default_state" content="rules-section-structure" /><link rel="icon" type="image/ico" href="/assets/images/favicon.ico" /><link rel="shortcut icon" type="image/ico" href="/assets/images/favicon.ico" /><link rel="canonical" href="https://docs.aws.amazon.com/it_it/AWSCloudFormation/latest/UserGuide/rules-section-structure.html" /><meta name="description" content="Descrive i vincoli dei parametri per le risorse nella sezione Rules di un modello AWS CloudFormation ." /><meta name="deployment_region" content="IAD" /><meta name="product" content="AWS CloudFormation" /><meta name="guide" content="Guida per l'utente" /><meta name="abstract" content="Crea e gestisci le implementazioni AWS dell'infrastruttura in modo prevedibile e ripetuto utilizzando questa guida per AWS CloudFormation l'utente." /><meta name="guide-locale" content="it_it" /><meta name="tocs" content="toc-contents.json" /><link rel="canonical" href="https://docs.aws.amazon.com/it_it/AWSCloudFormation/latest/UserGuide/rules-section-structure.html" /><link rel="alternative" href="https://docs.aws.amazon.com/id_id/AWSCloudFormation/latest/UserGuide/rules-section-structure.html" hreflang="id-id" /><link rel="alternative" href="https://docs.aws.amazon.com/id_id/AWSCloudFormation/latest/UserGuide/rules-section-structure.html" hreflang="id" /><link rel="alternative" href="https://docs.aws.amazon.com/de_de/AWSCloudFormation/latest/UserGuide/rules-section-structure.html" hreflang="de-de" /><link rel="alternative" href="https://docs.aws.amazon.com/de_de/AWSCloudFormation/latest/UserGuide/rules-section-structure.html" hreflang="de" /><link rel="alternative" href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/rules-section-structure.html" hreflang="en-us" /><link rel="alternative" href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/rules-section-structure.html" hreflang="en" /><link rel="alternative" href="https://docs.aws.amazon.com/es_es/AWSCloudFormation/latest/UserGuide/rules-section-structure.html" hreflang="es-es" /><link rel="alternative" href="https://docs.aws.amazon.com/es_es/AWSCloudFormation/latest/UserGuide/rules-section-structure.html" hreflang="es" /><link rel="alternative" href="https://docs.aws.amazon.com/fr_fr/AWSCloudFormation/latest/UserGuide/rules-section-structure.html" hreflang="fr-fr" /><link rel="alternative" href="https://docs.aws.amazon.com/fr_fr/AWSCloudFormation/latest/UserGuide/rules-section-structure.html" hreflang="fr" /><link rel="alternative" href="https://docs.aws.amazon.com/it_it/AWSCloudFormation/latest/UserGuide/rules-section-structure.html" hreflang="it-it" /><link rel="alternative" href="https://docs.aws.amazon.com/it_it/AWSCloudFormation/latest/UserGuide/rules-section-structure.html" hreflang="it" /><link rel="alternative" href="https://docs.aws.amazon.com/ja_jp/AWSCloudFormation/latest/UserGuide/rules-section-structure.html" hreflang="ja-jp" /><link rel="alternative" href="https://docs.aws.amazon.com/ja_jp/AWSCloudFormation/latest/UserGuide/rules-section-structure.html" hreflang="ja" /><link rel="alternative" href="https://docs.aws.amazon.com/ko_kr/AWSCloudFormation/latest/UserGuide/rules-section-structure.html" hreflang="ko-kr" /><link rel="alternative" href="https://docs.aws.amazon.com/ko_kr/AWSCloudFormation/latest/UserGuide/rules-section-structure.html" hreflang="ko" /><link rel="alternative" href="https://docs.aws.amazon.com/pt_br/AWSCloudFormation/latest/UserGuide/rules-section-structure.html" hreflang="pt-br" /><link rel="alternative" href="https://docs.aws.amazon.com/pt_br/AWSCloudFormation/latest/UserGuide/rules-section-structure.html" hreflang="pt" /><link rel="alternative" href="https://docs.aws.amazon.com/zh_cn/AWSCloudFormation/latest/UserGuide/rules-section-structure.html" hreflang="zh-cn" /><link rel="alternative" href="https://docs.aws.amazon.com/zh_tw/AWSCloudFormation/latest/UserGuide/rules-section-structure.html" hreflang="zh-tw" /><link rel="alternative" href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/rules-section-structure.html" hreflang="x-default" /><meta name="feedback-item" content="CloudFormation" /><meta name="this_doc_product" content="AWS CloudFormation" /><meta name="this_doc_guide" content="Guida per l'utente" /><script defer="" src="/assets/r/vendor4.js?version=2021.12.02"></script><script defer="" src="/assets/r/vendor3.js?version=2021.12.02"></script><script defer="" src="/assets/r/vendor1.js?version=2021.12.02"></script><script defer="" src="/assets/r/awsdocs-common.js?version=2021.12.02"></script><script defer="" src="/assets/r/awsdocs-doc-page.js?version=2021.12.02"></script><link href="/assets/r/vendor4.css?version=2021.12.02" rel="stylesheet" /><link href="/assets/r/awsdocs-common.css?version=2021.12.02" rel="stylesheet" /><link href="/assets/r/awsdocs-doc-page.css?version=2021.12.02" rel="stylesheet" /><script async="" id="awsc-panorama-bundle" type="text/javascript" src="https://prod.pa.cdn.uis.awsstatic.com/panorama-nav-init.js" data-config="{'appEntity':'aws-documentation','region':'us-east-1','service':'cloudformation'}"></script><meta id="panorama-serviceSubSection" value="Guida per l'utente" /><meta id="panorama-serviceConsolePage" value="Regolamento" /></head><body class="awsdocs awsui"><div class="awsdocs-container"><awsdocs-header></awsdocs-header><awsui-app-layout id="app-layout" class="awsui-util-no-gutters" ng-controller="ContentController as $ctrl" header-selector="awsdocs-header" navigation-hide="false" navigation-width="$ctrl.navWidth" navigation-open="$ctrl.navOpen" navigation-change="$ctrl.onNavChange($event)" tools-hide="$ctrl.hideTools" tools-width="$ctrl.toolsWidth" tools-open="$ctrl.toolsOpen" tools-change="$ctrl.onToolsChange($event)"><div id="guide-toc" dom-region="navigation"><awsdocs-toc></awsdocs-toc></div><div id="main-column" dom-region="content" tabindex="-1"><awsdocs-view class="awsdocs-view"><div id="awsdocs-content"><head><title>Regolamento - AWS CloudFormation</title><meta name="rss" content="aws-cloudformation-release-notes.rss" /><meta name="forums" content="http://forums.aws.amazon.com/forum.jspa?forumID=92" /><meta name="feedback" content="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=CloudFormation&amp;topic_url=https://docs.aws.amazon.com/it_it/AWSCloudFormation/latest/UserGuide/rules-section-structure.html" /><meta name="feedback-yes" content="feedbackyes.html?topic_url=https://docs.aws.amazon.com/it_it/AWSCloudFormation/latest/UserGuide/rules-section-structure.html" /><meta name="feedback-no" content="feedbackno.html?topic_url=https://docs.aws.amazon.com/it_it/AWSCloudFormation/latest/UserGuide/rules-section-structure.html" /><meta name="keywords" content="CloudFormation,AWSCloudFormation,provisioning delle risorse,configurazione delle risorse,gestione dell'infrastruttura,CloudFormer,CloudFormation pila,CloudFormation modello,set di modifiche" /><script type="application/ld+json">
{
    "@context" : "https://schema.org",
    "@type" : "BreadcrumbList",
    "itemListElement" : [
      {
        "@type" : "ListItem",
        "position" : 1,
        "name" : "AWS",
        "item" : "https://aws.amazon.com"
      },
      {
        "@type" : "ListItem",
        "position" : 2,
        "name" : "AWS CloudFormation",
        "item" : "https://docs.aws.amazon.com/cloudformation/index.html"
      },
      {
        "@type" : "ListItem",
        "position" : 3,
        "name" : "Guida per l'utente",
        "item" : "https://docs.aws.amazon.com/it_it/AWSCloudFormation/latest/UserGuide"
      },
      {
        "@type" : "ListItem",
        "position" : 4,
        "name" : "Utilizzo dei modelli AWS CloudFormation",
        "item" : "https://docs.aws.amazon.com/it_it/AWSCloudFormation/latest/UserGuide/template-guide.html"
      },
      {
        "@type" : "ListItem",
        "position" : 5,
        "name" : "Anatomia dei modelli",
        "item" : "https://docs.aws.amazon.com/it_it/AWSCloudFormation/latest/UserGuide/template-anatomy.html"
      },
      {
        "@type" : "ListItem",
        "position" : 6,
        "name" : "Regolamento",
        "item" : "https://docs.aws.amazon.com/it_it/AWSCloudFormation/latest/UserGuide/template-anatomy.html"
      }
    ]
}
</script></head><body><div id="main"><div style="display: none"></div><div id="breadcrumbs" class="breadcrumb"><a href="https://aws.amazon.com">AWS</a><a href="/index.html">Documentazione</a><a href="/cloudformation/index.html">AWS CloudFormation</a><a href="Welcome.html">Guida per l'utente</a></div><div id="page-toc-src"><a href="#rules-specific-intrinsic-working-with-rules">Utilizzo delle regole</a><a href="#rules-specific-intrinsic-section-structure">Funzioni intrinseche specifiche delle regole</a><a href="#template-constraint-rules-syntax">Sintassi</a><a href="#template-constraint-rules-example">Esempi</a><a href="#template-cross-parameter-rules-example">Convalida multi-parametro</a></div><div id="page-filters" style="display:none"><filter label="All" id="All"></filter><filter label="JSON" id="JSON"></filter><filter label="YAML" id="YAML"></filter><filter label="Esempio: JSON" id="Esempio: JSON"></filter><filter label="Esempio: YAML" id="Esempio: YAML"></filter></div><div id="main-content" class="awsui-util-container"><div id="main-col-body"><awsdocs-language-banner data-service="$ctrl.pageService"></awsdocs-language-banner><awsui-alert class="awsdocs-page-banner awsui-util-mb-l"><p>Le traduzioni sono generate tramite traduzione automatica. In caso di conflitto tra il contenuto di una traduzione e la versione originale in Inglese, quest'ultima prevarrà.</p></awsui-alert><h1 class="topictitle" id="rules-section-structure">Regolamento</h1><div class="awsdocs-page-header-container"><awsdocs-page-header></awsdocs-page-header><awsdocs-filter-selector id="awsdocs-filter-selector"></awsdocs-filter-selector></div><p>La sezione <code class="code">Rules</code> facoltativa convalida un parametro o una combinazione di parametri trasferiti a un modello durante la creazione o l'aggiornamento dello stack. Per utilizzare le regole del modello, dichiarare esplicitamente <code class="code">Rules</code> nel modello seguito da un'asserzione. Utilizzare la sezione delle regole per convalidare i valori dei parametri prima di creare o aggiornare le risorse.</p>
        <h2 id="rules-specific-intrinsic-working-with-rules">Utilizzo delle regole</h2>
        <p>Ogni regola di modello è composta da due proprietà:</p>
        <div class="itemizedlist">
             
             
        <ul class="itemizedlist"><li class="listitem">
                <p>La <em>condizione della regola</em> (facoltativa): determina quando una regola viene applicata.</p>
            </li><li class="listitem">
                <p>Le <em>asserzioni</em> (obbligatorie): descrivono quali valori gli utenti possono specificare per un particolare parametro.</p>
            </li></ul></div>
        <p>Una regola può includere una proprietà <code class="code">RuleCondition</code> e deve includere una proprietà <code class="code">Assertions</code>. Per ogni regola, è possibile definire una sola condizione della regola. È possibile definire una o più asserzioni all'interno della proprietà <code class="code">Assertions</code>. Se non definisci una condizione di regola, le asserzioni della regola sono sempre attivate.</p>
     
            <h2 id="rules-specific-intrinsic-section-structure">Funzioni intrinseche specifiche delle regole</h2>
        <p>Per definire una condizione e asserzioni di regola, è necessario utilizzare <em>funzioni intrinseche specifiche delle regole</em>, ovvero funzioni che possono essere utilizzate solo nella sezione <code class="code">Rules</code> di un modello. È possibile nidificare le funzioni, ma il risultato finale di una condizione o di un'asserzione di regola deve essere true o false.</p>
        <p>Puoi utilizzare le seguenti funzioni intrinseche specifiche delle regole per definire condizioni e asserzioni di regola:</p>
        <div class="itemizedlist">
             
             
             
             
             
             
             
             
             
             
             
        <ul class="itemizedlist"><li class="listitem">
                <p><code class="code"><a href="./intrinsic-function-reference-conditions.html#intrinsic-function-reference-conditions-and">Fn::And</a></code></p>
            </li><li class="listitem">
                <p><code class="code"><a href="./intrinsic-function-reference-rules.html#fn-contains">Fn::Contains</a></code></p>
            </li><li class="listitem">
                <p><code class="code"><a href="./intrinsic-function-reference-rules.html#fn-eachmemberequals">Fn::EachMemberEquals</a></code></p>
            </li><li class="listitem">
                <p><code class="code"><a href="./intrinsic-function-reference-rules.html#fn-eachmemberin">Fn::EachMemberIn</a></code></p>
            </li><li class="listitem">
                <p><code class="code"><a href="./intrinsic-function-reference-conditions.html#intrinsic-function-reference-conditions-equals">Fn::Equals</a></code></p>
            </li><li class="listitem">
                <p><code class="code"><a href="./intrinsic-function-reference-conditions.html#intrinsic-function-reference-conditions-if">Fn::If</a></code></p>
            </li><li class="listitem">
                <p><code class="code"><a href="./intrinsic-function-reference-conditions.html#intrinsic-function-reference-conditions-not">Fn::Not</a></code></p>
            </li><li class="listitem">
                <p><code class="code"><a href="./intrinsic-function-reference-conditions.html#intrinsic-function-reference-conditions-or">Fn::Or</a></code></p>
            </li><li class="listitem">
                <p><code class="code"><a href="./intrinsic-function-reference-rules.html#fn-refall">Fn::RefAll</a></code></p>
            </li><li class="listitem">
                <p><code class="code"><a href="./intrinsic-function-reference-rules.html#fn-valueof">Fn::ValueOf</a></code></p>
            </li><li class="listitem">
                <p><code class="code"><a href="./intrinsic-function-reference-rules.html#fn-valueofall">Fn::ValueOfAll</a></code></p>
            </li></ul></div>
        <p>Le funzioni intrinseche specifiche della regola vengono utilizzate nella condizione o nelle asserzioni di una regola. La proprietà condition determina se AWS CloudFormation applica le asserzioni. Se la condizione restituisce a<code class="code">true</code>, AWS CloudFormation valuta le asserzioni per verificare se il valore di un parametro è valido quando un prodotto fornito viene creato o aggiornato. Se il valore di un parametro non è valido, AWS CloudFormation non crea o aggiorna lo stack. Se la condizione restituisce un risultato positivo<code class="code">false</code>, AWS CloudFormation non verifica il valore del parametro e procede con l'operazione di stack.</p>
     
        <h2 id="template-constraint-rules-syntax">Sintassi</h2>
        <div id="JSON" name="JSON" class="section langfilter">
            <h3 id="rules-section-structure-syntax.json">JSON</h3>
            <p>La sezione <code class="code">Rules</code> di un modello comporta il nome di chiave <code class="code">Rules</code>, seguito da un segno di due punti. Usa le parentesi graffe per racchiudere tutte le dichiarazioni degli output di regola. Se dichiari più regole, queste sono delimitate da virgole. Per ogni regola, dichiari un nome logico tra virgolette seguito da un segno di due punti e parentesi graffe che racchiudono la condizione e le asserzioni di regola.</p>
            <pre class="programlisting"><div class="code-btn-container"></div><code class="json "><span>{</span>
    "Rules": <span>{</span>
        "Rule01": <span>{</span>
            "RuleCondition": <span>{</span>
                "rule-specific intrinsic function": "Value01"
            },
            "Assertions": [
                <span>{</span>
                    "Assert": <span>{</span>
                        "rule-specific intrinsic function": "Value02"
                    },
                    "AssertDescription": "Information about this assert"
                },
                <span>{</span>
                    "Assert": <span>{</span>
                        "rule-specific intrinsic function": "Value03"
                    },
                    "AssertDescription": "Information about this assert"
                }
            ]
        },
        "Rule02": <span>{</span>
            "Assertions": [
                <span>{</span>
                    "Assert": <span>{</span>
                        "rule-specific intrinsic function": "Value04"
                    },
                    "AssertDescription": "Information about this assert"
                }
            ]
        }
    }
}</code></pre>
        </div>
        <div id="YAML" name="YAML" class="section langfilter">
            <h3 id="rules-section-structure-syntax.yaml">YAML</h3>
            <pre class="programlisting"><div class="code-btn-container"></div><code class="yaml ">Rules:
  Rule01:
    RuleCondition:
      rule-specific intrinsic function: Value01
    Assertions:
      - Assert:
          rule-specific intrinsic function: Value02
        AssertDescription: Information about this assert
      - Assert:
          rule-specific intrinsic function: Value03
        AssertDescription: Information about this assert
  Rule02:
    Assertions:
      - Assert:
          rule-specific intrinsic function: Value04
        AssertDescription: Information about this assert</code></pre>
        </div>



     
        <h2 id="template-constraint-rules-example">Esempi</h2>
         
            <h3 id="template-constraint-rules-example-verify">Verifica condizionale di un valore di parametro</h3>

            <p>Nell'esempio seguente, le due regole verificano il valore del parametro <code class="code">InstanceType</code>. A seconda del valore del parametro Environment (<code class="code">test</code> o <code class="code">prod</code>), l'utente deve specificare <code class="code">a1.medium</code> o <code class="code">a1.large</code> per il parametro <code class="code">InstanceType</code>. I parametri <code class="code">InstanceType</code> e <code class="code">Environment</code> devono essere dichiarati nella sezione <code class="code">Parameters</code> dello stesso modello.</p>
            <div id="Esempio: JSON" name="Esempio: JSON" class="section langfilter">
                <h4 id="rules-section-example-conditionally-verify.json">Esempio: JSON</h4>
                <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copia"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
    "Rules": <span>{</span>
        "testInstanceType": <span>{</span>
            "RuleCondition": <span>{</span>
                "Fn::Equals": [
                    <span>{</span>
                        "Ref": "Environment"
                    },
                    "test"
                ]
            },
            "Assertions": [
                <span>{</span>
                    "Assert": <span>{</span>
                        "Fn::Contains": [
                            [
                                "a1.medium"
                            ],
                            <span>{</span>
                                "Ref": "InstanceType"
                            }
                        ]
                    },
                    "AssertDescription": "For a test environment, the instance type must be a1.medium"
                }
            ]
        },
        "prodInstanceType": <span>{</span>
            "RuleCondition": <span>{</span>
                "Fn::Equals": [
                    <span>{</span>
                        "Ref": "Environment"
                    },
                    "prod"
                ]
            },
            "Assertions": [
                <span>{</span>
                    "Assert": <span>{</span>
                        "Fn::Contains": [
                            [
                                "a1.large"
                            ],
                            <span>{</span>
                                "Ref": "InstanceType"
                            }
                        ]
                    },
                    "AssertDescription": "For a production environment, the instance type must be a1.large"
                }
            ]
        }
    }
}</code></pre>
            </div>
            <div id="Esempio: YAML" name="Esempio: YAML" class="section langfilter">
                <h4 id="rules-section-example-conditionally-verify-2.yaml">Esempio: YAML</h4>
                <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copia"><awsui-icon name="copy"></awsui-icon></div></div><code class="yaml ">Rules:
  testInstanceType:
    RuleCondition: !Equals 
      - !Ref Environment
      - test
    Assertions:
      - Assert:
          'Fn::Contains':
            - - a1.medium
            - !Ref InstanceType
        AssertDescription: 'For a test environment, the instance type must be a1.medium'
  prodInstanceType:
    RuleCondition: !Equals 
      - !Ref Environment
      - prod
    Assertions:
      - Assert:
          'Fn::Contains':
            - - a1.large
            - !Ref InstanceType
        AssertDescription: 'For a production environment, the instance type must be a1.large'</code></pre>
            </div>
         
     
        <h2 id="template-cross-parameter-rules-example">Convalida multi-parametro</h2>
        <p>Nell'esempio di modello seguente, viene creato un sito web campione che utilizza Amazon EC2 Auto Scaling e Elastic Load Balancing ed è configurato per l'utilizzo di più zone di disponibilità. Il modello contiene anche  CloudWatch  allarmi che eseguono politiche di scalabilità per aggiungere o rimuovere istanze dal gruppo Auto Scaling quando vengono superate le soglie definite. Questo modello consente di creare una o più istanze Amazon EC2.</p>
        <div class="awsdocs-note"><div class="awsdocs-note-title"><awsui-icon name="status-info" variant="link"></awsui-icon><h6>Nota</h6></div><div class="awsdocs-note-text"><p>Se crei uno stack da questo modello, ti verranno AWS addebitate le risorse utilizzate.</p></div></div>

        <div id="Esempio: JSON" name="Esempio: JSON" class="section langfilter">
            <h3 id="rules-section-example-cross-parameter-validation.json">Esempio: JSON</h3>
            <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copia"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
    "AWSTemplateFormatVersion": "2010-09-09",
    "Description": "AWS CloudFormation Sample Template for using Assertions: Create a load balanced, Auto Scaled sample website where the instances are locked down to only accept traffic from the load balancer. This example creates an Auto Scaling group behind a load balancer with a health check. The web site is available on port 80 or 443 based on the input.",
    "Parameters": <span>{</span>
        "VpcId": <span>{</span>
            "Type": "AWS::EC2::VPC::Id",
            "Description": "VpcId of your existing Virtual Private Cloud (VPC)",
            "ConstraintDescription": "must be the VPC Id of an existing Virtual Private Cloud."
        },
        "Subnets": <span>{</span>
            "Type": "List&lt;AWS::EC2::Subnet::Id&gt;",
            "Description": "The list of SubnetIds in your Virtual Private Cloud (VPC)",
            "ConstraintDescription": "must be a list of at least two existing subnets associated with at least two different availability zones. They should be residing in the selected Virtual Private Cloud."
        },
        "InstanceType": <span>{</span>
            "Description": "WebServer EC2 instance type",
            "Type": "String",
            "Default": "t2.small",
            "AllowedValues": [
                "t2.nano",
                "t2.micro",
                "t2.small",
                "t2.medium",
                "t2.large",
                "m4.large",
                "m4.xlarge",
                "m4.2xlarge",
                "m4.4xlarge",
                "m4.10xlarge",
                "m3.medium",
                "m3.large",
                "m3.xlarge",
                "m3.2xlarge",
                "c4.large",
                "c4.xlarge",
                "c4.2xlarge",
                "c4.4xlarge",
                "c4.8xlarge",
                "c3.large",
                "c3.xlarge",
                "c3.2xlarge",
                "c3.4xlarge",
                "c3.8xlarge",
                "r3.large",
                "r3.xlarge"
            ],
            "ConstraintDescription": "must be a valid EC2 instance type."
        },
        "KeyName": <span>{</span>
            "Description": "Name of an existing EC2 KeyPair to enable SSH access to the instances",
            "Type": "AWS::EC2::KeyPair::KeyName",
            "ConstraintDescription": "must be the name of an existing EC2 KeyPair."
        },
        "SSHLocation": <span>{</span>
            "Description": "The IP address range that can be used to SSH to the EC2 instances",
            "Type": "String",
            "MinLength": "9",
            "MaxLength": "18",
            "Default": "0.0.0.0/0",
            "AllowedPattern": "(\\d<span>{</span>1,3})\\.(\\d<span>{</span>1,3})\\.(\\d<span>{</span>1,3})\\.(\\d<span>{</span>1,3})/(\\d<span>{</span>1,2})",
            "ConstraintDescription": "must be a valid IP CIDR range of the form x.x.x.x/x."
        },
        "UseSSL": <span>{</span>
            "AllowedValues": [
                "Yes",
                "No"
            ],
            "ConstraintDescription": "Select Yes to create a HTTPS Listener",
            "Default": "No",
            "Description": "Select \"Yes\" to implement SSL, \"No\" to skip (default).",
            "Type": "String"
        },
        "ALBSSLCertificateARN": <span>{</span>
            "Default": "",
            "Description": "[Optional] The ARN of the SSL certificate to be used for the Application Load Balancer",
            "Type": "String"
        },
        "HostedZoneName": <span>{</span>
            "AllowedPattern": "^$|(([a-zA-Z0-9]|[a-zA-Z0-9][a-zA-Z0-9\\-]*[a-zA-Z0-9])\\.)*([A-Za-z0-9]|[A-Za-z0-9][A-Za-z0-9\\-]*[A-Za-z0-9])$",
            "Default": "",
            "Description": "[Optional] The domain name of a valid Hosted Zone on AWS.",
            "Type": "String"
        }
    },
    "Conditions": <span>{</span>
        "UseALBSSL": <span>{</span>
            "Fn::Not": [
                <span>{</span>
                    "Fn::Equals": [
                        <span>{</span>
                            "Ref": "UseSSL"
                        },
                        "Yes"
                    ]
                }
            ]
        }
    },
    "Rules": <span>{</span>
        "SubnetsInVPC": <span>{</span>
            "Assertions": [
                <span>{</span>
                    "Assert": <span>{</span>
                        ""Fn::EachMemberEquals": [
                            <span>{</span>
                                "Fn::ValueOf": [
                                    "Subnets",
                                    "VpcId"
                                ]
                            },
                            <span>{</span>
                                "Ref": "VpcId"
                            }
                        ]
                    },
                    "AssertDescription": "All subnets must in the VPC"
                }
            ]
        },
        "ValidateHostedZone": <span>{</span>
            "RuleCondition": <span>{</span>
                "Fn::Equals": [
                    <span>{</span>
                        "Ref": "UseSSL"
                    },
                    "Yes"
                ]
            },
            "Assertions": [
                <span>{</span>
                    "Assert": <span>{</span>
                        "Fn::Not": [
                            <span>{</span>
                                "Fn::Equals": [
                                    <span>{</span>
                                        "Ref": "ALBSSLCertificateARN"
                                    },
                                    ""
                                ]
                            }
                        ]
                    },
                    "AssertDescription": "ACM Certificate value cannot be empty if SSL is required"
                },
                <span>{</span>
                    "Assert": <span>{</span>
                        "Fn::Not": [
                            <span>{</span>
                                "Fn::Equals": [
                                    <span>{</span>
                                        "Ref": "HostedZoneName"
                                    },
                                    ""
                                ]
                            }
                        ]
                    },
                    "AssertDescription": "Route53 Hosted Zone Name is mandatory when SSL is required"
                }
            ]
        }
    },
    "Mappings": <span>{</span>
        "AWSAMIRegionMap": <span>{</span>
            "AMI": <span>{</span>
                "AMZNLINUXHVM": "amzn-ami-hvm-2017.09.1.20171120-x86_64-gp2"
            },
            "ap-northeast-1": <span>{</span>
                "AMZNLINUXHVM": "ami-da9e2cbc"
            },
            "ap-northeast-2": <span>{</span>
                "AMZNLINUXHVM": "ami-1196317f"
            },
            "ap-south-1": <span>{</span>
                "AMZNLINUXHVM": "ami-d5c18eba"
            },
            "ap-southeast-1": <span>{</span>
                "AMZNLINUXHVM": "ami-c63d6aa5"
            },
            "ap-southeast-2": <span>{</span>
                "AMZNLINUXHVM": "ami-ff4ea59d"
            },
            "ca-central-1": <span>{</span>
                "AMZNLINUXHVM": "ami-d29e25b6"
            },
            "eu-central-1": <span>{</span>
                "AMZNLINUXHVM": "ami-bf2ba8d0"
            },
            "eu-west-1": <span>{</span>
                "AMZNLINUXHVM": "ami-1a962263"
            },
            "eu-west-2": <span>{</span>
                "AMZNLINUXHVM": "ami-e7d6c983"
            },
            "sa-east-1": <span>{</span>
                "AMZNLINUXHVM": "ami-286f2a44"
            },
            "us-east-1": <span>{</span>
                "AMZNLINUXHVM": "ami-55ef662f"
            },
            "us-east-2": <span>{</span>
                "AMZNLINUXHVM": "ami-15e9c770"
            },
            "us-west-1": <span>{</span>
                "AMZNLINUXHVM": "ami-a51f27c5"
            },
            "us-west-2": <span>{</span>
                "AMZNLINUXHVM": "ami-bf4193c7"
            }
        }
    },
    "Resources": <span>{</span>
        "WebServerGroup": <span>{</span>
            "Type": "AWS::AutoScaling::AutoScalingGroup",
            "Properties": <span>{</span>
                "VPCZoneIdentifier": <span>{</span>
                    "Ref": "Subnets"
                },
                "LaunchConfigurationName": <span>{</span>
                    "Ref": "LaunchConfig"
                },
                "MinSize": "2",
                "MaxSize": "2",
                "TargetGroupARNs": [
                    <span>{</span>
                        "Ref": "ALBTargetGroup"
                    }
                ]
            },
            "CreationPolicy": <span>{</span>
                "ResourceSignal": <span>{</span>
                    "Timeout": "PT15M"
                }
            },
            "UpdatePolicy": <span>{</span>
                "AutoScalingRollingUpdate": <span>{</span>
                    "MinInstancesInService": "1",
                    "MaxBatchSize": "1",
                    "PauseTime": "PT15M",
                    "WaitOnResourceSignals": "true"
                }
            }
        },
        "LaunchConfig": <span>{</span>
            "Type": "AWS::AutoScaling::LaunchConfiguration",
            "Metadata": <span>{</span>
                "Comment": "Install a simple application",
                "AWS::CloudFormation::Init": <span>{</span>
                    "config": <span>{</span>
                        "packages": <span>{</span>
                            "yum": <span>{</span>
                                "httpd": []
                            }
                        },
                        "files": <span>{</span>
                            "/var/www/html/index.html": <span>{</span>
                                "content": <span>{</span>
                                    "Fn::Join": [
                                        "\n",
                                        [
                                            "&lt;h1&gt;Congratulations, you have successfully launched the AWS CloudFormation sample.&lt;h1&gt;"
                                        ]
                                    ]
                                },
                                "mode": "000644",
                                "owner": "root",
                                "group": "root"
                            },
                            "/etc/cfn/cfn-hup.conf": <span>{</span>
                                "content": <span>{</span>
                                    "Fn::Join": [
                                        "",
                                        [
                                            "[main]\n",
                                            "stack=",
                                            <span>{</span>
                                                "Ref": "AWS::StackId"
                                            },
                                            "\n",
                                            "region=",
                                            <span>{</span>
                                                "Ref": "AWS::Region"
                                            },
                                            "\n"
                                        ]
                                    ]
                                },
                                "mode": "000400",
                                "owner": "root",
                                "group": "root"
                            },
                            "/etc/cfn/hooks.d/cfn-auto-reloader.conf": <span>{</span>
                                "content": <span>{</span>
                                    "Fn::Join": [
                                        "",
                                        [
                                            "[cfn-auto-reloader-hook]\n",
                                            "triggers=post.update\n",
                                            "path=Resources.LaunchConfig.Metadata.AWS::CloudFormation::Init\n",
                                            "action=/opt/aws/bin/cfn-init -v ",
                                            "         --stack ",
                                            <span>{</span>
                                                "Ref": "AWS::StackName"
                                            },
                                            "         --resource LaunchConfig ",
                                            "         --region ",
                                            <span>{</span>
                                                "Ref": "AWS::Region"
                                            },
                                            "\n",
                                            "runas=root\n"
                                        ]
                                    ]
                                },
                                "mode": "000400",
                                "owner": "root",
                                "group": "root"
                            }
                        },
                        "services": <span>{</span>
                            "sysvinit": <span>{</span>
                                "httpd": <span>{</span>
                                    "enabled": "true",
                                    "ensureRunning": "true"
                                },
                                "cfn-hup": <span>{</span>
                                    "enabled": "true",
                                    "ensureRunning": "true",
                                    "files": [
                                        "/etc/cfn/cfn-hup.conf",
                                        "/etc/cfn/hooks.d/cfn-auto-reloader.conf"
                                    ]
                                }
                            }
                        }
                    }
                }
            },
            "Properties": <span>{</span>
                "ImageId": <span>{</span>
                    "Fn::FindInMap": [
                        "AWSAMIRegionMap",
                        <span>{</span>
                            "Ref": "AWS::Region"
                        },
                        "AMZNLINUXHVM"
                    ]
                },
                "SecurityGroups": [
                    <span>{</span>
                        "Ref": "InstanceSecurityGroup"
                    }
                ],
                "InstanceType": <span>{</span>
                    "Ref": "InstanceType"
                },
                "KeyName": <span>{</span>
                    "Ref": "KeyName"
                },
                "UserData": <span>{</span>
                    "Fn::Base64": <span>{</span>
                        "Fn::Join": [
                            "",
                            [
                                "#!/bin/bash -xe\n",
                                "yum update -y aws-cfn-bootstrap\n",
                                "/opt/aws/bin/cfn-init -v ",
                                "         --stack ",
                                <span>{</span>
                                    "Ref": "AWS::StackName"
                                },
                                "         --resource LaunchConfig ",
                                "         --region ",
                                <span>{</span>
                                    "Ref": "AWS::Region"
                                },
                                "\n",
                                "/opt/aws/bin/cfn-signal -e $? ",
                                "         --stack ",
                                <span>{</span>
                                    "Ref": "AWS::StackName"
                                },
                                "         --resource WebServerGroup ",
                                "         --region ",
                                <span>{</span>
                                    "Ref": "AWS::Region"
                                },
                                "\n"
                            ]
                        ]
                    }
                }
            }
        },
        "ELBSecurityGroup": <span>{</span>
            "Type": "AWS::EC2::SecurityGroup",
            "Properties": <span>{</span>
                "GroupDescription": "Allow access to the ELB",
                "VpcId": <span>{</span>
                    "Ref": "VpcId"
                },
                "SecurityGroupIngress": [
                    <span>{</span>
                        "Fn::If": [
                            "UseALBSSL",
                            <span>{</span>
                                "IpProtocol": "tcp",
                                "FromPort": 443,
                                "ToPort": 443,
                                "CidrIp": "0.0.0.0/0"
                            },
                            <span>{</span>
                                "IpProtocol": "tcp",
                                "FromPort": 80,
                                "ToPort": 80,
                                "CidrIp": "0.0.0.0/0"
                            }
                        ]
                    }
                ]
            }
        },
        "ApplicationLoadBalancer": <span>{</span>
            "Type": "AWS::ElasticLoadBalancingV2::LoadBalancer",
            "Properties": <span>{</span>
                "Subnets": <span>{</span>
                    "Ref": "Subnets"
                },
                "SecurityGroups": [
                    <span>{</span>
                        "Ref": "ELBSecurityGroup"
                    }
                ]
            }
        },
        "ALBListener": <span>{</span>
            "Type": "AWS::ElasticLoadBalancingV2::Listener",
            "Properties": <span>{</span>
                "DefaultActions": [
                    <span>{</span>
                        "Type": "forward",
                        "TargetGroupArn": <span>{</span>
                            "Ref": "ALBTargetGroup"
                        }
                    }
                ],
                "LoadBalancerArn": <span>{</span>
                    "Ref": "ApplicationLoadBalancer"
                },
                "Port": <span>{</span>
                    "Fn::If": [
                        "UseALBSSL",
                        443,
                        80
                    ]
                },
                "Protocol": <span>{</span>
                    "Fn::If": [
                        "UseALBSSL",
                        "HTTPS",
                        "HTTP"
                    ]
                },
                "Certificates": [
                    <span>{</span>
                        "Fn::If": [
                            "UseALBSSL",
                            <span>{</span>
                                "CertificateArn": <span>{</span>
                                    "Ref": "ALBSSLCertificateARN"
                                }
                            },
                            <span>{</span>
                                "Ref": "AWS::NoValue"
                            }
                        ]
                    }
                ]
            }
        },
        "ALBTargetGroup": <span>{</span>
            "Type": "AWS::ElasticLoadBalancingV2::TargetGroup",
            "Properties": <span>{</span>
                "HealthCheckIntervalSeconds": 30,
                "HealthCheckTimeoutSeconds": 5,
                "HealthyThresholdCount": 3,
                "Port": 80,
                "Protocol": "HTTP",
                "UnhealthyThresholdCount": 5,
                "VpcId": <span>{</span>
                    "Ref": "VpcId"
                }
            }
        },
        "InstanceSecurityGroup": <span>{</span>
            "Type": "AWS::EC2::SecurityGroup",
            "Properties": <span>{</span>
                "GroupDescription": "Enable SSH access and HTTP access on the inbound port",
                "SecurityGroupIngress": [
                    <span>{</span>
                        "IpProtocol": "tcp",
                        "FromPort": 80,
                        "ToPort": 80,
                        "SourceSecurityGroupId": <span>{</span>
                            "Fn::Select": [
                                0,
                                <span>{</span>
                                    "Fn::GetAtt": [
                                        "ApplicationLoadBalancer",
                                        "SecurityGroups"
                                    ]
                                }
                            ]
                        }
                    },
                    <span>{</span>
                        "IpProtocol": "tcp",
                        "FromPort": 22,
                        "ToPort": 22,
                        "CidrIp": <span>{</span>
                            "Ref": "SSHLocation"
                        }
                    }
                ],
                "VpcId": <span>{</span>
                    "Ref": "VpcId"
                }
            }
        },
        "RecordSet": <span>{</span>
            "Type": "AWS::Route53::RecordSetGroup",
            "Condition": "UseALBSSL",
            "Properties": <span>{</span>
                "HostedZoneName": <span>{</span>
                    "Fn::Join": [
                        "",
                        [
                            <span>{</span>
                                "Ref": "HostedZoneName"
                            },
                            "."
                        ]
                    ]
                },
                "RecordSets": [
                    <span>{</span>
                        "Name": <span>{</span>
                            "Fn::Join": [
                                "",
                                [
                                    <span>{</span>
                                        "Fn::Select": [
                                            "0",
                                            <span>{</span>
                                                "Fn::Split": [
                                                    ".",
                                                    <span>{</span>
                                                        "Fn::GetAtt": [
                                                            "ApplicationLoadBalancer",
                                                            "DNSName"
                                                        ]
                                                    }
                                                ]
                                            }
                                        ]
                                    },
                                    ".",
                                    <span>{</span>
                                        "Ref": "HostedZoneName"
                                    },
                                    "."
                                ]
                            ]
                        },
                        "Type": "A",
                        "AliasTarget": <span>{</span>
                            "DNSName": <span>{</span>
                                "Fn::GetAtt": [
                                    "ApplicationLoadBalancer",
                                    "DNSName"
                                ]
                            },
                            "EvaluateTargetHealth": true,
                            "HostedZoneId": <span>{</span>
                                "Fn::GetAtt": [
                                    "ApplicationLoadBalancer",
                                    "CanonicalHostedZoneID"
                                ]
                            }
                        }
                    }
                ]
            }
        }
    },
    "Outputs": <span>{</span>
        "URL": <span>{</span>
            "Description": "URL of the website",
            "Value": <span>{</span>
                "Fn::Join": [
                    "",
                    [
                        <span>{</span>
                            "Fn::If": [
                                "UseALBSSL",
                                <span>{</span>
                                    "Fn::Join": [
                                        "",
                                        [
                                            "https://",
                                            <span>{</span>
                                                "Fn::Join": [
                                                    "",
                                                    [
                                                        <span>{</span>
                                                            "Fn::Select": [
                                                                "0",
                                                                <span>{</span>
                                                                    "Fn::Split": [
                                                                        ".",
                                                                        <span>{</span>
                                                                            "Fn::GetAtt": [
                                                                                "ApplicationLoadBalancer",
                                                                                "DNSName"
                                                                            ]
                                                                        }
                                                                    ]
                                                                }
                                                            ]
                                                        },
                                                        ".",
                                                        <span>{</span>
                                                            "Ref": "HostedZoneName"
                                                        },
                                                        "."
                                                    ]
                                                ]
                                            }
                                        ]
                                    ]
                                },
                                <span>{</span>
                                    "Fn::Join": [
                                        "",
                                        [
                                            "http://",
                                            <span>{</span>
                                                "Fn::GetAtt": [
                                                    "ApplicationLoadBalancer",
                                                    "DNSName"
                                                ]
                                            }
                                        ]
                                    ]
                                }
                            ]
                        }
                    ]
                ]
            }
        }
    }
}</code></pre>
        </div>
        <div id="Esempio: YAML" name="Esempio: YAML" class="section langfilter">
            <h3 id="rules-section-example-syntax.yaml">Esempio: YAML</h3>
            <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copia"><awsui-icon name="copy"></awsui-icon></div></div><code class="yaml ">AWSTemplateFormatVersion: 2010-09-09
Description: &gt;-
  AWS CloudFormation Sample Template for using Assertions: Create a load balanced,
  Auto Scaled sample website where the instances are locked down to only accept
  traffic from the load balancer. This example creates an Auto Scaling group
  behind a load balancer with a health check. The web site is available on port
  80 or 443 based on the input.
Parameters:
  VpcId:
    Type: 'AWS::EC2::VPC::Id'
    Description: VpcId of your existing Virtual Private Cloud (VPC)
    ConstraintDescription: must be the VPC Id of an existing Virtual Private Cloud.
  Subnets:
    Type: 'List&lt;AWS::EC2::Subnet::Id&gt;'
    Description: The list of SubnetIds in your Virtual Private Cloud (VPC)
    ConstraintDescription: &gt;-
      must be a list of at least two existing subnets associated with at least
      two different availability zones. They should be residing in the selected
      Virtual Private Cloud.
  InstanceType:
    Description: WebServer EC2 instance type
    Type: String
    Default: t2.small
    AllowedValues:
      - t2.nano
      - t2.micro
      - t2.small
      - t2.medium
      - t2.large
      - m4.large
      - m4.xlarge
      - m4.2xlarge
      - m4.4xlarge
      - m4.10xlarge
      - m3.medium
      - m3.large
      - m3.xlarge
      - m3.2xlarge
      - c4.large
      - c4.xlarge
      - c4.2xlarge
      - c4.4xlarge
      - c4.8xlarge
      - c3.large
      - c3.xlarge
      - c3.2xlarge
      - c3.4xlarge
      - c3.8xlarge
      - r3.large
      - r3.xlarge
    ConstraintDescription: must be a valid EC2 instance type.
  KeyName:
    Description: Name of an existing EC2 KeyPair to enable SSH access to the instances
    Type: 'AWS::EC2::KeyPair::KeyName'
    ConstraintDescription: must be the name of an existing EC2 KeyPair.
  SSHLocation:
    Description: The IP address range that can be used to SSH to the EC2 instances
    Type: String
    MinLength: '9'
    MaxLength: '18'
    Default: 0.0.0.0/0
    AllowedPattern: '(\d<span>{</span>1,3})\.(\d<span>{</span>1,3})\.(\d<span>{</span>1,3})\.(\d<span>{</span>1,3})/(\d<span>{</span>1,2})'
    ConstraintDescription: must be a valid IP CIDR range of the form x.x.x.x/x.
  UseSSL:
    AllowedValues:
      - 'Yes'
      - 'No'
    ConstraintDescription: Select Yes to create a HTTPS Listener
    Default: 'No'
    Description: 'Select "Yes" to implement SSL, "No" to skip (default).'
    Type: String
  ALBSSLCertificateARN:
    Default: ''
    Description: &gt;-
      [Optional] The ARN of the SSL certificate to be used for the Application
      Load Balancer
    Type: String
  HostedZoneName:
    AllowedPattern: &gt;-
      ^$|(([a-zA-Z0-9]|[a-zA-Z0-9][a-zA-Z0-9\-]*[a-zA-Z0-9])\.)*([A-Za-z0-9]|[A-Za-z0-9][A-Za-z0-9\-]*[A-Za-z0-9])$
    Default: ''
    Description: '[Optional] The domain name of a valid Hosted Zone on AWS.'
    Type: String
Conditions:
  UseALBSSL: !Not 
    - !Equals 
      - !Ref UseSSL
      - 'Yes'
Rules:
  SubnetsInVPC:
    Assertions:
      - Assert:
          'Fn::EachMemberEquals':
            - 'Fn::ValueOf':
                - Subnets
                - VpcId
            - Ref: VpcId
        AssertDescription: All subnets must in the VPC
  ValidateHostedZone:
    RuleCondition: !Equals 
      - !Ref UseSSL
      - 'Yes'
    Assertions:
      - Assert: !Not 
          - !Equals 
            - !Ref ALBSSLCertificateARN
            - ''
        AssertDescription: ACM Certificate value cannot be empty if SSL is required
      - Assert: !Not 
          - !Equals 
            - !Ref HostedZoneName
            - ''
        AssertDescription: Route53 Hosted Zone Name is mandatory when SSL is required
Mappings:
  AWSAMIRegionMap:
    AMI:
      AMZNLINUXHVM: amzn-ami-hvm-2017.09.1.20171120-x86_64-gp2
    ap-northeast-1:
      AMZNLINUXHVM: ami-da9e2cbc
    ap-northeast-2:
      AMZNLINUXHVM: ami-1196317f
    ap-south-1:
      AMZNLINUXHVM: ami-d5c18eba
    ap-southeast-1:
      AMZNLINUXHVM: ami-c63d6aa5
    ap-southeast-2:
      AMZNLINUXHVM: ami-ff4ea59d
    ca-central-1:
      AMZNLINUXHVM: ami-d29e25b6
    eu-central-1:
      AMZNLINUXHVM: ami-bf2ba8d0
    eu-west-1:
      AMZNLINUXHVM: ami-1a962263
    eu-west-2:
      AMZNLINUXHVM: ami-e7d6c983
    sa-east-1:
      AMZNLINUXHVM: ami-286f2a44
    us-east-1:
      AMZNLINUXHVM: ami-55ef662f
    us-east-2:
      AMZNLINUXHVM: ami-15e9c770
    us-west-1:
      AMZNLINUXHVM: ami-a51f27c5
    us-west-2:
      AMZNLINUXHVM: ami-bf4193c7
Resources:
  WebServerGroup:
    Type: 'AWS::AutoScaling::AutoScalingGroup'
    Properties:
      VPCZoneIdentifier: !Ref Subnets
      LaunchConfigurationName: !Ref LaunchConfig
      MinSize: '2'
      MaxSize: '2'
      TargetGroupARNs:
        - !Ref ALBTargetGroup
    CreationPolicy:
      ResourceSignal:
        Timeout: PT15M
    UpdatePolicy:
      AutoScalingRollingUpdate:
        MinInstancesInService: '1'
        MaxBatchSize: '1'
        PauseTime: PT15M
        WaitOnResourceSignals: 'true'
  LaunchConfig:
    Type: 'AWS::AutoScaling::LaunchConfiguration'
    Metadata:
      Comment: Install a simple application
      'AWS::CloudFormation::Init':
        config:
          packages:
            yum:
              httpd: []
          files:
            /var/www/html/index.html:
              content: !Join 
                - |+

                - - &gt;-
                    &lt;h1&gt;Congratulations, you have successfully launched the AWS
                    CloudFormation sample.&lt;h1&gt;
              mode: '000644'
              owner: root
              group: root
            /etc/cfn/cfn-hup.conf:
              content: !Join 
                - ''
                - - |
                    [main]
                  - stack=
                  - !Ref 'AWS::StackId'
                  - |+

                  - region=
                  - !Ref 'AWS::Region'
                  - |+

              mode: '000400'
              owner: root
              group: root
            /etc/cfn/hooks.d/cfn-auto-reloader.conf:
              content: !Join 
                - ''
                - - |
                    [cfn-auto-reloader-hook]
                  - |
                    triggers=post.update
                  - &gt;
                    path=Resources.LaunchConfig.Metadata.AWS::CloudFormation::Init
                  - 'action=/opt/aws/bin/cfn-init -v '
                  - '         --stack '
                  - !Ref 'AWS::StackName'
                  - '         --resource LaunchConfig '
                  - '         --region '
                  - !Ref 'AWS::Region'
                  - |+

                  - |
                    runas=root
              mode: '000400'
              owner: root
              group: root
          services:
            sysvinit:
              httpd:
                enabled: 'true'
                ensureRunning: 'true'
              cfn-hup:
                enabled: 'true'
                ensureRunning: 'true'
                files:
                  - /etc/cfn/cfn-hup.conf
                  - /etc/cfn/hooks.d/cfn-auto-reloader.conf
    Properties:
      ImageId: !FindInMap 
        - AWSAMIRegionMap
        - !Ref 'AWS::Region'
        - AMZNLINUXHVM
      SecurityGroups:
        - !Ref InstanceSecurityGroup
      InstanceType: !Ref InstanceType
      KeyName: !Ref KeyName
      UserData: !Base64 
        'Fn::Join':
          - ''
          - - |
              #!/bin/bash -xe
            - |
              yum update -y aws-cfn-bootstrap
            - '/opt/aws/bin/cfn-init -v '
            - '         --stack '
            - !Ref 'AWS::StackName'
            - '         --resource LaunchConfig '
            - '         --region '
            - !Ref 'AWS::Region'
            - |+

            - '/opt/aws/bin/cfn-signal -e $? '
            - '         --stack '
            - !Ref 'AWS::StackName'
            - '         --resource WebServerGroup '
            - '         --region '
            - !Ref 'AWS::Region'
            - |+

  ELBSecurityGroup:
    Type: 'AWS::EC2::SecurityGroup'
    Properties:
      GroupDescription: Allow access to the ELB
      VpcId: !Ref VpcId
      SecurityGroupIngress:
        - !If 
          - UseALBSSL
          - IpProtocol: tcp
            FromPort: 443
            ToPort: 443
            CidrIp: 0.0.0.0/0
          - IpProtocol: tcp
            FromPort: 80
            ToPort: 80
            CidrIp: 0.0.0.0/0
  ApplicationLoadBalancer:
    Type: 'AWS::ElasticLoadBalancingV2::LoadBalancer'
    Properties:
      Subnets: !Ref Subnets
      SecurityGroups:
        - !Ref ELBSecurityGroup
  ALBListener:
    Type: 'AWS::ElasticLoadBalancingV2::Listener'
    Properties:
      DefaultActions:
        - Type: forward
          TargetGroupArn: !Ref ALBTargetGroup
      LoadBalancerArn: !Ref ApplicationLoadBalancer
      Port: !If 
        - UseALBSSL
        - 443
        - 80
      Protocol: !If 
        - UseALBSSL
        - HTTPS
        - HTTP
      Certificates:
        - !If 
          - UseALBSSL
          - CertificateArn: !Ref ALBSSLCertificateARN
          - !Ref 'AWS::NoValue'
  ALBTargetGroup:
    Type: 'AWS::ElasticLoadBalancingV2::TargetGroup'
    Properties:
      HealthCheckIntervalSeconds: 30
      HealthCheckTimeoutSeconds: 5
      HealthyThresholdCount: 3
      Port: 80
      Protocol: HTTP
      UnhealthyThresholdCount: 5
      VpcId: !Ref VpcId
  InstanceSecurityGroup:
    Type: 'AWS::EC2::SecurityGroup'
    Properties:
      GroupDescription: Enable SSH access and HTTP access on the inbound port
      SecurityGroupIngress:
        - IpProtocol: tcp
          FromPort: 80
          ToPort: 80
          SourceSecurityGroupId: !Select 
            - 0
            - !GetAtt 
              - ApplicationLoadBalancer
              - SecurityGroups
        - IpProtocol: tcp
          FromPort: 22
          ToPort: 22
          CidrIp: !Ref SSHLocation
      VpcId: !Ref VpcId
  RecordSet:
    Type: 'AWS::Route53::RecordSetGroup'
    Condition: UseALBSSL
    Properties:
      HostedZoneName: !Join 
        - ''
        - - !Ref HostedZoneName
          - .
      RecordSets:
        - Name: !Join 
            - ''
            - - !Select 
                - '0'
                - !Split 
                  - .
                  - !GetAtt 
                    - ApplicationLoadBalancer
                    - DNSName
              - .
              - !Ref HostedZoneName
              - .
          Type: A
          AliasTarget:
            DNSName: !GetAtt 
              - ApplicationLoadBalancer
              - DNSName
            EvaluateTargetHealth: true
            HostedZoneId: !GetAtt 
              - ApplicationLoadBalancer
              - CanonicalHostedZoneID
Outputs:
  URL:
    Description: URL of the website
    Value: !Join 
      - ''
      - - !If 
          - UseALBSSL
          - !Join 
            - ''
            - - 'https://'
              - !Join 
                - ''
                - - !Select 
                    - '0'
                    - !Split 
                      - .
                      - !GetAtt 
                        - ApplicationLoadBalancer
                        - DNSName
                  - .
                  - !Ref HostedZoneName
                  - .
          - !Join 
            - ''
            - - 'http://'
              - !GetAtt 
                - ApplicationLoadBalancer
                - DNSName</code></pre>
        </div>
    <awsdocs-copyright class="copyright-print"></awsdocs-copyright><awsdocs-thumb-feedback right-edge="{{$ctrl.thumbFeedbackRightEdge}}"></awsdocs-thumb-feedback></div><noscript><div><div><div><div id="js_error_message"><p><img src="https://d1ge0kk1l5kms0.cloudfront.net/images/G/01/webservices/console/warning.png" alt="Avvertimento" /> <strong>JavaScript è disabilitato o non è disponibile nel tuo browser.</strong></p><p>Per usare la documentazione AWS, JavaScript deve essere abilitato. Consulta le pagine della guida del browser per le istruzioni.</p></div></div></div></div></noscript><div id="main-col-footer" class="awsui-util-font-size-0"><div id="doc-conventions"><a target="_top" href="/general/latest/gr/docconventions.html">Convenzioni dei documenti</a></div><div class="prev-next"><div id="previous" class="prev-link" accesskey="p" href="./dynamic-references.html">Utilizzo di riferimenti dinamici per specificare valori di modello</div><div id="next" class="next-link" accesskey="n" href="./intrinsic-function-reference-rules.html">Funzioni delle regole di</div></div></div><awsdocs-page-utilities></awsdocs-page-utilities></div><div id="quick-feedback-yes" style="display: none;"><div class="title">Questa pagina ti è stata utile? - Sì</div><div class="content"><p>Grazie per averci comunicato che stiamo facendo un buon lavoro!</p><p>Se hai un momento, ti invitiamo a dirci che cosa abbiamo fatto che ti è piaciuto così possiamo offrirti altri contenuti simili.</p><p><awsui-button id="fblink" rel="noopener noreferrer" target="_blank" text="Feedback" click="linkClick($event)" href="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=CloudFormation&amp;topic_url=https://docs.aws.amazon.com/it_it/AWSCloudFormation/latest/UserGuide/rules-section-structure.html"></awsui-button></p></div></div><div id="quick-feedback-no" style="display: none;"><div class="title">Questa pagina ti è stata utile? - No</div><div class="content"><p>Grazie per averci comunicato che questa pagina ha bisogno di essere modificata. Siamo spiacenti di non aver soddisfatto le tue esigenze.</p><p>Se hai un momento, ti invitiamo a dirci come possiamo migliorare la documentazione.</p><p><awsui-button id="fblink" rel="noopener noreferrer" target="_blank" text="Feedback" click="linkClick($event)" href="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=CloudFormation&amp;topic_url=https://docs.aws.amazon.com/it_it/AWSCloudFormation/latest/UserGuide/rules-section-structure.html"></awsui-button></p></div></div></div></body></div></awsdocs-view><div class="page-loading-indicator" id="page-loading-indicator"><awsui-spinner size="large"></awsui-spinner></div></div><div id="tools-panel" dom-region="tools"><awsdocs-tools-panel id="awsdocs-tools-panel"></awsdocs-tools-panel></div></awsui-app-layout><awsdocs-cookie-banner class="doc-cookie-banner"></awsdocs-cookie-banner></div></body></html>