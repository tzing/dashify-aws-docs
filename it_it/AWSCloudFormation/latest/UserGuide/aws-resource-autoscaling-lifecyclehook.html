<!DOCTYPE html>
    <html xmlns="http://www.w3.org/1999/xhtml" lang="en-US"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>AWS::AutoScaling::LifecycleHook - AWS CloudFormation</title><meta name="viewport" content="width=device-width,initial-scale=1" /><meta name="assets_root" content="/assets" /><meta name="target_state" content="aws-resource-autoscaling-lifecyclehook" /><meta name="default_state" content="aws-resource-autoscaling-lifecyclehook" /><link rel="icon" type="image/ico" href="/assets/images/favicon.ico" /><link rel="shortcut icon" type="image/ico" href="/assets/images/favicon.ico" /><link rel="canonical" href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-resource-autoscaling-lifecyclehook.html" /><meta name="description" content="Use lifecycle hooks to prepare new instances for use or to delay them from being registered behind a load balancer before their configuration has been applied completely. You can also use lifecycle hooks to prepare running instances to be terminated by, for example, downloading logs or other data." /><meta name="deployment_region" content="IAD" /><meta name="product" content="AWS CloudFormation" /><meta name="guide" content="User Guide" /><meta name="abstract" content="Create and manage AWS infrastructure deployments predictably and repeatedly using AWS CloudFormation with this User Guide." /><meta name="guide-locale" content="en_us" /><meta name="tocs" content="toc-contents.json;toc-AWS_AutoScaling.json" /><link rel="canonical" href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-resource-autoscaling-lifecyclehook.html" /><link rel="alternative" href="https://docs.aws.amazon.com/id_id/AWSCloudFormation/latest/UserGuide/aws-resource-autoscaling-lifecyclehook.html" hreflang="id-id" /><link rel="alternative" href="https://docs.aws.amazon.com/id_id/AWSCloudFormation/latest/UserGuide/aws-resource-autoscaling-lifecyclehook.html" hreflang="id" /><link rel="alternative" href="https://docs.aws.amazon.com/de_de/AWSCloudFormation/latest/UserGuide/aws-resource-autoscaling-lifecyclehook.html" hreflang="de-de" /><link rel="alternative" href="https://docs.aws.amazon.com/de_de/AWSCloudFormation/latest/UserGuide/aws-resource-autoscaling-lifecyclehook.html" hreflang="de" /><link rel="alternative" href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-resource-autoscaling-lifecyclehook.html" hreflang="en-us" /><link rel="alternative" href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-resource-autoscaling-lifecyclehook.html" hreflang="en" /><link rel="alternative" href="https://docs.aws.amazon.com/es_es/AWSCloudFormation/latest/UserGuide/aws-resource-autoscaling-lifecyclehook.html" hreflang="es-es" /><link rel="alternative" href="https://docs.aws.amazon.com/es_es/AWSCloudFormation/latest/UserGuide/aws-resource-autoscaling-lifecyclehook.html" hreflang="es" /><link rel="alternative" href="https://docs.aws.amazon.com/fr_fr/AWSCloudFormation/latest/UserGuide/aws-resource-autoscaling-lifecyclehook.html" hreflang="fr-fr" /><link rel="alternative" href="https://docs.aws.amazon.com/fr_fr/AWSCloudFormation/latest/UserGuide/aws-resource-autoscaling-lifecyclehook.html" hreflang="fr" /><link rel="alternative" href="https://docs.aws.amazon.com/it_it/AWSCloudFormation/latest/UserGuide/aws-resource-autoscaling-lifecyclehook.html" hreflang="it-it" /><link rel="alternative" href="https://docs.aws.amazon.com/it_it/AWSCloudFormation/latest/UserGuide/aws-resource-autoscaling-lifecyclehook.html" hreflang="it" /><link rel="alternative" href="https://docs.aws.amazon.com/ja_jp/AWSCloudFormation/latest/UserGuide/aws-resource-autoscaling-lifecyclehook.html" hreflang="ja-jp" /><link rel="alternative" href="https://docs.aws.amazon.com/ja_jp/AWSCloudFormation/latest/UserGuide/aws-resource-autoscaling-lifecyclehook.html" hreflang="ja" /><link rel="alternative" href="https://docs.aws.amazon.com/ko_kr/AWSCloudFormation/latest/UserGuide/aws-resource-autoscaling-lifecyclehook.html" hreflang="ko-kr" /><link rel="alternative" href="https://docs.aws.amazon.com/ko_kr/AWSCloudFormation/latest/UserGuide/aws-resource-autoscaling-lifecyclehook.html" hreflang="ko" /><link rel="alternative" href="https://docs.aws.amazon.com/pt_br/AWSCloudFormation/latest/UserGuide/aws-resource-autoscaling-lifecyclehook.html" hreflang="pt-br" /><link rel="alternative" href="https://docs.aws.amazon.com/pt_br/AWSCloudFormation/latest/UserGuide/aws-resource-autoscaling-lifecyclehook.html" hreflang="pt" /><link rel="alternative" href="https://docs.aws.amazon.com/zh_cn/AWSCloudFormation/latest/UserGuide/aws-resource-autoscaling-lifecyclehook.html" hreflang="zh-cn" /><link rel="alternative" href="https://docs.aws.amazon.com/zh_tw/AWSCloudFormation/latest/UserGuide/aws-resource-autoscaling-lifecyclehook.html" hreflang="zh-tw" /><link rel="alternative" href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-resource-autoscaling-lifecyclehook.html" hreflang="x-default" /><meta name="feedback-item" content="Auto Scaling" /><meta name="this_doc_product" content="AWS CloudFormation" /><meta name="this_doc_guide" content="User Guide" /><script defer="" src="/assets/r/vendor4.js?version=2021.12.02"></script><script defer="" src="/assets/r/vendor3.js?version=2021.12.02"></script><script defer="" src="/assets/r/vendor1.js?version=2021.12.02"></script><script defer="" src="/assets/r/awsdocs-common.js?version=2021.12.02"></script><script defer="" src="/assets/r/awsdocs-doc-page.js?version=2021.12.02"></script><link href="/assets/r/vendor4.css?version=2021.12.02" rel="stylesheet" /><link href="/assets/r/awsdocs-common.css?version=2021.12.02" rel="stylesheet" /><link href="/assets/r/awsdocs-doc-page.css?version=2021.12.02" rel="stylesheet" /><script async="" id="awsc-panorama-bundle" type="text/javascript" src="https://prod.pa.cdn.uis.awsstatic.com/panorama-nav-init.js" data-config="{'appEntity':'aws-documentation','region':'us-east-1','service':'cloudformation'}"></script><meta id="panorama-serviceSubSection" value="User Guide" /><meta id="panorama-serviceConsolePage" value="AWS::AutoScaling::LifecycleHook" /></head><body class="awsdocs awsui"><div class="awsdocs-container"><awsdocs-header></awsdocs-header><awsui-app-layout id="app-layout" class="awsui-util-no-gutters" ng-controller="ContentController as $ctrl" header-selector="awsdocs-header" navigation-hide="false" navigation-width="$ctrl.navWidth" navigation-open="$ctrl.navOpen" navigation-change="$ctrl.onNavChange($event)" tools-hide="$ctrl.hideTools" tools-width="$ctrl.toolsWidth" tools-open="$ctrl.toolsOpen" tools-change="$ctrl.onToolsChange($event)"><div id="guide-toc" dom-region="navigation"><awsdocs-toc></awsdocs-toc></div><div id="main-column" dom-region="content" tabindex="-1"><awsdocs-view class="awsdocs-view"><div id="awsdocs-content"><head><title>AWS::AutoScaling::LifecycleHook - AWS CloudFormation</title><meta name="rss" content="aws-cloudformation-release-notes.rss" /><meta name="forums" content="http://forums.aws.amazon.com/forum.jspa?forumID=92" /><meta name="feedback" content="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=Auto%20Scaling&amp;topic_url=https://docs.aws.amazon.com/en_us/AWSCloudFormation/latest/UserGuide/aws-resource-autoscaling-lifecyclehook.html" /><meta name="feedback-yes" content="feedbackyes.html?topic_url=https://docs.aws.amazon.com/en_us/AWSCloudFormation/latest/UserGuide/aws-resource-autoscaling-lifecyclehook.html" /><meta name="feedback-no" content="feedbackno.html?topic_url=https://docs.aws.amazon.com/en_us/AWSCloudFormation/latest/UserGuide/aws-resource-autoscaling-lifecyclehook.html" /><meta name="keywords" content="CloudFormation,AWSCloudFormation,resource provisioning,resource configuration,infrastructure management,CloudFormer,CloudFormation stack,CloudFormation stackset,CloudFormation template,change set" /><script type="application/ld+json">
{
    "@context" : "https://schema.org",
    "@type" : "BreadcrumbList",
    "itemListElement" : [
      {
        "@type" : "ListItem",
        "position" : 1,
        "name" : "AWS",
        "item" : "https://aws.amazon.com"
      },
      {
        "@type" : "ListItem",
        "position" : 2,
        "name" : "AWS CloudFormation",
        "item" : "https://docs.aws.amazon.com/cloudformation/index.html"
      },
      {
        "@type" : "ListItem",
        "position" : 3,
        "name" : "User Guide",
        "item" : "https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide"
      },
      {
        "@type" : "ListItem",
        "position" : 4,
        "name" : "Amazon EC2 Auto Scaling resource type reference",
        "item" : "https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/AWS_AutoScaling.html"
      },
      {
        "@type" : "ListItem",
        "position" : 5,
        "name" : "AWS::AutoScaling::LifecycleHook",
        "item" : "https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/AWS_AutoScaling.html"
      }
    ]
}
</script></head><body><div id="main"><div style="display: none"></div><div id="breadcrumbs" class="breadcrumb"><a href="https://aws.amazon.com">AWS</a><a href="/index.html">Documentation</a><a href="/cloudformation/index.html">AWS CloudFormation</a><a href="AWS_AutoScaling.html">User Guide</a></div><div id="page-toc-src"><a href="#aws-resource-autoscaling-lifecyclehook-syntax">Syntax</a><a href="#aws-resource-autoscaling-lifecyclehook-properties">Properties</a><a href="#aws-resource-autoscaling-lifecyclehook-return-values">Return values</a><a href="#aws-resource-autoscaling-lifecyclehook--examples">Examples</a><a href="#aws-resource-autoscaling-lifecyclehook--seealso">See also</a></div><div id="page-filters" style="display:none"><filter label="All" id="All"></filter><filter label="JSON" id="JSON"></filter><filter label="YAML" id="YAML"></filter></div><div id="main-content" class="awsui-util-container"><div id="main-col-body"><awsdocs-language-banner data-service="$ctrl.pageService"></awsdocs-language-banner><h1 class="topictitle" id="aws-resource-autoscaling-lifecyclehook">AWS::AutoScaling::LifecycleHook</h1><div class="awsdocs-page-header-container"><awsdocs-page-header></awsdocs-page-header><awsdocs-filter-selector id="awsdocs-filter-selector"></awsdocs-filter-selector></div><p>The <code class="code">AWS::AutoScaling::LifecycleHook</code> resource specifies lifecycle hooks for an
      Auto Scaling group. These hooks let you create solutions that are aware of events in the Auto
      Scaling instance lifecycle, and then perform a custom action on instances when the
      corresponding lifecycle event occurs. A lifecycle hook provides a specified amount of time
      (one hour by default) to wait for the action to complete before the instance transitions to
      the next state. </p><p>Use lifecycle hooks to prepare new instances for use or to delay them from being
      registered behind a load balancer before their configuration has been applied completely. You
      can also use lifecycle hooks to prepare running instances to be terminated by, for example,
      downloading logs or other data. </p><p>For more information, see <a href="https://docs.aws.amazon.com/autoscaling/ec2/userguide/lifecycle-hooks.html">Amazon EC2 Auto Scaling lifecycle
        hooks</a> in the <em>Amazon EC2 Auto Scaling User Guide</em>.</p><h2 id="aws-resource-autoscaling-lifecyclehook-syntax">Syntax</h2><p>To declare this entity in your AWS CloudFormation template, use the following syntax:</p><div id="JSON" name="JSON" class="section langfilter"><h3 id="aws-resource-autoscaling-lifecyclehook-syntax.json">JSON</h3><pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
  "Type" : "AWS::AutoScaling::LifecycleHook",
  "Properties" : <span>{</span>
      "<a href="#cfn-autoscaling-lifecyclehook-autoscalinggroupname">AutoScalingGroupName</a>" : <code class="replaceable">String</code>,
      "<a href="#cfn-autoscaling-lifecyclehook-defaultresult">DefaultResult</a>" : <code class="replaceable">String</code>,
      "<a href="#cfn-autoscaling-lifecyclehook-heartbeattimeout">HeartbeatTimeout</a>" : <code class="replaceable">Integer</code>,
      "<a href="#cfn-autoscaling-lifecyclehook-lifecyclehookname">LifecycleHookName</a>" : <code class="replaceable">String</code>,
      "<a href="#cfn-autoscaling-lifecyclehook-lifecycletransition">LifecycleTransition</a>" : <code class="replaceable">String</code>,
      "<a href="#cfn-autoscaling-lifecyclehook-notificationmetadata">NotificationMetadata</a>" : <code class="replaceable">String</code>,
      "<a href="#cfn-autoscaling-lifecyclehook-notificationtargetarn">NotificationTargetARN</a>" : <code class="replaceable">String</code>,
      "<a href="#cfn-autoscaling-lifecyclehook-rolearn">RoleARN</a>" : <code class="replaceable">String</code>
    }
}
</code></pre></div><div id="YAML" name="YAML" class="section langfilter"><h3 id="aws-resource-autoscaling-lifecyclehook-syntax.yaml">YAML</h3><pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="yaml ">Type: AWS::AutoScaling::LifecycleHook
Properties:
  <a href="#cfn-autoscaling-lifecyclehook-autoscalinggroupname">AutoScalingGroupName</a>: <code class="replaceable">String</code>
  <a href="#cfn-autoscaling-lifecyclehook-defaultresult">DefaultResult</a>: <code class="replaceable">String</code>
  <a href="#cfn-autoscaling-lifecyclehook-heartbeattimeout">HeartbeatTimeout</a>: <code class="replaceable">Integer</code>
  <a href="#cfn-autoscaling-lifecyclehook-lifecyclehookname">LifecycleHookName</a>: <code class="replaceable">String</code>
  <a href="#cfn-autoscaling-lifecyclehook-lifecycletransition">LifecycleTransition</a>: <code class="replaceable">String</code>
  <a href="#cfn-autoscaling-lifecyclehook-notificationmetadata">NotificationMetadata</a>: <code class="replaceable">String</code>
  <a href="#cfn-autoscaling-lifecyclehook-notificationtargetarn">NotificationTargetARN</a>: <code class="replaceable">String</code>
  <a href="#cfn-autoscaling-lifecyclehook-rolearn">RoleARN</a>: <code class="replaceable">String</code>
</code></pre></div><h2 id="aws-resource-autoscaling-lifecyclehook-properties">Properties</h2><div class="variablelist"><dl><dt id="cfn-autoscaling-lifecyclehook-autoscalinggroupname"><span class="term"><code class="code">AutoScalingGroupName</code></span></dt><dd>
         <p>The name of the Auto Scaling group.</p>
      <p><em>Required</em>: Yes</p><p><em>Type</em>: String</p><p><em>Update requires</em>: <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/using-cfn-updating-stacks-update-behaviors.html#update-replacement">Replacement</a></p></dd><dt id="cfn-autoscaling-lifecyclehook-defaultresult"><span class="term"><code class="code">DefaultResult</code></span></dt><dd>
         <p>The action the Auto Scaling group takes when the lifecycle hook timeout elapses or if an
            unexpected failure occurs. The default value is <code class="code">ABANDON</code>.</p>
         <p>Valid values: <code class="code">CONTINUE</code> | <code class="code">ABANDON</code>
         </p>
      <p><em>Required</em>: No</p><p><em>Type</em>: String</p><p><em>Update requires</em>: <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/using-cfn-updating-stacks-update-behaviors.html#update-no-interrupt">No interruption</a></p></dd><dt id="cfn-autoscaling-lifecyclehook-heartbeattimeout"><span class="term"><code class="code">HeartbeatTimeout</code></span></dt><dd>
         <p>The maximum time, in seconds, that can elapse before the lifecycle hook times out. The
            range is from <code class="code">30</code> to <code class="code">7200</code> seconds. The default value is
                <code class="code">3600</code> seconds (1 hour).</p>
      <p><em>Required</em>: No</p><p><em>Type</em>: Integer</p><p><em>Update requires</em>: <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/using-cfn-updating-stacks-update-behaviors.html#update-no-interrupt">No interruption</a></p></dd><dt id="cfn-autoscaling-lifecyclehook-lifecyclehookname"><span class="term"><code class="code">LifecycleHookName</code></span></dt><dd>
         <p>The name of the lifecycle hook.</p>
      <p><em>Required</em>: No</p><p><em>Type</em>: String</p><p><em>Minimum</em>: <code class="code">1</code></p><p><em>Maximum</em>: <code class="code">255</code></p><p><em>Update requires</em>: <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/using-cfn-updating-stacks-update-behaviors.html#update-replacement">Replacement</a></p></dd><dt id="cfn-autoscaling-lifecyclehook-lifecycletransition"><span class="term"><code class="code">LifecycleTransition</code></span></dt><dd>
         <p>The lifecycle transition. For Auto Scaling groups, there are two major lifecycle
            transitions.</p>
         <div class="itemizedlist">
             
             
         <ul class="itemizedlist"><li class="listitem">
               <p>To create a lifecycle hook for scale-out events, specify
                        <code class="code">autoscaling:EC2_INSTANCE_LAUNCHING</code>.</p>
            </li><li class="listitem">
               <p>To create a lifecycle hook for scale-in events, specify
                        <code class="code">autoscaling:EC2_INSTANCE_TERMINATING</code>.</p>
            </li></ul></div>
      <p><em>Required</em>: Yes</p><p><em>Type</em>: String</p><p><em>Update requires</em>: <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/using-cfn-updating-stacks-update-behaviors.html#update-no-interrupt">No interruption</a></p></dd><dt id="cfn-autoscaling-lifecyclehook-notificationmetadata"><span class="term"><code class="code">NotificationMetadata</code></span></dt><dd>
         <p>Additional information that you want to include any time Amazon EC2 Auto Scaling sends a message to
            the notification target.</p>
      <p><em>Required</em>: No</p><p><em>Type</em>: String</p><p><em>Minimum</em>: <code class="code">1</code></p><p><em>Maximum</em>: <code class="code">1023</code></p><p><em>Update requires</em>: <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/using-cfn-updating-stacks-update-behaviors.html#update-no-interrupt">No interruption</a></p></dd><dt id="cfn-autoscaling-lifecyclehook-notificationtargetarn"><span class="term"><code class="code">NotificationTargetARN</code></span></dt><dd>
         <p>The Amazon Resource Name (ARN) of the notification target that Amazon EC2 Auto Scaling sends
            notifications to when an instance is in a wait state for the lifecycle hook. You can
            specify an Amazon SNS topic or an Amazon SQS queue.</p>
      <p><em>Required</em>: No</p><p><em>Type</em>: String</p><p><em>Update requires</em>: <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/using-cfn-updating-stacks-update-behaviors.html#update-no-interrupt">No interruption</a></p></dd><dt id="cfn-autoscaling-lifecyclehook-rolearn"><span class="term"><code class="code">RoleARN</code></span></dt><dd>
         <p>The ARN of the IAM role that allows the Auto Scaling group to publish to the specified
            notification target. For information about creating this role, see <a href="https://docs.aws.amazon.com/autoscaling/ec2/userguide/prepare-for-lifecycle-notifications.html#lifecycle-hook-notification-target">Configure a notification target for a lifecycle hook</a> in the
                <em>Amazon EC2 Auto Scaling User Guide</em>.</p>
         <p>Valid only if the notification target is an Amazon SNS topic or an Amazon SQS queue.</p>
      <p><em>Required</em>: No</p><p><em>Type</em>: String</p><p><em>Update requires</em>: <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/using-cfn-updating-stacks-update-behaviors.html#update-no-interrupt">No interruption</a></p></dd></dl></div><h2 id="aws-resource-autoscaling-lifecyclehook-return-values">Return values</h2><h3 id="aws-resource-autoscaling-lifecyclehook-return-values-ref">Ref</h3><p>When you pass the logical ID of this resource to the intrinsic <code class="code">Ref</code> function, <code class="code">Ref</code> returns the resource name. For example:
      <code class="code">mylifecyclehook</code>.</p><p>For more information about using the <code class="code">Ref</code> function, see <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/intrinsic-function-reference-ref.html"><code class="code">Ref</code></a>.</p><h2 id="aws-resource-autoscaling-lifecyclehook--examples">Examples</h2><p>The following examples specify lifecycle hooks. </p><p>For other examples of lifecycle hooks, see our <a href="https://github.com/aws-samples/amazon-ec2-auto-scaling-group-examples" rel="noopener noreferrer" target="_blank"><span>GitHub
          repository</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a>. Included are examples of lifecycle hooks that work with warm
        pools.</p><div class="highlights" id="inline-topiclist"><h6> </h6><ul><li><a href="#aws-resource-autoscaling-lifecyclehook--examples--Lifecycle_hook_for_instance_launch">Lifecycle hook for instance launch</a></li><li><a href="#aws-resource-autoscaling-lifecyclehook--examples--Lifecycle_hook_for_instance_termination">Lifecycle hook for instance termination</a></li><li><a href="#aws-resource-autoscaling-lifecyclehook--examples--Lifecycle_hook_that_specifies_a_notification_target_ARN_and_role_ARN">Lifecycle hook that specifies a notification target ARN and role ARN</a></li></ul></div><h3 id="aws-resource-autoscaling-lifecyclehook--examples--Lifecycle_hook_for_instance_launch">Lifecycle hook for instance launch</h3><p>The following example creates a launch template, an Auto Scaling group, and a
          lifecycle hook that supports a custom action on your instances at launch. When you create
          a launch template, you can include user data to perform configuration tasks and run
          scripts when an instance launches. By doing so, you do not need to configure a
          notification target. In this example, the hook keeps each instance in a wait state for 60
          seconds to give the user data script time to complete before the instance enters the
            <code class="code">InService</code> state. </p><p>The example bash script in the user data customizes the hostname on instances to
          include the launch template name and the instance ID. The script gets the ID of the
          instance from the instance metadata. For more information, see <a href="https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/instancedata-data-retrieval.html">Retrieve instance
            metadata</a> in the <em>Amazon EC2 User Guide for Linux
          Instances</em>.</p><div id="JSON" name="JSON" class="section langfilter"><h4 id="aws-resource-autoscaling-lifecyclehook--examples--Lifecycle_hook_for_instance_launch--json">JSON</h4><pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
    "AWSTemplateFormatVersion": "2010-09-09",
    "Parameters": <span>{</span>
        "LatestAmiId": <span>{</span>
            "Description": "Region specific image from the Parameter Store",
            "Type": "AWS::SSM::Parameter::Value&lt;AWS::EC2::Image::Id&gt;",
            "Default": "/aws/service/ami-amazon-linux-latest/amzn2-ami-hvm-x86_64-gp2"
        },
        "InstanceType": <span>{</span>
            "Description": "Amazon EC2 instance type for the instances",
            "Type": "String",
            "AllowedValues": [
                "t3.micro",
                "t3.small",
                "t3.medium"
            ],
            "Default": "t3.micro"
        },
        "Subnets": <span>{</span>
            "Type": "CommaDelimitedList"
        }
    },
    "Resources": <span>{</span>
        "myAppLaunchTemplate": <span>{</span>
            "Type": "AWS::EC2::LaunchTemplate",
            "Properties": <span>{</span>
                "LaunchTemplateName": <span>{</span> "Fn::Sub": "$<span>{</span>AWS::StackName}-launch-template" },
                "LaunchTemplateData": <span>{</span>
                    "ImageId": <span>{</span> "Ref": "LatestAmiId" },
                    "InstanceType": <span>{</span> "Ref": "InstanceType" },
                    "KeyName": "MyKeyPair",
                    "SecurityGroupIds": [  "sg-083cd3bfb8example" ],
                    "UserData": <span>{</span>"Fn::Base64": <span>{</span>"Fn::Join": [ "", [
                      "#!/usr/bin/env bash\n",
                      "set -e\n",
                      "export INSTANCE_ID=$(curl -sLf http://169.254.169.254/latest/meta-data/instance-id)", "\n",
                      "export NEW_HOSTNAME=\"$<span>{</span>LaunchTemplateName}-$INSTANCE_ID\"", "\n",
                      "hostname $NEW_HOSTNAME", "\n"
                    ]]}}
                }
            }
        },
        "myASG": <span>{</span>
            "Type": "AWS::AutoScaling::AutoScalingGroup",
            "Properties": <span>{</span>
                "LaunchTemplate": <span>{</span>
                    "LaunchTemplateId": <span>{</span>
                        "Ref": "myAppLaunchTemplate"
                    },
                    "Version": <span>{</span>
                        "Fn::GetAtt": [
                            "myAppLaunchTemplate",
                            "DefaultVersionNumber"
                        ]
                    }
                },
                "MaxSize": 10,
                "MinSize": 1,
                "VPCZoneIdentifier": <span>{</span>
                    "Ref": "Subnets"
                },
                "LifecycleHookSpecificationList": [
                    <span>{</span>
                        "LifecycleTransition": "autoscaling:EC2_INSTANCE_LAUNCHING",
                        "LifecycleHookName": "myLaunchLifecycleHook",
                        "DefaultResult": "CONTINUE",
                        "HeartbeatTimeout": 60
                    }
                ]
            }
        }
    }
}</code></pre></div><div id="YAML" name="YAML" class="section langfilter"><h4 id="aws-resource-autoscaling-lifecyclehook--examples--Lifecycle_hook_for_instance_launch--yaml">YAML</h4><pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="yaml ">AWSTemplateFormatVersion: 2010-09-09
Parameters:
  LatestAmiId:
    Description: Region specific image from the Parameter Store
    Type: 'AWS::SSM::Parameter::Value&lt;AWS::EC2::Image::Id&gt;'
    Default: '/aws/service/ami-amazon-linux-latest/amzn2-ami-hvm-x86_64-gp2'
  InstanceType:
    Description: Amazon EC2 instance type for the instances
    Type: String
    AllowedValues:
      - t3.micro
      - t3.small
      - t3.medium
    Default: t3.micro
  Subnets:
    Type: CommaDelimitedList
Resources:
  myAppLaunchTemplate:
    Type: AWS::EC2::LaunchTemplate
    Properties:
      LaunchTemplateName: !Sub $<span>{</span>AWS::StackName}-launch-template
      LaunchTemplateData:
        ImageId: !Ref LatestAmiId
        InstanceType: !Ref InstanceType
        KeyName: MyKeyPair
        SecurityGroupIds:
          - sg-083cd3bfb8example
        UserData:
          Fn::Base64: !Sub |
            #!/usr/bin/env bash
            set -e
            export INSTANCE_ID=$(curl -sLf http://169.254.169.254/latest/meta-data/instance-id)
            export NEW_HOSTNAME="$<span>{</span>LaunchTemplateName}-$INSTANCE_ID"
            hostname $NEW_HOSTNAME
  myASG:
    Type: AWS::AutoScaling::AutoScalingGroup
    Properties:
      LaunchTemplate:
        LaunchTemplateId: !Ref myAppLaunchTemplate
        Version: !GetAtt myAppLaunchTemplate.DefaultVersionNumber
      MaxSize: '10'
      MinSize: '1'
      VPCZoneIdentifier: !Ref Subnets
      LifecycleHookSpecificationList:
        - LifecycleTransition: autoscaling:EC2_INSTANCE_LAUNCHING
          LifecycleHookName: myLaunchLifecycleHook
          DefaultResult: CONTINUE
          HeartbeatTimeout: '60'</code></pre></div><h3 id="aws-resource-autoscaling-lifecyclehook--examples--Lifecycle_hook_for_instance_termination">Lifecycle hook for instance termination</h3><p>The following example specifies a lifecycle hook that supports a custom action at
          instance termination. It uses the <code class="code">Ref</code> intrinsic function to refer to an Auto
          Scaling group (whose logical name is <code class="code">myASG</code>) that is declared elsewhere in the
          same template. It uses the <code class="code">NotificationMetadata</code> property to specify
          additional information to be sent with the notification, such as the name of the cluster
          to which the instance belongs.</p><p>This snippet does not include the notification target that would need to exist or be
          created to complete the configuration. For information about creating these resources, see
            <a href="https://docs.aws.amazon.com/autoscaling/ec2/userguide/prepare-for-lifecycle-notifications.html#lifecycle-hook-notification-target">Configure a notification target for lifecycle notifications</a> in the
            <em>Amazon EC2 Auto Scaling User Guide</em>.</p><div id="JSON" name="JSON" class="section langfilter"><h4 id="aws-resource-autoscaling-lifecyclehook--examples--Lifecycle_hook_for_instance_termination--json">JSON</h4><pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
  "myTerminationLifecycleHook":<span>{</span>
    "Type":"AWS::AutoScaling::LifecycleHook",
    "Properties":<span>{</span>
      "AutoScalingGroupName":<span>{</span>
        "Ref":"myASG"
      },
      "LifecycleTransition":"autoscaling:EC2_INSTANCE_TERMINATING",
      "HeartbeatTimeout": 300,
      "DefaultResult": "CONTINUE",
      "NotificationMetadata": "optional metadata"
    }
  }
}</code></pre></div><div id="YAML" name="YAML" class="section langfilter"><h4 id="aws-resource-autoscaling-lifecyclehook--examples--Lifecycle_hook_for_instance_termination--yaml">YAML</h4><pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="yaml ">---
myTerminationLifecycleHook: 
  Type: AWS::AutoScaling::LifecycleHook
  Properties: 
    AutoScalingGroupName: !Ref myASG
    LifecycleTransition: autoscaling:EC2_INSTANCE_TERMINATING
    HeartbeatTimeout: '300'
    DefaultResult: CONTINUE
    NotificationMetadata: optional metadata</code></pre></div><h3 id="aws-resource-autoscaling-lifecyclehook--examples--Lifecycle_hook_that_specifies_a_notification_target_ARN_and_role_ARN">Lifecycle hook that specifies a notification target ARN and role ARN</h3><p>The following example creates an Auto Scaling group with a lifecycle hook that
          supports a custom action at instance launch. This example snippet uses the
            <code class="code">NotificationTargetARN</code> and <code class="code">RoleARN</code> properties to specify the
          Amazon SQS queue and IAM role to use to receive notification when a lifecycle action
          occurs.</p><p>This snippet does not include the Amazon SQS queue and IAM role resources that would
          need to exist or be created to complete the configuration. For information about creating
          these resources, see <a href="https://docs.aws.amazon.com/autoscaling/ec2/userguide/prepare-for-lifecycle-notifications.html#lifecycle-hook-notification-target">Configure a notification target for lifecycle notifications</a> in the
            <em>Amazon EC2 Auto Scaling User Guide</em>.</p><div id="JSON" name="JSON" class="section langfilter"><h4 id="aws-resource-autoscaling-lifecyclehook--examples--Lifecycle_hook_that_specifies_a_notification_target_ARN_and_role_ARN--json">JSON</h4><pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
  "AWSTemplateFormatVersion":"2010-09-09",
  "Parameters":<span>{</span>
    "Subnets":<span>{</span>
      "Type":"CommaDelimitedList"
    }
  },
  "Resources":<span>{</span>
    "myASG":<span>{</span>
      "Type":"AWS::AutoScaling::AutoScalingGroup",
      "Properties":<span>{</span>
        "MaxSize":"3",
        "MinSize":"1",
        "LaunchTemplate": <span>{</span>
          "LaunchTemplateId": <span>{</span>
            "Ref":"myLaunchTemplate"
          },
          "Version":<span>{</span>
            "Ref":"myLaunchTemplateVersionNumber"
          }
        },
        "VPCZoneIdentifier":<span>{</span>
          "Ref":"Subnets"
        },
        "LifecycleHookSpecificationList":[
          <span>{</span>
            "LifecycleTransition":"autoscaling:EC2_INSTANCE_LAUNCHING",
            "LifecycleHookName":"myLaunchLifecycleHook",
            "HeartbeatTimeout":4800,
            "NotificationTargetARN":<span>{</span>
              "Fn::GetAtt":[
                "SQS",
                "Arn"
              ]
            },
            "RoleArn":<span>{</span>
              "Fn::Join":[
                ":",
                [
                  "arn:aws:iam:",
                  <span>{</span>
                    "Ref":"AWS::AccountId"
                  },
                  "role/role-name"
                ]
              ]
            }
          }
        ]
      }
    },
    "SQS":<span>{</span>
      "Type":"AWS::SQS::Queue"
    }
  }
}</code></pre></div><div id="YAML" name="YAML" class="section langfilter"><h4 id="aws-resource-autoscaling-lifecyclehook--examples--Lifecycle_hook_that_specifies_a_notification_target_ARN_and_role_ARN--yaml">YAML</h4><pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="yaml ">AWSTemplateFormatVersion: 2010-09-09
Parameters:
  Subnets:
    Type: CommaDelimitedList
Resources:
  myASG:
    Type: AWS::AutoScaling::AutoScalingGroup
    Properties:
      MaxSize: '3'
      MinSize: '1'
      LaunchTemplate:
        LaunchTemplateId: !Ref myLaunchTemplate
        Version: !Ref myLaunchTemplateVersionNumber
      VPCZoneIdentifier: !Ref Subnets
      LifecycleHookSpecificationList:
        - LifecycleTransition: autoscaling:EC2_INSTANCE_LAUNCHING
          LifecycleHookName: myLaunchLifecycleHook
          HeartbeatTimeout: '4800'
          NotificationTargetARN: !GetAtt SQS.Arn
          RoleARN: !Join 
            - ':'
            - - 'arn:aws:iam:'
              - !Ref 'AWS::AccountId'
              - role/role-name
  SQS:
    Type: AWS::SQS::Queue</code></pre></div><h2 id="aws-resource-autoscaling-lifecyclehook--seealso">See also</h2><div class="itemizedlist">
         
         
      <ul class="itemizedlist"><li class="listitem">
          <p>You can find additional useful snippets in the following sections of the
                <em>AWS CloudFormation User Guide</em>:</p>
          <div class="itemizedlist">
             
             
          <ul class="itemizedlist"><li class="listitem">
              <p>For examples of Auto Scaling groups, see <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/quickref-ec2-auto-scaling.html">Configure
                  Amazon EC2 Auto Scaling resources</a>.</p>
            </li><li class="listitem">
              <p>For examples of launch templates, see <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/quickref-ec2-launch-templates.html">Create
                  launch templates</a>.</p>
            </li></ul></div>
        </li><li class="listitem">
          <p><a href="https://docs.aws.amazon.com/autoscaling/ec2/APIReference/API_PutLifecycleHook.html">PutLifecycleHook</a>
            in the <em>Amazon EC2 Auto Scaling API Reference</em></p>
        </li></ul></div><awsdocs-copyright class="copyright-print"></awsdocs-copyright><awsdocs-thumb-feedback right-edge="{{$ctrl.thumbFeedbackRightEdge}}"></awsdocs-thumb-feedback></div><noscript><div><div><div><div id="js_error_message"><p><img src="https://d1ge0kk1l5kms0.cloudfront.net/images/G/01/webservices/console/warning.png" alt="Warning" /> <strong>Javascript is disabled or is unavailable in your browser.</strong></p><p>To use the Amazon Web Services Documentation, Javascript must be enabled. Please refer to your browser's Help pages for instructions.</p></div></div></div></div></noscript><div id="main-col-footer" class="awsui-util-font-size-0"><div id="doc-conventions"><a target="_top" href="/general/latest/gr/docconventions.html">Document Conventions</a></div><div class="prev-next"><div id="previous" class="prev-link" accesskey="p" href="./aws-properties-autoscaling-launchconfiguration-metadataoptions.html">MetadataOptions</div><div id="next" class="next-link" accesskey="n" href="./aws-resource-autoscaling-scalingpolicy.html">AWS::AutoScaling::ScalingPolicy</div></div></div><awsdocs-page-utilities></awsdocs-page-utilities></div><div id="quick-feedback-yes" style="display: none;"><div class="title">Did this page help you? - Yes</div><div class="content"><p>Thanks for letting us know we're doing a good job!</p><p>If you've got a moment, please tell us what we did right so we can do more of it.</p><p><awsui-button id="fblink" rel="noopener noreferrer" target="_blank" text="Feedback" click="linkClick($event)" href="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=Auto Scaling&amp;topic_url=https://docs.aws.amazon.com/en_us/AWSCloudFormation/latest/UserGuide/aws-resource-autoscaling-lifecyclehook.html"></awsui-button></p></div></div><div id="quick-feedback-no" style="display: none;"><div class="title">Did this page help you? - No</div><div class="content"><p>Thanks for letting us know this page needs work. We're sorry we let you down.</p><p>If you've got a moment, please tell us how we can make the documentation better.</p><p><awsui-button id="fblink" rel="noopener noreferrer" target="_blank" text="Feedback" click="linkClick($event)" href="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=Auto Scaling&amp;topic_url=https://docs.aws.amazon.com/en_us/AWSCloudFormation/latest/UserGuide/aws-resource-autoscaling-lifecyclehook.html"></awsui-button></p></div></div></div></body></div></awsdocs-view><div class="page-loading-indicator" id="page-loading-indicator"><awsui-spinner size="large"></awsui-spinner></div></div><div id="tools-panel" dom-region="tools"><awsdocs-tools-panel id="awsdocs-tools-panel"></awsdocs-tools-panel></div></awsui-app-layout><awsdocs-cookie-banner class="doc-cookie-banner"></awsdocs-cookie-banner></div></body></html>