<!DOCTYPE html>
    <html xmlns="http://www.w3.org/1999/xhtml" lang="it-IT"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Esegui implementazioni ECS blu/green utilizzando CodeDeploy AWS CloudFormation - AWS CloudFormation</title><meta name="viewport" content="width=device-width,initial-scale=1" /><meta name="assets_root" content="/assets" /><meta name="target_state" content="blue-green" /><meta name="default_state" content="blue-green" /><link rel="icon" type="image/ico" href="/assets/images/favicon.ico" /><link rel="shortcut icon" type="image/ico" href="/assets/images/favicon.ico" /><link rel="canonical" href="https://docs.aws.amazon.com/it_it/AWSCloudFormation/latest/UserGuide/blue-green.html" /><meta name="description" content="Utilizzare modelli AWS CloudFormation per gestire le distribuzioni blu/verde di ECS tramite AWS CodeDeploy." /><meta name="deployment_region" content="IAD" /><meta name="product" content="AWS CloudFormation" /><meta name="guide" content="Guida per l'utente" /><meta name="abstract" content="Crea e gestisci le implementazioni AWS dell'infrastruttura in modo prevedibile e ripetuto utilizzando questa guida per AWS CloudFormation l'utente." /><meta name="guide-locale" content="it_it" /><meta name="tocs" content="toc-contents.json" /><link rel="canonical" href="https://docs.aws.amazon.com/it_it/AWSCloudFormation/latest/UserGuide/blue-green.html" /><link rel="alternative" href="https://docs.aws.amazon.com/id_id/AWSCloudFormation/latest/UserGuide/blue-green.html" hreflang="id-id" /><link rel="alternative" href="https://docs.aws.amazon.com/id_id/AWSCloudFormation/latest/UserGuide/blue-green.html" hreflang="id" /><link rel="alternative" href="https://docs.aws.amazon.com/de_de/AWSCloudFormation/latest/UserGuide/blue-green.html" hreflang="de-de" /><link rel="alternative" href="https://docs.aws.amazon.com/de_de/AWSCloudFormation/latest/UserGuide/blue-green.html" hreflang="de" /><link rel="alternative" href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/blue-green.html" hreflang="en-us" /><link rel="alternative" href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/blue-green.html" hreflang="en" /><link rel="alternative" href="https://docs.aws.amazon.com/es_es/AWSCloudFormation/latest/UserGuide/blue-green.html" hreflang="es-es" /><link rel="alternative" href="https://docs.aws.amazon.com/es_es/AWSCloudFormation/latest/UserGuide/blue-green.html" hreflang="es" /><link rel="alternative" href="https://docs.aws.amazon.com/fr_fr/AWSCloudFormation/latest/UserGuide/blue-green.html" hreflang="fr-fr" /><link rel="alternative" href="https://docs.aws.amazon.com/fr_fr/AWSCloudFormation/latest/UserGuide/blue-green.html" hreflang="fr" /><link rel="alternative" href="https://docs.aws.amazon.com/it_it/AWSCloudFormation/latest/UserGuide/blue-green.html" hreflang="it-it" /><link rel="alternative" href="https://docs.aws.amazon.com/it_it/AWSCloudFormation/latest/UserGuide/blue-green.html" hreflang="it" /><link rel="alternative" href="https://docs.aws.amazon.com/ja_jp/AWSCloudFormation/latest/UserGuide/blue-green.html" hreflang="ja-jp" /><link rel="alternative" href="https://docs.aws.amazon.com/ja_jp/AWSCloudFormation/latest/UserGuide/blue-green.html" hreflang="ja" /><link rel="alternative" href="https://docs.aws.amazon.com/ko_kr/AWSCloudFormation/latest/UserGuide/blue-green.html" hreflang="ko-kr" /><link rel="alternative" href="https://docs.aws.amazon.com/ko_kr/AWSCloudFormation/latest/UserGuide/blue-green.html" hreflang="ko" /><link rel="alternative" href="https://docs.aws.amazon.com/pt_br/AWSCloudFormation/latest/UserGuide/blue-green.html" hreflang="pt-br" /><link rel="alternative" href="https://docs.aws.amazon.com/pt_br/AWSCloudFormation/latest/UserGuide/blue-green.html" hreflang="pt" /><link rel="alternative" href="https://docs.aws.amazon.com/zh_cn/AWSCloudFormation/latest/UserGuide/blue-green.html" hreflang="zh-cn" /><link rel="alternative" href="https://docs.aws.amazon.com/zh_tw/AWSCloudFormation/latest/UserGuide/blue-green.html" hreflang="zh-tw" /><link rel="alternative" href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/blue-green.html" hreflang="x-default" /><meta name="feedback-item" content="CloudFormation" /><meta name="this_doc_product" content="AWS CloudFormation" /><meta name="this_doc_guide" content="Guida per l'utente" /><script defer="" src="/assets/r/vendor4.js?version=2021.12.02"></script><script defer="" src="/assets/r/vendor3.js?version=2021.12.02"></script><script defer="" src="/assets/r/vendor1.js?version=2021.12.02"></script><script defer="" src="/assets/r/awsdocs-common.js?version=2021.12.02"></script><script defer="" src="/assets/r/awsdocs-doc-page.js?version=2021.12.02"></script><link href="/assets/r/vendor4.css?version=2021.12.02" rel="stylesheet" /><link href="/assets/r/awsdocs-common.css?version=2021.12.02" rel="stylesheet" /><link href="/assets/r/awsdocs-doc-page.css?version=2021.12.02" rel="stylesheet" /><script async="" id="awsc-panorama-bundle" type="text/javascript" src="https://prod.pa.cdn.uis.awsstatic.com/panorama-nav-init.js" data-config="{'appEntity':'aws-documentation','region':'us-east-1','service':'cloudformation'}"></script><meta id="panorama-serviceSubSection" value="Guida per l'utente" /><meta id="panorama-serviceConsolePage" value="Esegui implementazioni ECS blu/green utilizzando CodeDeploy AWS CloudFormation" /></head><body class="awsdocs awsui"><div class="awsdocs-container"><awsdocs-header></awsdocs-header><awsui-app-layout id="app-layout" class="awsui-util-no-gutters" ng-controller="ContentController as $ctrl" header-selector="awsdocs-header" navigation-hide="false" navigation-width="$ctrl.navWidth" navigation-open="$ctrl.navOpen" navigation-change="$ctrl.onNavChange($event)" tools-hide="$ctrl.hideTools" tools-width="$ctrl.toolsWidth" tools-open="$ctrl.toolsOpen" tools-change="$ctrl.onToolsChange($event)"><div id="guide-toc" dom-region="navigation"><awsdocs-toc></awsdocs-toc></div><div id="main-column" dom-region="content" tabindex="-1"><awsdocs-view class="awsdocs-view"><div id="awsdocs-content"><head><title>Esegui implementazioni ECS blu/green utilizzando CodeDeploy AWS CloudFormation - AWS CloudFormation</title><meta name="rss" content="aws-cloudformation-release-notes.rss" /><meta name="forums" content="http://forums.aws.amazon.com/forum.jspa?forumID=92" /><meta name="feedback" content="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=CloudFormation&amp;topic_url=https://docs.aws.amazon.com/it_it/AWSCloudFormation/latest/UserGuide/blue-green.html" /><meta name="feedback-yes" content="feedbackyes.html?topic_url=https://docs.aws.amazon.com/it_it/AWSCloudFormation/latest/UserGuide/blue-green.html" /><meta name="feedback-no" content="feedbackno.html?topic_url=https://docs.aws.amazon.com/it_it/AWSCloudFormation/latest/UserGuide/blue-green.html" /><meta name="keywords" content="CloudFormation,AWSCloudFormation,provisioning delle risorse,configurazione delle risorse,gestione dell'infrastruttura,CloudFormer,CloudFormation pila,CloudFormation modello,set di modifiche" /><script type="application/ld+json">
{
    "@context" : "https://schema.org",
    "@type" : "BreadcrumbList",
    "itemListElement" : [
      {
        "@type" : "ListItem",
        "position" : 1,
        "name" : "AWS",
        "item" : "https://aws.amazon.com"
      },
      {
        "@type" : "ListItem",
        "position" : 2,
        "name" : "AWS CloudFormation",
        "item" : "https://docs.aws.amazon.com/cloudformation/index.html"
      },
      {
        "@type" : "ListItem",
        "position" : 3,
        "name" : "Guida per l'utente",
        "item" : "https://docs.aws.amazon.com/it_it/AWSCloudFormation/latest/UserGuide"
      },
      {
        "@type" : "ListItem",
        "position" : 4,
        "name" : "Utilizzo dei modelli AWS CloudFormation",
        "item" : "https://docs.aws.amazon.com/it_it/AWSCloudFormation/latest/UserGuide/template-guide.html"
      },
      {
        "@type" : "ListItem",
        "position" : 5,
        "name" : "Esegui implementazioni ECS blu/green utilizzando CodeDeploy AWS CloudFormation",
        "item" : "https://docs.aws.amazon.com/it_it/AWSCloudFormation/latest/UserGuide/template-guide.html"
      }
    ]
}
</script></head><body><div id="main"><div style="display: none"></div><div id="breadcrumbs" class="breadcrumb"><a href="https://aws.amazon.com">AWS</a><a href="/index.html">Documentazione</a><a href="/cloudformation/index.html">AWS CloudFormation</a><a href="Welcome.html">Guida per l'utente</a></div><div id="page-toc-src"><a href="#blue-green-required">Modellazione della distribuzione blu/verde utilizzando le risorse  CloudFormation </a><a href="#blue-green-resources">Aggiornamenti delle risorse che attivano distribuzioni verdi</a><a href="#blue-green-considerations">Considerazioni sulla gestione delle distribuzioni blu/green di ECS utilizzando  CloudFormation</a><a href="#blue-green-setup">Preparazione del modello per l'esecuzione di distribuzioni blu/verde di ECS</a><a href="#blue-green-changesets">Analisi dei set di modifiche per la distribuzione blu/verde</a><a href="#blue-green-events">Visualizzazione degli eventi stack per la distribuzione blu/verde</a><a href="#blue-green-template-reference">Riferimento modello</a><a href="#blue-green-iam">Autorizzazioni IAM necessarie per le distribuzioni blu/verde</a><a href="#blue-green-template-example">Esempio di modello</a></div><div id="page-filters" style="display:none"><filter label="All" id="All"></filter><filter label="JSON" id="JSON"></filter><filter label="YAML" id="YAML"></filter></div><div id="main-content" class="awsui-util-container"><div id="main-col-body"><awsdocs-language-banner data-service="$ctrl.pageService"></awsdocs-language-banner><awsui-alert class="awsdocs-page-banner awsui-util-mb-l"><p>Le traduzioni sono generate tramite traduzione automatica. In caso di conflitto tra il contenuto di una traduzione e la versione originale in Inglese, quest'ultima prevarrà.</p></awsui-alert><h1 class="topictitle" id="blue-green">Esegui implementazioni ECS blu/green utilizzando  CodeDeploy  AWS CloudFormation</h1><div class="awsdocs-page-header-container"><awsdocs-page-header></awsdocs-page-header><awsdocs-filter-selector id="awsdocs-filter-selector"></awsdocs-filter-selector></div><p>È possibile utilizzare per eseguire distribuzioni ECS  CloudFormation  blu/green tramite. AWS CodeDeploy Le implementazioni blu/verdi sono una strategia di distribuzione sicura fornita per ridurre al minimo le interruzioni causate dalla  CodeDeploy  modifica delle versioni delle applicazioni. Questo si ottiene creando il nuovo ambiente applicativo, denominato <em>verde</em>, accanto all'applicazione corrente che serve il traffico in tempo reale, denominato <em>blu</em>. Ciò consente un periodo di tempo per il monitoraggio e il test dell'ambiente verde prima che il traffico in tempo reale venga instradato dall'ambiente blu all'ambiente verde, con la successiva disattivazione delle risorse blu.</p><p>Quando si utilizza  CloudFormation  per eseguire implementazioni ECS blu/green, si inizia con la creazione di un modello di stack che definisce le risorse per gli ambienti applicativi blu e verdi, inclusa la specificazione delle impostazioni di routing e stabilizzazione del traffico da utilizzare. Successivamente, crei uno stack da quel modello; questo genera l'applicazione blu (corrente).  CloudFormation crea solo le risorse blu durante la creazione dello stack. Le risorse per una distribuzione verde non vengono create finché non sono necessarie.</p><p>Quindi, se in un futuro aggiornamento dello stack aggiorni la definizione dell'attività o le risorse del set di attività nell'applicazione blu,  CloudFormation  effettua le seguenti operazioni:</p><div class="itemizedlist">
         
         
         
    <ul class="itemizedlist"><li class="listitem"><p>Genera tutte le risorse necessarie per l'ambiente delle applicazioni verdi</p></li><li class="listitem"><p>Sposta il traffico in base ai parametri di instradamento del traffico specificati</p></li><li class="listitem"><p>Elimina le risorse blu</p></li></ul></div><p>Se si verifica un errore in qualsiasi momento prima che la distribuzione verde abbia esito positivo e sia finalizzata,  CloudFormation  ripristina lo stack allo stato precedente all'avvio dell'intera distribuzione verde.</p><p> CloudFormation Per consentire l'esecuzione di distribuzioni blu/verdi su uno stack, includi le seguenti informazioni nel relativo modello di stack:</p><div class="itemizedlist">
         
         
    <ul class="itemizedlist"><li class="listitem"><p>Una sezione <code class="code">Transform</code> del modello che richiama la trasformazione <code class="code">AWS::CodeDeployBlueGreen</code> e una sezione <code class="code">Hook</code> che richiama l'hook <code class="code">AWS::CodeDeploy::BlueGreen</code>.</p></li><li class="listitem"><p>Almeno una delle risorse ECS che attiverà una distribuzione blu/verde se sostituita durante un aggiornamento dello stack. Attualmente, queste risorse sono <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-resource-ecs-taskdefinition.html"><code class="code">AWS::ECS::TaskDefinition</code></a> e <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-resource-ecs-taskset.html"><code class="code">AWS::ECS::TaskSet</code></a>.</p></li></ul></div><p>Quindi, se avviate un aggiornamento dello stack che aggiorna tutte le proprietà delle risorse di cui sopra che richiedono la sostituzione della risorsa,  CloudFormation  esegue una distribuzione  CloudFormation  blu/verde come descritto sopra. Per ulteriori informazioni sul comportamento di aggiornamento delle risorse, consulta <a href="./using-cfn-updating-stacks-update-behaviors.html">Aggiornamento dei comportamenti delle risorse stack</a>.</p><p>In molti casi, è consigliabile impostare il modello di stack per abilitare le distribuzioni blu/verde <em>prima</em> della creazione dello stack. Tuttavia, puoi anche aggiungere la possibilità di  CloudFormation  eseguire distribuzioni blu/verdi su uno stack esistente. A tale scopo, aggiungi le informazioni necessarie al modello esistente dello stack.</p><p>Inoltre, ti consigliamo di  CloudFormation  generare un set di modifiche per la distribuzione ecologica, prima di iniziare l'aggiornamento dello stack. Ciò ti consente di esaminare le modifiche effettive che verranno apportate allo stack. Per ulteriori informazioni, consulta <a href="./using-cfn-updating-stacks-changesets.html">Aggiornamento di stack utilizzando i set di modifiche</a>.</p>
        <h2 id="blue-green-required">Modellazione della distribuzione blu/verde utilizzando le risorse  CloudFormation </h2>
        <p>Per eseguire la distribuzione di ECS blu/green utilizzando  CodeDeploy  through CloudFormation, il modello deve includere le risorse che modellano la distribuzione, ad esempio un servizio Amazon ECS e un sistema di bilanciamento del carico. Per ulteriori dettagli su cosa rappresentano queste risorse, consulta <a href="https://docs.aws.amazon.com/codedeploy/latest/userguide/deployment-steps-ecs.html#deployment-steps-prerequisites-ecs">Prima di iniziare una distribuzione Amazon ECS</a> nella <em>Guida per l'utente di AWS CodeDeploy</em>.</p>
        <div class="table-container"><div class="table-contents"><table id="w1348aac17c33c25b5"><thead>
                    <tr>
                        <th>Requisito</th>
                        <th>Risorsa</th>
                        <th>Obbligatorio/facoltativo</th>
                        <th>Attiva la distribuzione blu/verde se sostituita</th>
                    </tr>
                </thead>
                    <tr>
                        <td tabindex="-1">Cluster Amazon ECS</td>
                        <td tabindex="-1"><a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-resource-ecs-cluster.html"><code class="code">AWS::ECS::Cluster</code></a></td>
                        <td tabindex="-1">Facoltativo. Puoi utilizzare il cluster predefinito.</td>
                        <td tabindex="-1">No</td>
                    </tr>
                    <tr>
                        <td tabindex="-1">Servizio Amazon ECS</td>
                        <td tabindex="-1"><a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-resource-ecs-service.html"><code class="code">AWS::ECS::Service</code></a></td>
                        <td tabindex="-1">Obbligatorio.</td>
                        <td tabindex="-1">No</td>
                    </tr>
                    <tr>
                        <td tabindex="-1">Applicazione o Network Load Balancer</td>
                        <td tabindex="-1"><a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-properties-ecs-service-loadbalancer.html"><code class="code">AWS::ECS::Service
       LoadBalancer</code></a></td>
                        <td tabindex="-1">Obbligatorio.</td>
                        <td tabindex="-1">No</td>
                    </tr>
                    <tr>
                        <td tabindex="-1">Listener di produzione</td>
                        <td tabindex="-1"><a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-resource-elasticloadbalancingv2-listener.html"><code class="code">AWS::ElasticLoadBalancingV2::Listener</code></a></td>
                        <td tabindex="-1">Obbligatorio.</td>
                        <td tabindex="-1">No</td>
                    </tr>
                    <tr>
                        <td tabindex="-1">Listener di prova </td>
                        <td tabindex="-1"><a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-resource-elasticloadbalancingv2-listener.html"><code class="code">AWS::ElasticLoadBalancingV2::Listener</code></a></td>
                        <td tabindex="-1">Facoltativo.</td>
                        <td tabindex="-1">No</td>
                    </tr>
                    <tr>
                        <td tabindex="-1">Due gruppi target</td>
                        <td tabindex="-1"><a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-resource-elasticloadbalancingv2-targetgroup.html"><code class="code">AWS::ElasticLoadBalancingV2::TargetGroup</code></a></td>
                        <td tabindex="-1">Obbligatorio.</td>
                        <td tabindex="-1">No</td>
                    </tr>
                    <tr>
                        <td tabindex="-1">Definizione dell'attività di Amazon ECS </td>
                        <td tabindex="-1"><a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-resource-ecs-taskdefinition.html"><code class="code">AWS::ECS::TaskDefinition</code></a></td>
                        <td tabindex="-1">Obbligatorio.</td>
                        <td tabindex="-1">Sì</td>
                    </tr>
                    <tr>
                        <td tabindex="-1">Container per l'applicazione Amazon ECS</td>
                        <td tabindex="-1"><a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-properties-ecs-taskdefinition-containerdefinitions.html#cfn-ecs-taskdefinition-containerdefinition-name.html"><code class="code">AWS::ECS::TaskDefinition ContainerDefinition Name</code></a></td>
                        <td tabindex="-1">Obbligatorio.</td>
                        <td tabindex="-1">No</td>
                    </tr>
                    <tr>
                        <td tabindex="-1">Porta per il set di attività di sostituzione</td>
                        <td tabindex="-1"><a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-properties-ecs-taskdefinition-portmapping.html#cfn-ecs-taskdefinition-portmapping-containerport"><code class="code">AWS::ECS::TaskDefinition PortMapping ContainerPort</code></a></td>
                        <td tabindex="-1">Obbligatorio.</td>
                        <td tabindex="-1">No</td>
                    </tr>
                </table></div></div>
     
        <h2 id="blue-green-resources">Aggiornamenti delle risorse che attivano distribuzioni verdi</h2>
        <p>Se si esegue un aggiornamento dello stack che aggiorna qualsiasi proprietà che richiede la <a href="./using-cfn-updating-stacks-update-behaviors.html">sostituzione</a> per le seguenti risorse ECS,  CloudFormation inizia una distribuzione verde:</p>
        <div class="itemizedlist">
             
             
        <ul class="itemizedlist"><li class="listitem"><p><a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-resource-ecs-taskdefinition.html"><code class="code">AWS::ECS::TaskDefinition</code></a></p></li><li class="listitem"><p><a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-resource-ecs-taskset.html"><code class="code">AWS::ECS::TaskSet</code></a> </p></li></ul></div>
        
        <p>L'aggiornamento delle proprietà di queste risorse che non richiedono la sostituzione delle risorse non attiva una distribuzione verde.</p>
        <p>Non puoi includere gli aggiornamenti delle risorse di cui sopra con gli aggiornamenti di altre risorse nello stesso aggiornamento dello stack. Se è necessario aggiornare anche le risorse presenti nell'elenco precedente oltre ad altre risorse nello stesso stack, procedere in uno dei seguenti modi:</p>
        <div class="itemizedlist">
             
             
        <ul class="itemizedlist"><li class="listitem"><p>Eseguire due operazioni di aggiornamento separate: una che include solo gli aggiornamenti delle risorse precedenti e un aggiornamento separato dello stack che include le modifiche apportate a qualsiasi altra risorsa.</p></li><li class="listitem"><p>Rimuovi le sezioni <code class="code">Transform</code> e <code class="code">Hook</code> dal modello e quindi esegui l'aggiornamento dello stack. In questo caso,  CloudFormation  non eseguirà una distribuzione ecologica.</p></li></ul></div>
     
        <h2 id="blue-green-considerations">Considerazioni sulla gestione delle distribuzioni blu/green di ECS utilizzando  CloudFormation</h2>
        <p>Quando definisci la distribuzione blu/verde utilizzando  CloudFormation, devi considerare quanto segue:</p>
        <div class="itemizedlist">
             
             
             
             
             
             
             
             
             
        <ul class="itemizedlist"><li class="listitem"><p>Solo gli aggiornamenti a determinate risorse avvieranno una distribuzione ecologica, come discusso in. <a href="#blue-green-resources">Aggiornamenti delle risorse che attivano distribuzioni verdi</a></p></li><li class="listitem"><p>Non è possibile includere aggiornamenti alle risorse che avviano implementazioni ecologiche e aggiornamenti ad altre risorse nello stesso aggiornamento dello stack, come discusso in. <a href="#blue-green-resources">Aggiornamenti delle risorse che attivano distribuzioni verdi</a></p></li><li class="listitem"><p>Puoi specificare solo una singola applicazione ECS come target di distribuzione.</p></li><li class="listitem"><p>I parametri i cui valori sono offuscati non  CloudFormation  possono essere aggiornati dal  CodeDeploy  servizio durante una distribuzione ecologica e causeranno un errore e un errore di aggiornamento dello stack. Ciò include:</p>
            <div class="itemizedlist">
                 
                 
            <ul class="itemizedlist"><li class="listitem"><p>Parametri definiti con l'attributo <code class="code">NoEcho</code>.</p></li><li class="listitem"><p>Parametri che utilizzano riferimenti dinamici per recuperare i loro valori da servizi esterni. Per ulteriori informazioni, consulta <a href="./dynamic-references.html">Utilizzo di riferimenti dinamici per specificare valori di modello</a>.</p></li></ul></div>
            </li><li class="listitem"><p>Per annullare una distribuzione ecologica ancora in corso, annulla l'aggiornamento dello stack in CloudFormation, not o ECS.  CodeDeploy  Per ulteriori informazioni, consulta <a href="./using-cfn--stack-update-cancel.html">Annullamento di un aggiornamento dello stack</a>. Dopo che un aggiornamento è terminato, non è possibile annullarlo. È però possibile aggiornare di nuovo uno stack utilizzando le impostazioni precedenti.</p></li><li class="listitem"><p>La dichiarazione <a href="./outputs-section-structure.html">Output</a> o l'utilizzo <a href="./intrinsic-function-reference-importvalue.html">Fn::ImportValue</a> per importare valori da altri stack non sono attualmente supportati per i modelli che definiscono implementazioni ECS blu/verdi.</p></li><li class="listitem"><p><a href="./resource-import.html">Integrazione delle risorse esistenti nella  CloudFormation  gestione</a>attualmente non è supportato per i modelli che definiscono distribuzioni ECS blu/verdi.</p></li><li class="listitem"><p>Non è possibile utilizzare l'hook <code class="code">AWS::CodeDeploy::BlueGreen</code> in un modello che include risorse di stack nidificate.</p></li><li class="listitem"><p>Non è possibile utilizzare l'hook <code class="code">AWS::CodeDeploy::BlueGreen</code> in uno <a href="./using-cfn-nested-stacks.html">stack nidificato</a>.</p></li></ul></div>
        <p><em>Per informazioni su come l'utilizzo per  CloudFormation  eseguire le distribuzioni di ECS blu/green  CodeDeploy  differisce da una distribuzione Amazon ECS standard che utilizza solo CodeDeploy, consulta <a href="https://docs.aws.amazon.com/codedeploy/latest/userguide/deployments-create-prerequisites.html">Differenze tra le distribuzioni Amazon ECS Blue/Green e le distribuzioni  CloudFormation Amazon ECS</a> standard nella Guida per l'utente. AWS CodeDeploy</em></p>
     
        <h2 id="blue-green-setup">Preparazione del modello per l'esecuzione di distribuzioni blu/verde di ECS</h2>
        <p>Per abilitare le distribuzioni blu/verde nello stack, includi le sezioni seguenti nel modello di stack prima di eseguire un aggiornamento dello stack.</p>
        <div class="itemizedlist">
             
             
             
        <ul class="itemizedlist"><li class="listitem"><p>Aggiungi un riferimento alla trasformazione <code class="code">AWS::CodeDeployBlueGreen</code> al tuo modello:</p>
            <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copia"><awsui-icon name="copy"></awsui-icon></div></div><code class="json ">    "Transform": [
        "AWS::CodeDeployBlueGreen"
    ],</code></pre>
</li><li class="listitem"><p>Aggiungi una sezione <code class="code">Hook</code> che richiami l'hook <code class="code">AWS::CodeDeploy::BlueGreen</code> e specifica le proprietà per la distribuzione. Utilizza il riferimento del modello riportato di seguito come guida.</p></li><li class="listitem"><p>Nella sezione <code class="code">Resources</code>, definisci le risorse blu e verdi per la distribuzione.</p></li></ul></div>
        <p>È possibile aggiungere queste sezioni quando si crea il modello per la prima volta o prima di creare lo stack medesimo; oppure è possibile aggiungerle a un modello esistente prima di eseguire un aggiornamento dello stack. Se specifichi la distribuzione blu/verde per un nuovo stack, crea le risorse blu  CloudFormation  solo durante la creazione dello stack: le risorse per la distribuzione verde non vengono create finché non sono richieste durante un aggiornamento dello stack.</p>

     
        <h2 id="blue-green-changesets">Analisi dei set di modifiche per la distribuzione blu/verde</h2>
        <p>Consigliamo vivamente di creare un set di modifiche prima di eseguire un aggiornamento dello stack che inizierà una distribuzione verde. Ciò consente di visualizzare le modifiche effettive che verranno apportate allo stack prima di procedere con l'aggiornamento. Tieni presente che le modifiche alle risorse potrebbero non essere elencate nell'ordine in cui verranno eseguite durante l'aggiornamento dello stack. Per ulteriori informazioni, consulta <a href="./using-cfn-updating-stacks-changesets.html">Aggiornamento di stack utilizzando i set di modifiche</a>.</p>
     
        <h2 id="blue-green-events">Visualizzazione degli eventi stack per la distribuzione blu/verde</h2>
        <p>È possibile visualizzare gli eventi stack generati in ogni fase dell'implementazione ECS nella scheda <b>Events</b> (Eventi) della pagina <b>Stack</b> oppure utilizzando AWS CLI. Per ulteriori informazioni, consulta <a href="./using-cfn-updating-stacks-monitor-stack.html">Monitoraggio dell'avanzamento di un aggiornamento dello stack</a>.</p>
     
        <h2 id="blue-green-template-reference">Riferimento modello</h2>
        <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copia"><awsui-icon name="copy"></awsui-icon></div></div><code class="json ">"Hooks": <span>{</span>
  "Logical ID": <span>{</span>
    "Properties": <span>{</span>
      "TrafficRoutingConfig": <span>{</span>
        "Type": "Traffic routing type",
        "TimeBasedCanary": <span>{</span>
          "StepPercentage": Integer,
          "BakeTimeMins": Integer
        },
        "TimeBasedLinear": <span>{</span>
          "StepPercentage": Integer,
          "BakeTimeMins": Integer
        }
      },
      "AdditionalOptions": <span>{</span>"TerminationWaitTimeInMinutes": Integer},
      "LifecycleEventHooks": <span>{</span>
        "BeforeInstall": "FunctionName",
        "AfterInstall": "FunctionName",
        "AfterAllowTestTraffic": "FunctionName",
        "BeforeAllowTraffic": "FunctionName",
        "AfterAllowTraffic": "FunctionName"
      },
      "ServiceRole": "CodeDeployServiceRoleName",
      "Applications": [
        <span>{</span>
          "Target": <span>{</span>
            "Type": "AWS::ECS::Service",
            "LogicalID": "Resource Logical ID"
          },
          "ECSAttributes": <span>{</span>
            "TaskDefinitions": [
              "AWS::ECS::TaskDefinition Resource Logical ID (Blue)",
              "AWS::ECS::TaskDefinition Resource Logical ID (Green)"
            ],
            "TaskSets": [
              "AWS::ECS::TaskSet Resource Logical ID (Blue)",
              "AWS::ECS::TaskSet Resource Logical ID (Green)"
            ],
            "TrafficRouting": <span>{</span>
              "ProdTrafficRoute": <span>{</span>
                "Type": "AWS::ElasticLoadBalancingV2::Listener",
                "LogicalID": "Resource Logical ID (Production)"
              },
              "TestTrafficRoute": <span>{</span>
                "Type": "AWS::ElasticLoadBalancingV2::Listener",
                "LogicalID": "Resource Logical ID (Test)"
              },
              "TargetGroups": [
                "AWS::ElasticLoadBalancingV2::TargetGroup Resource Logical ID (Blue)",
                "AWS::ElasticLoadBalancingV2::TargetGroup Resource Logical ID (Green)"
              ]
            }
          }
        }
      ]
    },
    "Type": "AWS::CodeDeploy::BlueGreen"
  }
}</code></pre>
         
            <h3 id="blue-green-template-reference-props">Proprietà</h3>
            <div class="variablelist">
                 
                 
            <dl>
                    <dt><span class="term"><code class="code">Logical ID</code></span></dt>
                    <dd>
                        <p>L'ID logico deve essere un valore alfanumerico (A-Z, a-z, 0-9) univoco all'interno del modello.</p>
                        <p><em>Campo obbligatorio</em>: sì</p>
                        <div class="variablelist">
                             
                        <dl>
                                <dt><span class="term"><code class="code">Properties</code></span></dt>
                                <dd>
                                    <p>Proprietà dell'hook.</p>
                                    <p><em>Campo obbligatorio</em>: sì</p>
                                    <div class="variablelist">
                                         
                                         
                                         
                                         
                                         
                                    <dl>
                                            <dt><span class="term"><code class="code">TrafficRoutingConfig</code></span></dt>
                                            <dd>
                                                <p>Impostazioni di configurazione dell'instradamento del traffico.</p>
                                                <p><em>Required</em>: No</p>
                                                <p>La configurazione predefinita è lo spostamento del traffico canary basato sul tempo, con una percentuale di fasi del 15% e un tempo di cottura di cinque minuti.</p>
                                                <div class="variablelist">
                                                    
                                                     
                                                <dl>
                                                        <dt><span class="term"><code class="code">Type</code></span></dt>
                                                        <dd>
                                                            <p>Tipo di spostamento del traffico utilizzato dalla configurazione di distribuzione.</p>
                                                            <p>Valori validi: | |  AllAtOnce   TimeBasedCanary   TimeBasedLinear</p>
                                                            <p><em>Campo obbligatorio</em>: sì</p>
                                                            <div class="variablelist">
                                                                 
                                                                 
                                                            <dl>
                                                                    <dt><span class="term"><code class="code">TimeBasedCanary</code></span></dt>
                                                                    <dd>
                                                                        <p>Specifica una configurazione che sposta il traffico da una versione della distribuzione a un'altra con due incrementi.</p>
                                                                        <p><em>Obbligatorio</em>: condizionale: se si specifica <code class="code">TimeBasedCanary</code> come tipo di instradamento del traffico, è necessario includere il parametro <code class="code">TimeBasedCanary</code>.</p>
                                                                        <div class="variablelist">
                                                                             
                                                                        <dl>
                                                                                <dt><span class="term"><code class="code">StepPercentage</code></span></dt>
                                                                                <dd>
                                                                                    <p>Percentuale di traffico da spostare nel primo incremento di una distribuzione <code class="code">TimeBasedCanary</code>. La percentuale di fasi deve essere pari o superiore al 14%.</p>
                                                                                    <p><em>Required</em>: No</p>
                                                                                </dd>
                                                                            </dl></div>
                                                                        <div class="variablelist">
                                                                             
                                                                        <dl>
                                                                                <dt><span class="term"><code class="code">BakeTimeMins</code></span></dt>
                                                                                <dd>
                                                                                    <p>Numero di minuti tra il primo e il secondo spostamento di traffico di una distribuzione <code class="code">TimeBasedCanary</code>.</p>
                                                                                    <p><em>Required</em>: No</p>
                                                                                </dd>
                                                                            </dl></div>
                                                                    </dd>
                                                                 
                                                                    <dt><span class="term"><code class="code">TimeBasedLinear</code></span></dt>
                                                                    <dd>
                                                                        <p>Specifica una configurazione che sposta il traffico da una versione della distribuzione a un'altra con incrementi uguali, con un numero uguale di minuti tra ciascun incremento.</p>
                                                                        <p><em>Obbligatorio</em>: condizionale: se si specifica <code class="code">TimeBasedLinear</code> come tipo di instradamento del traffico, è necessario includere il parametro <code class="code">TimeBasedLinear</code>.</p>
                                                                        <div class="variablelist">
                                                                             
                                                                        <dl>
                                                                                <dt><span class="term"><code class="code">StepPercentage</code></span></dt>
                                                                                <dd>
                                                                                    <p>Percentuale di traffico spostata all'inizio di ogni incremento di una distribuzione <code class="code">TimeBasedLinear</code>. La percentuale di fasi deve essere pari o superiore al 14%.</p>
                                                                                    <p><em>Required</em>: No</p>
                                                                                </dd>
                                                                            </dl></div>
                                                                        <div class="variablelist">
                                                                             
                                                                        <dl>
                                                                                <dt><span class="term"><code class="code">BakeTimeMins</code></span></dt>
                                                                                <dd>
                                                                                    <p>Numero di minuti tra ogni spostamento incrementale del traffico di una distribuzione <code class="code">TimeBasedLinear</code>.</p>
                                                                                    <p><em>Required</em>: No</p>
                                                                                </dd>
                                                                            </dl></div>
                                                                    </dd>
                                                                </dl></div>
                                                        </dd>
                                                    </dl></div>
                                            </dd>
                                         
                                            <dt><span class="term"><code class="code">AdditionalOptions</code></span></dt>
                                            <dd>
                                                <p>Opzioni aggiuntive per la distribuzione blu/verde.</p>
                                                <p><em>Required</em>: No</p>
                                                <div class="variablelist">
                                                     
                                                <dl>
                                                        <dt><span class="term"><code class="code">TerminationWaitTimeInMinutes</code></span></dt>
                                                        <dd>
                                                            <p>Specifica il tempo di attesa, in minuti, prima di terminare le risorse blu.</p>
                                                            <p><em>Required</em>: No</p>
                                                        </dd>
                                                    </dl></div>
                                            </dd>
                                         
                                            <dt><span class="term"><code class="code">LifecycleEventHooks</code></span></dt>
                                            <dd>
                                                <p>Usa gli hook degli eventi del ciclo di vita per specificare una funzione Lambda che  CodeDeploy  può chiamare per convalidare una distribuzione. Puoi utilizzare la stessa funzione o un'altra per gli eventi del ciclo di vita di distribuzione. Dopo il completamento dei test di convalida, la funzione  AfterAllowTraffic  Lambda  CodeDeploy  richiama e fornisce il risultato <code class="code">Succeeded</code> di o. <code class="code">Failed</code></p>
                                                <p><em>Per ulteriori informazioni, consulta la <a href="https://docs.aws.amazon.com/codedeploy/latest/userguide/reference-appspec-file-structure-hooks.html">sezione AppSpec  'hook'</a> nella Guida per l'AWS CodeDeployutente.</em></p>
                                                <p><em>Required</em>: No</p>
                                                <div class="variablelist">
                                                     
                                                     
                                                     
                                                     
                                                     
                                                <dl>
                                                        <dt><span class="term"><code class="code">BeforeInstall</code></span></dt>
                                                        <dd>
                                                            <p>Funzione utilizzata per eseguire attività prima della creazione del set di attività di sostituzione.</p>
                                                            <p><em>Required</em>: No</p>
                                                        </dd>
                                                     
                                                        <dt><span class="term"><code class="code">AfterInstall</code></span></dt>
                                                        <dd>
                                                            <p>Funzione utilizzata per eseguire attività dopo che il set di attività di sostituzione è stato creato e a esso è stato associato uno dei gruppi target.</p>
                                                            <p><em>Required</em>: No</p>
                                                        </dd>
                                                     
                                                        <dt><span class="term"><code class="code">AfterAllowTestTraffic</code></span></dt>
                                                        <dd>
                                                            <p>Funzione utilizzata per eseguire attività dopo che il listener di test ha indirizzato il traffico verso il set di attività di sostituzione.</p>
                                                            <p><em>Required</em>: No</p>
                                                        </dd>
                                                     
                                                        <dt><span class="term"><code class="code">BeforeAllowTraffic</code></span></dt>
                                                        <dd>
                                                            <p>Funzione utilizzata per eseguire attività dopo che il secondo gruppo target è stato associato al set di attività di sostituzione, ma prima che il traffico venga reindirizzato al set di attività di sostituzione.</p>
                                                            <p><em>Required</em>: No</p>
                                                        </dd>
                                                     
                                                        <dt><span class="term"><code class="code">AfterAllowTraffic</code></span></dt>
                                                        <dd>
                                                            <p>Funzione utilizzata per eseguire attività dopo che il secondo gruppo target ha indirizzato il traffico verso il set di attività di sostituzione.</p>
                                                            <p><em>Required</em>: No</p>
                                                        </dd>
                                                    </dl></div>
                                            </dd>
                                         
                                            <dt><span class="term"><code class="code">ServiceRole</code></span></dt>
                                            <dd>
                                                <p>Il ruolo di esecuzione  CloudFormation  da utilizzare per eseguire le distribuzioni blu-verdi. Per un elenco delle autorizzazioni necessarie, vedere. <a href="#blue-green-iam">Autorizzazioni IAM necessarie per le distribuzioni blu/verde</a></p>
                                                <p><em>Campo obbligatorio</em>: sì</p>
                                            </dd>
                                         
                                            <dt><span class="term"><code class="code">Applications</code></span></dt>
                                            <dd>
                                                <p>Specifica le proprietà dell'applicazione Amazon ECS.</p>
                                                <p><em>Campo obbligatorio</em>: sì</p>
                                                <div class="variablelist">
                                                     
                                                     
                                                <dl>
                                                        <dt><span class="term"><code class="code">Target</code></span></dt>
                                                        <dd>
                                                            <p></p>
                                                            <p><em>Campo obbligatorio</em>: sì</p>
                                                            <div class="variablelist">
                                                                 
                                                                 
                                                            <dl>
                                                                    <dt><span class="term"><code class="code">Type</code></span></dt>
                                                                    <dd>
                                                                        <p>Il tipo di risorsa.</p>
                                                                        <p><em>Campo obbligatorio</em>: sì</p>
                                                                    </dd>
                                                                 
                                                                    <dt><span class="term"><code class="code">LogicalID</code></span></dt>
                                                                    <dd>
                                                                        <p>L'ID logico della risorsa.</p>
                                                                        <p><em>Campo obbligatorio</em>: sì</p>
                                                                    </dd>
                                                                </dl></div>
                                                        </dd>
                                                     
                                                        <dt><span class="term"><code class="code">ECSAttributes</code></span></dt>
                                                        <dd>
                                                            <p>Le risorse che rappresentano i vari requisiti della distribuzione dell'applicazione Amazon ECS.</p>
                                                            <p><em>Campo obbligatorio</em>: sì</p>
                                                            <div class="variablelist">
                                                                 
                                                                 
                                                                 
                                                            <dl>
                                                                    <dt><span class="term"><code class="code">TaskDefinitions</code></span></dt>
                                                                    <dd>
                                                                        <p>ID logico della risorsa <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-resource-ecs-taskdefinition.html"><code class="code">AWS::ECS::TaskDefinition</code></a> per eseguire il container Docker che contiene l'applicazione Amazon ECS.</p>
                                                                        <p><em>Campo obbligatorio</em>: sì</p>
                                                                    </dd>
                                                                 
                                                                    <dt><span class="term"><code class="code">TaskSets</code></span></dt>
                                                                    <dd>
                                                                        <p>ID logici delle risorse <code class="code">AWS::ECS::TaskSet</code> da utilizzare come set di attività per l'applicazione.</p>
                                                                        <p><em>Campo obbligatorio</em>: sì</p>
                                                                    </dd>
                                                                 
                                                                    <dt><span class="term"><code class="code">TrafficRouting</code></span></dt>
                                                                    <dd>
                                                                        <p>Specifica le risorse utilizzate per l'instradamento del traffico.</p>
                                                                        <p><em>Campo obbligatorio</em>: sì</p>
                                                                        <div class="variablelist">
                                                                             
                                                                             
                                                                             
                                                                        <dl>
                                                                                <dt><span class="term"><code class="code">ProdTrafficRoute</code></span></dt>
                                                                                <dd>
                                                                                    <p>Il listener che viene utilizzato dal load balancer per indirizzare il traffico verso i gruppi target.</p>
                                                                                    <p><em>Campo obbligatorio</em>: sì</p>
                                                                                    <div class="variablelist">
                                                                                         
                                                                                         
                                                                                    <dl>
                                                                                            <dt><span class="term"><code class="code">Type</code></span></dt>
                                                                                            <dd>
                                                                                                <p>Il tipo di risorsa. <code class="code">AWS::ElasticLoadBalancingV2::Listener</code></p>
                                                                                                <p><em>Campo obbligatorio</em>: sì</p>
                                                                                            </dd>
                                                                                         
                                                                                            <dt><span class="term"><code class="code">LogicalID</code></span></dt>
                                                                                            <dd>
                                                                                                <p>L'ID logico della risorsa.</p>
                                                                                                <p><em>Campo obbligatorio</em>: sì</p>
                                                                                            </dd>
                                                                                        </dl></div>
                                                                                </dd>
                                                                             
                                                                                <dt><span class="term"><code class="code">TestTrafficRoute</code></span></dt>
                                                                                <dd>
                                                                                    <p>Il listener che viene utilizzato dal load balancer per indirizzare il traffico verso i gruppi target.</p>
                                                                                    <p><em>Campo obbligatorio</em>: sì</p>
                                                                                    <div class="variablelist">
                                                                                         
                                                                                         
                                                                                    <dl>
                                                                                            <dt><span class="term"><code class="code">Type</code></span></dt>
                                                                                            <dd>
                                                                                                <p>Il tipo di risorsa. <code class="code">AWS::ElasticLoadBalancingV2::Listener</code></p>
                                                                                                <p><em>Campo obbligatorio</em>: sì</p>
                                                                                            </dd>
                                                                                         
                                                                                            <dt><span class="term"><code class="code">LogicalID</code></span></dt>
                                                                                            <dd>
                                                                                                <p>L'ID logico della risorsa.</p>
                                                                                                <p><em>Required</em>: No</p>
                                                                                            </dd>
                                                                                        </dl></div>
                                                                                </dd>
                                                                             
                                                                                <dt><span class="term"><code class="code">TargetGroups</code></span></dt>
                                                                                <dd>
                                                                                    <p>ID logico delle risorse da utilizzare come target per instradare il traffico al target registrato.</p>
                                                                                    <p><em>Campo obbligatorio</em>: sì</p>
                                                                                </dd>
                                                                            </dl></div>
                                                                    </dd>
                                                                </dl></div>
                                                        </dd>
                                                    </dl></div>
                                            </dd>
                                        </dl></div>
                                </dd>
                            </dl></div>
                    </dd>
                    
                 
                    <dt><span class="term"><code class="code">Type</code></span></dt>
                    <dd>
                        <p>Il tipo di hook. <code class="code">AWS::ElasticLoadBalancingV2::Listener</code></p>
                        <p><em>Campo obbligatorio</em>: sì</p>
                    </dd>
                </dl></div>
         
     
        <h2 id="blue-green-iam">Autorizzazioni IAM necessarie per le distribuzioni blu/verde</h2>
        <p> CloudFormation Per eseguire correttamente le distribuzioni blu-verdi, è necessario disporre delle seguenti autorizzazioni:  CodeDeploy </p>
        <div class="itemizedlist">
             
             
        <ul class="itemizedlist"><li class="listitem"><p><code class="code">codedeploy:Get*</code></p></li><li class="listitem"><p><code class="code">codedeploy:CreateCloudFormationDeployment</code></p></li></ul></div>
        <p>Per ulteriori informazioni, vedere <a href="https://docs.aws.amazon.com/IAM/latest/UserGuide/list_awscodedeploy.html">Azioni, risorse e chiavi di condizione  CodeDeploy</a> nella <em>AWSIdentity and Access Management User Guide</em>.</p>
     
        <h2 id="blue-green-template-example">Esempio di modello</h2>
        <p>L'esempio seguente configura un'implementazione ECS blu/verde CodeDeploy, con un avanzamento del routing del traffico del 15% per fase, con un periodo di stabilizzazione di 5 minuti tra ogni passaggio. La creazione di uno stack con il modello prevede il provisioning della configurazione iniziale della distribuzione.</p>
        <p>Se poi si apportano modifiche alle proprietà della <code class="code">"BlueTaskSet"</code> risorsa che richiedono la sostituzione di tale risorsa,  CloudFormation  viene avviata una distribuzione ecologica come parte dell'aggiornamento dello stack.</p>
        <div id="JSON" name="JSON" class="section langfilter">
            <h3 id="blue-green-template-example.json">JSON</h3>
<pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copia"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
    "Parameters": <span>{</span>
        "Vpc": <span>{</span>
            "Type": "AWS::EC2::VPC::Id"
        },
        "Subnet1": <span>{</span>
            "Type": "AWS::EC2::Subnet::Id"
        },
        "Subnet2": <span>{</span>
            "Type": "AWS::EC2::Subnet::Id"
        }
    },
    "Transform": [
        "AWS::CodeDeployBlueGreen"
    ],
    "Hooks": <span>{</span>
        "CodeDeployBlueGreenHook": <span>{</span>
            "Properties": <span>{</span>
                "TrafficRoutingConfig": <span>{</span>
                    "Type": "TimeBasedCanary",
                    "TimeBasedCanary": <span>{</span>
                        "StepPercentage": 15,
                        "BakeTimeMins": 5
                    }
                },
                "Applications": [
                    <span>{</span>
                        "Target": <span>{</span>
                            "Type": "AWS::ECS::Service",
                            "LogicalID": "ECSDemoService"
                        },
                        "ECSAttributes": <span>{</span>
                            "TaskDefinitions": [
                                "BlueTaskDefinition",
                                "GreenTaskDefinition"
                            ],
                            "TaskSets": [
                                "BlueTaskSet",
                                "GreenTaskSet"
                            ],
                            "TrafficRouting": <span>{</span>
                                "ProdTrafficRoute": <span>{</span>
                                    "Type": "AWS::ElasticLoadBalancingV2::Listener",
                                    "LogicalID": "ALBListenerProdTraffic"
                                },
                                "TargetGroups": [
                                    "ALBTargetGroupBlue",
                                    "ALBTargetGroupGreen"
                                ]
                            }
                        }
                    }
                ]
            },
            "Type": "AWS::CodeDeploy::BlueGreen"
        }
    },
    "Resources": <span>{</span>
        "ExampleSecurityGroup": <span>{</span>
            "Type": "AWS::EC2::SecurityGroup",
            "Properties": <span>{</span>
                "GroupDescription": "Security group for ec2 access",
                "VpcId": <span>{</span>
                    "Ref": "Vpc"
                },
                "SecurityGroupIngress": [
                    <span>{</span>
                        "IpProtocol": "tcp",
                        "FromPort": 80,
                        "ToPort": 80,
                        "CidrIp": "0.0.0.0/0"
                    },
                    <span>{</span>
                        "IpProtocol": "tcp",
                        "FromPort": 8080,
                        "ToPort": 8080,
                        "CidrIp": "0.0.0.0/0"
                    },
                    <span>{</span>
                        "IpProtocol": "tcp",
                        "FromPort": 22,
                        "ToPort": 22,
                        "CidrIp": "0.0.0.0/0"
                    }
                ]
            }
        },
        "ALBTargetGroupBlue": <span>{</span>
            "Type": "AWS::ElasticLoadBalancingV2::TargetGroup",
            "Properties": <span>{</span>
                "HealthCheckIntervalSeconds": 5,
                "HealthCheckPath": "/",
                "HealthCheckPort": "80",
                "HealthCheckProtocol": "HTTP",
                "HealthCheckTimeoutSeconds": 2,
                "HealthyThresholdCount": 2,
                "Matcher": <span>{</span>
                    "HttpCode": "200"
                },
                "Port": 80,
                "Protocol": "HTTP",
                "Tags": [
                    <span>{</span>
                        "Key": "Group",
                        "Value": "Example"
                    }
                ],
                "TargetType": "ip",
                "UnhealthyThresholdCount": 4,
                "VpcId": <span>{</span>
                    "Ref": "Vpc"
                }
            }
        },
        "ALBTargetGroupGreen": <span>{</span>
            "Type": "AWS::ElasticLoadBalancingV2::TargetGroup",
            "Properties": <span>{</span>
                "HealthCheckIntervalSeconds": 5,
                "HealthCheckPath": "/",
                "HealthCheckPort": "80",
                "HealthCheckProtocol": "HTTP",
                "HealthCheckTimeoutSeconds": 2,
                "HealthyThresholdCount": 2,
                "Matcher": <span>{</span>
                    "HttpCode": "200"
                },
                "Port": 80,
                "Protocol": "HTTP",
                "Tags": [
                    <span>{</span>
                        "Key": "Group",
                        "Value": "Example"
                    }
                ],
                "TargetType": "ip",
                "UnhealthyThresholdCount": 4,
                "VpcId": <span>{</span>
                    "Ref": "Vpc"
                }
            }
        },
        "ExampleALB": <span>{</span>
            "Type": "AWS::ElasticLoadBalancingV2::LoadBalancer",
            "Properties": <span>{</span>
                "Scheme": "internet-facing",
                "SecurityGroups": [
                    <span>{</span>
                        "Ref": "ExampleSecurityGroup"
                    }
                ],
                "Subnets": [
                    <span>{</span>
                        "Ref": "Subnet1"
                    },
                    <span>{</span>
                        "Ref": "Subnet2"
                    }
                ],
                "Tags": [
                    <span>{</span>
                        "Key": "Group",
                        "Value": "Example"
                    }
                ],
                "Type": "application",
                "IpAddressType": "ipv4"
            }
        },
        "ALBListenerProdTraffic": <span>{</span>
            "Type": "AWS::ElasticLoadBalancingV2::Listener",
            "Properties": <span>{</span>
                "DefaultActions": [
                    <span>{</span>
                        "Type": "forward",
                        "ForwardConfig": <span>{</span>
                            "TargetGroups": [
                                <span>{</span>
                                    "TargetGroupArn": <span>{</span>
                                        "Ref": "ALBTargetGroupBlue"
                                    },
                                    "Weight": 1
                                }
                            ]
                        }
                    }
                ],
                "LoadBalancerArn": <span>{</span>
                    "Ref": "ExampleALB"
                },
                "Port": 80,
                "Protocol": "HTTP"
            }
        },
        "ALBListenerProdRule": <span>{</span>
            "Type": "AWS::ElasticLoadBalancingV2::ListenerRule",
            "Properties": <span>{</span>
                "Actions": [
                    <span>{</span>
                        "Type": "forward",
                        "ForwardConfig": <span>{</span>
                            "TargetGroups": [
                                <span>{</span>
                                    "TargetGroupArn": <span>{</span>
                                        "Ref": "ALBTargetGroupBlue"
                                    },
                                    "Weight": 1
                                }
                            ]
                        }
                    }
                ],
                "Conditions": [
                    <span>{</span>
                        "Field": "http-header",
                        "HttpHeaderConfig": <span>{</span>
                            "HttpHeaderName": "User-Agent",
                            "Values": [
                                "Mozilla"
                            ]
                        }
                    }
                ],
                "ListenerArn": <span>{</span>
                    "Ref": "ALBListenerProdTraffic"
                },
                "Priority": 1
            }
        },
        "ECSTaskExecutionRole": <span>{</span>
            "Type": "AWS::IAM::Role",
            "Properties": <span>{</span>
                "AssumeRolePolicyDocument": <span>{</span>
                    "Version": "2012-10-17",
                    "Statement": [
                        <span>{</span>
                            "Sid": "",
                            "Effect": "Allow",
                            "Principal": <span>{</span>
                                "Service": "ecs-tasks.amazonaws.com"
                            },
                            "Action": "sts:AssumeRole"
                        }
                    ]
                },
                "ManagedPolicyArns": [
                    "arn:aws:iam::aws:policy/service-role/AmazonECSTaskExecutionRolePolicy"
                ]
            }
        },
        "BlueTaskDefinition": <span>{</span>
            "Type": "AWS::ECS::TaskDefinition",
            "Properties": <span>{</span>
                "ExecutionRoleArn": <span>{</span>
                    "Fn::GetAtt": [
                        "ECSTaskExecutionRole",
                        "Arn"
                    ]
                },
                "ContainerDefinitions": [
                    <span>{</span>
                        "Name": "DemoApp",
                        "Image": "nginxdemos/hello:latest",
                        "Essential": true,
                        "PortMappings": [
                            <span>{</span>
                                "HostPort": 80,
                                "Protocol": "tcp",
                                "ContainerPort": 80
                            }
                        ]
                    }
                ],
                "RequiresCompatibilities": [
                    "FARGATE"
                ],
                "NetworkMode": "awsvpc",
                "Cpu": "256",
                "Memory": "512",
                "Family": "ecs-demo"
            }
        },
        "ECSDemoCluster": <span>{</span>
            "Type": "AWS::ECS::Cluster",
            "Properties": <span>{</span>}
        },
        "ECSDemoService": <span>{</span>
            "Type": "AWS::ECS::Service",
            "Properties": <span>{</span>
                "Cluster": <span>{</span>
                    "Ref": "ECSDemoCluster"
                },
                "DesiredCount": 1,
                "DeploymentController": <span>{</span>
                    "Type": "EXTERNAL"
                }
            }
        },
        "BlueTaskSet": <span>{</span>
            "Type": "AWS::ECS::TaskSet",
            "Properties": <span>{</span>
                "Cluster": <span>{</span>
                    "Ref": "ECSDemoCluster"
                },
                "LaunchType": "FARGATE",
                "NetworkConfiguration": <span>{</span>
                    "AwsVpcConfiguration": <span>{</span>
                        "AssignPublicIp": "ENABLED",
                        "SecurityGroups": [
                            <span>{</span>
                                "Ref": "ExampleSecurityGroup"
                            }
                        ],
                        "Subnets": [
                            <span>{</span>
                                "Ref": "Subnet1"
                            },
                            <span>{</span>
                                "Ref": "Subnet2"
                            }
                        ]
                    }
                },
                "PlatformVersion": "1.4.0",
                "Scale": <span>{</span>
                    "Unit": "PERCENT",
                    "Value": 100
                },
                "Service": <span>{</span>
                    "Ref": "ECSDemoService"
                },
                "TaskDefinition": <span>{</span>
                    "Ref": "BlueTaskDefinition"
                },
                "LoadBalancers": [
                    <span>{</span>
                        "ContainerName": "DemoApp",
                        "ContainerPort": 80,
                        "TargetGroupArn": <span>{</span>
                            "Ref": "ALBTargetGroupBlue"
                        }
                    }
                ]
            }
        },
        "PrimaryTaskSet": <span>{</span>
            "Type": "AWS::ECS::PrimaryTaskSet",
            "Properties": <span>{</span>
                "Cluster": <span>{</span>
                    "Ref": "ECSDemoCluster"
                },
                "Service": <span>{</span>
                    "Ref": "ECSDemoService"
                },
                "TaskSetId": <span>{</span>
                    "Fn::GetAtt": [
                        "BlueTaskSet",
                        "Id"
                    ]
                }
            }
        }
    }
}</code></pre>

        </div>
        <div id="YAML" name="YAML" class="section langfilter">
            <h3 id="blue-green-template-example.yaml">YAML</h3>
            <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copia"><awsui-icon name="copy"></awsui-icon></div></div><code class="yaml ">Parameters:
  Vpc:
    Type: 'AWS::EC2::VPC::Id'
  Subnet1:
    Type: 'AWS::EC2::Subnet::Id'
  Subnet2:
    Type: 'AWS::EC2::Subnet::Id'
Transform:
  - 'AWS::CodeDeployBlueGreen'
Hooks:
  CodeDeployBlueGreenHook:
    Properties:
      TrafficRoutingConfig:
        Type: TimeBasedCanary
        TimeBasedCanary:
          StepPercentage: 15
          BakeTimeMins: 5
      Applications:
        - Target:
            Type: 'AWS::ECS::Service'
            LogicalID: ECSDemoService
          ECSAttributes:
            TaskDefinitions:
              - BlueTaskDefinition
              - GreenTaskDefinition
            TaskSets:
              - BlueTaskSet
              - GreenTaskSet
            TrafficRouting:
              ProdTrafficRoute:
                Type: 'AWS::ElasticLoadBalancingV2::Listener'
                LogicalID: ALBListenerProdTraffic
              TargetGroups:
                - ALBTargetGroupBlue
                - ALBTargetGroupGreen
    Type: 'AWS::CodeDeploy::BlueGreen'
Resources:
  ExampleSecurityGroup:
    Type: 'AWS::EC2::SecurityGroup'
    Properties:
      GroupDescription: Security group for ec2 access
      VpcId: !Ref Vpc
      SecurityGroupIngress:
        - IpProtocol: tcp
          FromPort: 80
          ToPort: 80
          CidrIp: 0.0.0.0/0
        - IpProtocol: tcp
          FromPort: 8080
          ToPort: 8080
          CidrIp: 0.0.0.0/0
        - IpProtocol: tcp
          FromPort: 22
          ToPort: 22
          CidrIp: 0.0.0.0/0
  ALBTargetGroupBlue:
    Type: 'AWS::ElasticLoadBalancingV2::TargetGroup'
    Properties:
      HealthCheckIntervalSeconds: 5
      HealthCheckPath: /
      HealthCheckPort: '80'
      HealthCheckProtocol: HTTP
      HealthCheckTimeoutSeconds: 2
      HealthyThresholdCount: 2
      Matcher:
        HttpCode: '200'
      Port: 80
      Protocol: HTTP
      Tags:
        - Key: Group
          Value: Example
      TargetType: ip
      UnhealthyThresholdCount: 4
      VpcId: !Ref Vpc
  ALBTargetGroupGreen:
    Type: 'AWS::ElasticLoadBalancingV2::TargetGroup'
    Properties:
      HealthCheckIntervalSeconds: 5
      HealthCheckPath: /
      HealthCheckPort: '80'
      HealthCheckProtocol: HTTP
      HealthCheckTimeoutSeconds: 2
      HealthyThresholdCount: 2
      Matcher:
        HttpCode: '200'
      Port: 80
      Protocol: HTTP
      Tags:
        - Key: Group
          Value: Example
      TargetType: ip
      UnhealthyThresholdCount: 4
      VpcId: !Ref Vpc
  ExampleALB:
    Type: 'AWS::ElasticLoadBalancingV2::LoadBalancer'
    Properties:
      Scheme: internet-facing
      SecurityGroups:
        - !Ref ExampleSecurityGroup
      Subnets:
        - !Ref Subnet1
        - !Ref Subnet2
      Tags:
        - Key: Group
          Value: Example
      Type: application
      IpAddressType: ipv4
  ALBListenerProdTraffic:
    Type: 'AWS::ElasticLoadBalancingV2::Listener'
    Properties:
      DefaultActions:
        - Type: forward
          ForwardConfig:
            TargetGroups:
              - TargetGroupArn: !Ref ALBTargetGroupBlue
                Weight: 1
      LoadBalancerArn: !Ref ExampleALB
      Port: 80
      Protocol: HTTP
  ALBListenerProdRule:
    Type: 'AWS::ElasticLoadBalancingV2::ListenerRule'
    Properties:
      Actions:
        - Type: forward
          ForwardConfig:
            TargetGroups:
              - TargetGroupArn: !Ref ALBTargetGroupBlue
                Weight: 1
      Conditions:
        - Field: http-header
          HttpHeaderConfig:
            HttpHeaderName: User-Agent
            Values:
              - Mozilla
      ListenerArn: !Ref ALBListenerProdTraffic
      Priority: 1
  ECSTaskExecutionRole:
    Type: 'AWS::IAM::Role'
    Properties:
      AssumeRolePolicyDocument:
        Version: 2012-10-17
        Statement:
          - Sid: ''
            Effect: Allow
            Principal:
              Service: ecs-tasks.amazonaws.com
            Action: 'sts:AssumeRole'
      ManagedPolicyArns:
        - 'arn:aws:iam::aws:policy/service-role/AmazonECSTaskExecutionRolePolicy'
  BlueTaskDefinition:
    Type: 'AWS::ECS::TaskDefinition'
    Properties:
      ExecutionRoleArn: !GetAtt 
        - ECSTaskExecutionRole
        - Arn
      ContainerDefinitions:
        - Name: DemoApp
          Image: 'nginxdemos/hello:latest'
          Essential: true
          PortMappings:
            - HostPort: 80
              Protocol: tcp
              ContainerPort: 80
      RequiresCompatibilities:
        - FARGATE
      NetworkMode: awsvpc
      Cpu: '256'
      Memory: '512'
      Family: ecs-demo
  ECSDemoCluster:
    Type: 'AWS::ECS::Cluster'
    Properties: <span>{</span>}
  ECSDemoService:
    Type: 'AWS::ECS::Service'
    Properties:
      Cluster: !Ref ECSDemoCluster
      DesiredCount: 1
      DeploymentController:
        Type: EXTERNAL
  BlueTaskSet:
    Type: 'AWS::ECS::TaskSet'
    Properties:
      Cluster: !Ref ECSDemoCluster
      LaunchType: FARGATE
      NetworkConfiguration:
        AwsVpcConfiguration:
          AssignPublicIp: ENABLED
          SecurityGroups:
            - !Ref ExampleSecurityGroup
          Subnets:
            - !Ref Subnet1
            - !Ref Subnet2
      PlatformVersion: 1.4.0
      Scale:
        Unit: PERCENT
        Value: 100
      Service: !Ref ECSDemoService
      TaskDefinition: !Ref BlueTaskDefinition
      LoadBalancers:
        - ContainerName: DemoApp
          ContainerPort: 80
          TargetGroupArn: !Ref ALBTargetGroupBlue
  PrimaryTaskSet:
    Type: 'AWS::ECS::PrimaryTaskSet'
    Properties:
      Cluster: !Ref ECSDemoCluster
      Service: !Ref ECSDemoService
      TaskSetId: !GetAtt 
        - BlueTaskSet
        - Id</code></pre>
        </div>
    <awsdocs-copyright class="copyright-print"></awsdocs-copyright><awsdocs-thumb-feedback right-edge="{{$ctrl.thumbFeedbackRightEdge}}"></awsdocs-thumb-feedback></div><noscript><div><div><div><div id="js_error_message"><p><img src="https://d1ge0kk1l5kms0.cloudfront.net/images/G/01/webservices/console/warning.png" alt="Avvertimento" /> <strong>JavaScript è disabilitato o non è disponibile nel tuo browser.</strong></p><p>Per usare la documentazione AWS, JavaScript deve essere abilitato. Consulta le pagine della guida del browser per le istruzioni.</p></div></div></div></div></noscript><div id="main-col-footer" class="awsui-util-font-size-0"><div id="doc-conventions"><a target="_top" href="/general/latest/gr/docconventions.html">Convenzioni dei documenti</a></div><div class="prev-next"><div id="previous" class="prev-link" accesskey="p" href="./modules.html">Utilizzo dei moduli</div><div id="next" class="next-link" accesskey="n" href="./cfn-regexes.html">Utilizzo di espressioni regolari</div></div></div><awsdocs-page-utilities></awsdocs-page-utilities></div><div id="quick-feedback-yes" style="display: none;"><div class="title">Questa pagina ti è stata utile? - Sì</div><div class="content"><p>Grazie per averci comunicato che stiamo facendo un buon lavoro!</p><p>Se hai un momento, ti invitiamo a dirci che cosa abbiamo fatto che ti è piaciuto così possiamo offrirti altri contenuti simili.</p><p><awsui-button id="fblink" rel="noopener noreferrer" target="_blank" text="Feedback" click="linkClick($event)" href="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=CloudFormation&amp;topic_url=https://docs.aws.amazon.com/it_it/AWSCloudFormation/latest/UserGuide/blue-green.html"></awsui-button></p></div></div><div id="quick-feedback-no" style="display: none;"><div class="title">Questa pagina ti è stata utile? - No</div><div class="content"><p>Grazie per averci comunicato che questa pagina ha bisogno di essere modificata. Siamo spiacenti di non aver soddisfatto le tue esigenze.</p><p>Se hai un momento, ti invitiamo a dirci come possiamo migliorare la documentazione.</p><p><awsui-button id="fblink" rel="noopener noreferrer" target="_blank" text="Feedback" click="linkClick($event)" href="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=CloudFormation&amp;topic_url=https://docs.aws.amazon.com/it_it/AWSCloudFormation/latest/UserGuide/blue-green.html"></awsui-button></p></div></div></div></body></div></awsdocs-view><div class="page-loading-indicator" id="page-loading-indicator"><awsui-spinner size="large"></awsui-spinner></div></div><div id="tools-panel" dom-region="tools"><awsdocs-tools-panel id="awsdocs-tools-panel"></awsdocs-tools-panel></div></awsui-app-layout><awsdocs-cookie-banner class="doc-cookie-banner"></awsdocs-cookie-banner></div></body></html>