<!DOCTYPE html>
    <html xmlns="http://www.w3.org/1999/xhtml" lang="it-IT"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Spiegazione passo per passo: ricerca di ID di Amazon Machine Image - AWS CloudFormation</title><meta name="viewport" content="width=device-width,initial-scale=1" /><meta name="assets_root" content="/assets" /><meta name="target_state" content="walkthrough-custom-resources-lambda-lookup-amiids" /><meta name="default_state" content="walkthrough-custom-resources-lambda-lookup-amiids" /><link rel="icon" type="image/ico" href="/assets/images/favicon.ico" /><link rel="shortcut icon" type="image/ico" href="/assets/images/favicon.ico" /><link rel="canonical" href="https://docs.aws.amazon.com/it_it/AWSCloudFormation/latest/UserGuide/walkthrough-custom-resources-lambda-lookup-amiids.html" /><meta name="description" content="Utilizza AWS Lambda e una risorsa personalizzata per cercare dinamicamente gli ID di AMI." /><meta name="deployment_region" content="IAD" /><meta name="product" content="AWS CloudFormation" /><meta name="guide" content="Guida per l'utente" /><meta name="abstract" content="Crea e gestisci le implementazioni AWS dell'infrastruttura in modo prevedibile e ripetuto utilizzando questa guida per AWS CloudFormation l'utente." /><meta name="guide-locale" content="it_it" /><meta name="tocs" content="toc-contents.json" /><link rel="canonical" href="https://docs.aws.amazon.com/it_it/AWSCloudFormation/latest/UserGuide/walkthrough-custom-resources-lambda-lookup-amiids.html" /><link rel="alternative" href="https://docs.aws.amazon.com/id_id/AWSCloudFormation/latest/UserGuide/walkthrough-custom-resources-lambda-lookup-amiids.html" hreflang="id-id" /><link rel="alternative" href="https://docs.aws.amazon.com/id_id/AWSCloudFormation/latest/UserGuide/walkthrough-custom-resources-lambda-lookup-amiids.html" hreflang="id" /><link rel="alternative" href="https://docs.aws.amazon.com/de_de/AWSCloudFormation/latest/UserGuide/walkthrough-custom-resources-lambda-lookup-amiids.html" hreflang="de-de" /><link rel="alternative" href="https://docs.aws.amazon.com/de_de/AWSCloudFormation/latest/UserGuide/walkthrough-custom-resources-lambda-lookup-amiids.html" hreflang="de" /><link rel="alternative" href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/walkthrough-custom-resources-lambda-lookup-amiids.html" hreflang="en-us" /><link rel="alternative" href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/walkthrough-custom-resources-lambda-lookup-amiids.html" hreflang="en" /><link rel="alternative" href="https://docs.aws.amazon.com/es_es/AWSCloudFormation/latest/UserGuide/walkthrough-custom-resources-lambda-lookup-amiids.html" hreflang="es-es" /><link rel="alternative" href="https://docs.aws.amazon.com/es_es/AWSCloudFormation/latest/UserGuide/walkthrough-custom-resources-lambda-lookup-amiids.html" hreflang="es" /><link rel="alternative" href="https://docs.aws.amazon.com/fr_fr/AWSCloudFormation/latest/UserGuide/walkthrough-custom-resources-lambda-lookup-amiids.html" hreflang="fr-fr" /><link rel="alternative" href="https://docs.aws.amazon.com/fr_fr/AWSCloudFormation/latest/UserGuide/walkthrough-custom-resources-lambda-lookup-amiids.html" hreflang="fr" /><link rel="alternative" href="https://docs.aws.amazon.com/it_it/AWSCloudFormation/latest/UserGuide/walkthrough-custom-resources-lambda-lookup-amiids.html" hreflang="it-it" /><link rel="alternative" href="https://docs.aws.amazon.com/it_it/AWSCloudFormation/latest/UserGuide/walkthrough-custom-resources-lambda-lookup-amiids.html" hreflang="it" /><link rel="alternative" href="https://docs.aws.amazon.com/ja_jp/AWSCloudFormation/latest/UserGuide/walkthrough-custom-resources-lambda-lookup-amiids.html" hreflang="ja-jp" /><link rel="alternative" href="https://docs.aws.amazon.com/ja_jp/AWSCloudFormation/latest/UserGuide/walkthrough-custom-resources-lambda-lookup-amiids.html" hreflang="ja" /><link rel="alternative" href="https://docs.aws.amazon.com/ko_kr/AWSCloudFormation/latest/UserGuide/walkthrough-custom-resources-lambda-lookup-amiids.html" hreflang="ko-kr" /><link rel="alternative" href="https://docs.aws.amazon.com/ko_kr/AWSCloudFormation/latest/UserGuide/walkthrough-custom-resources-lambda-lookup-amiids.html" hreflang="ko" /><link rel="alternative" href="https://docs.aws.amazon.com/pt_br/AWSCloudFormation/latest/UserGuide/walkthrough-custom-resources-lambda-lookup-amiids.html" hreflang="pt-br" /><link rel="alternative" href="https://docs.aws.amazon.com/pt_br/AWSCloudFormation/latest/UserGuide/walkthrough-custom-resources-lambda-lookup-amiids.html" hreflang="pt" /><link rel="alternative" href="https://docs.aws.amazon.com/zh_cn/AWSCloudFormation/latest/UserGuide/walkthrough-custom-resources-lambda-lookup-amiids.html" hreflang="zh-cn" /><link rel="alternative" href="https://docs.aws.amazon.com/zh_tw/AWSCloudFormation/latest/UserGuide/walkthrough-custom-resources-lambda-lookup-amiids.html" hreflang="zh-tw" /><link rel="alternative" href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/walkthrough-custom-resources-lambda-lookup-amiids.html" hreflang="x-default" /><meta name="feedback-item" content="CloudFormation" /><meta name="this_doc_product" content="AWS CloudFormation" /><meta name="this_doc_guide" content="Guida per l'utente" /><script defer="" src="/assets/r/vendor4.js?version=2021.12.02"></script><script defer="" src="/assets/r/vendor3.js?version=2021.12.02"></script><script defer="" src="/assets/r/vendor1.js?version=2021.12.02"></script><script defer="" src="/assets/r/awsdocs-common.js?version=2021.12.02"></script><script defer="" src="/assets/r/awsdocs-doc-page.js?version=2021.12.02"></script><link href="/assets/r/vendor4.css?version=2021.12.02" rel="stylesheet" /><link href="/assets/r/awsdocs-common.css?version=2021.12.02" rel="stylesheet" /><link href="/assets/r/awsdocs-doc-page.css?version=2021.12.02" rel="stylesheet" /><script async="" id="awsc-panorama-bundle" type="text/javascript" src="https://prod.pa.cdn.uis.awsstatic.com/panorama-nav-init.js" data-config="{'appEntity':'aws-documentation','region':'us-east-1','service':'cloudformation'}"></script><meta id="panorama-serviceSubSection" value="Guida per l'utente" /><meta id="panorama-serviceConsolePage" value="Spiegazione passo per passo: ricerca di ID di Amazon Machine Image" /></head><body class="awsdocs awsui"><div class="awsdocs-container"><awsdocs-header></awsdocs-header><awsui-app-layout id="app-layout" class="awsui-util-no-gutters" ng-controller="ContentController as $ctrl" header-selector="awsdocs-header" navigation-hide="false" navigation-width="$ctrl.navWidth" navigation-open="$ctrl.navOpen" navigation-change="$ctrl.onNavChange($event)" tools-hide="$ctrl.hideTools" tools-width="$ctrl.toolsWidth" tools-open="$ctrl.toolsOpen" tools-change="$ctrl.onToolsChange($event)"><div id="guide-toc" dom-region="navigation"><awsdocs-toc></awsdocs-toc></div><div id="main-column" dom-region="content" tabindex="-1"><awsdocs-view class="awsdocs-view"><div id="awsdocs-content"><head><title>Spiegazione passo per passo: ricerca di ID di Amazon Machine Image - AWS CloudFormation</title><meta name="rss" content="aws-cloudformation-release-notes.rss" /><meta name="forums" content="http://forums.aws.amazon.com/forum.jspa?forumID=92" /><meta name="feedback" content="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=CloudFormation&amp;topic_url=https://docs.aws.amazon.com/it_it/AWSCloudFormation/latest/UserGuide/walkthrough-custom-resources-lambda-lookup-amiids.html" /><meta name="feedback-yes" content="feedbackyes.html?topic_url=https://docs.aws.amazon.com/it_it/AWSCloudFormation/latest/UserGuide/walkthrough-custom-resources-lambda-lookup-amiids.html" /><meta name="feedback-no" content="feedbackno.html?topic_url=https://docs.aws.amazon.com/it_it/AWSCloudFormation/latest/UserGuide/walkthrough-custom-resources-lambda-lookup-amiids.html" /><meta name="keywords" content="CloudFormation,AWSCloudFormation,provisioning delle risorse,configurazione delle risorse,gestione dell'infrastruttura,CloudFormer,CloudFormation pila,CloudFormation modello,set di modifiche" /><script type="application/ld+json">
{
    "@context" : "https://schema.org",
    "@type" : "BreadcrumbList",
    "itemListElement" : [
      {
        "@type" : "ListItem",
        "position" : 1,
        "name" : "AWS",
        "item" : "https://aws.amazon.com"
      },
      {
        "@type" : "ListItem",
        "position" : 2,
        "name" : "AWS CloudFormation",
        "item" : "https://docs.aws.amazon.com/cloudformation/index.html"
      },
      {
        "@type" : "ListItem",
        "position" : 3,
        "name" : "Guida per l'utente",
        "item" : "https://docs.aws.amazon.com/it_it/AWSCloudFormation/latest/UserGuide"
      },
      {
        "@type" : "ListItem",
        "position" : 4,
        "name" : "Utilizzo dei modelli AWS CloudFormation",
        "item" : "https://docs.aws.amazon.com/it_it/AWSCloudFormation/latest/UserGuide/template-guide.html"
      },
      {
        "@type" : "ListItem",
        "position" : 5,
        "name" : "Risorse personalizzate",
        "item" : "https://docs.aws.amazon.com/it_it/AWSCloudFormation/latest/UserGuide/template-custom-resources.html"
      },
      {
        "@type" : "ListItem",
        "position" : 6,
        "name" : "Risorse personalizzate supportate da AWS Lambda",
        "item" : "https://docs.aws.amazon.com/it_it/AWSCloudFormation/latest/UserGuide/template-custom-resources-lambda.html"
      },
      {
        "@type" : "ListItem",
        "position" : 7,
        "name" : "Spiegazione passo per passo: ricerca di ID di Amazon Machine Image",
        "item" : "https://docs.aws.amazon.com/it_it/AWSCloudFormation/latest/UserGuide/template-custom-resources-lambda.html"
      }
    ]
}
</script></head><body><div id="main"><div style="display: none"></div><div id="breadcrumbs" class="breadcrumb"><a href="https://aws.amazon.com">AWS</a><a href="/index.html">Documentazione</a><a href="/cloudformation/index.html">AWS CloudFormation</a><a href="Welcome.html">Guida per l'utente</a></div><div id="page-toc-src"><a href="#walkthrough-custom-resources-lambda-lookup-amiids-savesample">Fase 1: Download e salvataggio del pacchetto di esempio in Amazon S3</a><a href="#walkthrough-custom-resources-lambda-lookup-amiids-createfunction-createstack">Fase 2: Creazione dello stack</a><a href="#walkthrough-custom-resources-lambda-lookup-amiids-createfunction-cleanup">Fase 3: Eliminazione delle risorse</a><a href="#w9aac23c26c16b7c29">Informazioni correlate</a></div><div id="main-content" class="awsui-util-container"><div id="main-col-body"><awsdocs-language-banner data-service="$ctrl.pageService"></awsdocs-language-banner><awsui-alert class="awsdocs-page-banner awsui-util-mb-l"><p>Le traduzioni sono generate tramite traduzione automatica. In caso di conflitto tra il contenuto di una traduzione e la versione originale in Inglese, quest'ultima prevarrà.</p></awsui-alert><h1 class="topictitle" id="walkthrough-custom-resources-lambda-lookup-amiids">Spiegazione passo per passo: ricerca di ID di Amazon Machine Image</h1><div class="awsdocs-page-header-container"><awsdocs-page-header></awsdocs-page-header><awsdocs-filter-selector id="awsdocs-filter-selector"></awsdocs-filter-selector></div><p>I modelli AWS CloudFormation che dichiarano un'istanza Amazon Elastic Compute Cloud (Amazon EC2) devono anche specificare un ID Amazon Machine Image (AMI), che include un sistema operativo e altri informazioni sul software e sulla configurazione utilizzati per avviare l'istanza. L'AMI corretto ID dipende dal tipo di istanza e Regione in cui si sta avviando lo stack. Un ID può variare regolarmente, ad esempio quando un'AMI viene aggiornata con gli aggiornamenti software.</p><p>Di solito, puoi mappare gli ID delle AMI per determinati tipi di istanza e Regioni. Per aggiornare gli ID, li modifichi manualmente in ciascuno dei modelli. Utilizzando le risorse personalizzate e AWS Lambda (Lambda), puoi creare una funzione che ottiene gli ID delle AMI più recenti per il tipo di Regione e istanza che stai utilizzando per non dover mantenere mappature.</p><p>Questa procedura guidata illustra come creare una risorsa personalizzata e associarvi una funzione Lambda per ricercare gli ID AMI. Nota che la procedura guidata presuppone che sia chiaro come utilizzare Lambda e le risorse personalizzate. Per ulteriori informazioni, consulta <a href="./template-custom-resources.html">Risorse personalizzate</a> o la <a href="https://docs.aws.amazon.com/lambda/latest/dg/">Guida per gli sviluppatori di AWS Lambda</a>.</p><p>Panoramica della procedura guidata</p><p>Per questo scenario, potrai creare uno stack con una risorsa personalizzata, una funzione Lambda e un'istanza EC2. La procedura guidata fornisce un codice e un modello di esempio che potrai usare per creare lo stack.</p><p>Il modello di esempio utilizza il tipo di risorsa personalizzata per invocare e inviare valori di input alla funzione Lambda. Quando utilizzi il modello, AWS CloudFormation richiama la funzione e invia informazioni, quali il tipo di richiesta, i dati di input e un URL Amazon Simple Storage Service (Amazon S3) prefirmato. La funzione utilizza quelle informazioni per cercare l'ID AMI e invia una risposta all'URL prefirmato.</p><p>Dopo che AWS CloudFormation ottiene una risposta nella posizione dell'URL prefirmato, procede con la creazione dello stack. Quando AWS CloudFormation crea l'istanza, utilizza la risposta della funzione Lambda  per specificare l'ID AMI dell'istanza.</p><p>L'elenco seguente riepiloga il processo. Sono necessarie le autorizzazioni AWS Identity and Access Management (IAM) per l'utilizzo di tutti i servizi corrispondenti, ad esempio Lambda, Amazon EC2 e AWS CloudFormation.</p><div class="awsdocs-note"><div class="awsdocs-note-title"><awsui-icon name="status-info" variant="link"></awsui-icon><h6>Nota</h6></div><div class="awsdocs-note-text"><p>AWS CloudFormation è un servizio gratuito, tuttavia, ti verrà addebitato un costo per le risorse AWS, ad esempio la funzione Lambda e l'istanza EC2, che includi negli stack secondo la tariffa corrente di ognuno. Per ulteriori informazioni sui prezzi di AWS, visita la pagina dei dettagli per ogni prodotto all'indirizzo <a href="https://aws.amazon.com/" rel="noopener noreferrer" target="_blank"><span>http://aws.amazon.com</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a>.</p></div></div><div class="orderedlist">
     
     
     
  <ol><li>
      <p><a href="#walkthrough-custom-resources-lambda-lookup-amiids-savesample">Salva il pacchetto Lambda di esempio in un bucket Amazon Simple Storage Service (Amazon S3).</a></p>
      <p>Il pacchetto di esempio contiene tutto ciò che serve per creare la funzione Lambda. È necessario salvare il pacchetto in un bucket che si trova nella stessa Regione in cui creerai lo stack.</p>
    </li><li>
      <p><a href="#walkthrough-custom-resources-lambda-lookup-amiids-createfunction-createstack">Utilizza il modello di esempio per creare uno stack.</a></p>
      <p>Lo stack dimostra come associare la funzione Lambda a una risorsa personalizzata e come utilizzare i risultati dalla funzione per specificare un'ID AMI. Lo stack crea anche un ruolo IAM (ruolo di esecuzione), che Lambda utilizza per effettuare chiamate a Amazon EC2.</p>
    </li><li>
      <p><a href="#walkthrough-custom-resources-lambda-lookup-amiids-createfunction-cleanup">Eliminare lo stack.</a></p>
      <p>Elimina lo stack per cancellare tutte le risorse dello stack create in modo da non pagare per le risorse superflue.</p>
    </li></ol></div><h2 id="walkthrough-custom-resources-lambda-lookup-amiids-savesample">Fase 1: Download e salvataggio del pacchetto di esempio in Amazon S3</h2>
    
    <p>Quando crei uno stack con una funzione Lambda, devi specificare la posizione del bucket Amazon S3 contenente il codice sorgente della funzione. Il bucket deve trovarsi nella stessa Regione in cui crei lo stack.</p>
    <p>Questa procedura guidata fornisce un pacchetto di esempio (un file <code>.zip</code>) necessario per creare la funzione Lambda. Un pacchetto Lambda contiene il codice sorgente per la funzione e le librerie richieste. Per questa procedura guidata, la funzione non richiede librerie aggiuntive.</p>
    <p>La funzione utilizza l'architettura e la Regione di un'istanza come input da una richiesta di risorsa personalizzata AWS CloudFormation e restituisce la versione più recente dell'ID AMI a un URL Amazon S3 prefirmato.</p>
    <div class="procedure"><h6>Per scaricare e salvare il pacchetto in Amazon S3</h6><ol><li>
        <p>Scaricare il pacchetto di esempio da Amazon S3. Quando si salva il file, utilizzare lo stesso nome di file dell'esempio, <code>amilookup.zip</code> o <code>amilookup-win.zip</code>.</p>
        <div class="variablelist">
           
           
        <dl>
            <dt><b><span class="term">Cercare ID di AMI Linux</span></b></dt>
            <dd>
              <p><a href="https://s3.amazonaws.com/cloudformation-examples/lambda/amilookup.zip" rel="noopener noreferrer" target="_blank"><span>https://s3.amazonaws.com/cloudformation-examples/lambda/amilookup.zip</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a></p>
            </dd>
          
            <dt><b><span class="term">Cercare ID di AMI Windows</span></b></dt>
            <dd>
              <p><a href="https://s3.amazonaws.com/cloudformation-examples/lambda/amilookup-win.zip" rel="noopener noreferrer" target="_blank"><span>https://s3.amazonaws.com/cloudformation-examples/lambda/amilookup-win.zip</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a></p>
            </dd>
          </dl></div>
      </li><li>
        <p>Aprire la console Amazon S3 all'indirizzo <a href="https://console.aws.amazon.com/s3/home" rel="noopener noreferrer" target="_blank"><span>https://console.aws.amazon.com/s3/home</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a>.</p>
      </li><li>
        <p>Scegliere o creare un bucket che si trova nella stessa Regione nella quale si potrà creare lo stack AWS CloudFormation. Registrare il nome del bucket.</p>
        <p>Il pacchetto di esempio verrà salvato in questo bucket. Per ulteriori informazioni sulla creazione di un bucket, consulta <a href="https://docs.aws.amazon.com/AmazonS3/latest/user-guide/CreatingaBucket.html">Creazione di un bucket</a> nella <em>Guida per l'utente di Amazon Simple Storage Service</em>.</p>
      </li><li>
        <p>Caricare il pacchetto di esempio sul bucket scelto o creato.</p>
        <p>Per ulteriori informazioni sul caricamento di oggetti, consulta <a href="https://docs.aws.amazon.com/AmazonS3/latest/user-guide/UploadingObjectsintoAmazonS3.html">Caricamento degli oggetti</a> nella <em>Guida per l'utente di Amazon Simple Storage Service</em>.</p>
      </li></ol></div>
    <p>Con il pacchetto in Amazon S3, adesso puoi specificarne la posizione nella dichiarazione della risorsa Lambda del modello AWS CloudFormation. Il prossimo passaggio dimostra come dichiarare la funzione e richiamarla utilizzando una risorsa personalizzata. Vedrai anche come utilizzare i risultati dalla funzione per specificare l'ID AMI di un'istanza EC2.</p>
   
   <h2 id="walkthrough-custom-resources-lambda-lookup-amiids-createfunction-createstack">Fase 2: Creazione dello stack</h2>
    
    <p>Per creare lo stack Amazon EC2 di esempio, potrai utilizzare un modello di esempio che include una funzione Lambda, un ruolo di esecuzione IAM, una risorsa personalizzata che richiama la funzione e un'istanza EC2 che utilizza i risultati dalla funzione.</p>
    <p>Durante la creazione dello stack, la risorsa personalizzata richiama la funzione Lambda e attende finché la funzione invia una risposta all'URL Amazon S3 prefirmato. Nella risposta, la funzione restituisce l'ID dell'ultima AMI che corrisponde al tipo di istanza e la Regione EC2 nella quale stai creando l'istanza. I dati dalla risposta della funzione vengono memorizzati come un attributo della risorsa personalizzata, che viene utilizzato per specificare l'ID AMI dell'istanza EC2.</p>
    <p>I seguenti frammenti spiegano le parti rilevanti del modello di esempio per aiutarti a capire come associare una funzione Lambda a una risorsa personalizzata e come utilizzare la risposta della funzione.</p>
    <p>Per visualizzare l'intero modello di esempio, consulta:</p>
    <div class="variablelist">
       
       
    <dl>
        <dt><b><span class="term">Modello di Linux</span></b></dt>
        <dd>
          <p><a href="https://s3.amazonaws.com/cloudformation-examples/lambda/LambdaAMILookupSample.template" rel="noopener noreferrer" target="_blank"><span>https://s3.amazonaws.com/cloudformation-examples/lambda/LambdaAMI LookupSample .modello</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a></p>
        </dd>
      
        <dt><b><span class="term">Modello di Windows</span></b></dt>
        <dd>
          <p><a href="https://s3.amazonaws.com/cloudformation-examples/lambda/LambdaAMILookupSample-win.template" rel="noopener noreferrer" target="_blank"><span>https://s3.amazonaws.com/cloudformation-examples/lambda/LambdaAMI LookupSample -win.template</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a></p>
        </dd>
      </dl></div>
    <p>Frammenti di modello stack</p>
    <p>Per creare la funzione Lambda, dichiari la risorsa <code class="code">AWS::Lambda::Function</code>, che richiede il codice sorgente, il nome del gestore, l'ambiente di runtime e il ruolo di esecuzione ARN della funzione.</p>
    <div class="example"><h6>Esempio Sintassi JSON</h6><div class="example-contents"><pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copia"><awsui-icon name="copy"></awsui-icon></div></div><code class="json ">"AMIInfoFunction": <span>{</span>
  "Type": "AWS::Lambda::Function",
  "Properties": <span>{</span>
    "Code": <span>{</span>
      "S3Bucket": <span>{</span> "Ref": "S3Bucket" },
      "S3Key": <span>{</span> "Ref": "S3Key" }
    },
    "Handler": <span>{</span> "Fn::Join" : [ "", [<span>{</span> "Ref": "ModuleName" },".handler"] ] },
    "Runtime": "nodejs18.x",
    "Timeout": "30",
    "Role": <span>{</span> "Fn::GetAtt" : ["LambdaExecutionRole", "Arn"] }
  }
}</code></pre></div></div>
    <div class="example"><h6>Esempio Sintassi YAML</h6><div class="example-contents"><pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copia"><awsui-icon name="copy"></awsui-icon></div></div><code class="yaml ">AMIInfoFunction:
  Type: AWS::Lambda::Function
  Properties:
    Code:
      S3Bucket: !Ref S3Bucket
      S3Key: !Ref S3Key
    Handler: !Sub "$<span>{</span>ModuleName}.handler"
    Runtime: nodejs18.x
    Timeout: 30
    Role: !GetAtt LambdaExecutionRole.Arn</code></pre></div></div>
    <p>La proprietà <code class="code">Code</code> specifica la posizione Amazon S3 (nome del bucket e nome del file), dove è caricato il pacchetto di esempio. Il modello di esempio utilizza i parametri di input (<code class="code">"Ref":
        "S3Bucket"</code> e <code class="code">"Ref": "S3Key"</code>) per impostare il bucket e i nomi dei file in modo che sia possibile specificare i nomi al momento della creazione dello stack. Analogamente, anche il nome del gestore, che corrisponde al nome del file sorgente (il  JavaScript  file) nel <code>.zip</code> pacchetto, utilizza un parametro di input (). <code class="code">"Ref":
        "ModuleName"</code> Poiché il file sorgente è  JavaScript  codice, il runtime è specificato come<code class="code">nodejs18.x</code>.</p>
    <p>Per questa procedura guidata, il tempo di esecuzione per la funzione supera il valore predefinito di <code class="code">3</code> secondi, perciò il timeout è impostato su <code class="code">30</code> secondi. Se non specifichi un timeout sufficientemente lungo, Lambda potrebbe causare un timeout prima che la funzione possa essere completa, causando errori nella creazione dello stack.</p>
    <p>Il ruolo di esecuzione, dichiarata altrove nel modello, viene specificata utilizzando la funzione intrinseca <code class="code">Fn::GetAtt</code> nella proprietà <code class="code">Role</code>. Il ruolo di esecuzione concede l'autorizzazione della funzione Lambda per l'invio di registri ad AWS e per chiamare l'API EC2 <code class="code">DescribeImages</code>. I seguenti snippet mostrano il ruolo e la policy che concedono le autorizzazioni appropriate:</p>
    <div class="example"><h6>Esempio Sintassi JSON</h6><div class="example-contents"><pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copia"><awsui-icon name="copy"></awsui-icon></div></div><code class="json ">"LambdaExecutionRole": <span>{</span>
  "Type": "AWS::IAM::Role",
  "Properties": <span>{</span>
    "AssumeRolePolicyDocument": <span>{</span>
      "Version": "2012-10-17",
      "Statement": [<span>{</span>
        "Effect": "Allow",
        "Principal": <span>{</span>"Service": ["lambda.amazonaws.com"]},
        "Action": ["sts:AssumeRole"]
      }]
    },
    "Path": "/",
    "Policies": [<span>{</span>
      "PolicyName": "root",
      "PolicyDocument": <span>{</span>
        "Version": "2012-10-17",
        "Statement": [<span>{</span>
          "Effect": "Allow",
          "Action": ["logs:CreateLogGroup","logs:CreateLogStream","logs:PutLogEvents"],
          "Resource": "arn:aws:logs:*:*:*"
        },
        <span>{</span>
          "Effect": "Allow",
          "Action": ["ec2:DescribeImages"],
          "Resource": "*"
        }]
      }
    }]
  }
}</code></pre></div></div>
    <div class="example"><h6>Esempio Sintassi YAML</h6><div class="example-contents"><pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copia"><awsui-icon name="copy"></awsui-icon></div></div><code class="yaml ">LambdaExecutionRole:
  Type: AWS::IAM::Role
  Properties:
    AssumeRolePolicyDocument:
      Version: '2012-10-17'
      Statement:
      - Effect: Allow
        Principal:
          Service:
          - lambda.amazonaws.com
        Action:
        - sts:AssumeRole
    Path: "/"
    Policies:
    - PolicyName: root
      PolicyDocument:
        Version: '2012-10-17'
        Statement:
        - Effect: Allow
          Action:
          - logs:CreateLogGroup
          - logs:CreateLogStream
          - logs:PutLogEvents
          Resource: arn:aws:logs:*:*:*
        - Effect: Allow
          Action:
          - ec2:DescribeImages
          Resource: "*"</code></pre></div></div>
    <p>Per i modelli di Linux e Windows, la risorsa personalizzata richiama la funzione Lambda associata. Per associare una funzione con una risorsa personalizzata, devi specificare il nome della risorsa Amazon (ARN) della funzione per la proprietà <code class="code">ServiceToken</code>, utilizzando la funzione intrinseca <code class="code">Fn::GetAtt</code>. AWS CloudFormation invia le proprietà aggiuntive incluse nella dichiarazione della risorsa personalizzata, ad esempio <code class="code">Region</code> e <code class="code">Architecture</code>, alla funzione Lambda come input. La funzione Lambda determina i nomi e i valori corretti per queste proprietà di input.</p>
    <div class="example"><h6>Esempio Sintassi JSON</h6><div class="example-contents"><pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copia"><awsui-icon name="copy"></awsui-icon></div></div><code class="json ">"AMIInfo": <span>{</span>
  "Type": "Custom::AMIInfo",
  "Properties": <span>{</span>
    "ServiceToken": <span>{</span> "Fn::GetAtt" : ["AMIInfoFunction", "Arn"] },
    "Region": <span>{</span> "Ref": "AWS::Region" },
    "Architecture": <span>{</span> "Fn::FindInMap" : [ "AWSInstanceType2Arch", <span>{</span> "Ref" : "InstanceType" }, "Arch" ] }
  }
}</code></pre></div></div>
    <div class="example"><h6>Esempio Sintassi YAML</h6><div class="example-contents"><pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copia"><awsui-icon name="copy"></awsui-icon></div></div><code class="yaml ">AMIInfo:
  Type: Custom::AMIInfo
  Properties:
    ServiceToken: !GetAtt AMIInfoFunction.Arn
    Region: !Ref "AWS::Region"
    Architecture:
      Fn::FindInMap:
      - AWSInstanceType2Arch
      - !Ref InstanceType
      - Arch</code></pre></div></div>
    <p>Per Windows, la risorsa personalizzata fornisce la versione di Windows alla funzione Lambda invece dell'architettura dell'istanza.</p>
    <div class="example"><h6>Esempio Sintassi JSON</h6><div class="example-contents"><pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copia"><awsui-icon name="copy"></awsui-icon></div></div><code class="json ">"AMIInfo": <span>{</span>
  "Type": "Custom::AMIInfo",
  "Properties": <span>{</span>
    "ServiceToken": <span>{</span> "Fn::GetAtt" : ["AMIInfoFunction", "Arn"] },
    "Region": <span>{</span> "Ref": "AWS::Region" },
    "OSName": <span>{</span> "Ref": "WindowsVersion" }
  }
}</code></pre></div></div>
    <div class="example"><h6>Esempio Sintassi YAML</h6><div class="example-contents"><pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copia"><awsui-icon name="copy"></awsui-icon></div></div><code class="yaml ">AMIInfo:
  Type: Custom::AMIInfo
  Properties:
    ServiceToken: !GetAtt AMIInfoFunction.Arn
    Region: !Ref "AWS::Region"
    OSName: !Ref "WindowsVersion"</code></pre></div></div>
    <p>Quando AWS CloudFormation richiama la funzione , la funzione chiama l'API EC2 <code class="code">DescribeImages</code>, utilizzando la Regione e l'architettura dell'istanza o il nome del sistema operativo per filtrare l'elenco di immagini. Quindi la funzione ordina l'elenco delle immagini per data e restituisce l'ID dell'AMI più recente.</p>
    <p>Durante la restituzione dell'ID dell'AMI più recente, la funzione invia l'ID a un URL prefirmato nella proprietà <code class="code">Data</code> dell'<a href="./crpg-ref-responses.html">oggetto di risposta</a>. I dati sono strutturati come una coppia nome-valore, come nell'esempio seguente:</p>
    <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copia"><awsui-icon name="copy"></awsui-icon></div></div><code class="json ">"Data": <span>{</span> 
  "Id": "ami-43795473"
}</code></pre>
    <p>Il frammento seguente mostra come ottenere i dati da una funzione Lambda. Utilizza la funzione intrinseca <code class="code">Fn::GetAtt</code>, fornendo il nome della risorsa personalizzata e il nome attributo del valore che desideri ottenere. In questa procedura guidata, il nome della risorsa personalizzata è <code class="code">AMIInfo</code> e il nome attributo è <code class="code">Id</code>.</p>
    <div class="example"><h6>Esempio Sintassi JSON</h6><div class="example-contents"><pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copia"><awsui-icon name="copy"></awsui-icon></div></div><code class="json ">"SampleInstance": <span>{</span>  
  "Type": "AWS::EC2::Instance",
  "Properties": <span>{</span>
    "InstanceType"   : <span>{</span> "Ref" : "InstanceType" },
    "ImageId": <span>{</span> "Fn::GetAtt": [ "AMIInfo", "Id" ] }
  }
}</code></pre></div></div>
    <div class="example"><h6>Esempio Sintassi YAML</h6><div class="example-contents"><pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copia"><awsui-icon name="copy"></awsui-icon></div></div><code class="yaml ">SampleInstance:
  Type: AWS::EC2::Instance
  Properties:
    InstanceType: !Ref InstanceType
    ImageId: !GetAtt AMIInfo.Id</code></pre></div></div>
    <p>Ora che capisci cosa fa il modello, utilizza il modello di esempio per creare uno stack.</p>
    <div class="procedure"><h6>Per creare lo stack</h6><ol><li>
        <p>Apri la AWS CloudFormation console all'<a href="https://console.aws.amazon.com/cloudformation/" rel="noopener noreferrer" target="_blank"><span>indirizzo https://console.aws.amazon.com/cloudformation/</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a>.</p>
      </li><li>
        <p>Scegli <b>Crea stack</b>.</p>
      </li><li>
        <p>Nella sezione <b>Template (Modello)</b>, selezionare <b>Specify an Amazon S3 template URL (Specifica un URL modello Amazon S3)</b> e copiare e incollare l'URL seguente nella casella di testo:</p>
        <div class="variablelist">
           
           
        <dl>
            <dt><b><span class="term">Modello di Linux</span></b></dt>
            <dd>
              <p><code class="code"><a href="https://s3.amazonaws.com/cloudformation-examples/lambda/LambdaAMILookupSample.template" rel="noopener noreferrer" target="_blank"><span>https://s3.amazonaws.com/cloudformation-examples/lambda/LambdaAMILookupSample.template</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a></code></p>
            </dd>
          
            <dt><b><span class="term">Modello di Windows</span></b></dt>
            <dd>
              <p><code class="code"><a href="https://s3.amazonaws.com/cloudformation-examples/lambda/LambdaAMILookupSample-win.template" rel="noopener noreferrer" target="_blank"><span>https://s3.amazonaws.com/cloudformation-examples/lambda/LambdaAMILookupSample-win.template</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a></code></p>
            </dd>
          </dl></div>
      </li><li>
        <p>Seleziona <b>Avanti</b>.</p>
      </li><li>
        <p>Nel campo <b>Stack name (Nome stack)</b>, digitare <code class="userinput">SampleEC2Instance</code>.</p>
      </li><li>
        <p>Nella sezione <b>Parameters (Parametri)</b>, specificare il nome del bucket Amazon S3 creato e selezionare <b>Next (Avanti)</b>.</p>
        <p>I valori predefiniti per gli altri parametri sono gli stessi nomi utilizzati nel pacchetto di esempio <code>.zip</code>.</p>
      </li><li>
        <p>Per questa procedura guidata, non è necessario aggiungere tag o specificare impostazioni avanzate, quindi selezionare <b>Next (Avanti)</b>.</p>
      </li><li>
        <p>Assicurarsi che il nome dello stack e l'URL del modello siano corretti e scegliere <b>Create (Crea)</b>.</p>
      </li></ol></div>
    <p>AWS CloudFormation potrebbe impiegare diversi minuti per creare lo stack. È possibile controllare l'avanzamento negli eventi per lo stack. Per ulteriori informazioni, consulta <a href="./cfn-console-view-stack-data-resources.html">Visualizzazione dei dati e delle risorse AWS CloudFormation dello stack su AWS Management Console</a>.</p>
    <p>Se la creazione dello stack va a buon fine, tutte le risorse nello stack, ad esempio la funzione Lambda, la risorsa personalizzata e l'istanza EC2, vengono create. Hai utilizzato una funzione e una risorsa personalizzata Lambda per specificare l'ID AMI di un'istanza EC2. Non devi creare e mantenere una mappatura dell'ID AMI in questo modello.</p>
    <p>Per vedere quale ID AMI AWS CloudFormation ha utilizzato per creare l'istanza EC2, visualizza gli output dello stack.</p>
   <p><a href="https://console.aws.amazon.com/cloudwatch/home#logs:" rel="noopener noreferrer" target="_blank"><span>Se la funzione Lambda restituisce un errore, visualizza i log della funzione nella console Amazon  CloudWatch  Logs.</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a> Il nome del flusso di log è l'ID fisico della risorsa personalizzata, che puoi trovare visualizzando le risorse dello stack. Per ulteriori informazioni, consulta la sezione <a href="https://docs.aws.amazon.com/AmazonCloudWatch/latest/logs/Working-with-log-groups-and-streams.html#ViewingLogData">Visualizzazione dei dati di log</a> nella <em>Amazon  CloudWatch  User Guide</em>.</p>
   
   <h2 id="walkthrough-custom-resources-lambda-lookup-amiids-createfunction-cleanup">Fase 3: Eliminazione delle risorse</h2>
    
    <p>Per essere sicuro che non ti vengano addebitati servizi indesiderati, elimina lo stack.</p>
    <div class="procedure"><h6>Per eliminare lo stack</h6><ol><li>
        <p>Dalla console AWS CloudFormation, scegliere lo stack <b>SampleEC2Instance</b>.</p>
      </li><li>
        <p>Scegliere <b>Actions (Operazioni)</b> e poi <b>Delete Stack (Elimina stack)</b>.</p>
      </li><li>
        <p>Nel messaggio di conferma, scegliere <b>Yes, Delete (Sì, elimina)</b>.</p>
      </li></ol></div>
    <p>Tutte le risorse create vengono eliminate.</p>
    <p>Ora che sai come creare e utilizzare le funzioni Lambda con AWS CloudFormation, puoi utilizzare il modello e il codice di esempio di questa procedura guidata per creare altri stack e altre funzioni.</p>
  <h2 id="w9aac23c26c16b7c29">Informazioni correlate</h2>
    
    <div class="itemizedlist">
       
    <ul class="itemizedlist"><li class="listitem">
        <p><a href="./crpg-ref.html">Riferimento a risorse personalizzate di AWS CloudFormation</a></p>
      </li></ul></div>
  <awsdocs-copyright class="copyright-print"></awsdocs-copyright><awsdocs-thumb-feedback right-edge="{{$ctrl.thumbFeedbackRightEdge}}"></awsdocs-thumb-feedback></div><noscript><div><div><div><div id="js_error_message"><p><img src="https://d1ge0kk1l5kms0.cloudfront.net/images/G/01/webservices/console/warning.png" alt="Avvertimento" /> <strong>JavaScript è disabilitato o non è disponibile nel tuo browser.</strong></p><p>Per usare la documentazione AWS, JavaScript deve essere abilitato. Consulta le pagine della guida del browser per le istruzioni.</p></div></div></div></div></noscript><div id="main-col-footer" class="awsui-util-font-size-0"><div id="doc-conventions"><a target="_top" href="/general/latest/gr/docconventions.html">Convenzioni dei documenti</a></div><div class="prev-next"><div id="previous" class="prev-link" accesskey="p" href="./template-custom-resources-lambda.html">Risorse personalizzate supportate da AWS Lambda</div><div id="next" class="next-link" accesskey="n" href="./cfn-lambda-function-code-cfnresponsemodule.html">Modulo cfn-response</div></div></div><awsdocs-page-utilities></awsdocs-page-utilities></div><div id="quick-feedback-yes" style="display: none;"><div class="title">Questa pagina ti è stata utile? - Sì</div><div class="content"><p>Grazie per averci comunicato che stiamo facendo un buon lavoro!</p><p>Se hai un momento, ti invitiamo a dirci che cosa abbiamo fatto che ti è piaciuto così possiamo offrirti altri contenuti simili.</p><p><awsui-button id="fblink" rel="noopener noreferrer" target="_blank" text="Feedback" click="linkClick($event)" href="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=CloudFormation&amp;topic_url=https://docs.aws.amazon.com/it_it/AWSCloudFormation/latest/UserGuide/walkthrough-custom-resources-lambda-lookup-amiids.html"></awsui-button></p></div></div><div id="quick-feedback-no" style="display: none;"><div class="title">Questa pagina ti è stata utile? - No</div><div class="content"><p>Grazie per averci comunicato che questa pagina ha bisogno di essere modificata. Siamo spiacenti di non aver soddisfatto le tue esigenze.</p><p>Se hai un momento, ti invitiamo a dirci come possiamo migliorare la documentazione.</p><p><awsui-button id="fblink" rel="noopener noreferrer" target="_blank" text="Feedback" click="linkClick($event)" href="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=CloudFormation&amp;topic_url=https://docs.aws.amazon.com/it_it/AWSCloudFormation/latest/UserGuide/walkthrough-custom-resources-lambda-lookup-amiids.html"></awsui-button></p></div></div></div></body></div></awsdocs-view><div class="page-loading-indicator" id="page-loading-indicator"><awsui-spinner size="large"></awsui-spinner></div></div><div id="tools-panel" dom-region="tools"><awsdocs-tools-panel id="awsdocs-tools-panel"></awsdocs-tools-panel></div></awsui-app-layout><awsdocs-cookie-banner class="doc-cookie-banner"></awsdocs-cookie-banner></div></body></html>