<!DOCTYPE html>
    <html xmlns="http://www.w3.org/1999/xhtml" lang="it-IT"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Tutorial: Esecuzione di query su dati nidificati con Amazon Redshift Spectrum - Amazon Redshift</title><meta name="viewport" content="width=device-width,initial-scale=1" /><meta name="assets_root" content="/assets" /><meta name="target_state" content="tutorial-query-nested-data" /><meta name="default_state" content="tutorial-query-nested-data" /><link rel="icon" type="image/ico" href="/assets/images/favicon.ico" /><link rel="shortcut icon" type="image/ico" href="/assets/images/favicon.ico" /><link rel="canonical" href="https://docs.aws.amazon.com/it_it/redshift/latest/dg/tutorial-query-nested-data.html" /><meta name="description" content="Eseguire query su dati nidificati con Amazon Redshift Spectrum." /><meta name="deployment_region" content="IAD" /><meta name="product" content="Amazon Redshift" /><meta name="guide" content="Guida per sviluppatori di database" /><meta name="abstract" content="Creare e gestire un data warehouse con Amazon Redshift, un servizio di data warehouse completamente gestito di livello aziendale e con capacità nell'ordine di più petabyte." /><meta name="guide-locale" content="it_it" /><meta name="tocs" content="toc-contents.json" /><link rel="canonical" href="https://docs.aws.amazon.com/it_it/redshift/latest/dg/tutorial-query-nested-data.html" /><link rel="alternative" href="https://docs.aws.amazon.com/id_id/redshift/latest/dg/tutorial-query-nested-data.html" hreflang="id-id" /><link rel="alternative" href="https://docs.aws.amazon.com/id_id/redshift/latest/dg/tutorial-query-nested-data.html" hreflang="id" /><link rel="alternative" href="https://docs.aws.amazon.com/de_de/redshift/latest/dg/tutorial-query-nested-data.html" hreflang="de-de" /><link rel="alternative" href="https://docs.aws.amazon.com/de_de/redshift/latest/dg/tutorial-query-nested-data.html" hreflang="de" /><link rel="alternative" href="https://docs.aws.amazon.com/redshift/latest/dg/tutorial-query-nested-data.html" hreflang="en-us" /><link rel="alternative" href="https://docs.aws.amazon.com/redshift/latest/dg/tutorial-query-nested-data.html" hreflang="en" /><link rel="alternative" href="https://docs.aws.amazon.com/es_es/redshift/latest/dg/tutorial-query-nested-data.html" hreflang="es-es" /><link rel="alternative" href="https://docs.aws.amazon.com/es_es/redshift/latest/dg/tutorial-query-nested-data.html" hreflang="es" /><link rel="alternative" href="https://docs.aws.amazon.com/fr_fr/redshift/latest/dg/tutorial-query-nested-data.html" hreflang="fr-fr" /><link rel="alternative" href="https://docs.aws.amazon.com/fr_fr/redshift/latest/dg/tutorial-query-nested-data.html" hreflang="fr" /><link rel="alternative" href="https://docs.aws.amazon.com/it_it/redshift/latest/dg/tutorial-query-nested-data.html" hreflang="it-it" /><link rel="alternative" href="https://docs.aws.amazon.com/it_it/redshift/latest/dg/tutorial-query-nested-data.html" hreflang="it" /><link rel="alternative" href="https://docs.aws.amazon.com/ja_jp/redshift/latest/dg/tutorial-query-nested-data.html" hreflang="ja-jp" /><link rel="alternative" href="https://docs.aws.amazon.com/ja_jp/redshift/latest/dg/tutorial-query-nested-data.html" hreflang="ja" /><link rel="alternative" href="https://docs.aws.amazon.com/ko_kr/redshift/latest/dg/tutorial-query-nested-data.html" hreflang="ko-kr" /><link rel="alternative" href="https://docs.aws.amazon.com/ko_kr/redshift/latest/dg/tutorial-query-nested-data.html" hreflang="ko" /><link rel="alternative" href="https://docs.aws.amazon.com/pt_br/redshift/latest/dg/tutorial-query-nested-data.html" hreflang="pt-br" /><link rel="alternative" href="https://docs.aws.amazon.com/pt_br/redshift/latest/dg/tutorial-query-nested-data.html" hreflang="pt" /><link rel="alternative" href="https://docs.aws.amazon.com/zh_cn/redshift/latest/dg/tutorial-query-nested-data.html" hreflang="zh-cn" /><link rel="alternative" href="https://docs.aws.amazon.com/zh_tw/redshift/latest/dg/tutorial-query-nested-data.html" hreflang="zh-tw" /><link rel="alternative" href="https://docs.aws.amazon.com/redshift/latest/dg/tutorial-query-nested-data.html" hreflang="x-default" /><meta name="feedback-item" content="Redshift" /><meta name="this_doc_product" content="Amazon Redshift" /><meta name="this_doc_guide" content="Guida per sviluppatori di database" /><script defer="" src="/assets/r/vendor4.js?version=2021.12.02"></script><script defer="" src="/assets/r/vendor3.js?version=2021.12.02"></script><script defer="" src="/assets/r/vendor1.js?version=2021.12.02"></script><script defer="" src="/assets/r/awsdocs-common.js?version=2021.12.02"></script><script defer="" src="/assets/r/awsdocs-doc-page.js?version=2021.12.02"></script><link href="/assets/r/vendor4.css?version=2021.12.02" rel="stylesheet" /><link href="/assets/r/awsdocs-common.css?version=2021.12.02" rel="stylesheet" /><link href="/assets/r/awsdocs-doc-page.css?version=2021.12.02" rel="stylesheet" /><script async="" id="awsc-panorama-bundle" type="text/javascript" src="https://prod.pa.cdn.uis.awsstatic.com/panorama-nav-init.js" data-config="{'appEntity':'aws-documentation','region':'us-east-1','service':'redshift'}"></script><meta id="panorama-serviceSubSection" value="Guida per sviluppatori di database" /><meta id="panorama-serviceConsolePage" value="Tutorial: Esecuzione di query su dati nidificati con Amazon Redshift Spectrum" /></head><body class="awsdocs awsui"><div class="awsdocs-container"><awsdocs-header></awsdocs-header><awsui-app-layout id="app-layout" class="awsui-util-no-gutters" ng-controller="ContentController as $ctrl" header-selector="awsdocs-header" navigation-hide="false" navigation-width="$ctrl.navWidth" navigation-open="$ctrl.navOpen" navigation-change="$ctrl.onNavChange($event)" tools-hide="$ctrl.hideTools" tools-width="$ctrl.toolsWidth" tools-open="$ctrl.toolsOpen" tools-change="$ctrl.onToolsChange($event)"><div id="guide-toc" dom-region="navigation"><awsdocs-toc></awsdocs-toc></div><div id="main-column" dom-region="content" tabindex="-1"><awsdocs-view class="awsdocs-view"><div id="awsdocs-content"><head><title>Tutorial: Esecuzione di query su dati nidificati con Amazon Redshift Spectrum - Amazon Redshift</title><meta name="pdf" content="redshift-dg.pdf#tutorial-query-nested-data" /><meta name="rss" content="Dochistory.rss" /><meta name="forums" content="http://forums.aws.amazon.com/forum.jspa?forumID=155" /><meta name="feedback" content="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=Redshift&amp;topic_url=https://docs.aws.amazon.com/it_it/redshift/latest/dg/tutorial-query-nested-data.html" /><meta name="feedback-yes" content="feedbackyes.html?topic_url=https://docs.aws.amazon.com/it_it/redshift/latest/dg/tutorial-query-nested-data.html" /><meta name="feedback-no" content="feedbackno.html?topic_url=https://docs.aws.amazon.com/it_it/redshift/latest/dg/tutorial-query-nested-data.html" /><meta name="keywords" content="Amazon Redshift,AWS Redshift,Redshift,Redshift Spectrum,cluster,data warehouse,sviluppatore,dati campione,database,sviluppatore di database,HLL" /><script type="application/ld+json">
{
    "@context" : "https://schema.org",
    "@type" : "BreadcrumbList",
    "itemListElement" : [
      {
        "@type" : "ListItem",
        "position" : 1,
        "name" : "AWS",
        "item" : "https://aws.amazon.com"
      },
      {
        "@type" : "ListItem",
        "position" : 2,
        "name" : "Amazon Redshift",
        "item" : "https://docs.aws.amazon.com/redshift/index.html"
      },
      {
        "@type" : "ListItem",
        "position" : 3,
        "name" : "Guida per sviluppatori di database",
        "item" : "https://docs.aws.amazon.com/it_it/redshift/latest/dg"
      },
      {
        "@type" : "ListItem",
        "position" : 4,
        "name" : "Esecuzione di query sui dati esterni utilizzando Amazon Redshift Spectrum",
        "item" : "https://docs.aws.amazon.com/it_it/redshift/latest/dg/c-using-spectrum.html"
      },
      {
        "@type" : "ListItem",
        "position" : 5,
        "name" : "Tutorial: Esecuzione di query su dati nidificati con Amazon Redshift Spectrum",
        "item" : "https://docs.aws.amazon.com/it_it/redshift/latest/dg/c-using-spectrum.html"
      }
    ]
}
</script></head><body><div id="main"><div style="display: none"><a href="redshift-dg.pdf#tutorial-query-nested-data" target="_blank" rel="noopener noreferrer" title="Apri PDF"></a></div><div id="breadcrumbs" class="breadcrumb"><a href="https://aws.amazon.com">AWS</a><a href="/index.html">Documentazione</a><a href="/redshift/index.html">Amazon Redshift</a><a href="welcome.html">Guida per sviluppatori di database</a></div><div id="page-toc-src"><a href="#tutorial-nested-data-overview">Panoramica</a><a href="#tutorial-nested-data-create-table">Fase 1: creazione di una tabella esterna contenente dati nidificati</a><a href="#tutorial-query-nested-data-sqlextensions">Fase 2: Esecuzione di query sui dati nidificati in Amazon S3 con estensioni SQL</a></div><div id="main-content" class="awsui-util-container"><div id="main-col-body"><awsdocs-language-banner data-service="$ctrl.pageService"></awsdocs-language-banner><awsui-alert class="awsdocs-page-banner awsui-util-mb-l"><p>Le traduzioni sono generate tramite traduzione automatica. In caso di conflitto tra il contenuto di una traduzione e la versione originale in Inglese, quest'ultima prevarrà.</p></awsui-alert><h1 class="topictitle" id="tutorial-query-nested-data">Tutorial: Esecuzione di query su dati nidificati con Amazon Redshift Spectrum</h1><div class="awsdocs-page-header-container"><awsdocs-page-header></awsdocs-page-header><awsdocs-filter-selector id="awsdocs-filter-selector"></awsdocs-filter-selector></div>
        <h2 id="tutorial-nested-data-overview">Panoramica</h2>
                
        <p>Amazon Redshift Spectrum supporta l'esecuzione di query di dati nidificati nei formati di file Parquet, ORC, JSON e Ion. Redshift Spectrum accede ai dati mediante tabelle esterne. Puoi creare tabelle esterne che utilizzano i tipi di dati complessi <code class="code">struct</code>, <code class="code">array</code> e <code class="code">map</code>.</p>
        <p>Ad esempio, si supponga che il file di dati contenga i seguenti dati in Amazon S3 all'interno di una cartella denominata <code class="code">customers</code>. Anche se non è presente un singolo elemento root, ciascun oggetto JSON in questi dati di esempio rappresenta una riga in una tabella. </p>
<pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copia"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>"id": 1,
 "name": <span>{</span>"given": "John", "family": "Smith"},
 "phones": ["123-457789"],
 "orders": [<span>{</span>"shipdate": "2018-03-01T11:59:59.000Z", "price": 100.50},
            <span>{</span>"shipdate": "2018-03-01T09:10:00.000Z", "price": 99.12}]
}
<span>{</span>"id": 2,
 "name": <span>{</span>"given": "Jenny", "family": "Doe"},
 "phones": ["858-8675309", "415-9876543"],
 "orders": []
}
<span>{</span>"id": 3,
 "name": <span>{</span>"given": "Andy", "family": "Jones"},
 "phones": [],
 "orders": [<span>{</span>"shipdate": "2018-03-02T08:02:15.000Z", "price": 13.50}]
}  </code></pre>        
   
        
        <p>Puoi utilizzare Amazon Redshift Spectrum per eseguire query sui dati nidificati nei file. Il seguente tutorial illustra la procedura da seguire con i dati Apache Parquet.</p> 
        <p>Per i prerequisiti, le fasi e i casi d'uso relativi ai dati nidificati del tutorial, consultare i seguenti argomenti:</p>
        <div class="itemizedlist">
             
             
             
             
             
             
        <ul class="itemizedlist"><li class="listitem">
                <p><a href="#tutorial-nested-data-prereq">Prerequisiti</a></p>
            </li><li class="listitem">
                <p><a href="#tutorial-nested-data-create-table">Fase 1: creazione di una tabella esterna contenente dati nidificati</a></p>
            </li><li class="listitem">
                <p><a href="#tutorial-query-nested-data-sqlextensions">Fase 2: Esecuzione di query sui dati nidificati in Amazon S3 con estensioni SQL</a></p>
            </li><li class="listitem">
                <p><a href="./nested-data-use-cases.html">Casi d'uso dei dati nidificati </a></p>
            </li><li class="listitem">
                <p><a href="./nested-data-restrictions.html">Limitazioni relative ai dati annidati (anteprima)</a></p>
            </li><li class="listitem">
                <p><a href="./serializing-complex-JSON.html">Serializzazione di JSON nidificato complesso</a></p>
            </li></ul></div>
        
        


         
            <h3 id="tutorial-nested-data-prereq">Prerequisiti</h3>
            
            <p>Se ancora non utilizzi Redshift Spectrum, segui la procedura in <a href="./c-getting-started-using-spectrum.html">Nozioni di base su Amazon Redshift Spectrum</a> prima di continuare.</p>
            
            <p>Per creare uno schema esterno, sostituire l'ARN del ruolo IAM nel comando seguente con l'ARN del ruolo creato in <a href="./c-getting-started-using-spectrum-create-role.html">Creazione di un ruolo IAM</a>. Quindi eseguire il comando nel proprio client SQL.</p>
            <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copia"><awsui-icon name="copy"></awsui-icon></div></div><code class="">create external schema spectrum 
from data catalog 
database 'myspectrum_db' 
iam_role 'arn:aws:iam::123456789012:role/myspectrum_role'
create external database if not exists;</code></pre>
         

     
        <h2 id="tutorial-nested-data-create-table">Fase 1: creazione di una tabella esterna contenente dati nidificati</h2>
        <p>È possibile visualizzare i <a href="https://s3.amazonaws.com/redshift-downloads/tickit/spectrum/customers/customer_file1" rel="noopener noreferrer" target="_blank"><span>dati di origine</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a> scaricandoli da Amazon S3. </p>

        <p>Per creare la tabella esterna per questo tutorial, utilizza il comando seguente. </p>
        <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copia"><awsui-icon name="copy"></awsui-icon></div></div><code class="">CREATE EXTERNAL TABLE spectrum.customers (
  id     int,
  name   struct&lt;given:varchar(20), family:varchar(20)&gt;,
  phones array&lt;varchar(20)&gt;,
  orders array&lt;struct&lt;shipdate:timestamp, price:double precision&gt;&gt;
)
STORED AS PARQUET
LOCATION 's3://redshift-downloads/tickit/spectrum/customers/';     </code></pre>
        
        <p>Nell'esempio precedente, la tabella esterna <code class="code">spectrum.customers</code> utilizza i tipi di dati <code class="code">struct</code> e <code class="code">array</code> per definire colonne con dati nidificati. Amazon Redshift Spectrum supporta l'esecuzione di query di dati nidificati nei formati di file Parquet, ORC, JSON e Ion. Il parametro <code class="code">STORED AS</code> è <code class="code">PARQUET</code> per i file Apache Parquet. Il parametro <code class="code">LOCATION</code> deve fare riferimento alla cartella Amazon S3 che contiene i file o i dati nidificati. Per ulteriori informazioni, consulta <a href="./r_CREATE_EXTERNAL_TABLE.html">CREATE EXTERNAL TABLE</a>.</p>
        
        
        <p>Puoi nidificare tipi <code class="code">array</code> e <code class="code">struct</code> a qualsiasi livello. Ad esempio, puoi definire una colonna denominata <code class="code">toparray</code> come mostrato nell'esempio seguente.</p>
        <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copia"><awsui-icon name="copy"></awsui-icon></div></div><code class="">toparray array&lt;struct&lt;nestedarray:
         array&lt;struct&lt;morenestedarray: 
         array&lt;string&gt;&gt;&gt;&gt;&gt;</code></pre>
        <p>Puoi inoltre nidificare tipi <code class="code">struct</code> come mostrato per la colonna <code class="code">x</code> nell'esempio seguente.</p>
        <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copia"><awsui-icon name="copy"></awsui-icon></div></div><code class="">x struct&lt;a: string,
         b: struct&lt;c: integer,
                   d: struct&lt;e: string&gt;
                  &gt;
        &gt;</code></pre>
   
     
                <h2 id="tutorial-query-nested-data-sqlextensions">Fase 2: Esecuzione di query sui dati nidificati in Amazon S3 con estensioni SQL</h2>
                <p>Redshift Spectrum supporta l'esecuzione di query su tipi complessi <code class="code">array</code>, <code class="code">map</code> e <code class="code">struct</code> mediante estensioni alla sintassi SQL di Amazon Redshift. </p>
                 
                    <h3 id="nested-data-sqlextension1">Estensione 1: accesso a colonne di struct</h3>
                    <p>Puoi estrarre dati da colonne <code class="code">struct</code> utilizzando una notazione punto che concatena i nomi dei campi in percorsi. Ad esempio, la query seguente restituisce il nome e il cognome dei clienti. L'accesso al nome viene eseguito dal percorso lungo <code class="code">c.name.given</code>. L'accesso al cognome viene eseguito dal percorso lungo <code class="code">c.name.family</code>. </p>    
                    <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copia"><awsui-icon name="copy"></awsui-icon></div></div><code class="">SELECT c.id, c.name.given, c.name.family
FROM   spectrum.customers c;</code></pre>
                    <p>La query precedente restituisce i seguenti dati.</p>
                    <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copia"><awsui-icon name="copy"></awsui-icon></div></div><code class="">id | given | family
---|-------|-------
1  | John  | Smith
2  | Jenny | Doe
3  | Andy  | Jones
(3 rows)</code></pre>
                    <p>Uno <code class="code">struct</code> può essere una colonna di un altro <code class="code">struct</code>, che a sua volta può essere una colonna di un altro <code class="code">struct</code>, a qualsiasi livello. I percorsi di accesso alle colonne in <code class="code">struct</code> nidificati in modo così profondo possono essere lunghi. Ad esempio, consultare la definizione relativa alla colonna <code class="code">x</code> nell'esempio seguente.</p>     
<pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copia"><awsui-icon name="copy"></awsui-icon></div></div><code class="">x struct&lt;a: string,
         b: struct&lt;c: integer, 
                      d: struct&lt;e: string&gt;
                  &gt;
        &gt;</code></pre>        
        <p>Puoi accedere ai dati in <code class="code">e</code> come <code class="code">x.b.d.e</code>.</p>
    
                    
                    
                   
                 
                    <h3 id="nested-data-sqlextension2">Estensione 2: matrici estese a una clausola FROM</h3>
                    <p>Puoi estrarre dati da colonne <code class="code">array</code> (e, per estensione, da colonne <code class="code">map</code>) specificando le colonne <code class="code">array</code> in una clausola <code class="code">FROM</code> al posto dei nomi delle tabelle. L'estensione si applica alla clausola <code class="code">FROM</code> della query principale e, inoltre, alle clausole <code class="code">FROM</code> delle query secondarie.</p>
                        
                <p>Puoi fare riferimento a elementi <code class="code">array</code> in base alla posizione, ad esempio <code class="code">c.orders[0]</code> (anteprima).</p>
                    <p>Combinando <code class="code">arrays</code> estese e join, puoi annullare annidamenti in vari modi, come illustrato nei seguenti casi d'uso. </p>
                     
                        <h4 id="unnest-inner-joins">Annullamento di annidamenti mediante inner join</h4>
                        <p>La seguente query seleziona gli ID dei clienti e le date di spedizione degli ordini per i clienti associati a degli ordini. L'estensione SQL nella clausola FROM <code class="code">c.orders
                        o</code> dipende dall'alias <code class="code">c</code>.</p>
                    <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copia"><awsui-icon name="copy"></awsui-icon></div></div><code class="">SELECT c.id, o.shipdate
FROM   spectrum.customers c, c.orders o </code></pre> 
                        <p>Per ciascun cliente <code class="code">c</code> associato a degli ordini, la clausola <code class="code">FROM</code> restituisce una riga per ogni ordine <code class="code">o</code> del cliente <code class="code">c</code>. La riga in questione combina la riga del cliente <code class="code">c</code> e quella dell'ordine <code class="code">o</code>. In seguito, la clausola <code class="code">SELECT</code> mantiene solo <code class="code">c.id</code> e <code class="code">o.shipdate</code>. Il risultato è il seguente.</p>
                         <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copia"><awsui-icon name="copy"></awsui-icon></div></div><code class="">id|      shipdate
--|----------------------
1 |2018-03-01  11:59:59
1 |2018-03-01  09:10:00
3 |2018-03-02  08:02:15
(3 rows) </code></pre>   
                        <p>L'alias <code class="code">c</code> fornisce l'accesso ai campi dei clienti, mentre l'alias <code class="code">o</code> consente l'accesso ai campi degli ordini. </p>
                        <p>La semantica è simile a quella di SQL standard. È possibile pensare a un processo in cui la clausola <code class="code">FROM</code> esegue il loop nidificato mostrato sotto, mentre <code class="code">SELECT</code> sceglie i campi da restituire. </p>
                        <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copia"><awsui-icon name="copy"></awsui-icon></div></div><code class="">for each customer c in spectrum.customers
  for each order o in c.orders
     output c.id and o.shipdate </code></pre>
                        <p>Pertanto, se un cliente non è associato ad alcun ordine, non verrà mostrato tra i risultati.</p>
                        <p>Puoi pensare anche a un processo in cui la clausola <code class="code">FROM</code> esegue un <code class="code">JOIN</code> con la tabella <code class="code">customers</code> e la matrice <code class="code">orders</code>. In effetti, puoi anche scrivere la query, come mostrato nell'esempio seguente.</p>
                        <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copia"><awsui-icon name="copy"></awsui-icon></div></div><code class="">SELECT c.id, o.shipdate
FROM   spectrum.customers c INNER JOIN c.orders o ON true </code></pre>
                        <div class="awsdocs-note"><div class="awsdocs-note-title"><awsui-icon name="status-info" variant="link"></awsui-icon><h6>Nota</h6></div><div class="awsdocs-note-text"><p>Se è presente uno schema denominato <code class="code">c</code> con una tabella chiamata <code class="code">orders</code>, allora <code class="code">c.orders</code> fa riferimento alla tabella <code class="code">orders</code> e non alla colonna della matrice di <code class="code">customers</code>.</p></div></div>
                 
                 
                    <h4 id="unnest-left-joins">Annullamento di annidamenti mediante left join</h4>
                    <p>La query seguente restituisce tutti i nomi dei clienti e i loro ordini. Se un cliente non ha effettuato alcun ordine, il suo nome viene comunque restituito. Tuttavia, in questo caso, l'ordine presenta colonne NULL, come mostrato nell'esempio seguente per Jenny Doe.</p>
                    <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copia"><awsui-icon name="copy"></awsui-icon></div></div><code class="">SELECT c.id, c.name.given, c.name.family, o.shipdate, o.price
FROM   spectrum.customers c LEFT JOIN c.orders o ON true</code></pre>
                    
                    <p>La query precedente restituisce i seguenti dati.</p>
                    <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copia"><awsui-icon name="copy"></awsui-icon></div></div><code class="">id  |  given  | family  |    shipdate          | price
----|---------|---------|----------------------|--------
 1  |  John   | Smith   | 2018-03-01  11:59:59 | 100.5
 1  |  John   | Smith   | 2018-03-01  09:10:00 |  99.12
 2  |  Jenny  | Doe     |                      |
 3  |  Andy   | Jones   | 2018-03-02  08:02:15 |  13.5
 (4 rows)</code></pre>
                 
                
                 
                    <h3 id="nested-data-sqlextension3">Estensione 3: accesso diretto a una matrice di scalari tramite un alias </h3>
                    <p>Quando un alias <code class="code">p</code> in una clausola <code class="code">FROM</code> si estende a una matrice di scalari, la query fa riferimento ai valori di <code class="code">p</code> come <code class="code">p</code>. Ad esempio, la query seguente genera coppie di nomi e numeri di telefono dei clienti.</p>
                    <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copia"><awsui-icon name="copy"></awsui-icon></div></div><code class="">SELECT c.name.given, c.name.family, p AS phone
FROM   spectrum.customers c LEFT JOIN c.phones p ON true  </code></pre>
                    <p>La query precedente restituisce i seguenti dati.</p>
                    <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copia"><awsui-icon name="copy"></awsui-icon></div></div><code class="">given  |  family  |  phone
-------|----------|-----------
John   | Smith    | 123-4577891
Jenny  | Doe      | 858-8675309
Jenny  | Doe      | 415-9876543
Andy   | Jones    | 
(4 rows) </code></pre>
                     
                 
                    <h3 id="nested-data-sqlextension4">Estensione 4: accesso agli elementi del tipo di dati map </h3>
                    <p>Redshift Spectrum tratta <code class="code">map</code> come un tipo di dati <code class="code">array</code> che contiene tipi <code class="code">struct</code> con una colonna <code class="code">key</code> e una colonna <code class="code">value</code>. <code class="code">key</code> deve essere uno <code class="code">scalar</code>; il valore può essere qualunque tipo di dati. </p>
                    <p>Ad esempio, il codice seguente crea una tabella esterna con un tipo <code class="code">map</code> per l'archiviazione dei numeri di telefono.</p>
                    <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copia"><awsui-icon name="copy"></awsui-icon></div></div><code class="">CREATE EXTERNAL TABLE spectrum.customers2 (
  id     int,
  name   struct&lt;given:varchar(20), family:varchar(20)&gt;,
  phones map&lt;varchar(20), varchar(20)&gt;,
  orders array&lt;struct&lt;shipdate:timestamp, price:double precision&gt;&gt;
)
STORED AS PARQUET
LOCATION 's3://redshift-downloads/tickit/spectrum/customers/';</code></pre>
                    <p>Dal momento che un tipo <code class="code">map</code> si comporta come un tipo <code class="code">array</code> con colonne <code class="code">key</code> e <code class="code">value</code>, puoi pensare agli schemi precedenti come a quelli riportati di seguito.</p>
                    <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copia"><awsui-icon name="copy"></awsui-icon></div></div><code class="">CREATE EXTERNAL TABLE spectrum.customers3 (
  id     int,
  name   struct&lt;given:varchar(20), family:varchar(20)&gt;,
  phones array&lt;struct&lt;key:varchar(20), value:varchar(20)&gt;&gt;,
  orders array&lt;struct&lt;shipdate:timestamp, price:double precision&gt;&gt;
)
STORED AS PARQUET
LOCATION 's3://redshift-downloads/tickit/spectrum/customers/';   </code></pre>
                    
                    <p>La query seguente restituisce i nomi dei clienti con un numero di cellulare e il numero per ciascun nome. La query sul tipo map viene considerata equivalente a una query su un <code class="code">array</code> nidificato di tipi <code class="code">struct</code>. La query seguente restituisce dati solo se hai creato la tabella esterna come descritto in precedenza. </p>   
                     <pre class="programlisting"><div class="code-btn-container"></div><code class="">SELECT c.name.given, c.name.family, p.value 
FROM   spectrum.customers c, c.phones p 
WHERE  p.key = 'mobile';  </code></pre>   
                  <div class="awsdocs-note"><div class="awsdocs-note-title"><awsui-icon name="status-info" variant="link"></awsui-icon><h6>Nota</h6></div><div class="awsdocs-note-text"><p>La <code class="code">key</code> per un tipo <code class="code">map</code> è una <code class="code">string</code> per i tipi di file Ion e JSON.</p></div></div>      
                    
                    
                     
                <awsdocs-copyright class="copyright-print"></awsdocs-copyright><awsdocs-thumb-feedback right-edge="{{$ctrl.thumbFeedbackRightEdge}}"></awsdocs-thumb-feedback></div><noscript><div><div><div><div id="js_error_message"><p><img src="https://d1ge0kk1l5kms0.cloudfront.net/images/G/01/webservices/console/warning.png" alt="Avvertimento" /> <strong>JavaScript è disabilitato o non è disponibile nel tuo browser.</strong></p><p>Per usare la documentazione AWS, JavaScript deve essere abilitato. Consulta le pagine della guida del browser per le istruzioni.</p></div></div></div></div></noscript><div id="main-col-footer" class="awsui-util-font-size-0"><div id="doc-conventions"><a target="_top" href="/general/latest/gr/docconventions.html">Convenzioni dei documenti</a></div><div class="prev-next"><div id="previous" class="prev-link" accesskey="p" href="./c-spectrum-troubleshooting.html">Risoluzione dei problemi delle query</div><div id="next" class="next-link" accesskey="n" href="./nested-data-use-cases.html">Casi d'uso dei dati nidificati </div></div></div><awsdocs-page-utilities></awsdocs-page-utilities></div><div id="quick-feedback-yes" style="display: none;"><div class="title">Questa pagina ti è stata utile? - Sì</div><div class="content"><p>Grazie per averci comunicato che stiamo facendo un buon lavoro!</p><p>Se hai un momento, ti invitiamo a dirci che cosa abbiamo fatto che ti è piaciuto così possiamo offrirti altri contenuti simili.</p><p><awsui-button id="fblink" rel="noopener noreferrer" target="_blank" text="Feedback" click="linkClick($event)" href="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=Redshift&amp;topic_url=https://docs.aws.amazon.com/it_it/redshift/latest/dg/tutorial-query-nested-data.html"></awsui-button></p></div></div><div id="quick-feedback-no" style="display: none;"><div class="title">Questa pagina ti è stata utile? - No</div><div class="content"><p>Grazie per averci comunicato che questa pagina ha bisogno di essere modificata. Siamo spiacenti di non aver soddisfatto le tue esigenze.</p><p>Se hai un momento, ti invitiamo a dirci come possiamo migliorare la documentazione.</p><p><awsui-button id="fblink" rel="noopener noreferrer" target="_blank" text="Feedback" click="linkClick($event)" href="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=Redshift&amp;topic_url=https://docs.aws.amazon.com/it_it/redshift/latest/dg/tutorial-query-nested-data.html"></awsui-button></p></div></div></div></body></div></awsdocs-view><div class="page-loading-indicator" id="page-loading-indicator"><awsui-spinner size="large"></awsui-spinner></div></div><div id="tools-panel" dom-region="tools"><awsdocs-tools-panel id="awsdocs-tools-panel"></awsdocs-tools-panel></div></awsui-app-layout><awsdocs-cookie-banner class="doc-cookie-banner"></awsdocs-cookie-banner></div></body></html>