<!DOCTYPE html>
    <html xmlns="http://www.w3.org/1999/xhtml" lang="it-IT"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Errori di blocco - Amazon Redshift</title><meta name="viewport" content="width=device-width,initial-scale=1" /><meta name="assets_root" content="/assets" /><meta name="target_state" content="stored-procedure-trapping-errors" /><meta name="default_state" content="stored-procedure-trapping-errors" /><link rel="icon" type="image/ico" href="/assets/images/favicon.ico" /><link rel="shortcut icon" type="image/ico" href="/assets/images/favicon.ico" /><link rel="canonical" href="https://docs.aws.amazon.com/it_it/redshift/latest/dg/stored-procedure-trapping-errors.html" /><meta name="description" content="Rilevare errori in una procedura archiviata in Amazon Redshift." /><meta name="deployment_region" content="IAD" /><meta name="product" content="Amazon Redshift" /><meta name="guide" content="Guida per sviluppatori di database" /><meta name="abstract" content="Creare e gestire un data warehouse con Amazon Redshift, un servizio di data warehouse completamente gestito di livello aziendale e con capacità nell'ordine di più petabyte." /><meta name="guide-locale" content="it_it" /><meta name="tocs" content="toc-contents.json" /><link rel="canonical" href="https://docs.aws.amazon.com/it_it/redshift/latest/dg/stored-procedure-trapping-errors.html" /><link rel="alternative" href="https://docs.aws.amazon.com/id_id/redshift/latest/dg/stored-procedure-trapping-errors.html" hreflang="id-id" /><link rel="alternative" href="https://docs.aws.amazon.com/id_id/redshift/latest/dg/stored-procedure-trapping-errors.html" hreflang="id" /><link rel="alternative" href="https://docs.aws.amazon.com/de_de/redshift/latest/dg/stored-procedure-trapping-errors.html" hreflang="de-de" /><link rel="alternative" href="https://docs.aws.amazon.com/de_de/redshift/latest/dg/stored-procedure-trapping-errors.html" hreflang="de" /><link rel="alternative" href="https://docs.aws.amazon.com/redshift/latest/dg/stored-procedure-trapping-errors.html" hreflang="en-us" /><link rel="alternative" href="https://docs.aws.amazon.com/redshift/latest/dg/stored-procedure-trapping-errors.html" hreflang="en" /><link rel="alternative" href="https://docs.aws.amazon.com/es_es/redshift/latest/dg/stored-procedure-trapping-errors.html" hreflang="es-es" /><link rel="alternative" href="https://docs.aws.amazon.com/es_es/redshift/latest/dg/stored-procedure-trapping-errors.html" hreflang="es" /><link rel="alternative" href="https://docs.aws.amazon.com/fr_fr/redshift/latest/dg/stored-procedure-trapping-errors.html" hreflang="fr-fr" /><link rel="alternative" href="https://docs.aws.amazon.com/fr_fr/redshift/latest/dg/stored-procedure-trapping-errors.html" hreflang="fr" /><link rel="alternative" href="https://docs.aws.amazon.com/it_it/redshift/latest/dg/stored-procedure-trapping-errors.html" hreflang="it-it" /><link rel="alternative" href="https://docs.aws.amazon.com/it_it/redshift/latest/dg/stored-procedure-trapping-errors.html" hreflang="it" /><link rel="alternative" href="https://docs.aws.amazon.com/ja_jp/redshift/latest/dg/stored-procedure-trapping-errors.html" hreflang="ja-jp" /><link rel="alternative" href="https://docs.aws.amazon.com/ja_jp/redshift/latest/dg/stored-procedure-trapping-errors.html" hreflang="ja" /><link rel="alternative" href="https://docs.aws.amazon.com/ko_kr/redshift/latest/dg/stored-procedure-trapping-errors.html" hreflang="ko-kr" /><link rel="alternative" href="https://docs.aws.amazon.com/ko_kr/redshift/latest/dg/stored-procedure-trapping-errors.html" hreflang="ko" /><link rel="alternative" href="https://docs.aws.amazon.com/pt_br/redshift/latest/dg/stored-procedure-trapping-errors.html" hreflang="pt-br" /><link rel="alternative" href="https://docs.aws.amazon.com/pt_br/redshift/latest/dg/stored-procedure-trapping-errors.html" hreflang="pt" /><link rel="alternative" href="https://docs.aws.amazon.com/zh_cn/redshift/latest/dg/stored-procedure-trapping-errors.html" hreflang="zh-cn" /><link rel="alternative" href="https://docs.aws.amazon.com/zh_tw/redshift/latest/dg/stored-procedure-trapping-errors.html" hreflang="zh-tw" /><link rel="alternative" href="https://docs.aws.amazon.com/redshift/latest/dg/stored-procedure-trapping-errors.html" hreflang="x-default" /><meta name="feedback-item" content="Redshift" /><meta name="this_doc_product" content="Amazon Redshift" /><meta name="this_doc_guide" content="Guida per sviluppatori di database" /><script defer="" src="/assets/r/vendor4.js?version=2021.12.02"></script><script defer="" src="/assets/r/vendor3.js?version=2021.12.02"></script><script defer="" src="/assets/r/vendor1.js?version=2021.12.02"></script><script defer="" src="/assets/r/awsdocs-common.js?version=2021.12.02"></script><script defer="" src="/assets/r/awsdocs-doc-page.js?version=2021.12.02"></script><link href="/assets/r/vendor4.css?version=2021.12.02" rel="stylesheet" /><link href="/assets/r/awsdocs-common.css?version=2021.12.02" rel="stylesheet" /><link href="/assets/r/awsdocs-doc-page.css?version=2021.12.02" rel="stylesheet" /><script async="" id="awsc-panorama-bundle" type="text/javascript" src="https://prod.pa.cdn.uis.awsstatic.com/panorama-nav-init.js" data-config="{'appEntity':'aws-documentation','region':'us-east-1','service':'redshift'}"></script><meta id="panorama-serviceSubSection" value="Guida per sviluppatori di database" /><meta id="panorama-serviceConsolePage" value="Errori di blocco" /></head><body class="awsdocs awsui"><div class="awsdocs-container"><awsdocs-header></awsdocs-header><awsui-app-layout id="app-layout" class="awsui-util-no-gutters" ng-controller="ContentController as $ctrl" header-selector="awsdocs-header" navigation-hide="false" navigation-width="$ctrl.navWidth" navigation-open="$ctrl.navOpen" navigation-change="$ctrl.onNavChange($event)" tools-hide="$ctrl.hideTools" tools-width="$ctrl.toolsWidth" tools-open="$ctrl.toolsOpen" tools-change="$ctrl.onToolsChange($event)"><div id="guide-toc" dom-region="navigation"><awsdocs-toc></awsdocs-toc></div><div id="main-column" dom-region="content" tabindex="-1"><awsdocs-view class="awsdocs-view"><div id="awsdocs-content"><head><title>Errori di blocco - Amazon Redshift</title><meta name="pdf" content="redshift-dg.pdf#stored-procedure-trapping-errors" /><meta name="rss" content="Dochistory.rss" /><meta name="forums" content="http://forums.aws.amazon.com/forum.jspa?forumID=155" /><meta name="feedback" content="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=Redshift&amp;topic_url=https://docs.aws.amazon.com/it_it/redshift/latest/dg/stored-procedure-trapping-errors.html" /><meta name="feedback-yes" content="feedbackyes.html?topic_url=https://docs.aws.amazon.com/it_it/redshift/latest/dg/stored-procedure-trapping-errors.html" /><meta name="feedback-no" content="feedbackno.html?topic_url=https://docs.aws.amazon.com/it_it/redshift/latest/dg/stored-procedure-trapping-errors.html" /><meta name="keywords" content="Amazon Redshift,AWS Redshift,Redshift,Redshift Spectrum,cluster,data warehouse,sviluppatore,dati campione,database,sviluppatore di database,HLL" /><script type="application/ld+json">
{
    "@context" : "https://schema.org",
    "@type" : "BreadcrumbList",
    "itemListElement" : [
      {
        "@type" : "ListItem",
        "position" : 1,
        "name" : "AWS",
        "item" : "https://aws.amazon.com"
      },
      {
        "@type" : "ListItem",
        "position" : 2,
        "name" : "Amazon Redshift",
        "item" : "https://docs.aws.amazon.com/redshift/index.html"
      },
      {
        "@type" : "ListItem",
        "position" : 3,
        "name" : "Guida per sviluppatori di database",
        "item" : "https://docs.aws.amazon.com/it_it/redshift/latest/dg"
      },
      {
        "@type" : "ListItem",
        "position" : 4,
        "name" : "Creazione di procedure archiviate in Amazon Redshift",
        "item" : "https://docs.aws.amazon.com/it_it/redshift/latest/dg/stored-procedure-overview.html"
      },
      {
        "@type" : "ListItem",
        "position" : 5,
        "name" : "Panoramica delle procedure archiviate in Amazon Redshift",
        "item" : "https://docs.aws.amazon.com/it_it/redshift/latest/dg/stored-procedure-create.html"
      },
      {
        "@type" : "ListItem",
        "position" : 6,
        "name" : "Errori di blocco",
        "item" : "https://docs.aws.amazon.com/it_it/redshift/latest/dg/stored-procedure-create.html"
      }
    ]
}
</script></head><body><div id="main"><div style="display: none"><a href="redshift-dg.pdf#stored-procedure-trapping-errors" target="_blank" rel="noopener noreferrer" title="Apri PDF"></a></div><div id="breadcrumbs" class="breadcrumb"><a href="https://aws.amazon.com">AWS</a><a href="/index.html">Documentazione</a><a href="/redshift/index.html">Amazon Redshift</a><a href="welcome.html">Guida per sviluppatori di database</a></div><div id="page-toc-src"><a href="#stored-procedure-trapping-errors-examples">Esempio</a></div><div id="main-content" class="awsui-util-container"><div id="main-col-body"><awsdocs-language-banner data-service="$ctrl.pageService"></awsdocs-language-banner><awsui-alert class="awsdocs-page-banner awsui-util-mb-l"><p>Le traduzioni sono generate tramite traduzione automatica. In caso di conflitto tra il contenuto di una traduzione e la versione originale in Inglese, quest'ultima prevarrà.</p></awsui-alert><h1 class="topictitle" id="stored-procedure-trapping-errors">Errori di blocco</h1><div class="awsdocs-page-header-container"><awsdocs-page-header></awsdocs-page-header><awsdocs-filter-selector id="awsdocs-filter-selector"></awsdocs-filter-selector></div><p>Quando una query o un comando in una procedura archiviata causa un errore, le query successive non vengono eseguite e viene eseguito il rollback della transazione. Però puoi gestire gli errori usando un blocco EXCEPTION.</p><div class="awsdocs-note"><div class="awsdocs-note-title"><awsui-icon name="status-info" variant="link"></awsui-icon><h6>Nota</h6></div><div class="awsdocs-note-text"><p>Il comportamento predefinito prevede che un errore impedisca l'esecuzione delle query successive, anche quando non sono presenti ulteriori condizioni che generano errori nella procedura archiviata.</p></div></div><pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copia"><awsui-icon name="copy"></awsui-icon></div></div><code class="nohighlight">[ &lt;&lt;label&gt;&gt; ]
[ DECLARE
  declarations ]
BEGIN
  statements
EXCEPTION
  WHEN OTHERS THEN
    statements
END;   
</code></pre><p>Quando si verifica un'eccezione e si aggiunge un blocco di gestione delle eccezioni, è possibile scrivere istruzioni RAISE e la maggior parte delle altre istruzioni PL/pgSQL. Ad esempio, è possibile generare un'eccezione con un messaggio personalizzato o inserire un record in una tabella di registrazione.</p><p>Quando si inserisce il blocco di gestione delle eccezioni, la transazione corrente viene ripristinata e viene creata una nuova transazione per eseguire le istruzioni nel blocco. Se le istruzioni nel blocco vengono eseguite senza errori, la transazione viene eseguita e l'eccezione viene rigenerata. Infine, la procedura archiviata termina.</p><p>L'unica condizione supportata in un blocco dell’eccezione è OTHERS, che fa corrispondere qualsiasi tipo di errore ad eccezione dell'annullamento della query. Inoltre, se si verifica un errore in un blocco di gestione delle eccezioni, può essere preso da un blocco di gestione delle eccezioni esterno.</p><p>Quando si verifica un errore all'interno della procedura NONATOMIC, l'errore non viene generato nuovamente se viene gestito da un blocco di eccezioni. Consulta l'istruzione PL/pgSQL <code class="code">RAISE</code> per generare nuovamente l'eccezione rilevata da un blocco di gestione delle eccezioni. Questa istruzione è valida solo nei blocchi di gestione delle eccezioni. Per ulteriori informazioni, consulta <a href="./c_PLpgSQL-statements.html#r_PLpgSQL-messages-errors">RAISE</a>.</p><p><b>Controllo di ciò che accade dopo un errore in una stored procedure con il gestore CONTINUE</b></p><p> Il gestore <code class="code">CONTINUE</code> è un tipo di gestore di eccezioni che controlla il flusso di esecuzione in una stored procedure NONATOMIC. Ti consente di acquisire e gestire le eccezioni senza terminare il blocco di istruzioni esistente. In genere, quando si verifica un errore in una stored procedure, il flusso viene interrotto e l'errore viene restituito al chiamante. Tuttavia, in alcuni casi d'uso, la condizione di errore non è sufficientemente grave da giustificare l'interruzione del flusso. Potresti voler gestire l'errore in modo corretto, utilizzando una logica di gestione degli errori di tua scelta in una transazione separata, e quindi continuare a eseguire le istruzioni dopo l'errore. L'esempio seguente mostra la sintassi. </p><pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copia"><awsui-icon name="copy"></awsui-icon></div></div><code class="nohighlight">[ DECLARE
  declarations ]
BEGIN
  statements
EXCEPTION
  [ CONTINUE_HANDLER | EXIT_HANDLER ] WHEN OTHERS THEN
    handler_statements
END;   
</code></pre><p>Sono disponibili diverse tabelle di sistema che consentono di raccogliere informazioni su vari tipi di errore. Per ulteriori informazioni, consulta <a href="./r_STL_LOAD_ERRORS.html">STL_LOAD_ERRORS</a>, <a href="./r_STL_ERROR.html">STL_ERROR</a> e <a href="./r_SYS_STREAM_SCAN_ERRORS.html">SYS_STREAM_SCAN_ERRORS</a>. Esistono anche ulteriori tabelle di sistema che è possibile utilizzare per risolvere gli errori. Ulteriori informazioni sono reperibili in <a href="./cm_chap_system-tables.html">Riferimento di tabelle e viste di sistema</a>.</p>
        <h2 id="stored-procedure-trapping-errors-examples">Esempio</h2>
     <p>Nell'esempio seguente viene illustrato come scrivere istruzioni nel blocco di gestione delle eccezioni. La procedura archiviata utilizza il comportamento predefinito di gestione delle transazioni.</p>
<pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copia"><awsui-icon name="copy"></awsui-icon></div></div><code class="">CREATE TABLE employee (firstname varchar, lastname varchar);
INSERT INTO employee VALUES ('Tomas','Smith');
CREATE TABLE employee_error_log (message varchar);

CREATE OR REPLACE PROCEDURE update_employee_sp() AS
$$
BEGIN
    UPDATE employee SET firstname = 'Adam' WHERE lastname = 'Smith';
    EXECUTE 'select invalid';
EXCEPTION WHEN OTHERS THEN
    RAISE INFO 'An exception occurred.';
    INSERT INTO employee_error_log VALUES ('Error message: ' || SQLERRM);
END;
$$ 
LANGUAGE plpgsql;

CALL update_employee_sp();

INFO:  An exception occurred.
ERROR:  column "invalid" does not exist
CONTEXT:  SQL statement "select invalid"
PL/pgSQL function "update_employee_sp" line 3 at execute statement</code></pre>
     <p>In questo esempio, viene chiamato <code class="code">update_employee_sp</code>, il messaggio informativo <em>Si è verificata un'eccezione.</em> viene sollevato e il messaggio di errore viene inserito nel log <code class="code">employee_error_log</code> della tabella di registrazione. L'eccezione originale viene generata nuovamente prima dell'uscita della procedura archiviata. Le query seguenti mostrano i record derivanti dall'esecuzione dell'esempio.</p>
<pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copia"><awsui-icon name="copy"></awsui-icon></div></div><code class="">SELECT * from employee;

firstname | lastname 
-----------+----------
 Tomas     | Smith

SELECT * from employee_error_log;

          message                     
------------------------------------------------
 Error message: column "invalid" does not exist</code></pre>   
        <p>Per ulteriori informazioni su RAISE, inclusi la guida alla formattazione e un elenco di ulteriori livelli, consulta <a href="./c_PLpgSQL-statements.html">Istruzioni PL/pgSQL supportate</a>.</p>
     <p>Nell'esempio seguente viene illustrato come scrivere istruzioni nel blocco di gestione delle eccezioni. La procedura archiviata utilizza il comportamento NONATOMIC di gestione delle transazioni. In questo esempio, non viene restituito alcun errore al chiamante dopo il completamento della chiamata di procedura. Non viene eseguito il roll back dell'istruzione UPDATE a causa dell'errore nell'istruzione successiva. Il messaggio informativo viene generato e il messaggio di errore viene inserito nella tabella di logging.</p><pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copia"><awsui-icon name="copy"></awsui-icon></div></div><code class="nohighlight">CREATE TABLE employee (firstname varchar, lastname varchar); 
INSERT INTO employee VALUES ('Tomas','Smith'); 
CREATE TABLE employee_error_log (message varchar);

-- Create the SP in NONATOMIC mode
CREATE OR REPLACE PROCEDURE update_employee_sp_2() NONATOMIC AS
$$
BEGIN
    UPDATE employee SET firstname = 'Adam' WHERE lastname = 'Smith';
    EXECUTE 'select invalid';
EXCEPTION WHEN OTHERS THEN
    RAISE INFO 'An exception occurred.';
    INSERT INTO employee_error_log VALUES ('Error message: ' || SQLERRM);
END;
$$ 
LANGUAGE plpgsql;

CALL update_employee_sp_2();
INFO:  An exception occurred.
CALL

SELECT * from employee;

 firstname | lastname 
-----------+----------
 Adam      | Smith
(1 row)

SELECT * from employee_error_log;

                    message                     
------------------------------------------------
 Error message: column "invalid" does not exist
(1 row)
</code></pre><p>Questo esempio illustra come creare una procedura con due blocchi secondari. Quando viene richiamata la procedura archiviata, l'errore del primo blocco secondario viene gestito dal relativo blocco di gestione delle eccezioni. Una volta completato il primo blocco secondario, la procedura continua a eseguire il secondo blocco secondario. È possibile vedere dal risultato che non viene generato alcun errore al termine della chiamata di procedura. Viene eseguito il commit delle operazioni UPDATE e INSERT sulla tabella employee. I messaggi di errore di entrambi i blocchi di eccezioni vengono inseriti nella tabella di logging.</p><pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copia"><awsui-icon name="copy"></awsui-icon></div></div><code class="nohighlight">CREATE TABLE employee (firstname varchar, lastname varchar); 
INSERT INTO employee VALUES ('Tomas','Smith'); 
CREATE TABLE employee_error_log (message varchar);

CREATE OR REPLACE PROCEDURE update_employee_sp_3() NONATOMIC AS
$$
BEGIN
    BEGIN
        UPDATE employee SET firstname = 'Adam' WHERE lastname = 'Smith';
        EXECUTE 'select invalid1';
    EXCEPTION WHEN OTHERS THEN
        RAISE INFO 'An exception occurred in the first block.';
        INSERT INTO employee_error_log VALUES ('Error message: ' || SQLERRM);
    END;
    BEGIN
        INSERT INTO employee VALUES ('Edie','Robertson');
        EXECUTE 'select invalid2';
    EXCEPTION WHEN OTHERS THEN
        RAISE INFO 'An exception occurred in the second block.';
        INSERT INTO employee_error_log VALUES ('Error message: ' || SQLERRM);
    END;
END;
$$ 
LANGUAGE plpgsql;

CALL update_employee_sp_3();
INFO:  An exception occurred in the first block.
INFO:  An exception occurred in the second block.
CALL

SELECT * from employee;

 firstname | lastname  
-----------+-----------
 Adam      | Smith
 Edie      | Robertson
(2 rows)

SELECT * from employee_error_log;

                     message                     
-------------------------------------------------
 Error message: column "invalid1" does not exist
 Error message: column "invalid2" does not exist
(2 rows)
</code></pre><p>Nell'esempio seguente viene mostrato come utilizzare il gestore di eccezioni CONTINUE. Questo esempio crea due tabelle e le utilizza in una stored procedure. Il gestore CONTINUE controlla il flusso di esecuzione in una stored procedure con un comportamento di gestione delle transazioni NONATOMIC.</p><pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copia"><awsui-icon name="copy"></awsui-icon></div></div><code class="">CREATE TABLE tbl_1 (a int);
CREATE TABLE tbl_error_logging(info varchar, err_state varchar, err_msg varchar);

CREATE OR REPLACE PROCEDURE sp_exc_handling_1() NONATOMIC AS
$$
BEGIN
    INSERT INTO tbl_1 VALUES (1);
    -- Expect an error for the insert statement following, because of the invalid value
    INSERT INTO tbl_1 VALUES ("val");
    INSERT INTO tbl_1 VALUES (2);
EXCEPTION CONTINUE_HANDLER WHEN OTHERS THEN
    INSERT INTO tbl_error_logging VALUES ('Encountered error', SQLSTATE, SQLERRM);
END;
$$ LANGUAGE plpgsql;</code></pre><p>Chiama la stored procedure:</p><pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copia"><awsui-icon name="copy"></awsui-icon></div></div><code class="">CALL sp_exc_handling_1();</code></pre><p>Il flusso procede in questo modo:</p><div class="orderedlist">
         
         
     <ol><li><p>Si verifica un errore perché si tenta di inserire in una colonna un tipo di dati non compatibile. Il controllo passa al blocco EXCEPTION. Quando si inserisce il blocco di gestione delle eccezioni, viene eseguito il rollback della transazione corrente e viene creata una nuova transazione implicita per eseguire le istruzioni nel blocco.</p></li><li><p>Se le istruzioni in CONTINUE_HANDLER vengono eseguite senza errori, il controllo passa all'istruzione immediatamente successiva a quella che ha causato l'eccezione. Se un'istruzione in CONTINUE_HANDLER genera una nuova eccezione, puoi gestirla con un gestore di eccezioni all'interno del blocco EXCEPTION.</p></li></ol></div><p>Dopo aver chiamato la stored procedure di esempio, le tabelle contengono i seguenti record:</p><div class="itemizedlist">
         
         
     <ul class="itemizedlist"><li class="listitem"><p>Se esegui <code class="code">SELECT * FROM tbl_1;</code>, vengono restituiti due record che contengono i valori <code class="code">1</code> e <code class="code">2</code>.</p></li><li class="listitem"><p>Se esegui <code class="code">SELECT * FROM tbl_error_logging;</code>, viene restituito un record con questi valori: <em>Encountered error</em>, <em>42703</em> e <em>column "val" does not exist in tbl_1</em>.</p></li></ul></div><p>Il seguente esempio di gestione degli errori utilizza sia un gestore EXIT sia un gestore CONTINUE. Crea due tabelle: una tabella di dati e una tabella di log. Crea inoltre una stored procedure per la gestione degli errori:</p><pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copia"><awsui-icon name="copy"></awsui-icon></div></div><code class="">CREATE TABLE tbl_1 (a int);
CREATE TABLE tbl_error_logging(info varchar, err_state varchar, err_msg varchar);

CREATE OR REPLACE PROCEDURE sp_exc_handling_2() NONATOMIC AS
$$
BEGIN
    INSERT INTO tbl_1 VALUES (1);
    BEGIN
        INSERT INTO tbl_1 VALUES (100);
        -- Expect an error for the insert statement following, because of the invalid value
        INSERT INTO tbl_1 VALUES ("val");
        INSERT INTO tbl_1 VALUES (101);
    EXCEPTION EXIT_HANDLER WHEN OTHERS THEN
        INSERT INTO tbl_error_logging VALUES ('Encountered error', SQLSTATE, SQLERRM);
    END;
    INSERT INTO tbl_1 VALUES (2);
    -- Expect an error for the insert statement following, because of the invalid value
    INSERT INTO tbl_1 VALUES ("val");
    INSERT INTO tbl_1 VALUES (3);
EXCEPTION CONTINUE_HANDLER WHEN OTHERS THEN
    INSERT INTO tbl_error_logging VALUES ('Encountered error', SQLSTATE, SQLERRM);
END;
$$ LANGUAGE plpgsql;</code></pre><p>Dopo aver creato la stored procedure, chiamala usando la seguente istruzione:</p><pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copia"><awsui-icon name="copy"></awsui-icon></div></div><code class="">CALL sp_exc_handling_2();</code></pre><p>Quando si verifica un errore nel blocco di eccezioni interno, che è racchiuso tra parentesi dal set interno di BEGIN e END, viene gestito dal gestore EXIT. Tutti gli errori che si verificano nel blocco esterno vengono gestiti dal gestore CONTINUE. </p><p>Dopo aver chiamato la stored procedure di esempio, le tabelle contengono i seguenti record:</p><div class="itemizedlist">
         
         
     <ul class="itemizedlist"><li class="listitem"><p>Se esegui <code class="code">SELECT * FROM tbl_1;</code>, vengono restituiti quattro record con i valori 1, 2, 3 e 100.</p></li><li class="listitem"><p>Se esegui <code class="code">SELECT * FROM tbl_error_logging;</code>, vengono restituiti due record con questi valori: <em>Encountered error</em>, <em>42703</em> e <em>column "val" does not exist in tbl_1</em>.</p></li></ul></div><p>Se la tabella <b>tbl_error_logging</b> non esiste viene generata un'eccezione.</p><p>Nell'esempio seguente viene mostrato come utilizzare il gestore di eccezioni CONTINUE con il ciclo FOR. Questo esempio crea tre tabelle e le utilizza in un ciclo FOR all'interno di una stored procedure. Il ciclo FOR è una variante del set di risultati, il che significa che esegue l'iterazione dei risultati di una query:</p><pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copia"><awsui-icon name="copy"></awsui-icon></div></div><code class="">CREATE TABLE tbl_1 (a int);
INSERT INTO tbl_1 VALUES (1), (2), (3);
CREATE TABLE tbl_2 (a int);
CREATE TABLE tbl_error_logging(info varchar, err_state varchar, err_msg varchar);

CREATE OR REPLACE PROCEDURE sp_exc_handling_loop() NONATOMIC AS
$$
DECLARE
 rec RECORD;
BEGIN
    FOR rec IN SELECT a FROM tbl_1
    LOOP
        IF rec.a = 2 THEN
            -- Expect an error for the insert statement following, because of the invalid value
            INSERT INTO tbl_2 VALUES("val");
        ELSE
            INSERT INTO tbl_2 VALUES (rec.a);
        END IF;
    END LOOP;
EXCEPTION CONTINUE_HANDLER WHEN OTHERS THEN
    INSERT INTO tbl_error_logging VALUES ('Encountered error', SQLSTATE, SQLERRM);
END;
$$ LANGUAGE plpgsql;</code></pre><p>Chiama la stored procedure:</p><pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copia"><awsui-icon name="copy"></awsui-icon></div></div><code class="">CALL sp_exc_handling_loop();</code></pre><p>Dopo aver chiamato la stored procedure di esempio, le tabelle contengono i seguenti record:</p><div class="itemizedlist">
         
         
     <ul class="itemizedlist"><li class="listitem"><p> Se esegui <code class="code">SELECT * FROM tbl_2;</code>, vengono restituiti due record che contengono i valori 1 e 3.</p></li><li class="listitem"><p>Se esegui <code class="code">SELECT * FROM tbl_error_logging;</code>, viene restituito un record con questi valori: <em>Encountered error</em>, <em>42703</em> e <em>column "val" does not exist in tbl_2</em>.</p></li></ul></div><p>Note per l'utilizzo relative all'handler CONTINUE:</p><div class="itemizedlist">
         
 
         
     <ul class="itemizedlist"><li class="listitem"><p>Le parole chiave CONTINUE_HANDLER ed EXIT_HANDLER possono essere utilizzate solo nelle stored procedure NONATOMIC.</p></li><li class="listitem"><p>Le parole chiave CONTINUE_HANDLER ed EXIT_HANDLER sono facoltative. EXIT_HANDLER è l'impostazione predefinita.</p></li></ul></div><awsdocs-copyright class="copyright-print"></awsdocs-copyright><awsdocs-thumb-feedback right-edge="{{$ctrl.thumbFeedbackRightEdge}}"></awsdocs-thumb-feedback></div><noscript><div><div><div><div id="js_error_message"><p><img src="https://d1ge0kk1l5kms0.cloudfront.net/images/G/01/webservices/console/warning.png" alt="Avvertimento" /> <strong>JavaScript è disabilitato o non è disponibile nel tuo browser.</strong></p><p>Per usare la documentazione AWS, JavaScript deve essere abilitato. Consulta le pagine della guida del browser per le istruzioni.</p></div></div></div></div></noscript><div id="main-col-footer" class="awsui-util-font-size-0"><div id="doc-conventions"><a target="_top" href="/general/latest/gr/docconventions.html">Convenzioni dei documenti</a></div><div class="prev-next"><div id="previous" class="prev-link" accesskey="p" href="./stored-procedure-transaction-management.html">Gestione delle transazioni</div><div id="next" class="next-link" accesskey="n" href="./c_PLpgSQL-logging.html">Registrazione delle stored procedure</div></div></div><awsdocs-page-utilities></awsdocs-page-utilities></div><div id="quick-feedback-yes" style="display: none;"><div class="title">Questa pagina ti è stata utile? - Sì</div><div class="content"><p>Grazie per averci comunicato che stiamo facendo un buon lavoro!</p><p>Se hai un momento, ti invitiamo a dirci che cosa abbiamo fatto che ti è piaciuto così possiamo offrirti altri contenuti simili.</p><p><awsui-button id="fblink" rel="noopener noreferrer" target="_blank" text="Feedback" click="linkClick($event)" href="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=Redshift&amp;topic_url=https://docs.aws.amazon.com/it_it/redshift/latest/dg/stored-procedure-trapping-errors.html"></awsui-button></p></div></div><div id="quick-feedback-no" style="display: none;"><div class="title">Questa pagina ti è stata utile? - No</div><div class="content"><p>Grazie per averci comunicato che questa pagina ha bisogno di essere modificata. Siamo spiacenti di non aver soddisfatto le tue esigenze.</p><p>Se hai un momento, ti invitiamo a dirci come possiamo migliorare la documentazione.</p><p><awsui-button id="fblink" rel="noopener noreferrer" target="_blank" text="Feedback" click="linkClick($event)" href="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=Redshift&amp;topic_url=https://docs.aws.amazon.com/it_it/redshift/latest/dg/stored-procedure-trapping-errors.html"></awsui-button></p></div></div></div></body></div></awsdocs-view><div class="page-loading-indicator" id="page-loading-indicator"><awsui-spinner size="large"></awsui-spinner></div></div><div id="tools-panel" dom-region="tools"><awsdocs-tools-panel id="awsdocs-tools-panel"></awsdocs-tools-panel></div></awsui-app-layout><awsdocs-cookie-banner class="doc-cookie-banner"></awsdocs-cookie-banner></div></body></html>