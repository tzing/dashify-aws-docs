<!DOCTYPE html>
    <html xmlns="http://www.w3.org/1999/xhtml" lang="ja-JP"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>チュートリアル: スケールおよび負荷分散されたアプリケーションを作成する - AWS CloudFormation</title><meta name="viewport" content="width=device-width,initial-scale=1" /><meta name="assets_root" content="/assets" /><meta name="target_state" content="example-templates-autoscaling" /><meta name="default_state" content="example-templates-autoscaling" /><link rel="icon" type="image/ico" href="/assets/images/favicon.ico" /><link rel="shortcut icon" type="image/ico" href="/assets/images/favicon.ico" /><link rel="canonical" href="https://docs.aws.amazon.com/ja_jp/AWSCloudFormation/latest/UserGuide/example-templates-autoscaling.html" /><meta name="description" content="このサンプルテンプレートを使用して、Elastic Load Balancing と Amazon EC2 Auto Scaling を使用する基本的な Apache ウェブサイトを作成します。" /><meta name="deployment_region" content="IAD" /><meta name="product" content="AWS CloudFormation" /><meta name="guide" content="ユーザーガイド" /><meta name="abstract" content="このユーザーガイドでは、AWS CloudFormation を使用して、予測かつ再現可能な方法で、AWS インフラストラクチャのデプロイを作成して管理します。" /><meta name="guide-locale" content="ja_jp" /><meta name="tocs" content="toc-contents.json" /><link rel="canonical" href="https://docs.aws.amazon.com/ja_jp/AWSCloudFormation/latest/UserGuide/example-templates-autoscaling.html" /><link rel="alternative" href="https://docs.aws.amazon.com/id_id/AWSCloudFormation/latest/UserGuide/example-templates-autoscaling.html" hreflang="id-id" /><link rel="alternative" href="https://docs.aws.amazon.com/id_id/AWSCloudFormation/latest/UserGuide/example-templates-autoscaling.html" hreflang="id" /><link rel="alternative" href="https://docs.aws.amazon.com/de_de/AWSCloudFormation/latest/UserGuide/example-templates-autoscaling.html" hreflang="de-de" /><link rel="alternative" href="https://docs.aws.amazon.com/de_de/AWSCloudFormation/latest/UserGuide/example-templates-autoscaling.html" hreflang="de" /><link rel="alternative" href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/example-templates-autoscaling.html" hreflang="en-us" /><link rel="alternative" href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/example-templates-autoscaling.html" hreflang="en" /><link rel="alternative" href="https://docs.aws.amazon.com/es_es/AWSCloudFormation/latest/UserGuide/example-templates-autoscaling.html" hreflang="es-es" /><link rel="alternative" href="https://docs.aws.amazon.com/es_es/AWSCloudFormation/latest/UserGuide/example-templates-autoscaling.html" hreflang="es" /><link rel="alternative" href="https://docs.aws.amazon.com/fr_fr/AWSCloudFormation/latest/UserGuide/example-templates-autoscaling.html" hreflang="fr-fr" /><link rel="alternative" href="https://docs.aws.amazon.com/fr_fr/AWSCloudFormation/latest/UserGuide/example-templates-autoscaling.html" hreflang="fr" /><link rel="alternative" href="https://docs.aws.amazon.com/it_it/AWSCloudFormation/latest/UserGuide/example-templates-autoscaling.html" hreflang="it-it" /><link rel="alternative" href="https://docs.aws.amazon.com/it_it/AWSCloudFormation/latest/UserGuide/example-templates-autoscaling.html" hreflang="it" /><link rel="alternative" href="https://docs.aws.amazon.com/ja_jp/AWSCloudFormation/latest/UserGuide/example-templates-autoscaling.html" hreflang="ja-jp" /><link rel="alternative" href="https://docs.aws.amazon.com/ja_jp/AWSCloudFormation/latest/UserGuide/example-templates-autoscaling.html" hreflang="ja" /><link rel="alternative" href="https://docs.aws.amazon.com/ko_kr/AWSCloudFormation/latest/UserGuide/example-templates-autoscaling.html" hreflang="ko-kr" /><link rel="alternative" href="https://docs.aws.amazon.com/ko_kr/AWSCloudFormation/latest/UserGuide/example-templates-autoscaling.html" hreflang="ko" /><link rel="alternative" href="https://docs.aws.amazon.com/pt_br/AWSCloudFormation/latest/UserGuide/example-templates-autoscaling.html" hreflang="pt-br" /><link rel="alternative" href="https://docs.aws.amazon.com/pt_br/AWSCloudFormation/latest/UserGuide/example-templates-autoscaling.html" hreflang="pt" /><link rel="alternative" href="https://docs.aws.amazon.com/zh_cn/AWSCloudFormation/latest/UserGuide/example-templates-autoscaling.html" hreflang="zh-cn" /><link rel="alternative" href="https://docs.aws.amazon.com/zh_tw/AWSCloudFormation/latest/UserGuide/example-templates-autoscaling.html" hreflang="zh-tw" /><link rel="alternative" href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/example-templates-autoscaling.html" hreflang="x-default" /><meta name="feedback-item" content="CloudFormation" /><meta name="this_doc_product" content="AWS CloudFormation" /><meta name="this_doc_guide" content="ユーザーガイド" /><script defer="" src="/assets/r/vendor4.js?version=2021.12.02"></script><script defer="" src="/assets/r/vendor3.js?version=2021.12.02"></script><script defer="" src="/assets/r/vendor1.js?version=2021.12.02"></script><script defer="" src="/assets/r/awsdocs-common.js?version=2021.12.02"></script><script defer="" src="/assets/r/awsdocs-doc-page.js?version=2021.12.02"></script><link href="/assets/r/vendor4.css?version=2021.12.02" rel="stylesheet" /><link href="/assets/r/awsdocs-common.css?version=2021.12.02" rel="stylesheet" /><link href="/assets/r/awsdocs-doc-page.css?version=2021.12.02" rel="stylesheet" /><script async="" id="awsc-panorama-bundle" type="text/javascript" src="https://prod.pa.cdn.uis.awsstatic.com/panorama-nav-init.js" data-config="{'appEntity':'aws-documentation','region':'us-east-1','service':'cloudformation'}"></script><meta id="panorama-serviceSubSection" value="ユーザーガイド" /><meta id="panorama-serviceConsolePage" value="チュートリアル: スケールおよび負荷分散されたアプリケーションを作成する" /></head><body class="awsdocs awsui"><div class="awsdocs-container"><awsdocs-header></awsdocs-header><awsui-app-layout id="app-layout" class="awsui-util-no-gutters" ng-controller="ContentController as $ctrl" header-selector="awsdocs-header" navigation-hide="false" navigation-width="$ctrl.navWidth" navigation-open="$ctrl.navOpen" navigation-change="$ctrl.onNavChange($event)" tools-hide="$ctrl.hideTools" tools-width="$ctrl.toolsWidth" tools-open="$ctrl.toolsOpen" tools-change="$ctrl.onToolsChange($event)"><div id="guide-toc" dom-region="navigation"><awsdocs-toc></awsdocs-toc></div><div id="main-column" dom-region="content" tabindex="-1"><awsdocs-view class="awsdocs-view"><div id="awsdocs-content"><head><title>チュートリアル: スケールおよび負荷分散されたアプリケーションを作成する - AWS CloudFormation</title><meta name="rss" content="aws-cloudformation-release-notes.rss" /><meta name="forums" content="http://forums.aws.amazon.com/forum.jspa?forumID=92" /><meta name="feedback" content="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=CloudFormation&amp;topic_url=https://docs.aws.amazon.com/ja_jp/AWSCloudFormation/latest/UserGuide/example-templates-autoscaling.html" /><meta name="feedback-yes" content="feedbackyes.html?topic_url=https://docs.aws.amazon.com/ja_jp/AWSCloudFormation/latest/UserGuide/example-templates-autoscaling.html" /><meta name="feedback-no" content="feedbackno.html?topic_url=https://docs.aws.amazon.com/ja_jp/AWSCloudFormation/latest/UserGuide/example-templates-autoscaling.html" /><meta name="keywords" content="CloudFormation,AWSCloudFormation,リソースのプロビジョニング,リソース構成,インフラストラクチャ管理,CloudFormer,CloudFormation スタック,CloudFormation StackSet,CloudFormation テンプレート,変更セット" /><script type="application/ld+json">
{
    "@context" : "https://schema.org",
    "@type" : "BreadcrumbList",
    "itemListElement" : [
      {
        "@type" : "ListItem",
        "position" : 1,
        "name" : "AWS",
        "item" : "https://aws.amazon.com"
      },
      {
        "@type" : "ListItem",
        "position" : 2,
        "name" : "AWS CloudFormation",
        "item" : "https://docs.aws.amazon.com/cloudformation/index.html"
      },
      {
        "@type" : "ListItem",
        "position" : 3,
        "name" : "ユーザーガイド",
        "item" : "https://docs.aws.amazon.com/ja_jp/AWSCloudFormation/latest/UserGuide"
      },
      {
        "@type" : "ListItem",
        "position" : 4,
        "name" : "AWS CloudFormation テンプレートの使用",
        "item" : "https://docs.aws.amazon.com/ja_jp/AWSCloudFormation/latest/UserGuide/template-guide.html"
      },
      {
        "@type" : "ListItem",
        "position" : 5,
        "name" : "チュートリアル",
        "item" : "https://docs.aws.amazon.com/ja_jp/AWSCloudFormation/latest/UserGuide/CHAP_Using.html"
      },
      {
        "@type" : "ListItem",
        "position" : 6,
        "name" : "チュートリアル: スケールおよび負荷分散されたアプリケーションを作成する",
        "item" : "https://docs.aws.amazon.com/ja_jp/AWSCloudFormation/latest/UserGuide/CHAP_Using.html"
      }
    ]
}
</script></head><body><div id="main"><div style="display: none"></div><div id="breadcrumbs" class="breadcrumb"><a href="https://aws.amazon.com">AWS</a><a href="/index.html">ドキュメント</a><a href="/cloudformation/index.html">AWS CloudFormation</a><a href="Welcome.html">ユーザーガイド</a></div><div id="page-toc-src"><a href="#example-templates-autoscaling-full-stack-template">フルスタックテンプレート</a><a href="#example-templates-autoscaling-description">テンプレートのチュートリアル</a><a href="#example-templates-autoscaling-launch-stack">ステップ 1: スタックを起動する</a><a href="#example-templates-autoscaling-clean-up">ステップ 2: サンプルリソースをクリーンアップする</a></div><div id="main-content" class="awsui-util-container"><div id="main-col-body"><awsdocs-language-banner data-service="$ctrl.pageService"></awsdocs-language-banner><h1 class="topictitle" id="example-templates-autoscaling">チュートリアル: スケールおよび負荷分散されたアプリケーションを作成する</h1><div class="awsdocs-page-header-container"><awsdocs-page-header></awsdocs-page-header><awsdocs-filter-selector id="awsdocs-filter-selector"></awsdocs-filter-selector></div><p>このチュートリアルでは、スケールおよび負荷分散されたアプリケーションの設定に役立つスタックを作成します。チュートリアルでは、スタックの作成に使用するサンプルテンプレートを提供します。このサンプルテンプレートは、Auto Scaling グループ、Application Load Balancer、ロードバランサーと Auto Scaling グループへのトラフィックを制御するセキュリティグループ、およびスケーリングアクティビティに関する通知を発行する Amazon SNS 通知設定をプロビジョニングします。</p><p>このテンプレートは、1 つ以上の Amazon EC2 インスタンスと Application Load Balancer を作成します。このテンプレートからスタックを作成した場合、AWS リソースに対する料金が発生します。</p>
    <h2 id="example-templates-autoscaling-full-stack-template">フルスタックテンプレート</h2>
    <p>テンプレートから始めましょう。</p>

    <div class="minimized-block" data-minimized="true"><div class="minimized-content" data-minimized-height="450">
      <p><strong>YAML</strong></p>
      <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="コピー"><awsui-icon name="copy"></awsui-icon></div></div><code class="yaml ">AWSTemplateFormatVersion: 2010-09-09
Parameters:
  InstanceType:
    Description: The EC2 instance type
    Type: String
    Default: t3.micro
    AllowedValues:
      - t3.micro
      - t3.small
      - t3.medium
  KeyName:
    Description: Name of an existing EC2 key pair to allow SSH access to the instances
    Type: 'AWS::EC2::KeyPair::KeyName'
  LatestAmiId:
    Description: The latest Amazon Linux 2 AMI from the Parameter Store
    Type: 'AWS::SSM::Parameter::Value&lt;AWS::EC2::Image::Id&gt;'
    Default: '/aws/service/ami-amazon-linux-latest/amzn2-ami-hvm-x86_64-gp2'
  OperatorEmail:
    Description: The email address to notify when there are any scaling activities
    Type: String
  SSHLocation:
    Description: The IP address range that can be used to SSH to the EC2 instances
    Type: String
    MinLength: 9
    MaxLength: 18
    Default: 0.0.0.0/0
    ConstraintDescription: must be a valid IP CIDR range of the form x.x.x.x/x.
  Subnets:
    Type: 'List&lt;AWS::EC2::Subnet::Id&gt;'
    Description: At least two public subnets in different Availability Zones in the selected VPC
  VPC:
    Type: 'AWS::EC2::VPC::Id'
    Description: A virtual private cloud (VPC) that enables resources in public subnets to connect to the internet
Resources:
  ELBSecurityGroup:
    Type: AWS::EC2::SecurityGroup
    Properties:
      GroupDescription: ELB Security Group
      VpcId: !Ref VPC
      SecurityGroupIngress:
      - IpProtocol: tcp
        FromPort: 80
        ToPort: 80
        CidrIp: 0.0.0.0/0
  EC2SecurityGroup:
    Type: AWS::EC2::SecurityGroup
    Properties:
      GroupDescription: EC2 Security Group
      VpcId: !Ref VPC
      SecurityGroupIngress:
      - IpProtocol: tcp
        FromPort: 80
        ToPort: 80
        SourceSecurityGroupId:
          Fn::GetAtt:
          - ELBSecurityGroup
          - GroupId
      - IpProtocol: tcp
        FromPort: 22
        ToPort: 22
        CidrIp: !Ref SSHLocation
  EC2TargetGroup:
    Type: AWS::ElasticLoadBalancingV2::TargetGroup
    Properties:
      HealthCheckIntervalSeconds: 30
      HealthCheckProtocol: HTTP
      HealthCheckTimeoutSeconds: 15
      HealthyThresholdCount: 5
      Matcher:
        HttpCode: '200'
      Name: EC2TargetGroup
      Port: 80
      Protocol: HTTP
      TargetGroupAttributes:
      - Key: deregistration_delay.timeout_seconds
        Value: '20'
      UnhealthyThresholdCount: 3
      VpcId: !Ref VPC
  ALBListener:
    Type: AWS::ElasticLoadBalancingV2::Listener
    Properties:
      DefaultActions:
        - Type: forward
          TargetGroupArn: !Ref EC2TargetGroup
      LoadBalancerArn: !Ref ApplicationLoadBalancer
      Port: 80
      Protocol: HTTP
  ApplicationLoadBalancer:
    Type: AWS::ElasticLoadBalancingV2::LoadBalancer
    Properties:
      Scheme: internet-facing
      Subnets: !Ref Subnets
      SecurityGroups:
        - !GetAtt ELBSecurityGroup.GroupId
  LaunchTemplate:
    Type: AWS::EC2::LaunchTemplate
    Properties: 
      LaunchTemplateName: !Sub $<span>{</span>AWS::StackName}-launch-template
      LaunchTemplateData:
        ImageId: !Ref LatestAmiId
        InstanceType: !Ref InstanceType
        KeyName: !Ref KeyName
        SecurityGroupIds: 
          - !Ref EC2SecurityGroup
        UserData:
          Fn::Base64: !Sub |
            #!/bin/bash
            yum update -y
            yum install -y httpd
            systemctl start httpd
            systemctl enable httpd
            echo "&lt;h1&gt;Hello World!&lt;/h1&gt;" &gt; /var/www/html/index.html
  NotificationTopic:
    Type: AWS::SNS::Topic
    Properties:
      Subscription:
        - Endpoint: !Ref OperatorEmail
          Protocol: email
  WebServerGroup:
    Type: AWS::AutoScaling::AutoScalingGroup
    Properties:
      LaunchTemplate:
        LaunchTemplateId: !Ref LaunchTemplate
        Version: !GetAtt LaunchTemplate.LatestVersionNumber
      MaxSize: '3'
      MinSize: '1'
      NotificationConfigurations:
        - TopicARN: !Ref NotificationTopic
          NotificationTypes: ['autoscaling:EC2_INSTANCE_LAUNCH', 'autoscaling:EC2_INSTANCE_LAUNCH_ERROR', 'autoscaling:EC2_INSTANCE_TERMINATE', 'autoscaling:EC2_INSTANCE_TERMINATE_ERROR']
      TargetGroupARNs:
        - !Ref EC2TargetGroup
      VPCZoneIdentifier: !Ref Subnets</code></pre>
      <p><strong>JSON</strong></p>
      <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="コピー"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
  "AWSTemplateFormatVersion":"2010-09-09",
  "Parameters":<span>{</span>
    "InstanceType":<span>{</span>
      "Description":"The EC2 instance type",
      "Type":"String",
      "Default":"t3.micro",
      "AllowedValues":[
        "t3.micro",
        "t3.small",
        "t3.medium"
      ]
    },
    "KeyName":<span>{</span>
      "Description":"Name of an existing EC2 key pair to allow SSH access to the instances",
      "Type":"AWS::EC2::KeyPair::KeyName"
    },
    "LatestAmiId":<span>{</span>
      "Description":"The latest Amazon Linux 2 AMI from the Parameter Store",
      "Type":"AWS::SSM::Parameter::Value&lt;AWS::EC2::Image::Id&gt;",
      "Default":"/aws/service/ami-amazon-linux-latest/amzn2-ami-hvm-x86_64-gp2"
    },
    "OperatorEmail":<span>{</span>
      "Description":"The email address to notify when there are any scaling activities",
      "Type":"String"
    },
    "SSHLocation":<span>{</span>
      "Description":"The IP address range that can be used to SSH to the EC2 instances",
      "Type":"String",
      "MinLength":9,
      "MaxLength":18,
      "Default":"0.0.0.0/0",
      "ConstraintDescription":"Must be a valid IP CIDR range of the form x.x.x.x/x."
    },
    "Subnets":<span>{</span>
      "Type":"List&lt;AWS::EC2::Subnet::Id&gt;",
      "Description":"At least two public subnets in different Availability Zones in the selected VPC"
    },
    "VPC":<span>{</span>
      "Type":"AWS::EC2::VPC::Id",
      "Description":"A virtual private cloud (VPC) that enables resources in public subnets to connect to the internet"
    }
  },
  "Resources":<span>{</span>
    "ELBSecurityGroup":<span>{</span>
      "Type":"AWS::EC2::SecurityGroup",
      "Properties":<span>{</span>
        "GroupDescription":"ELB Security Group",
        "VpcId":<span>{</span>
          "Ref":"VPC"
        },
        "SecurityGroupIngress":[
          <span>{</span>
            "IpProtocol":"tcp",
            "FromPort":80,
            "ToPort":80,
            "CidrIp":"0.0.0.0/0"
          }
        ]
      }
    },
    "EC2SecurityGroup":<span>{</span>
      "Type":"AWS::EC2::SecurityGroup",
      "Properties":<span>{</span>
        "GroupDescription":"EC2 Security Group",
        "VpcId":<span>{</span>
          "Ref":"VPC"
        },
        "SecurityGroupIngress":[
          <span>{</span>
            "IpProtocol":"tcp",
            "FromPort":80,
            "ToPort":80,
            "SourceSecurityGroupId":<span>{</span>
              "Fn::GetAtt":[
                "ELBSecurityGroup",
                "GroupId"
              ]
            }
          },
          <span>{</span>
            "IpProtocol":"tcp",
            "FromPort":22,
            "ToPort":22,
            "CidrIp":<span>{</span>
              "Ref":"SSHLocation"
            }
          }
        ]
      }
    },
    "EC2TargetGroup":<span>{</span>
      "Type":"AWS::ElasticLoadBalancingV2::TargetGroup",
      "Properties":<span>{</span>
        "HealthCheckIntervalSeconds":30,
        "HealthCheckProtocol":"HTTP",
        "HealthCheckTimeoutSeconds":15,
        "HealthyThresholdCount":5,
        "Matcher":<span>{</span>
          "HttpCode":"200"
        },
        "Name":"EC2TargetGroup",
        "Port":80,
        "Protocol":"HTTP",
        "TargetGroupAttributes":[
          <span>{</span>
            "Key":"deregistration_delay.timeout_seconds",
            "Value":"20"
          }
        ],
        "UnhealthyThresholdCount":3,
        "VpcId":<span>{</span>
          "Ref":"VPC"
        }
      }
    },
    "ALBListener":<span>{</span>
      "Type":"AWS::ElasticLoadBalancingV2::Listener",
      "Properties":<span>{</span>
        "DefaultActions":[
          <span>{</span>
            "Type":"forward",
            "TargetGroupArn":<span>{</span>
              "Ref":"EC2TargetGroup"
            }
          }
        ],
        "LoadBalancerArn":<span>{</span>
          "Ref":"ApplicationLoadBalancer"
        },
        "Port":80,
        "Protocol":"HTTP"
      }
    },
    "ApplicationLoadBalancer":<span>{</span>
      "Type":"AWS::ElasticLoadBalancingV2::LoadBalancer",
      "Properties":<span>{</span>
        "Scheme":"internet-facing",
        "Subnets":<span>{</span>
          "Ref":"Subnets"
        },
        "SecurityGroups":[
          <span>{</span>
            "Fn::GetAtt":[
              "ELBSecurityGroup",
              "GroupId"
            ]
          }
        ]
      }
    },
    "LaunchTemplate":<span>{</span>
      "Type":"AWS::EC2::LaunchTemplate",
      "Properties":<span>{</span>
        "LaunchTemplateName":<span>{</span>
          "Fn::Sub":"$<span>{</span>AWS::StackName}-launch-template"
        },
        "LaunchTemplateData":<span>{</span>
          "ImageId":<span>{</span>
            "Ref":"LatestAmiId"
          },
          "InstanceType":<span>{</span>
            "Ref":"InstanceType"
          },
          "KeyName":<span>{</span>
            "Ref":"KeyName"
          },
          "SecurityGroupIds":[
            <span>{</span>
              "Ref":"EC2SecurityGroup"
            }
          ],
          "UserData":<span>{</span>
            "Fn::Base64":<span>{</span>
              "Fn::Join":[
                "",
                [
                  "#!/bin/bash\n",
                  "yum update -y\n",
                  "yum install -y httpd\n",
                  "systemctl start httpd\n",
                  "systemctl enable httpd\n",
                  "echo \"&lt;h1&gt;Hello World!&lt;/h1&gt;\" &gt; /var/www/html/index.html"
                ]
              ]
            }
          }
        }
      }
    },
    "NotificationTopic":<span>{</span>
      "Type":"AWS::SNS::Topic",
      "Properties":<span>{</span>
        "Subscription":[
          <span>{</span>
            "Endpoint":<span>{</span>
              "Ref":"OperatorEmail"
            },
            "Protocol":"email"
          }
        ]
      }
    },
    "WebServerGroup":<span>{</span>
      "Type":"AWS::AutoScaling::AutoScalingGroup",
      "Properties":<span>{</span>
        "LaunchTemplate":<span>{</span>
          "LaunchTemplateId":<span>{</span>
            "Ref":"LaunchTemplate"
          },
          "Version":<span>{</span>
            "Fn::GetAtt":[
              "LaunchTemplate",
              "LatestVersionNumber"
            ]
          }
        },
        "MaxSize":"3",
        "MinSize":"1",
        "NotificationConfigurations":[
          <span>{</span>
            "TopicARN":<span>{</span>
              "Ref":"NotificationTopic"
            },
            "NotificationTypes":[
              "autoscaling:EC2_INSTANCE_LAUNCH",
              "autoscaling:EC2_INSTANCE_LAUNCH_ERROR",
              "autoscaling:EC2_INSTANCE_TERMINATE",
              "autoscaling:EC2_INSTANCE_TERMINATE_ERROR"
            ]
          }
        ],
        "TargetGroupARNs":[
          <span>{</span>
            "Ref":"EC2TargetGroup"
          }
        ],
        "VPCZoneIdentifier":<span>{</span>
          "Ref":"Subnets"
        }
      }
    }
  }
}</code></pre>
    <div class="minimized-fader"></div></div><div class="show-more-btn"><a href="#"><awsui-icon class="show-more-text" variant="link" name="caret-right-filled"></awsui-icon><span class="show-more-text">表示を増やす</span><awsui-icon class="show-less-text" variant="link" name="caret-up-filled"></awsui-icon><span class="show-less-text">表示を減らす</span></a></div></div>
   
    <h2 id="example-templates-autoscaling-description">テンプレートのチュートリアル</h2>
    <p>このテンプレートの最初の部分では、<code class="code">Parameters</code> を指定します。AWS CloudFormation がスタックを正常にプロビジョニングするには、各パラメーターに実行時に値を割り当てる必要があります。テンプレートで後で指定されるリソースは、これらの値を参照し、データを使用します。</p>
    <div class="itemizedlist">
       
       
       
       
       
       
       
    <ul class="itemizedlist"><li class="listitem">
        <p><code class="code">InstanceType</code>: Amazon EC2 Auto Scaling がプロビジョニングする EC2 インスタンスのタイプ。指定しない場合は、デフォルトの <code class="code">t3.micro</code> が使用されます。</p>
      </li><li class="listitem">
        <p><code class="code">KeyName</code>: インスタンスへの SSH アクセスを許可する既存の EC2 キーペア。</p>
      </li><li class="listitem">
        <p><code class="code">LatestAmiId</code>: インスタンスの Amazon マシンイメージ (AMI)。指定しない場合、インスタンスは、AWS によって維持される AWS Systems Manager パブリックパラメータを使用して、Amazon Linux 2 AMI で起動されます。詳細については、「AWS Systems Manager ユーザーガイド」の「<a href="https://docs.aws.amazon.com/systems-manager/latest/userguide/parameter-store-finding-public-parameters.html">パブリックパラメータの検索</a>」を参照してください。</p>
      </li><li class="listitem">
        <p><code class="code">OperatorEmail</code>: スケーリングアクティビティの通知を送信するメールアドレス。</p>
      </li><li class="listitem">
        <p><code class="code">SSHLocation</code>: インスタンスへの SSH 接続に使用できる IP アドレス範囲。</p>
      </li><li class="listitem">
        <p><code class="code">Subnets</code>: 少なくとも 2 つのパブリックサブネットが異なるアベイラビリティーゾーンに存在している。</p>
      </li><li class="listitem">
        <p><code class="code">VPC</code>: パブリックサブネット内のリソースがインターネットに接続できるようにするアカウント内の仮想プライベートクラウド (VPC)。</p>
        <div class="awsdocs-note"><div class="awsdocs-note-title"><awsui-icon name="status-info" variant="link"></awsui-icon><h6>注記</h6></div><div class="awsdocs-note-text"><p>デフォルトの VPC とデフォルトのサブネットを使用して、インスタンスがインターネットにアクセスできるようにすることができます。後者の場合は、VPC に、作業中のリージョンの各アベイラビリティーゾーンにマッピングされたサブネットがあることを確認してください。ロードバランサーを作成するには、2 つ以上のパブリックサブネットが必要です。</p></div></div>
      </li></ul></div>
    <p>このテンプレートの次の部分では、<code class="code">Resources</code> を指定します。このセクションでは、スタックリソースとそのプロパティを指定します。</p>
    <p><a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-properties-ec2-security-group.html">AWS::EC2::SecurityGroup</a> リソース <code class="code">ELBSecurityGroup</code> </p>
    <div class="itemizedlist">
       
    <ul class="itemizedlist"><li class="listitem">
        <p><code class="code">SecurityGroupIngress</code> には、ポート 80 上のすべての IP アドレス ("CidrIp" : "0.0.0.0/0") からのアクセスを許可する TCP イングレスルールが含まれています。</p>
      </li></ul></div>
    <p><a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-properties-ec2-security-group.html">AWS::EC2::SecurityGroup</a> リソース <code class="code">EC2SecurityGroup</code> </p>

    <div class="itemizedlist">
       
    <ul class="itemizedlist"><li class="listitem">
        <p><code class="code">SecurityGroupIngress</code> には、1) <code class="code">SSHLocation</code> 入力パラメータ用に指定した IP アドレス範囲からの SSH アクセス (ポート 22) を許可する TCP イングレスルール、および 2) ロードバランサーのセキュリティグループを指定することによってロードバランサーからのアクセスを許可する TCP イングレスルールという 2 つのイングレスルールが含まれています。<a href="./intrinsic-function-reference-getatt.html">GetAtt</a> 関数は、論理名 <code class="code">ELBSecurityGroup</code> を持つセキュリティグループの ID を取得するために使用されます。</p>
      </li></ul></div>
    <p><a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-resource-elasticloadbalancingv2-targetgroup.html">AWS::ElasticLoadBalancingV2::TargetGroup</a> リソース <code class="code">EC2TargetGroup</code></p>
    <div class="itemizedlist">
       
       
       
    <ul class="itemizedlist"><li class="listitem">
        <p><code class="code">Port</code>、<code class="code">Protocol</code>、および <code class="code">HealthCheckProtocol</code> は、<code class="code">ApplicationLoadBalancer</code> がトラフィックをルーティングし、Elastic Load Balancing が EC2 インスタンスのヘルスをチェックするために使用する EC2 インスタンスのポート (80) とプロトコル (HTTP) を指定します。</p>
      </li><li class="listitem">
        <p><code class="code">HealthCheckIntervalSeconds</code> は、EC2 インスタンスのヘルスチェックの間隔が 30 秒であることを指定します。<code class="code">HealthCheckTimeoutSeconds</code> は、ヘルスチェックターゲットからのレスポンスを Elastic Load Balancing が待機する時間です (この例では 15 秒)。タイムアウトの時間が経過すると、Elastic Load Balancing は、EC2 インスタンスのヘルスチェックを異常としてマークします。EC2 インスタンスが 3 回連続してヘルスチェックに失敗すると (<code class="code">UnhealthyThresholdCount</code>)、Elastic Load Balancing は、そのインスタンスが 5 回連続してヘルスチェックに合格するまで (<code class="code">HealthyThresholdCount</code>)、その EC2 インスタンスへのトラフィックのルーティングを停止します。その時点で、Elastic Load Balancing は、そのインスタンスが正常であるとみなし、そのインスタンスへのトラフィックのルーティングを再開します。</p>
      </li><li class="listitem">
        <p><code class="code">TargetGroupAttributes</code> は、ターゲットグループの登録解除の遅延の値を 20 秒に更新します。デフォルトでは、Elastic Load Balancing は登録解除プロセスを完了するまで 300 秒間待機します。</p>
      </li></ul></div>
    <p><a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-resource-elasticloadbalancingv2-listener.html">AWS::ElasticLoadBalancingV2::Listener</a> リソース <code class="code">ALBListener</code></p>
    <div class="itemizedlist">
       
    <ul class="itemizedlist"><li class="listitem">
        <p><code class="code">DefaultActions</code> は、ロードバランサーがリッスンするポート、ロードバランサーがリクエストを転送するターゲットグループ、およびリクエストのルーティングに使用されるプロトコルを指定します。</p>
      </li></ul></div>
    <p><a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-resource-elasticloadbalancingv2-loadbalancer.html">AWS::ElasticLoadBalancingV2::LoadBalancer</a> リソース <code class="code">ApplicationLoadBalancer</code></p>
    <div class="itemizedlist">
       
       
    <ul class="itemizedlist"><li class="listitem">
        <p><code class="code">Subnets</code> は、<code class="code">Subnets</code> 入力パラメータの値を、ロードバランサーノードが作成されるパブリックサブネットのリストとして受け取ります。</p>
      </li><li class="listitem">
        <p><code class="code">SecurityGroup</code> は、ロードバランサーノードが着信トラフィックを制御するための仮想ファイアウォールとして機能するセキュリティグループの ID を取得します。<a href="./intrinsic-function-reference-getatt.html">GetAtt</a> 関数は、論理名 <code class="code">ELBSecurityGroup</code> を持つセキュリティグループの ID を取得するために使用されます。</p>
      </li></ul></div>
    <p><a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-resource-ec2-launchtemplate.html">AWS::EC2::LaunchTemplate</a> リソース <code class="code">LaunchTemplate</code></p>
    <div class="itemizedlist">
       
       
       
       
    <ul class="itemizedlist"><li class="listitem">
        <p><code class="code">ImageId</code> は、使用する AMI として <code class="code">LatestAmiId</code> 入力パラメータの値を受け取ります。</p>
      </li><li class="listitem">
        <p><code class="code">KeyName</code> は、使用する EC2 キーペアとして <code class="code">KeyName</code> 入力パラメータの値を受け取ります。</p>
      </li><li class="listitem">
        <p><code class="code">SecurityGroupIds</code> は、EC2 インスタンスが着信トラフィックを制御するための仮想ファイアウォールとして機能する、論理名 <code class="code">EC2SecurityGroup</code> を持つセキュリティグループの ID を取得します。</p>
      </li><li class="listitem">
        <p><code class="code">UserData</code> は、インスタンスが稼働を開始した後に実行される設定スクリプトです。この例では、スクリプトは Apache をインストールし、index.html ファイルを作成します。</p>
      </li></ul></div>
    <p><a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-resource-sns-topic.html">AWS::SNS::Topic</a> リソース <code class="code">NotificationTopic</code></p>
    <div class="itemizedlist">
       
    <ul class="itemizedlist"><li class="listitem">
        <p><code class="code">Subscription</code> は、スケーリングアクティビティがある場合、<code class="code">OperatorEmail</code> 入力パラメータの値を通知の受信者のメールアドレスとして受け取ります。</p>
      </li></ul></div>
    <p><a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-properties-as-group.html">AWS::AutoScaling::AutoScalingGroup</a> resource <code class="code">WebServerGroup</code></p>
    <div class="itemizedlist">
       
       
       
    <ul class="itemizedlist"><li class="listitem">
        <p><code class="code">MinSize</code> および <code class="code">MaxSize</code> には、Auto Scaling グループでの EC2 インスタンスの最小数と最大数を設定します。</p>
      </li><li class="listitem">
        <p><code class="code">TargetGroupARNs</code> は、論理名 <code class="code">EC2TargetGroup</code> を持つターゲットグループの ARN を取得します。この Auto Scaling グループがスケールすると、このターゲットグループに対するインスタンスの登録および登録解除が自動的に行われます。</p>
      </li><li class="listitem">
        <p><code class="code">VPCZoneIdentifier</code> は、<code class="code">Subnets</code> 入力パラメータの値を、EC2 インスタンスを作成できるパブリックサブネットのリストとして受け取ります。</p>
      </li></ul></div>
   
    <h2 id="example-templates-autoscaling-launch-stack">ステップ 1: スタックを起動する</h2>
    <p>スタックを起動する前に、Amazon EC2、Amazon EC2 Auto Scaling、AWS Systems Manager、Elastic Load Balancing、Amazon SNS、および AWS CloudFormation のすべてのサービスを使用するための AWS Identity and Access Management (IAM) 許可があることを確認してください。</p>
    <p>次の手順では、ファイルからサンプルスタックテンプレートをアップロードします。ローカルマシンでテキストエディタを開き、いずれかのテンプレートを追加します。次に、<code class="code">sampleloadbalancedappstack.template</code> という名前でファイルを保存します。</p>
    <p><b>スタックテンプレートを起動するには</b></p>

    <div class="procedure"><ol><li> <p>AWS Management Console にサインインし、AWS CloudFormation コンソール (<a href="https://console.aws.amazon.com/cloudformation/" rel="noopener noreferrer" target="_blank"><span>https://console.aws.amazon.com/cloudformation</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a>) を開きます。</p> </li><li>
        <p><b>[スタックの作成]</b> を選択し、<b>[新しいリソースの使用 (標準)]</b> を選択します。</p>
      </li><li>
        <p><b>[テンプレートを指定]</b> で、<b>[テンプレートファイルをアップロード]</b>、<b>[ファイルを選択]</b> を選択して <code class="code">sampleloadbalancedappstack.template</code> ファイルをアップロードします。</p>
      </li><li>
        <p><b>[Next]</b> (次へ) をクリックします。</p>
      </li><li>
        <p><b>[スタックの詳細を指定]</b> ページで、スタック名 (例: <code class="userinput">SampleLoadBalancedAppStack</code>) を入力します。</p>
      </li><li>
        <p><b>[パラメータ]</b> で、スタックのパラメータを確認し、<b>[OperatorEmail]</b>、<b>[SSHLocation]</b>、<b>[KeyName]</b>、<b>[VPC]</b>、<b>[Subnets]</b> など、デフォルト値がないすべてのパラメータの値を指定します。</p>
      </li><li>
        <p><b>[次へ]</b> を 2 回選択します。</p>
      </li><li>
        <p><b>[Review]</b> (確認) ページで、設定を確認して確定します。</p>
      </li><li>
        <p><b>[Submit]</b> (送信) を選択します。</p>
        <p>AWS CloudFormation コンソールの <b>[Status]</b> (ステータス) 欄でスタックのステータスを表示できます。AWS CloudFormation がスタックを正常に作成すると、<b>[CREATE_COMPLETE]</b> ステータスが表示されます。</p>
        <div class="awsdocs-note"><div class="awsdocs-note-title"><awsui-icon name="status-info" variant="link"></awsui-icon><h6>注記</h6></div><div class="awsdocs-note-text"><p>スタックを作成した後、メールアドレスで通知の受信を開始するには、サブスクリプションを確認する必要があります。詳細については、「Amazon EC2 Auto Scaling ユーザーガイド」の「<a href="https://docs.aws.amazon.com/autoscaling/ec2/userguide/ec2-auto-scaling-sns-notifications.html">Auto Scaling グループのスケール時に Amazon SNS 通知を受け取る</a>」を参照してください。</p></div></div>
      </li></ol></div>
   
    <h2 id="example-templates-autoscaling-clean-up">ステップ 2: サンプルリソースをクリーンアップする</h2>

    <p>未使用のサンプルリソースについて課金されないようにするには、スタックを削除します。</p>
    <div class="procedure"><h6>スタックを削除するには</h6><ol><li>
        <p>AWS CloudFormation コンソールで、<b>[SampleLoadBalancedAppStack]</b> スタックを選択します。</p>
      </li><li>
        <p><b>[Delete]</b> (削除) をクリックします。</p>
      </li><li>
        <p>確認メッセージで、<b>[スタックを削除]</b> を選択します。</p>
        <p><b>[SampleLoadBalancedAppStack]</b> のステータスが <b>[DELETE_IN_PROGRESS]</b> に変わります。AWS CloudFormation がスタックの削除を完了すると、リストからスタックが削除されます。</p>
      </li></ol></div>
    <p>このチュートリアルのサンプルテンプレートを使用して、独自のスタックテンプレートを構築します。詳細については、「Amazon EC2 Auto Scaling ユーザーガイド」の「<a href="https://docs.aws.amazon.com/autoscaling/ec2/userguide/tutorial-ec2-auto-scaling-load-balancer.html">チュートリアル: スケーリングとロードバランシングを使用するアプリケーションを設定する</a>」を参照してください。</p>
  <awsdocs-copyright class="copyright-print"></awsdocs-copyright><awsdocs-thumb-feedback right-edge="{{$ctrl.thumbFeedbackRightEdge}}"></awsdocs-thumb-feedback></div><noscript><div><div><div><div id="js_error_message"><p><img src="https://d1ge0kk1l5kms0.cloudfront.net/images/G/01/webservices/console/warning.png" alt="警告" /> <strong>ブラウザで JavaScript が無効になっているか、使用できません。</strong></p><p>AWS ドキュメントを使用するには、JavaScript を有効にする必要があります。手順については、使用するブラウザのヘルプページを参照してください。</p></div></div></div></div></noscript><div id="main-col-footer" class="awsui-util-font-size-0"><div id="doc-conventions"><a target="_top" href="/general/latest/gr/docconventions.html">ドキュメントの表記規則</a></div><div class="prev-next"><div id="previous" class="prev-link" accesskey="p" href="./walkthrough-crossstackref.html">チュートリアル: 別の AWS CloudFormation スタックのリソース出力を参照する</div><div id="next" class="next-link" accesskey="n" href="./deploying.applications.html"> アプリケーションのデプロイ</div></div></div><awsdocs-page-utilities></awsdocs-page-utilities></div><div id="quick-feedback-yes" style="display: none;"><div class="title">このページは役に立ちましたか? - はい</div><div class="content"><p>ページが役に立ったことをお知らせいただき、ありがとうございます。</p><p>お時間がある場合は、何が良かったかお知らせください。今後の参考にさせていただきます。</p><p><awsui-button id="fblink" rel="noopener noreferrer" target="_blank" text="フィードバック" click="linkClick($event)" href="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=CloudFormation&amp;topic_url=https://docs.aws.amazon.com/ja_jp/AWSCloudFormation/latest/UserGuide/example-templates-autoscaling.html"></awsui-button></p></div></div><div id="quick-feedback-no" style="display: none;"><div class="title">このページは役に立ちましたか? - いいえ</div><div class="content"><p>このページは修正が必要なことをお知らせいただき、ありがとうございます。ご期待に沿うことができず申し訳ありません。</p><p>お時間がある場合は、ドキュメントを改善する方法についてお知らせください。</p><p><awsui-button id="fblink" rel="noopener noreferrer" target="_blank" text="フィードバック" click="linkClick($event)" href="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=CloudFormation&amp;topic_url=https://docs.aws.amazon.com/ja_jp/AWSCloudFormation/latest/UserGuide/example-templates-autoscaling.html"></awsui-button></p></div></div></div></body></div></awsdocs-view><div class="page-loading-indicator" id="page-loading-indicator"><awsui-spinner size="large"></awsui-spinner></div></div><div id="tools-panel" dom-region="tools"><awsdocs-tools-panel id="awsdocs-tools-panel"></awsdocs-tools-panel></div></awsui-app-layout><awsdocs-cookie-banner class="doc-cookie-banner"></awsdocs-cookie-banner></div></body></html>