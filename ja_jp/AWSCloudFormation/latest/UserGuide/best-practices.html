<!DOCTYPE html>
    <html xmlns="http://www.w3.org/1999/xhtml" lang="ja-JP"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>AWS CloudFormation のベストプラクティス - AWS CloudFormation</title><meta name="viewport" content="width=device-width,initial-scale=1" /><meta name="assets_root" content="/assets" /><meta name="target_state" content="best-practices" /><meta name="default_state" content="best-practices" /><link rel="icon" type="image/ico" href="/assets/images/favicon.ico" /><link rel="shortcut icon" type="image/ico" href="/assets/images/favicon.ico" /><link rel="canonical" href="https://docs.aws.amazon.com/ja_jp/AWSCloudFormation/latest/UserGuide/best-practices.html" /><meta name="description" content="より効率的かつ安全に AWS CloudFormation を使用するために、ベストプラクティスを使用します。" /><meta name="deployment_region" content="IAD" /><meta name="product" content="AWS CloudFormation" /><meta name="guide" content="ユーザーガイド" /><meta name="abstract" content="このユーザーガイドでは、AWS CloudFormation を使用して、予測かつ再現可能な方法で、AWS インフラストラクチャのデプロイを作成して管理します。" /><meta name="guide-locale" content="ja_jp" /><meta name="tocs" content="toc-contents.json" /><link rel="canonical" href="https://docs.aws.amazon.com/ja_jp/AWSCloudFormation/latest/UserGuide/best-practices.html" /><link rel="alternative" href="https://docs.aws.amazon.com/id_id/AWSCloudFormation/latest/UserGuide/best-practices.html" hreflang="id-id" /><link rel="alternative" href="https://docs.aws.amazon.com/id_id/AWSCloudFormation/latest/UserGuide/best-practices.html" hreflang="id" /><link rel="alternative" href="https://docs.aws.amazon.com/de_de/AWSCloudFormation/latest/UserGuide/best-practices.html" hreflang="de-de" /><link rel="alternative" href="https://docs.aws.amazon.com/de_de/AWSCloudFormation/latest/UserGuide/best-practices.html" hreflang="de" /><link rel="alternative" href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/best-practices.html" hreflang="en-us" /><link rel="alternative" href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/best-practices.html" hreflang="en" /><link rel="alternative" href="https://docs.aws.amazon.com/es_es/AWSCloudFormation/latest/UserGuide/best-practices.html" hreflang="es-es" /><link rel="alternative" href="https://docs.aws.amazon.com/es_es/AWSCloudFormation/latest/UserGuide/best-practices.html" hreflang="es" /><link rel="alternative" href="https://docs.aws.amazon.com/fr_fr/AWSCloudFormation/latest/UserGuide/best-practices.html" hreflang="fr-fr" /><link rel="alternative" href="https://docs.aws.amazon.com/fr_fr/AWSCloudFormation/latest/UserGuide/best-practices.html" hreflang="fr" /><link rel="alternative" href="https://docs.aws.amazon.com/it_it/AWSCloudFormation/latest/UserGuide/best-practices.html" hreflang="it-it" /><link rel="alternative" href="https://docs.aws.amazon.com/it_it/AWSCloudFormation/latest/UserGuide/best-practices.html" hreflang="it" /><link rel="alternative" href="https://docs.aws.amazon.com/ja_jp/AWSCloudFormation/latest/UserGuide/best-practices.html" hreflang="ja-jp" /><link rel="alternative" href="https://docs.aws.amazon.com/ja_jp/AWSCloudFormation/latest/UserGuide/best-practices.html" hreflang="ja" /><link rel="alternative" href="https://docs.aws.amazon.com/ko_kr/AWSCloudFormation/latest/UserGuide/best-practices.html" hreflang="ko-kr" /><link rel="alternative" href="https://docs.aws.amazon.com/ko_kr/AWSCloudFormation/latest/UserGuide/best-practices.html" hreflang="ko" /><link rel="alternative" href="https://docs.aws.amazon.com/pt_br/AWSCloudFormation/latest/UserGuide/best-practices.html" hreflang="pt-br" /><link rel="alternative" href="https://docs.aws.amazon.com/pt_br/AWSCloudFormation/latest/UserGuide/best-practices.html" hreflang="pt" /><link rel="alternative" href="https://docs.aws.amazon.com/zh_cn/AWSCloudFormation/latest/UserGuide/best-practices.html" hreflang="zh-cn" /><link rel="alternative" href="https://docs.aws.amazon.com/zh_tw/AWSCloudFormation/latest/UserGuide/best-practices.html" hreflang="zh-tw" /><link rel="alternative" href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/best-practices.html" hreflang="x-default" /><meta name="feedback-item" content="CloudFormation" /><meta name="this_doc_product" content="AWS CloudFormation" /><meta name="this_doc_guide" content="ユーザーガイド" /><script defer="" src="/assets/r/vendor4.js?version=2021.12.02"></script><script defer="" src="/assets/r/vendor3.js?version=2021.12.02"></script><script defer="" src="/assets/r/vendor1.js?version=2021.12.02"></script><script defer="" src="/assets/r/awsdocs-common.js?version=2021.12.02"></script><script defer="" src="/assets/r/awsdocs-doc-page.js?version=2021.12.02"></script><link href="/assets/r/vendor4.css?version=2021.12.02" rel="stylesheet" /><link href="/assets/r/awsdocs-common.css?version=2021.12.02" rel="stylesheet" /><link href="/assets/r/awsdocs-doc-page.css?version=2021.12.02" rel="stylesheet" /><script async="" id="awsc-panorama-bundle" type="text/javascript" src="https://prod.pa.cdn.uis.awsstatic.com/panorama-nav-init.js" data-config="{'appEntity':'aws-documentation','region':'us-east-1','service':'cloudformation'}"></script><meta id="panorama-serviceSubSection" value="ユーザーガイド" /><meta id="panorama-serviceConsolePage" value="AWS CloudFormation のベストプラクティス" /></head><body class="awsdocs awsui"><div class="awsdocs-container"><awsdocs-header></awsdocs-header><awsui-app-layout id="app-layout" class="awsui-util-no-gutters" ng-controller="ContentController as $ctrl" header-selector="awsdocs-header" navigation-hide="false" navigation-width="$ctrl.navWidth" navigation-open="$ctrl.navOpen" navigation-change="$ctrl.onNavChange($event)" tools-hide="$ctrl.hideTools" tools-width="$ctrl.toolsWidth" tools-open="$ctrl.toolsOpen" tools-change="$ctrl.onToolsChange($event)"><div id="guide-toc" dom-region="navigation"><awsdocs-toc></awsdocs-toc></div><div id="main-column" dom-region="content" tabindex="-1"><awsdocs-view class="awsdocs-view"><div id="awsdocs-content"><head><title>AWS CloudFormation のベストプラクティス - AWS CloudFormation</title><meta name="rss" content="aws-cloudformation-release-notes.rss" /><meta name="forums" content="http://forums.aws.amazon.com/forum.jspa?forumID=92" /><meta name="feedback" content="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=CloudFormation&amp;topic_url=https://docs.aws.amazon.com/ja_jp/AWSCloudFormation/latest/UserGuide/best-practices.html" /><meta name="feedback-yes" content="feedbackyes.html?topic_url=https://docs.aws.amazon.com/ja_jp/AWSCloudFormation/latest/UserGuide/best-practices.html" /><meta name="feedback-no" content="feedbackno.html?topic_url=https://docs.aws.amazon.com/ja_jp/AWSCloudFormation/latest/UserGuide/best-practices.html" /><meta name="keywords" content="CloudFormation,AWSCloudFormation,リソースのプロビジョニング,リソース構成,インフラストラクチャ管理,CloudFormer,CloudFormation スタック,CloudFormation StackSet,CloudFormation テンプレート,変更セット" /><script type="application/ld+json">
{
    "@context" : "https://schema.org",
    "@type" : "BreadcrumbList",
    "itemListElement" : [
      {
        "@type" : "ListItem",
        "position" : 1,
        "name" : "AWS",
        "item" : "https://aws.amazon.com"
      },
      {
        "@type" : "ListItem",
        "position" : 2,
        "name" : "AWS CloudFormation",
        "item" : "https://docs.aws.amazon.com/cloudformation/index.html"
      },
      {
        "@type" : "ListItem",
        "position" : 3,
        "name" : "ユーザーガイド",
        "item" : "https://docs.aws.amazon.com/ja_jp/AWSCloudFormation/latest/UserGuide"
      },
      {
        "@type" : "ListItem",
        "position" : 4,
        "name" : "AWS CloudFormation のベストプラクティス",
        "item" : "https://docs.aws.amazon.com/ja_jp/AWSCloudFormation/latest/UserGuide/best-practices.html"
      }
    ]
}
</script></head><body><div id="main"><div style="display: none"></div><div id="breadcrumbs" class="breadcrumb"><a href="https://aws.amazon.com">AWS</a><a href="/index.html">ドキュメント</a><a href="/cloudformation/index.html">AWS CloudFormation</a><a href="Welcome.html">ユーザーガイド</a></div><div id="page-toc-src"><a href="#shortenfeedbackloop">フィードバックループを短縮して配信速度を向上させる</a><a href="#organizingstacks">ライフサイクルと所有権によるスタックの整理</a><a href="#cross-stack">クロススタック参照を使用して共有リソースをエクスポートします</a><a href="#limits">すべてのリソースタイプのクォータを確認する</a><a href="#reuse">テンプレートを再利用して複数の環境にスタックを複製する</a><a href="#modules-reuse">モジュールを使用してリソース構成を再利用する</a><a href="#parmtypes">AWS 固有のパラメータタイプを使用する</a><a href="#parmconstraints">パラメータの制約の使用</a><a href="#pseudoparameters">疑似パラメータを使用して移植性を高める</a><a href="#cfninit">AWS::CloudFormation::Init を使用して Amazon EC2 インスタンスにソフトウェアアプリケーションをデプロイ</a><a href="#helper-scripts">最新のヘルパースクリプトを使用する</a><a href="#validate">テンプレートを使用する前に検証する</a><a href="#donttouch">AWS CloudFormation ですべてのスタックリソースを管理する</a><a href="#cfn-best-practices-changesets">スタックを更新する前に変更セットを作成する</a><a href="#stackpolicy">スタックポリシーを使用する</a><a href="#code">コードの確認とリビジョン管理を使用してテンプレートを管理する</a><a href="#update-ec2-linux">Amazon EC2 インスタンスを定期的に更新</a></div><div id="main-content" class="awsui-util-container"><div id="main-col-body"><awsdocs-language-banner data-service="$ctrl.pageService"></awsdocs-language-banner><h1 class="topictitle" id="best-practices">AWS CloudFormation のベストプラクティス</h1><div class="awsdocs-page-header-container"><awsdocs-page-header></awsdocs-page-header><awsdocs-filter-selector id="awsdocs-filter-selector"></awsdocs-filter-selector></div><p>ベストプラクティスはワークフロー全体で AWS CloudFormation をより効率的かつ安全に使用するために役立つ推奨事項です。スタックの計画方法と整理方法を学習し、リソースとそこで実行するソフトウェアアプリケーションを記述するテンプレートを作成して、スタックとそのリソースを管理します。次のベストプラクティスは、現在の CloudFormation のお客様の実際の経験に基づいています。</p><div class="variablelist">
     
     
     
  <dl>
      <dt><b><span class="term">計画と編成</span></b></dt>
      <dd>
        <div class="itemizedlist">
           
           
           
           
           
           
           
        <ul class="itemizedlist"><li class="listitem">
            <p><a href="#shortenfeedbackloop">フィードバックループを短縮して配信速度を向上させる</a></p>
          </li><li class="listitem">
            <p><a href="#organizingstacks">ライフサイクルと所有権によるスタックの整理</a></p>
          </li><li class="listitem">
            <p><a href="#cross-stack">クロススタック参照を使用して共有リソースをエクスポートします</a></p>
          </li><li class="listitem">
            <p><a href="./security-best-practices.html#use-iam-to-control-access">IAM を使用したアクセス制御</a></p>
          </li><li class="listitem">
            <p><a href="#reuse">テンプレートを再利用して複数の環境にスタックを複製する</a></p>
          </li><li class="listitem">
            <p><a href="#limits">すべてのリソースタイプのクォータを確認する</a>
            </p>
          </li><li class="listitem">
            <p><a href="#modules-reuse">モジュールを使用してリソース構成を再利用する</a></p>
          </li></ul></div>
      </dd>
    
      <dt><b><span class="term">テンプレートの作成</span></b></dt>
      <dd>
        <div class="itemizedlist">
           
           
           
           
           
           
           
        <ul class="itemizedlist"><li class="listitem">
            <p><a href="./security-best-practices.html#creds">テンプレートに認証情報を埋め込まない</a></p>
          </li><li class="listitem">
            <p><a href="#parmtypes">AWS 固有のパラメータタイプを使用する</a></p>
          </li><li class="listitem">
            <p><a href="#parmconstraints">パラメータの制約の使用</a></p>
          </li><li class="listitem">
            <p><a href="#pseudoparameters">疑似パラメータを使用して移植性を高める</a></p>
          </li><li class="listitem">
            <p><a href="#cfninit">AWS::CloudFormation::Init を使用して Amazon EC2 インスタンスにソフトウェアアプリケーションをデプロイ</a></p>
          </li><li class="listitem">
            <p><a href="#helper-scripts">最新のヘルパースクリプトを使用する</a></p>
          </li><li class="listitem">
            <p><a href="#validate">テンプレートを使用する前に検証する</a></p>
          </li></ul></div>
      </dd>
    
      <dt><b><span class="term">スタックの管理</span></b></dt>
      <dd>
        <div class="itemizedlist">
           
           
           
           
           
           
        <ul class="itemizedlist"><li class="listitem">
            <p><a href="#donttouch">AWS CloudFormation ですべてのスタックリソースを管理する</a></p>
          </li><li class="listitem">
            <p><a href="#cfn-best-practices-changesets">スタックを更新する前に変更セットを作成する</a></p>
          </li><li class="listitem">
            <p><a href="#stackpolicy">スタックポリシーを使用する</a></p>
          </li><li class="listitem">
            <p><a href="./security-best-practices.html#cloudtrail">AWS CloudTrail を使用して AWS CloudFormation 呼び出しを記録する</a></p>
          </li><li class="listitem">
            <p><a href="#code">コードの確認とリビジョン管理を使用してテンプレートを管理する</a></p>
          </li><li class="listitem">
            <p><a href="#update-ec2-linux">Amazon EC2 インスタンスを定期的に更新</a></p>
          </li></ul></div>
      </dd>
    </dl></div>
    <h2 id="shortenfeedbackloop">フィードバックループを短縮して配信速度を向上させる</h2>

    <p>CloudFormation テンプレートで記述したインフラストラクチャのフィードバックループを短縮するのに役立つ、プラクティスやツールを採用します。これには、ワークステーションで早期にテンプレートのリンティングとテストを行うことが含まれます。そうすることで、コントリビューションをソースコードリポジトリに送信する前でも、潜在的な構文や構成上の問題を発見する機会が得られます。このような問題を早期に発見することで、開発、品質保証、生産などの正式なライフサイクル環境に問題を持ち込まないようにすることができます。この早期テストによるフェイルファストのアプローチには、やり直しの待ち時間が減り、潜在的な影響範囲が減り、プロビジョニングオペレーションが成功する自信が高まるというメリットがあります。</p>
    <p>フェイルファストの実践に役立つツールの選択肢には、<a href="https://github.com/aws-cloudformation/cfn-lint" rel="noopener noreferrer" target="_blank"><span>AWS CloudFormation Linter</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a> (cfn-lint) や <a href="https://github.com/aws-ia/taskcat" rel="noopener noreferrer" target="_blank"><span>TaskCat</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a> コマンドラインツールなどがあります。cfn-lint ツールを使用すると、CloudFormation テンプレートを「<a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/cfn-resource-specification.html">AWS CloudFormation リソース仕様</a>」に照らして検証することができます。これには、リソースプロパティの有効な値の確認やベストプラクティスが含まれます。cfn-lint のプラグインは<a href="https://github.com/aws-cloudformation/cfn-lint#editor-plugins" rel="noopener noreferrer" target="_blank"><span>多くのコードエディターで利用可能</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a>です。これにより、エディター内の問題を視覚化し、リンターからのフィードバックを直接得ることができます。ソースコードリポジトリの設定に cfn-lint を統合することも選択できるため、コントリビューションをコミットするときにテンプレートの検証を実行できます。詳細については、「<a href="https://aws.amazon.com/blogs/mt/git-pre-commit-validation-of-aws-cloudformation-templates-with-cfn-lint/" rel="noopener noreferrer" target="_blank"><span>cfn-lint による AWS CloudFormation テンプレートの Git コミット前検証</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a>」を参照してください。最初のリンティングを実行し、cfn-lint で発生した可能性のある問題を修正したら、TaskCat を使って選択した AWS リージョンにプログラムでスタックを作成することで、テンプレートをテストできます。TaskCat は、選択した各リージョンの合格/不合格評価を含むレポートも生成します。</p>
    <p>両方のツールを使用してフィードバックループを短縮する方法について、ステップバイステップで実践的なウォークスルーを行うには、「<a href="https://catalog.workshops.aws/cfn101/en-US" rel="noopener noreferrer" target="_blank"><span>AWS CloudFormation ワークショップ</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a>」の「<a href="https://catalog.workshops.aws/cfn101/en-US/basics/templates/linting-and-testing" rel="noopener noreferrer" target="_blank"><span>リンティングとテストラボ</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a>」に従ってください。</p>
   
    <h2 id="organizingstacks">ライフサイクルと所有権によるスタックの整理</h2>

    <p>AWS リソースのライフサイクルと所有権を使用して、各スタックでどのリソースを使うを判断します。最初はすべてのリソースを 1 つのスタックに置いてもかまいませんが、スタックの規模が大きくなり範囲が拡大するにつれて、単一のスタックの管理は面倒で時間かかる場合があります。共通のライフサイクルと所有権を持つリソースのグループ化により、所有者は独自のプロセスやスケジュールを使用して、他のリソースに影響を与えることなくリソースのセットを変更できます。</p>
    <p>たとえば、ロードバランサーの背後にある自動拡張インスタンスにホストされているウェブサイトを所有する開発者とエンジニアのチームがあったとしましょう。ウェブサイトは独自のライフサイクルを持ちウェブサイトチームによって保守されているため、このウェブサイトのスタックやそのリソースを作成できます。それでは、同様にバックエンドのデータベースを使用するウェブサイトがあり、そのデータベースは別のスタックでデータベース管理者が所有し保守しているとしましょう。ウェブサイトチームまたはデータベースチームがリソースを更新する必要があるときはいつでも、互いのスタックに影響を与えることなく実行できます。すべてのリソースが単一のスタックにある場合は、更新の連携や連絡は難しくなるでしょう。</p>
    <p>スタックの整理についての詳細なガイダンスについては、2 つの一般的なフレームワークを使用できます。多層アーキテクチャーとサービス指向アーキテクチャー (SOA) です。</p>
    <p>多層アーキテクチャーは、スタックを積み上げて構築する複数の水平の層に整理します。各層はその直下の層に依存します。各層には 1 つ以上のスタックを持つことができますが、各層のスタックは類似したライフサイクルと所有権を持つ AWS リソースを持つ必要があります。</p>
    <p>サービス指向アーキテクチャーを使用すると、業務上の大きな問題を処理しやすい大きさに整理できます。これらのパートはそれぞれ、明確に定義された目的があり、機能の自己充足単位を表します。これらのサービスを、それぞれ独自のライフサイクルと所有者があるスタックにマッピングできます。これらのサービス (スタック) を 1 つに繋いで、相互に通信するようにできます。</p>
   
    <h2 id="cross-stack">クロススタック参照を使用して共有リソースをエクスポートします</h2>

    <p>ライフサイクルと所有権に基づいて AWS リソースを整理するときに、別のスタックにあるリソースを使用するスタックを構築することもできます。値をハードコード化または入力パラメータを使用して、リソース名と ID を渡すことができます。ただし、これらのメソッドはテンプレートの再利用を困難にしたり、スタック実行のオーバーヘッドを増やす場合があります。代わりに、スタックからリソースをエクスポートするクロススタック参照を使用すると、他のスタックがリソースを使用できます。スタックは <code class="code">Fn::ImportValue</code> 関数を使用して、エクスポートされたリソースを呼び出して使用できます。</p>
    <p>たとえば、VPC、セキュリティグループ、およびサブネットを含むネットワークスタックがあるかもしれません。すべてのパブリックウェブアプリケーションにこれらのリソースを使用する場合。リソースをエクスポートすることによって、パブリックウェブアプリケーションのすべてのスタックでリソースが使用できるようになります。詳細については、「<a href="./walkthrough-crossstackref.html">チュートリアル: 別の AWS CloudFormation スタックのリソース出力を参照する</a>」を参照してください。</p>
   
    <h2 id="limits">すべてのリソースタイプのクォータを確認する</h2>

    <p>スタックを起動する前に、必要なすべてのリソースを AWS アカウントの制限に触れずに作成できることを確認します。制限に触れる場合は、クオータを増やすかまたは追加リソースを削除するまで、CloudFormation でスタックが正常に作成されません。各サービスには、スタックを起動する前に知っておくべきさまざまな制限があります。例えば、デフォルトでは、AWS アカウント でリージョンごとに 2,000 件の CloudFormation スタックのみを起動できます。制限およびデフォルトの制限を引き上げる方法の詳細については、「AWS 全般のリファレンス」の「<a href="https://docs.aws.amazon.com/general/latest/gr/aws_service_limits.html">AWS のサービスクォータ</a>」を参照してください。</p>
   
    <h2 id="reuse">テンプレートを再利用して複数の環境にスタックを複製する</h2>

    <p>スタックとリソースをセットアップした後、テンプレートを再利用してインフラストラクチャを複数の環境に複製できます。たとえば、開発、テスト、本番の環境を作成して、本番環境に実装する前に変更をテストすることができます。テンプレートを再利用可能にするには、パラメーター、マッピング、および条件セクションを使用してスタックの作成時にカスタマイズできるようにします。たとえば、開発環境では、本番環境と比べて低価格のインスタンスタイプを指定し、その他の構成や設定は同じにできます。パラメーター、マッピング、条件の詳細については、「<a href="./template-anatomy.html">テンプレートの構造分析</a>」を参照してください。</p>
   
    <h2 id="modules-reuse">モジュールを使用してリソース構成を再利用する</h2>

    <p>インフラストラクチャが大きくなるにつれ、各テンプレートで同じコンポーネントを宣言する共通パターンができてきます。<em>モジュール</em>は、スタックテンプレート全体に含めるリソース構成をパッケージ化する、透過的で管理しやすく、繰り返し可能な方法です。モジュールは、共通のサービス構成とベストプラクティスを、スタックテンプレートに含めるためのモジュール式のカスタマイズ可能なビルディングブロックとしてカプセル化できます。</p>
    <p>これらのビルディングブロックは、Amazon Elastic Compute Cloud (Amazon EC2) インスタンスを定義するためのベストプラクティスなど、単一のリソース用にすることも、アプリケーションアーキテクチャの一般的なパターンを定義するために、複数のリソース用にすることもできます。これらのビルディングブロックは他のモジュールにネストできるため、ベストプラクティスを上位レベルのビルディングブロックに積み重ねることができます。CloudFormation モジュールは <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/registry.html">CloudFormation レジストリ</a>で利用できるため、ネイティブリソースのように使用できます。CloudFormation モジュールを使用すれば、モジュールテンプレートが使用テンプレートに展開され、<a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/intrinsic-function-reference-ref.html">Ref</a> または <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/intrinsic-function-reference-getatt.html">Fn::GetAtt</a> を使用してモジュール内のリソースにアクセスできるようになります。詳細については、<a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/modules.html">モジュール</a>を参照してください。</p>
   
    <h2 id="parmtypes">AWS 固有のパラメータタイプを使用する</h2>

    <p>テンプレートは、既存の Amazon Virtual Private Cloud ID または Amazon EC2 キーペア名など、既存の AWS 固有値の入力が必須の場合、AWS 固有のパラメータタイプを使用します。例えば、パラメータを <code class="code">AWS::EC2::KeyPair::KeyName</code> タイプと指定して、AWS アカウントとスタックを作成するリージョンにある既存のキーペア名を使用します。AWS CloudFormation はスタックを作成する前に、すばやく AWS 固有パラメータタイプの値を検証します。また、CloudFormation コンソールを使用する場合、CloudFormation が有効な値のドロップダウンリストを表示するため、正しい VPC ID またはキーペア名を調べたり暗記したりする必要はありません。詳細については、「<a href="./parameters-section-structure.html">パラメータ</a>」を参照してください。</p>
   
    <h2 id="parmconstraints">パラメータの制約の使用</h2>

    <p>制約を使用すると、許可される入力値を記述することで CloudFormation がスタックを作成する前に無効な値を捕捉できます。最小文字数、最長文字数、許可パターンなどの制限を設定できます。例えば、データベースのユーザー名の値は最小 8 文字で英数字のみ、といった制限を設定できます。詳細については、「<a href="./parameters-section-structure.html">パラメータ</a>」を参照してください。</p>
   
    <h2 id="pseudoparameters">疑似パラメータを使用して移植性を高める</h2>

    <p>テンプレート内の<a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/pseudo-parameter-reference.html">疑似パラメータ</a>を、<code class="code">Ref</code> や <code class="code">Fn::Sub</code> などの<a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/intrinsic-function-reference.html">組み込み関数</a>の引数として使用できます。擬似パラメータは、CloudFormation によって事前定義されたパラメータです。テンプレートでは宣言しません。組み込み関数で擬似パラメータを使用すると、リージョンやアカウント間のスタックテンプレートの移植性が向上します。</p>
    <p>例えば、特定のリソースプロパティについて、別の既存リソースの <a href="https://docs.aws.amazon.com/general/latest/gr/aws-arns-and-namespaces.html">Amazon リソースネーム</a> (ARN) を指定する必要があるテンプレートを作成したいとします。この場合、既存のリソースは ARN: <code class="code">arn:aws:ssm:us-east-1:111122223333:parameter/MySampleParameter</code> を持つ <a href="https://docs.aws.amazon.com/systems-manager/latest/userguide/systems-manager-parameter-store.html">AWS Systems Manager パラメータストア</a>リソースです。<a href="https://docs.aws.amazon.com/general/latest/gr/aws-arns-and-namespaces.html#arns-syntax">ARN 形式</a>をターゲットの AWS パーティション、リージョン、アカウント ID に合わせる必要があります。これらの値をハードコーディングする代わりに、<code class="code">AWS::Partition</code>、<code class="code">AWS::Region</code>、<code class="code">AWS::AccountId</code> の疑似パラメータを使用してテンプレートの移植性を高めることができます。この場合に CloudFormation で ARN 内の要素を連結する方法の例としては、<code class="code">!Sub
        'arn:$<span>{</span>AWS::Partition}:ssm:$<span>{</span>AWS::Region}:$<span>{</span>AWS::AccountId}:parameter/MySampleParameter</code> があります。</p>
    <p>別の例として、別の CloudFormation スタックのリソース出力を参照するために <a href="./walkthrough-crossstackref.html">チュートリアル: 別の AWS CloudFormation スタックのリソース出力を参照する</a> を使用する場合を考えましょう。この例では、VPC の<a href="https://docs.aws.amazon.com/vpc/latest/userguide/configure-subnets.html">サブネット</a>を作成し、その ID を同じアカウントとリージョンの他のスタックで使用できるように<a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/outputs-section-structure.html">エクスポート</a>したとします。別のスタックでは、Amazon EC2 インスタンスを記述するときに、サブネット ID のエクスポートされた値を参照します。</p>
    <p>スタックのエクスポートはアカウントごと、リージョンごとに一意である必要があります。そのため、この場合は、<code class="code">AWS::StackName</code> 擬似パラメータを使用してエクスポート用のプレフィックスを作成できます。スタック名もアカウントやリージョンごとに一意であることが必要なため、この疑似パラメータをプレフィックスとして使用すると、一意のエクスポート名を持つ可能性が高まるだけでなく、値をエクスポートするスタック全体の再利用可能なアプローチも促進されます。また、任意のプレフィックスを使用することも可能です。</p>
    <p><code class="code">Export</code> 出力フィールドと <code class="code">Fn::ImportValue</code>組み込み関数の詳細な使用例については、<a href="./walkthrough-crossstackref.html">チュートリアル: 別の AWS CloudFormation スタックのリソース出力を参照する</a> を参照してください。</p>
   
    <h2 id="cfninit"><code class="code">AWS::CloudFormation::Init</code> を使用して Amazon EC2 インスタンスにソフトウェアアプリケーションをデプロイ</h2>

    <p>スタックを起動する際に、cfn-init ヘルパースクリプトと <code class="code">AWS::CloudFormation::Init</code> リソースを使用して、Amazon EC2 インスタンスでソフトウェアアプリケーションをインストールして設定できます。<code class="code">AWS::CloudFormation::Init</code> を使用することで、スクリプトで手順を順番に実行するよりも自由に構成を記述できます。また、インスタンスを作り直すことなく構成を更新できます。また、構成に不具合があれば、CloudFormation が生成するログで問題を調査できます。</p>
    <p>テンプレートで、<code class="code">AWS::CloudFormation::Init</code> リソースにインストールと構成の状態を指定します。cfn-init と <code class="code">AWS::CloudFormation::Init</code> の使用方法のウォークスルーについては、「<a href="./deploying.applications.html">AWS CloudFormation を使用して Amazon EC2 にアプリケーションをデプロイする</a>」を参照してください。</p>
   
    <h2 id="helper-scripts">最新のヘルパースクリプトを使用する</h2>

    <p><a href="./cfn-helper-scripts-reference.html">ヘルパースクリプト</a>は定期的に更新されます。テンプレートの <code class="code">UserData</code> プロパティに必ず次のコマンドを含めてからヘルパースクリプトを呼び出し、起動したインスタンスで最新のヘルパースクリプトを取得できるようにしてください。</p>
    <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="コピー"><awsui-icon name="copy"></awsui-icon></div></div><code class="sh "><code class="userinput">yum install -y aws-cfn-bootstrap</code></code></pre>
    <p>最新のヘルパースクリプトの取得の詳細については、「<a href="./cfn-helper-scripts-reference.html">CloudFormation ヘルパースクリプトリファレンス</a>」を参照してください。</p>
   
    <h2 id="validate">テンプレートを使用する前に検証する</h2>

    <p>スタックの作成または更新にテンプレートを使用する前に、CloudFormation を使用してテンプレートを検証できます。テンプレートを検証することで、CloudFormation がリソースを作成する前に、依存関係の循環などの構文エラーや意味的エラーを捕捉するのに役立ちます。CloudFormation コンソールを使用する場合は、入力パラメータを指定するとコンソールが自動的にテンプレートを検証します。AWS CLI または CloudFormation API の場合は、<a href="https://docs.aws.amazon.com/cli/latest/reference/cloudformation/validate-template.html"><code class="code">aws cloudformation validate-template</code></a> コマンドまたは <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/APIReference/API_ValidateTemplate.html"><code class="code">ValidateTemplate</code></a> API 操作を実行してください。</p>
    <p>検証中に、CloudFormation はテンプレートが有効な JSON であるかどうかをまず確認します。そうでない場合は、CloudFormation はテンプレートが有効な YAML であるかどうかを確認します。両方のチェックが失敗すると、CloudFormation はテンプレートの検証エラーを返します。</p>
     
      <h3 id="validate-compliance">組織のポリシーに準拠するためにテンプレートを検証する</h3>
      <p>組織ポリシーガイドラインのコンプライアンス用のテンプレートを検証することもできます。AWS CloudFormation Guard (<code class="code">cfn-guard</code>) は、オープンソースのコマンドラインインターフェース (CLI) ツールです。これは、コードとしてのポリシー言語を提供し、必要なリソースと禁止されたリソースの両方の構成をチェックできるルールを定義します。その後、これらのルールに対してテンプレートを検証できます。たとえば、管理者はルールを作成して、ユーザーが常に暗号化された Amazon S3 バケットを作成するようにできます。</p>
      <p>ユーザーは、テンプレートの編集中にローカルで、または CI/CD パイプラインの一部として自動的に <code class="code">cfn-guard</code> を使用して、非準拠リソースのデプロイメントを停止できます。</p>
      <p>さらに、<code class="code">cfn-guard</code> には、既存の準拠 CloudFormation テンプレートからルールを抽出できる機能 <code class="code">rulegen</code> が含まれています。</p>
      <p>詳細については、GitHub の <a href="https://github.com/aws-cloudformation/cloudformation-guard" rel="noopener noreferrer" target="_blank"><span>cfn-guard</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a> リポジトリを参照してください。</p>
     
   
    <h2 id="donttouch">AWS CloudFormation ですべてのスタックリソースを管理する</h2>

    <p>スタックを起動した後、CloudFormation <a href="https://console.aws.amazon.com/cloudformation/home" rel="noopener noreferrer" target="_blank"><span>コンソール</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a>、<a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/APIReference/">API</a>、<a href="https://docs.aws.amazon.com/cli/latest/reference/cloudformation/index.html">AWS CLI</a> を使用して、スタック内のリソースを更新します。スタックのリソースを CloudFormation 以外の方法で変更しないでください。変更するとスタックのテンプレートとスタックリソースの現在の状態の間で不一致が起こり、スタックの更新または削除でエラーが発生する場合があります。詳細については、「<a href="./updating.stacks.walkthrough.html">チュートリアル: スタックの更新</a>」を参照してください。</p>
   
    <h2 id="cfn-best-practices-changesets">スタックを更新する前に変更セットを作成する</h2>

    <p>変更セットは、スタックの変更案が実行中のリソースに与える影響を、実装前に確認できるようにします。CloudFormation は、変更セットが実行するまでスタックを変更しないため、変更案のまま続行するか、別の変更案を作成するかを決定できます。</p>
    <p>変更セットを使用して、変更が実行中のリソース、特に重要なリソースに与える可能性のある影響を確認できます。例えば、Amazon RDS データベースインスタンスの名前を変更すると、CloudFormation によって新しいデータベースが作成され、古いものは削除されます。古いデータベースのデータをバックアップしていないと、データは失われます。変更設定を生成することで、変更によってデータベースが置き換えられることがわかります。このように、スタックを更新する前に計画を立てることができます。詳細については、「<a href="./using-cfn-updating-stacks-changesets.html">変更セットを使用したスタックの更新</a>」を参照してください。</p>
   
    <h2 id="stackpolicy">スタックポリシーを使用する</h2>

    <p>スタックポリシーは、重要なスタックリソースを保護して、意図しない更新でリソースが中断されたり置き換えられるのを防ぎます。スタックポリシーは、指定したリソースに対して実行できる更新アクションを記述する JSON ドキュメントです。重要なリソースがあるスタックを作成するときは常に、スタックポリシーを指定してください。</p>
    <p>スタックの更新中に、保護されたリソースを明示的に指定して更新する必要があります。指定しない場合は保護されたリソースは変更されません。詳細については、「<a href="./protect-stack-resources.html">スタックのリソースが更新されないようにする</a>」を参照してください。</p>
   
    <h2 id="code">コードの確認とリビジョン管理を使用してテンプレートを管理する</h2>

    <p>スタックのテンプレートには、プロパティ値などの AWS リソースの構成が記述されています。リソースの変更を確認し正確な履歴を保持するには、コードの確認とリビジョン管理を使用します。この方法は、テンプレートの異なるバージョン間の変更を追跡するのに役立ちます。また、スタックリソースの変更を追跡するのにも役立ちます。また、履歴を保守することで、いつでもスタックをテンプレートの特定のバージョンに戻すことができます。</p>
   
    <h2 id="update-ec2-linux">Amazon EC2 インスタンスを定期的に更新</h2>

    <p>CloudFormation で作成されたすべての Amazon EC2 Windows インスタンスと Amazon EC2 Linux インスタンスに対して、定期的に <code class="code">yum update</code> コマンドを実行して RPM パッケージを更新します。こうすることで、最新の修正およびセキュリティの更新を確実に取得します。</p>
  <awsdocs-copyright class="copyright-print"></awsdocs-copyright><awsdocs-thumb-feedback right-edge="{{$ctrl.thumbFeedbackRightEdge}}"></awsdocs-thumb-feedback></div><noscript><div><div><div><div id="js_error_message"><p><img src="https://d1ge0kk1l5kms0.cloudfront.net/images/G/01/webservices/console/warning.png" alt="警告" /> <strong>ブラウザで JavaScript が無効になっているか、使用できません。</strong></p><p>AWS ドキュメントを使用するには、JavaScript を有効にする必要があります。手順については、使用するブラウザのヘルプページを参照してください。</p></div></div></div></div></noscript><div id="main-col-footer" class="awsui-util-font-size-0"><div id="doc-conventions"><a target="_top" href="/general/latest/gr/docconventions.html">ドキュメントの表記規則</a></div><div class="prev-next"><div id="previous" class="prev-link" accesskey="p" href="./vpc-interface-endpoints.html">VPC エンドポイント (AWS PrivateLink)</div><div id="next" class="next-link" accesskey="n" href="./continuous-delivery-codepipeline.html">継続的デリバリー</div></div></div><awsdocs-page-utilities></awsdocs-page-utilities></div><div id="quick-feedback-yes" style="display: none;"><div class="title">このページは役に立ちましたか? - はい</div><div class="content"><p>ページが役に立ったことをお知らせいただき、ありがとうございます。</p><p>お時間がある場合は、何が良かったかお知らせください。今後の参考にさせていただきます。</p><p><awsui-button id="fblink" rel="noopener noreferrer" target="_blank" text="フィードバック" click="linkClick($event)" href="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=CloudFormation&amp;topic_url=https://docs.aws.amazon.com/ja_jp/AWSCloudFormation/latest/UserGuide/best-practices.html"></awsui-button></p></div></div><div id="quick-feedback-no" style="display: none;"><div class="title">このページは役に立ちましたか? - いいえ</div><div class="content"><p>このページは修正が必要なことをお知らせいただき、ありがとうございます。ご期待に沿うことができず申し訳ありません。</p><p>お時間がある場合は、ドキュメントを改善する方法についてお知らせください。</p><p><awsui-button id="fblink" rel="noopener noreferrer" target="_blank" text="フィードバック" click="linkClick($event)" href="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=CloudFormation&amp;topic_url=https://docs.aws.amazon.com/ja_jp/AWSCloudFormation/latest/UserGuide/best-practices.html"></awsui-button></p></div></div></div></body></div></awsdocs-view><div class="page-loading-indicator" id="page-loading-indicator"><awsui-spinner size="large"></awsui-spinner></div></div><div id="tools-panel" dom-region="tools"><awsdocs-tools-panel id="awsdocs-tools-panel"></awsdocs-tools-panel></div></awsui-app-layout><awsdocs-cookie-banner class="doc-cookie-banner"></awsdocs-cookie-banner></div></body></html>