<!DOCTYPE html>
    <html xmlns="http://www.w3.org/1999/xhtml" lang="ja-JP"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>CloudFormation のトラブルシューティング - AWS CloudFormation</title><meta name="viewport" content="width=device-width,initial-scale=1" /><meta name="assets_root" content="/assets" /><meta name="target_state" content="troubleshooting" /><meta name="default_state" content="troubleshooting" /><link rel="icon" type="image/ico" href="/assets/images/favicon.ico" /><link rel="shortcut icon" type="image/ico" href="/assets/images/favicon.ico" /><link rel="canonical" href="https://docs.aws.amazon.com/ja_jp/AWSCloudFormation/latest/UserGuide/troubleshooting.html" /><meta name="description" content="AWS CloudFormation スタックを作成、更新、または削除する際に発生する可能性のある問題をトラブルシューティングします。" /><meta name="deployment_region" content="IAD" /><meta name="product" content="AWS CloudFormation" /><meta name="guide" content="ユーザーガイド" /><meta name="abstract" content="このユーザーガイドでは、AWS CloudFormation を使用して、予測かつ再現可能な方法で、AWS インフラストラクチャのデプロイを作成して管理します。" /><meta name="guide-locale" content="ja_jp" /><meta name="tocs" content="toc-contents.json" /><link rel="canonical" href="https://docs.aws.amazon.com/ja_jp/AWSCloudFormation/latest/UserGuide/troubleshooting.html" /><link rel="alternative" href="https://docs.aws.amazon.com/id_id/AWSCloudFormation/latest/UserGuide/troubleshooting.html" hreflang="id-id" /><link rel="alternative" href="https://docs.aws.amazon.com/id_id/AWSCloudFormation/latest/UserGuide/troubleshooting.html" hreflang="id" /><link rel="alternative" href="https://docs.aws.amazon.com/de_de/AWSCloudFormation/latest/UserGuide/troubleshooting.html" hreflang="de-de" /><link rel="alternative" href="https://docs.aws.amazon.com/de_de/AWSCloudFormation/latest/UserGuide/troubleshooting.html" hreflang="de" /><link rel="alternative" href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/troubleshooting.html" hreflang="en-us" /><link rel="alternative" href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/troubleshooting.html" hreflang="en" /><link rel="alternative" href="https://docs.aws.amazon.com/es_es/AWSCloudFormation/latest/UserGuide/troubleshooting.html" hreflang="es-es" /><link rel="alternative" href="https://docs.aws.amazon.com/es_es/AWSCloudFormation/latest/UserGuide/troubleshooting.html" hreflang="es" /><link rel="alternative" href="https://docs.aws.amazon.com/fr_fr/AWSCloudFormation/latest/UserGuide/troubleshooting.html" hreflang="fr-fr" /><link rel="alternative" href="https://docs.aws.amazon.com/fr_fr/AWSCloudFormation/latest/UserGuide/troubleshooting.html" hreflang="fr" /><link rel="alternative" href="https://docs.aws.amazon.com/it_it/AWSCloudFormation/latest/UserGuide/troubleshooting.html" hreflang="it-it" /><link rel="alternative" href="https://docs.aws.amazon.com/it_it/AWSCloudFormation/latest/UserGuide/troubleshooting.html" hreflang="it" /><link rel="alternative" href="https://docs.aws.amazon.com/ja_jp/AWSCloudFormation/latest/UserGuide/troubleshooting.html" hreflang="ja-jp" /><link rel="alternative" href="https://docs.aws.amazon.com/ja_jp/AWSCloudFormation/latest/UserGuide/troubleshooting.html" hreflang="ja" /><link rel="alternative" href="https://docs.aws.amazon.com/ko_kr/AWSCloudFormation/latest/UserGuide/troubleshooting.html" hreflang="ko-kr" /><link rel="alternative" href="https://docs.aws.amazon.com/ko_kr/AWSCloudFormation/latest/UserGuide/troubleshooting.html" hreflang="ko" /><link rel="alternative" href="https://docs.aws.amazon.com/pt_br/AWSCloudFormation/latest/UserGuide/troubleshooting.html" hreflang="pt-br" /><link rel="alternative" href="https://docs.aws.amazon.com/pt_br/AWSCloudFormation/latest/UserGuide/troubleshooting.html" hreflang="pt" /><link rel="alternative" href="https://docs.aws.amazon.com/zh_cn/AWSCloudFormation/latest/UserGuide/troubleshooting.html" hreflang="zh-cn" /><link rel="alternative" href="https://docs.aws.amazon.com/zh_tw/AWSCloudFormation/latest/UserGuide/troubleshooting.html" hreflang="zh-tw" /><link rel="alternative" href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/troubleshooting.html" hreflang="x-default" /><meta name="feedback-item" content="CloudFormation" /><meta name="this_doc_product" content="AWS CloudFormation" /><meta name="this_doc_guide" content="ユーザーガイド" /><script defer="" src="/assets/r/vendor4.js?version=2021.12.02"></script><script defer="" src="/assets/r/vendor3.js?version=2021.12.02"></script><script defer="" src="/assets/r/vendor1.js?version=2021.12.02"></script><script defer="" src="/assets/r/awsdocs-common.js?version=2021.12.02"></script><script defer="" src="/assets/r/awsdocs-doc-page.js?version=2021.12.02"></script><link href="/assets/r/vendor4.css?version=2021.12.02" rel="stylesheet" /><link href="/assets/r/awsdocs-common.css?version=2021.12.02" rel="stylesheet" /><link href="/assets/r/awsdocs-doc-page.css?version=2021.12.02" rel="stylesheet" /><script async="" id="awsc-panorama-bundle" type="text/javascript" src="https://prod.pa.cdn.uis.awsstatic.com/panorama-nav-init.js" data-config="{'appEntity':'aws-documentation','region':'us-east-1','service':'cloudformation'}"></script><meta id="panorama-serviceSubSection" value="ユーザーガイド" /><meta id="panorama-serviceConsolePage" value="CloudFormation のトラブルシューティング" /></head><body class="awsdocs awsui"><div class="awsdocs-container"><awsdocs-header></awsdocs-header><awsui-app-layout id="app-layout" class="awsui-util-no-gutters" ng-controller="ContentController as $ctrl" header-selector="awsdocs-header" navigation-hide="false" navigation-width="$ctrl.navWidth" navigation-open="$ctrl.navOpen" navigation-change="$ctrl.onNavChange($event)" tools-hide="$ctrl.hideTools" tools-width="$ctrl.toolsWidth" tools-open="$ctrl.toolsOpen" tools-change="$ctrl.onToolsChange($event)"><div id="guide-toc" dom-region="navigation"><awsdocs-toc></awsdocs-toc></div><div id="main-column" dom-region="content" tabindex="-1"><awsdocs-view class="awsdocs-view"><div id="awsdocs-content"><head><title>CloudFormation のトラブルシューティング - AWS CloudFormation</title><meta name="rss" content="aws-cloudformation-release-notes.rss" /><meta name="forums" content="http://forums.aws.amazon.com/forum.jspa?forumID=92" /><meta name="feedback" content="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=CloudFormation&amp;topic_url=https://docs.aws.amazon.com/ja_jp/AWSCloudFormation/latest/UserGuide/troubleshooting.html" /><meta name="feedback-yes" content="feedbackyes.html?topic_url=https://docs.aws.amazon.com/ja_jp/AWSCloudFormation/latest/UserGuide/troubleshooting.html" /><meta name="feedback-no" content="feedbackno.html?topic_url=https://docs.aws.amazon.com/ja_jp/AWSCloudFormation/latest/UserGuide/troubleshooting.html" /><meta name="keywords" content="CloudFormation,AWSCloudFormation,リソースのプロビジョニング,リソース構成,インフラストラクチャ管理,CloudFormer,CloudFormation スタック,CloudFormation StackSet,CloudFormation テンプレート,変更セット" /><script type="application/ld+json">
{
    "@context" : "https://schema.org",
    "@type" : "BreadcrumbList",
    "itemListElement" : [
      {
        "@type" : "ListItem",
        "position" : 1,
        "name" : "AWS",
        "item" : "https://aws.amazon.com"
      },
      {
        "@type" : "ListItem",
        "position" : 2,
        "name" : "AWS CloudFormation",
        "item" : "https://docs.aws.amazon.com/cloudformation/index.html"
      },
      {
        "@type" : "ListItem",
        "position" : 3,
        "name" : "ユーザーガイド",
        "item" : "https://docs.aws.amazon.com/ja_jp/AWSCloudFormation/latest/UserGuide"
      },
      {
        "@type" : "ListItem",
        "position" : 4,
        "name" : "CloudFormation のトラブルシューティング",
        "item" : "https://docs.aws.amazon.com/ja_jp/AWSCloudFormation/latest/UserGuide/troubleshooting.html"
      }
    ]
}
</script></head><body><div id="main"><div style="display: none"></div><div id="breadcrumbs" class="breadcrumb"><a href="https://aws.amazon.com">AWS</a><a href="/index.html">ドキュメント</a><a href="/cloudformation/index.html">AWS CloudFormation</a><a href="Welcome.html">ユーザーガイド</a></div><div id="page-toc-src"><a href="#basic-ts-guide">トラブルシューティングガイド</a><a href="#troubleshooting-errors"> に関連するエラーのトラブルシューティング</a><a href="#contacting-support"> Support へのお問い合わせ</a></div><div id="main-content" class="awsui-util-container"><div id="main-col-body"><awsdocs-language-banner data-service="$ctrl.pageService"></awsdocs-language-banner><h1 class="topictitle" id="troubleshooting">CloudFormation のトラブルシューティング</h1><div class="awsdocs-page-header-container"><awsdocs-page-header></awsdocs-page-header><awsdocs-filter-selector id="awsdocs-filter-selector"></awsdocs-filter-selector></div><p>AWS CloudFormation を使用すると、CloudFormation スタックを作成、更新、または削除する際に問題が発生する場合があります。以降のセクションは、発生する可能性のある一般的な問題のトラブルシューティングに役立ちます。</p><p>CloudFormation に関する一般的な質問については、「<a href="https://aws.amazon.com/cloudformation/faqs/" rel="noopener noreferrer" target="_blank"><span>AWS CloudFormation のよくある質問</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a>」を参照してください。また、<a href="https://forums.aws.amazon.com/forum.jspa?forumID=92" rel="noopener noreferrer" target="_blank"><span>AWS CloudFormation フォーラム</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a>で回答を検索したり、質問を投稿したりすることもできます。</p><div class="highlights" id="inline-topiclist"><h6>トピック</h6><ul><li><a href="#basic-ts-guide">トラブルシューティングガイド</a></li><li><a href="#troubleshooting-errors"> に関連するエラーのトラブルシューティング</a></li><li><a href="#contacting-support"> Support へのお問い合わせ</a></li></ul></div>
        <h2 id="basic-ts-guide">トラブルシューティングガイド</h2>

        <p>AWS CloudFormation でのスタックの作成、更新、または削除に失敗した場合、問題に関する詳細情報の入手に役立つエラーメッセージやログを確認できます。ここでは、CloudFormation の問題をトラブルシューティングするための一般的な方法について説明します。特定のエラーと解決方法については、「<a href="#troubleshooting-errors"> に関連するエラーのトラブルシューティング</a>」セクションを参照してください。</p>
        <div class="itemizedlist">
             
             
        <ul class="itemizedlist"><li class="listitem">
                <p><a href="https://console.aws.amazon.com/cloudformation/" rel="noopener noreferrer" target="_blank"><span>CloudFormation コンソール</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a>を使用して、スタックのステータスを表示します。コンソールには、スタックを作成、更新、または削除する際のスタックイベントのリストを表示できます。このリストから失敗イベントを探して、そのイベントのステータスの理由を確認します。ステータスの理由には、AWS CloudFormation または問題のトラブルシューティングに役立つ特定のサービスからのエラーメッセージが含まれている可能性があります。スタックイベントの表示の詳細については、「<a href="./cfn-console-view-stack-data-resources.html">AWS Management Console での AWS CloudFormation スタックデータとリソースの表示</a>」を参照してください。</p>
            </li><li class="listitem">
                <p>Amazon EC2 の問題については、cloud-init および cfn のログを参照してください。これらのログは、<code>/var/log/</code> ディレクトリの Amazon EC2 インスタンスに発行されます。ログには、AWS CloudFormation がインスタンスをセットアップする際のプロセスとコマンドの出力がキャプチャされます。Windows の場合、<code>%ProgramFiles%\Amazon\EC2ConfigService</code> で EC2Configure サービス、<code>%ProgramData%\Amazon\EC2-Windows\Launch\Logs</code> で EC2 Launch、<code>%ProgramData%\Amazon\EC2Launch\log</code> で EC2 Launch v2、<code>C:\cfn\log</code> で cfn ログを表示します。</p>
                <p>また、AWS CloudFormation テンプレートの設定により、ログを Amazon CloudWatch に発行させることも可能です。この場合、ログは AWS Management Console に表示されるため、Amazon EC2 インスタンスに接続する必要がありません。詳細については、アプリケーション管理ブログの <a href="https://aws.amazon.com/blogs/devops/view-cloudformation-logs-in-the-console/" rel="noopener noreferrer" target="_blank"><span>View CloudFormation logs in the console</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a> を参照してください。</p>
            </li></ul></div>
     
        <h2 id="troubleshooting-errors"> に関連するエラーのトラブルシューティング</h2>

        <p>以下に挙げる AWS CloudFormation スタックに関するエラーが発生した場合に、問題の原因を特定して解決するのに役立つ解決方法を紹介します。</p>
        <div class="highlights" id="inline-topiclist"><h6>トピック</h6><ul><li><a href="#troubleshooting-errors-delete-stack-fails">スタックの削除の失敗</a></li><li><a href="#troubleshooting-errors-dependency-error">依存関係のエラー</a></li><li><a href="#troubleshooting-errors-error-parsing-parameter-when-passing-a-list">リストを渡す際のパラメーター解析エラー</a></li><li><a href="#troubleshooting-errors-insufficient-iam-permissions">IAM アクセス権限の不足</a></li><li><a href="#troubleshooting-errors-invalid-value-or-unsupported-resource-property">値が無効またはリソースのプロパティがサポートされていない</a></li><li><a href="#troubleshooting-errors-limit-exceeded">リソースクォータ</a></li><li><a href="#troubleshooting-errors-nested-stacks-are-stuck">ネストされたスタックは UPDATE_COMPLETE_CLEANUP_IN_PROGRESS、UPDATE_ROLLBACK_COMPLETE_CLEANUP_IN_PROGRESS または UPDATE_ROLLBACK_IN_PROGRESS 状態にあります。</a></li><li><a href="#troubleshooting-errors-no-updates-to-perform">実行する更新がない</a></li><li><a href="#troubleshooting-resource-did-not-stabilize">スタックの作成、更新、または削除オペレーションの際、リソースが安定しない</a></li><li><a href="#troubleshooting-errors-security-group-does-not-exist-in-vpc">セキュリティグループが VPC 内に存在しない</a></li><li><a href="#troubleshooting-errors-update-rollback-failed">更新のロールバックの失敗</a></li><li><a href="#troubleshooting-errors-wait-condition-didnt-receive-the-required-number-of-signals">待機条件が Amazon EC2 インスタンスから所定の数のシグナルを受け取らなかった</a></li><li><a href="#troubleshooting-errors-resource-removed-not-deleted">リソースはスタックから削除されましたが、削除されてはいません。</a></li></ul></div>
         
            <h3 id="troubleshooting-errors-delete-stack-fails">スタックの削除の失敗</h3>

            <p>この状況を解決するには、以下の手順を実行します。</p>
            <div class="itemizedlist">
                 
                 
                 
                 
                     
            <ul class="itemizedlist"><li class="listitem">
                    <p>一部のリソースは、削除する前に空にしなければなりません。たとえば、バケットまたはセキュリティグループを削除するには、Amazon S3 バケットのすべてのオブジェクト、または Amazon EC2 セキュリティグループのすべてのインスタンスを削除する必要があります。</p>
                </li><li class="listitem">
                    <p>スタックのリソースを削除するのに必要な IAM アクセス権限があることを確認します。AWS CloudFormation のアクセス許可に加えて、Amazon S3 や Amazon EC2 などの基盤となるサービスを使用する権限を持っている必要があります。</p>
                </li><li class="listitem">
                    <p>AWS CloudFormation で削除できなかったリソースがあったためにスタックが <code class="code">DELETE_FAILED</code> 状態である場合は、<a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/APIReference/API_DeleteStack.html"><code class="code">RetainResources</code></a> パラメータを使用して AWS CloudFormation が削除できない当該リソースを指定し、削除を再実行します。AWS CloudFormation は、保持されたリソースを残してスタックを削除します。残したいオブジェクトを含む S3 バケットなど、リソースは削除できないが、スタックは削除したい場合に便利です。</p>
                    <p>スタックを削除した後で、リソースに関連した AWS サービスを使用して、残したリソースを手動で削除できます。</p>
                </li><li class="listitem">
                    <p>削除保護を有効にしているスタックを削除することはできません。削除保護を有効にした状態でスタックを削除しようとすると、削除は失敗し、ステータスを含め、スタックが変更されることはありません。スタックの削除保護を無効にし、削除オペレーションを再度行います。</p>
                    <p>これには、ルートスタックの削除保護が有効になっている「<a href="./using-cfn-nested-stacks.html">ネストされたスタック</a>」が含まれます。ルートスタックの削除保護を無効にし、削除オペレーションを再度行います。ネストされたスタックは直接削除しないことが推奨されていますが、ルートスタックとそのリソースを削除する場合のみ削除します。</p>
                    <p>詳細については、「<a href="./using-cfn-protect-stacks.html">スタックの削除保護</a>」を参照してください。</p>
                </li><li class="listitem">
                        <p>AWS Support がある場合は、その他すべての問題について、AWS Support ケースを作成できます。「<a href="#contacting-support"> Support へのお問い合わせ</a>」を参照してください。</p>
                </li></ul></div>
         
         
            <h3 id="troubleshooting-errors-dependency-error">依存関係のエラー</h3>

            <p>依存関係のエラーを解決するには、テンプレート内の他のリソースに依存するリソースに <code class="code">DependsOn</code> 属性を追加します。場合によっては、AWS CloudFormation が正しい順序でリソースを作成または削除できるように、依存関係を明示的に宣言する必要があります。たとえば、同じスタック内に Elastic IP およびインターネットゲートウェイを持つ VPC を作成する場合、Elastic IP はインターネットゲートウェイのアタッチメントに依存させる必要があります。詳細については、「<a href="./aws-attribute-dependson.html">DependsOn 属性</a>」を参照してください。</p>
         
         
            <h3 id="troubleshooting-errors-error-parsing-parameter-when-passing-a-list">リストを渡す際のパラメーター解析エラー</h3>

            <p>AWS Command Line Interface または AWS CloudFormation を使用してリストを渡す場合、各カンマの前にエスケープ文字 (<code class="code">\</code>) を追加します。次の例は、AWS CLI を使用する場合に入力パラメータを指定する方法を示しています。</p>
         <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="コピー"><awsui-icon name="copy"></awsui-icon></div></div><code class="text ">ParameterKey=CIDR,ParameterValue='10.10.0.0/16\,10.10.0.0/24\,10.10.1.0/24'</code></pre>
         
         
            <h3 id="troubleshooting-errors-insufficient-iam-permissions">IAM アクセス権限の不足</h3>

            <p>AWS CloudFormation スタックを使用して作業する場合、AWS CloudFormation を使用するアクセス権限に加えて、テンプレートに記述されている基盤となるサービスを使用する権限を持っている必要があります。たとえば、Amazon S3 バケットを作成する場合や、Amazon EC2 インスタンスを開始する場合には、Amazon S3 または Amazon EC2 に対するアクセス権限が必要となります。AWS CloudFormation スタックの作業を行う前には IAM ポリシーを見直して、必要なアクセス権限があることを確認します。詳細については、「<a href="./using-iam-template.html">AWS Identity and Access Management によるアクセスの制御</a>」を参照してください。</p>
         
         
            <h3 id="troubleshooting-errors-invalid-value-or-unsupported-resource-property">値が無効またはリソースのプロパティがサポートされていない</h3>

            <p>AWS CloudFormation スタックを作成または更新しようとすると、入力パラメーターが無効であるか、リソースのプロパティ名がサポートされていないか、リソースのプロパティ値がサポートされていないために、その作業が失敗する場合があります。入力パラメーターについては、そのリソースが存在することを確認します。たとえば、Amazon EC2 キーペアまたは VPC ID を指定する場合、リソースはアカウント内およびスタックを作成/更新しているリージョンに存在している必要があります。確実に有効な値を使用するには、AWS 固有の<a href="./parameters-section-structure.html#parameters-section-structure-syntax">パラメータ型</a>を使用できます。</p>
            <p>リソースのプロパティ名と値については、テンプレートを更新して有効な名前と値を使用するようにしてください。すべてのリソースとそのプロパティ名のリストについては、「<a href="./aws-template-resource-type-ref.html">AWS リソースおよびプロパティタイプのリファレンス</a>」を参照してください。</p>
         
         
            <h3 id="troubleshooting-errors-limit-exceeded">リソースクォータ</h3>

            <p>リソースクォータに達していないことを確認します。例えば、起動できる Amazon EC2 オンデマンドインスタンスのデフォルトの最大数は 5 です。アカウントクォータよりも多くの Amazon EC2 オンデマンドインスタンスを作成しようとすると、インスタンスの作成が失敗し、エラー <code class="code">Status=start_failed</code> が返されます。サービスごとのデフォルト AWS クォータを表示するには、「AWS 全般のリファレンス」の「<a href="https://docs.aws.amazon.com/general/latest/gr/aws_service_limits.html">AWS サービスクォータ</a>」を参照してください。</p>
            <p>AWS CloudFormation クォータと調整戦略については、「<a href="./cloudformation-limits.html">AWS CloudFormation のクォータ</a>」を参照してください。</p>
            <p>さらに、更新中にリソースが置き換えられた場合、AWS CloudFormation は古いリソースを削除する前に新しいリソースを作成します。このリソースの置換によってリソースクォータに達してしまい、更新が失敗する場合があります。過剰なリソースを削除するか、<a href="https://docs.aws.amazon.com/general/latest/gr/aws_service_limits.html">[quota increase]</a> (クォータの増加) をリクエストすることができます。</p>
         
         
            <h3 id="troubleshooting-errors-nested-stacks-are-stuck">ネストされたスタックは <code class="code">UPDATE_COMPLETE_CLEANUP_IN_PROGRESS</code>、<code class="code">UPDATE_ROLLBACK_COMPLETE_CLEANUP_IN_PROGRESS</code> または <code class="code">UPDATE_ROLLBACK_IN_PROGRESS</code> 状態にあります。</h3>

            <p>ネストされたスタックがロールバックに失敗しました。ネストされたスタック間で使用可能なリソースの依存性により、すべてのスタックがアップデートされるかロールバックされるまで、AWS CloudFormation はネストされたスタックのクリーンアップを開始しません。ネストされたスタックがロールバックに失敗した場合、AWS CloudFormation は、その他のスタックの現状態に関係なく、すべてのオペレーションをキャンセルします。その他のネストされたスタックがロールバックに失敗していると、アップデートやロールバックを完了したネストスタックも AWS CloudFormation から信号を受け取らずに、<code class="code">UPDATE_COMPLETE_CLEANUP_IN_PROGRESS</code> または <code class="code">UPDATE_ROLLBACK_COMPLETE_CLEANUP_IN_PROGRESS</code> 状態になります。アップデートに失敗してもロールバックを開始する信号が届かないネストスタックは、<code class="code">UPDATE_ROLLBACK_IN_PROGRESS</code> の状態になります。</p>
            <p>スタックテンプレートがこのスタックの状態を正確に反映していない場合、AWS CloudFormation の外部における変更により、ネストされたスタックのロールバックが失敗することがあります。また、Auto Scaling グループが作成またはアップデートされた際に、このグループのネストスタックに限定時間内のリソースが不足していると、ネストされたスタックが失敗することもあります。</p>
            <p>スタックを修正するには、<a href="#contacting-support">AWS Support</a> に連絡してください。</p>
         
         
            <h3 id="troubleshooting-errors-no-updates-to-perform">実行する更新がない</h3>

            <p>AWS CloudFormation スタックを更新するには、テンプレートまたはパラメータの値の変更を AWS CloudFormation に送信する必要があります。ただし、削除のポリシー、更新ポリシー、条件の宣言、または出力の宣言に対する変更など、テンプレートに対する変更の一部は、AWS CloudFormation によって更新として認識されません。他の変更を行わずにこのような変更を加える必要がある場合は、リソースの<a href="./aws-attribute-metadata.html"> メタデータ</a>属性を追加または変更します。</p>
            <p>更新中のテンプレートの変更の詳細については、「<a href="./using-cfn-updating-stacks-get-template.html">スタックテンプレートの変更</a>」を参照してください。</p>
         
         
            <h3 id="troubleshooting-resource-did-not-stabilize">スタックの作成、更新、または削除オペレーションの際、リソースが安定しない</h3>


            <p>オペレーションが AWS CloudFormation タイムアウト期間を超えたか、AWS のサービスが中断されたため、リソースが応答しませんでした。サービス中断の場合は、関連する AWS サービスが実行中であることを<a href="https://status.aws.amazon.com/" rel="noopener noreferrer" target="_blank"><span>確認</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a>し、次にスタックオペレーションを再試行します。</p>
            <p>AWS サービスが正常に実行中であれば、スタックに以下のリソースの 1 つが含まれているかどうかを確認してください。</p>
            <div class="itemizedlist">
                 
                 
                 
                 
                 
                 
                 
            <ul class="itemizedlist"><li class="listitem">
                    <p><code class="code">AWS::AutoScaling::AutoScalingGroup</code> 作成、更新、削除オペレーション</p>
                </li><li class="listitem">
                    <p><code class="code">AWS::CertificateManager::Certificate</code> 作成オペレーション</p>
                </li><li class="listitem">
                    <p><code class="code">AWS::CloudFormation::Stack</code> 作成、更新、削除オペレーション</p>
                </li><li class="listitem">
                    <p><code class="code">AWS::ElasticSearch::Domain</code> 更新オペレーション</p>
                </li><li class="listitem">
                    <p><code class="code">AWS::RDS::DBCluster</code> 作成および更新オペレーション</p>
                </li><li class="listitem">
                    <p><code class="code">AWS::RDS::DBInstance</code> 作成、更新、削除オペレーション</p>
                </li><li class="listitem">
                    <p><code class="code">AWS::Redshift::Cluster</code> 更新オペレーション</p>
                </li></ul></div>

            <p>これらのリソースのオペレーションは、デフォルトのタイムアウト期間以上の時間がかかる場合があります。タイムアウト期間は、リソースと使用する認証情報によって異なります。タイムアウト期間を延長するには、スタックオペレーションを実行する際に<a href="./using-iam-servicerole.html">サービスロール</a>を指定します。すでにサービスロールを使用しているか、またはスタックにリストにないリソースが含まれている場合、<a href="#contacting-support">AWS Support</a> にお問い合わせください。</p>
            <p>スタックが <code class="code">UPDATE_ROLLBACK_FAILED</code> という状態の場合、「<a href="#troubleshooting-errors-update-rollback-failed">更新のロールバックの失敗</a>」を参照してください。</p>

         
         
            <h3 id="troubleshooting-errors-security-group-does-not-exist-in-vpc">セキュリティグループが VPC 内に存在しない</h3>

            <p>セキュリティグループが指定した VPC に存在していることを確認します。セキュリティグループが存在する場合、セキュリティグループの名前ではなく、セキュリティグループの ID を指定していることを確認します。たとえば、<code class="code">AWS::EC2::SecurityGroupIngress</code> リソースには、<code class="code">SourceSecurityGroupName</code> プロパティと <code class="code">SourceSecurityGroupId</code> プロパティがあります。VPC セキュリティグループについては、<code class="code">SourceSecurityGroupId</code> を使用し、プロパティとセキュリティグループ ID を指定する必要があります。</p>
         
         
            <h3 id="troubleshooting-errors-update-rollback-failed">更新のロールバックの失敗</h3>

            <p>ロールバックが失敗するため (<code class="code">UPDATE_ROLLBACK_FAILED</code> 状態)、依存リソースを元の状態に戻すことはできません。例えば、AWS CloudFormation の外部で削除された古いデータベースのインスタンスのロールバックするスタックがある場合などです。AWS CloudFormation にはデータベースが削除されたことがわからないため、データベースインスタンスがまだ存在する前提でそれにロールバックしようとし、更新のロールバックが失敗します。</p>
            <p>失敗の原因によっては、エラーを手動で修正してロールバックを続けることができます。ロールバックを続けることで、スタックを動作状態 (<code class="code">UPDATE_ROLLBACK_COMPLETE</code> 状態) に戻し、スタックの更新を再度試みることができます。次のリストでは、更新のロールバック失敗の原因となる一般的なエラーに対する解決策について説明します。</p>
            <div class="itemizedlist">
                 
                 
                 
                 
                 
                 
            <ul class="itemizedlist"><li class="listitem">
                    <div class="variablelist">
                         
                    <dl>
                            <dt><span class="term">必要なシグナルの数の受け取りに失敗した</span></dt>
                            <dd>
                                <p><a href="https://docs.aws.amazon.com/cli/latest/reference/cloudformation/signal-resource.html">signal-resource</a> コマンドを使用し、必要な数の成功シグナルを待機中のリソースに手動で送信した後、更新のロールバックを続けます。たとえば、更新のロールバック中、Auto Scaling グループ内のインスタンスが指定されたタイムアウト期間内に成功のシグナルの送信に失敗する可能性があります。Auto Scaling グループに成功シグナルを手動で送信します。更新のロールバックを続けると、AWS CloudFormation がシグナルを確認し、ロールバックを続けます。</p>
                            </dd>
                        </dl></div>
                </li><li class="listitem">
                    <div class="variablelist">
                         
                    <dl>
                            <dt><span class="term">リソースに対する変更が AWS CloudFormation 外で加えられた</span></dt>
                            <dd>
                                <p>元のスタックテンプレートと一致するようにリソースを手動で同期した後、更新のロールバックを続けます。たとえば、AWS CloudFormation がロールバックしようとしているリソースを手動で削除した場合、元のスタックで使用していたのと同じ名前およびプロパティを使用してそのリソースを手動で作成する必要があります。</p>
                            </dd>
                        </dl></div>
                </li><li class="listitem">
                    <div class="variablelist">
                         
                    <dl>
                            <dt><span class="term">アクセス権限の不足</span></dt>
                            <dd>
                                <p>リソースを変更する IAM アクセス権限が十分にあることを確認し、更新のロールバックを続けます。たとえば、IAM ポリシーで S3 バケットの作成が許可されるが、バケットの変更は許可されないことがあります。ポリシーに変更アクションを追加します。</p>
                            </dd>
                        </dl></div>
                </li><li class="listitem">
                    <div class="variablelist">
                         
                    <dl>
                            <dt><span class="term">無効なセキュリティトークン</span></dt>
                            <dd>
                                <p>AWS CloudFormation には、認証情報の新しいセットが必要です。変更は必要ありません。更新のロールバックを続けると、認証情報が更新されます。</p>
                            </dd>
                        </dl></div>
                </li><li class="listitem">
                    <div class="variablelist">
                         
                    <dl>
                            <dt><span class="term">制限エラー</span></dt>
                            <dd>
                                <p>不要なリソースを削除するか、<a href="https://docs.aws.amazon.com/general/latest/gr/aws_service_limits.html">[quota increase]</a> (クォータの増加) をリクエストし、更新のロールバックを続けます。例えば、EC2 オンデマンドインスタンス数のアカウントクォータが 5 で、更新のロールバックがそのクォータを超えた場合、失敗します。</p>
                            </dd>
                        </dl></div>
                </li><li class="listitem">
                    <div class="variablelist">
                         
                    <dl>
                            <dt><span class="term">リソースが安定しませんでした</span></dt>
                            <dd>
                                <p>オペレーションが AWS CloudFormation タイムアウト期間を超えたか、AWS のサービスが中断されたため、リソースが応答しませんでした。変更は必要ありません。リソース操作が完了するか、AWS サービスが実行状態に戻ったら、更新のロールバックを続けてください。</p>
                            </dd>
                        </dl></div>
                </li></ul></div>
            <p>更新のロールバックを続けるには、AWS CloudFormation コンソールまたは AWS コマンドラインインターフェース (AWS CLI) を使用します。詳細については、「<a href="./using-cfn-updating-stacks-continueupdaterollback.html">更新のロールバックを続ける</a>」を参照してください。</p>
            <p>これらのソリューションがどれもうまくいかない場合、AWS CloudFormation が正常にロールバックできないリソースはスキップすることができます。詳細については、「AWS CloudFormation API リファレンス」の「<a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/APIReference/API_ContinueUpdateRollback.html"><code class="code">ContinueUpdateRollback</code></a> API 操作用 <code class="code">ResourcesToSkip</code> パラメータ」を参照してください。AWS CloudFormation は指定されたリソースのステータスを <code class="code">UPDATE_COMPLETE</code> に設定し、引き続きスタックをロールバックします。ロールバックが完了したら、スキップされたリソースのステータスはスタックテンプレートのリソースのステータスと一致しません。別のスタックの更新を実行する前に、リソースを変更するか、またはスタックを更新して、整合性を取る必要があります。そうしないと、以降のスタックの更新は失敗し、スタックは回復不可能になる可能性があります。</p>
         
         
            <h3 id="troubleshooting-errors-wait-condition-didnt-receive-the-required-number-of-signals">待機条件が Amazon EC2 インスタンスから所定の数のシグナルを受け取らなかった</h3>

            <p>この状況を解決するには、以下の手順を実行します。</p>
            <div class="itemizedlist">
                 
                 
                 
            <ul class="itemizedlist"><li class="listitem">
                    <p>使用している AMI に AWS CloudFormation ヘルパースクリプトがインストールされていることを確認します。AMI にヘルパースクリプトが含まれていない場合は、インスタンスにダウンロードすることもできます。詳細については、「<a href="./cfn-helper-scripts-reference.html">CloudFormation ヘルパースクリプトリファレンス</a>」を参照してください。</p>
                </li><li class="listitem">
                    <p>インスタンスで <code class="code">cfn-signal</code> コマンドが正常に実行されたことを確認します。<code>/var/log/cloud-init.log</code> や <code>/var/log/cfn-init.log</code> などのログを確認して、インスタンスの起動に関するデバッグに役立てることができます。ログはインスタンスへログインすることで取得できますが、<a href="./cfn-console-add-tags.html">障害発生時のロールバックを無効にしておく</a>必要があります。無効にしないと、スタックの作成が失敗した場合に AWS CloudFormation によってそのインスタンスが削除されます。また、Amazon CloudWatch に対して<a href="https://aws.amazon.com/blogs/devops/view-cloudformation-logs-in-the-console/" rel="noopener noreferrer" target="_blank"><span>ログを発行する</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a>こともできます。Windows の場合、<code>C:\cfn\log</code> および <code>%ProgramFiles%\Amazon\EC2ConfigService</code> に保存される cfn ログを確認できます。</p>
                </li><li class="listitem">
                    <p>インスタンスがインターネットに接続されていることを確認します。インスタンスが VPC 内に存在しており、プライベートサブネットにある場合は NAT デバイスを介して、パブリックサブネットにある場合はインターネットゲートウェイを介してインターネットに接続されます。インスタンスのインターネット接続をテストするには、<code class="code">http://aws.amazon.com</code> などの公開ウェブページへアクセスしてください。たとえば、インスタンスで次のコマンドを実行すると、HTTP 200 ステータスコードが返されるはずです。</p>
                    <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="コピー"><awsui-icon name="copy"></awsui-icon></div></div><code class="sh "><code class="userinput">curl -I https://aws.amazon.com</code></code></pre>
                    <p>NAT デバイスの設定の詳細については、「Amazon VPC ユーザーガイド」の「<a href="https://docs.aws.amazon.com/vpc/latest/userguide/vpc-nat.html">NAT</a>」を参照してください。</p>
                </li></ul></div>
         
         
            <h3 id="troubleshooting-errors-resource-removed-not-deleted">リソースはスタックから削除されましたが、削除されてはいません。</h3>
            <p>スタックの更新中に、CloudFormation はスタックからリソースを削除しましたが、リソースは削除されませんでした。リソースはまだ存在しますが、CloudFormation からはアクセスできなくなります。これは、スタックの更新中に発生する可能性があります。</p>
            <div class="itemizedlist">
                 
                 
            <ul class="itemizedlist"><li class="listitem">
                    <p>CloudFormation は既存のリソースを置き換える必要があるため、最初に新しいリソースを作成し、次に古いリソースを削除しようとします。</p>
                </li><li class="listitem">
                    <p>スタックテンプレートからリソースを削除したため、CloudFormation はスタックからリソースを削除しようとします。</p>
                </li></ul></div>
            <p>ただし、CloudFormation がリソースを削除できない場合があります。例えば、特定のタイプのリソースを削除するためのアクセス権限がユーザーにない場合などです。</p>
            <p>CloudFormation は、古いリソースを 3 回削除しようとします。CloudFormation が古いリソースを削除できない場合、古いリソースをスタックから削除し、スタックの更新を続行します。スタックの更新が完了すると、CloudFormation は <code class="code">UPDATE_COMPLETE</code> スタックイベントを発行しますが、1 つ以上のリソースを削除できなかったことを示す <code class="code">StatusReason</code> が含まれます。CloudFormation は、特定のリソースに対して <code class="code">DELETE_FAILED</code> イベントを発行し、対応する <code class="code">StatusReason</code> は CloudFormation がリソースの削除に失敗した理由の詳細を提供します。</p>
            <p>この状況を解決するには、基盤となるサービスのコンソールまたは API を使用してリソースを直接削除します。</p>
         
     
        <h2 id="contacting-support"> Support へのお問い合わせ</h2>

        <p>AWS Support がある場合は、<a href="https://console.aws.amazon.com/support/home#/" rel="noopener noreferrer" target="_blank"><span>https://console.aws.amazon.com/support/home#/</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a> で技術サポートケースを作成できます。サポートへ連絡する前に、以下の情報を収集します。</p>
        <div class="itemizedlist">
             
             
             
        <ul class="itemizedlist"><li class="listitem">
                <p>スタックの ID。スタック ID は、<a href="https://console.aws.amazon.com/cloudformation/" rel="noopener noreferrer" target="_blank"><span>AWS CloudFormation コンソール</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a> の <b>[Overview]</b> (概要) タブに表示されます。詳細については、「<a href="./cfn-console-view-stack-data-resources.html">AWS Management Console での AWS CloudFormation スタックデータとリソースの表示</a>」を参照してください。</p>
                <div class="awsdocs-note awsdocs-important"><div class="awsdocs-note-title"><awsui-icon name="status-warning" variant="error"></awsui-icon><h6>重要</h6></div><div class="awsdocs-note-text"><p>スタックのリソースを AWS CloudFormation 以外の方法で変更しないでください。スタックのリソースを AWS CloudFormation 以外の方法で変更すると、復旧不可能な状態になる場合があります。</p></div></div>
            </li><li class="listitem">
                <p>スタックのエラーメッセージ。スタックのエラーメッセージの表示については、「<a href="#basic-ts-guide">トラブルシューティングガイド</a>」セクションを参照してください。</p>
            </li><li class="listitem">
                <p>Amazon EC2 の問題については、cloud-init および cfn のログを収集してください。これらのログは、<code>/var/log/</code> ディレクトリの Amazon EC2 インスタンスに発行されます。これらのログには、インスタンスのセットアップ中のプロセスおよびコマンドの出力がキャプチャされます。Windows の場合、<code>%ProgramFiles%\Amazon\EC2ConfigService</code> および <code>C:\cfn\log</code> に保存される EC2Configure サービスおよび cfn ログを収集してください。</p>
            </li></ul></div>
        <p>また、<a href="https://forums.aws.amazon.com/forum.jspa?forumID=92" rel="noopener noreferrer" target="_blank"><span>AWS CloudFormation フォーラム</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a>で回答を検索したり、質問を投稿したりすることもできます。</p>
    <awsdocs-copyright class="copyright-print"></awsdocs-copyright><awsdocs-thumb-feedback right-edge="{{$ctrl.thumbFeedbackRightEdge}}"></awsdocs-thumb-feedback></div><noscript><div><div><div><div id="js_error_message"><p><img src="https://d1ge0kk1l5kms0.cloudfront.net/images/G/01/webservices/console/warning.png" alt="警告" /> <strong>ブラウザで JavaScript が無効になっているか、使用できません。</strong></p><p>AWS ドキュメントを使用するには、JavaScript を有効にする必要があります。手順については、使用するブラウザのヘルプページを参照してください。</p></div></div></div></div></noscript><div id="main-col-footer" class="awsui-util-font-size-0"><div id="doc-conventions"><a target="_top" href="/general/latest/gr/docconventions.html">ドキュメントの表記規則</a></div><div class="prev-next"><div id="previous" class="prev-link" accesskey="p" href="./example_cross_ApiGatewayDataTracker_section.html">COVID-19 データを追跡する REST API を作成する</div><div id="next" class="next-link" accesskey="n" href="./ReleaseHistory.html">リリース履歴</div></div></div><awsdocs-page-utilities></awsdocs-page-utilities></div><div id="quick-feedback-yes" style="display: none;"><div class="title">このページは役に立ちましたか? - はい</div><div class="content"><p>ページが役に立ったことをお知らせいただき、ありがとうございます。</p><p>お時間がある場合は、何が良かったかお知らせください。今後の参考にさせていただきます。</p><p><awsui-button id="fblink" rel="noopener noreferrer" target="_blank" text="フィードバック" click="linkClick($event)" href="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=CloudFormation&amp;topic_url=https://docs.aws.amazon.com/ja_jp/AWSCloudFormation/latest/UserGuide/troubleshooting.html"></awsui-button></p></div></div><div id="quick-feedback-no" style="display: none;"><div class="title">このページは役に立ちましたか? - いいえ</div><div class="content"><p>このページは修正が必要なことをお知らせいただき、ありがとうございます。ご期待に沿うことができず申し訳ありません。</p><p>お時間がある場合は、ドキュメントを改善する方法についてお知らせください。</p><p><awsui-button id="fblink" rel="noopener noreferrer" target="_blank" text="フィードバック" click="linkClick($event)" href="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=CloudFormation&amp;topic_url=https://docs.aws.amazon.com/ja_jp/AWSCloudFormation/latest/UserGuide/troubleshooting.html"></awsui-button></p></div></div></div></body></div></awsdocs-view><div class="page-loading-indicator" id="page-loading-indicator"><awsui-spinner size="large"></awsui-spinner></div></div><div id="tools-panel" dom-region="tools"><awsdocs-tools-panel id="awsdocs-tools-panel"></awsdocs-tools-panel></div></awsui-app-layout><awsdocs-cookie-banner class="doc-cookie-banner"></awsdocs-cookie-banner></div></body></html>