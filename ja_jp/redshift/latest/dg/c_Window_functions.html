<!DOCTYPE html>
    <html xmlns="http://www.w3.org/1999/xhtml" lang="ja-JP"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Window 関数 - Amazon Redshift</title><meta name="viewport" content="width=device-width,initial-scale=1" /><meta name="assets_root" content="/assets" /><meta name="target_state" content="c_Window_functions" /><meta name="default_state" content="c_Window_functions" /><link rel="icon" type="image/ico" href="/assets/images/favicon.ico" /><link rel="shortcut icon" type="image/ico" href="/assets/images/favicon.ico" /><link rel="canonical" href="https://docs.aws.amazon.com/ja_jp/redshift/latest/dg/c_Window_functions.html" /><meta name="description" content="Amazon Redshift でサポートされる SQL のウィンドウ関数を使用して、分析業務クエリをより効率的に作成します。" /><meta name="deployment_region" content="IAD" /><meta name="product" content="Amazon Redshift" /><meta name="guide" content="データベース開発者ガイド" /><meta name="abstract" content="エンタープライズレベル、ペタバイト規模、フルマネージドのデータウェアハウスサービス、Amazon Redshift を使用してデータウェアハウスを作成および管理できます。" /><meta name="guide-locale" content="ja_jp" /><meta name="tocs" content="toc-contents.json" /><link rel="canonical" href="https://docs.aws.amazon.com/ja_jp/redshift/latest/dg/c_Window_functions.html" /><link rel="alternative" href="https://docs.aws.amazon.com/id_id/redshift/latest/dg/c_Window_functions.html" hreflang="id-id" /><link rel="alternative" href="https://docs.aws.amazon.com/id_id/redshift/latest/dg/c_Window_functions.html" hreflang="id" /><link rel="alternative" href="https://docs.aws.amazon.com/de_de/redshift/latest/dg/c_Window_functions.html" hreflang="de-de" /><link rel="alternative" href="https://docs.aws.amazon.com/de_de/redshift/latest/dg/c_Window_functions.html" hreflang="de" /><link rel="alternative" href="https://docs.aws.amazon.com/redshift/latest/dg/c_Window_functions.html" hreflang="en-us" /><link rel="alternative" href="https://docs.aws.amazon.com/redshift/latest/dg/c_Window_functions.html" hreflang="en" /><link rel="alternative" href="https://docs.aws.amazon.com/es_es/redshift/latest/dg/c_Window_functions.html" hreflang="es-es" /><link rel="alternative" href="https://docs.aws.amazon.com/es_es/redshift/latest/dg/c_Window_functions.html" hreflang="es" /><link rel="alternative" href="https://docs.aws.amazon.com/fr_fr/redshift/latest/dg/c_Window_functions.html" hreflang="fr-fr" /><link rel="alternative" href="https://docs.aws.amazon.com/fr_fr/redshift/latest/dg/c_Window_functions.html" hreflang="fr" /><link rel="alternative" href="https://docs.aws.amazon.com/it_it/redshift/latest/dg/c_Window_functions.html" hreflang="it-it" /><link rel="alternative" href="https://docs.aws.amazon.com/it_it/redshift/latest/dg/c_Window_functions.html" hreflang="it" /><link rel="alternative" href="https://docs.aws.amazon.com/ja_jp/redshift/latest/dg/c_Window_functions.html" hreflang="ja-jp" /><link rel="alternative" href="https://docs.aws.amazon.com/ja_jp/redshift/latest/dg/c_Window_functions.html" hreflang="ja" /><link rel="alternative" href="https://docs.aws.amazon.com/ko_kr/redshift/latest/dg/c_Window_functions.html" hreflang="ko-kr" /><link rel="alternative" href="https://docs.aws.amazon.com/ko_kr/redshift/latest/dg/c_Window_functions.html" hreflang="ko" /><link rel="alternative" href="https://docs.aws.amazon.com/pt_br/redshift/latest/dg/c_Window_functions.html" hreflang="pt-br" /><link rel="alternative" href="https://docs.aws.amazon.com/pt_br/redshift/latest/dg/c_Window_functions.html" hreflang="pt" /><link rel="alternative" href="https://docs.aws.amazon.com/zh_cn/redshift/latest/dg/c_Window_functions.html" hreflang="zh-cn" /><link rel="alternative" href="https://docs.aws.amazon.com/zh_tw/redshift/latest/dg/c_Window_functions.html" hreflang="zh-tw" /><link rel="alternative" href="https://docs.aws.amazon.com/redshift/latest/dg/c_Window_functions.html" hreflang="x-default" /><meta name="feedback-item" content="Redshift" /><meta name="this_doc_product" content="Amazon Redshift" /><meta name="this_doc_guide" content="データベース開発者ガイド" /><script defer="" src="/assets/r/vendor4.js?version=2021.12.02"></script><script defer="" src="/assets/r/vendor3.js?version=2021.12.02"></script><script defer="" src="/assets/r/vendor1.js?version=2021.12.02"></script><script defer="" src="/assets/r/awsdocs-common.js?version=2021.12.02"></script><script defer="" src="/assets/r/awsdocs-doc-page.js?version=2021.12.02"></script><link href="/assets/r/vendor4.css?version=2021.12.02" rel="stylesheet" /><link href="/assets/r/awsdocs-common.css?version=2021.12.02" rel="stylesheet" /><link href="/assets/r/awsdocs-doc-page.css?version=2021.12.02" rel="stylesheet" /><script async="" id="awsc-panorama-bundle" type="text/javascript" src="https://prod.pa.cdn.uis.awsstatic.com/panorama-nav-init.js" data-config="{'appEntity':'aws-documentation','region':'us-east-1','service':'redshift'}"></script><meta id="panorama-serviceSubSection" value="データベース開発者ガイド" /><meta id="panorama-serviceConsolePage" value="Window 関数" /></head><body class="awsdocs awsui"><div class="awsdocs-container"><awsdocs-header></awsdocs-header><awsui-app-layout id="app-layout" class="awsui-util-no-gutters" ng-controller="ContentController as $ctrl" header-selector="awsdocs-header" navigation-hide="false" navigation-width="$ctrl.navWidth" navigation-open="$ctrl.navOpen" navigation-change="$ctrl.onNavChange($event)" tools-hide="$ctrl.hideTools" tools-width="$ctrl.toolsWidth" tools-open="$ctrl.toolsOpen" tools-change="$ctrl.onToolsChange($event)"><div id="guide-toc" dom-region="navigation"><awsdocs-toc></awsdocs-toc></div><div id="main-column" dom-region="content" tabindex="-1"><awsdocs-view class="awsdocs-view"><div id="awsdocs-content"><head><title>Window 関数 - Amazon Redshift</title><meta name="pdf" content="redshift-dg.pdf#c_Window_functions" /><meta name="rss" content="Dochistory.rss" /><meta name="forums" content="http://forums.aws.amazon.com/forum.jspa?forumID=155" /><meta name="feedback" content="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=Redshift&amp;topic_url=https://docs.aws.amazon.com/ja_jp/redshift/latest/dg/c_Window_functions.html" /><meta name="feedback-yes" content="feedbackyes.html?topic_url=https://docs.aws.amazon.com/ja_jp/redshift/latest/dg/c_Window_functions.html" /><meta name="feedback-no" content="feedbackno.html?topic_url=https://docs.aws.amazon.com/ja_jp/redshift/latest/dg/c_Window_functions.html" /><meta name="keywords" content="Amazon Redshift,AWS Redshift,Redshift,Redshift Spectrum,クラスター,データウェアハウス,開発者,サンプルデータ,データベース,データベース開発者,HLL" /><script type="application/ld+json">
{
    "@context" : "https://schema.org",
    "@type" : "BreadcrumbList",
    "itemListElement" : [
      {
        "@type" : "ListItem",
        "position" : 1,
        "name" : "AWS",
        "item" : "https://aws.amazon.com"
      },
      {
        "@type" : "ListItem",
        "position" : 2,
        "name" : "Amazon Redshift",
        "item" : "https://docs.aws.amazon.com/redshift/index.html"
      },
      {
        "@type" : "ListItem",
        "position" : 3,
        "name" : "データベース開発者ガイド",
        "item" : "https://docs.aws.amazon.com/ja_jp/redshift/latest/dg"
      },
      {
        "@type" : "ListItem",
        "position" : 4,
        "name" : "SQL リファレンス",
        "item" : "https://docs.aws.amazon.com/ja_jp/redshift/latest/dg/cm_chap_SQLCommandRef.html"
      },
      {
        "@type" : "ListItem",
        "position" : 5,
        "name" : "SQL 関数リファレンス",
        "item" : "https://docs.aws.amazon.com/ja_jp/redshift/latest/dg/c_SQL_functions.html"
      },
      {
        "@type" : "ListItem",
        "position" : 6,
        "name" : "Window 関数",
        "item" : "https://docs.aws.amazon.com/ja_jp/redshift/latest/dg/c_SQL_functions.html"
      }
    ]
}
</script></head><body><div id="main"><div style="display: none"><a href="redshift-dg.pdf#c_Window_functions" target="_blank" rel="noopener noreferrer" title="PDF を開く"></a></div><div id="breadcrumbs" class="breadcrumb"><a href="https://aws.amazon.com">AWS</a><a href="/index.html">ドキュメント</a><a href="/redshift/index.html">Amazon Redshift</a><a href="welcome.html">データベース開発者ガイド</a></div><div id="page-toc-src"><a href="#r_Window_function_synopsis">ウィンドウ関数の構文の概要</a><a href="#r_Examples_order_by_WF">ウィンドウ関数用データの一意の並び順</a><a href="#r_Window_function_supported">サポートされている関数</a><a href="#r_Window_function_example">ウィンドウ関数例のサンプルテーブル </a></div><div id="main-content" class="awsui-util-container"><div id="main-col-body"><awsdocs-language-banner data-service="$ctrl.pageService"></awsdocs-language-banner><h1 class="topictitle" id="c_Window_functions">Window 関数</h1><div class="awsdocs-page-header-container"><awsdocs-page-header></awsdocs-page-header><awsdocs-filter-selector id="awsdocs-filter-selector"></awsdocs-filter-selector></div><p>ウィンドウ関数を使用すると、分析的なビジネスクエリをより効率的に作成できます。ウィンドウ関数はパーティションまたは結果セットの「ウィンドウ」で演算し、ウィンドウのすべての行に値を返します。それに対して、ウィンドウ以外の関数は、結果セットの行ごとに計算を実行します。結果の行を集計するグループ関数とは異なり、ウィンドウ関数はテーブル式のすべての行を保持します。</p><p> 戻り値はこのウィンドウの行セットの値を使用して計算されます。ウィンドウはテーブルの各行に、追加の属性を計算するために使用する行のセットを定義します。ウィンドウはウィンドウ仕様 (OVER 句) を使用して定義され、次の 3 つの主要な概念に基づいています。</p><div class="itemizedlist">
          
          
          
      <ul class="itemizedlist"><li class="listitem">
            <p> <em>ウィンドウのパーティション</em>、列のグループを形成 (PARTITION 句) </p>
         </li><li class="listitem">
            <p> <em>ウィンドウの並び順</em>、各パーティション内の行の順序またはシーケンスの定義 (ORDER BY 句) </p>
         </li><li class="listitem">
            <p> <em>ウィンドウのフレーム</em>、各行に関連して定義され、行のセットをさらに制限 (ROWS 仕様) </p>
         </li></ul></div><p>ウィンドウ関数は、最後の ORDER BY 句を除いて、クエリで実行される最後の演算のセットです。すべての結合およびすべての WHERE、GROUP BY、および HAVING 句は、ウィンドウ関数が処理される前に完了されます。そのため、ウィンドウ関数は選択リストまたは ORDER BY 句のみに表示できます。複数のウィンドウ関数は、別のフレーム句を持つ 1 つのクエリ内で使用できます。ウィンドウ関数は、CASE などの他のスカラー式でも使用できます。</p>
         <h2 id="r_Window_function_synopsis">ウィンドウ関数の構文の概要</h2>
         
         
         <p>ウィンドウ関数は、次のような標準構文に従います。</p>
         <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="コピー"><awsui-icon name="copy"></awsui-icon></div></div><code class="nohighlight"><em>function</em> (<em>expression</em>) OVER (
[ PARTITION BY <em>expr_list</em> ]
[ ORDER BY <em>order_list</em> [ <em>frame_clause</em> ] ] )</code></pre>
         <p> ここで、<em>function</em> は、このセクションで説明している関数の 1 つです。</p> 
         <p><em>expr_list</em> は次のとおりです。</p>
         <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="コピー"><awsui-icon name="copy"></awsui-icon></div></div><code class="nohighlight"><em>expression</em> | <em>column_name</em> [, <em>expr_list</em> ]</code></pre>
         <p> <em>order_list</em> は次のとおりです。</p>
         <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="コピー"><awsui-icon name="copy"></awsui-icon></div></div><code class="nohighlight"><em>expression</em> | <em>column_name</em> [ ASC | DESC ] 
[ NULLS FIRST | NULLS LAST ]
[, <em>order_list</em> ]</code></pre>
         <p> <em>frame_clause</em> は次のとおりです。</p>
         <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="コピー"><awsui-icon name="copy"></awsui-icon></div></div><code class="nohighlight">ROWS
<span>{</span> UNBOUNDED PRECEDING | <em>unsigned_value</em> PRECEDING | CURRENT ROW } |

<span>{</span> BETWEEN
<span>{</span> UNBOUNDED PRECEDING | <em>unsigned_value</em> <span>{</span> PRECEDING | FOLLOWING } | CURRENT ROW}
AND
<span>{</span> UNBOUNDED FOLLOWING | <em>unsigned_value</em> <span>{</span> PRECEDING | FOLLOWING } | CURRENT ROW }}</code></pre>
          
            <h3 id="r_Window_function_synopsis-arguments">引数</h3>
            
            
            <div class="variablelist">
                
                
                
                
                
                
                
                
                
            <dl>
                  <dt><span class="term"> <em>function</em> </span></dt>
                  <dd>
                     <p>ウィンドウ関数。詳細については、個々の関数の説明を参照してください。</p>
                  </dd>
                
                  <dt><span class="term">OVER </span></dt>
                  <dd>
                     <p>ウィンドウの仕様を定義する句。OVER 句はウィンドウ関数に必須であり、ウィンドウ関数を他の SQL 関数と区別します。</p>
                  </dd>
                
                  <dt><span class="term">PARTITION BY <em>expr_list</em> </span></dt>
                  <dd>
                     <p>(オプション) PARTITION BY 句は結果セットをパーティションに再分割します。これは GROUP BY 句と似ています。パーティション句が存在する場合、関数は各パーティションの行に対して計算されます。パーティション句が指定されていない場合、1 つのパーティションにテーブル全体が含まれ、関数は完全なテーブルに対して計算されます。</p>
                     <p>ランク付け関数 DENSE_RANK、NTILE、RANK、および ROW_NUMBER では、結果セットのすべての行でグローバルな比較が必要です。PARTITION BY clauseを使用すると、クエリオプティマイザーは、パーティションに応じて複数のスライスにワークロードを分散させることにより、個々の集計を並列で実行できます。PARTITION BY 句がない場合、集計ステップを 1 つのスライスで順次実行する必要があり、特に大規模なクラスターではパフォーマンスに大きな悪影響を与えることがあります。</p>
                     <p>Amazon Redshift は、PARTITION BY 句で文字列リテラルをサポートしていません。</p>
                  </dd>
                
                  <dt><span class="term">ORDER BY <em>order_list</em> </span></dt>
                  <dd>
                     <p>(オプション) ウィンドウ関数は、ORDER BY で順序仕様に従ってソートされた各パーティション内の行に適用されます。この ORDER BY 句は、<em>frame_clause</em> の ORDER BY 句とは異なり、両者はまったく無関係です。ORDER BY 句は、PARTITION BY 句なしで使用できます。</p>
                     <p>ランク付け関数の場合、ORDER BY 句はランク付けの値に使用する基準を特定します。集計関数の場合、パーティションで分割された行は、集計関数がフレームごとに計算される前に順序付けされる必要があります。ウィンドウ関数の種類の詳細については、「<a href="./c_Window_functions.html">Window 関数</a>」を参照してください。</p>
                     <p>列識別子または列識別を検証する式は、順序リストで必要とされます。定数も定数式も、列名の代用として使用することはできません。</p>
                     <p>NULL 値は独自のグループとして扱われ、NULLS FIRST または NULLS LAST オプションに従ってソートおよびランク付けされます。デフォルトでは、NULL 値は昇順ではソートされて最後にランク付けされ、降順ではソートされて最初にランク付けされます。</p>
                     <p>Amazon Redshift は、ORDER BY 句で文字列リテラルをサポートしていません。</p>
                     <p> ORDER BY 句を省略した場合、行の順序は不確定になります。</p>
                     <div class="awsdocs-note"><div class="awsdocs-note-title"><awsui-icon name="status-info" variant="link"></awsui-icon><h6>注記</h6></div><div class="awsdocs-note-text"><p>Amazon Redshift などの並列システムでは、ORDER BY 句がデータの一意および全体の並び順を生成しない場合、行の順序は不確定になります。つまり、ORDER BY 式が重複した値を生成する場合 (部分的ソート)、これらの行の戻り値の順序は Amazon Redshift の実行によって異なることがあります。そのため、ウィンドウ関数は予期しない結果または矛盾した結果を返す場合があります。詳細については、「<a href="#r_Examples_order_by_WF">ウィンドウ関数用データの一意の並び順</a>」を参照してください。</p></div></div>
                  </dd>
                
                  <dt><span class="term"> <em>column_name</em> </span></dt>
                  <dd>
                     <p>パーティション化または順序付けされる列の名前。</p>
                  </dd>
                
                  <dt><span class="term">ASC | DESC </span></dt>
                  <dd>
                     <p>次のように、式のソート順を定義するオプション: </p>
                     <div class="itemizedlist">
                         
                         
                     <ul class="itemizedlist"><li class="listitem">
                           <p>ASC: 昇順 (数値の場合は低から高、文字列の場合は「A」から「Z」など) オプションを指定しない場合、データはデフォルトでは昇順にソートされます。</p>
                        </li><li class="listitem">
                           <p>DESC: 降順 (数値の場合は高から低、文字列の場合は「Z」から「A」)。</p>
                        </li></ul></div>
                  </dd>
                
                  <dt><span class="term">NULLS FIRST | NULLS LAST</span></dt>
                  <dd>
                     <p>NULL を NULL 以外の値より先に順序付けするか、NULL 以外の値の後に順序付けするかを指定するオプション。デフォルトでは、NULL は昇順ではソートされて最後にランク付けされ、降順ではソートされて最初にランク付けされます。</p>
                  </dd>
                
                  <dt><span class="term"> <em>frame_clause</em> </span></dt>
                  <dd>
                     
                     <p>集計関数では、ORDER BY を使用する場合、フレーム句は関数のウィンドウで行のセットをさらに絞り込みます。これは、順序付けされた結果内の行のセットを含めるか、または除外できるようにします。フレーム句は ROWS キーワードおよび関連する指定子で構成されます。</p>
                     <p>frame 句は、ランク付け関数には適用されません。また、集計関数の OVER 句の中に ORDER BY 句がない場合は、フレーム句は必要ありません。ORDER BY 句が集計関数に使用される場合、明示的なフレーム句が必要です。</p>
                     <p>ORDER BY 句が指定されていない場合、暗黙的なフレームはバインドされません (ROWS BETWEEN UNBOUNDED PRECEDING AND UNBOUNDED FOLLOWING と同じ)。</p>
                  </dd>
                
                  <dt><span class="term">ROWS</span></dt>
                  <dd>
                     <p>この句は、現在の行からの物理オフセットを指定してウィンドウフレームを定義します。</p>
                     <p>この句は、現在のウィンドウの行、または現在の行の値を組み合わせるパーティションを指定します。また、現在の行の前後に配置される行の位置を指定する引数を使用します。すべてのウィンドウフレームの参照点は現在の行です。ウィンドウフレームがパーティションで次にスライドすると、各行は順に現在の行になります。</p>
                     <p>フレームは、次のように現在の行までと現在の行を含む行の簡易セットである場合があります。</p>
                     <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="コピー"><awsui-icon name="copy"></awsui-icon></div></div><code class="nohighlight"><span>{</span>UNBOUNDED PRECEDING | <em>offset</em> PRECEDING | CURRENT ROW}</code></pre>
                     <p>また、次の 2 つの境界の間の行のセットである場合があります。</p>
                     <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="コピー"><awsui-icon name="copy"></awsui-icon></div></div><code class="nohighlight">BETWEEN
<span>{</span> UNBOUNDED PRECEDING | <em>offset</em> <span>{</span> PRECEDING | FOLLOWING } | CURRENT ROW }
AND
<span>{</span> UNBOUNDED FOLLOWING | <em>offset</em> <span>{</span> PRECEDING | FOLLOWING } | CURRENT ROW }</code></pre>
                     <p>UNBOUNDED PRECEDING はウィンドウがパーティションの最初の行で開始することを示し、<em>offset</em> PRECEDING はウィンドウが現在の行の前のオフセット値と等しい行数で開始することを示します。デフォルトは UNBOUNDED PRECEDING です。</p>
                     <p>CURRENT ROW は、ウィンドウが現在の行で開始または終了することを示します。</p>
                     <p>UNBOUNDED FOLLOWING はウィンドウがパーティションの最後の行で終了することを示し、<em>offset</em> FOLLOWING はウィンドウが現在の行の後のオフセット値と等しい行数で終了することを示します。</p>
                     <p><em>offset</em> は、現在の行の前後にある物理的な行数を識別します。この場合、<em>offset</em> は、正の数値に評価される定数である必要があります。例えば、5 FOLLOWING は現在の行より 5 行後のフレームを終了します。</p>
                     
                     <p>BETWEEN が指定されていない場合、フレームは現在の行により暗黙的に区切られます。例えば、<code class="code">ROWS 5 PRECEDING</code> は <code class="code">ROWS BETWEEN 5 PRECEDING AND CURRENT ROW</code> と同じです。また、<code class="code">ROWS
                           UNBOUNDED FOLLOWING</code>は <code class="code">ROWS BETWEEN CURRENT ROW AND
                              UNBOUNDED FOLLOWING</code> と同じです。</p>
                     <div class="awsdocs-note"><div class="awsdocs-note-title"><awsui-icon name="status-info" variant="link"></awsui-icon><h6>注記</h6></div><div class="awsdocs-note-text"><p>開始境界が終了境界よりも大きいフレームを指定することはできません。例えば、以下のフレームはいずれも指定することができません。</p><pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="コピー"><awsui-icon name="copy"></awsui-icon></div></div><code class="">between 5 following and 5 preceding
between current row and 2 preceding
between 3 following and current row</code></pre></div></div>
                  </dd>
               </dl></div>
          
         
       
         <h2 id="r_Examples_order_by_WF">ウィンドウ関数用データの一意の並び順</h2>
         
         
         <p>ウィンドウ関数の ORDER BY 句がデータの一意および全体の並び順を生成しない場合、行の順序は不確定になります。ORDER BY 式が重複した値 (部分的な順序付け) を生成する場合、これらの行の戻り値の順序は実行時によって異なる可能性があります。この場合、ウィンドウ関数は予期しない結果または矛盾した結果を返す場合があります。</p>
         <p>例えば、次のクエリは、複数の実行にわたって異なる結果を返します。これらの異なる結果は、<code class="code">order by dateid</code> が SUM Window 関数でデータの一意の順序を生成しないために発生します。</p>
         <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="コピー"><awsui-icon name="copy"></awsui-icon></div></div><code class="">select dateid, pricepaid,
sum(pricepaid) over(order by dateid rows unbounded preceding) as sumpaid
from sales
group by dateid, pricepaid;

dateid | pricepaid |   sumpaid
--------+-----------+-------------
1827 |   1730.00 |     1730.00
1827 |    708.00 |     2438.00
1827 |    234.00 |     2672.00
...

select dateid, pricepaid,
sum(pricepaid) over(order by dateid rows unbounded preceding) as sumpaid
from sales
group by dateid, pricepaid;

dateid | pricepaid |   sumpaid
--------+-----------+-------------
1827 |    234.00 |      234.00
1827 |    472.00 |      706.00
1827 |    347.00 |     1053.00
...</code></pre>
         <p> この場合、2 番目の ORDER BY 列をウィンドウ関数に追加すると問題を解決できます。</p>
         <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="コピー"><awsui-icon name="copy"></awsui-icon></div></div><code class="">select dateid, pricepaid,
sum(pricepaid) over(order by dateid, pricepaid rows unbounded preceding) as sumpaid
from sales
group by dateid, pricepaid;

dateid | pricepaid | sumpaid
--------+-----------+---------
1827 |    234.00 |  234.00
1827 |    337.00 |  571.00
1827 |    347.00 |  918.00
...</code></pre>
       
         <h2 id="r_Window_function_supported">サポートされている関数</h2>
      <p>Amazon Redshift は、集計とランク付けという 2 つのタイプのウィンドウ関数をサポートします。</p>
      <p>サポートされる集約関数は次のとおりです。</p>
      <div class="itemizedlist">
          
          
          
          
          
          
          
          
               
          
          
          
          
          
          
          
          
          
          
      <ul class="itemizedlist"><li class="listitem">
            <p><a href="./r_WF_AVG.html">AVG ウィンドウ関数</a></p>
         </li><li class="listitem">
            <p><a href="./r_WF_COUNT.html">COUNT ウィンドウ関数</a></p>
         </li><li class="listitem">
            <p><a href="./r_WF_CUME_DIST.html">CUME_DIST ウィンドウ関数</a></p>
         </li><li class="listitem">
            <p><a href="./r_WF_DENSE_RANK.html">DENSE_RANK ウィンドウ関数</a></p>
         </li><li class="listitem">
            <p><a href="./r_WF_first_value.html">FIRST_VALUE ウィンドウ関数</a></p>
         </li><li class="listitem">
            <p><a href="./r_WF_LAG.html">LAG ウィンドウ関数</a> </p>
         </li><li class="listitem">
            <p><a href="./r_WF_last_value.html">LAST_VALUE ウィンドウ関数</a></p>
         </li><li class="listitem">
            <p><a href="./r_WF_LEAD.html">LEAD ウィンドウ関数</a> </p>
         </li><li class="listitem">
               <p><a href="./r_WF_LISTAGG.html">LISTAGG ウィンドウ関数</a> </p>
            </li><li class="listitem">
            <p><a href="./r_WF_MAX.html">MAX ウィンドウ関数</a> </p>
         </li><li class="listitem">
            <p><a href="./r_WF_MEDIAN.html">MEDIAN ウィンドウ関数</a> </p>
         </li><li class="listitem">
            <p><a href="./r_WF_MIN.html">MIN ウィンドウ関数</a> </p>
         </li><li class="listitem">
            <p><a href="./r_WF_NTH.html">NTH_VALUE ウィンドウ関数</a> </p>
         </li><li class="listitem">
            <p><a href="./r_WF_PERCENTILE_CONT.html">PERCENTILE_CONT ウィンドウ関数</a></p>
         </li><li class="listitem">
            <p><a href="./r_WF_PERCENTILE_DISC.html">PERCENTILE_DISC ウィンドウ関数</a></p>
         </li><li class="listitem">
            <p><a href="./r_WF_RATIO_TO_REPORT.html">RATIO_TO_REPORT ウィンドウ関数</a></p>
         </li><li class="listitem">
            <p><a href="./r_WF_STDDEV.html">STDDEV_SAMP および STDDEV_POP ウィンドウ関数</a> (STDDEV_SAMP と STDDEV はシノニムです) </p>
         </li><li class="listitem">
            <p><a href="./r_WF_SUM.html">SUM ウィンドウ関数</a> </p>
         </li><li class="listitem">
            <p><a href="./r_WF_VARIANCE.html">VAR_SAMP および VAR_POP ウィンドウ関数</a> (VAR_SAMP と VARIANCE はシノニムです)</p>
         </li></ul></div>
      <p>サポートされる集計関数は次のとおりです。</p>
      <div class="itemizedlist">
          
          
          
          
          
      <ul class="itemizedlist"><li class="listitem">
            <p><a href="./r_WF_DENSE_RANK.html">DENSE_RANK ウィンドウ関数</a> </p>
         </li><li class="listitem">
            <p><a href="./r_WF_NTILE.html">NTILE ウィンドウ関数</a> </p>
         </li><li class="listitem">
            <p><a href="./r_WF_PERCENT_RANK.html">PERCENT_RANK ウィンドウ関数</a></p>
         </li><li class="listitem">
            <p><a href="./r_WF_RANK.html">RANK ウィンドウ関数</a> </p>
         </li><li class="listitem">
            <p><a href="./r_WF_ROW_NUMBER.html">ROW_NUMBER ウィンドウ関数</a></p>
         </li></ul></div>
       
         <h2 id="r_Window_function_example">ウィンドウ関数例のサンプルテーブル</h2>
         
         <p>ウィンドウ関数別の例をそれぞれの説明と共に参照できます。一部の例で使用している WINSALES という名前のテーブルには、以下の 11 行が含まれています。</p>
         <div class="table-container"><div class="table-contents"><table id="w319aac47c11c45c17b5"><thead>
                  <tr>
                     <th>SALESID </th>
                     <th>DATEID </th>
                     <th>SELLERID </th>
                     <th>BUYERID </th>
                     <th>QTY </th>
                     <th>QTY_SHIPPED </th>
                  </tr>
               </thead>
                  <tr>
                     <td tabindex="-1"> 30001 </td>
                     <td tabindex="-1"> 8/2/2003 </td>
                     <td tabindex="-1"> 3 </td>
                     <td tabindex="-1"> B </td>
                     <td tabindex="-1"> 10 </td>
                     <td tabindex="-1">10 </td>
                  </tr>
                  <tr>
                     <td tabindex="-1"> 10001 </td>
                     <td tabindex="-1"> 12/24/2003 </td>
                     <td tabindex="-1"> 1 </td>
                     <td tabindex="-1"> C </td>
                     <td tabindex="-1"> 10 </td>
                     <td tabindex="-1">10 </td>
                  </tr>
                  <tr>
                     <td tabindex="-1"> 10005 </td>
                     <td tabindex="-1"> 12/24/2003 </td>
                     <td tabindex="-1"> 1 </td>
                     <td tabindex="-1"> A </td>
                     <td tabindex="-1"> 30 </td>
                     <td tabindex="-1"> </td>
                  </tr>
                  <tr>
                     <td tabindex="-1"> 40001 </td>
                     <td tabindex="-1"> 1/9/2004 </td>
                     <td tabindex="-1"> 4 </td>
                     <td tabindex="-1"> A </td>
                     <td tabindex="-1"> 40 </td>
                     <td tabindex="-1"> </td>
                  </tr>
                  <tr>
                     <td tabindex="-1"> 10006 </td>
                     <td tabindex="-1"> 1/18/2004 </td>
                     <td tabindex="-1"> 1 </td>
                     <td tabindex="-1"> C </td>
                     <td tabindex="-1"> 10 </td>
                     <td tabindex="-1"> </td>
                  </tr>
                  <tr>
                     <td tabindex="-1"> 20001 </td>
                     <td tabindex="-1"> 2/12/2004 </td>
                     <td tabindex="-1"> 2 </td>
                     <td tabindex="-1"> B </td>
                     <td tabindex="-1"> 20 </td>
                     <td tabindex="-1">20 </td>
                  </tr>
                  <tr>
                     <td tabindex="-1"> 40005 </td>
                     <td tabindex="-1"> 2/12/2004 </td>
                     <td tabindex="-1"> 4 </td>
                     <td tabindex="-1"> A </td>
                     <td tabindex="-1"> 10 </td>
                     <td tabindex="-1">10 </td>
                  </tr>
                  <tr>
                     <td tabindex="-1"> 20002 </td>
                     <td tabindex="-1"> 2/16/2004 </td>
                     <td tabindex="-1"> 2 </td>
                     <td tabindex="-1"> C </td>
                     <td tabindex="-1"> 20 </td>
                     <td tabindex="-1">20 </td>
                  </tr>
                  <tr>
                     <td tabindex="-1"> 30003 </td>
                     <td tabindex="-1"> 4/18/2004 </td>
                     <td tabindex="-1"> 3 </td>
                     <td tabindex="-1"> B </td>
                     <td tabindex="-1"> 15 </td>
                     <td tabindex="-1"> </td>
                  </tr>
                  <tr>
                     <td tabindex="-1"> 30004 </td>
                     <td tabindex="-1"> 4/18/2004 </td>
                     <td tabindex="-1"> 3 </td>
                     <td tabindex="-1"> B </td>
                     <td tabindex="-1"> 20 </td>
                     <td tabindex="-1"> </td>
                  </tr>
                  <tr>
                     <td tabindex="-1"> 30007 </td>
                     <td tabindex="-1"> 9/7/2004 </td>
                     <td tabindex="-1"> 3 </td>
                     <td tabindex="-1"> C </td>
                     <td tabindex="-1"> 30 </td>
                     <td tabindex="-1"> </td>
                  </tr>
               </table></div></div>
         <p>次のスクリプトは、WINSALES テーブルの例を作成し、値を入力します。</p>
         <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="コピー"><awsui-icon name="copy"></awsui-icon></div></div><code class="">CREATE TABLE winsales(
  salesid int,
  dateid date,
  sellerid int,
  buyerid char(10),
  qty int,
  qty_shipped int);

INSERT INTO winsales VALUES
  (30001, '8/2/2003', 3, 'b', 10, 10),
  (10001, '12/24/2003', 1, 'c', 10, 10),
  (10005, '12/24/2003', 1, 'a', 30, null),	
  (40001, '1/9/2004', 4, 'a', 40, null),	
  (10006, '1/18/2004', 1, 'c', 10, null),	
  (20001, '2/12/2004', 2, 'b', 20, 20),
  (40005, '2/12/2004', 4, 'a', 10, 10),
  (20002, '2/16/2004', 2, 'c', 20, 20),
  (30003, '4/18/2004', 3, 'b', 15, null),
  (30004, '4/18/2004', 3, 'b', 20, null),	
  (30007, '9/7/2004', 3, 'c', 30, null);	 
</code></pre>
      <awsdocs-copyright class="copyright-print"></awsdocs-copyright><awsdocs-thumb-feedback right-edge="{{$ctrl.thumbFeedbackRightEdge}}"></awsdocs-thumb-feedback></div><noscript><div><div><div><div id="js_error_message"><p><img src="https://d1ge0kk1l5kms0.cloudfront.net/images/G/01/webservices/console/warning.png" alt="警告" /> <strong>ブラウザで JavaScript が無効になっているか、使用できません。</strong></p><p>AWS ドキュメントを使用するには、JavaScript を有効にする必要があります。手順については、使用するブラウザのヘルプページを参照してください。</p></div></div></div></div></noscript><div id="main-col-footer" class="awsui-util-font-size-0"><div id="doc-conventions"><a target="_top" href="/general/latest/gr/docconventions.html">ドキュメントの表記規則</a></div><div class="prev-next"><div id="previous" class="prev-link" accesskey="p" href="./r_TO_VARBYTE.html">TO_VARBYTE</div><div id="next" class="next-link" accesskey="n" href="./r_WF_AVG.html">AVG</div></div></div><awsdocs-page-utilities></awsdocs-page-utilities></div><div id="quick-feedback-yes" style="display: none;"><div class="title">このページは役に立ちましたか? - はい</div><div class="content"><p>ページが役に立ったことをお知らせいただき、ありがとうございます。</p><p>お時間がある場合は、何が良かったかお知らせください。今後の参考にさせていただきます。</p><p><awsui-button id="fblink" rel="noopener noreferrer" target="_blank" text="フィードバック" click="linkClick($event)" href="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=Redshift&amp;topic_url=https://docs.aws.amazon.com/ja_jp/redshift/latest/dg/c_Window_functions.html"></awsui-button></p></div></div><div id="quick-feedback-no" style="display: none;"><div class="title">このページは役に立ちましたか? - いいえ</div><div class="content"><p>このページは修正が必要なことをお知らせいただき、ありがとうございます。ご期待に沿うことができず申し訳ありません。</p><p>お時間がある場合は、ドキュメントを改善する方法についてお知らせください。</p><p><awsui-button id="fblink" rel="noopener noreferrer" target="_blank" text="フィードバック" click="linkClick($event)" href="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=Redshift&amp;topic_url=https://docs.aws.amazon.com/ja_jp/redshift/latest/dg/c_Window_functions.html"></awsui-button></p></div></div></div></body></div></awsdocs-view><div class="page-loading-indicator" id="page-loading-indicator"><awsui-spinner size="large"></awsui-spinner></div></div><div id="tools-panel" dom-region="tools"><awsdocs-tools-panel id="awsdocs-tools-panel"></awsdocs-tools-panel></div></awsui-app-layout><awsdocs-cookie-banner class="doc-cookie-banner"></awsdocs-cookie-banner></div></body></html>