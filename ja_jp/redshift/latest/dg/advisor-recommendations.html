<!DOCTYPE html>
    <html xmlns="http://www.w3.org/1999/xhtml" lang="ja-JP"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Amazon Redshift Advisor のレコメンデーション - Amazon Redshift</title><meta name="viewport" content="width=device-width,initial-scale=1" /><meta name="assets_root" content="/assets" /><meta name="target_state" content="advisor-recommendations" /><meta name="default_state" content="advisor-recommendations" /><link rel="icon" type="image/ico" href="/assets/images/favicon.ico" /><link rel="shortcut icon" type="image/ico" href="/assets/images/favicon.ico" /><link rel="canonical" href="https://docs.aws.amazon.com/ja_jp/redshift/latest/dg/advisor-recommendations.html" /><meta name="description" content="Amazon Redshift Advisor は、Amazon Redshift クラスターを最適化してパフォーマンスを高め、運用コストを低減するための方法に関するレコメンデーションを提供します。前述したように、各レコメンデーションの説明はコンソールに表示されます。これらのレコメンデーションの詳細は、以下のセクションで説明します。" /><meta name="deployment_region" content="IAD" /><meta name="product" content="Amazon Redshift" /><meta name="guide" content="データベース開発者ガイド" /><meta name="abstract" content="エンタープライズレベル、ペタバイト規模、フルマネージドのデータウェアハウスサービス、Amazon Redshift を使用してデータウェアハウスを作成および管理できます。" /><meta name="guide-locale" content="ja_jp" /><meta name="tocs" content="toc-contents.json" /><link rel="canonical" href="https://docs.aws.amazon.com/ja_jp/redshift/latest/dg/advisor-recommendations.html" /><link rel="alternative" href="https://docs.aws.amazon.com/id_id/redshift/latest/dg/advisor-recommendations.html" hreflang="id-id" /><link rel="alternative" href="https://docs.aws.amazon.com/id_id/redshift/latest/dg/advisor-recommendations.html" hreflang="id" /><link rel="alternative" href="https://docs.aws.amazon.com/de_de/redshift/latest/dg/advisor-recommendations.html" hreflang="de-de" /><link rel="alternative" href="https://docs.aws.amazon.com/de_de/redshift/latest/dg/advisor-recommendations.html" hreflang="de" /><link rel="alternative" href="https://docs.aws.amazon.com/redshift/latest/dg/advisor-recommendations.html" hreflang="en-us" /><link rel="alternative" href="https://docs.aws.amazon.com/redshift/latest/dg/advisor-recommendations.html" hreflang="en" /><link rel="alternative" href="https://docs.aws.amazon.com/es_es/redshift/latest/dg/advisor-recommendations.html" hreflang="es-es" /><link rel="alternative" href="https://docs.aws.amazon.com/es_es/redshift/latest/dg/advisor-recommendations.html" hreflang="es" /><link rel="alternative" href="https://docs.aws.amazon.com/fr_fr/redshift/latest/dg/advisor-recommendations.html" hreflang="fr-fr" /><link rel="alternative" href="https://docs.aws.amazon.com/fr_fr/redshift/latest/dg/advisor-recommendations.html" hreflang="fr" /><link rel="alternative" href="https://docs.aws.amazon.com/it_it/redshift/latest/dg/advisor-recommendations.html" hreflang="it-it" /><link rel="alternative" href="https://docs.aws.amazon.com/it_it/redshift/latest/dg/advisor-recommendations.html" hreflang="it" /><link rel="alternative" href="https://docs.aws.amazon.com/ja_jp/redshift/latest/dg/advisor-recommendations.html" hreflang="ja-jp" /><link rel="alternative" href="https://docs.aws.amazon.com/ja_jp/redshift/latest/dg/advisor-recommendations.html" hreflang="ja" /><link rel="alternative" href="https://docs.aws.amazon.com/ko_kr/redshift/latest/dg/advisor-recommendations.html" hreflang="ko-kr" /><link rel="alternative" href="https://docs.aws.amazon.com/ko_kr/redshift/latest/dg/advisor-recommendations.html" hreflang="ko" /><link rel="alternative" href="https://docs.aws.amazon.com/pt_br/redshift/latest/dg/advisor-recommendations.html" hreflang="pt-br" /><link rel="alternative" href="https://docs.aws.amazon.com/pt_br/redshift/latest/dg/advisor-recommendations.html" hreflang="pt" /><link rel="alternative" href="https://docs.aws.amazon.com/zh_cn/redshift/latest/dg/advisor-recommendations.html" hreflang="zh-cn" /><link rel="alternative" href="https://docs.aws.amazon.com/zh_tw/redshift/latest/dg/advisor-recommendations.html" hreflang="zh-tw" /><link rel="alternative" href="https://docs.aws.amazon.com/redshift/latest/dg/advisor-recommendations.html" hreflang="x-default" /><meta name="feedback-item" content="Redshift" /><meta name="this_doc_product" content="Amazon Redshift" /><meta name="this_doc_guide" content="データベース開発者ガイド" /><script defer="" src="/assets/r/vendor4.js?version=2021.12.02"></script><script defer="" src="/assets/r/vendor3.js?version=2021.12.02"></script><script defer="" src="/assets/r/vendor1.js?version=2021.12.02"></script><script defer="" src="/assets/r/awsdocs-common.js?version=2021.12.02"></script><script defer="" src="/assets/r/awsdocs-doc-page.js?version=2021.12.02"></script><link href="/assets/r/vendor4.css?version=2021.12.02" rel="stylesheet" /><link href="/assets/r/awsdocs-common.css?version=2021.12.02" rel="stylesheet" /><link href="/assets/r/awsdocs-doc-page.css?version=2021.12.02" rel="stylesheet" /><script async="" id="awsc-panorama-bundle" type="text/javascript" src="https://prod.pa.cdn.uis.awsstatic.com/panorama-nav-init.js" data-config="{'appEntity':'aws-documentation','region':'us-east-1','service':'redshift'}"></script><meta id="panorama-serviceSubSection" value="データベース開発者ガイド" /><meta id="panorama-serviceConsolePage" value="Amazon Redshift Advisor のレコメンデーション" /></head><body class="awsdocs awsui"><div class="awsdocs-container"><awsdocs-header></awsdocs-header><awsui-app-layout id="app-layout" class="awsui-util-no-gutters" ng-controller="ContentController as $ctrl" header-selector="awsdocs-header" navigation-hide="false" navigation-width="$ctrl.navWidth" navigation-open="$ctrl.navOpen" navigation-change="$ctrl.onNavChange($event)" tools-hide="$ctrl.hideTools" tools-width="$ctrl.toolsWidth" tools-open="$ctrl.toolsOpen" tools-change="$ctrl.onToolsChange($event)"><div id="guide-toc" dom-region="navigation"><awsdocs-toc></awsdocs-toc></div><div id="main-column" dom-region="content" tabindex="-1"><awsdocs-view class="awsdocs-view"><div id="awsdocs-content"><head><title>Amazon Redshift Advisor のレコメンデーション - Amazon Redshift</title><meta name="pdf" content="redshift-dg.pdf#advisor-recommendations" /><meta name="rss" content="Dochistory.rss" /><meta name="forums" content="http://forums.aws.amazon.com/forum.jspa?forumID=155" /><meta name="feedback" content="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=Redshift&amp;topic_url=https://docs.aws.amazon.com/ja_jp/redshift/latest/dg/advisor-recommendations.html" /><meta name="feedback-yes" content="feedbackyes.html?topic_url=https://docs.aws.amazon.com/ja_jp/redshift/latest/dg/advisor-recommendations.html" /><meta name="feedback-no" content="feedbackno.html?topic_url=https://docs.aws.amazon.com/ja_jp/redshift/latest/dg/advisor-recommendations.html" /><meta name="keywords" content="Amazon Redshift,AWS Redshift,Redshift,Redshift Spectrum,クラスター,データウェアハウス,開発者,サンプルデータ,データベース,データベース開発者,HLL" /><script type="application/ld+json">
{
    "@context" : "https://schema.org",
    "@type" : "BreadcrumbList",
    "itemListElement" : [
      {
        "@type" : "ListItem",
        "position" : 1,
        "name" : "AWS",
        "item" : "https://aws.amazon.com"
      },
      {
        "@type" : "ListItem",
        "position" : 2,
        "name" : "Amazon Redshift",
        "item" : "https://docs.aws.amazon.com/redshift/index.html"
      },
      {
        "@type" : "ListItem",
        "position" : 3,
        "name" : "データベース開発者ガイド",
        "item" : "https://docs.aws.amazon.com/ja_jp/redshift/latest/dg"
      },
      {
        "@type" : "ListItem",
        "position" : 4,
        "name" : "Amazon Redshift のベストプラクティス",
        "item" : "https://docs.aws.amazon.com/ja_jp/redshift/latest/dg/best-practices.html"
      },
      {
        "@type" : "ListItem",
        "position" : 5,
        "name" : "Amazon Redshift Advisor からのレコメンデーションの使用",
        "item" : "https://docs.aws.amazon.com/ja_jp/redshift/latest/dg/advisor.html"
      },
      {
        "@type" : "ListItem",
        "position" : 6,
        "name" : "Amazon Redshift Advisor のレコメンデーション",
        "item" : "https://docs.aws.amazon.com/ja_jp/redshift/latest/dg/advisor.html"
      }
    ]
}
</script></head><body><div id="main"><div style="display: none"><a href="redshift-dg.pdf#advisor-recommendations" target="_blank" rel="noopener noreferrer" title="PDF を開く"></a></div><div id="breadcrumbs" class="breadcrumb"><a href="https://aws.amazon.com">AWS</a><a href="/index.html">ドキュメント</a><a href="/redshift/index.html">Amazon Redshift</a><a href="welcome.html">データベース開発者ガイド</a></div><div id="page-toc-src"><a href="#cluster-compress-s3-recommendation">COPY によってロードされた Amazon S3 ファイルオブジェクトを圧縮する</a><a href="#isolate-active-dbs-recommendation">複数のアクティブなデータベースを分離する</a><a href="#reallocate-wlm-recommendation">ワークロード管理 (WLM) メモリを再割り当てする</a><a href="#skip-compression-analysis-recommendation">COPY 中に圧縮分析をスキップする</a><a href="#split-s3-objects-recommendation">COPY によってロードされた Amazon S3 オブジェクトを分割する</a><a href="#update-table-statistics-recommendation">テーブル統計の更新</a><a href="#enable-sqa-recommendation">ショートクエリアクセラレーションの有効化</a><a href="#alter-diststyle-distkey-recommendation">テーブルの分散キーを変更する</a><a href="#alter-sortkey-recommendation">テーブルのソートキーを変更する</a><a href="#alter-compression-encoding-recommendation">列の圧縮エンコードを変更する</a><a href="#data-type-recommendation">データ型のレコメンデーション</a></div><div id="main-content" class="awsui-util-container"><div id="main-col-body"><awsdocs-language-banner data-service="$ctrl.pageService"></awsdocs-language-banner><h1 class="topictitle" id="advisor-recommendations">Amazon Redshift Advisor のレコメンデーション</h1><div class="awsdocs-page-header-container"><awsdocs-page-header></awsdocs-page-header><awsdocs-filter-selector id="awsdocs-filter-selector"></awsdocs-filter-selector></div><p>Amazon Redshift Advisor は、Amazon Redshift クラスターを最適化してパフォーマンスを高め、運用コストを低減するための方法に関するレコメンデーションを提供します。前述したように、各レコメンデーションの説明はコンソールに表示されます。これらのレコメンデーションの詳細は、以下のセクションで説明します。</p><div class="highlights" id="inline-topiclist"><h6>トピック</h6><ul><li><a href="#cluster-compress-s3-recommendation">COPY によってロードされた Amazon S3 ファイルオブジェクトを圧縮する</a></li><li><a href="#isolate-active-dbs-recommendation">複数のアクティブなデータベースを分離する</a></li><li><a href="#reallocate-wlm-recommendation">ワークロード管理 (WLM) メモリを再割り当てする</a></li><li><a href="#skip-compression-analysis-recommendation">COPY 中に圧縮分析をスキップする</a></li><li><a href="#split-s3-objects-recommendation">COPY によってロードされた Amazon S3 オブジェクトを分割する</a></li><li><a href="#update-table-statistics-recommendation">テーブル統計の更新</a></li><li><a href="#enable-sqa-recommendation">ショートクエリアクセラレーションの有効化</a></li><li><a href="#alter-diststyle-distkey-recommendation">テーブルの分散キーを変更する</a></li><li><a href="#alter-sortkey-recommendation">テーブルのソートキーを変更する</a></li><li><a href="#alter-compression-encoding-recommendation">列の圧縮エンコードを変更する</a></li><li><a href="#data-type-recommendation">データ型のレコメンデーション</a></li></ul></div>
            <h2 id="cluster-compress-s3-recommendation">COPY によってロードされた Amazon S3 ファイルオブジェクトを圧縮する</h2>
            <p>COPY コマンドは Amazon Redshift の超並列処理 (MPP) アーキテクチャを活用して、データを並列で読み込み、ロードします。このコマンドは Amazon S3 のファイル、DynamoDB テーブル、および 1 つ以上のリモートホストからのテキスト出力を読み込むことができます。</p>
            <p>大量のデータをロードするときは、COPY コマンドを使用して、S3 から圧縮されたデータファイルをロードすることを強くお勧めします。大きなデータセットを圧縮することで、ファイルを Amazon S3 にアップロードする時間を短縮できます。また、COPY を使えば、読み込み時にファイルが解凍され、ロードプロセスが高速化されます。</p>
            <p><b>分析</b></p>
            <p>大きな非圧縮データセットをよくロードする、長時間実行される COPY コマンドでは、かなりパフォーマンスが向上する可能性があります。Advisor の分析では、大きな非圧縮データセットをロードする COPY コマンドが識別されます。このような場合、Advisor は Amazon S3 のソースファイルで圧縮を実装するためのレコメンデーションを生成します。</p>


            <p><b>レコメンデーション</b></p>
            <p>大量のデータをロードするか、かなり長時間実行される各 COPY で、Amazon S3 から圧縮されたデータオブジェクトが取り込まれることを確認します。スーパーユーザーとして次の SQL コマンドを実行して、Amazon S3 から大きな非圧縮データセットをロードする COPY コマンドを識別できます。</p>
            <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="コピー"><awsui-icon name="copy"></awsui-icon></div></div><code class="">
SELECT
    wq.userid, query, exec_start_time AS starttime, COUNT(*) num_files,
    ROUND(MAX(wq.total_exec_time/1000000.0),2) execution_secs,
    ROUND(SUM(transfer_size)/(1024.0*1024.0),2) total_mb,
    SUBSTRING(querytxt,1,60) copy_sql
FROM stl_s3client s
JOIN stl_query q USING (query)
JOIN stl_wlm_query wq USING (query)
WHERE s.userid&gt;1 AND http_method = 'GET'
    AND POSITION('COPY ANALYZE' IN querytxt) = 0
    AND aborted = 0 AND final_state='Completed'
GROUP BY 1, 2, 3, 7
HAVING SUM(transfer_size) = SUM(data_size) 
AND SUM(transfer_size)/(1024*1024) &gt;= 5
ORDER BY 6 DESC, 5 DESC;         
          </code></pre>
            <p>ロード後に、ステージングされたデータが Amazon S3 に残る場合 (データレイクアーキテクチャでは一般的です)、圧縮形式でこのデータを保存すると、ストレージコストを削減できます。</p>
            <p><b>実装のヒント</b></p>

            <div class="itemizedlist">
                
                
            <ul class="itemizedlist"><li class="listitem">
                  <p>最適なオブジェクトサイズは、圧縮後で 1～128 MB の間です。</p>
               </li><li class="listitem">
                  <p>gzip、lzop、または bzip2 形式でファイルを圧縮できます。</p>
               </li></ul></div>

          
            <h2 id="isolate-active-dbs-recommendation">複数のアクティブなデータベースを分離する</h2>
            <p>ベストプラクティスとして、Amazon Redshift のデータベースを相互に分離することをお勧めします。特定のデータベースで実行されるクエリは、クラスターの他のデータベースからのデータにアクセスできません。ただし、クラスターのすべてのデータベースで実行するクエリは、基盤となる同じストレージスペースとコンピューティングリソースを共有します。1 つのクラスターに複数のアクティブなデータベースが含まれる場合、そのワークロードは通常は無関係です。</p>
            <p><b>分析</b></p>
            <p>Advisor の分析では、同時に実行中のアクティブなワークロードに対するクラスター上のすべてのデータベースが確認されます。同時に実行中のアクティブなワークロードがある場合、Advisor は別の Amazon Redshift クラスターへのデータベースの移行を検討するためのレコメンデーションを生成します。</p>

            <p><b>レコメンデーション</b></p>
            <p>アクティブにクエリが実行されている各データベースを、別の専用クラスターに移動することを検討します。別のクラスターを使用するとリソースの競合が減少し、クエリのパフォーマンスが向上します。これが可能であるのは、各ワークロードのストレージ、コスト、およびパフォーマンスのニーズに対して各クラスターのサイズを設定できるためです。また、多くの場合、関連しないワークロードでさまざまなワークロード関連設定の利点を得ることができます。</p>
            <p>アクティブに使用されているデータベースを識別するには、スーパーユーザーとしてこの SQL コマンドを実行できます。</p>
            <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="コピー"><awsui-icon name="copy"></awsui-icon></div></div><code class="">
SELECT database,
  COUNT(*) as num_queries,
  AVG(DATEDIFF(sec,starttime,endtime)) avg_duration,
  MIN(starttime) as oldest_ts,
  MAX(endtime) as latest_ts
FROM stl_query
WHERE userid &gt; 1
GROUP BY database;            
         </code></pre>
            <p><b>実装のヒント</b></p>
            <div class="itemizedlist">
                
                
            <ul class="itemizedlist"><li class="listitem">
                  <p>ユーザーは各データベースに接続する必要があり、クエリは 1 つのデータベースのみにしかアクセスできないため、別のクラスターにデータベースを移動しても、ユーザーへの影響は最小限で済みます。</p>
               </li><li class="listitem">
                  <p>データベースを移動する 1 つのオプションは、次のステップを実行することです。</p>
                  <div class="orderedlist">
                      
                      
                      
                  <ol><li>
                        <p>現在のクラスターのスナップショットを、同じサイズのクラスターに一時的に復元します。</p>
                     </li><li>
                        <p>移動対象のデータベースを除き、新しいクラスターからすべてのデータベースを削除します。</p>
                     </li><li>
                        <p>データベースのワークロードに合わせて、クラスターのサイズを適切なノードタイプと数に変更します。</p>
                     </li></ol></div>

               </li></ul></div>
          
            <h2 id="reallocate-wlm-recommendation">ワークロード管理 (WLM) メモリを再割り当てする</h2>
            <p>Amazon Redshift はユーザークエリを処理のために <a href="./cm-c-defining-query-queues.html">手動 WLM を実装する</a> にルーティングします。ワークロード管理 (WLM) は、クエリがキューにルーティングされる方法を定義します。Amazon Redshift は、各キューにクラスターの使用可能なメモリの一部を割り当てます。キューのメモリは、キューのクエリスロットに分けられます。</p>
            <p>ワークロードが必要とするよりも多くのスロットでキューが設定されると、それらの未使用スロットに割り当てられたメモリの使用率が低くなります。設定されたスロットをワークロードの要件に合わせて減らすと、使用率の低いメモリがアクティブなスロットに再分散され、クエリのパフォーマンスが向上します。</p>
            <p><b>分析</b></p>
            <p>Advisor の分析では、ワークロードの同時実行要件を確認し、未使用スロットがあるクエリキューを識別します。Advisor は、以下が見つかると、キューのスロット数を減らすためのレコメンデーションを生成します。</p>
            <div class="itemizedlist">
                
                
            <ul class="itemizedlist"><li class="listitem">
                  <p>分析全体で完全に無効なスロットがあるキュー</p>
               </li><li class="listitem">
                  <p>分析全体で少なくとも 2 つの無効なスロットがあった、4 つを超えるスロットがあるキュー。</p>
               </li></ul></div>

            <p><b>レコメンデーション</b></p>
            <p>設定されたスロットをピーク時のワークロード要件に合わせて減らすと、使用率が低いメモリがアクティブなスロットに再分散されます。スロットが十分に利用されていないキューに対して設定されたスロット数を減らすことを検討します。それらのキューを確認するには、スーパーユーザーとして次の SQL コマンドを実行することにより、各キューの 1 時間あたりのピークスロット要件を比較できます。</p>
            <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="コピー"><awsui-icon name="copy"></awsui-icon></div></div><code class="">
WITH
 generate_dt_series AS (select sysdate - (n * interval '5 second') as dt from (select row_number() over () as n from stl_scan limit 17280)),
 apex AS (
     SELECT iq.dt, iq.service_class, iq.num_query_tasks, count(iq.slot_count) as service_class_queries, sum(iq.slot_count) as service_class_slots
     FROM
         (select gds.dt, wq.service_class, wscc.num_query_tasks, wq.slot_count
         FROM stl_wlm_query wq
         JOIN stv_wlm_service_class_config wscc ON (wscc.service_class = wq.service_class AND wscc.service_class &gt; 5)
         JOIN generate_dt_series gds ON (wq.service_class_start_time &lt;= gds.dt AND wq.service_class_end_time &gt; gds.dt)
         WHERE wq.userid &gt; 1 AND wq.service_class &gt; 5) iq
     GROUP BY iq.dt, iq.service_class, iq.num_query_tasks),
     maxes as (SELECT apex.service_class, trunc(apex.dt) as d, date_part(h,apex.dt) as dt_h, max(service_class_slots) max_service_class_slots
                     from apex group by apex.service_class, apex.dt, date_part(h,apex.dt))
SELECT apex.service_class - 5 AS queue, apex.service_class, apex.num_query_tasks AS max_wlm_concurrency, maxes.d AS day, maxes.dt_h || ':00 - ' || maxes.dt_h || ':59' as hour, MAX(apex.service_class_slots) as max_service_class_slots
FROM apex
JOIN maxes ON (apex.service_class = maxes.service_class AND apex.service_class_slots = maxes.max_service_class_slots)
GROUP BY  apex.service_class, apex.num_query_tasks, maxes.d, maxes.dt_h
ORDER BY apex.service_class, maxes.d, maxes.dt_h;            
         </code></pre>
            <p><code class="code">max_service_class_slots</code> 列はその時間のクエリキューの WLM クエリスロットの最大数を表します。使用率の低いキューが存在する場合は、「<em>Amazon Redshift 管理ガイド</em>」に記載されているように<a href="https://docs.aws.amazon.com/redshift/latest/mgmt/managing-parameter-groups-console.html#parameter-group-modify">パラメータグループを変更</a>して、スロット削減の最適化を実装します。</p>
            <p><b>実装のヒント</b></p>
            <div class="itemizedlist">
                
                
            <ul class="itemizedlist"><li class="listitem">
                  <p>ワークロードのボリュームが非常に変わりやすい場合は、分析でピークの使用期間をキャプチャしたことを確認します。そうでない場合は、前の SQL を繰り返し実行し、ピークの同時実行要件をモニタリングします。</p>
               </li><li class="listitem">
                  <p>前の SQL コードからのクエリ結果の解釈の詳細については、GitHub で <a href="https://github.com/awslabs/amazon-redshift-utils/blob/master/src/AdminScripts/wlm_apex_hourly.sql" rel="noopener noreferrer" target="_blank"><span>wlm_apex_hourly.sql スクリプト</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a>について参照してください。</p>
               </li></ul></div>

          
            <h2 id="skip-compression-analysis-recommendation">COPY 中に圧縮分析をスキップする</h2>
            <p>COPY コマンドで宣言された圧縮エンコードで空のテーブルにデータをロードすると、Amazon Redshift はストレージの圧縮を適用します。この最適化により、エンドユーザーによってロードされた場合でも、クラスターのデータが効率的に保存されます。圧縮を適用するために必要な分析には、かなり時間がかかる場合があります。</p>

            <p><b>分析</b></p>
            <p>Advisor の分析では、自動圧縮分析で遅れた COPY 操作をチェックします。この分析では、ロード中のデータをサンプリングして、圧縮エンコードが決定されます。このサンプリングは、<a href="./r_ANALYZE_COMPRESSION.html">ANALYZE COMPRESSION</a> コマンドで実行されるサンプリングに似ています。</p>
            <p>夜間の抽出、変換、ロード (ETL) バッチなどで、構造化プロセスの一部としてデータをロードする場合は、事前に圧縮を定義できます。また、悪影響なくこのフェーズを完全にスキップするようにテーブル定義を最適化することもできます。</p>
            <p><b>レコメンデーション</b></p>
            <p>圧縮分析フェーズをスキップして COPY の応答性を向上させるには、次の 2 つのオプションのいずれかを実装します。</p>
            <div class="itemizedlist">
                
                
            <ul class="itemizedlist"><li class="listitem">
                  <p>COPY コマンドを使用してロードするテーブルを作成するときに、列の <code class="code">ENCODE</code> パラメータを使用します。</p>
               </li><li class="listitem">
                  <p>COPY コマンドで <code class="code">COMPUPDATE OFF</code> パラメータを指定して、圧縮を完全に無効にします。</p>
               </li></ul></div>
            <p>通常、最適なソリューションはテーブルの作成中に列のエンコーディングを使用することです。この手法により、圧縮されたデータをディスクに保存する利点も維持できます。ANALYZE COMPRESSION コマンドを使用して圧縮エンコーディングを提案できますが、これらのエンコーディングを適用するには、テーブルを再作成する必要があります。このプロセスを自動化するには、GitHub にある AWS の <a href="https://github.com/awslabs/amazon-redshift-utils/tree/master/src/ColumnEncodingUtility" rel="noopener noreferrer" target="_blank"><span>ColumnEncodingUtility</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a> を使用できます。</p>
            <p>自動圧縮分析をトリガーした最近の COPY 操作を特定するには、次の SQL コマンドを実行します。</p>
            <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="コピー"><awsui-icon name="copy"></awsui-icon></div></div><code class="">
  WITH xids AS (
    SELECT xid FROM stl_query WHERE userid&gt;1 AND aborted=0 
    AND querytxt = 'analyze compression phase 1' GROUP BY xid
    INTERSECT SELECT xid FROM stl_commit_stats WHERE node=-1)
SELECT a.userid, a.query, a.xid, a.starttime, b.complyze_sec, 
    a.copy_sec, a.copy_sql
FROM (SELECT q.userid, q.query, q.xid, date_trunc('s',q.starttime) 
    starttime, substring(querytxt,1,100) as copy_sql, 
    ROUND(datediff(ms,starttime,endtime)::numeric / 1000.0, 2) copy_sec
    FROM stl_query q JOIN xids USING (xid)
    WHERE (querytxt ilike 'copy %from%' OR querytxt ilike '% copy %from%') 
    AND querytxt not like 'COPY ANALYZE %') a
LEFT JOIN (SELECT xid, 
    ROUND(sum(datediff(ms,starttime,endtime))::numeric / 1000.0,2) complyze_sec 
    FROM stl_query q JOIN xids USING (xid)
    WHERE (querytxt like 'COPY ANALYZE %' 
    OR querytxt like 'analyze compression phase %') 
    GROUP BY xid ) b ON a.xid = b.xid
WHERE b.complyze_sec IS NOT NULL ORDER BY a.copy_sql, a.starttime;
         </code></pre>
            <p><b>実装のヒント</b></p>
            <div class="itemizedlist">
                
                
            <ul class="itemizedlist"><li class="listitem">
                  <p>ETL プロセス (ステージングテーブル、一時テーブルなど) 中に作成される、サイズが非常に大きいすべてのテーブルで、最初のソートキーを除くすべての列に対して必ず圧縮エンコーディングを宣言します。</p>
               </li><li class="listitem">
                  <p>前の SQL コマンドによって識別された COPY コマンドごとに、ロード中のテーブルで予想される存続期間の長さを予測します。テーブルが非常に小さいまま維持されることが確実である場合は、<code class="code">COMPUPDATE OFF</code> パラメータを使用して圧縮を完全にオフにします。それ以外の場合は、COPY コマンドを使用して、ロードする前に明示的な圧縮を使用したテーブルを作成します。</p>
               </li></ul></div>
          
            <h2 id="split-s3-objects-recommendation">COPY によってロードされた Amazon S3 オブジェクトを分割する</h2>
            <p>COPY コマンドは Amazon Redshift の超並列処理 (MPP) アーキテクチャを活用して、Amazon S3 のファイルからデータを読み込み、ロードします。COPY コマンドは、複数のファイルから同時にデータをロードして、クラスターのノード間でワークロードを分散します。最適なスループットを達成するには、データを複数のファイルに分割し、並列処理の長所を最大限に活用することをお勧めします。</p>
            <p><b>分析</b></p>
            <p>Advisor の分析では、Amazon S3 でステージングされた少数のファイルに含まれる大きなデータセットをロードする COPY コマンドが識別されます。少数のファイルから大きなデータセットをよくロードする、長時間実行される COPY コマンドでは、かなりパフォーマンスが向上する可能性があります。これらの COPY コマンドにかなり長い時間がかかっていると Advisor が判断した場合、Amazon S3 の追加のファイルにデータを分割して、並列処理性を高めるためのレコメンデーションが作成されます。</p>
            <p><b>レコメンデーション</b></p>
            <p>この場合は、次のアクションを実行することをお勧めします。これらは優先順位が高い順に示されています。</p>
            <div class="orderedlist">
                
                
                
            <ol><li>
                  <p>クラスターのノード数よりも少ないファイルをロードする COPY コマンドを最適化します。</p>
               </li><li>
                  <p>クラスターのスライス数よりも少ないファイルをロードする COPY コマンドを最適化します。</p>
               </li><li>
                  <p>ファイルの数がクラスタースライス数の倍数でない場合は、COPY コマンドを最適化します。</p>
               </li></ol></div>
            <p>特定の COPY コマンドは、大量のデータをロードするか、かなり長時間実行されます。これらのコマンドについては、クラスターのスライス数の倍数と等しい数のデータオブジェクトを Amazon S3 からロードすることをお勧めします。COPY コマンドでロードされた S3 オブジェクトの数を確認するため、スーパーユーザーとして次の SQL コードを実行します。</p>
            <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="コピー"><awsui-icon name="copy"></awsui-icon></div></div><code class="">
SELECT
    query, COUNT(*) num_files,
    ROUND(MAX(wq.total_exec_time/1000000.0),2) execution_secs,
    ROUND(SUM(transfer_size)/(1024.0*1024.0),2) total_mb,
    SUBSTRING(querytxt,1,60) copy_sql
FROM stl_s3client s
JOIN stl_query q USING (query)
JOIN stl_wlm_query wq USING (query)
WHERE s.userid&gt;1 AND http_method = 'GET'
    AND POSITION('COPY ANALYZE' IN querytxt) = 0
    AND aborted = 0 AND final_state='Completed'
GROUP BY query, querytxt
HAVING (SUM(transfer_size)/(1024*1024))/COUNT(*) &gt;= 2
ORDER BY CASE
WHEN COUNT(*) &lt; (SELECT max(node)+1 FROM stv_slices) THEN 1
WHEN COUNT(*) &lt; (SELECT COUNT(*) FROM stv_slices WHERE node=0) THEN 2
ELSE 2+((COUNT(*) % (SELECT COUNT(*) FROM stv_slices))/(SELECT COUNT(*)::DECIMAL FROM stv_slices))
END, (SUM(transfer_size)/(1024.0*1024.0))/COUNT(*) DESC;   
            
         </code></pre>
            <p><b>実装のヒント</b></p>
            <div class="itemizedlist">
                
                
                
            <ul class="itemizedlist"><li class="listitem">
                  <p>ノードのスライスの数は、クラスターのノードサイズによって決まります。さまざまなノードタイプのスライス数については、「<em>Amazon Redshift 管理ガイド</em>」の「<a href="https://docs.aws.amazon.com/redshift/latest/mgmt/working-with-clusters.html#rs-about-clusters-and-nodes">Amazon Redshift のクラスターとノード</a>」を参照してください。</p>
               </li><li class="listitem">
                  <p>セットに共通プレフィックスまたはプレフィックスキーを指定するか、マニフェストファイルにファイルのリストを明示的に指定することで、複数のファイルをロードできます。ファイルのロードについて詳しくは、「<a href="./t_splitting-data-files.html">圧縮および非圧縮のファイルからのデータのロード</a>」を参照してください。</p>
               </li><li class="listitem">
                  <p>Amazon Redshift はワークロードを分割するときにファイルサイズを考慮しません。ロードデータファイルを分割して大体同じサイズにし、圧縮後に 1 MB ～ 1 GB になるようにします。</p>
               </li></ul></div>
          
            <h2 id="update-table-statistics-recommendation">テーブル統計の更新</h2>
            <p>Amazon Redshift はコストベースのクエリオプティマイザを使用して、クエリに対して最適な実行プランを選択します。コストの予測は、ANALYZE コマンドを使用中に収集されたテーブル統計に基づいています。統計が古いか、ない場合、データベースではクエリを実行するために効率の低いプランが選択される可能性があります (特に複雑なクエリの場合)。現在の統計を維持すると、可能な限り短時間で複雑なクエリを実行するうえで役立ちます。</p>
            <p><b>分析</b></p>
            <p>Advisor の分析では、統計が古いか、欠落しているテーブルが追跡されます。複雑なクエリに関連するテーブルアクセスのメタデータが確認されます。複雑なパターンで頻繁にアクセスされるテーブルに統計がない場合、Advisor は ANALYZE を実行するための<b>重要な</b>レコメンデーションを作成します。複雑なパターンで頻繁にアクセスされるテーブルに古い統計がある場合、Advisor は ANALYZE を実行するためのレコメンデーション<b>提案</b>を作成します。</p>

            <p><b>レコメンデーション</b></p>
            <p>テーブルの内容が大きく変わるたびに、ANALYZE で統計を更新します。COPY または INSERT コマンドで、既存のテーブルにかなりの数の新しいデータ行をロードするたびに、ANALYZE を実行することをお勧めします。また、UPDATE または DELETE コマンドを使用してかなりの数の行を変更するたびに、ANALYZE を実行することをお勧めします。統計がない、または統計が古いテーブルを識別するには、スーパーユーザーとして次の SQL コマンドを実行します。結果は、最も大きなテーブルから最も小さいテーブルの順にソートされます。</p>
            <p>統計がない、または統計が古いテーブルを識別するには、スーパーユーザーとして次の SQL コマンドを実行します。結果は、最も大きなテーブルから最も小さいテーブルの順にソートされます。</p>
            <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="コピー"><awsui-icon name="copy"></awsui-icon></div></div><code class="">
SELECT
   ti.schema||'.'||ti."table" tablename,
   ti.size table_size_mb,
   ti.stats_off statistics_accuracy
 FROM svv_table_info ti
 WHERE ti.stats_off &gt; 5.00
 ORDER BY ti.size DESC;          
         </code></pre>
            <p><b>実装のヒント</b></p>
            
                  <p>デフォルトの ANALYZE のしきい値は 10 パーセントです。これは、最後の ANALYZE から変更されたテーブルの行が 10 パーセント未満の場合、ANALYZE コマンドは指定されたテーブルをスキップすることを意味します。その結果、各 ETL プロセスの最後に ANALYZE コマンドを発行する選択ができます。この手法では、ANALYZE は頻繁にスキップされますが、必要なときには ANALYZE が確実に実行されます。</p>
              
                  <p>ANALYZE の統計は、結合で使用される列 (例: <code class="code">JOIN tbl_a ON col_b</code>)、または述語として使用される列 (例: <code class="code">WHERE col_b = 'xyz'</code>) に対して最も大きな影響があります。デフォルトでは、ANALYZE は指定されたテーブルのすべての列の統計を収集します。必要に応じて、最も影響が大きい列に対してのみ ANALYZE を実行して、ANALYZE の実行に必要な時間を短縮できます。述語として使用される列を識別するには、次の SQL コマンドを実行できます。また、<code class="code">ANALYZE PREDICATE COLUMNS</code> を指定して、分析する列を Amazon Redshift で自動的に選択することもできます。</p>
                  <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="コピー"><awsui-icon name="copy"></awsui-icon></div></div><code class="">WITH predicate_column_info as (
SELECT ns.nspname AS schema_name, c.relname AS table_name, a.attnum as col_num,  a.attname as col_name,
        CASE
            WHEN 10002 = s.stakind1 THEN array_to_string(stavalues1, '||') 
            WHEN 10002 = s.stakind2 THEN array_to_string(stavalues2, '||')
            WHEN 10002 = s.stakind3 THEN array_to_string(stavalues3, '||')
            WHEN 10002 = s.stakind4 THEN array_to_string(stavalues4, '||')
            ELSE NULL::varchar
        END AS pred_ts
   FROM pg_statistic s
   JOIN pg_class c ON c.oid = s.starelid
   JOIN pg_namespace ns ON c.relnamespace = ns.oid
   JOIN pg_attribute a ON c.oid = a.attrelid AND a.attnum = s.staattnum)
SELECT schema_name, table_name, col_num, col_name,
       pred_ts NOT LIKE '2000-01-01%' AS is_predicate,
       CASE WHEN pred_ts NOT LIKE '2000-01-01%' THEN (split_part(pred_ts, '||',1))::timestamp ELSE NULL::timestamp END as first_predicate_use,
       CASE WHEN pred_ts NOT LIKE '%||2000-01-01%' THEN (split_part(pred_ts, '||',2))::timestamp ELSE NULL::timestamp END as last_analyze
FROM predicate_column_info;</code></pre>
            <p>詳細については、「<a href="./t_Analyzing_tables.html">テーブルを分析する</a>」を参照してください。</p>
          
            <h2 id="enable-sqa-recommendation">ショートクエリアクセラレーションの有効化</h2>
            <p>ショートクエリアクセラレーション (SQA) は、実行時間が短い一部のクエリを、実行時間が長いクエリよりも優先します。SQA では実行時間が短いクエリを専用領域で実行します。このため SQA クエリは、実行時間が長いクエリをキューで待機するよう強制されません。SQA は、実行時間が短く、ユーザー定義のキュー内にあるクエリのみを優先します。SQA によって実行時間が短いクエリの実行開始が早くなり、ユーザーへの結果表示も早くなります。</p>
            <p>SQA を有効にすると、ショートクエリの実行に割り当てられるワークロード管理 (WLM) キューを減らす、またはなくすことができます。さらに、キュー内のスロットに対する実行時間が長いクエリとショートクエリの競合が不要になるため、WLM キューが使用するクエリスロットの数を少なく設定できます。同時実行数が減るとクエリのスループットが向上し、大部分のワークロードに関するシステム全体のパフォーマンスも向上します。詳細については、「<a href="./wlm-short-query-acceleration.html">ショートクエリアクセラレーションを使用する</a>」を参照してください。</p>
            <p><b>分析</b></p>
            <p>Advisor はワークロードパターンを確認し、SQA がレイテンシーと SQA 対象クエリの日次キュー時間を減らす最近のクエリの数を報告します。</p>
            <p><b>レコメンデーション</b></p>
            <p>WLM 設定を変更して SQA を有効にします。Amazon Redshift は、機械学習アルゴリズムを使用して適格な各クエリを分析します。クエリのパターンを SQA が学習するため、予測精度は向上します。詳細については、「<a href="https://docs.aws.amazon.com/redshift/latest/mgmt/workload-mgmt-config.html">ワークロード管理の設定</a>」を参照してください。</p>
            <p>SQA を有効にすると、WLM は、ショートクエリの最大実行時間をデフォルトで動的に設定します。SQA の最大実行時間の動的設定を保持することをお勧めします。</p>
            <p><b>実装のヒント</b></p>
            <p>SQA が有効になっているかどうか確認するには、以下のクエリを実行します。クエリが 1 行を返した場合、SQA は有効です。</p>
            <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="コピー"><awsui-icon name="copy"></awsui-icon></div></div><code class="">select * from stv_wlm_service_class_config 
where service_class = 14;</code></pre>
            <p>詳細については、「<a href="./wlm-short-query-acceleration.html#wlm-monitoring-sqa">SQA のモニタリング</a>」を参照してください。</p>
          
            <h2 id="alter-diststyle-distkey-recommendation">テーブルの分散キーを変更する</h2>
            <p>Amazon Redshift は、テーブルディストリビューションスタイルに従ってクラスター全体にテーブル行を分散します。キー分散を含むテーブルでは、分散キー (DISTKEY) として列が必要です。テーブル行は、その DISTKEY 列の値に基づいてクラスターのノードスライスに割り当てられます。</p>
            <p>適切な DISTKEY によって、各ノードスライスに同様の数の行が配置され、結合条件で頻繁に参照されます。結合は、テーブルが DISTKEY 列で結合されるときに最適化され、その結果クエリのパフォーマンスは向上します。</p>
            
            <p><b>分析</b></p>
            <p>Advisor は、クラスターのワークロードを分析して、キー分散スタイルから大きなメリットが得られるテーブルに最適な分散キーを識別します。</p>
            
            <p><b>レコメンデーション</b></p>
            <p>Advisor には、分析に基づいてテーブルの DISTSTYLE および DISTKEY を変更する <a href="./r_ALTER_TABLE.html">ALTER TABLE</a> ステートメントが用意されています。パフォーマンスのメリットを大幅に向上させるには、レコメンデーショングループ内の SQL ステートメントをすべて実装する必要があります。</p>
            <p>ALTER TABLE を使用して大きなテーブルを再分散すると、クラスターリソースが消費され、一時的なテーブルロックがさまざまな時点で必要になります。他のクラスターのワークロードが軽いときに、レコメンデーションの各グループを実装します。テーブル分散プロパティの最適化の詳細については、<a href="https://aws.amazon.com/blogs/big-data/amazon-redshift-engineerings-advanced-table-design-playbook-distribution-styles-and-distribution-keys/" rel="noopener noreferrer" target="_blank"><span>Amazon Redshift エンジニアリングの高度なテーブル設計の計画: ディストリビューションスタイルとディストリビューションキー</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a>を参照してください。</p>        
            <p>ALTER DISTSYLE および DISTKEY の詳細については、<a href="./r_ALTER_TABLE.html">ALTER TABLE</a> を参照してください。</p>
            <div class="awsdocs-note"><div class="awsdocs-note-title"><awsui-icon name="status-info" variant="link"></awsui-icon><h6>注記</h6></div><div class="awsdocs-note-text"><p>レコメンデーションが表示されないとしても、必ずしも現在の分散スタイルが最も適切であるとは限りません。Advisor は、十分なデータがない場合や、再分散で期待されるメリットが少ない場合にはレコメンデーションを提供しません。</p><p>また、Advisor のレコメンデーションは特定のテーブルに適用され、必ずしも、同じ名前の列を含むテーブルに適用されるとは限りません。列名を共有するテーブルは、テーブル内のデータが同じでない限り、それらの列に対して異なる特性を含めることができます。</p><p>ETL ジョブによって作成または削除されるステージングテーブルのレコメンデーションが表示される場合は、ETL プロセスを変更して、Advisor が推奨する分散キーを使用します。</p></div></div>

          
            <h2 id="alter-sortkey-recommendation">テーブルのソートキーを変更する</h2>
            <p>Amazon Redshift は、テーブルの<a href="./t_Sorting_data.html">ソートキー</a>に従ってテーブル行をソートします。テーブル行のソートは、ソートキー列の値に基づいています。</p>
            <p>テーブルを適切なソートキーでソートすると、ディスクから読み取るテーブルブロックが少なくなるため、特に範囲が制限された述語を持つクエリのパフォーマンスが向上します。</p>
            
            <p><b>分析</b></p>
            <p>Advisor は数日にわたってクラスターのワークロードを分析し、テーブルにとって有益なソートキーを特定します。</p>
            
            <p><b>レコメンデーション</b></p>
            <p> Advisor は、分析に基づいてテーブルのソートキーを変更するために、以下の 2 グループの ALTER TABLE ステートメントを提供します。</p>
            <div class="itemizedlist">
                
                
            <ul class="itemizedlist"><li class="listitem"><p>COMPOUND ソートキーを追加するために、現在ソートキーを保持していないテーブルを変更するステートメント。</p></li><li class="listitem"><p>ソートキーを INTERLEAVED から COMPOUND に変更するか、ソートキーを使用しなくするためのステートメント。</p>
                  <p>複合 (COMPOUND) ソートキーを使用すると、メンテナンス時のオーバーヘッドが大幅に削減されます。複合ソートキーがあるテーブルは、インターリーブソートに必要な、高価な VACUUM REINDEX 操作を必要としません。実際には、大半の Amazon Redshift ワークロードでインターリーブソートキーより複合ソートキーの方が効率的です。ただし、テーブルが小さい場合は、ソートキーを格納するためのオーバーヘッドを回避するために、ソートキーを使用しない方が効率的です。</p></li></ul></div>
            
            <p>ALTER TABLE を使用して大きなテーブルをソートすると、クラスターリソースが消費され、さまざまなタイミングでテーブルロックが必要になります。クラスターのワークロードが中程度の場合は、各レコメンデーションを実装します。テーブルソートキー設定の最適化の詳細については、<a href="https://aws.amazon.com/blogs/big-data/amazon-redshift-engineerings-advanced-table-design-playbook-compound-and-interleaved-sort-keys/" rel="noopener noreferrer" target="_blank"><span>Amazon Redshift エンジニアリングの高度なテーブル設計プレイブック: 複合ソートキーおよびインターリーブソートキー</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a>を参照してください。</p>        
            <p>ALTER SORTKEY の詳細については、<a href="./r_ALTER_TABLE.html">ALTER TABLE</a> を参照してください。</p>
            
            <div class="awsdocs-note"><div class="awsdocs-note-title"><awsui-icon name="status-info" variant="link"></awsui-icon><h6>注記</h6></div><div class="awsdocs-note-text"><p>テーブルのレコメンデーションが表示されない場合は、必ずしも現在の設定が最適であるとは限りません。Advisor は、十分なデータがない場合や、ソートで期待されるメリットが少ない場合にはレコメンデーションを提供しません。</p><p>Advisor のレコメンデーションは特定のテーブルに適用され、必ずしも、同じ名前やデータ型の列を含むテーブルに適用されるとは限りません。列名を共有するテーブルには、テーブル内のデータとワークロードに基づいて異なるレコメンデーションがある場合があります。</p></div></div>
            
          
            <h2 id="alter-compression-encoding-recommendation">列の圧縮エンコードを変更する</h2>
            <p>圧縮は、データの保存時にそのサイズを小さくする列レベルの操作です。Amazon Redshift では、ディスクの I/O 量を減らすことによってストレージ領域を節約し、クエリパフォーマンスを向上させるために、圧縮を使用します。各列のデータ型とクエリパターンに基づいて、最適な圧縮エンコードを行うことをお勧めします。最適な圧縮を行えば、クエリをより効率的に実行でき、データベースが占めるストレージ領域を最小限に抑えることができます。</p>
            
            <p><b>分析</b></p>
            <p>Advisor は、クラスターのワークロードとデータベーススキーマの分析を継続的に実行し、各テーブルの列に最適な圧縮エンコードを特定します。</p>
            
            <p><b>レコメンデーション</b></p>
            <p>Advisor は、分析に基づいて特定の列の圧縮エンコードを変更する ALTER TABLE ステートメントを提供します。</p>
            <p><a href="./r_ALTER_TABLE.html">ALTER TABLE</a> で列圧縮エンコードを変更すると、クラスターのリソースが使用され、さまざまな時点でテーブルロックが必要になります。クラスターのワークロードが軽い場合は、レコメンデーションを実装することをお勧めします。</p>
            <p>参考までに、<a href="./r_ALTER_TABLE_examples_basic.html">ALTER TABLE の例</a> は列のエンコードを変更するステートメントをいくつか示します。</p>        
            
            <div class="awsdocs-note"><div class="awsdocs-note-title"><awsui-icon name="status-info" variant="link"></awsui-icon><h6>注記</h6></div><div class="awsdocs-note-text"><p>Advisor は、十分なデータがない場合や、エンコードを変更することで期待されるメリットが少ない場合にはレコメンデーションを提供しません。</p></div></div>
            
          
            <h2 id="data-type-recommendation">データ型のレコメンデーション</h2>
            <p>Amazon Redshift には、さまざまなユースケースに対応する SQL データ型のライブラリがあります。これらのデータ型には、<code class="code">INT</code> のような整数型や、<code class="code">VARCHAR</code> のような文字を保存する型などがあります。Redshift は、迅速なアクセスと優れたクエリパフォーマンスを実現するために、最適化された方法でデータ型を保存します。Redshift は特定のデータ型に対する関数も提供し、これらはクエリ結果のフォーマットや計算に使用できます。</p>
            
            <p><b>分析</b></p>
            <p>Advisor は、クラスターのワークロードとデータベーススキーマの分析を継続的に実行して、データ型の変更によって大きなメリットが得られる列を特定します。</p>
            
            <p><b>レコメンデーション</b></p>
            
            <p> Advisor は、提案されたデータ型を使用した新しい列を追加する <code class="code">ALTER TABLE</code> ステートメントを提供します。それに付随する <code class="code">UPDATE</code> ステートメントは、既存の列のデータを新しい列にコピーします。新しい列を作成してデータをロードしたら、新しい列にアクセスするようにクエリと取り込みスクリプトを変更します。次に、新しいデータ型に特化した機能と関数を活用します。これらは「<a href="./c_SQL_functions.html">SQL 関数リファレンス</a>」に記載されています。</p>
            <p> 既存のデータを新しい列にコピーするには、時間がかかる場合があります。Advisor のレコメンデーションは、それぞれクラスターのワークロードが軽いときに実装することをお勧めします。「<a href="./c_Supported_data_types.html">データ型</a>」で、利用可能なデータ型のリストを参照してください。</p>
            <p> Advisor は、十分なデータがない場合、またはデータ型を変更することで期待されるメリットが少ない場合にはレコメンデーションを提供しません。</p>        
            
         <awsdocs-copyright class="copyright-print"></awsdocs-copyright><awsdocs-thumb-feedback right-edge="{{$ctrl.thumbFeedbackRightEdge}}"></awsdocs-thumb-feedback></div><noscript><div><div><div><div id="js_error_message"><p><img src="https://d1ge0kk1l5kms0.cloudfront.net/images/G/01/webservices/console/warning.png" alt="警告" /> <strong>ブラウザで JavaScript が無効になっているか、使用できません。</strong></p><p>AWS ドキュメントを使用するには、JavaScript を有効にする必要があります。手順については、使用するブラウザのヘルプページを参照してください。</p></div></div></div></div></noscript><div id="main-col-footer" class="awsui-util-font-size-0"><div id="doc-conventions"><a target="_top" href="/general/latest/gr/docconventions.html">ドキュメントの表記規則</a></div><div class="prev-next"><div id="previous" class="prev-link" accesskey="p" href="./access-advisor.html">アクセスアドバイザー</div><div id="next" class="next-link" accesskey="n" href="./tutorials-redshift.html">チュートリアル</div></div></div><awsdocs-page-utilities></awsdocs-page-utilities></div><div id="quick-feedback-yes" style="display: none;"><div class="title">このページは役に立ちましたか? - はい</div><div class="content"><p>ページが役に立ったことをお知らせいただき、ありがとうございます。</p><p>お時間がある場合は、何が良かったかお知らせください。今後の参考にさせていただきます。</p><p><awsui-button id="fblink" rel="noopener noreferrer" target="_blank" text="フィードバック" click="linkClick($event)" href="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=Redshift&amp;topic_url=https://docs.aws.amazon.com/ja_jp/redshift/latest/dg/advisor-recommendations.html"></awsui-button></p></div></div><div id="quick-feedback-no" style="display: none;"><div class="title">このページは役に立ちましたか? - いいえ</div><div class="content"><p>このページは修正が必要なことをお知らせいただき、ありがとうございます。ご期待に沿うことができず申し訳ありません。</p><p>お時間がある場合は、ドキュメントを改善する方法についてお知らせください。</p><p><awsui-button id="fblink" rel="noopener noreferrer" target="_blank" text="フィードバック" click="linkClick($event)" href="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=Redshift&amp;topic_url=https://docs.aws.amazon.com/ja_jp/redshift/latest/dg/advisor-recommendations.html"></awsui-button></p></div></div></div></body></div></awsdocs-view><div class="page-loading-indicator" id="page-loading-indicator"><awsui-spinner size="large"></awsui-spinner></div></div><div id="tools-panel" dom-region="tools"><awsdocs-tools-panel id="awsdocs-tools-panel"></awsdocs-tools-panel></div></awsui-app-layout><awsdocs-cookie-banner class="doc-cookie-banner"></awsdocs-cookie-banner></div></body></html>